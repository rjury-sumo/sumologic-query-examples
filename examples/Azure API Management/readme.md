# Azure API Management

## Searches

### Log Searches

- **Average Duration**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Overview 
- **Backend Request Duration by Backend Method**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Performance 
- **Backend Request Duration by Backend Url**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Performance 
- **Backend Requests by Response Code**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Performance 
- **Distribution  by Operation Type (Read, Write and Delete)**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Administrative Operations 
- **Distribution by Operations**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Administrative Operations 
- **Distribution by Status**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Administrative Operations 
- **Failed Backend Requests**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Errors 
- **Failed Backend Requests by Backend Method**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Errors 
- **Failed Backend Requests by Backend Protocol**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Errors 
- **Failed Backend Requests by Backend Url**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Errors 
- **Failed Policy Events**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Policy and Recommendations 
- **Failed Request Details**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Errors 
- **Failed Request Details**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Developer Portal 
- **Failed Requests**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Overview 
- **Failed Requests**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Errors 
- **Failed Requests by Method**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Errors 
- **Failed Requests by Method**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Developer Portal 
- **Failed Requests by Protocol**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Errors 
- **Failed Requests by Response Category**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Developer Portal 
- **Failed Requests by Subscription**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Subscriptions 
- **Failed Requests by Subscription**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Subscriptions 
- **Failed Requests by Url**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Errors 
- **Overall Duration Vs Backend Duration**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Performance 
- **Recent Changes in Subscription**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Subscriptions 
- **Recent Delete Operations**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Administrative Operations 
- **Recent Recommendation Events**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Policy and Recommendations 
- **Recent Write Operations**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Administrative Operations 
- **Request Duration by Method**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Performance 
- **Request Duration by Subscription**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Subscriptions 
- **Request Duration by Url**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Performance 
- **Requests by Backend Response Code**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Errors 
- **Requests by Location**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Overview 
- **Requests by Response Code**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Developer Portal 
- **Requests by Response Code**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Performance 
- **Requests by Response Code**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Errors 
- **Requests by Result Type**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Performance 
- **Requests by Subscription**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Subscriptions 
- **Requests Summary by API**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Overview 
- **Success Requests vs Failed Requests**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Developer Portal 
- **Successful Requests by Client Protocol**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Performance 
- **Successful Requests by Method**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Performance 
- **Top 10 APIs With Highest Backend Execution Duration (ms)**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Performance 
- **Top 10 APIs With Highest Number of Requests**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Performance 
- **Top 10 Failed API Urls**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Errors 
- **Top 10 Failed Subscription**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Subscriptions 
- **Top 10 Operations That Caused The Most Errors**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Administrative Operations 
- **Top 3 Caller IPs With Failures by Resource**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Errors 
- **Top Backend Url by Request Size**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Overview 
- **Top Backend Urls with Response Size**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Overview 
- **Top Operations with Request Size**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Overview 
- **Top Operations with Response Size**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Overview 
- **Total Failed Policy Events**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Policy and Recommendations 
- **Total Failed Requests**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Developer Portal 
- **Total Recommendation Events**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Policy and Recommendations 
- **Total Requests by Method**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Overview 
- **Total Requests by Response Code**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Overview 
- **Total Requests by Subscription**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Subscriptions 
- **Total Success Policy Events**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Policy and Recommendations 
- **Total Success Policy Events**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Policy and Recommendations 
- **Total Success Requests**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Developer Portal 
- **Users / Applications by Operation type**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Administrative Operations 
- **Websocket Connection Details**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Overview 
- **Websocket Connections by Event Name**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Overview

### Metric Searches

- **API Requests (Today, Yesterday, Last Week)**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Overview 
- **Average Capacity Utilization (%)**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Overview 
- **CPU (%)**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Overview 
- **Total Requests**: from Dashboard: Installed Apps/Azure API Management/Azure API Management - Overview

## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Azure API Management|API Requests (Today, Yesterday, Last Week)|Metrics|Installed Apps/Azure API Management/Azure API Management - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}}<br />metric=Requests statistic=total \| quantize using sum \| avg|
|Azure API Management|Average Capacity Utilization (%)|Metrics|Installed Apps/Azure API Management/Azure API Management - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} metric=Capacity statistic=average \| quantize using avg \| avg by resource\_group, resource\_name |
|Azure API Management|Average Duration|Logs|Installed Apps/Azure API Management/Azure API Management - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "durationMs", "properties.method", "properties.apiId", "properties.url" as category, durationMs, method, apiId, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| timeslice 1h<br />\| avg(durationMs) by resource\_group, resource\_name|
|Azure API Management|Backend Request Duration by Backend Method|Logs|Installed Apps/Azure API Management/Azure API Management - Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "properties.backendTime", "properties.backendMethod", "properties.apiId", "properties.url" as category, backendTime, backendMethod, apiId, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| timeslice 1h<br />\| avg(backendTime) by \_timeslice, resource\_group, resource\_name, backendMethod<br />\| format("resource\_group=%s resource\_name=%s method=%s", resource\_group, resource\_name, backendMethod) as resource\_identifier<br />\| fields - resource\_group, resource\_name, backendMethod<br />\| transpose row \_timeslice column resource\_identifier|
|Azure API Management|Backend Request Duration by Backend Url|Logs|Installed Apps/Azure API Management/Azure API Management - Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "properties.backendTime", "properties.backendUrl", "properties.apiId", "properties.url" as category, backendTime, backendUrl, apiId, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| timeslice 1h<br />\| avg(backendTime) by \_timeslice, resource\_group, resource\_name, backendUrl<br />\| format("resource\_group=%s resource\_name=%s backendUrl=%s", resource\_group, resource\_name, backendUrl) as resource\_identifier<br />\| fields - resource\_group, resource\_name, backendUrl<br />\| transpose row \_timeslice column resource\_identifier|
|Azure API Management|Backend Requests by Response Code|Logs|Installed Apps/Azure API Management/Azure API Management - Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "properties.backendResponseCode", "properties.apiId", "properties.url" as category, backendResponseCode, apiId, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| timeslice 1h<br />\| if (backendResponseCode matches "2\*", "sucessfull\_requests", if (backendResponseCode matches "3\*", "redirect\_requests", if (backendResponseCode matches "4\*", "client\_error\_requests", if (backendResponseCode matches "5\*", "server\_error\_requests", "other\_requests")))) as backendResponseCodeCategory<br />\| count by \_timeslice, resource\_group, resource\_name, backendResponseCodeCategory<br />\| format("resource\_group=%s resource\_name=%s backendResponseCodeCategory=%s", resource\_group, resource\_name, backendResponseCodeCategory) as resource\_identifier<br />\| fields - resource\_group, resource\_name, backendResponseCodeCategory<br />\| transpose row \_timeslice column resource\_identifier<br />|
|Azure API Management|CPU (%)|Metrics|Installed Apps/Azure API Management/Azure API Management - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} metric=CpuPercent\_Gateway statistic=average \| quantize using avg \| avg by resource\_group, resource\_name |
|Azure API Management|Distribution  by Operation Type (Read, Write and Delete)|Logs|Installed Apps/Azure API Management/Azure API Management - Administrative Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name={{resource\_name}} provider\_name={{provider\_name}} resource\_type={{resource\_type}} Administrative <br />\| json "resultType", "category", "operationName", "resourceId" as resultType, category, operationName, resourceid<br />\| where (resultType="Accept" or resultType="Success") and category="Administrative"<br />\| "OTHERS" as operationType<br />\| if (toUppercase(operationName) matches /WRITE/, "WRITE", operationType) as operationType <br />\| if (toUppercase(operationName) matches /READ/, "READ", operationType) as operationType <br />\| if (toUppercase(operationName) matches /DELETE/, "DELETE", operationType) as operationType <br />\| count by operationType<br />\| sort by \_count, operationType asc|
|Azure API Management|Distribution by Operations|Logs|Installed Apps/Azure API Management/Azure API Management - Administrative Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name={{resource\_name}} provider\_name={{provider\_name}} resource\_type={{resource\_type}} Administrative <br />\| json "resultType", "category", "operationName", "resourceId" as resultType, category, operationName, resourceid<br />\| where (resultType="Accept" or resultType="Success") and category="Administrative" <br />\| parse field=operationName "\*/\*/\*" as provider\_name, resource\_type, operation\_name<br />\| count by operation\_name<br />\| order by \_count, operation\_name asc|
|Azure API Management|Distribution by Status|Logs|Installed Apps/Azure API Management/Azure API Management - Administrative Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name={{resource\_name}} provider\_name={{provider\_name}} resource\_type={{resource\_type}} Administrative <br />\| json "resultType", "category" as resultType, category<br />\| where category="Administrative" <br />\| count by resultType<br />\| order by \_count, resultType asc|
|Azure API Management|Failed Backend Requests|Logs|Installed Apps/Azure API Management/Azure API Management - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "isRequestSuccess", "properties.backendResponseCode", "properties.apiId", "properties.url" as category, isRequestSuccess, backendResponseCode, apiId, url<br />\| where category="GatewayLogs" and !(backendResponseCode \>= 200 and backendResponseCode\<=300) and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| count by resource\_group, resource\_name|
|Azure API Management|Failed Backend Requests by Backend Method|Logs|Installed Apps/Azure API Management/Azure API Management - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "properties.backendMethod", "isRequestSuccess", "properties.apiId", "properties.url" as category, backendMethod, isRequestSuccess , apiId, url<br />\| where category="GatewayLogs" and isRequestSuccess="false" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| timeslice 1h<br />\| count by \_timeslice, resource\_group, resource\_name, backendMethod<br />\| format("resource\_group=%s resource\_name=%s backendMethod=%s", resource\_group, resource\_name, backendMethod) as resource\_identifier<br />\| fields - resource\_group, resource\_name, backendMethod<br />\| transpose row \_timeslice column resource\_identifier|
|Azure API Management|Failed Backend Requests by Backend Protocol|Logs|Installed Apps/Azure API Management/Azure API Management - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "properties.backendProtocol", "isRequestSuccess", "properties.apiId", "properties.url" as category, backendProtocol, isRequestSuccess, apiId, url<br />\| where category="GatewayLogs" and isRequestSuccess="false" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| timeslice 1h<br />\| count by \_timeslice, resource\_group, resource\_name, backendProtocol<br />\| format("resource\_group=%s resource\_name=%s backendProtocol=%s", resource\_group, resource\_name, backendProtocol) as resource\_identifier<br />\| fields - resource\_group, resource\_name, backendProtocol<br />\| transpose row \_timeslice column resource\_identifier|
|Azure API Management|Failed Backend Requests by Backend Url|Logs|Installed Apps/Azure API Management/Azure API Management - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "properties.backendUrl", "isRequestSuccess", "properties.apiId", "properties.url" as category, backendUrl, isRequestSuccess, apiId, url<br />\| where category="GatewayLogs" and isRequestSuccess="false" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| timeslice 1h<br />\| count by \_timeslice, resource\_group, resource\_name, backendUrl<br />\| format("resource\_group=%s resource\_name=%s backendUrl=%s", resource\_group, resource\_name, backendUrl) as resource\_identifier<br />\| fields - resource\_group, resource\_name, backendUrl<br />\| transpose row \_timeslice column resource\_identifier|
|Azure API Management|Failed Policy Events|Logs|Installed Apps/Azure API Management/Azure API Management - Policy and Recommendations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} Policy Failure<br />\| JSON "category", "resultType", "properties.message", "properties.resourceLocation", "properties.entity", "properties.policies" as category, resultType, message, resourceLocation, entity, policies<br />\| where category="Policy" and resultType="Failure"<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as time<br />\| count as Count by time, level, resultType, providers, resource\_group, resource\_name, location, policies|
|Azure API Management|Failed Request Details|Logs|Installed Apps/Azure API Management/Azure API Management - Developer Portal|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} DeveloperPortalAuditLogs<br />\| json "category", "properties.requestPath", "properties.serviceName", "resultType","properties.responseCode", "properties.requestMethod" as category, requestPath, serviceName, resultType, responseCode, requestMethod<br />\| where category="DeveloperPortalAuditLogs" and resultType="Failed"<br />\| count as Count by resource\_group, resource\_name, requestPath, serviceName, requestMethod, responseCode|
|Azure API Management|Failed Request Details|Logs|Installed Apps/Azure API Management/Azure API Management - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "properties.responseCode", "properties.apiId", "properties.url", "properties.backendUrl", "properties.backendResponseCode", "properties.method", "properties.userId" as category, responseCode, apiId, url, backendUrl,backendResponseCode, method, userId nodrop<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}" and (responseCode matches  "4\*" or responseCode matches "5\*")<br />\| count as Count by apiId, url, method, responseCode, backendUrl, backendResponseCode<br />\| sort by Count|
|Azure API Management|Failed Requests|Logs|Installed Apps/Azure API Management/Azure API Management - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "isRequestSuccess", "properties.apiId", "properties.url" as category, isRequestSuccess, apiId, url<br />\| where category="GatewayLogs" and isRequestSuccess="false" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| count by resource\_group, resource\_name|
|Azure API Management|Failed Requests|Logs|Installed Apps/Azure API Management/Azure API Management - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "isRequestSuccess", "properties.apiId", "properties.url" as category, isRequestSuccess, apiId, url<br />\| where category="GatewayLogs" and isRequestSuccess="false" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| count by resource\_group, resource\_name|
|Azure API Management|Failed Requests by Method|Logs|Installed Apps/Azure API Management/Azure API Management - Developer Portal|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} DeveloperPortalAuditLogs<br />\| json "category", "properties.requestMethod" as category, requestMethod<br />\| where category="DeveloperPortalAuditLogs" and resultType="Failed"<br />\| count by requestMethod<br />\| sort by \_count, requestMethod|
|Azure API Management|Failed Requests by Method|Logs|Installed Apps/Azure API Management/Azure API Management - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "properties.method", "isRequestSuccess", "properties.apiId", "properties.url" as category, method, isRequestSuccess , apiId, url<br />\| where category="GatewayLogs" and isRequestSuccess="false" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| timeslice 1h<br />\| count by \_timeslice, resource\_group, resource\_name, method<br />\| format("resource\_group=%s resource\_name=%s method=%s", resource\_group, resource\_name, method) as resource\_identifier<br />\| fields - resource\_group, resource\_name, method<br />\| transpose row \_timeslice column resource\_identifier|
|Azure API Management|Failed Requests by Protocol|Logs|Installed Apps/Azure API Management/Azure API Management - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "properties.clientProtocol", "isRequestSuccess", "properties.apiId", "properties.url" as category, clientProtocol, isRequestSuccess , apiId, url<br />\| where category="GatewayLogs" and isRequestSuccess="false" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| timeslice 1h<br />\| count by \_timeslice, resource\_group, resource\_name, clientProtocol<br />\| format("resource\_group=%s resource\_name=%s clientProtocol=%s", resource\_group, resource\_name, clientProtocol) as resource\_identifier<br />\| fields - resource\_group, resource\_name, clientProtocol<br />\| transpose row \_timeslice column resource\_identifier|
|Azure API Management|Failed Requests by Response Category|Logs|Installed Apps/Azure API Management/Azure API Management - Developer Portal|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} DeveloperPortalAuditLogs<br />\| json "category", "properties.responseCode" as category, responseCode<br />\| where category="DeveloperPortalAuditLogs"<br />\| timeslice 10m<br />\| if (responseCode matches "2\*", "sucessfull\_requests", if (responseCode matches "3\*", "redirect\_requests", if (responseCode matches "4\*", "client\_error\_requests", if (responseCode matches "5\*", "server\_error\_requests", "other\_requests")))) as responseCodeCategory<br />\| count by \_timeslice, resource\_group, resource\_name, responseCodeCategory<br />\| format("resource\_group=%s resource\_name=%s responseCodeCategory=%s", resource\_group, resource\_name, responseCodeCategory) as resource\_identifier<br />\| fields - resource\_group, resource\_name, responseCodeCategory<br />\| transpose row \_timeslice column resource\_identifier|
|Azure API Management|Failed Requests by Subscription|Logs|Installed Apps/Azure API Management/Azure API Management - Subscriptions|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category","properties.apimSubscriptionId", "properties.apiId","properties.url", "properties.responseCode" as category, apimSubscriptionId, apiId, url, responseCode<br />\| where category="GatewayLogs" and !(responseCode \>= 200 and responseCode\<=300) and url matches "{{url}}" and apiId matches "{{apiId}}"<br />\| timeslice 1h<br />\| count by \_timeslice, resource\_group, resource\_name, apimSubscriptionId<br />\| format("resource\_group=%s resource\_name=%s apimSubscriptionId=%s", resource\_group, resource\_name, apimSubscriptionId) as resource\_identifier<br />\| fields - resource\_group, resource\_name, apimSubscriptionId<br />\| transpose row \_timeslice column resource\_identifier|
|Azure API Management|Failed Requests by Subscription|Logs|Installed Apps/Azure API Management/Azure API Management - Subscriptions|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category","properties.apimSubscriptionId", "properties.apiId","properties.url", "properties.responseCode" as category, apimSubscriptionId, apiId, url, responseCode<br />\| where category="GatewayLogs" and !(responseCode \>= 200 and responseCode\<=299) and url matches "{{url}}" and apiId matches "{{apiId}}"<br />\| count by resource\_group, resource\_name, apimSubscriptionId|
|Azure API Management|Failed Requests by Url|Logs|Installed Apps/Azure API Management/Azure API Management - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "isRequestSuccess", "properties.apiId", "properties.url" as category, isRequestSuccess , apiId, url<br />\| where category="GatewayLogs" and isRequestSuccess="false" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| timeslice 1h<br />\| count by \_timeslice, resource\_group, resource\_name, url<br />\| format("resource\_group=%s resource\_name=%s backendUrl=%s", resource\_group, resource\_name, url) as resource\_identifier<br />\| fields - resource\_group, resource\_name, url<br />\| transpose row \_timeslice column resource\_identifier|
|Azure API Management|Overall Duration Vs Backend Duration|Logs|Installed Apps/Azure API Management/Azure API Management - Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "durationMs", "properties.apiId", "properties.url" as category, durationMs, apiId, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| timeslice 5m<br />\| avg(durationMs) by \_timeslice|
|Azure API Management|Recent Changes in Subscription|Logs|Installed Apps/Azure API Management/Azure API Management - Subscriptions|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} Administrative<br />\| json "category", "operationName", "identity.claims.idtyp", "identity.claims.name" as category, operationName, idtyp, name<br />\| where category="Administrative" and service\_type = "SUBSCRIPTIONS"<br />\| parse field=operationName "MICROSOFT.APIMANAGEMENT/SERVICE/SUBSCRIPTIONS/\*/\*" as operation\_name, action<br />\| if (idtyp =="user", name, appid) as updated\_by\_user<br />\| count as Count by updated\_by\_user, service\_name, operation\_name|
|Azure API Management|Recent Delete Operations|Logs|Installed Apps/Azure API Management/Azure API Management - Administrative Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name = {{resource\_name}} provider\_name={{provider\_name}} resource\_type={{resource\_type}}  Administrative <br />\| JSON "properties.statusCode", "properties.message", "resultType", "category", "operationName", "callerIpAddress", "resultSignature", "level", "identity.claims.idtyp", "identity.claims.name", "identity.claims.appid", "properties.entity", "\$['identity']['claims']['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name']","\$['identity']['claims']['http://schemas.microsoft.com/claims/authnmethodsreferences']" as statusCode, message, resultType, category, operationName, callerIpAddress, resultSignature, level, idtyp, name, appid, entity, identity\_claims\_name, authmethods nodrop<br />\| where resultType in ("Accept", "Success") and category="Administrative" and toUppercase(operationName) matches /DELETE/ <br />\| if (idtyp =="user", name, appid) as name<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as time<br />\| count by \_messageTime, time, resource\_name, callerIpAddress, name, identity\_claims\_name, authmethods, resultSignature, statusCode, message, entity<br />\| sort by \_messageTime desc<br />\| limit 20 <br />\| fields -\_count,\_messageTime|
|Azure API Management|Recent Recommendation Events|Logs|Installed Apps/Azure API Management/Azure API Management - Policy and Recommendations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} Recommendation<br />\| JSON "category", "operationName", "resultType", "properties.recommendationName", "properties.recommendationCategory", "properties.recommendationImpact", "properties.recommendationResourceLink" as category, operationName, resultType, recommendationName, recommendationCategory, recommendationImpact, recommendationResourceLink <br />\| where category="Recommendation"<br />\| parse field=operationName "\*/\*/\*/\*" as provider, category, operation\_name, action nodrop<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as time<br />\| count as Count by time, operation\_name, resource\_name, resultType, recommendationName, recommendationCategory, recommendationImpact, recommendationResourceLink|
|Azure API Management|Recent Write Operations|Logs|Installed Apps/Azure API Management/Azure API Management - Administrative Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name = {{resource\_name}} provider\_name={{provider\_name}} resource\_type={{resource\_type}}  Administrative <br />\| JSON "properties.statusCode", "properties.message", "resultType", "category", "operationName", "callerIpAddress", "resultSignature", "level", "identity.claims.idtyp", "identity.claims.name", "identity.claims.appid", "\$['identity']['claims']['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name']","\$['identity']['claims']['http://schemas.microsoft.com/claims/authnmethodsreferences']"  as statusCode, message, resultType, category, operationName, callerIpAddress, resultSignature, level, idtyp, name, appid, identity\_claims\_name, authmethods nodrop<br />\| where category="Administrative" and resultType in ("Accept", "Success") and toUppercase(operationName) matches /WRITE/<br />\| if (idtyp =="user", name, appid) as name<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as time<br />\| count by \_messageTime, time, resource\_name, callerIpAddress, name, identity\_claims\_name, authmethods, resultSignature, statusCode, message<br />\| sort by \_messageTime desc<br />\| limit 20 <br />\| fields -\_count,\_messageTime|
|Azure API Management|Request Duration by Method|Logs|Installed Apps/Azure API Management/Azure API Management - Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "durationMs", "properties.method", "properties.apiId", "properties.url" as category, durationMs, method, apiId, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| timeslice 1h<br />\| avg(durationMs) by \_timeslice, resource\_group, resource\_name, method<br />\| format("resource\_group=%s resource\_name=%s method=%s", resource\_group, resource\_name, method) as resource\_identifier<br />\| fields - resource\_group, resource\_name, method<br />\| transpose row \_timeslice column resource\_identifier|
|Azure API Management|Request Duration by Subscription|Logs|Installed Apps/Azure API Management/Azure API Management - Subscriptions|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "durationMs", "properties.apimSubscriptionId", "properties.method", "properties.apiId", "properties.url" as category, durationMs, subscription, method, apiId, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| timeslice 1h<br />\| avg(durationMs) by \_timeslice, resource\_group, resource\_name, subscription<br />\| format("resource\_group=%s resource\_name=%s subscription=%s", resource\_group, resource\_name, subscription) as resource\_identifier<br />\| fields - resource\_group, resource\_name, subscription<br />\| transpose row \_timeslice column resource\_identifier|
|Azure API Management|Request Duration by Url|Logs|Installed Apps/Azure API Management/Azure API Management - Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "durationMs", "properties.apiId", "properties.url" as category, durationMs, apiId, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| timeslice 1h<br />\| avg(durationMs) by \_timeslice, resource\_group, resource\_name, url<br />\| format("resource\_group=%s resource\_name=%s url=%s", resource\_group, resource\_name, url) as resource\_identifier<br />\| fields - resource\_group, resource\_name, url<br />\| transpose row \_timeslice column resource\_identifier|
|Azure API Management|Requests by Backend Response Code|Logs|Installed Apps/Azure API Management/Azure API Management - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "properties.backendResponseCode", "properties.apiId", "properties.url" as category, backendResponseCode, apiId, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| count by backendResponseCode<br />\| sort by \_count, backendResponseCode asc|
|Azure API Management|Requests by Location|Logs|Installed Apps/Azure API Management/Azure API Management - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "callerIpAddress", "properties.apiId", "properties.url" as category, callerIpAddress, apiId, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| extract field=callerIpAddress "(?\<request\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| count by request\_ip<br />\| lookup latitude, longitude from geo://location on ip = request\_ip<br />\| where !isNull(latitude)<br />\| sum(\_count) as count by latitude, longitude|
|Azure API Management|Requests by Response Code|Logs|Installed Apps/Azure API Management/Azure API Management - Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "properties.responseCode", "properties.apiId", "properties.url" as category, responseCode, apiId, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| timeslice 1h<br />\| if (responseCode matches "2\*", "sucessfull\_requests", if (responseCode matches "3\*", "redirect\_requests", if (responseCode matches "4\*", "client\_error\_requests", if (responseCode matches "5\*", "server\_error\_requests", "other\_requests")))) as responseCodeCategory<br />\| count by \_timeslice, resource\_group, resource\_name, responseCodeCategory<br />\| format("resource\_group=%s resource\_name=%s responseCodeCategory=%s", resource\_group, resource\_name, responseCodeCategory) as resource\_identifier<br />\| fields - resource\_group, resource\_name, responseCodeCategory<br />\| transpose row \_timeslice column resource\_identifier|
|Azure API Management|Requests by Response Code|Logs|Installed Apps/Azure API Management/Azure API Management - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "properties.responseCode", "properties.apiId", "properties.url" as category, responseCode, apiId, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| count by responseCode<br />\| sort by \_count, responseCode asc|
|Azure API Management|Requests by Response Code|Logs|Installed Apps/Azure API Management/Azure API Management - Developer Portal|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} DeveloperPortalAuditLogs<br />\| json "category", "properties.responseCode" as category, responseCode<br />\| where category="DeveloperPortalAuditLogs"<br />\| count by responseCode<br />\| sort by \_count, responseCode asc|
|Azure API Management|Requests by Result Type|Logs|Installed Apps/Azure API Management/Azure API Management - Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "resultType", "properties.apiId", "properties.url" as category, resultType, apiId, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| timeslice 1h<br />\| count by \_timeslice, resource\_group, resource\_name, resultType<br />\| format("resource\_group=%s resource\_name=%s resultType=%s", resource\_group, resource\_name, resultType) as resource\_identifier<br />\| fields - resource\_group, resource\_name, resultType<br />\| transpose row \_timeslice column resource\_identifier|
|Azure API Management|Requests by Subscription|Logs|Installed Apps/Azure API Management/Azure API Management - Subscriptions|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category","properties.apimSubscriptionId", "properties.apiId", "properties.url" as category, apimSubscriptionId, apiId, url<br />\| where category="GatewayLogs" and url matches "{{url}}" and apiId matches "{{apiId}}"<br />\| timeslice 1h<br />\| count by \_timeslice, resource\_group, resource\_name, apimSubscriptionId<br />\| format("resource\_group=%s resource\_name=%s apimSubscriptionId=%s", resource\_group, resource\_name, apimSubscriptionId) as resource\_identifier<br />\| fields - resource\_group, resource\_name, apimSubscriptionId<br />\| transpose row \_timeslice column resource\_identifier|
|Azure API Management|Requests Summary by API|Logs|Installed Apps/Azure API Management/Azure API Management - Overview|tenant\_name=\* subscription\_id=\* resource\_group=\* resource\_name=\* resource\_type=SERVICE provider\_name=MICROSOFT.APIMANAGEMENT location=\* GatewayLogs<br />\| json "category", "isRequestSuccess", "properties.apiId", "durationMs", "properties.requestSize", "properties.responseSize", "properties.url", "properties.userId" as category, isRequestSuccess, apiId, durationMs, requestSize, responseSize, url, userId<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| if (isRequestSuccess matches "false", 1, 0) as is\_failed\_request<br />\| count as total\_requests, sum(is\_failed\_request) as failed\_requests,  avg(durationMs) as avg\_duration\_seconds, max(durationMs) as max\_duration\_seconds, avg(requestSize) as avg\_request\_size\_mb, max(requestSize) as max\_request\_size\_mb, avg(responseSize) as avg\_response\_size\_mb, max(responseSize) as max\_response\_size\_mb by apiId<br />\| round((avg\_duration\_seconds / 1000), 3) as avg\_duration\_seconds<br />\| round((max\_duration\_seconds / 1000), 3) as max\_duration\_seconds<br />\| round((avg\_request\_size\_mb / 1024 / 1024), 3) as avg\_request\_size\_mb<br />\| round((avg\_response\_size\_mb / 1024 / 1024), 3) as avg\_response\_size\_mb<br />\| round((max\_request\_size\_mb / 1024 / 1024), 3) as max\_request\_size\_mb<br />\| round((max\_response\_size\_mb / 1024 / 1024), 3) as max\_response\_size\_mb|
|Azure API Management|Success Requests vs Failed Requests|Logs|Installed Apps/Azure API Management/Azure API Management - Developer Portal|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} DeveloperPortalAuditLogs<br />\| json "category", "resultType" as category, resultType<br />\| where category="DeveloperPortalAuditLogs" and resultType="Succeeded"<br />\| timeslice 10m<br />\| count by \_timeslice|
|Azure API Management|Successful Requests by Client Protocol|Logs|Installed Apps/Azure API Management/Azure API Management - Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "properties.clientProtocol", "isRequestSuccess", "properties.apiId", "properties.url" as category, clientProtocol, isRequestSuccess, apiId, url<br />\| where category="GatewayLogs" and isRequestSuccess="true" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| timeslice 1h<br />\| count by \_timeslice, resource\_group, resource\_name, clientProtocol<br />\| format("resource\_group=%s resource\_name=%s clientProtocol=%s", resource\_group, resource\_name, clientProtocol) as resource\_identifier<br />\| fields - resource\_group, resource\_name, clientProtocol<br />\| transpose row \_timeslice column resource\_identifier|
|Azure API Management|Successful Requests by Method|Logs|Installed Apps/Azure API Management/Azure API Management - Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "properties.method", "isRequestSuccess", "properties.apiId", "properties.url" as category, method, isRequestSuccess, apiId, url<br />\| where category="GatewayLogs" and isRequestSuccess="true" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| timeslice 1h<br />\| count by \_timeslice, resource\_group, resource\_name, method<br />\| format("resource\_group=%s resource\_name=%s method=%s", resource\_group, resource\_name, method) as resource\_identifier<br />\| fields - resource\_group, resource\_name, method<br />\| transpose row \_timeslice column resource\_identifier|
|Azure API Management|Top 10 APIs With Highest Backend Execution Duration (ms)|Logs|Installed Apps/Azure API Management/Azure API Management - Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "properties.backendTime", "properties.apiId", "properties.url" as category, backendTime, apiId, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| avg(backendTime) as avgBackendTime, pct(backendTime, 75) as p75BackendTime, pct(backendTime, 95) as p95BackendTime, pct(backendTime, 99) as p99BackendTime, max(backendTime) as maxBackendTime by resource\_group, resource\_name, url<br />\| sort by maxBackendTime<br />\| limit 10|
|Azure API Management|Top 10 APIs With Highest Number of Requests|Logs|Installed Apps/Azure API Management/Azure API Management - Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "properties.backendTime", "properties.apiId", "properties.url" as category, backendTime, apiId, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| count as Count by resource\_group, resource\_name, url<br />\| sort by Count<br />\| limit 10|
|Azure API Management|Top 10 Failed API Urls|Logs|Installed Apps/Azure API Management/Azure API Management - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "isRequestSuccess", "properties.backendResponseCode", "properties.url", "properties.apiId" as category, isRequestSuccess, backendResponseCode, url, apiId<br />\| where category="GatewayLogs" and !(backendResponseCode \>= 200 and backendResponseCode\<=300) and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| count by url<br />\| sort by \_count<br />\| limit 10|
|Azure API Management|Top 10 Failed Subscription|Logs|Installed Apps/Azure API Management/Azure API Management - Subscriptions|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category","properties.apimSubscriptionId", "properties.url", "properties.method", "properties.responseCode", "properties.apiId"  as category, apimSubscriptionId, url, method, responseCode, apiId<br />\| where category="GatewayLogs" and !(responseCode \>= 200 and responseCode\<=300) and url matches "{{url}}" and apiId matches "{{apiId}}"<br />\| count as Count by resource\_group, resource\_name, apimSubscriptionId, url, method, responseCode<br />\| sort by Count<br />\| limit 10|
|Azure API Management|Top 10 Operations That Caused The Most Errors|Logs|Installed Apps/Azure API Management/Azure API Management - Administrative Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name = {{resource\_name}} provider\_name={{provider\_name}} resource\_type={{resource\_type}}  Administrative<br />\| json "resultType", "operationName", "properties.statusMessage", "category"  as resultType, operationName, failureMessage, category nodrop<br />\| parse field=operationname "\*/\*/\*" as provider\_name, resource\_type, operation nodrop<br />\| where category="Administrative" and (resultType="Failure" or resultType="Unknown")<br />\| if (isBlank(failureMessage), "Unknown Error", failureMessage) as failureMessage<br />\| count as Count by resource\_name, operation, failureMessage<br />\| order by Count <br />\| limit 10|
|Azure API Management|Top 3 Caller IPs With Failures by Resource|Logs|Installed Apps/Azure API Management/Azure API Management - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "isRequestSuccess", "properties.apiId", "properties.url", "callerIpAddress" as category, isRequestSuccess, apiId, url, callerIpAddress<br />\| where category="GatewayLogs" and isRequestSuccess="false" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| count as Count by resource\_group, resource\_name, callerIpAddress<br />\| topk(3, Count) by resource\_group, resource\_name|
|Azure API Management|Top Backend Url by Request Size|Logs|Installed Apps/Azure API Management/Azure API Management - Overview|tenant\_name=\* subscription\_id=\* resource\_group=\* resource\_name=\* resource\_type=SERVICE provider\_name=microsoft.apimanagement location=\* GatewayLogs<br />\| json "category", "properties.apiId", "properties.operationId", "properties.backendUrl", "properties.requestSize", "properties.url" as category, apiId, operationId, backendUrl, requestSize, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| requestSize/1024 as requestSize<br />\| sum(requestSize) as total\_request\_KB, pct(requestSize, 75) as p75\_request\_KB, pct(requestSize, 99) as p99\_request\_KB, max(requestSize) as max\_request\_KB by resource\_group, resource\_name, apiId, operationId, backendUrl<br />\| sort by total\_request\_KB desc|
|Azure API Management|Top Backend Urls with Response Size|Logs|Installed Apps/Azure API Management/Azure API Management - Overview|tenant\_name=\* subscription\_id=\* resource\_group=\* resource\_name=\* resource\_type=SERVICE provider\_name=microsoft.apimanagement location=\* GatewayLogs<br />\| json "category", "properties.apiId", "properties.operationId", "properties.backendUrl", "properties.responseSize", "properties.url" as category, apiId, operationId, backendUrl, responseSize, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| responseSize/1024 as responseSize<br />\| sum(responseSize) as total\_response\_KB, pct(responseSize, 75) as p75\_response\_KB, pct(responseSize, 99) as p99\_response\_KB, max(responseSize) as max\_response\_KB by resource\_group, resource\_name, apiId, operationId, backendUrl<br />\| sort by total\_response\_KB desc|
|Azure API Management|Top Operations with Request Size|Logs|Installed Apps/Azure API Management/Azure API Management - Overview|tenant\_name=\* subscription\_id=\* resource\_group=\* resource\_name=\* resource\_type=SERVICE provider\_name=microsoft.apimanagement location=\* GatewayLogs<br />\| json "category", "properties.apiId", "properties.operationId", "properties.requestSize", "properties.url" as category, apiId, operationId, requestSize, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| sum(requestSize) as total\_request\_bytes by resource\_group, resource\_name, apiId, operationId<br />\| sort by total\_request\_bytes desc|
|Azure API Management|Top Operations with Response Size|Logs|Installed Apps/Azure API Management/Azure API Management - Overview|tenant\_name=\* subscription\_id=\* resource\_group=\* resource\_name=\* resource\_type=SERVICE provider\_name=microsoft.apimanagement location=\* GatewayLogs<br />\| json "category", "properties.apiId", "properties.operationId", "properties.responseSize", "properties.url" as category, apiId, operationId, responseSize, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| sum(responseSize) as total\_response\_bytes by resource\_group, resource\_name, apiId, operationId<br />\| sort by total\_response\_bytes desc|
|Azure API Management|Total Failed Policy Events|Logs|Installed Apps/Azure API Management/Azure API Management - Policy and Recommendations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} Policy Failure<br />\| JSON "category", "resultType" as category, resultType<br />\| where category="Policy" and resultType="Failure"<br />\| count as Count|
|Azure API Management|Total Failed Requests|Logs|Installed Apps/Azure API Management/Azure API Management - Developer Portal|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} DeveloperPortalAuditLogs<br />\| json "category", "resultType" as category, resultType<br />\| where category="DeveloperPortalAuditLogs" and resultType="Failed"<br />\| count by resource\_group, resource\_name|
|Azure API Management|Total Recommendation Events|Logs|Installed Apps/Azure API Management/Azure API Management - Policy and Recommendations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} Recommendation<br />\| JSON "category"<br />\| where category="Recommendation"<br />\| count |
|Azure API Management|Total Requests|Metrics|Installed Apps/Azure API Management/Azure API Management - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}}<br />metric=Requests statistic=total \| quantize using sum \| avg by resource\_name, resource\_type |
|Azure API Management|Total Requests by Method|Logs|Installed Apps/Azure API Management/Azure API Management - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "properties.method", "properties.apiId", "properties.url" as category, method, apiId, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| count by method<br />\| sort by \_count, method asc|
|Azure API Management|Total Requests by Response Code|Logs|Installed Apps/Azure API Management/Azure API Management - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category", "properties.responseCode", "properties.apiId", "properties.url" as category, responseCode, apiId, url<br />\| where category="GatewayLogs" and apiId matches "{{apiId}}" and url matches "{{url}}"<br />\| count by responseCode<br />\| sort by \_count, responseCode asc|
|Azure API Management|Total Requests by Subscription|Logs|Installed Apps/Azure API Management/Azure API Management - Subscriptions|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} GatewayLogs<br />\| json "category","properties.apimSubscriptionId", "properties.apiId","properties.url" as category, apimSubscriptionId, apiId, url<br />\| where category="GatewayLogs" and url matches "{{url}}" and apiId matches "{{apiId}}"<br />\| count by resource\_group, resource\_name, apimSubscriptionId|
|Azure API Management|Total Success Policy Events|Logs|Installed Apps/Azure API Management/Azure API Management - Policy and Recommendations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} Policy Success<br />\| JSON "category", "resultType", "properties.message", "properties.resourceLocation", "properties.entity", "properties.policies" as category, resultType, message, resourceLocation, entity, policies<br />\| parse field=entity "/subscriptions/\*/resourceGroups/\*/providers/\*/\*/\*" as subscription\_id, resource\_group, providers, virtualMachineScaleSets, aks nodrop<br />\| where category="Policy" and (resultType="Success" or resultType="Accept")<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as time<br />\| count as Count by time, level, resultType, resource\_group, resource\_name, location, policies|
|Azure API Management|Total Success Policy Events|Logs|Installed Apps/Azure API Management/Azure API Management - Policy and Recommendations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} Policy <br />\| JSON "category", "resultType" as category, resultType<br />\| where category="Policy" and (resultType="Success" or resultType="Accept")<br />\| count as Count|
|Azure API Management|Total Success Requests|Logs|Installed Apps/Azure API Management/Azure API Management - Developer Portal|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} DeveloperPortalAuditLogs<br />\| json "category", "resultType" as category, resultType<br />\| where category="DeveloperPortalAuditLogs" and resultType="Succeeded"<br />\| count by resource\_group, resource\_name|
|Azure API Management|Users / Applications by Operation type|Logs|Installed Apps/Azure API Management/Azure API Management - Administrative Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name={{resource\_name}} provider\_name={{provider\_name}} resource\_type={{resource\_type}} Administrative <br />\| JSON "properties.statusCode", "properties.message", "resultType", "category", "operationName", "callerIpAddress", "resultSignature", "level", "identity.claims.idtyp", "identity.claims.name", "identity.claims.appid" as statusCode, message, resultType, category, operationName, callerIpAddress, resultSignature, level, idtyp, name, appid nodrop<br />\| where resultType in ("Accept", "Success") and category="Administrative" <br />\| if (idtyp =="user", name, appid) as name<br />\| "Others" as operationType<br />\| if (toUppercase(operationName) matches /WRITE/, "WRITE", operationType) as operationType <br />\| if (toUppercase(operationName) matches /READ/, "READ", operationType) as operationType <br />\| if (toUppercase(operationName) matches /DELETE/, "DELETE", operationType) as operationType <br />\| count by name, operationType<br />\| transpose row name column operationType|
|Azure API Management|Websocket Connection Details|Logs|Installed Apps/Azure API Management/Azure API Management - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} WebSocketConnectionLogs<br />\| json "category", "properties.source", "properties.destination", "properties.eventName" as category, source, destination, eventName<br />\| where category="WebSocketConnectionLogs"<br />\| count by resource\_group, resource\_name, source, destination, eventName|
|Azure API Management|Websocket Connections by Event Name|Logs|Installed Apps/Azure API Management/Azure API Management - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} WebSocketConnectionLogs<br />\| json "category", "properties.eventName" as category, eventName<br />\| where category="WebSocketConnectionLogs"<br />\| count by eventName<br />\| sort by \_count, eventName|

