# AWS Config
## Sumo Logic App For: AWS Config
Amazon Web Services (AWS) Config provides a simple web services interface that can be used to track modifications made to the resources that belong to an AWS account. The Sumo Logic App for AWS Config presents modification notifications that contain snapshots of resource configurations and information about the modifications made to a resource.The app uses predefined Live and Interactive Dashboards and filters, which provide visibility into your environment for real-time analysis of overall usage.
Docs Link: [AWS Config](https://help.sumologic.com/?cid=1060)

## Searches

### Log Searches

- **Configuration Trend**: from Search: AWS Config/Configuration Trend 
- **Latest Resource Modifications**: from Search: AWS Config/Latest Resource Modifications 
- **Most Frequently Modified Resource Types (with latest update)**: from Search: AWS Config/Most Frequently Modified Resource Types (with latest update) 
- **Most Frequently Modified Resources (with latest update)**: from Search: AWS Config/Most Frequently Modified Resources (with latest update) 
- **Relationships**: from Search: AWS Config/Relationships 
- **ResourceNames Lookup Table Generator**: from Search: AWS Config/ResourceNames Lookup Table Generator

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|AWS Config|Configuration Trend|Logs|AWS Config/Configuration Trend|\_sourceCategory = Labs/AWS/Config Notification ConfigurationItemChangeNotification<br />\| json "Message", "Type" <br />\| where type == "Notification"<br />\| json field=message "messageType","configurationItem" as messageType, single\_message <br />\| where messageType = "ConfigurationItemChangeNotification" <br />\| json field=single\_message "resourceId", "resourceType", "awsRegion", "awsAccountId", "configurationItemStatus"<br />\| timeslice 1d<br />\| count by \_timeslice, resourceType<br />\| transpose row \_timeslice column resourceType|
|AWS Config|Latest Resource Modifications|Logs|AWS Config/Latest Resource Modifications|\_sourceCategory = Labs/AWS/Config Notification ConfigurationItemChangeNotification<br />\| json "Message", "Type" <br />\| where type == "Notification"<br />\| json field=message "messageType","configurationItem" as messageType, single\_message <br />\| where messageType = "ConfigurationItemChangeNotification" <br />\| json field=single\_message "resourceId", "resourceType", "configurationItemStatus", "awsAccountId" as ResourceId, ResourceType, Status, AWSAccountID<br />//\| where Status = "OK"<br />// Look up Name stored in tag with key “Name” for each resource. Schedule the ‘ResourceNames Lookup Table Generator’ search to keep this file up to date.<br />//\| lookup idAndName from /shared/AWSConfig/ResourceNames on resourceType=resourceType, resourceId=resourceId \| if(isNull(idAndName), resourceId, idAndName) as resourceId \| fields - idAndName<br />\| sort by \_messageTime desc|
|AWS Config|Most Frequently Modified Resource Types (with latest update)|Logs|AWS Config/Most Frequently Modified Resource Types (with latest update)|\_sourceCategory = Labs/AWS/Config Notification ConfigurationItemChangeNotification<br />\| count by \_raw, \_messageTime<br />\| json "Message", "Type" <br />\| where type == "Notification"<br />\| json field=message "messageType","configurationItem" as messageType, single\_message <br />\| where messageType = "ConfigurationItemChangeNotification" <br />\| json field=single\_message "resourceId", "resourceType", "awsAccountId" as ResourceId, ResourceType, awsAccountId<br />// Use total to get the number of modifications<br />\| 1 as row\_num <br />\| total row\_num as modifications by resourceType<br />// Use accum to get a row number by resource ID, and sum up the number of resource IDs for each type<br />\| 1 as resource\_num <br />\| accum resource\_num as resource\_num by resourceId <br />\| if (resource\_num = 1, 1, 0) as resource\_num <br />\| total resource\_num as ResourcesModified by resourceType <br />// Concat the data back together so we can use withtime/most\_recent to find only the most recent modification<br />\| sort by \_messageTime desc <br />\| accum row\_num as row\_num by resourceType <br />\| where row\_num = 1<br />// These numbers appear as floats, we want integers<br />\| floor(Modifications) <br />\| floor(ResourcesModified)<br />// Look up Name stored in tag with key “Name” for each resource. Schedule the ‘ResourceNames Lookup Table Generator’ search to keep this file up to date.<br />//\| lookup idAndName from /shared/AWSConfig/ResourceNames on resourceType=resourceType, resourceId=resourceId \| if(isNull(idAndName), resourceId, idAndName) as ResourceId<br />\| formatDate(\_messageTime) as MostRecentModification<br />\| fields -\_raw, \_messageTime<br />\| fields(resourceType,  Modifications, ResourcesModified, MostRecentModification, awsAccountId, ResourceId)<br />\| sort by modifications desc, resourcesModified desc|
|AWS Config|Most Frequently Modified Resources (with latest update)|Logs|AWS Config/Most Frequently Modified Resources (with latest update)|\_sourceCategory = Labs/AWS/Config Notification ConfigurationItemChangeNotification<br />// Accum must be used after the first grouping expression in a dashboard<br />\| count by \_raw, \_messageTime<br />\| json field=\_raw "Message", "Type" <br />\| where type == "Notification"<br />\| json field=message "messageType","configurationItem" as messageType, single\_message <br />\| where messageType = "ConfigurationItemChangeNotification" <br />\| json field=single\_message "resourceId", "resourceType", "configurationItemStatus", "awsAccountId" as ResourceId, ResourceType, LastModifiedStatus, LastModifiedAccountID<br />// Count the number of records per resource ID<br />\| 1 as modifications <br />\| total modifications as modifications by resourceId<br />// Use accum as a row numbering in order to select the most recent record<br />\| 1 as row\_num <br />\| sort by \_messageTime desc, lastmodifiedstatus asc <br />\| accum row\_num as row\_num by ResourceId <br />\| where row\_num = 1<br />\| formatDate(\_messageTime) as LastModifiedTime <br />\| floor(Modifications)<br />\| sort by modifications desc, \_messageTime desc<br />\| fields - \_messageTime, \_raw<br />// Look up Name stored in tag with key “Name” for each resource. Schedule the ‘ResourceNames Lookup Table Generator’ search to keep this file up to date.<br />//\| lookup idAndName from /shared/AWSConfig/ResourceNames on resourceType=resourceType, resourceId=resourceId \| if(isNull(idAndName), resourceId, idAndName) as resourceId \| fields - idAndName<br />\| fields resourceType, resourceId, Modifications, LastModifiedTime, LastModifiedAccountId, LastModifiedStatus|
|AWS Config|Relationships|Logs|AWS Config/Relationships|\_sourceCategory = Labs/AWS/Config Notification ConfigurationItemChangeNotification<br />// Having a grouping expression moves results into the aggregates tab, where we have more control over its display.<br />\| count by \_raw, \_messageTime<br />\| json field=\_raw "Message", "Type" <br />\| where type == "Notification"<br />\| json field=message "messageType","configurationItem" as messageType, single\_message <br />\| where messageType = "ConfigurationItemChangeNotification" <br />\| json field=single\_message "resourceId", "resourceType", "configurationItemStatus", "awsAccountId", "relationships" as ResourceId, ResourceType, Status, AWSAccountID, Relationships nodrop<br />// Use a where clause to filter by resourceType. Supported resource types can be found here: http://docs.aws.amazon.com/config/latest/developerguide/resource-config-reference.html<br />// \| where resourceType = "AWS::EC2::Instance"<br />// Use accum as a row numbering in order to select the most recent record<br />\| 1 as row\_num <br />\| sort by \_messageTime desc, status asc <br />\| accum row\_num as row\_num by ResourceId <br />\| where row\_num = 1<br />// If the most recent record is 'Deleted', the resource has been deleted and we do not want to display any "current" relationships<br />\| where Status != "ResourceDeleted"<br />// Split out each relationship into a record<br />\| parse regex field=relationships "(?\<single\_relationship\>\\{\\"resourceId\\"\\:.\*?\\})((?=,\\{\\"resourceId\\")\|(?=\\]\\s\*\$))" multi<br />\| json field=single\_relationship "resourceId", "name", "resourceType" as relatedResourceId, relationship, relatedResourceType<br />\| sort by resourceType asc, resourceId asc, relationship asc <br />\| fields - \_raw, \_messageTime<br />// Look up the Resource Name stored in a shared file via a scheduled query. Schedule the ‘ResourceNames Lookup Table Generator’ search to keep this file up to date.<br />//\| lookup idAndName from /shared/AWSConfig/ResourceNames on resourceType=relatedResourceType, resourceId=relatedResourceId \| if(isNull(idAndName), relatedResourceId, idAndName) as relatedResourceId<br />//\| lookup idAndName from /shared/AWSConfig/ResourceNames on resourceType=resourceType, resourceId=resourceId \| if(isNull(idAndName), resourceId, idAndName) as ResourceId<br />\| fields (resourceType, resourceId, relationship, relatedResourceType, relatedResourceId)|
|AWS Config|ResourceNames Lookup Table Generator|Logs|AWS Config/ResourceNames Lookup Table Generator|\_sourceCategory = Labs/AWS/Config Notification ConfigurationItemChangeNotification<br />\| json "Message", "Type" <br />\| where type == "Notification"<br />\| json field=message "messageType","configurationItem" as messageType, single\_message <br />\| where messageType = "ConfigurationItemChangeNotification" <br />\| json field=single\_message "resourceId", "resourceType", "configurationItemStatus", "tags.Name" as ResourceId, ResourceType, Status, Name nodrop<br />// Use accum as a row numbering in order to select the most recent record<br />\| 1 as row\_num <br />\| sort by \_messageTime desc, status asc <br />\| accum row\_num as row\_num by ResourceId <br />\| where row\_num = 1 \| fields - row\_num<br />\| concat (" \| ", Name, " ") as idAndName <br />\| if(idAndName matches " \| \* ", "", idAndName) as idAndName<br />\| concat (resourceId, idAndName) as idAndName<br />\| count by resourceId, resourceType, idAndName <br />\| fields - \_count<br />\| save append /Shared/AWSConfig/ResourceNames|

