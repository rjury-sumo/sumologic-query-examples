# Apache
## Sumo Logic App For: Apache
The Apache app is a unified logs and metrics app that helps you monitor the availability, performance, health and resource utilization of Apache web server farms. Preconfigured dashboards and searches provide insight into visitor locations, visitor access types, traffic patterns, errors, web server operations, resource utilization and access from known malicious sources.
Docs Link: [Apache](https://help.sumologic.com/?cid=5029)

## Searches

### Log Searches

- **4xx Status Codes by Server**: from Dashboard: Apache/Apache - Overview 
- **5xx Status Codes by Server**: from Dashboard: Apache/Apache - Overview 
- **Apache - All HTTP Response codes with their count**: from Search: Apache/Logs/Searches/Apache - All HTTP Response codes with their count 
- **Apache - Client Errors (4xx response codes) per day**: from Search: Apache/Logs/Searches/Apache - Client Errors (4xx response codes) per day 
- **Apache - Critical log messages**: from Search: Apache/Logs/Searches/Apache - Critical log messages 
- **Apache - HTTP status code summary over time**: from Search: Apache/Logs/Searches/Apache - HTTP status code summary over time 
- **Apache - Log Level counts**: from Search: Apache/Logs/Searches/Apache - Log Level counts 
- **Apache - Malicious URL requests**: from Search: Apache/Logs/Searches/Apache - Malicious URL requests 
- **Apache - Robots**: from Search: Apache/Logs/Searches/Apache - Robots 
- **Apache - Server start and stop events**: from Search: Apache/Logs/Searches/Apache - Server start and stop events 
- **Apache - Server stops and starts over time**: from Search: Apache/Logs/Searches/Apache - Server stops and starts over time 
- **Apache - Slowest URLs by average time**: from Search: Apache/Logs/Searches/Apache - Slowest URLs by average time 
- **Apache - Time taken to serve requests**: from Search: Apache/Logs/Searches/Apache - Time taken to serve requests 
- **Apache - Top 404 referrers**: from Search: Apache/Logs/Searches/Apache - Top 404 referrers 
- **Apache - Top browsers**: from Search: Apache/Logs/Searches/Apache - Top browsers 
- **Apache - Top clients**: from Search: Apache/Logs/Searches/Apache - Top clients 
- **Apache - Top clients causing errors responses**: from Search: Apache/Logs/Searches/Apache - Top clients causing errors responses 
- **Apache - Top error reasons**: from Search: Apache/Logs/Searches/Apache - Top error reasons 
- **Apache - Top files causing errors**: from Search: Apache/Logs/Searches/Apache - Top files causing errors 
- **Apache - Top Referrers causing errors**: from Search: Apache/Logs/Searches/Apache - Top Referrers causing errors 
- **Apache - Top URLs by bytes served**: from Search: Apache/Logs/Searches/Apache - Top URLs by bytes served 
- **Apache - Traffic volume and bytes served per day**: from Search: Apache/Logs/Searches/Apache - Traffic volume and bytes served per day 
- **Browsers and Operating Systems**: from Dashboard: Apache/Logs/Apache - Visitor Access Types 
- **Bytes Served**: from Dashboard: Apache/Logs/Apache - Visitor Traffic Insight 
- **Bytes Served - Outlier**: from Dashboard: Apache/Logs/Apache - Outlier Analysis 
- **Client Errors**: from Dashboard: Apache/Logs/Apache - Outlier Analysis 
- **Client Locations - 4xx Errors**: from Dashboard: Apache/Logs/Apache - Web Server Operations 
- **Client Locations with Critical Errors**: from Dashboard: Apache/Logs/Apache - Error Log Analysis 
- **Critical Error Messages**: from Dashboard: Apache/Apache - Overview 
- **Critical Errors**: from Dashboard: Apache/Logs/Apache - Error Log Analysis 
- **Desktop OS Versions**: from Dashboard: Apache/Logs/Apache - Visitor Access Types 
- **Error Log Levels**: from Dashboard: Apache/Logs/Apache - Web Server Operations 
- **Error Log Levels**: from Dashboard: Apache/Logs/Apache - Error Log Analysis 
- **Error Responses by Server**: from Dashboard: Apache/Logs/Apache - Web Server Operations 
- **Highly Malicious Threats**: from Dashboard: Apache/Logs/Apache - Threat Analysis 
- **HTTP Methods**: from Dashboard: Apache/Logs/Apache - Visitor Traffic Insight 
- **Log Level - One Day Time Comparison**: from Dashboard: Apache/Logs/Apache - Error Log Analysis 
- **Log Reduce**: from Dashboard: Apache/Logs/Apache - Error Log Analysis 
- **Media Types Served**: from Dashboard: Apache/Logs/Apache - Visitor Traffic Insight 
- **Messages by Log Level - Over Time**: from Dashboard: Apache/Logs/Apache - Error Log Analysis 
- **Non 200 Response Status Codes**: from Dashboard: Apache/Logs/Apache - Web Server Operations 
- **Number of Hits by Server - One Day Time Comparison**: from Dashboard: Apache/Logs/Apache - Trends 
- **Number of Requests by Client - One Day Time Comparison**: from Dashboard: Apache/Logs/Apache - Error Log Analysis 
- **Number of Visitors**: from Dashboard: Apache/Logs/Apache - Outlier Analysis 
- **Popular Mobile Device Versions**: from Dashboard: Apache/Logs/Apache - Visitor Access Types 
- **Responses Over Time**: from Dashboard: Apache/Logs/Apache - Trends 
- **Responses Over Time**: from Dashboard: Apache/Apache - Overview 
- **Server Errors**: from Dashboard: Apache/Logs/Apache - Outlier Analysis 
- **Server Errors Over Time**: from Dashboard: Apache/Logs/Apache - Web Server Operations 
- **Threat Count**: from Dashboard: Apache/Logs/Apache - Threat Analysis 
- **Threat Locations**: from Dashboard: Apache/Logs/Apache - Threat Analysis 
- **Threats by Actors**: from Dashboard: Apache/Logs/Apache - Threat Analysis 
- **Threats by Malicious Confidence**: from Dashboard: Apache/Logs/Apache - Threat Analysis 
- **Threats by Source**: from Dashboard: Apache/Logs/Apache - Threat Analysis 
- **Top 10 Bots Observed**: from Dashboard: Apache/Logs/Apache - Web Server Operations 
- **Top 10 Errors from Error Log Files**: from Dashboard: Apache/Logs/Apache - Web Server Operations 
- **Top 10 Messages**: from Dashboard: Apache/Logs/Apache - Error Log Analysis 
- **Top 10 Search Terms from Popular Search Engines**: from Dashboard: Apache/Logs/Apache - Visitor Traffic Insight 
- **Top 10 Threats**: from Dashboard: Apache/Logs/Apache - Threat Analysis 
- **Top 10 URLs with 4xx Errors**: from Dashboard: Apache/Apache - Overview 
- **Top 10 URLs with 5xx Errors**: from Dashboard: Apache/Apache - Overview 
- **Top 5 Clients Causing 4xx Errors**: from Dashboard: Apache/Logs/Apache - Web Server Operations 
- **Top 5 Clients Causing 5xx Errors**: from Dashboard: Apache/Logs/Apache - Web Server Operations 
- **Top 5 Clients Causing Errors**: from Dashboard: Apache/Logs/Apache - Error Log Analysis 
- **Top 5 Critical Messages**: from Dashboard: Apache/Apache - Overview 
- **Top 5 Highly Malicious URLs**: from Dashboard: Apache/Logs/Apache - Threat Analysis 
- **Top 5 Referrers**: from Dashboard: Apache/Logs/Apache - Visitor Traffic Insight 
- **Top 5 Urls**: from Dashboard: Apache/Logs/Apache - Visitor Traffic Insight 
- **Top 5 URLs Causing 4xx Responses**: from Dashboard: Apache/Logs/Apache - Web Server Operations 
- **Top 5 URLs Causing 5xx Responses**: from Dashboard: Apache/Logs/Apache - Web Server Operations 
- **Traffic Distribution by Server**: from Dashboard: Apache/Logs/Apache - Trends 
- **Traffic Volume and Bytes Served**: from Dashboard: Apache/Logs/Apache - Trends 
- **Unique Visitors**: from Dashboard: Apache/Logs/Apache - Visitor Access Types 
- **United States**: from Dashboard: Apache/Logs/Apache - Visitor Locations 
- **Visitor Locations**: from Dashboard: Apache/Apache - Overview 
- **Visitor Locations - One Day Time Comparison**: from Dashboard: Apache/Logs/Apache - Trends 
- **Visitor Platforms**: from Dashboard: Apache/Logs/Apache - Visitor Access Types 
- **Visitor Platforms Over Time**: from Dashboard: Apache/Logs/Apache - Visitor Access Types 
- **Visits by Country Over Time**: from Dashboard: Apache/Logs/Apache - Visitor Locations 
- **Visits by US Regions Over Time**: from Dashboard: Apache/Logs/Apache - Visitor Locations 
- **Worldwide**: from Dashboard: Apache/Logs/Apache - Visitor Locations

### Metric Searches

- **Busy Worker Threads**: from Dashboard: Apache/Metrics/Apache - Server Resource Utilization 
- **Bytes (Sent and Received) Per Request**: from Dashboard: Apache/Metrics/Apache - Server Status 
- **Bytes (Sent and Received) Per Second**: from Dashboard: Apache/Metrics/Apache - Server Status 
- **Bytes Per Second**: from Dashboard: Apache/Apache - Overview 
- **Closing**: from Dashboard: Apache/Metrics/Apache - Request State Analysis 
- **CPU Children System Utilization**: from Dashboard: Apache/Metrics/Apache - Server Resource Utilization 
- **CPU Children User Utilization**: from Dashboard: Apache/Metrics/Apache - Server Resource Utilization 
- **CPU Load Utilization**: from Dashboard: Apache/Metrics/Apache - Server Resource Utilization 
- **CPU System Utilization**: from Dashboard: Apache/Metrics/Apache - Server Resource Utilization 
- **CPU User Utilization**: from Dashboard: Apache/Metrics/Apache - Server Resource Utilization 
- **DNS LookUp**: from Dashboard: Apache/Metrics/Apache - Request State Analysis 
- **Duration Per Request**: from Dashboard: Apache/Metrics/Apache - Server Status 
- **Finishing**: from Dashboard: Apache/Metrics/Apache - Request State Analysis 
- **Idle Cleanup**: from Dashboard: Apache/Metrics/Apache - Request State Analysis 
- **Idle Worker Threads**: from Dashboard: Apache/Metrics/Apache - Server Resource Utilization 
- **Keep Alive**: from Dashboard: Apache/Metrics/Apache - Request State Analysis 
- **Load  Average - 1m**: from Dashboard: Apache/Metrics/Apache - Server Resource Utilization 
- **Load - 15m**: from Dashboard: Apache/Metrics/Apache - Server Resource Utilization 
- **Load Average - 5m**: from Dashboard: Apache/Metrics/Apache - Server Resource Utilization 
- **Logging**: from Dashboard: Apache/Metrics/Apache - Request State Analysis 
- **Open**: from Dashboard: Apache/Metrics/Apache - Request State Analysis 
- **Reading**: from Dashboard: Apache/Metrics/Apache - Request State Analysis 
- **Request Per Second**: from Dashboard: Apache/Metrics/Apache - Server Status 
- **Request Per Second**: from Dashboard: Apache/Apache - Overview 
- **Request Per Second**: from Dashboard: Apache/Metrics/Apache - Server Status 
- **Sending**: from Dashboard: Apache/Metrics/Apache - Request State Analysis 
- **Starting**: from Dashboard: Apache/Metrics/Apache - Request State Analysis 
- **Total Accesses**: from Dashboard: Apache/Metrics/Apache - Server Status 
- **Total Duration**: from Dashboard: Apache/Metrics/Apache - Server Status 
- **Total KB Sent and Received**: from Dashboard: Apache/Metrics/Apache - Server Status 
- **Uptime**: from Dashboard: Apache/Apache - Overview 
- **Uptime**: from Dashboard: Apache/Metrics/Apache - Server Status 
- **Waiting**: from Dashboard: Apache/Metrics/Apache - Request State Analysis

## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Apache|4xx Status Codes by Server|Logs|Apache/Apache - Overview|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost=\* HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where status\_code matches "4\*"<br />\| count as count by status\_code, \_sourceHost, webserver\_farm|
|Apache|5xx Status Codes by Server|Logs|Apache/Apache - Overview|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost=\* HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where status\_code matches "5\*"<br />\| count as count by status\_code, \_sourceHost, webserver\_farm|
|Apache/Logs/Searches|Apache - All HTTP Response codes with their count|Logs|Apache/Logs/Searches/Apache - All HTTP Response codes with their count|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm=\* HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| count by status\_code, webserver\_farm<br />\| sort by \_count, webserver\_farm asc|
|Apache/Logs/Searches|Apache - Client Errors (4xx response codes) per day|Logs|Apache/Logs/Searches/Apache - Client Errors (4xx response codes) per day|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm=\* HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where status\_code matches "4\*" <br />\| timeslice by 1d <br />\| count by \_timeslice|
|Apache/Logs/Searches|Apache - Critical log messages|Logs|Apache/Logs/Searches/Apache - Critical log messages|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm=\* AND ("emerg" OR "alert" OR "crit") <br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "(?:\\d{4}\\]\|\\[client .+?\\]\|\\[[a-z0-9:-]+?\\]) (?\<reason\>[a-zA-Z].+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?:.+?) (?\<file\>/[a-zA-Z0-9\\.\_].+?)(?:\$\|, \|: \| on line\| (?i)http/1.(?:0\|1))"  nodrop <br />\| parse regex field=mesg " (?\<file\>[a-zA-Z]:\\\\.+?)(?:\$\|, \|: \| on line)" nodrop <br />\| parse regex field=mesg "\\[client (?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop <br />\| parse regex field=mesg "\\[client .+?:(?\<src\_port\>[0-9][0-9]+)\\] " nodrop <br />\| parse regex field=mesg "referer: (?\<referrer\>.+)\$"  nodrop <br />\| parse regex field=mesg " \\[(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg "(?\<reason\>Forbidden): (?\<file\>.+?) doesn't point to a file or directory" nodrop <br />\| parse regex field=mesg "(?\<reason\>Handler for .+? returned invalid result code [0-9]+)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid [a-zA-Z]+ in request) (?\<request\>.+?)(?:\$\| - .+\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Invalid [a-zA-Z]+ in request .+? (?\<url\>/.+?)(?:\$\|, \|: \| (?i)http/1.(?:0\|1))" nodrop <br />\| parse regex field=mesg "(?\<reason\>Script timed out before returning headers): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Symbolic link not allowed.\*?): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>configuration error):  couldn't .+?: (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>dir\_walk error), .+? filename (?:path\|)(?\<file\>.+?) for uri (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>handler .+? not found) for: (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>need Auth.+?): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Cannot map (?\<request\>.+?) to file" nodrop <br />\| parse regex field=mesg "(?:\\d{4}\\]\|\\[client .+?\\]\|\\[[a-z0-9:-]+?\\]) (?\<file\>(?:/[a-zA-Z0-9\\.\_].+?\|[a-zA-Z]:\\\\.+?)) pcfg\_openfile: (?\<reason\>unable to check htaccess file), ensure it is readable" nodrop <br />\| parse regex field=mesg "access to (?\<url\>.+?) (?:denied\|failed)" nodrop <br />\| parse regex field=mesg "access to (?\<file\>.+?) (?:denied\|failed)" nodrop <br />\| parse regex field=mesg "access to (?\<url\>.+?) failed; stat of '(?\<file\>.+?)' failed." nodrop <br />\| parse regex field=mesg " \\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg " \\[pid (?\<process\_id\>[0-9]+):tid (?\<thread\_id\>[0-9]+)\\]" nodrop <br />\| parse regex field=mesg "(?\<reason\>Buggy authn provider failed to set user) for (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Evaluation of .\*?expression from (?\<file\>.+?):[0-9]+ " nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid status line from script) '(?\<file\>.+?)':" nodrop <br />\| parse regex field=mesg "(?\<reason\>client submitted cookie '.\*?' more than once): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>malformed header from script) '(?\<file\>.+?)':" nodrop <br /><br />// 2.2 specific<br />\| parse regex field=mesg "(?\<reason\>client used wrong authentication scheme): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop<br />\| parse regex field=mesg "(?\<reason\>File does not exist): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid [a-zA-Z]+ in request) (?\<request\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Premature end of script headers): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>client sent HTTP/1.1 request without hostname) \\(.+?\\): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| where log\_level in ("emerg", "alert", "crit")<br />|
|Apache/Logs/Searches|Apache - HTTP status code summary over time|Logs|Apache/Logs/Searches/Apache - HTTP status code summary over time|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm=\* HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| if(status\_code matches "2\*", 1, 0) as successes <br />\| if(status\_code matches "3\*", 1, 0) as redirects<br />\| if(status\_code matches "4\*", 1, 0) as client\_errors <br />\| if(status\_code matches "5\*", 1, 0) as server\_errors <br />\| timeslice by 1d <br />\| sum(successes) as successes, sum(redirects) as redirects, sum(client\_errors) as client\_errors, sum(server\_errors) as server\_errors by \_timeslice|
|Apache/Logs/Searches|Apache - Log Level counts|Logs|Apache/Logs/Searches/Apache - Log Level counts|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm=\*<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "(?:\\d{4}\\]\|\\[client .+?\\]\|\\[[a-z0-9:-]+?\\]) (?\<reason\>[a-zA-Z].+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?:.+?) (?\<file\>/[a-zA-Z0-9\\.\_].+?)(?:\$\|, \|: \| on line\| (?i)http/1.(?:0\|1))"  nodrop <br />\| parse regex field=mesg " (?\<file\>[a-zA-Z]:\\\\.+?)(?:\$\|, \|: \| on line)" nodrop <br />\| parse regex field=mesg "\\[client (?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop <br />\| parse regex field=mesg "\\[client .+?:(?\<src\_port\>[0-9][0-9]+)\\] " nodrop <br />\| parse regex field=mesg "referer: (?\<referrer\>.+)\$"  nodrop <br />\| parse regex field=mesg " \\[(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg "(?\<reason\>Forbidden): (?\<file\>.+?) doesn't point to a file or directory" nodrop <br />\| parse regex field=mesg "(?\<reason\>Handler for .+? returned invalid result code [0-9]+)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid [a-zA-Z]+ in request) (?\<request\>.+?)(?:\$\| - .+\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Invalid [a-zA-Z]+ in request .+? (?\<url\>/.+?)(?:\$\|, \|: \| (?i)http/1.(?:0\|1))" nodrop <br />\| parse regex field=mesg "(?\<reason\>Script timed out before returning headers): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Symbolic link not allowed.\*?): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>configuration error):  couldn't .+?: (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>dir\_walk error), .+? filename (?:path\|)(?\<file\>.+?) for uri (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>handler .+? not found) for: (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>need Auth.+?): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Cannot map (?\<request\>.+?) to file" nodrop <br />\| parse regex field=mesg "(?:\\d{4}\\]\|\\[client .+?\\]\|\\[[a-z0-9:-]+?\\]) (?\<file\>(?:/[a-zA-Z0-9\\.\_].+?\|[a-zA-Z]:\\\\.+?)) pcfg\_openfile: (?\<reason\>unable to check htaccess file), ensure it is readable" nodrop <br />\| parse regex field=mesg "access to (?\<url\>.+?) (?:denied\|failed)" nodrop <br />\| parse regex field=mesg "access to (?\<file\>.+?) (?:denied\|failed)" nodrop <br />\| parse regex field=mesg "access to (?\<url\>.+?) failed; stat of '(?\<file\>.+?)' failed." nodrop <br />\| parse regex field=mesg " \\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg " \\[pid (?\<process\_id\>[0-9]+):tid (?\<thread\_id\>[0-9]+)\\]" nodrop <br />\| parse regex field=mesg "(?\<reason\>Buggy authn provider failed to set user) for (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Evaluation of .\*?expression from (?\<file\>.+?):[0-9]+ " nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid status line from script) '(?\<file\>.+?)':" nodrop <br />\| parse regex field=mesg "(?\<reason\>client submitted cookie '.\*?' more than once): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>malformed header from script) '(?\<file\>.+?)':" nodrop <br /><br />// 2.2 specific<br />\| parse regex field=mesg "(?\<reason\>client used wrong authentication scheme): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop<br />\| parse regex field=mesg "(?\<reason\>File does not exist): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid [a-zA-Z]+ in request) (?\<request\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Premature end of script headers): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>client sent HTTP/1.1 request without hostname) \\(.+?\\): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br /><br />\| where log\_level not in ("", "en")<br />\| count by log\_level <br />\| sort by \_count, log\_level asc|
|Apache/Logs/Searches|Apache - Malicious URL requests|Logs|Apache/Logs/Searches/Apache - Malicious URL requests|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm=\* HTTP ("jsessionid" or "old" or "bak") <br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where url matches "\*.old" or url matches "\*.bak" or url matches "\*jsessionid=\*"|
|Apache/Logs/Searches|Apache - Robots|Logs|Apache/Logs/Searches/Apache - Robots|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm=\* HTTP "/robots.txt" <br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| count\_frequent user\_agent, src\_ip, method, status\_code|
|Apache/Logs/Searches|Apache - Server start and stop events|Logs|Apache/Logs/Searches/Apache - Server start and stop events|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm=\* ("caught SIGTERM, shutting down" or "- resuming normal operations") <br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "(?:\\d{4}\\]\|\\[client .+?\\]\|\\[[a-z0-9:-]+?\\]) (?\<reason\>[a-zA-Z].+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?:.+?) (?\<file\>/[a-zA-Z0-9\\.\_].+?)(?:\$\|, \|: \| on line\| (?i)http/1.(?:0\|1))"  nodrop <br />\| parse regex field=mesg " (?\<file\>[a-zA-Z]:\\\\.+?)(?:\$\|, \|: \| on line)" nodrop <br />\| parse regex field=mesg "\\[client (?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop <br />\| parse regex field=mesg "\\[client .+?:(?\<src\_port\>[0-9][0-9]+)\\] " nodrop <br />\| parse regex field=mesg "referer: (?\<referrer\>.+)\$"  nodrop <br />\| parse regex field=mesg " \\[(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg "(?\<reason\>Forbidden): (?\<file\>.+?) doesn't point to a file or directory" nodrop <br />\| parse regex field=mesg "(?\<reason\>Handler for .+? returned invalid result code [0-9]+)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid [a-zA-Z]+ in request) (?\<request\>.+?)(?:\$\| - .+\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Invalid [a-zA-Z]+ in request .+? (?\<url\>/.+?)(?:\$\|, \|: \| (?i)http/1.(?:0\|1))" nodrop <br />\| parse regex field=mesg "(?\<reason\>Script timed out before returning headers): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Symbolic link not allowed.\*?): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>configuration error):  couldn't .+?: (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>dir\_walk error), .+? filename (?:path\|)(?\<file\>.+?) for uri (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>handler .+? not found) for: (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>need Auth.+?): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Cannot map (?\<request\>.+?) to file" nodrop <br />\| parse regex field=mesg "(?:\\d{4}\\]\|\\[client .+?\\]\|\\[[a-z0-9:-]+?\\]) (?\<file\>(?:/[a-zA-Z0-9\\.\_].+?\|[a-zA-Z]:\\\\.+?)) pcfg\_openfile: (?\<reason\>unable to check htaccess file), ensure it is readable" nodrop <br />\| parse regex field=mesg "access to (?\<url\>.+?) (?:denied\|failed)" nodrop <br />\| parse regex field=mesg "access to (?\<file\>.+?) (?:denied\|failed)" nodrop <br />\| parse regex field=mesg "access to (?\<url\>.+?) failed; stat of '(?\<file\>.+?)' failed." nodrop <br />\| parse regex field=mesg " \\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg " \\[pid (?\<process\_id\>[0-9]+):tid (?\<thread\_id\>[0-9]+)\\]" nodrop <br />\| parse regex field=mesg "(?\<reason\>Buggy authn provider failed to set user) for (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Evaluation of .\*?expression from (?\<file\>.+?):[0-9]+ " nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid status line from script) '(?\<file\>.+?)':" nodrop <br />\| parse regex field=mesg "(?\<reason\>client submitted cookie '.\*?' more than once): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>malformed header from script) '(?\<file\>.+?)':" nodrop <br /><br />// 2.2 specific<br />\| parse regex field=mesg "(?\<reason\>client used wrong authentication scheme): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop<br />\| parse regex field=mesg "(?\<reason\>File does not exist): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid [a-zA-Z]+ in request) (?\<request\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Premature end of script headers): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>client sent HTTP/1.1 request without hostname) \\(.+?\\): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br /><br />\| where (mesg matches "\*caught SIGTERM, shutting down\*") or (mesg matches "\*-- resuming normal operations")|
|Apache/Logs/Searches|Apache - Server stops and starts over time|Logs|Apache/Logs/Searches/Apache - Server stops and starts over time|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm=\* ("caught SIGTERM, shutting down" or "- resuming normal operations")<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "(?:\\d{4}\\]\|\\[client .+?\\]\|\\[[a-z0-9:-]+?\\]) (?\<reason\>[a-zA-Z].+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?:.+?) (?\<file\>/[a-zA-Z0-9\\.\_].+?)(?:\$\|, \|: \| on line\| (?i)http/1.(?:0\|1))"  nodrop <br />\| parse regex field=mesg " (?\<file\>[a-zA-Z]:\\\\.+?)(?:\$\|, \|: \| on line)" nodrop <br />\| parse regex field=mesg "\\[client (?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop <br />\| parse regex field=mesg "\\[client .+?:(?\<src\_port\>[0-9][0-9]+)\\] " nodrop <br />\| parse regex field=mesg "referer: (?\<referrer\>.+)\$"  nodrop <br />\| parse regex field=mesg " \\[(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg "(?\<reason\>Forbidden): (?\<file\>.+?) doesn't point to a file or directory" nodrop <br />\| parse regex field=mesg "(?\<reason\>Handler for .+? returned invalid result code [0-9]+)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid [a-zA-Z]+ in request) (?\<request\>.+?)(?:\$\| - .+\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Invalid [a-zA-Z]+ in request .+? (?\<url\>/.+?)(?:\$\|, \|: \| (?i)http/1.(?:0\|1))" nodrop <br />\| parse regex field=mesg "(?\<reason\>Script timed out before returning headers): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg"(?\<reason\>Symbolic link not allowed.\*?): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg"(?\<reason\>configuration error):  couldn't .+?: (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>dir\_walk error), .+? filename (?:path\|)(?\<file\>.+?) for uri (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>handler .+? not found) for: (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>need Auth.+?): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Cannot map (?\<request\>.+?) to file" nodrop <br />\| parse regex field=mesg "(?:\\d{4}\\]\|\\[client .+?\\]\|\\[[a-z0-9:-]+?\\]) (?\<file\>(?:/[a-zA-Z0-9\\.\_].+?\|[a-zA-Z]:\\\\.+?)) pcfg\_openfile: (?\<reason\>unable to check htaccess file), ensure it is readable" nodrop <br />\| parse regex field=mesg "access to (?\<url\>.+?) (?:denied\|failed)" nodrop <br />\| parse regex field=mesg "access to (?\<file\>.+?) (?:denied\|failed)" nodrop <br />\| parse regex field=mesg "access to (?\<url\>.+?) failed; stat of '(?\<file\>.+?)' failed." nodrop <br />\| parse regex field=mesg " \\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg " \\[pid (?\<process\_id\>[0-9]+):tid (?\<thread\_id\>[0-9]+)\\]" nodrop <br />\| parse regex field=mesg "(?\<reason\>Buggy authn provider failed to set user) for (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Evaluation of .\*?expression from (?\<file\>.+?):[0-9]+ " nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid status line from script) '(?\<file\>.+?)':" nodrop <br />\| parse regex field=mesg"(?\<reason\>client submitted cookie '.\*?' more than once): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>malformed header from script) '(?\<file\>.+?)':" nodrop <br /><br />// 2.2 specific<br />\| parse regex field=mesg "(?\<reason\>client used wrong authentication scheme): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop<br />\| parse regex field=mesg "(?\<reason\>File does not exist): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid [a-zA-Z]+ in request) (?\<request\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Premature end of script headers): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>client sent HTTP/1.1 request without hostname) \\(.+?\\): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br /><br />\| if(mesg matches "\*caught SIGTERM, shutting down\*", 1, 0) as server\_stop <br />\| if(mesg matches "\*-- resuming normal operations",1, 0) as server\_start <br />\| timeslice by 1h<br />\| sum(server\_stop) as server\_stops, sum(server\_start) as server\_starts by \_timeslice|
|Apache/Logs/Searches|Apache - Slowest URLs by average time|Logs|Apache/Logs/Searches/Apache - Slowest URLs by average time|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm=\* HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| parse regex field=mesg " (?:\\d+)/(?\<microseconds\>\\d+)\$"<br />\| avg(microseconds) as avgtimeinseconds by url <br />\| sort by avgtimeinseconds <br />\| limit 100 <br />\| (avgtimeinseconds/1000000) as avgtimeinseconds <br />\| (toLong(avgtimeinseconds\*100)/100) as avgtimeinseconds|
|Apache/Logs/Searches|Apache - Time taken to serve requests|Logs|Apache/Logs/Searches/Apache - Time taken to serve requests|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm=\* HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| parse regex field=mesg " (?\<seconds\>\\d+)/(?\<microseconds\>\\d+)\$" <br />\| where microseconds != ""<br />\| toLong(microseconds/(1000000\*60)) as minutes|
|Apache/Logs/Searches|Apache - Top 404 referrers|Logs|Apache/Logs/Searches/Apache - Top 404 referrers|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm=\* HTTP  404<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where status\_code="404" <br />\| count\_frequent referrer <br />\| limit 100|
|Apache/Logs/Searches|Apache - Top browsers|Logs|Apache/Logs/Searches/Apache - Top browsers|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm=\* HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| count\_frequent user\_agent <br />\| limit 100|
|Apache/Logs/Searches|Apache - Top clients|Logs|Apache/Logs/Searches/Apache - Top clients|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm=\* HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where !isBlank(src\_ip)<br />\| count\_frequent src\_ip <br />\| limit 100|
|Apache/Logs/Searches|Apache - Top clients causing errors responses|Logs|Apache/Logs/Searches/Apache - Top clients causing errors responses|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm=\* HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where status\_code matches "4\*" <br />\| count\_frequent src\_ip <br />\| limit 100|
|Apache/Logs/Searches|Apache - Top error reasons|Logs|Apache/Logs/Searches/Apache - Top error reasons|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm=\*<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "(?:\\d{4}\\]\|\\[client .+?\\]\|\\[[a-z0-9:-]+?\\]) (?\<reason\>[a-zA-Z].+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?:.+?) (?\<file\>/[a-zA-Z0-9\\.\_].+?)(?:\$\|, \|: \| on line\| (?i)http/1.(?:0\|1))"  nodrop <br />\| parse regex field=mesg " (?\<file\>[a-zA-Z]:\\\\.+?)(?:\$\|, \|: \| on line)" nodrop <br />\| parse regex field=mesg  "\\[client (?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop <br />\| parse regex field=mesg "\\[client .+?:(?\<src\_port\>[0-9][0-9]+)\\] " nodrop <br />\| parse regex field=mesg "referer: (?\<referrer\>.+)\$"  nodrop <br />\| parse regex field=mesg " \\[(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg "(?\<reason\>Forbidden): (?\<file\>.+?) doesn't point to a file or directory" nodrop <br />\| parse regex field=mesg "(?\<reason\>Handler for .+? returned invalid result code [0-9]+)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid [a-zA-Z]+ in request) (?\<request\>.+?)(?:\$\| - .+\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Invalid [a-zA-Z]+ in request .+? (?\<url\>/.+?)(?:\$\|, \|: \| (?i)http/1.(?:0\|1))" nodrop <br />\| parse regex field=mesg "(?\<reason\>Script timed out before returning headers): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Symbolic link not allowed.\*?): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>configuration error):  couldn't .+?: (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>dir\_walk error), .+? filename (?:path\|)(?\<file\>.+?) for uri (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>handler .+? not found) for: (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>need Auth.+?): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Cannot map (?\<request\>.+?) to file" nodrop <br />\| parse regex field=mesg "(?:\\d{4}\\]\|\\[client .+?\\]\|\\[[a-z0-9:-]+?\\]) (?\<file\>(?:/[a-zA-Z0-9\\.\_].+?\|[a-zA-Z]:\\\\.+?)) pcfg\_openfile: (?\<reason\>unable to check htaccess file), ensure it is readable" nodrop <br />\| parse regex field=mesg "access to (?\<url\>.+?) (?:denied\|failed)" nodrop <br />\| parse regex field=mesg "access to (?\<file\>.+?) (?:denied\|failed)" nodrop <br />\| parse regex field=mesg "access to (?\<url\>.+?) failed; stat of '(?\<file\>.+?)' failed." nodrop <br />\| parse regex field=mesg " \\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg " \\[pid (?\<process\_id\>[0-9]+):tid (?\<thread\_id\>[0-9]+)\\]" nodrop <br />\| parse regex field=mesg "(?\<reason\>Buggy authn provider failed to set user) for (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Evaluation of .\*?expression from (?\<file\>.+?):[0-9]+ " nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid status line from script) '(?\<file\>.+?)':" nodrop <br />\| parse regex field=mesg "(?\<reason\>client submitted cookie '.\*?' more than once): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>malformed header from script) '(?\<file\>.+?)':" nodrop <br /><br />// 2.2 specific<br />\| parse regex field=mesg "(?\<reason\>client used wrong authentication scheme): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop<br />\| parse regex field=mesg "(?\<reason\>File does not exist): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid [a-zA-Z]+ in request) (?\<request\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Premature end of script headers): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>client sent HTTP/1.1 request without hostname) \\(.+?\\): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br /><br />\| where !isEmpty(reason)<br />\| count by reason <br />\| top 100 reason by \_count|
|Apache/Logs/Searches|Apache - Top files causing errors|Logs|Apache/Logs/Searches/Apache - Top files causing errors|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm=\*<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "(?:\\d{4}\\]\|\\[client .+?\\]\|\\[[a-z0-9:-]+?\\]) (?\<reason\>[a-zA-Z].+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?:.+?) (?\<file\>/[a-zA-Z0-9\\.\_].+?)(?:\$\|, \|: \| on line\| (?i)http/1.(?:0\|1))"  nodrop <br />\| parse regex field=mesg " (?\<file\>[a-zA-Z]:\\\\.+?)(?:\$\|, \|: \| on line)" nodrop <br />\| parse regex field=mesg "\\[client (?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop <br />\| parse regex field=mesg "\\[client .+?:(?\<src\_port\>[0-9][0-9]+)\\] " nodrop <br />\| parse regex field=mesg "referer: (?\<referrer\>.+)\$"  nodrop <br />\| parse regex field=mesg " \\[(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg "(?\<reason\>Forbidden): (?\<file\>.+?) doesn't point to a file or directory" nodrop <br />\| parse regex field=mesg "(?\<reason\>Handler for .+? returned invalid result code [0-9]+)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid [a-zA-Z]+ in request) (?\<request\>.+?)(?:\$\| - .+\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Invalid [a-zA-Z]+ in request .+? (?\<url\>/.+?)(?:\$\|, \|: \| (?i)http/1.(?:0\|1))" nodrop <br />\| parse regex field=mesg "(?\<reason\>Script timed out before returning headers): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Symbolic link not allowed.\*?): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>configuration error):  couldn't .+?: (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>dir\_walk error), .+? filename (?:path\|)(?\<file\>.+?) for uri (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>handler .+? not found) for: (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>need Auth.+?): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Cannot map (?\<request\>.+?) to file" nodrop <br />\| parse regex field=mesg "(?:\\d{4}\\]\|\\[client .+?\\]\|\\[[a-z0-9:-]+?\\]) (?\<file\>(?:/[a-zA-Z0-9\\.\_].+?\|[a-zA-Z]:\\\\.+?)) pcfg\_openfile: (?\<reason\>unable to check htaccess file), ensure it is readable" nodrop <br />\| parse regex field=mesg "access to (?\<url\>.+?) (?:denied\|failed)" nodrop <br />\| parse regex field=mesg "access to (?\<file\>.+?) (?:denied\|failed)" nodrop <br />\| parse regex field=mesg "access to (?\<url\>.+?) failed; stat of '(?\<file\>.+?)' failed." nodrop <br />\| parse regex field=mesg " \\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg " \\[pid (?\<process\_id\>[0-9]+):tid (?\<thread\_id\>[0-9]+)\\]" nodrop <br />\| parse regex field=mesg "(?\<reason\>Buggy authn provider failed to set user) for (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Evaluation of .\*?expression from (?\<file\>.+?):[0-9]+ " nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid status line from script) '(?\<file\>.+?)':" nodrop <br />\| parse regex field=mesg "(?\<reason\>client submitted cookie '.\*?' more than once): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>malformed header from script) '(?\<file\>.+?)':" nodrop <br /><br />// 2.2 specific<br />\| parse regex field=mesg "(?\<reason\>client used wrong authentication scheme): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop<br />\| parse regex field=mesg "(?\<reason\>File does not exist): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid [a-zA-Z]+ in request) (?\<request\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Premature end of script headers): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>client sent HTTP/1.1 request without hostname) \\(.+?\\): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br /><br />\| where file != "" <br />\| count by file <br />\| top 100 file by \_count|
|Apache/Logs/Searches|Apache - Top Referrers causing errors|Logs|Apache/Logs/Searches/Apache - Top Referrers causing errors|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm=\*<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "(?:\\d{4}\\]\|\\[client .+?\\]\|\\[[a-z0-9:-]+?\\]) (?\<reason\>[a-zA-Z].+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?:.+?) (?\<file\>/[a-zA-Z0-9\\.\_].+?)(?:\$\|, \|: \| on line\| (?i)http/1.(?:0\|1))"  nodrop <br />\| parse regex field=mesg " (?\<file\>[a-zA-Z]:\\\\.+?)(?:\$\|, \|: \| on line)" nodrop <br />\| parse regex field=mesg "\\[client (?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop <br />\| parse regex field=mesg "\\[client .+?:(?\<src\_port\>[0-9][0-9]+)\\] " nodrop <br />\| parse regex field=mesg "referer: (?\<referrer\>.+)\$"  nodrop <br />\| parse regex field=mesg " \\[(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg "(?\<reason\>Forbidden): (?\<file\>.+?) doesn't point to a file or directory" nodrop <br />\| parse regex field=mesg "(?\<reason\>Handler for .+? returned invalid result code [0-9]+)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid [a-zA-Z]+ in request) (?\<request\>.+?)(?:\$\| - .+\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Invalid [a-zA-Z]+ in request .+? (?\<url\>/.+?)(?:\$\|, \|: \| (?i)http/1.(?:0\|1))" nodrop <br />\| parse regex field=mesg "(?\<reason\>Script timed out before returning headers): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Symbolic link not allowed.\*?): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>configuration error):  couldn't .+?: (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>dir\_walk error), .+? filename (?:path\|)(?\<file\>.+?) for uri (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>handler .+? not found) for: (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>need Auth.+?): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Cannot map (?\<request\>.+?) to file" nodrop <br />\| parse regex field=mesg "(?:\\d{4}\\]\|\\[client .+?\\]\|\\[[a-z0-9:-]+?\\]) (?\<file\>(?:/[a-zA-Z0-9\\.\_].+?\|[a-zA-Z]:\\\\.+?)) pcfg\_openfile: (?\<reason\>unable to check htaccess file), ensure it is readable" nodrop <br />\| parse regex field=mesg "access to (?\<url\>.+?) (?:denied\|failed)" nodrop <br />\| parse regex field=mesg "access to (?\<file\>.+?) (?:denied\|failed)" nodrop <br />\| parse regex field=mesg "access to (?\<url\>.+?) failed; stat of '(?\<file\>.+?)' failed." nodrop <br />\| parse regex field=mesg " \\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg " \\[pid (?\<process\_id\>[0-9]+):tid (?\<thread\_id\>[0-9]+)\\]" nodrop <br />\| parse regex field=mesg "(?\<reason\>Buggy authn provider failed to set user) for (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Evaluation of .\*?expression from (?\<file\>.+?):[0-9]+ " nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid status line from script) '(?\<file\>.+?)':" nodrop <br />\| parse regex field=mesg "(?\<reason\>client submitted cookie '.\*?' more than once): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>malformed header from script) '(?\<file\>.+?)':" nodrop <br /><br />// 2.2 specific<br />\| parse regex field=mesg "(?\<reason\>client used wrong authentication scheme): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop<br />\| parse regex field=mesg "(?\<reason\>File does not exist): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid [a-zA-Z]+ in request) (?\<request\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Premature end of script headers): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>client sent HTTP/1.1 request without hostname) \\(.+?\\): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br /><br />\| where referrer != "" <br />\| count\_frequent referrer <br />\| limit 100|
|Apache/Logs/Searches|Apache - Top URLs by bytes served|Logs|Apache/Logs/Searches/Apache - Top URLs by bytes served|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm=\* HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where size != "-"<br />\| avg(size) as average\_size\_KB by url<br />\| sort by average\_size\_KB<br />\| limit 100<br />\| (average\_size\_KB/1024) as average\_size\_KB<br />\| (toLong(average\_size\_KB\*100)/100) as average\_size\_KB|
|Apache/Logs/Searches|Apache - Traffic volume and bytes served per day|Logs|Apache/Logs/Searches/Apache - Traffic volume and bytes served per day|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm=\* HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where size != "-"<br />\| (size/1048576) as mbytes<br />\| timeslice by 1d <br />\| sum(mbytes) as Bytes\_Served\_mb, count as hits by \_timeslice|
|Apache/Logs|Browsers and Operating Systems|Logs|Apache/Logs/Apache - Visitor Access Types|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| if (user\_agent matches "\*Windows \*" OR user\_agent matches "\*Win32\*" OR user\_agent matches "\*Win64\*","Windows","") as OS <br />\| if (user\_agent matches "\*Macintosh\*" OR user\_agent matches "\*Darwin/\*" OR user\_agent matches "\*Mac OS\*","MacOS",OS) as OS <br />\| if (user\_agent matches "\* CrOS \*","Chrome OS",OS) as OS<br />\| if (user\_agent matches "\*Linux\*","Linux",OS) as OS <br />\| if (user\_agent matches "\*iPad\*","iPad",OS) as OS <br />\| if (user\_agent matches "\*iPhone\*","iPhone",OS) as OS <br />\| if (user\_agent matches "\*Android\*","Android",OS) as OS <br />\| if (user\_agent matches "\*Windows Phone\*","Windows Phone",OS) as OS <br />\| if (OS == "","Other",OS) as OS <br />\| if (user\_agent matches "Mozilla/\*; rv:\*)\*","Mozilla","") as Browser<br />\| if (user\_agent matches "\*MSIE\*","Internet Explorer",Browser) as Browser <br />\| if (user\_agent matches "\*Firefox\*","Firefox",Browser) as Browser <br />\| if (user\_agent matches "\*Safari\*","Safari",Browser) as Browser <br />\| if (OS=="Android" AND user\_agent matches "\*WebKit\*","WebKit",Browser) as Browser<br />\| if ((OS=="iPhone" OR OS=="iPad") AND (user\_agent matches "\*Mobile/\*" OR user\_agent matches "\*AppleWebKit\*(KHTML\*Gecko)\*"),"Mobile Safari",Browser) as Browser<br />\| if (browser == "" AND OS=="MacOS" AND user\_agent matches "Mozilla/\* (Macintosh;\*(KHTML, like Gecko)\*","Safari",Browser) as Browser <br />\| if (user\_agent matches "\*MobileSafari/\*","Mobile Safari",Browser) as Browser<br />\| if (user\_agent matches "\*Chrome\*","Chrome",Browser) as Browser <br />\| if (user\_agent matches "Opera\*","Opera",Browser) as Browser <br />\| if (user\_agent matches "Dolphin\*","Dolphin",Browser) as Browser <br />\| if (Browser == "","Other",Browser) as Browser  <br />\| count by OS,browser<br />\| transpose row browser column os|
|Apache/Metrics|Busy Worker Threads|Metrics|Apache/Metrics/Apache - Server Resource Utilization|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_BusyWorkers webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| avg by webserver\_farm|
|Apache/Metrics|Bytes (Sent and Received) Per Request|Metrics|Apache/Metrics/Apache - Server Status|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_BytesPerReq webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| avg by webserver\_farm|
|Apache/Metrics|Bytes (Sent and Received) Per Second|Metrics|Apache/Metrics/Apache - Server Status|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_BytesPerSec webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| avg by webserver\_farm|
|Apache|Bytes Per Second|Metrics|Apache/Apache - Overview|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_BytesPerSec webserver\_farm={{webserver\_farm}} server=\* port=\* \| avg by webserver\_farm|
|Apache/Logs|Bytes Served|Logs|Apache/Logs/Apache - Visitor Traffic Insight|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| sum(size) as Bytes\_Served<br />\| Bytes\_Served/(1024\*1024\*1000) as Gbytes\_Served<br />\| fields Gbytes\_Served|
|Apache/Logs|Bytes Served - Outlier|Logs|Apache/Logs/Apache - Outlier Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where size != "-" and !isEmpty(size)<br />\| number(size)<br />\| (size/(1048576\*1000)) as gbytes <br />\| timeslice {{timeslice}} <br />\| sum(gbytes) as gbytes by \_timeslice <br />\| sort \_timeslice asc<br />\| outlier gbytes window={{window}}, threshold={{threshold}}, consecutive={{consecutive}}, direction=+-|
|Apache/Logs|Client Errors|Logs|Apache/Logs/Apache - Outlier Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP 4\*<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where (status\_code matches "4\*") <br />\| timeslice {{timeslice}}<br />\| count as client\_errors by \_timeslice<br />\| sort \_timeslice asc<br />\| outlier client\_errors window={{window}}, threshold={{threshold}}, consecutive={{consecutive}}, direction=+|
|Apache/Logs|Client Locations - 4xx Errors|Logs|Apache/Logs/Apache - Web Server Operations|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP (40\* OR 41\* OR 42\* OR 43\* or 44\* OR 45\* or 49\*)<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where status\_code matches "4\*" <br />\| count by src\_ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = src\_ip<br />\| where !isNull(latitude)|
|Apache/Logs|Client Locations with Critical Errors|Logs|Apache/Logs/Apache - Error Log Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} ("emerg" OR "alert" OR "crit") <br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg " \\[(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg " \\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg "\\[client (?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| where log\_level in ("emerg", "alert", "crit")<br />\| count by src\_ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = src\_ip<br />\| where !isNull(latitude)|
|Apache/Metrics|Closing|Metrics|Apache/Metrics/Apache - Request State Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_scboard\_closing webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| sum by webserver\_farm|
|Apache/Metrics|CPU Children System Utilization|Metrics|Apache/Metrics/Apache - Server Resource Utilization|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_CPUChildrenSystem webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| avg by webserver\_farm|
|Apache/Metrics|CPU Children User Utilization|Metrics|Apache/Metrics/Apache - Server Resource Utilization|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_CPUChildrenUser webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| avg by webserver\_farm|
|Apache/Metrics|CPU Load Utilization|Metrics|Apache/Metrics/Apache - Server Resource Utilization|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_CPULoad webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| avg by webserver\_farm|
|Apache/Metrics|CPU System Utilization|Metrics|Apache/Metrics/Apache - Server Resource Utilization|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_CPUSystem webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| avg by webserver\_farm|
|Apache/Metrics|CPU User Utilization|Metrics|Apache/Metrics/Apache - Server Resource Utilization|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_CPUUser webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| avg by webserver\_farm|
|Apache|Critical Error Messages|Logs|Apache/Apache - Overview|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost=\* (emerg or alert or crit) <br />// Error Logs<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^\\[[^]]\*]\\s\\[(?\<log\_level\>[a-z:]+)\\]" nodrop<br />\| parse regex field=mesg "\\[[^]]\*]\\s\\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] " nodrop<br />\| where log\_level in ("emerg", "alert", "crit") // emerg:	System is unusable, alert:	Action must be taken immediately, crit	Critical conditions<br />\| parse field=mesg "[error] \*" as error\_mesg nodrop<br />\| parse field=mesg "[client \*] \*" as src\_ip, error\_mesg nodrop<br />\| count|
|Apache/Logs|Critical Errors|Logs|Apache/Logs/Apache - Error Log Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} AND ("emerg" OR "alert" OR "crit") <br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "(?:\\d{4}\\]\|\\[client .+?\\]\|\\[[a-z0-9:-]+?\\]) (?\<reason\>[a-zA-Z].+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?:.+?) (?\<file\>/[a-zA-Z0-9\\.\_].+?)(?:\$\|, \|: \| on line\| (?i)http/1.(?:0\|1))"  nodrop <br />\| parse regex field=mesg " (?\<file\>[a-zA-Z]:\\\\.+?)(?:\$\|, \|: \| on line)" nodrop <br />\| parse regex field=mesg "\\[client (?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop <br />\| parse regex field=mesg "\\[client .+?:(?\<src\_port\>[0-9][0-9]+)\\] " nodrop <br />\| parse regex field=mesg "referer: (?\<referrer\>.+)\$"  nodrop <br />\| parse regex field=mesg " \\[(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg "(?\<reason\>Forbidden): (?\<file\>.+?) doesn't point to a file or directory" nodrop <br />\| parse regex field=mesg "(?\<reason\>Handler for .+? returned invalid result code [0-9]+)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid [a-zA-Z]+ in request) (?\<request\>.+?)(?:\$\| - .+\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Invalid [a-zA-Z]+ in request .+? (?\<url\>/.+?)(?:\$\|, \|: \| (?i)http/1.(?:0\|1))" nodrop <br />\| parse regex field=mesg "(?\<reason\>Script timed out before returning headers): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Symbolic link not allowed.\*?): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>configuration error):  couldn't .+?: (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>dir\_walk error), .+? filename (?:path\|)(?\<file\>.+?) for uri (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>handler .+? not found) for: (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>need Auth.+?): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Cannot map (?\<request\>.+?) to file" nodrop <br />\| parse regex field=mesg "(?:\\d{4}\\]\|\\[client .+?\\]\|\\[[a-z0-9:-]+?\\]) (?\<file\>(?:/[a-zA-Z0-9\\.\_].+?\|[a-zA-Z]:\\\\.+?)) pcfg\_openfile: (?\<reason\>unable to check htaccess file), ensure it is readable" nodrop <br />\| parse regex field=mesg "access to (?\<url\>.+?) (?:denied\|failed)" nodrop <br />\| parse regex field=mesg "access to (?\<file\>.+?) (?:denied\|failed)" nodrop <br />\| parse regex field=mesg "access to (?\<url\>.+?) failed; stat of '(?\<file\>.+?)' failed." nodrop <br />\| parse regex field=mesg " \\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg " \\[pid (?\<process\_id\>[0-9]+)\\] (?\<reason\>[a-zA-Z].\*)" nodrop <br />\| parse regex field=mesg " \\[pid (?\<process\_id\>[0-9]+):tid (?\<thread\_id\>[0-9]+)\\]" nodrop <br />\| parse regex field=mesg "(?\<reason\>Buggy authn provider failed to set user) for (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Evaluation of .\*?expression from (?\<file\>.+?):[0-9]+ " nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid status line from script) '(?\<file\>.+?)':" nodrop <br />\| parse regex field=mesg "(?\<reason\>client submitted cookie '.\*?' more than once): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>malformed header from script) '(?\<file\>.+?)':" nodrop <br />\| parse regex field=mesg "\\[client (?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}) (?\<reason\>[a-zA-Z].+?)" nodrop <br />\| parse regex field=mesg " \\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] (?\<reason\>[a-zA-Z].\*)" nodrop <br />\| parse regex field=mesg " \\[pid (?\<process\_id\>[0-9]+):tid (?\<thread\_id\>[0-9]+)\\] (?\<reason\>[a-zA-Z].\*)" nodrop <br /><br />// 2.2 specific<br />\| parse regex field=mesg "(?\<reason\>client used wrong authentication scheme): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop<br />\| parse regex field=mesg "(?\<reason\>File does not exist): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid [a-zA-Z]+ in request) (?\<request\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Premature end of script headers): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>client sent HTTP/1.1 request without hostname) \\(.+?\\): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| where log\_level in ("emerg", "alert", "crit")<br />\| timeslice 1s<br />\| count as count by \_timeslice, webserver\_farm, log\_level, reason<br />\| sort by \_timeslice<br />\| limit 100|
|Apache/Logs|Desktop OS Versions|Logs|Apache/Logs/Apache - Visitor Access Types|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP ("macintosh" OR "mac os" OR "windows" OR "i686" or "PC" or ("Linux" AND !android))<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| parse regex field=user\_agent "(?\<os\>Mac OS) (?\<version\>[^;\\)]+?)(?:;\|\\))" nodrop <br />\| parse regex field=user\_agent "(?\<os\>Windows)(?: NT \| )(?\<version\>[\\d.]+)" nodrop <br />\| parse regex field=user\_agent "(?\<os\>Linux) (?\<version\>\\S+?)(?:\\)\|;)" nodrop <br />\| where os != ""<br />\| count as count by os, version<br />\| transpose row version column os|
|Apache/Metrics|DNS LookUp|Metrics|Apache/Metrics/Apache - Request State Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_scboard\_dnslookup webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| sum by webserver\_farm|
|Apache/Metrics|Duration Per Request|Metrics|Apache/Metrics/Apache - Server Status|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_DurationPerReq webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| avg by webserver\_farm|
|Apache/Logs|Error Log Levels|Logs|Apache/Logs/Apache - Web Server Operations|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}}<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />// Error Logs<br />\| parse regex field=mesg "^\\[[^]]\*]\\s\\[(?\<log\_level\>[a-z]+)\\]" nodrop<br />\| parse regex field=mesg "\\[[^]]\*]\\s\\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] " nodrop<br />\| count as count by log\_level<br />\| where !isBlank(log\_level)<br />\| sort count, log\_level asc|
|Apache/Logs|Error Log Levels|Logs|Apache/Logs/Apache - Error Log Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}}<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />// Error Logs<br />\| parse regex field=mesg "^\\[[^]]\*]\\s\\[(?\<log\_level\>[a-z]+)\\]" nodrop<br />\| parse regex field=mesg "\\[[^]]\*]\\s\\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] " nodrop<br />\| count as count by log\_level<br />\| where !isEmpty(log\_level) and log\_level not in ("en")<br />\| sort count, log\_level asc|
|Apache/Logs|Error Responses by Server|Logs|Apache/Logs/Apache - Web Server Operations|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where status\_code matches "4\*" or status\_code matches "5\*"<br />\| timeslice 5m<br />\| count as count by \_timeslice, \_sourceHost<br />\| transpose row \_timeslice column \_sourceHost|
|Apache/Metrics|Finishing|Metrics|Apache/Metrics/Apache - Request State Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_scboard\_finishing webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| sum by webserver\_farm|
|Apache/Logs|Highly Malicious Threats|Logs|Apache/Logs/Apache - Threat Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| count as threat\_count by src\_ip, method, status\_code, size, referrer, user\_agent, url<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=src\_ip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence) and malicious\_confidence matches "high"<br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum(threat\_count) as threat\_count by src\_ip, method, status\_code, size, url, referrer, user\_agent, malicious\_confidence, actor<br />\| sort by threat\_count<br />\| limit 20|
|Apache/Logs|HTTP Methods|Logs|Apache/Logs/Apache - Visitor Traffic Insight|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where !isBlank(method)<br />\| count as count by method<br />\| sort by count, method asc<br />\| limit 5|
|Apache/Metrics|Idle Cleanup|Metrics|Apache/Metrics/Apache - Request State Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_scboard\_idle\_cleanup webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| sum by webserver\_farm|
|Apache/Metrics|Idle Worker Threads|Metrics|Apache/Metrics/Apache - Server Resource Utilization|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_IdleWorkers webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| avg by webserver\_farm|
|Apache/Metrics|Keep Alive|Metrics|Apache/Metrics/Apache - Request State Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_scboard\_keepalive webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| sum by webserver\_farm|
|Apache/Metrics|Load  Average - 1m|Metrics|Apache/Metrics/Apache - Server Resource Utilization|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_Load1 webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| avg by webserver\_farm|
|Apache/Metrics|Load - 15m|Metrics|Apache/Metrics/Apache - Server Resource Utilization|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_Load15 webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| avg by webserver\_farm|
|Apache/Metrics|Load Average - 5m|Metrics|Apache/Metrics/Apache - Server Resource Utilization|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_Load5 webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| avg by webserver\_farm|
|Apache/Logs|Log Level - One Day Time Comparison|Logs|Apache/Logs/Apache - Error Log Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}}<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg " \\[(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg " \\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| where !isEmpty(log\_level) and log\_level not in ("en")<br />\| count as count by log\_level<br />\| sort by count<br />\| compare with timeshift 1d|
|Apache/Logs|Log Reduce|Logs|Apache/Logs/Apache - Error Log Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}}<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg " \\[(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg " \\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg " \\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] (?\<reason\>[a-zA-Z].\*)" nodrop <br />\| where !isBlank(log\_level) and log\_level not in ("en")<br />\| logreduce(mesg) by webserver\_farm limit=25<br />\| \_count as count \| fields -\_count \| sort by count, signature asc|
|Apache/Metrics|Logging|Metrics|Apache/Metrics/Apache - Request State Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_scboard\_logging webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| sum by webserver\_farm|
|Apache/Logs|Media Types Served|Logs|Apache/Logs/Apache - Visitor Traffic Insight|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| parse regex field=url "^/[^\\?]+?\\.(?\<type\>[a-zA-Z]{2,4})\$" nodrop<br />\| parse regex field=url "/\\S+?(?\<email\_prefix\>(?:%40\|@)[^.]+?)\\.\\w+" nodrop <br />\| where email\_prefix = "" and !isBlank(type)<br />\| count as count by type<br />\| sort count, type asc|
|Apache/Logs|Messages by Log Level - Over Time|Logs|Apache/Logs/Apache - Error Log Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}}<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />// Error Logs<br />\| parse regex field=mesg "^\\[[^]]\*]\\s\\[(?\<log\_level\>[a-z]+)\\]" nodrop<br />\| parse regex field=mesg "\\[[^]]\*]\\s\\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] " nodrop<br />\| where !isEmpty(log\_level) and log\_level not in ("en")<br />\| timeslice 1h<br />\| count by \_timeslice, log\_level<br />\| transpose row \_timeslice column log\_level|
|Apache/Logs|Non 200 Response Status Codes|Logs|Apache/Logs/Apache - Web Server Operations|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where !(status\_code matches "2\*")<br />\| count as count by status\_code <br />\| sort by count, status\_code asc|
|Apache/Logs|Number of Hits by Server - One Day Time Comparison|Logs|Apache/Logs/Apache - Trends|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| count as Number\_of\_Hits by \_sourceHost  <br />\| compare with timeshift 1d|
|Apache/Logs|Number of Requests by Client - One Day Time Comparison|Logs|Apache/Logs/Apache - Error Log Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}}<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg " \\[(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg " \\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg "\\[client (?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| where !isEmpty(log\_level) and log\_level not in ("en") and !isEmpty(src\_ip)<br />\| count as count by src\_ip<br />\| sort by count<br />\| compare with timeshift 1d|
|Apache/Logs|Number of Visitors|Logs|Apache/Logs/Apache - Outlier Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where !isEmpty(src\_ip)<br />\| timeslice {{timeslice}}<br />\| count as hits by \_timeslice <br />\| sort \_timeslice asc<br />\| outlier hits window={{window}}, threshold={{threshold}}, consecutive={{consecutive}}, direction=+|
|Apache/Metrics|Open|Metrics|Apache/Metrics/Apache - Request State Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_scboard\_open webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| sum by webserver\_farm|
|Apache/Logs|Popular Mobile Device Versions|Logs|Apache/Logs/Apache - Visitor Access Types|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP (iphone or ipad or android or samsung)<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| parse regex field=mesg "\\((?\<device\>iPhone).+? CPU iPhone OS (?\<version\>.+?) like Mac"  nodrop <br />\| parse regex field=mesg "\\((?\<device\>iPad).+? CPU OS (?\<version\>.+?) like Mac"  nodrop <br />\| parse regex field=mesg " (?\<device\>Android) (?\<version\>[\\d\\.]+)" nodrop <br />\| parse regex field=mesg "(?\<device\>SAMSUNG).+?(?\<version\>(?:GT-\\w+\|SGH-\\w+\|SPH-\\w+\|SCH-\\w+))" nodrop<br />\| where device != ""<br />\| count as count by device, version <br />\| transpose row version column device|
|Apache/Metrics|Reading|Metrics|Apache/Metrics/Apache - Request State Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_scboard\_reading webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| sum by webserver\_farm|
|Apache/Metrics|Request Per Second|Metrics|Apache/Metrics/Apache - Server Status|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_ReqPerSec webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| avg by webserver\_farm|
|Apache/Metrics|Request Per Second|Metrics|Apache/Metrics/Apache - Server Status|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_ReqPerSec webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| avg by webserver\_farm|
|Apache|Request Per Second|Metrics|Apache/Apache - Overview|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_ReqPerSec webserver\_farm={{webserver\_farm}} server=\* port=\* \| avg by webserver\_farm|
|Apache/Logs|Responses Over Time|Logs|Apache/Logs/Apache - Trends|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| if(status\_code matches "2\*", 1, 0) as successes <br />\| if(status\_code matches "3\*", 1, 0) as redirects <br />\| if(status\_code matches "4\*", 1, 0) as client\_errors <br />\| if(status\_code matches "5\*", 1, 0) as server\_errors <br />\| timeslice by 5m<br />\| sum(successes) as successes, sum(client\_errors) as client\_errors,  sum(redirects) as redirects, sum(server\_errors) as server\_errors by \_timeslice|
|Apache|Responses Over Time|Logs|Apache/Apache - Overview|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost=\* HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| if(status\_code matches "2\*", 1, 0) as successes <br />\| if(status\_code matches "3\*", 1, 0) as redirects <br />\| if(status\_code matches "4\*", 1, 0) as client\_errors <br />\| if(status\_code matches "5\*", 1, 0) as server\_errors <br />\| timeslice by 1h <br />\| sum(successes) as successes, sum(client\_errors) as client\_errors,  sum(redirects) as redirects, sum(server\_errors) as server\_errors by \_timeslice|
|Apache/Metrics|Sending|Metrics|Apache/Metrics/Apache - Request State Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_scboard\_sending webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| sum by webserver\_farm|
|Apache/Logs|Server Errors|Logs|Apache/Logs/Apache - Outlier Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP 5\*<br />\| parse regex "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where (status\_code matches "5\*") <br />\| timeslice {{timeslice}}<br />\| count as server\_errors by \_timeslice<br />\| sort \_timeslice asc<br />\| outlier server\_errors window={{window}}, threshold={{threshold}}, consecutive={{consecutive}}, direction=+|
|Apache/Logs|Server Errors Over Time|Logs|Apache/Logs/Apache - Web Server Operations|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP (50\* or 51\* or 52\* or 53\* or 59\*)<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where status\_code matches "5\*"<br />\| timeslice 5m<br />\| count as count by \_timeslice, status\_code<br />\| transpose row \_timeslice column status\_code as \*|
|Apache/Metrics|Starting|Metrics|Apache/Metrics/Apache - Request State Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_scboard\_starting webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| sum by webserver\_farm|
|Apache/Logs|Threat Count|Logs|Apache/Logs/Apache - Threat Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| count as ip\_count by src\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=src\_ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum(ip\_count) as threat\_count|
|Apache/Logs|Threat Locations|Logs|Apache/Logs/Apache - Threat Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| count as ip\_count by src\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=src\_ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = src\_ip<br />\| where !isNull(latitude)|
|Apache/Logs|Threats by Actors|Logs|Apache/Logs/Apache - Threat Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| count as ip\_count by src\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=src\_ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum (ip\_count) as threat\_count by Actor|
|Apache/Logs|Threats by Malicious Confidence|Logs|Apache/Logs/Apache - Threat Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| count as ip\_count by src\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=src\_ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum (ip\_count) as threat\_count by malicious\_confidence|
|Apache/Logs|Threats by Source|Logs|Apache/Logs/Apache - Threat Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| count as ip\_count by src\_ip, \_source<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=src\_ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| \_source as source<br />\| sum (ip\_count) as threat\_count by source |
|Apache/Logs|Top 10 Bots Observed|Logs|Apache/Logs/Apache - Web Server Operations|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP ("Googlebot" OR "AskJeeves" OR "Digger" OR "Lycos"<br />OR "msnbot" OR "Inktomi Slurp" OR "Yahoo" OR "Nutch" OR "bingbot" OR<br />"BingPreview" OR "Mediapartners-Google" OR "proximic" OR "AhrefsBot" OR<br />"AdsBot-Google" OR "Ezooms" OR "AddThis.com" OR "facebookexternalhit" OR<br />"MetaURI" OR "Feedfetcher-Google" OR "PaperLiBot" OR "TweetmemeBot" OR<br />"Sogou web spider" OR "GoogleProducer" OR "RockmeltEmbedder" OR<br />"ShareThisFetcher" OR "YandexBot" OR "rogerbot-crawler" OR "ShowyouBot" OR "Baiduspider" OR "Sosospider" OR "Exabot")<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>facebook)externalhit?\\W+" nodrop<br />\| parse regex field=user\_agent "Feedfetcher-(?\<bot\_name\>Google?)\\S+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>PaperLiBot?)/.+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>TweetmemeBot?)/.+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>msn?)bot\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Nutch?)-.+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Google?)bot\\W" nodrop<br />\| parse regex field=user\_agent "Feedfetcher-(?\<bot\_name\>Google?)\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Yahoo?)!\\s+Slurp[;/].+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>bing?)bot\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Bing?)Preview\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Sogou?)\\s+web\\s" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Yandex?)Bot\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>rogerbot?)\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>AddThis\\.com?)\\s+robot\\s+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>ShareThis?)Fetcher/.+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Ahrefs?)Bot/.+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>MetaURI?)\\s+API/.+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Showyou?)Bot\\s+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Google?)Producer;" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Ezooms?)\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Rockmelt?)Embedder\\s+" nodrop <br />\| parse regex field=user\_agent "(?\<bot\_name\>Sosospider?)\\W" nodrop <br />\| parse regex field=user\_agent "(?\<bot\_name\>Baidu?)spider" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Exabot?)\\W" nodrop<br />\| where bot\_name != ""<br />\| if (bot\_name="bing", "Bing", bot\_name) as bot\_name<br />\| count as count by bot\_name<br />\| sort by count, bot\_name asc|
|Apache/Logs|Top 10 Errors from Error Log Files|Logs|Apache/Logs/Apache - Web Server Operations|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}}<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />// Error Logs<br />\| parse regex field=mesg "^\\[[^]]\*]\\s\\[(?\<log\_level\>[a-z]+)\\]" nodrop<br />\| parse regex field=mesg "\\[[^]]\*]\\s\\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] " nodrop<br />\| parse field=mesg "[error] \*" as error\_mesg nodrop<br />\| parse field=mesg "[client \*] \*" as src\_ip, error\_mesg nodrop<br />\| where !isBlank(error\_mesg) and !isBlank(log\_level)<br />\| count as count by error\_mesg <br />\| sort count, error\_mesg asc<br />\| limit 10|
|Apache/Logs|Top 10 Messages|Logs|Apache/Logs/Apache - Error Log Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}}<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "(?:\\d{4}\\]\|\\[client .+?\\]\|\\[[a-z0-9:-]+?\\]) (?\<reason\>[a-zA-Z].+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?:.+?) (?\<file\>/[a-zA-Z0-9\\.\_].+?)(?:\$\|, \|: \| on line\| (?i)http/1.(?:0\|1))"  nodrop <br />\| parse regex field=mesg " (?\<file\>[a-zA-Z]:\\\\.+?)(?:\$\|, \|: \| on line)" nodrop <br />\| parse regex field=mesg "\\[client (?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop <br />\| parse regex field=mesg "\\[client .+?:(?\<src\_port\>[0-9][0-9]+)\\] " nodrop <br />\| parse regex field=mesg "referer: (?\<referrer\>.+)\$"  nodrop <br />\| parse regex field=mesg " \\[(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg "(?\<reason\>Forbidden): (?\<file\>.+?) doesn't point to a file or directory" nodrop <br />\| parse regex field=mesg "(?\<reason\>Handler for .+? returned invalid result code [0-9]+)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid [a-zA-Z]+ in request) (?\<request\>.+?)(?:\$\| - .+\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Invalid [a-zA-Z]+ in request .+? (?\<url\>/.+?)(?:\$\|, \|: \| (?i)http/1.(?:0\|1))" nodrop <br />\| parse regex field=mesg "(?\<reason\>Script timed out before returning headers): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Symbolic link not allowed.\*?): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>configuration error):  couldn't .+?: (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>dir\_walk error), .+? filename (?:path\|)(?\<file\>.+?) for uri (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>handler .+? not found) for: (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>need Auth.+?): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Cannot map (?\<request\>.+?) to file" nodrop <br />\| parse regex field=mesg "(?:\\d{4}\\]\|\\[client .+?\\]\|\\[[a-z0-9:-]+?\\]) (?\<file\>(?:/[a-zA-Z0-9\\.\_].+?\|[a-zA-Z]:\\\\.+?)) pcfg\_openfile: (?\<reason\>unable to check htaccess file), ensure it is readable" nodrop <br />\| parse regex field=mesg "access to (?\<url\>.+?) (?:denied\|failed)" nodrop <br />\| parse regex field=mesg "access to (?\<file\>.+?) (?:denied\|failed)" nodrop <br />\| parse regex field=mesg "access to (?\<url\>.+?) failed; stat of '(?\<file\>.+?)' failed." nodrop <br />\| parse regex field=mesg " \\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg " \\[pid (?\<process\_id\>[0-9]+)\\] (?\<reason\>[a-zA-Z].\*)" nodrop <br />\| parse regex field=mesg " \\[pid (?\<process\_id\>[0-9]+):tid (?\<thread\_id\>[0-9]+)\\]" nodrop <br />\| parse regex field=mesg "(?\<reason\>Buggy authn provider failed to set user) for (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "Evaluation of .\*?expression from (?\<file\>.+?):[0-9]+ " nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid status line from script) '(?\<file\>.+?)':" nodrop <br />\| parse regex field=mesg "(?\<reason\>client submitted cookie '.\*?' more than once): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>malformed header from script) '(?\<file\>.+?)':" nodrop <br />\| parse regex field=mesg "\\[client (?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}) (?\<reason\>[a-zA-Z].+?)" nodrop <br />\| parse regex field=mesg " \\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] (?\<reason\>[a-zA-Z].\*)" nodrop <br />\| parse regex field=mesg " \\[pid (?\<process\_id\>[0-9]+):tid (?\<thread\_id\>[0-9]+)\\] (?\<reason\>[a-zA-Z].\*)" nodrop <br /><br />// 2.2 specific<br />\| parse regex field=mesg "(?\<reason\>client used wrong authentication scheme): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop<br />\| parse regex field=mesg "(?\<reason\>File does not exist): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Invalid [a-zA-Z]+ in request) (?\<request\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>Premature end of script headers): (?\<file\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| parse regex field=mesg "(?\<reason\>client sent HTTP/1.1 request without hostname) \\(.+?\\): (?\<url\>.+?)(?:\$\|, referer.+\$)" nodrop <br />\| where !isEmpty(log\_level) and log\_level not in ("en") and !isEmpty(reason)<br />\| count as count by reason<br />\| sort by count, reason asc \| limit 10|
|Apache/Logs|Top 10 Search Terms from Popular Search Engines|Logs|Apache/Logs/Apache - Visitor Traffic Insight|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP (google OR bing OR aol OR ask OR yahoo) ("p=" OR "q=" OR "wd=" OR "searchfor=")<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| parse regex field=referrer "(?:\\?\|&)(?:p\|q\|wd\|searchfor)=(?\<search\_term\>[^=]+?)(?:&\|\$)" nodrop <br />\| where !isBlank(search\_term)<br />\| urldecode(search\_term)<br />\| if(referrer matches "\*google.\*","Google","") as engine<br />\| if(referrer matches "\*bing.\*","Bing",engine) as engine<br />\| if(referrer matches "\*ask.com\*","Ask.com",engine) as engine<br />\| if(referrer matches "\*aol.\*","AOL",engine) as engine<br />\| if(referrer matches "\*yahoo.\*","Yahoo",engine) as engine<br />\| where !isBlank(engine) <br />\| count as count by search\_term<br />\| sort count, search\_term asc<br />\| limit 10|
|Apache/Logs|Top 10 Threats|Logs|Apache/Logs/Apache - Threat Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| count as threat\_count by src\_ip, method, status\_code, size, referrer, user\_agent, url<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=src\_ip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum(threat\_count) as request\_count by src\_ip, method, status\_code, size, url, referrer, user\_agent, malicious\_confidence, actor<br />\| sort by request\_count<br />\| limit 10|
|Apache|Top 10 URLs with 4xx Errors|Logs|Apache/Apache - Overview|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost=\* HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where status\_code matches "4\*"<br />\| count as count by url, status\_code<br />\| sort by count, url asc \| limit 10|
|Apache|Top 10 URLs with 5xx Errors|Logs|Apache/Apache - Overview|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost=\* HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where status\_code matches "5\*"<br />\| count as count by url, status\_code<br />\| sort by count, url asc \| limit 10|
|Apache/Logs|Top 5 Clients Causing 4xx Errors|Logs|Apache/Logs/Apache - Web Server Operations|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP (40\* OR 41\* OR 42\* OR 43\* OR 44\* or 45\* or 49\*)<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where status\_code matches "4\*"<br />\| count as count by src\_ip<br />\| sort count, src\_ip asc<br />\| limit 5|
|Apache/Logs|Top 5 Clients Causing 5xx Errors|Logs|Apache/Logs/Apache - Web Server Operations|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP (40\* OR 41\* OR 42\* OR 43\* OR 44\* or 45\* or 49\*)<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where status\_code matches "5\*"<br />\| count as count by src\_ip<br />\| sort count, src\_ip asc<br />\| limit 5|
|Apache/Logs|Top 5 Clients Causing Errors|Logs|Apache/Logs/Apache - Error Log Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}}<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg " \\[(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg " \\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] " nodrop <br />\| parse regex field=mesg "\\[client (?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "\\[client (?\<src\_ip\>[a-f0-1:]\*)\\] " nodrop <br />\| where !isEmpty(log\_level) and log\_level not in ("en") and !isEmpty(src\_ip)<br />\| count as count by src\_ip \| sort by count, src\_ip asc<br />\| limit 5|
|Apache|Top 5 Critical Messages|Logs|Apache/Apache - Overview|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost=\* (emerg or alert or crit) <br />// Error Logs<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^\\[[^]]\*]\\s\\[(?\<log\_level\>[a-z:]+)\\]" nodrop<br />\| parse regex field=mesg "\\[[^]]\*]\\s\\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] " nodrop<br />\| where log\_level in ("emerg", "alert", "crit") // emerg:	System is unusable, alert:	Action must be taken immediately, crit	Critical conditions<br />\| parse field=mesg "[error] \*" as error\_mesg nodrop<br />\| parse field=mesg "[client \*] \*" as src\_ip, error\_mesg<br />\| parse regex field=mesg " \\[(?\<module\>[a-z-\_]+):(?\<log\_level\>[a-z]+)\\] (?\<error\_mesg\>.\*)" nodrop <br />\| parse regex field=mesg " \\[pid (?\<process\_id\>[0-9]+)\\] (?\<error\_mesg\>[a-zA-Z].\*)" nodrop <br />\| parse regex field=mesg " \\[pid (?\<process\_id\>[0-9]+):tid (?\<thread\_id\>[0-9]+)\\] (?\<error\_mesg\>[a-zA-Z].\*)" nodrop <br />\| count as count by error\_mesg, webserver\_farm<br />\| sort by count<br />\| limit 5|
|Apache/Logs|Top 5 Highly Malicious URLs|Logs|Apache/Logs/Apache - Threat Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| count as ip\_count by src\_ip, url<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=src\_ip <br />\| where malicious\_confidence matches "high"<br />\| count by url<br />\| limit 5|
|Apache/Logs|Top 5 Referrers|Logs|Apache/Logs/Apache - Visitor Traffic Insight|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where !isBlank(referrer)<br />\| count as count by referrer<br />\| sort by count, referrer asc<br />\| limit 5 |
|Apache/Logs|Top 5 Urls|Logs|Apache/Logs/Apache - Visitor Traffic Insight|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where !isBlank(url)<br />\| count as count by url<br />\| sort by count, url asc<br />\| limit 5|
|Apache/Logs|Top 5 URLs Causing 4xx Responses|Logs|Apache/Logs/Apache - Web Server Operations|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where status\_code matches "4\*"<br />\| count as count by url<br />\| sort count, url asc<br />\| limit 5|
|Apache/Logs|Top 5 URLs Causing 5xx Responses|Logs|Apache/Logs/Apache - Web Server Operations|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where status\_code matches "5\*"<br />\| count as count by url<br />\| sort count, url asc<br />\| limit 5|
|Apache/Metrics|Total Accesses|Metrics|Apache/Metrics/Apache - Server Status|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_TotalAccesses webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| sum by webserver\_farm|
|Apache/Metrics|Total Duration|Metrics|Apache/Metrics/Apache - Server Status|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_TotalDuration webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| sum by webserver\_farm|
|Apache/Metrics|Total KB Sent and Received|Metrics|Apache/Metrics/Apache - Server Status|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_TotalkBytes webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| sum by webserver\_farm|
|Apache/Logs|Traffic Distribution by Server|Logs|Apache/Logs/Apache - Trends|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| timeslice 5m<br />\| count by \_timeslice, \_sourceHost  <br />\| transpose row \_timeslice column \_sourceHost|
|Apache/Logs|Traffic Volume and Bytes Served|Logs|Apache/Logs/Apache - Trends|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| where size != "-" and !isEmpty(size)<br />\| (size/(1048576\*1000)) as gbytes <br />\| timeslice 5m<br />\| count as hits, sum(gbytes) as gbytes by \_timeslice |
|Apache/Logs|Unique Visitors|Logs|Apache/Logs/Apache - Visitor Access Types|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| count\_distinct(src\_ip) as unique\_visitors|
|Apache/Logs|United States|Logs|Apache/Logs/Apache - Visitor Locations|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| parse regex "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| count by src\_ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = src\_ip<br />\| where country\_name = "United States"|
|Apache|Uptime|Metrics|Apache/Apache - Overview|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_ServerUptimeSeconds webserver\_farm={{webserver\_farm}} server=\* port=\* \| filter latest \> 0 \| sum by webserver\_farm \| eval \_value / (60\*60\*24)|
|Apache/Metrics|Uptime|Metrics|Apache/Metrics/Apache - Server Status|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_ServerUptimeSeconds webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| filter latest \> 0 \| sum \| eval \_value / (60\*60)|
|Apache|Visitor Locations|Logs|Apache/Apache - Overview|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost=\* HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| count by src\_ip<br />\| where !isBlank(src\_ip)<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = src\_ip<br />\| where !isNull(latitude)|
|Apache/Logs|Visitor Locations - One Day Time Comparison|Logs|Apache/Logs/Apache - Trends|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| count src\_ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = src\_ip<br />\| where !isNull(latitude) and !isEmpty(country\_name)<br />\| sum(\_count) as Visitors\_Locations by country\_name<br />\| sort Visitors\_Locations <br />\| compare with timeshift 1d<br />\| limit 10|
|Apache/Logs|Visitor Platforms|Logs|Apache/Logs/Apache - Visitor Access Types|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| if (user\_agent matches "\*iPad\*" OR user\_agent matches "\*iPhone\*" OR user\_agent matches "\*Android\*" OR user\_agent matches "\*BlackBerry\*" OR user\_agent matches "\*Galaxy\*" OR user\_agent matches "LGE-\*" OR user\_agent matches "SCH-\*" OR user\_agent matches "\*HUAWEI-\*" OR user\_agent matches "\*SAMSUNG\*" OR user\_agent matches "\*samsung\*" OR user\_agent matches "Dalvik/\*" OR user\_agent matches "Nokia\*" OR user\_agent matches "LG-\*" OR user\_agent matches "\*CFNetwork\*"  OR user\_agent matches "\*UP.Browser/\*" OR user\_agent matches "\*QQ\*rowser\*" OR user\_agent matches "\*NetFront/\*" OR user\_agent matches "\*Windows Phone\*" OR user\_agent matches "\*Mobile Safari\*" OR user\_agent matches "\*iemobile\*","Mobile","") as type<br />\| if (user\_agent matches "\*Windows\*" OR user\_agent matches "\*Win64\*" OR user\_agent matches "\*Win32\*" OR user\_agent matches "\*i686\*" OR user\_agent matches "\*x86\*","PC",type) as type<br />\| if (user\_agent matches "\*Macintosh\*" OR user\_agent matches "\*Mac OS\*","Mac",type) as type<br />\| if (type = "", "bots/unknown", type) as type<br />\| count type<br />\| sort by \_count, type asc|
|Apache/Logs|Visitor Platforms Over Time|Logs|Apache/Logs/Apache - Visitor Access Types|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| if (user\_agent matches "\*iPad\*" OR user\_agent matches "\*iPhone\*" OR user\_agent matches "\*Android\*" OR user\_agent matches "\*BlackBerry\*" OR user\_agent matches "\*Galaxy\*" OR user\_agent matches "LGE-\*" OR user\_agent matches "SCH-\*" OR user\_agent matches "\*HUAWEI-\*" OR user\_agent matches "\*SAMSUNG\*" OR user\_agent matches "\*samsung\*" OR user\_agent matches "Dalvik/\*" OR user\_agent matches "Nokia\*" OR user\_agent matches "LG-\*" OR user\_agent matches "\*CFNetwork\*"  OR user\_agent matches "\*UP.Browser/\*" OR user\_agent matches "\*QQ\*rowser\*" OR user\_agent matches "\*NetFront/\*" OR user\_agent matches "\*Windows Phone\*" OR user\_agent matches "\*Mobile Safari\*" OR user\_agent matches "\*iemobile\*","Mobile","") as type<br />\| if (user\_agent matches "\*Windows\*" OR user\_agent matches "\*Win64\*" OR user\_agent matches "\*Win32\*" OR user\_agent matches "\*i686\*" OR user\_agent matches "\*x86\*","PC",type) as type<br />\| if (user\_agent matches "\*Macintosh\*" OR user\_agent matches "\*Mac OS\*","Mac",type) as type<br />\| if (type = "", "bots/unknown", type) as type<br />\| timeslice 5m<br />\| count by \_timeslice, type<br />\| transpose row \_timeslice column type|
|Apache/Logs|Visits by Country Over Time|Logs|Apache/Logs/Apache - Visitor Locations|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| parse regex "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = src\_ip<br />\| where !isNull(latitude) and !isEmpty(country\_name)<br />\| timeslice 5m<br />\| count by \_timeslice, country\_name<br />\| transpose row \_timeslice column country\_name as \* |
|Apache/Logs|Visits by US Regions Over Time|Logs|Apache/Logs/Apache - Visitor Locations|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| parse regex "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| timeslice 5m<br />\| count by src\_ip, \_timeslice<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = src\_ip<br />\| where !isNull(latitude) and country\_name = "United States" AND !isEmpty(region)<br />\| sum(\_count) as count by \_timeslice, region<br />\| transpose row \_timeslice column region as \* |
|Apache/Metrics|Waiting|Metrics|Apache/Metrics/Apache - Request State Analysis|webserver\_system=apache webserver\_farm=\* webserver\_system=apache metric=apache\_scboard\_waiting webserver\_farm={{webserver\_farm}} server={{server}} port={{port}} host={{host}} \| sum by webserver\_farm|
|Apache/Logs|Worldwide|Logs|Apache/Logs/Apache - Visitor Locations|webserver\_system=apache webserver\_farm=\* webserver\_system=apache webserver\_farm={{webserver\_farm}} \_sourceHost={{host}} HTTP<br />\| parse regex "^(?\<src\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)" nodrop<br />\| parse regex field=mesg "(?\<method\>[A-Z]+)\\s(?\<url\>\\S+)\\sHTTP\\/[\\d\\.]+[\\\\n]\*\\"\\s(?\<status\_code\>\\d+)\\s(?\<size\>[\\d-]+)\\s\\"(?\<referrer\>.\*?)\\"\\s\\"(?\<user\_agent\>.+?)\\".\*" nodrop<br />\| count by src\_ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = src\_ip<br />\| where !isNull(latitude)|

