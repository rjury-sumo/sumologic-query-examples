# MariaDB - OpenTelemetry

## Searches

### Log Searches

- **Avg Execution Time by Slow SQL Cmds**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Slow Queries 
- **Crash Recovery Attempts Over Time**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Error Logs 
- **Error Log Type Over Time**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Error Logs 
- **Errors**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Overview 
- **Excessive Slow Queries (>=15 secs)**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Overview 
- **Excessive Slow Queries by Host**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Slow Queries 
- **Excessive Slow Queries Over Time**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Slow Queries 
- **Failed Login Attempts**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Failed Logins 
- **Failed Login Attempts**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Overview 
- **Failed Login Attempts - Details**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Failed Logins 
- **Failed Login Attempts - Location**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Overview 
- **Failed Login Attempts - Location**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Failed Logins 
- **Failed Login Over Time**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Failed Logins 
- **Log Reduce**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Error Logs 
- **Replication Errors**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Overview 
- **Replication Start-Stop Events**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Replication 
- **Replication Status Over Time**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Replication 
- **Server Start and Shutdown Events Over Time**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Error Logs 
- **Slow Queries by Client IPs**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Slow Queries 
- **Slow Queries by Hosts**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Slow Queries 
- **Slow Queries by Users**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Slow Queries 
- **Slow Queries Over Time**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Slow Queries 
- **Slow Queries Over Time**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Overview 
- **Slow Query by Cmd Type**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Slow Queries 
- **Stopped Servers**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Error Logs 
- **Top 10 Errors**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Overview 
- **Top 10 Excessive Slow Queries by Frequency**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Slow Queries 
- **Top 10 Hosts by Failed Login Attempts**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Failed Logins 
- **Top 10 Slow Queries by Average Execution Time**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Slow Queries 
- **Top 10 Users by Failed Login Attempts**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Failed Logins 
- **Top 10 Warnings**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Overview 
- **Top Errors**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Error Logs 
- **Top Reasons for Replication Failures**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Replication 
- **Top Warnings**: from Dashboard: Installed Apps/MariaDB - OpenTelemetry/MariaDB - Error Logs

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|MariaDB - OpenTelemetry|Avg Execution Time by Slow SQL Cmds|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Slow Queries| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "User@Host" "Query\_time"<br />\| json "log" nodrop<br />\| if (isEmpty(log), \_raw, log) as mariadb\_log\_message<br />\| parse regex field=mariadb\_log\_message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" // Pttrn2-vrtn4<br />\| parse regex field=query\_block "SET timestamp=(?\<set\_timestamp\>\\d\*);(?:\\\\n\|\\n)(?\<sql\_cmd\>[\\s\\S]\*);" nodrop<br />\| parse regex field=sql\_cmd "[^a-zA-Z]\*(?\<sql\_cmd\_type\>[a-zA-Z]+)(?:\\s\|\\\\n\|\\n)" nodrop<br />\| parse field=sql\_cmd "# administrator command: \*" as admn\_sql\_cmd<br />\| if (sql\_cmd matches "# administrator command: \*", admn\_sql\_cmd, sql\_cmd\_type) as sql\_cmd\_type<br />\| toUpperCase(sql\_cmd\_type)<br />\| fields -query\_block<br />\| timeslice 1h<br />\| avg(query\_time) as avg\_query\_time group by \_timeslice, sql\_cmd\_type<br />\| transpose row \_timeslice column sql\_cmd\_type|
|MariaDB - OpenTelemetry|Crash Recovery Attempts Over Time|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Error Logs| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "Crash recovery"<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| host.name as Host<br />\| timeslice 1h<br />\| count as recovery\_attempts by \_timeslice|
|MariaDB - OpenTelemetry|Error Log Type Over Time|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Error Logs| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} (Error or Warning or Note or Info or Information or DEBUG or CRITICAL)<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| where touppercase(ErrorLogtype) in ("ERROR", "WARNING", "NOTE", "INFO", "INFORMATION", "DEBUG", "CRITICAL")<br />\| timeslice 1h<br />\| count by \_timeslice, ErrorLogtype<br />\| transpose row \_timeslice column ErrorLogType|
|MariaDB - OpenTelemetry|Errors|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Overview| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "[ERROR]"<br />\| json "log" nodrop<br />\| if (isEmpty(log), \_raw, log) as mariadb\_log\_message<br />\| parse regex field=mariadb\_log\_message "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)"<br />\| where ErrorLogtype="ERROR" \| count as error\_count|
|MariaDB - OpenTelemetry|Excessive Slow Queries (\>=15 secs)|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Overview| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "User@Host" "Query\_time"<br />\| json "log" nodrop<br />\| if (isEmpty(log), \_raw, log) as mariadb\_log\_message<br />\| parse regex field=mariadb\_log\_message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" // Pttrn2-vrtn4<br />\| fields -query\_block<br />\| num(query\_time)<br />\| 15 as threshold // customize if need different value. As an example query taking more than 15 Seconds is considered as Excessive Slow. <br />\| where query\_time \>= threshold \| count as queries\_count|
|MariaDB - OpenTelemetry|Excessive Slow Queries by Host|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Slow Queries| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "User@Host" "Query\_time"<br />\| json "log" nodrop<br />\| if (isEmpty(log), \_raw, log) as mariadb\_log\_message<br />\| parse regex field=mariadb\_log\_message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" // Pttrn2-vrtn4<br />\| num(query\_time)<br />\| 15 as threshold // customize if need different value. As an example query taking more than 15 Seconds is considered as Excessive Slow. <br />\| where (query\_time \>= threshold)<br />\| if (isEmpty(pod),host.name,pod) as host.name<br />\| fields -query\_block<br />\| count as queries\_count by host.name \| sort by queries\_count|
|MariaDB - OpenTelemetry|Excessive Slow Queries Over Time|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Slow Queries| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "User@Host" "Query\_time"<br />\| json "log" nodrop<br />\| if (isEmpty(log), \_raw, log) as mariadb\_log\_message<br />\| parse regex field=mariadb\_log\_message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" // Pttrn2-vrtn4<br />\| num(query\_time)<br />\| 15 as threshold // customize if need different value. As an example query taking more than 15 Seconds is considered as Excessive Slow. <br />\| where query\_time \>= threshold <br />\| timeslice 1h<br />\| count as queries\_count by \_timeslice|
|MariaDB - OpenTelemetry|Failed Login Attempts|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Failed Logins| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "[Warning]" "Access denied for user"<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| parse field=ErrorMsg "Access denied for user '\*'@'\*' (using password: YES)" as user, ip\_address<br />\| count as failed\_login\_event\_count|
|MariaDB - OpenTelemetry|Failed Login Attempts|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Overview| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "Access denied for user"<br />\| json "log" nodrop<br />\| if (isEmpty(log), \_raw, log) as mariadb\_log\_message<br />\| parse field=mariadb\_log\_message "Access denied for user '\*'@'\*' (using password: YES)" as user, ip\_address<br />\| count as failed\_login\_count|
|MariaDB - OpenTelemetry|Failed Login Attempts - Details|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Failed Logins| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "[Warning]" "Access denied for user"<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| parse field=ErrorMsg "Access denied for user '\*'@'\*' (using password: YES)" as user, ip\_address<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, user, ip\_address, db.cluster.name<br />\| sort by \_timeslice \| limit 10|
|MariaDB - OpenTelemetry|Failed Login Attempts - Location|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Overview| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "Access denied for user"<br />\| json "log" nodrop<br />\| if (isEmpty(log), \_raw, log) as mariadb\_log\_message<br />\| parse field=mariadb\_log\_message "Access denied for user '\*'@'\*' (using password: YES)" as user, ip\_address<br />\| count as event\_count by ip\_address<br />\| lookup latitude, longitude, country\_name, state, city from geo://location on ip = ip\_address<br />\| where !isNull(latitude)|
|MariaDB - OpenTelemetry|Failed Login Attempts - Location|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Failed Logins| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "[Warning]" "Access denied for user"<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| parse field=ErrorMsg "Access denied for user '\*'@'\*' (using password: YES)" as user, ip\_address<br />\| count as event\_count by ip\_address<br />\| lookup latitude, longitude, country\_name, state, city from geo://location on ip = ip\_address<br />\| where !isNull(latitude)|
|MariaDB - OpenTelemetry|Failed Login Over Time|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Failed Logins| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}}  "[Warning]" "Access denied for user"<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| parse field=ErrorMsg "Access denied for user '\*'@'\*' (using password: YES)" as user, ip\_address<br />\| timeslice 1h<br />\| count as event\_count by \_timeslice|
|MariaDB - OpenTelemetry|Log Reduce|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Error Logs| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} ("ERROR" or "CRITICAL") <br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| logreduce(mesg) by db.cluster.name limit=20<br />\| \_count as count \| fields -\_count \| sort by count, signature asc|
|MariaDB - OpenTelemetry|Replication Errors|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Overview| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} (("[ERROR]" and ("Slave I/O" or "Error reading packet from server" or "Slave SQL")) or "[Note] Error reading relay log event: slave SQL thread was killed")<br />\| json "log" nodrop<br />\| if (isEmpty(log), \_raw, log) as mariadb\_log\_message<br />\| parse regex field=mariadb\_log\_message "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| count as replication\_failure\_count|
|MariaDB - OpenTelemetry|Replication Start-Stop Events|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Replication| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "[Note]" "SQL thread"<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| parse field=ErrorMsg "Slave SQL thread initialized, \* replication in log '\*' at position \*, relay log '\*' position: \*" as State,ReplicationLog,ReplicationPosition,ReplayLog,RelayPosition nodrop<br />\| parse field=ErrorMsg "Slave SQL thread exiting, replication \* in log '\*' at position \*" as state,ReplicationLog,RelayPosition nodrop<br />\| where state in ("starting", "stopped")<br />\| timeslice 1h<br />\| count as event\_count by \_timeslice, state<br />\| transpose row \_timeslice column state as starting, stopped<br />\| (starting+stopped)/2 as halfway\_count|
|MariaDB - OpenTelemetry|Replication Status Over Time|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Replication| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} ("[Note]" or ("[ERROR]" ("Slave I/O" or "Error reading packet from server" or "Slave SQL")))<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| parse field=ErrorMsg "Slave SQL thread initialized, \* replication in log '\*' at position \*, relay log '\*' position: \*" as State,ReplicationLog,ReplicationPosition,ReplayLog,RelayPosition nodrop<br />\| parse field=ErrorMsg "Slave SQL thread \* because it reached its UNTIL position \*" as State, StoppedUntilPosition nodrop<br />\| parse field=ErrorMsg "Error reading relay log event: slave SQL thread was \*" as state nodrop<br />\| if(\_raw matches "\*[ERROR] Slave I/O\*" or \_raw matches "\*[ERROR] Error reading packet from server\*"  or \_raw matches "\*[ERROR] Slave SQL\*","failed",state) as state<br />\| where state in ("starting", "stopped", "killed", "failed")<br />\| timeslice 1h<br />\| count by \_timeslice, state<br />\| transpose row \_timeslice column state<br />\| fillmissing timeslice(1h)|
|MariaDB - OpenTelemetry|Server Start and Shutdown Events Over Time|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Error Logs| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} ("ready for connections" or "Shutdown complete" or "Terminated." or "Normal shutdown" or "Shutting down" or "starting as process")<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| if (ErrorMsg matches "\*ready for connections\*", "Up","Unknown") as server\_status<br />\| if (ErrorMsg matches "\*Terminated.\*", "Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Normal shutdown\*", "Shutting Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Shutting down\*", "Shutting Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Shutdown complete\*", "Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*starting as process\*", "Starting",server\_status) as server\_status<br />\| timeslice 15m<br />\| count by \_timeslice, server\_status<br />\| transpose row \_timeslice column server\_status|
|MariaDB - OpenTelemetry|Slow Queries by Client IPs|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Slow Queries| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "User@Host" "Query\_time"<br />\| json "log" nodrop<br />\| if (isEmpty(log), \_raw, log) as mariadb\_log\_message<br />\| parse regex field=mariadb\_log\_message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ \\s\\[(?\<ip\_addr\>\\S\*?)\\]" nodrop<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ (?\<host\_name\>\\S+)\\s\\[(?\<ip\_addr\>\\S\*?)\\]" nodrop // Pttrn1-vrtn1<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @\\s+\\[(?\<ip\_addr\>\\S\*?)\\]\\s+Id:\\s+(?\<Id\>\\d{1,10})" nodrop // Pttrn1-vrtn2<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ (?\<host\_name\>\\S+)\\s\\[(?\<ip\_addr\>\\S\*?)\\]\\s+Id:\\s+(?\<Id\>\\d{1,10})" // Pttrn1-vrtn3<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" nodrop // Pttrn2-vrtn4<br />\| num(query\_time) as query\_time<br />\| where query\_time \>= {{slow\_query\_latency}}<br />\| fields -query\_block<br />\| count as frequency by ip\_addr <br />\| where !isEmpty(ip\_addr)<br />\| sort by frequency|
|MariaDB - OpenTelemetry|Slow Queries by Hosts|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Slow Queries| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "User@Host" "Query\_time"<br />\| json "log" nodrop<br />\| if (isEmpty(log), \_raw, log) as mariadb\_log\_message<br />\| parse regex field=mariadb\_log\_message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" nodrop // Pttrn2-vrtn4<br />\| num(query\_time) as query\_time<br />\| where query\_time \>= {{slow\_query\_latency}}<br />\| if (isEmpty(pod),host.name,pod) as host.name<br />\| fields -query\_block<br />\| count as queries\_count by host <br />\| sort by queries\_count|
|MariaDB - OpenTelemetry|Slow Queries by Users|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Slow Queries| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "User@Host" "Query\_time"<br />\| json "log" nodrop<br />\| if (isEmpty(log), \_raw, log) as mariadb\_log\_message<br />\| parse regex field=mariadb\_log\_message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ \\s\\[(?\<ip\_addr\>\\S\*?)\\]" nodrop<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ (?\<host\_name\>\\S+)\\s\\[(?\<ip\_addr\>\\S\*?)\\]" nodrop // Pttrn1-vrtn1<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @\\s+\\[(?\<ip\_addr\>\\S\*?)\\]\\s+Id:\\s+(?\<Id\>\\d{1,10})" nodrop // Pttrn1-vrtn2<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ (?\<host\_name\>\\S+)\\s\\[(?\<ip\_addr\>\\S\*?)\\]\\s+Id:\\s+(?\<Id\>\\d{1,10})" // Pttrn1-vrtn3<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" nodrop // Pttrn2-vrtn4<br />\| num(query\_time) as query\_time<br />\| where query\_time \>= {{slow\_query\_latency}}<br />\| fields -query\_block<br />\| count as frequency by user \| sort by frequency|
|MariaDB - OpenTelemetry|Slow Queries Over Time|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Slow Queries| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "User@Host" "Query\_time"<br />\| json "log" nodrop<br />\| if (isEmpty(log), \_raw, log) as mariadb\_log\_message<br />\| parse regex field=mariadb\_log\_message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" nodrop // Pttrn2-vrtn4<br />\| num(query\_time) as query\_time<br />\| where query\_time \>= {{slow\_query\_latency}}<br />\| timeslice 1h<br />\| count as queries\_count by \_timeslice|
|MariaDB - OpenTelemetry|Slow Queries Over Time|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Overview| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "User@Host" "Query\_time"<br />\| json "log" nodrop<br />\| if (isEmpty(log), \_raw, log) as mariadb\_log\_message<br />\| parse regex field=mariadb\_log\_message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| timeslice 1h<br />\| count as queries\_count by \_timeslice|
|MariaDB - OpenTelemetry|Slow Query by Cmd Type|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Slow Queries| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "User@Host" "Query\_time"<br />\| json "log" nodrop<br />\| if (isEmpty(log), \_raw, log) as mariadb\_log\_message<br />\| parse regex field=mariadb\_log\_message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "SET timestamp=(?\<set\_timestamp\>\\d\*);(?:\\\\n\|\\n)(?\<sql\_cmd\>[\\s\\S]\*);" nodrop<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" nodrop // Pttrn2-vrtn4<br />\| num(query\_time) as query\_time<br />\| where query\_time \>= {{slow\_query\_latency}}<br />\| parse regex field=sql\_cmd "[^a-zA-Z]\*(?\<sql\_cmd\_type\>[a-zA-Z]+)(?:\\s\|\\\\n\|\\n)" nodrop<br />\| parse field=sql\_cmd "# administrator command: \*" as admn\_sql\_cmd<br />\| if (sql\_cmd matches "# administrator command: \*", admn\_sql\_cmd, sql\_cmd\_type) as sql\_cmd\_type<br />\| toUpperCase(sql\_cmd\_type)<br />\| fields -query\_block<br />\| count as frequency group by sql\_cmd\_type \| sort by frequency|
|MariaDB - OpenTelemetry|Stopped Servers|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Error Logs| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} ("ready for connections."  or "Terminated." or "Shutdown complete" or "Normal shutdown")<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| if (ErrorMsg matches "\*ready for connections.\*", "Up","Unknown") as server\_status<br />\| if (ErrorMsg matches "\*Terminated.\*", "Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Normal shutdown\*", "Shutting Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Shutdown complete\*", "Down", server\_status) as server\_status<br />\| host.name as Host<br />\| timeslice 100s<br />\| withtime server\_status \| withtime \_messagetime<br />\| most\_recent(server\_status\_withtime) as server\_status, most\_recent(\_messagetime\_withtime) as m\_time by Host, db.cluster.name<br />\| formatDate(fromMillis(m\_time), "MM-dd-yyyy HH:mm:ss:SSS Z") as event\_time<br />\| ((toMillis(now())-m\_time)/(1000\*60)) as since\_mins \| format("%.2f", since\_mins) as since\_minutes<br />\| concat ("Since ", since\_minutes, " minutes") as remark<br />\| where server\_status != "Up"<br />\| fields - m\_time, since\_mins, since\_minutes <br />\| fields Host, event\_time, server\_status, remark, db.cluster.name|
|MariaDB - OpenTelemetry|Top 10 Errors|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Overview| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "[ERROR]"<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)"<br />\| if (isEmpty(pod),host.name,pod) as host.name<br />\| ErrorMsg as error\_message<br />\| count as frequency by error\_message, db.cluster.name, host.name<br />\| sort by frequency, error\_message asc<br />\| fields db.cluster.name,host.name,error\_message,frequency<br />\| limit 10|
|MariaDB - OpenTelemetry|Top 10 Excessive Slow Queries by Frequency|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Slow Queries| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "User@Host" "Query\_time"<br />\| json "log" nodrop<br />\| if (isEmpty(log), \_raw, log) as mariadb\_log\_message<br />\| parse regex field=mariadb\_log\_message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ \\s\\[(?\<ip\_addr\>\\S\*?)\\]" nodrop<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ (?\<host\_name\>\\S+)\\s\\[(?\<ip\_addr\>\\S\*?)\\]" nodrop // Pttrn1-vrtn1<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @\\s+\\[(?\<ip\_addr\>\\S\*?)\\]\\s+Id:\\s+(?\<Id\>\\d{1,10})" nodrop // Pttrn1-vrtn2<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ (?\<host\_name\>\\S+)\\s\\[(?\<ip\_addr\>\\S\*?)\\]\\s+Id:\\s+(?\<Id\>\\d{1,10})" // Pttrn1-vrtn3<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" // Pttrn2-vrtn4<br />\| parse regex field=query\_block "# Bytes\_sent:\\s+(?\<bytes\_sent\>\\d\*)\\s+Tmp\_tables:\\s+(?\<tmp\_tables\>\\d\*)\\s+Tmp\_disk\_tables:\\s+(?\<temp\_disk\_tables\>\\d\*)\\s+Tmp\_table\_sizes:\\s+(?\<tmp\_table\_sizes\>\\d\*)\\n" nodrop // Pttrn3-vrtn1<br />\| parse regex field=query\_block "# Bytes\_sent:\\s+(?\<bytes\_sent\>\\d\*)\\n" nodrop // Pttrn3-vrtn2<br />\| parse regex field=query\_block "SET timestamp=(?\<set\_timestamp\>\\d\*);(?:\\\\n\|\\n)(?\<sql\_cmd\>[\\s\\S]\*);" nodrop<br />\| if (isEmpty(pod),host.name,pod) as host.name<br />\| fields -query\_block<br />\| count as frequency, sum(query\_time) as total\_time, min(query\_time) as min\_time, max(query\_time) as max\_time, avg(query\_time) as avg\_time, avg(rows\_examined) as avg\_rows\_examined, avg(rows\_sent) as avg\_rows\_sent, avg(Lock\_Time) as avg\_lock\_time group by sql\_cmd, host.name<br />\| where avg\_time \>= {{slow\_query\_latency}}<br />\| sort by frequency \| limit 10|
|MariaDB - OpenTelemetry|Top 10 Hosts by Failed Login Attempts|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Failed Logins| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "[Warning]" "Access denied for user"<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| parse field=ErrorMsg "Access denied for user '\*'@'\*' (using password: YES)" as user, ip\_address<br />\| count as event\_count by ip\_address<br />\| top 10 ip\_address by event\_count|
|MariaDB - OpenTelemetry|Top 10 Slow Queries by Average Execution Time|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Slow Queries| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "User@Host" "Query\_time"<br />\| json "log" nodrop<br />\| if (isEmpty(log), \_raw, log) as mariadb\_log\_message<br />\| parse regex field=mariadb\_log\_message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ \\s\\[(?\<ip\_addr\>\\S\*?)\\]" nodrop<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ (?\<host\_name\>\\S+)\\s\\[(?\<ip\_addr\>\\S\*?)\\]" nodrop // Pttrn1-vrtn1<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @\\s+\\[(?\<ip\_addr\>\\S\*?)\\]\\s+Id:\\s+(?\<Id\>\\d{1,10})" nodrop // Pttrn1-vrtn2<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ (?\<host\_name\>\\S+)\\s\\[(?\<ip\_addr\>\\S\*?)\\]\\s+Id:\\s+(?\<Id\>\\d{1,10})" // Pttrn1-vrtn3<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" // Pttrn2-vrtn4<br />\| parse regex field=query\_block "# Bytes\_sent:\\s+(?\<bytes\_sent\>\\d\*)\\s+Tmp\_tables:\\s+(?\<tmp\_tables\>\\d\*)\\s+Tmp\_disk\_tables:\\s+(?\<temp\_disk\_tables\>\\d\*)\\s+Tmp\_table\_sizes:\\s+(?\<tmp\_table\_sizes\>\\d\*)\\n" nodrop // Pttrn3-vrtn1<br />\| parse regex field=query\_block "# Bytes\_sent:\\s+(?\<bytes\_sent\>\\d\*)\\n" nodrop // Pttrn3-vrtn2<br />\| parse regex field=query\_block "SET timestamp=(?\<set\_timestamp\>\\d\*);(?:\\\\n\|\\n)(?\<sql\_cmd\>[\\s\\S]\*);" nodrop<br />\| if (isEmpty(pod),host.name,pod) as host.name<br />\| fields -query\_block<br />\| avg(query\_time) as avg\_time, sum(query\_time) as total\_time, min(query\_time) as min\_time, max(query\_time) as max\_time, avg(rows\_examined) as avg\_rows\_examined, avg(rows\_sent) as avg\_rows\_sent, avg(Lock\_Time) as avg\_lock\_time, count as frequency group by sql\_cmd, host.name<br />\| where avg\_time \>= {{slow\_query\_latency}}<br />\| sort by avg\_time \| limit 10|
|MariaDB - OpenTelemetry|Top 10 Users by Failed Login Attempts|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Failed Logins| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "[Warning]" "Access denied for user"<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| parse field=ErrorMsg "Access denied for user '\*'@'\*' (using password: YES)" as user, ip\_address<br />\| count as event\_count by user<br />\| top 10 user by event\_count|
|MariaDB - OpenTelemetry|Top 10 Warnings|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Overview| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "[Warning]"<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)"<br />\| if (isEmpty(pod),host.name,pod) as host.name<br />\| ErrorMsg as warning\_message<br />\| count as frequency by warning\_message, db.cluster.name, host.name<br />\| sort by frequency, warning\_message asc<br />\| fields db.cluster.name,host.name,warning\_message,frequency<br />\| limit 10|
|MariaDB - OpenTelemetry|Top Errors|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Error Logs| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "[ERROR]"<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)"<br />\| if (isEmpty(pod),host.name,pod) as host.name<br />\| ErrorMsg as error\_message<br />\| count as frequency by error\_message, db.cluster.name, host.name<br />\| sort by frequency, error\_message asc<br />\| fields db.cluster.name,host.name,error\_message,frequency<br />\| limit 30|
|MariaDB - OpenTelemetry|Top Reasons for Replication Failures|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Replication| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} (("[ERROR]" and ("Slave I/O" or "Error reading packet from server" or "Slave SQL")) or ("[Note] Error reading relay log event: slave SQL thread was killed"))<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| ErrorMsg as error\_message<br />\| count as frequency by error\_message, db.cluster.name<br />\| sort by frequency \| limit 10|
|MariaDB - OpenTelemetry|Top Warnings|Logs|Installed Apps/MariaDB - OpenTelemetry/MariaDB - Error Logs| sumo.datasource=mariadb deployment.environment={{deployment.environment}} db.cluster.name={{db.cluster.name}} "[Warning]"<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)"<br />\| if (isEmpty(pod),host.name,pod) as host.name<br />\| ErrorMsg as warning\_message<br />\| count as frequency by warning\_message, db.cluster.name, host.name<br />\| sort by frequency, warning\_message asc<br />\| fields db.cluster.name,host.name,warning\_message,frequency<br />\| limit 30|

