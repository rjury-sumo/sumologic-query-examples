# AWS WAF
## Sumo Logic App For: AWS WAF
AWS Web Application Firewall (WAF) is a web application firewall that helps protect your web applications from common web exploits that could affect application availability, compromise security, or consume excessive resources.
The Sumo Logic App for AWS WAF analyzes traffic flowing through AWS WAF and automatically detects threats via Sumo Logic Threat Intel. The App provides pre-configured dashboards and searches that allow you to monitor threat and traffic details by client IP, allowed and blocked traffic, malicious IPs, threat actors, location, rules configured, trends and more.
Docs Link: [AWS WAF](https://help.sumologic.com/?cid=80410)

## Searches

### Log Searches

- **All Traffic by Rule ID**: from Dashboard: AWS WAF/AWS WAF - Overview - New 
- **All Traffic by Rule Type**: from Dashboard: AWS WAF/AWS WAF - Overview - New 
- **Allowed by Country**: from Dashboard: AWS WAF/AWS WAF - Traffic - New 
- **Allowed by Rule ID**: from Dashboard: AWS WAF/AWS WAF - Traffic - New 
- **Allowed by Rule Type**: from Dashboard: AWS WAF/AWS WAF - Traffic - New 
- **Allowed Outliers**: from Dashboard: AWS WAF/AWS WAF - Traffic - New 
- **Allowed Threat Breakdown by Sources**: from Dashboard: AWS WAF/AWS WAF - Threat Intelligence - New 
- **Allowed Threat by Actors**: from Dashboard: AWS WAF/AWS WAF - Threat Intelligence - New 
- **Allowed Threats Trend**: from Dashboard: AWS WAF/AWS WAF - Threat Intelligence - New 
- **Allowed Traffic**: from Dashboard: AWS WAF/AWS WAF - Traffic - New 
- **Allowed Traffic by Malicious IPs**: from Dashboard: AWS WAF/AWS WAF - Threat Intelligence - New 
- **Allowed Traffic by Threat Confidence**: from Dashboard: AWS WAF/AWS WAF - Threat Intelligence - New 
- **AWS WAF - Client IP Threat Info**: from Search: AWS WAF/AWS WAF - Client IP Threat Info 
- **AWS WAF - Parser**: from Search: AWS WAF/AWS WAF - Parser 
- **Blocked by Country**: from Dashboard: AWS WAF/AWS WAF - Traffic - New 
- **Blocked by Rule ID**: from Dashboard: AWS WAF/AWS WAF - Traffic - New 
- **Blocked by Rule Type**: from Dashboard: AWS WAF/AWS WAF - Traffic - New 
- **Blocked Outliers**: from Dashboard: AWS WAF/AWS WAF - Traffic - New 
- **Blocked Threat Breakdown by Sources**: from Dashboard: AWS WAF/AWS WAF - Threat Intelligence - New 
- **Blocked Threats by Actors**: from Dashboard: AWS WAF/AWS WAF - Threat Intelligence - New 
- **Blocked Threats Trend**: from Dashboard: AWS WAF/AWS WAF - Threat Intelligence - New 
- **Blocked Traffic**: from Dashboard: AWS WAF/AWS WAF - Traffic - New 
- **Blocked Traffic by Malicious IPs**: from Dashboard: AWS WAF/AWS WAF - Threat Intelligence - New 
- **Blocked Traffic by Threat Confidence**: from Dashboard: AWS WAF/AWS WAF - Threat Intelligence - New 
- **HTTP Methods**: from Dashboard: AWS WAF/AWS WAF - Overview - New 
- **HTTP Versions**: from Dashboard: AWS WAF/AWS WAF - Overview - New 
- **IP Threat Count**: from Dashboard: AWS WAF/AWS WAF - Overview - New 
- **Traffic Map**: from Dashboard: AWS WAF/AWS WAF - Overview - New 
- **Traffic Trend**: from Dashboard: AWS WAF/AWS WAF - Overview - New 
- **Unique Allowed Threats Map**: from Dashboard: AWS WAF/AWS WAF - Threat Intelligence - New 
- **Unique Blocked Threats Map**: from Dashboard: AWS WAF/AWS WAF - Threat Intelligence - New 
- **URI Hits**: from Dashboard: AWS WAF/AWS WAF - Overview - New

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|AWS WAF|All Traffic by Rule ID|Logs|AWS WAF/AWS WAF - Overview - New|\_sourceCategory = Labs/AWS/WAF <br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId<br />\|where if ("{{terminatingruletype}}" = "\*", true, terminatingruletype matches "{{terminatingruletype}}")<br />\|count as count by terminatingruleid|
|AWS WAF|All Traffic by Rule Type|Logs|AWS WAF/AWS WAF - Overview - New|\_sourceCategory = Labs/AWS/WAF <br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId<br />\| timeslice 15m<br />\|where if ("{{terminatingruletype}}" = "\*", true, terminatingruletype matches "{{terminatingruletype}}")<br />\|count by terminatingruletype, \_timeslice<br />\| transpose row \_timeslice column terminatingruletype|
|AWS WAF|Allowed by Country|Logs|AWS WAF/AWS WAF - Traffic - New|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\| timeslice 5m<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = clientip<br />\|where if ("{{\_sourcecategory}}" = "\*", true, \_sourcecategory matches "{{\_sourcecategory}}")<br />\|count by country\_name, \_timeslice<br />\| transpose row \_timeslice column country\_name|
|AWS WAF|Allowed by Rule ID|Logs|AWS WAF/AWS WAF - Traffic - New|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\|where if ("{{\_sourcecategory}}" = "\*", true, \_sourcecategory matches "{{\_sourcecategory}}")<br />\|count as count by terminatingRuleId<br />\| sort count|
|AWS WAF|Allowed by Rule Type|Logs|AWS WAF/AWS WAF - Traffic - New|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\|where if ("{{\_sourcecategory}}" = "\*", true, \_sourcecategory matches "{{\_sourcecategory}}")<br />\|count by terminatingruletype|
|AWS WAF|Allowed Outliers|Logs|AWS WAF/AWS WAF - Traffic - New|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\| timeslice 15m<br />\|where if ("{{\_sourcecategory}}" = "\*", true, \_sourcecategory matches "{{\_sourcecategory}}")<br />\|count as Blocked by \_timeslice<br />\| outlier Blocked|
|AWS WAF|Allowed Threat Breakdown by Sources|Logs|AWS WAF/AWS WAF - Threat Intelligence - New|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\|where if ("{{clientip}}" = "\*", true, clientip matches "{{clientip}}")<br />\|count as allowed\_ips by clientip, \_sourceCategory<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (allowed\_ips) as threat\_count by \_sourceCategory|
|AWS WAF|Allowed Threat by Actors|Logs|AWS WAF/AWS WAF - Threat Intelligence - New|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\|where if ("{{clientip}}" = "\*", true, clientip matches "{{clientip}}")<br />\|count as allowed\_ips by clientip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (allowed\_ips) as threat\_count by Actor|
|AWS WAF|Allowed Threats Trend|Logs|AWS WAF/AWS WAF - Threat Intelligence - New|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| timeslice 5m<br />\|where if ("{{clientip}}" = "\*", true, clientip matches "{{clientip}}")<br />\|count by \_timeslice|
|AWS WAF|Allowed Traffic|Logs|AWS WAF/AWS WAF - Traffic - New|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = clientip<br />\|where if ("{{\_sourcecategory}}" = "\*", true, \_sourcecategory matches "{{\_sourcecategory}}")<br />\|count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|AWS WAF|Allowed Traffic by Malicious IPs|Logs|AWS WAF/AWS WAF - Threat Intelligence - New|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\|where if ("{{clientip}}" = "\*", true, clientip matches "{{clientip}}")<br />\|count as allowed\_ips by clientip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (allowed\_ips) as threat\_count by clientip, malicious\_confidence, Actor, label\_name<br />\| sort by threat\_count|
|AWS WAF|Allowed Traffic by Threat Confidence|Logs|AWS WAF/AWS WAF - Threat Intelligence - New|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\|where if ("{{clientip}}" = "\*", true, clientip matches "{{clientip}}")<br />\|count as allowed\_ips by clientip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum (allowed\_ips) as threat\_count by malicious\_confidence<br />\| sort by threat\_count|
|AWS WAF|AWS WAF - Client IP Threat Info|Logs|AWS WAF/AWS WAF - Client IP Threat Info|\_sourceCategory = Labs/AWS/WAF  {{client\_ip}}<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip|
|AWS WAF|AWS WAF - Parser|Logs|AWS WAF/AWS WAF - Parser|\_sourceCategory = Labs/AWS/WAF <br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop|
|AWS WAF|Blocked by Country|Logs|AWS WAF/AWS WAF - Traffic - New|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\| timeslice 5m<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = clientip<br />\|where if ("{{\_sourcecategory}}" = "\*", true, \_sourcecategory matches "{{\_sourcecategory}}")<br />\|count by country\_name, \_timeslice<br />\| transpose row \_timeslice column country\_name|
|AWS WAF|Blocked by Rule ID|Logs|AWS WAF/AWS WAF - Traffic - New|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\|where if ("{{\_sourcecategory}}" = "\*", true, \_sourcecategory matches "{{\_sourcecategory}}")<br />\|count as count by terminatingRuleId<br />\| sort count|
|AWS WAF|Blocked by Rule Type|Logs|AWS WAF/AWS WAF - Traffic - New|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\|where if ("{{\_sourcecategory}}" = "\*", true, \_sourcecategory matches "{{\_sourcecategory}}")<br />\|count by terminatingruletype|
|AWS WAF|Blocked Outliers|Logs|AWS WAF/AWS WAF - Traffic - New|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\| timeslice 15m<br />\|where if ("{{\_sourcecategory}}" = "\*", true, \_sourcecategory matches "{{\_sourcecategory}}")<br />\|count as Blocked by \_timeslice<br />\| outlier Blocked|
|AWS WAF|Blocked Threat Breakdown by Sources|Logs|AWS WAF/AWS WAF - Threat Intelligence - New|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\|where if ("{{clientip}}" = "\*", true, clientip matches "{{clientip}}")<br />\|count as blocked\_ips by clientip, \_sourceCategory<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (blocked\_ips) as threat\_count by \_sourceCategory|
|AWS WAF|Blocked Threats by Actors|Logs|AWS WAF/AWS WAF - Threat Intelligence - New|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\|where if ("{{clientip}}" = "\*", true, clientip matches "{{clientip}}")<br />\|count as blocked\_ips by clientip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (blocked\_ips) as threat\_count by Actor|
|AWS WAF|Blocked Threats Trend|Logs|AWS WAF/AWS WAF - Threat Intelligence - New|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| timeslice 5m<br />\|where if ("{{clientip}}" = "\*", true, clientip matches "{{clientip}}")<br />\|count by \_timeslice|
|AWS WAF|Blocked Traffic|Logs|AWS WAF/AWS WAF - Traffic - New|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = clientip<br />\|where if ("{{\_sourcecategory}}" = "\*", true, \_sourcecategory matches "{{\_sourcecategory}}")<br />\|count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|AWS WAF|Blocked Traffic by Malicious IPs|Logs|AWS WAF/AWS WAF - Threat Intelligence - New|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\|where if ("{{clientip}}" = "\*", true, clientip matches "{{clientip}}")<br />\|count as blocked\_ips by clientip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (blocked\_ips) as threat\_count by clientip, malicious\_confidence, Actor, label\_name<br />\| sort by threat\_count|
|AWS WAF|Blocked Traffic by Threat Confidence|Logs|AWS WAF/AWS WAF - Threat Intelligence - New|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\|where if ("{{clientip}}" = "\*", true, clientip matches "{{clientip}}")<br />\|count as blocked\_ips by clientip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum (blocked\_ips) as threat\_count by malicious\_confidence<br />\| sort by threat\_count|
|AWS WAF|HTTP Methods|Logs|AWS WAF/AWS WAF - Overview - New|\_sourceCategory = Labs/AWS/WAF <br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId<br />\|where if ("{{terminatingruletype}}" = "\*", true, terminatingruletype matches "{{terminatingruletype}}")<br />\|count as count by httpmethod<br />\| sort count|
|AWS WAF|HTTP Versions|Logs|AWS WAF/AWS WAF - Overview - New|\_sourceCategory = Labs/AWS/WAF <br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId<br />\|where if ("{{terminatingruletype}}" = "\*", true, terminatingruletype matches "{{terminatingruletype}}")<br />\|count as count by httpversion<br />\| sort count|
|AWS WAF|IP Threat Count|Logs|AWS WAF/AWS WAF - Overview - New|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\|where if ("{{terminatingruletype}}" = "\*", true, terminatingruletype matches "{{terminatingruletype}}")<br />\|count as ip\_count by clientip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum (ip\_count) as threat\_count|
|AWS WAF|Traffic Map|Logs|AWS WAF/AWS WAF - Overview - New|\_sourceCategory = Labs/AWS/WAF <br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = clientip<br />\|where if ("{{terminatingruletype}}" = "\*", true, terminatingruletype matches "{{terminatingruletype}}")<br />\|count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|AWS WAF|Traffic Trend|Logs|AWS WAF/AWS WAF - Overview - New|\_sourceCategory = Labs/AWS/WAF <br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| timeslice 15m<br />\| if(action="BLOCK",1,0) as Blocked\_count<br />\| if(action="ALLOW",1,0) as Allowed\_count<br />\|where if ("{{terminatingruletype}}" = "\*", true, terminatingruletype matches "{{terminatingruletype}}")<br />\|sum(Blocked\_count) as Blocked, sum(Allowed\_count) as Allowed by \_timeslice|
|AWS WAF|Unique Allowed Threats Map|Logs|AWS WAF/AWS WAF - Threat Intelligence - New|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\|where if ("{{clientip}}" = "\*", true, clientip matches "{{clientip}}")<br />\|count as allowed\_ips by clientip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = clientip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|AWS WAF|Unique Blocked Threats Map|Logs|AWS WAF/AWS WAF - Threat Intelligence - New|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\|where if ("{{clientip}}" = "\*", true, clientip matches "{{clientip}}")<br />\|count as allowed\_ips by clientip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = clientip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|AWS WAF|URI Hits|Logs|AWS WAF/AWS WAF - Overview - New|\_sourceCategory = Labs/AWS/WAF <br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId<br />\|where if ("{{terminatingruletype}}" = "\*", true, terminatingruletype matches "{{terminatingruletype}}")<br />\|count as count by uri<br />\| sort count|

