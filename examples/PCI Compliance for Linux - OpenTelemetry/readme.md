# PCI Compliance for Linux - OpenTelemetry

## Searches

### Log Searches

- **Active Services Over Time**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 07, 08, 10 - Account, User, System Monitoring 
- **Default Login (root user) - Failure**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 10 - Login Activity 
- **Default Login (root user) - Success**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 10 - Login Activity 
- **Excessive Failed Access Attempts**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 07, 08, 10 - Account, User, System Monitoring 
- **Failed Logins**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 10 - Login Activity 
- **Failed Logins**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 10 - Login Activity 
- **Failed sudo**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 10 - Privileged Activity 
- **Recent sudo Attempts**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 10 - Privileged Activity 
- **Running Services (Daemons)**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 07, 08, 10 - Account, User, System Monitoring 
- **Stopped Services**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 07, 08, 10 - Account, User, System Monitoring 
- **Successful Logins**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 10 - Login Activity 
- **Successful Logins**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 10 - Login Activity 
- **sudo Attempts**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 10 - Privileged Activity 
- **sudo Attempts Over Time**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 10 - Privileged Activity 
- **System Stopped**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 07, 08, 10 - Account, User, System Monitoring 
- **System Time Change Attempt**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 07, 08, 10 - Account, User, System Monitoring 
- **Top 10 sudo by Host**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 10 - Privileged Activity 
- **Top 10 sudo by User**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 10 - Privileged Activity 
- **Unique Services**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 07, 08, 10 - Account, User, System Monitoring 
- **Unique Services Running**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 07, 08, 10 - Account, User, System Monitoring 
- **User Account Created**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 07, 08, 10 - Account, User, System Monitoring 
- **User Account Deleted**: from Dashboard: Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 07, 08, 10 - Account, User, System Monitoring

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|PCI Compliance for Linux - OpenTelemetry|Active Services Over Time|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 07, 08, 10 - Account, User, System Monitoring|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}}<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<dest\_host\>\\S\*)\\s+(?\<process\>\\w\*)(?:\\[\\d+\\]:\|:)\\s\*(?\<message\>.+)\$" nodrop<br />\| if (isEmpty(dest\_host), \_sourceHost, dest\_host) as dest\_host<br />\| parse regex "(?\<service\>\\w\*)\\[\\d+\\]:\\s+" <br />\| where !isEmpty(service)<br />\| timeslice 1h<br />\|where if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{service}}" = "\*", true, service matches "{{service}}") AND if ("{{process}}" = "\*", true, process matches "{{process}}")<br />\|count as eventCount by \_timeslice, service<br />\| transpose row \_timeslice column service|
|PCI Compliance for Linux - OpenTelemetry|Default Login (root user) - Failure|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 10 - Login Activity|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}} ("authentication failure" or "FAILED SU" or "input\_userauth\_request: invalid user" or "Invalid user" or "Failed publickey" or "Failed password")<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<\_sourceHost\>\\S\*)\\s+" nodrop<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<dest\_host\>\\S\*)\\s+(?\<message\>[^;]+)" nodrop<br />\| parse "ruser=\* rhost=\* user=\*" as src\_user, src\_host, dest\_user nodrop<br />\| parse "ruser= rhost=\* user=\*" as src\_host, dest\_user nodrop<br />\| parse " user=\*\\"" as dest\_user nodrop<br />\| parse "Authentication failure for \* from \*" as dest\_user, src\_host nodrop<br />\| parse "FAILED SU (to \*) \* on" as dest\_user, src\_user nodrop<br />\| parse regex "FAILED LOGIN (?:SESSION\|\\d+) FROM (?:\\S+) FOR (?\<dest\_user\>\\S+)," nodrop<br />\| parse "input\_userauth\_request: invalid user \*" as dest\_user nodrop<br />\| parse "Invalid user \* from \* port \*" as dest\_user, src\_host, src\_port nodrop<br />\| parse "Failed publickey for \* from \* port \* \*" as dest\_user, src\_host, src\_port, protocol nodrop<br />\| parse "Failed password for \* from \* port \* \*" as dest\_user, src\_host, src\_port, protocol nodrop<br />\| parse "Failed password for invalid user \* from \* port \* \*" as dest\_user, src\_host, src\_port, protocol nodrop<br />\| where src\_user="root" or dest\_user="root"<br />\| if (!isEmpty(protocol), protocol, if (message matches "sshd[\*", "ssh", protocol)) as protocol<br />\| where dest\_user!=""<br />\| if (src\_user="", dest\_user, src\_user) as src\_user<br />\| if (src\_host=" " or isEmpty(src\_host), \_sourceHost, src\_host) as src\_host \| src\_host as src\_ip<br />\| timeslice 1s<br />\|where if ("{{src\_host}}" = "\*", true, src\_host matches "{{src\_host}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount by \_timeslice, dest\_host, dest\_user, message, protocol, src\_host, src\_ip, src\_user<br />\| sort by \_timeslice, dest\_host, dest\_user, message, protocol, src\_host, src\_ip, src\_user|
|PCI Compliance for Linux - OpenTelemetry|Default Login (root user) - Success|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 10 - Login Activity|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}} ("su:" or "sudo:" or "sshd:" or "sshd[" or "pam:") (("Accepted" and "pam") or "session" or ("to" and "on")) !"closed"<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s(?\<\_sourceHost\>\\S\*)\\s" nodrop<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s(?\<dest\_host\>\\S\*)\\s(?:\\w\*):\\s+(?\<message\>.\*)\$" nodrop<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s(?\<dest\_host\>\\S\*)\\s(?:\\S\*)\\[\\d+\\]:\\s+(?\<message\>.\*)\$" nodrop <br />\| parse field=message "pam\_unix(\*:\*):" as deamon, ltype nodrop \| if (deamon="sshd", "ssh", "") as protocol \| fields -deamon, ltype<br />\| parse "session \* for user \* by \*(uid=" as action, dest\_user, src\_user nodrop<br />\| parse regex "session (?\<action\>\\w\*) for user (?\<dest\_user\>\\S\*)" nodrop<br />\| parse "rhost=\* " as src\_host nodrop<br />\| parse "Accepted \* for \* from \* port \* \*" as type, dest\_user, src\_host, src\_port, protocol nodrop<br />\| where dest\_user!=""<br />\| where src\_user="root" or dest\_user="root"<br />\| if (isEmpty(message),"Authentication successful",message) as message<br />\| if (isEmpty(src\_host),\_sourceHost,src\_host) as src\_host \| src\_host as src\_ip<br />\| if (isEmpty(src\_user),dest\_user,src\_user) as src\_user<br />\| timeslice 1s<br />\|where  if ("{{src\_host}}" = "\*", true, src\_host matches "{{src\_host}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount by \_timeslice, dest\_host, dest\_user, message, protocol, src\_host, src\_ip, src\_user<br />\| sort by \_timeslice, dest\_host, dest\_user, message, protocol, src\_host, src\_ip, src\_user|
|PCI Compliance for Linux - OpenTelemetry|Excessive Failed Access Attempts|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 07, 08, 10 - Account, User, System Monitoring|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}} ("authentication failure" or "FAILED SU" or "input\_userauth\_request: invalid user" or "Invalid user" or "Failed publickey" or "Failed password")<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<\_sourceHost\>\\S\*)\\s+" nodrop<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<dest\_host\>\\S\*)\\s+(?\<message\>[^;]+)" nodrop<br />\| parse "ruser=\* rhost=\* user=\*" as src\_user, src\_host, dest\_user nodrop<br />\| parse "ruser= rhost=\* user=\*" as src\_host, dest\_user nodrop<br />\| parse " user=\*\\"" as dest\_user nodrop<br />\| parse "Authentication failure for \* from \*" as dest\_user, src\_host nodrop<br />\| parse "FAILED SU (to \*) \* on" as dest\_user, src\_user nodrop<br />\| parse regex "FAILED LOGIN (?:SESSION\|\\d+) FROM (?:\\S+) FOR (?\<dest\_user\>\\S+)," nodrop<br />\| parse "input\_userauth\_request: invalid user \*" as dest\_user nodrop<br />\| parse "Invalid user \* from \* port \*" as dest\_user, src\_host, src\_port nodrop<br />\| parse "Failed publickey for \* from \* port \* \*" as dest\_user, src\_host, src\_port, protocol nodrop<br />\| parse "Failed password for \* from \* port \* \*" as dest\_user, src\_host, src\_port, protocol nodrop<br />\| parse "Failed password for invalid user \* from \* port \* \*" as dest\_user, src\_host, src\_port, protocol nodrop<br />\| if (!isEmpty(protocol), protocol, if (message matches "sshd[\*", "ssh", protocol)) as protocol<br />\| where dest\_user!=""<br />\| if (src\_user="", dest\_user, src\_user) as src\_user<br />\| if (src\_host=" " or isEmpty(src\_host), \_sourceHost, src\_host) as src\_host \| src\_host as src\_ip<br />\| timeslice 5m<br />\|where if ("{{src\_host}}" = "\*", true, src\_host matches "{{src\_host}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount by \_timeslice, dest\_host, dest\_user, protocol, src\_host, src\_ip, src\_user<br />\| 2 as threshold<br />\| where eventCount \> threshold<br />\| sort by \_timeslice, dest\_host, dest\_user, protocol, src\_host, src\_ip, src\_user|
|PCI Compliance for Linux - OpenTelemetry|Failed Logins|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 10 - Login Activity|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}} ("authentication failure" or "FAILED SU" or "input\_userauth\_request: invalid user" or "Invalid user" or "Failed publickey" or "Failed password")<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<\_sourceHost\>\\S\*)\\s+" nodrop<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<dest\_host\>\\S\*)\\s+(?\<message\>[^;]+)" nodrop<br />\| parse "ruser=\* rhost=\* user=\*" as src\_user, src\_host, dest\_user nodrop<br />\| parse "ruser= rhost=\* user=\*" as src\_host, dest\_user nodrop<br />\| parse " user=\*\\"" as dest\_user nodrop<br />\| parse "Authentication failure for \* from \*" as dest\_user, src\_host nodrop<br />\| parse "FAILED SU (to \*) \* on" as dest\_user, src\_user nodrop<br />\| parse regex "FAILED LOGIN (?:SESSION\|\\d+) FROM (?:\\S+) FOR (?\<dest\_user\>\\S+)," nodrop<br />\| parse "input\_userauth\_request: invalid user \*" as dest\_user nodrop<br />\| parse "Invalid user \* from \* port \*" as dest\_user, src\_host, src\_port nodrop<br />\| parse "Failed publickey for \* from \* port \* \*" as dest\_user, src\_host, src\_port, protocol nodrop<br />\| parse "Failed password for \* from \* port \* \*" as dest\_user, src\_host, src\_port, protocol nodrop<br />\| parse "Failed password for invalid user \* from \* port \* \*" as dest\_user, src\_host, src\_port, protocol nodrop<br />\| if (!isEmpty(protocol), protocol, if (message matches "sshd[\*", "ssh", protocol)) as protocol<br />\| where dest\_user!=""<br />\| if (src\_user="", dest\_user, src\_user) as src\_user<br />\| if (src\_host=" " or isEmpty(src\_host), \_sourceHost, src\_host) as src\_host \| src\_host as src\_ip<br />\| timeslice 1s<br />\|where if ("{{src\_host}}" = "\*", true, src\_host matches "{{src\_host}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount by \_timeslice, dest\_host, dest\_user, message, protocol, src\_host, src\_ip, src\_user<br />\| sort by \_timeslice, dest\_host, dest\_user, message, protocol, src\_host, src\_ip, src\_user|
|PCI Compliance for Linux - OpenTelemetry|Failed Logins|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 10 - Login Activity|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}} ("authentication failure" or "FAILED SU" or "input\_userauth\_request: invalid user" or "Invalid user" or "Failed publickey" or "Failed password")<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<\_sourceHost\>\\S\*)\\s+" nodrop<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<dest\_host\>\\S\*)\\s+(?\<message\>[^;]+)" nodrop<br />\| parse "ruser=\* rhost=\* user=\*" as src\_user, src\_host, dest\_user nodrop<br />\| parse "ruser= rhost=\* user=\*" as src\_host, dest\_user nodrop<br />\| parse " user=\*\\"" as dest\_user nodrop<br />\| parse "Authentication failure for \* from \*" as dest\_user, src\_host nodrop<br />\| parse "FAILED SU (to \*) \* on" as dest\_user, src\_user nodrop<br />\| parse regex "FAILED LOGIN (?:SESSION\|\\d+) FROM (?:\\S+) FOR (?\<dest\_user\>\\S+)," nodrop<br />\| parse "input\_userauth\_request: invalid user \*" as dest\_user nodrop<br />\| parse "Invalid user \* from \* port \*" as dest\_user, src\_host, src\_port nodrop<br />\| parse "Failed publickey for \* from \* port \* \*" as dest\_user, src\_host, src\_port, protocol nodrop<br />\| parse "Failed password for \* from \* port \* \*" as dest\_user, src\_host, src\_port, protocol nodrop<br />\| parse "Failed password for invalid user \* from \* port \* \*" as dest\_user, src\_host, src\_port, protocol nodrop<br />\| if (!isEmpty(protocol), protocol, if (message matches "sshd[\*", "ssh", protocol)) as protocol<br />\| where dest\_user!=""<br />\| if (src\_user="", dest\_user, src\_user) as src\_user<br />\| if (src\_host=" " or isEmpty(src\_host), \_sourceHost, src\_host) as src\_host \| src\_host as src\_ip<br />\|where if ("{{src\_host}}" = "\*", true, src\_host matches "{{src\_host}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount|
|PCI Compliance for Linux - OpenTelemetry|Failed sudo|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 10 - Privileged Activity|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}} sudo ("user NOT in sudoers" or "conversation failed" or "authentication failure")<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<\_sourceHost\>\\S\*)\\s+" nodrop<br />\| \_sourceHost as dest\_host<br />\| parse regex "(?\<process\>\\w\*):\\s+(?\<src\_user\>[^ ]+?)\\s+:.+?USER=(?\<dest\_user\>[^ ]+?)\\s+" nodrop<br />\| parse "TTY=\* ; PWD=\* ;" as tty, workingdirectory nodrop<br />\| parse "USER=\* ;" as dest\_user nodrop<br />\| parse regex "\\s+(?\<process\>\\w\*): pam\_unix\\(sudo:auth\\): conversation failed" nodrop<br />\| parse "pam\_unix(\*:auth): authentication failure;" as process nodrop<br />\| parse "ruser=\* rhost=\* user=\*" as src\_user, src\_host, dest\_user nodrop<br />\| where process="sudo"<br />\| fields dest\_user, src\_user, dest\_host, tty, workingdirectory \| fields -\_raw<br />\|where if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount|
|PCI Compliance for Linux - OpenTelemetry|Recent sudo Attempts|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 10 - Privileged Activity|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}} "sudo"<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s(?\<\_sourceHost\>\\S\*)\\s" nodrop<br />\| \_sourceHost as dest\_host<br />\| parse regex "(?\<process\>\\w\*):\\s+(?\<src\_user\>[^ ]+?)\\s+:.+?USER=(?\<dest\_user\>[^ ]+?)\\s+" nodrop<br />\| parse "ruser=\* rhost=\* user=\*" as src\_user, src\_host, dest\_user nodrop<br />\| parse regex "COMMAND=(?\<command\>[^\$]\*)\$" nodrop<br />\| parse regex "\\s+(?\<process\>\\w\*): pam\_unix\\(sudo:auth\\): conversation failed" nodrop<br />\| parse "pam\_unix(\*:auth): authentication failure;" as process nodrop<br />\| parse "ruser=\* rhost=\* user=\*" as src\_user, src\_host, dest\_user nodrop<br />\| where process="sudo"<br />\| timeslice 1s<br />\|where if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}") <br />\|count as eventCount by \_timeslice, dest\_host, src\_user, dest\_user, command<br />\| fields -eventCount<br />\| sort by \_timeslice|
|PCI Compliance for Linux - OpenTelemetry|Running Services (Daemons)|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 07, 08, 10 - Account, User, System Monitoring|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}}<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<dest\_host\>\\S\*)\\s+(?\<process\>\\w\*)(?:\\[\\d+\\]:\|:)\\s\*(?\<message\>.+)\$" nodrop<br />\| if (isEmpty(dest\_host), \_sourceHost, dest\_host) as dest\_host<br />\| parse regex "(?\<service\>\\w\*)\\[\\d+\\]:\\s+" <br />\| where !isEmpty(service)<br />\|where  if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{service}}" = "\*", true, service matches "{{service}}") AND if ("{{process}}" = "\*", true, process matches "{{process}}")<br />\|count as eventCount, first(\_messagetime) as latest, last(\_messagetime) as earliest by service, dest\_host <br />\| formatDate(fromMillis(latest),"yyyy/MM/dd HH:mm:ss Z") as %"LatestTime" <br />\| formatDate(fromMillis(earliest),"yyyy/MM/dd HH:mm:ss Z") as %"EarliestTime" <br />\| fields -latest, earliest, eventCount<br />\| sort by %"LatestTime"|
|PCI Compliance for Linux - OpenTelemetry|Stopped Services|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 07, 08, 10 - Account, User, System Monitoring|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}}  (rsyslog or rsyslogd or syslog or ossec or ntpd) and (stopped or "exiting on signal 15" or start\*)<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<\_sourceHost\>\\S\*)\\s+" nodrop<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<dest\_host\>\\S\*)\\s+(?\<service\>\\w\*)\\[\\d+\\]:\\s+ntpd (?\<state\>[^\\(]\*)" nodrop<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<dest\_host\>\\S\*)\\s+(?\<service\>\\w\*):\\s+\\[[\\s\\S]\*\\] (?\<state\>[\\s\\S]\*)\$" nodrop<br />\| if (state in ("exiting on signal 15 ", "exiting on signal 15."), "stopped", if (state in ("start"), "running", if (state in ("(re)start"), "restarted","unknown"))) as state<br />\| where state != "unknown"<br />\| \_sourceHost as src\_host \| src\_host as dest\_host<br />\|where if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}") <br />\|count as eventCount, first(\_messagetime) as latest, last(\_messagetime) as earliest by dest\_host, service, state<br />\| formatDate(fromMillis(latest),"yyyy/MM/dd HH:mm:ss Z") as %"LatestTime" <br />\| formatDate(fromMillis(earliest),"yyyy/MM/dd HH:mm:ss Z") as %"EarliestTime" <br />\| fields -latest, earliest, eventCount<br />\| where state="stopped"<br />\| sort by - %"LatestTime"|
|PCI Compliance for Linux - OpenTelemetry|Successful Logins|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 10 - Login Activity|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}} ("su:" or "sudo:" or "sshd:" or "sshd[" or "pam:") (("Accepted" and "pam") or "session" or ("to" and "on")) !"closed"<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s(?\<\_sourceHost\>\\S\*)\\s" nodrop<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s(?\<dest\_host\>\\S\*)\\s(?:\\w\*):\\s+(?\<message\>.\*)\$" nodrop<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s(?\<dest\_host\>\\S\*)\\s(?:\\S\*)\\[\\d+\\]:\\s+(?\<message\>.\*)\$" nodrop <br />\| parse field=message "pam\_unix(\*:\*):" as deamon, ltype nodrop \| if (deamon="sshd", "ssh", "") as protocol \| fields -deamon, ltype<br />\| parse "session \* for user \* by \*(uid=" as action, dest\_user, src\_user nodrop<br />\| parse regex "session (?\<action\>\\w\*) for user (?\<dest\_user\>\\S\*)" nodrop<br />\| parse "rhost=\* " as src\_host nodrop<br />\| parse "Accepted \* for \* from \* port \* \*" as type, dest\_user, src\_host, src\_port, protocol nodrop<br />\| where dest\_user!=""<br />\| if (isEmpty(message),"Authentication successful",message) as message<br />\| if (isEmpty(src\_host),\_sourceHost,src\_host) as src\_host \| src\_host as src\_ip<br />\| if (isEmpty(src\_user),dest\_user,src\_user) as src\_user<br />\| timeslice 1s<br />\|where if ("{{src\_host}}" = "\*", true, src\_host matches "{{src\_host}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount by \_timeslice, dest\_host, dest\_user, message, protocol, src\_host, src\_ip, src\_user<br />\| sort by \_timeslice, dest\_host, dest\_user, message, protocol, src\_host, src\_ip, src\_user|
|PCI Compliance for Linux - OpenTelemetry|Successful Logins|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 10 - Login Activity|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}} ("su:" or "sudo:" or "sshd:" or "sshd[" or "pam:") (("Accepted" and "pam") or "session" or ("to" and "on")) !"closed"<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s(?\<\_sourceHost\>\\S\*)\\s" nodrop<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s(?\<dest\_host\>\\S\*)\\s(?:\\w\*):\\s+(?\<message\>.\*)\$" nodrop<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s(?\<dest\_host\>\\S\*)\\s(?:\\S\*)\\[\\d+\\]:\\s+(?\<message\>.\*)\$" nodrop <br />\| parse field=message "pam\_unix(\*:\*):" as deamon, ltype nodrop \| if (deamon="sshd", "ssh", "") as protocol \| fields -deamon, ltype<br />\| parse "session \* for user \* by \*(uid=" as action, dest\_user, src\_user nodrop<br />\| parse regex "session (?\<action\>\\w\*) for user (?\<dest\_user\>\\S\*)" nodrop<br />\| parse "rhost=\* " as src\_host nodrop<br />\| parse "Accepted \* for \* from \* port \* \*" as type, dest\_user, src\_host, src\_port, protocol nodrop<br />\| where dest\_user!=""<br />\| if (isEmpty(message),"Authentication successful",message) as message<br />\| if (isEmpty(src\_host),\_sourceHost,src\_host) as src\_host \| src\_host as src\_ip<br />\| if (isEmpty(src\_user),dest\_user,src\_user) as src\_user<br />\|where if ("{{src\_host}}" = "\*", true, src\_host matches "{{src\_host}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount|
|PCI Compliance for Linux - OpenTelemetry|sudo Attempts|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 10 - Privileged Activity|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}} sudo <br />\| parse regex "(?\<process\>\\w\*):\\s+(?\<src\_user\>[^ ]+?)\\s+:.+?USER=(?\<dest\_user\>[^ ]+?)\\s+" nodrop<br />\| parse regex "\\s+(?\<process\>\\w\*): pam\_unix\\(sudo:auth\\): conversation failed" nodrop<br />\| parse "pam\_unix(\*:auth): authentication failure;" as process nodrop<br />\| parse "ruser=\* rhost=\* user=\*" as src\_user, src\_host, dest\_user nodrop<br />\| where process="sudo"<br />\|where if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount|
|PCI Compliance for Linux - OpenTelemetry|sudo Attempts Over Time|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 10 - Privileged Activity|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}} sudo<br />\| parse regex "(?\<process\>\\w\*):\\s+(?\<src\_user\>[^ ]+?)\\s+:.+?USER=(?\<dest\_user\>[^ ]+?)\\s+" nodrop<br />\| parse regex "\\s+(?\<process\>\\w\*): pam\_unix\\(sudo:auth\\): conversation failed" nodrop<br />\| parse "pam\_unix(\*:auth): authentication failure;" as process nodrop<br />\| parse "ruser=\* rhost=\* user=\*" as src\_user, src\_host, dest\_user nodrop<br />\| where process="sudo"<br />\| timeslice 5m<br />\|where if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}") <br />\|count as eventCount by \_timeslice|
|PCI Compliance for Linux - OpenTelemetry|System Stopped|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 07, 08, 10 - Account, User, System Monitoring|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}} "kernel: Kernel logging (proc) stopped."  <br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<dest\_host\>\\S\*)\\s+" nodrop<br />\| if (isEmpty(dest\_host), \_sourceHost, dest\_host) as dest\_host<br />\| "Linux OS Stopped" as msg\_summary <br />\| msg\_summary as message \| fields -msg\_summary<br />\| timeslice 15m<br />\|where if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") <br />\|count as eventCount by \_timeslice, dest\_host, message<br />\| fields -eventCount<br />\| sort by \_timeslice|
|PCI Compliance for Linux - OpenTelemetry|System Time Change Attempt|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 07, 08, 10 - Account, User, System Monitoring|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}} (sudo and ((COMMAND date) or "ntpd stop" or (ntpd synchronized) or (ln and localtime)))<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<\_sourceHost\>\\S+)\\s+\\w\*" nodrop<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s(?\<dest\_host\>\\S\*)\\s(?\<message\>.+)\$" nodrop<br />\| extract "sudo:\\s+(?\<src\_user\>[^ ]+?)\\s:.+?USER=(?\<dest\_user\>[^ ]+?)\\s+" nodrop<br />\| parse "synchronized to \*," as src\_host nodrop <br />\| if (src\_host=" " or isEmpty(src\_host), \_sourceHost, src\_host) as src\_host \| src\_host as src\_ip \| src\_host as dest\_host<br />\| where (message matches "\*date \*") or (message matches "\*date\*") or (message matches "\*synchronized to\*") or (message matches "\*ntpd stop\*") or (message matches "\*ln\*localtime")<br />\| if (message matches "\*synchronized to\*","Change/Configuration/SystemTime/Success","Change/Configuration/SystemTime/Attempt") as classification <br />\| if (message matches "\*synchronized to\*","System Time Synchronized", "System Time Change attempt") as message<br />\| where message="System Time Change attempt"<br />\| timeslice 1s<br />\|where if ("{{src\_host}}" = "\*", true, src\_host matches "{{src\_host}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount by \_timeslice, src\_host, src\_user, dest\_user|
|PCI Compliance for Linux - OpenTelemetry|Top 10 sudo by Host|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 10 - Privileged Activity|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}} sudo<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<\_sourceHost\>\\S\*)\\s+" nodrop<br />\| \_sourceHost as host<br />\| parse regex "(?\<process\>\\w\*):\\s+(?\<src\_user\>[^ ]+?)\\s+:.+?USER=(?\<dest\_user\>[^ ]+?)\\s+" nodrop<br />\| parse regex "\\s+(?\<process\>\\w\*): pam\_unix\\(sudo:auth\\): conversation failed" nodrop<br />\| parse "pam\_unix(\*:auth): authentication failure;" as process nodrop<br />\| parse "ruser=\* rhost=\* user=\*" as src\_user, src\_host, dest\_user nodrop<br />\| where process="sudo"<br />\|where if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}") <br />\|count as eventCount by host<br />\| top 10 host by eventCount|
|PCI Compliance for Linux - OpenTelemetry|Top 10 sudo by User|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 10 - Privileged Activity|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}} sudo<br />\| parse regex "(?\<process\>\\w\*):\\s+(?\<src\_user\>[^ ]+?)\\s+:.+?USER=(?\<dest\_user\>[^ ]+?)\\s+" nodrop<br />\| parse regex "\\s+(?\<process\>\\w\*): pam\_unix\\(sudo:auth\\): conversation failed" nodrop<br />\| parse "pam\_unix(\*:auth): authentication failure;" as process nodrop<br />\| parse "ruser=\* rhost=\* user=\*" as src\_user, src\_host, dest\_user nodrop<br />\| where process="sudo"<br />\|where if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}") <br />\|count as eventCount by dest\_user, src\_user<br />\| where !isEmpty(dest\_user)<br />\| top 10 dest\_user, src\_user by eventCount|
|PCI Compliance for Linux - OpenTelemetry|Unique Services|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 07, 08, 10 - Account, User, System Monitoring|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}}<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<dest\_host\>\\S\*)\\s+(?\<process\>\\w\*)(?:\\[\\d+\\]:\|:)\\s\*(?\<message\>.+)\$" nodrop<br />\| if (isEmpty(dest\_host), \_sourceHost, dest\_host) as dest\_host<br />\| parse regex "(?\<service\>\\w\*)\\[\\d+\\]:\\s+" <br />\| where !isEmpty(service)<br />\|where if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{service}}" = "\*", true, service matches "{{service}}") AND if ("{{process}}" = "\*", true, process matches "{{process}}")<br />\|count as eventCount by service<br />\| sort by eventCount|
|PCI Compliance for Linux - OpenTelemetry|Unique Services Running|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 07, 08, 10 - Account, User, System Monitoring|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}}<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<dest\_host\>\\S\*)\\s+(?\<process\>\\w\*)(?:\\[\\d+\\]:\|:)\\s\*(?\<message\>.+)\$" nodrop<br />\| if (isEmpty(dest\_host), \_sourceHost, dest\_host) as dest\_host<br />\| parse regex "(?\<service\>\\w\*)\\[\\d+\\]:\\s+" <br />\| where !isEmpty(service)<br />\|where if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{service}}" = "\*", true, service matches "{{service}}") AND if ("{{process}}" = "\*", true, process matches "{{process}}")<br />\|count\_distinct(service) as %"ServiceRunningCount" group by dest\_host<br />\| sort by %"ServiceRunningCount", dest\_host|
|PCI Compliance for Linux - OpenTelemetry|User Account Created|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 07, 08, 10 - Account, User, System Monitoring|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}} "useradd" and ("new user" or "new account")<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<\_sourceHost\>\\S+)\\s+\\w\*" nodrop<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<dest\_host\>\\S\*)\\s+(?\<process\>\\w\*)(?:\\[\\d+\\]:\|:)\\s\*(?\<msg\>.+)\$" nodrop<br />\| parse field=msg "name=\*, UID=" as dest\_user nodrop<br />\| parse field=msg "name=\*, UID=\*, GID=\*, home=\*, shell=\*" as dest\_user, UID, GID, home, shell nodrop<br />\| parse field=msg ", shell=\*\\"" as shell nodrop<br />\| parse field=msg "account=\*, uid=\*, gid=\*, home=\*, shell=\*" as dest\_user, UID, GID, home, shell nodrop<br />\| parse field=msg "account=\*, uid=" as dest\_user nodrop<br />\| "Local Server" as type \| \_sourceHost as dest\_ip<br />\| timeslice 15m<br />\|where if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}") AND if ("{{process}}" = "\*", true, process matches "{{process}}")<br />\|count as eventCount by \_timeslice, dest\_host, dest\_user, process, UID, GID, home, shell, type<br />\| fields -eventCount<br />\| sort by \_timeslice|
|PCI Compliance for Linux - OpenTelemetry|User Account Deleted|Logs|Installed Apps/PCI Compliance for Linux - OpenTelemetry/PCI Compliance For Linux - PCI Req 02, 07, 08, 10 - Account, User, System Monitoring|sumo.datasource=linux deployment.environment={{deployment.environment}} host.group={{host.group}} host.name={{host.name}} (("userdel" and "delete user") or "account deleted")<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<\_sourceHost\>\\S+)\\s+\\w\*" nodrop<br />\| parse regex "\\S\*\\s+\\d+\\s+\\d+:\\d+:\\d+\\s+(?\<dest\_host\>\\S\*)\\s+(?\<process\>\\w\*)(?:\\[\\d+\\]:\|:)\\s\*(?\<msg\>.+)\$" nodrop<br />\| dest\_host as dest\_ip<br />\| parse field=msg "delete user '\*'" as dest\_user nodrop<br />\| parse "account=\*, group=\*, gid=" as dest\_user, dest\_group nodrop<br />\| parse "account=\*, uid=" as dest\_user nodrop <br />\| timeslice 1s<br />\|where if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}") AND if ("{{process}}" = "\*", true, process matches "{{process}}")<br />\|count as eventCount by \_timeslice, dest\_host, dest\_user, process, dest\_group<br />\| fields -eventCount<br />\| sort by \_timeslice|

