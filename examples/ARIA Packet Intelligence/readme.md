# ARIA Packet Intelligence
## Sumo Logic App For: ARIA Packet Intelligence
The ARIA Packet Intelligence app developed for Sumo Logic provides visualization and profiling of all internal network traffic, within a Sumo environment, to detect possible threats and verify connectivity policies.
Docs Link: [ARIA Packet Intelligence](https://www.ariacybersecurity.com/aria-packet-intelligence-app/)

## Searches

### Log Searches

- **Frequent Internal Destinations**: from Dashboard: Installed Apps/ARIA Packet Intelligence/ARIA PI - Network Traffic Visibility 
- **Frequent Internal Sources**: from Dashboard: Installed Apps/ARIA Packet Intelligence/ARIA PI - Network Traffic Visibility 
- **Geo IP of Traffic Sources**: from Dashboard: Installed Apps/ARIA Packet Intelligence/ARIA PI - Network Traffic Visibility 
- **Possible Intrusion Events**: from Dashboard: Installed Apps/ARIA Packet Intelligence/ARIA PI - Threat Summary 
- **Possible Intrusion Events Over Time**: from Dashboard: Installed Apps/ARIA Packet Intelligence/ARIA PI - Threat Summary 
- **Possible Intrusion Traffic**: from Dashboard: Installed Apps/ARIA Packet Intelligence/ARIA PI - Threat Summary 
- **Possible Malware/Ransomware Events**: from Dashboard: Installed Apps/ARIA Packet Intelligence/ARIA PI - Threat Summary 
- **Possible Malware/Ransomware Events Over Time**: from Dashboard: Installed Apps/ARIA Packet Intelligence/ARIA PI - Threat Summary 
- **Possible Malware/Ransomware Traffic**: from Dashboard: Installed Apps/ARIA Packet Intelligence/ARIA PI - Threat Summary 
- **Possible Policy Violation**: from Dashboard: Installed Apps/ARIA Packet Intelligence/ARIA PI - Threat Summary 
- **Possible Policy Violation Traffic**: from Dashboard: Installed Apps/ARIA Packet Intelligence/ARIA PI - Threat Summary 
- **Possible Policy Violations Over Time**: from Dashboard: Installed Apps/ARIA Packet Intelligence/ARIA PI - Threat Summary 
- **Query example**: from Search: Installed Apps/ARIA Packet Intelligence/Query example 
- **Query example 2**: from Search: Installed Apps/ARIA Packet Intelligence/Query example 2 
- **Traffic by Type**: from Search: Installed Apps/ARIA Packet Intelligence/Traffic by Type 
- **Traffic by Type**: from Dashboard: Installed Apps/ARIA Packet Intelligence/ARIA PI - Network Traffic Visibility

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|ARIA Packet Intelligence|Frequent Internal Destinations|Logs|Installed Apps/ARIA Packet Intelligence/ARIA PI - Network Traffic Visibility|\_sourceCategory={{\_sourceCategory}} <br />\| parse "\\"hostName\\":\\"\*\\",\\"product\\":\\"\*\\",\\"metaData\\":{\\"flowID\\":\*,\\"flowStart\\":\*,\\"flowEnd\\":\*,\\"pktsSent\\":\*,\\"pktsRcvd\\":\*,\\"bytesSent\\":\*,\\"bytesRcvd\\":\*,\\"srcMac\\":\\"\*\\",\\"dstMac\\":\\"\*\\",\\"vlanId\\":\*,\\"srcIP\\":\\"\*\\",\\"dstIP\\":\\"\*\\",\\"srcTOS\\":\*,\\"dstTOS\\":\*,\\"l4Proto\\":\*,\\"srcPort\\":\*,\\"dstPort\\":\*,\\"tcpFlags\\":\*}}" as HostName,Product,FlowID,FlowStart,FlowEnd,PktsSent,PktsRcvd,BytesSent,BytesRcvd,SrcMac,DstMac,VlanID,SrcIP,DstIP,SrcTos,DstTos,Protocol,SrcPort,DstPort,TcpFlags<br />\| where !isNull(srcip)<br />\| where !isNull(dstip)<br />// Categorize the source address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", srcip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", srcip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", srcip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", srcip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", srcip, toInt(24))),"internal","external") as srcip\_type<br />// Categorize the destination address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", dstip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", dstip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", dstip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", dstip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", dstip, toInt(24))),"internal","external") as dstip\_type<br />\| where !isNull(dstip)<br />\| where (dstip\_type) = "internal"<br />\| count by dstip \| sort by \_count \| limit 10|
|ARIA Packet Intelligence|Frequent Internal Sources|Logs|Installed Apps/ARIA Packet Intelligence/ARIA PI - Network Traffic Visibility|\_sourceCategory={{\_sourceCategory}} <br />\| parse "\\"hostName\\":\\"\*\\",\\"product\\":\\"\*\\",\\"metaData\\":{\\"flowID\\":\*,\\"flowStart\\":\*,\\"flowEnd\\":\*,\\"pktsSent\\":\*,\\"pktsRcvd\\":\*,\\"bytesSent\\":\*,\\"bytesRcvd\\":\*,\\"srcMac\\":\\"\*\\",\\"dstMac\\":\\"\*\\",\\"vlanId\\":\*,\\"srcIP\\":\\"\*\\",\\"dstIP\\":\\"\*\\",\\"srcTOS\\":\*,\\"dstTOS\\":\*,\\"l4Proto\\":\*,\\"srcPort\\":\*,\\"dstPort\\":\*,\\"tcpFlags\\":\*}}" as HostName,Product,FlowID,FlowStart,FlowEnd,PktsSent,PktsRcvd,BytesSent,BytesRcvd,SrcMac,DstMac,VlanID,SrcIP,DstIP,SrcTos,DstTos,Protocol,SrcPort,DstPort,TcpFlags<br />\| where !isNull(srcip)<br />\| where !isNull(dstip)<br />// Categorize the source address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", srcip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", srcip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", srcip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", srcip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", srcip, toInt(24))),"internal","external") as srcip\_type<br />// Categorize the destination address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", dstip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", dstip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", dstip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", dstip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", dstip, toInt(24))),"internal","external") as dstip\_type<br />\| where !isNull(srcip)<br />\| where (srcip\_type) = "internal"<br />\| count by srcip \| sort by \_count \| limit 10|
|ARIA Packet Intelligence|Geo IP of Traffic Sources|Logs|Installed Apps/ARIA Packet Intelligence/ARIA PI - Network Traffic Visibility|\_sourceCategory={{\_sourceCategory}} <br />\| parse "\\"hostName\\":\\"\*\\",\\"product\\":\\"\*\\",\\"metaData\\":{\\"flowID\\":\*,\\"flowStart\\":\*,\\"flowEnd\\":\*,\\"pktsSent\\":\*,\\"pktsRcvd\\":\*,\\"bytesSent\\":\*,\\"bytesRcvd\\":\*,\\"srcMac\\":\\"\*\\",\\"dstMac\\":\\"\*\\",\\"vlanId\\":\*,\\"srcIP\\":\\"\*\\",\\"dstIP\\":\\"\*\\",\\"srcTOS\\":\*,\\"dstTOS\\":\*,\\"l4Proto\\":\*,\\"srcPort\\":\*,\\"dstPort\\":\*,\\"tcpFlags\\":\*}}" as HostName,Product,FlowID,FlowStart,FlowEnd,PktsSent,PktsRcvd,BytesSent,BytesRcvd,SrcMac,DstMac,VlanID,SrcIP,DstIP,SrcTos,DstTos,Protocol,SrcPort,DstPort,TcpFlags<br />\| where !isNull(srcip)<br />\| where !isNull(dstip)<br />// Categorize the source address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", srcip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", srcip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", srcip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", srcip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", srcip, toInt(24))),"internal","external") as srcip\_type<br />// Categorize the destination address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", dstip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", dstip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", dstip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", dstip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", dstip, toInt(24))),"internal","external") as dstip\_type<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = srcip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort by country\_name \| sort by \_count|
|ARIA Packet Intelligence|Possible Intrusion Events|Logs|Installed Apps/ARIA Packet Intelligence/ARIA PI - Threat Summary|\_sourceCategory={{\_sourceCategory}} <br />\| parse "\\"hostName\\":\\"\*\\",\\"product\\":\\"\*\\",\\"metaData\\":{\\"flowID\\":\*,\\"flowStart\\":\*,\\"flowEnd\\":\*,\\"pktsSent\\":\*,\\"pktsRcvd\\":\*,\\"bytesSent\\":\*,\\"bytesRcvd\\":\*,\\"srcMac\\":\\"\*\\",\\"dstMac\\":\\"\*\\",\\"vlanId\\":\*,\\"srcIP\\":\\"\*\\",\\"dstIP\\":\\"\*\\",\\"srcTOS\\":\*,\\"dstTOS\\":\*,\\"l4Proto\\":\*,\\"srcPort\\":\*,\\"dstPort\\":\*,\\"tcpFlags\\":\*}}" as HostName,Product,FlowID,FlowStart,FlowEnd,PktsSent,PktsRcvd,BytesSent,BytesRcvd,SrcMac,DstMac,VlanID,SrcIP,DstIP,SrcTos,DstTos,Protocol,SrcPort,DstPort,TcpFlags<br />\| where !isNull(srcip)<br />\| where !isNull(dstip)<br />// Categorize the source address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", srcip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", srcip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", srcip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", srcip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", srcip, toInt(24))),"internal","external") as srcip\_type<br />// Categorize the destination address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", dstip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", dstip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", dstip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", dstip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", dstip, toInt(24))),"internal","external") as dstip\_type<br />\| where dstip\_type="internal" AND srcip\_type="external"<br />\| where dstport in ("20","21","139","445","3389")<br />\| count(dstport) as Ports by srcip, dstip, dstport<br />\| where Ports \> 0<br />\| count|
|ARIA Packet Intelligence|Possible Intrusion Events Over Time|Logs|Installed Apps/ARIA Packet Intelligence/ARIA PI - Threat Summary|\_sourceCategory={{\_sourceCategory}} <br />\| parse "\\"hostName\\":\\"\*\\",\\"product\\":\\"\*\\",\\"metaData\\":{\\"flowID\\":\*,\\"flowStart\\":\*,\\"flowEnd\\":\*,\\"pktsSent\\":\*,\\"pktsRcvd\\":\*,\\"bytesSent\\":\*,\\"bytesRcvd\\":\*,\\"srcMac\\":\\"\*\\",\\"dstMac\\":\\"\*\\",\\"vlanId\\":\*,\\"srcIP\\":\\"\*\\",\\"dstIP\\":\\"\*\\",\\"srcTOS\\":\*,\\"dstTOS\\":\*,\\"l4Proto\\":\*,\\"srcPort\\":\*,\\"dstPort\\":\*,\\"tcpFlags\\":\*}}" as HostName,Product,FlowID,FlowStart,FlowEnd,PktsSent,PktsRcvd,BytesSent,BytesRcvd,SrcMac,DstMac,VlanID,SrcIP,DstIP,SrcTos,DstTos,Protocol,SrcPort,DstPort,TcpFlags<br />\| where !isNull(srcip)<br />\| where !isNull(dstip)<br />// Categorize the source address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", srcip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", srcip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", srcip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", srcip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", srcip, toInt(24))),"internal","external") as srcip\_type<br />// Categorize the destination address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", dstip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", dstip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", dstip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", dstip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", dstip, toInt(24))),"internal","external") as dstip\_type<br />\| where dstip\_type="internal" AND srcip\_type="external"<br />\| where dstport in ("20","21","139","445","3389")<br />\| timeslice 1d<br />\| count(dstport) as Ports by srcip, dstip, dstport, \_timeslice<br />\| where Ports \> 0<br />\| count(Ports) as Events by \_timeslice<br />\| fillmissing timeslice(1d)<br />|
|ARIA Packet Intelligence|Possible Intrusion Traffic|Logs|Installed Apps/ARIA Packet Intelligence/ARIA PI - Threat Summary|\_sourceCategory={{\_sourceCategory}} <br />\| parse "\\"hostName\\":\\"\*\\",\\"product\\":\\"\*\\",\\"metaData\\":{\\"flowID\\":\*,\\"flowStart\\":\*,\\"flowEnd\\":\*,\\"pktsSent\\":\*,\\"pktsRcvd\\":\*,\\"bytesSent\\":\*,\\"bytesRcvd\\":\*,\\"srcMac\\":\\"\*\\",\\"dstMac\\":\\"\*\\",\\"vlanId\\":\*,\\"srcIP\\":\\"\*\\",\\"dstIP\\":\\"\*\\",\\"srcTOS\\":\*,\\"dstTOS\\":\*,\\"l4Proto\\":\*,\\"srcPort\\":\*,\\"dstPort\\":\*,\\"tcpFlags\\":\*}}" as HostName,Product,FlowID,FlowStart,FlowEnd,PktsSent,PktsRcvd,BytesSent,BytesRcvd,SrcMac,DstMac,VlanID,SrcIP,DstIP,SrcTos,DstTos,Protocol,SrcPort,DstPort,TcpFlags<br />\| where !isNull(srcip)<br />\| where !isNull(dstip)<br />// Categorize the source address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", srcip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", srcip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", srcip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", srcip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", srcip, toInt(24))),"internal","external") as srcip\_type<br />// Categorize the destination address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", dstip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", dstip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", dstip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", dstip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", dstip, toInt(24))),"internal","external") as dstip\_type<br />\| where dstip\_type="internal" AND srcip\_type="external"<br />\| where dstport in ("20","21","139","445","3389")<br />\| count(dstport) as Ports by srcip, dstip, dstport<br />\| where Ports \> 0<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = srcip<br />\| sort by dstport \| sort by Ports|
|ARIA Packet Intelligence|Possible Malware/Ransomware Events|Logs|Installed Apps/ARIA Packet Intelligence/ARIA PI - Threat Summary|\_sourceCategory={{\_sourceCategory}} <br />\| parse "\\"hostName\\":\\"\*\\",\\"product\\":\\"\*\\",\\"metaData\\":{\\"flowID\\":\*,\\"flowStart\\":\*,\\"flowEnd\\":\*,\\"pktsSent\\":\*,\\"pktsRcvd\\":\*,\\"bytesSent\\":\*,\\"bytesRcvd\\":\*,\\"srcMac\\":\\"\*\\",\\"dstMac\\":\\"\*\\",\\"vlanId\\":\*,\\"srcIP\\":\\"\*\\",\\"dstIP\\":\\"\*\\",\\"srcTOS\\":\*,\\"dstTOS\\":\*,\\"l4Proto\\":\*,\\"srcPort\\":\*,\\"dstPort\\":\*,\\"tcpFlags\\":\*}}" as HostName,Product,FlowID,FlowStart,FlowEnd,PktsSent,PktsRcvd,BytesSent,BytesRcvd,SrcMac,DstMac,VlanID,SrcIP,DstIP,SrcTos,DstTos,Protocol,SrcPort,DstPort,TcpFlags<br />// Specify IP address of critical resource being monitored<br />// Look for the behavior of a single source IP address accessing the critical resource above over a large number of ports<br />\| timeslice 1h<br />\| count\_distinct(dstport) as Ports by srcip, dstip, \_timeslice<br />// Set a threshold above which port scan behavior looks suspicious<br />\| where Ports \> 64<br />\| sort by Ports<br />\| count<br />|
|ARIA Packet Intelligence|Possible Malware/Ransomware Events Over Time|Logs|Installed Apps/ARIA Packet Intelligence/ARIA PI - Threat Summary|\_sourceCategory={{\_sourceCategory}} <br />\| parse "\\"hostName\\":\\"\*\\",\\"product\\":\\"\*\\",\\"metaData\\":{\\"flowID\\":\*,\\"flowStart\\":\*,\\"flowEnd\\":\*,\\"pktsSent\\":\*,\\"pktsRcvd\\":\*,\\"bytesSent\\":\*,\\"bytesRcvd\\":\*,\\"srcMac\\":\\"\*\\",\\"dstMac\\":\\"\*\\",\\"vlanId\\":\*,\\"srcIP\\":\\"\*\\",\\"dstIP\\":\\"\*\\",\\"srcTOS\\":\*,\\"dstTOS\\":\*,\\"l4Proto\\":\*,\\"srcPort\\":\*,\\"dstPort\\":\*,\\"tcpFlags\\":\*}}" as HostName,Product,FlowID,FlowStart,FlowEnd,PktsSent,PktsRcvd,BytesSent,BytesRcvd,SrcMac,DstMac,VlanID,SrcIP,DstIP,SrcTos,DstTos,Protocol,SrcPort,DstPort,TcpFlags<br />// Specify IP address of critical resource being monitored<br />// Look for the behavior of a single source IP address accessing the critical resource above over a large number of ports<br />\| timeslice 1h<br />\| count\_distinct(dstport) as Ports by srcip, dstip, \_timeslice<br />\| where Ports \> 64<br />\| count(Ports) as Events by \_timeslice<br />\| fillmissing timeslice(1h)<br />// Set a threshold above which port scan behavior looks suspicious<br />\| sort by \_timeslice<br />|
|ARIA Packet Intelligence|Possible Malware/Ransomware Traffic|Logs|Installed Apps/ARIA Packet Intelligence/ARIA PI - Threat Summary|\_sourceCategory={{\_sourceCategory}} <br />\| parse "\\"hostName\\":\\"\*\\",\\"product\\":\\"\*\\",\\"metaData\\":{\\"flowID\\":\*,\\"flowStart\\":\*,\\"flowEnd\\":\*,\\"pktsSent\\":\*,\\"pktsRcvd\\":\*,\\"bytesSent\\":\*,\\"bytesRcvd\\":\*,\\"srcMac\\":\\"\*\\",\\"dstMac\\":\\"\*\\",\\"vlanId\\":\*,\\"srcIP\\":\\"\*\\",\\"dstIP\\":\\"\*\\",\\"srcTOS\\":\*,\\"dstTOS\\":\*,\\"l4Proto\\":\*,\\"srcPort\\":\*,\\"dstPort\\":\*,\\"tcpFlags\\":\*}}" as HostName,Product,FlowID,FlowStart,FlowEnd,PktsSent,PktsRcvd,BytesSent,BytesRcvd,SrcMac,DstMac,VlanID,SrcIP,DstIP,SrcTos,DstTos,Protocol,SrcPort,DstPort,TcpFlags<br />// Specify IP address of critical resource being monitored<br />// Look for the behavior of a single source IP address accessing the critical resource above over a large number of ports<br />\| timeslice 1h<br />\| count\_distinct(dstport) as Ports\_scanned by srcip, dstip, \_timeslice<br />// Set a threshold above which port scan behavior looks suspicious<br />\| where Ports\_scanned \> 64<br />\| sort by \_timeslice<br />|
|ARIA Packet Intelligence|Possible Policy Violation|Logs|Installed Apps/ARIA Packet Intelligence/ARIA PI - Threat Summary|\_sourceCategory={{\_sourceCategory}} <br />\| parse "\\"hostName\\":\\"\*\\",\\"product\\":\\"\*\\",\\"metaData\\":{\\"flowID\\":\*,\\"flowStart\\":\*,\\"flowEnd\\":\*,\\"pktsSent\\":\*,\\"pktsRcvd\\":\*,\\"bytesSent\\":\*,\\"bytesRcvd\\":\*,\\"srcMac\\":\\"\*\\",\\"dstMac\\":\\"\*\\",\\"vlanId\\":\*,\\"srcIP\\":\\"\*\\",\\"dstIP\\":\\"\*\\",\\"srcTOS\\":\*,\\"dstTOS\\":\*,\\"l4Proto\\":\*,\\"srcPort\\":\*,\\"dstPort\\":\*,\\"tcpFlags\\":\*}}" as HostName,Product,FlowID,FlowStart,FlowEnd,PktsSent,PktsRcvd,BytesSent,BytesRcvd,SrcMac,DstMac,VlanID,SrcIP,DstIP,SrcTos,DstTos,Protocol,SrcPort,DstPort,TcpFlags<br />\| where !isNull(srcip)<br />\| where !isNull(dstip)<br />// Categorize the source address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", srcip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", srcip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", srcip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", srcip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", srcip, toInt(24))),"internal","external") as srcip\_type<br />// Categorize the destination address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", dstip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", dstip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", dstip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", dstip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", dstip, toInt(24))),"internal","external") as dstip\_type<br />// Look for internal conversations between subnets that shouldn't be talking. In this case we are looking for conversations between the 10.0.0.0/8 subnet and any other internal subnet.<br />\| where dstip\_type="internal" AND srcip\_type="internal"<br />\| where compareCIDRPrefix("10.0.0.0", srcip, toInt(8))<br />\| where !compareCIDRPrefix("10.0.0.0", dstip, toInt(8))<br />\| count(dstip) as Conversations by srcip, dstip<br />\| where Conversations \> 1<br />\| sort by srcip<br />\| count|
|ARIA Packet Intelligence|Possible Policy Violation Traffic|Logs|Installed Apps/ARIA Packet Intelligence/ARIA PI - Threat Summary|\_sourceCategory={{\_sourceCategory}} <br />\| parse "\\"hostName\\":\\"\*\\",\\"product\\":\\"\*\\",\\"metaData\\":{\\"flowID\\":\*,\\"flowStart\\":\*,\\"flowEnd\\":\*,\\"pktsSent\\":\*,\\"pktsRcvd\\":\*,\\"bytesSent\\":\*,\\"bytesRcvd\\":\*,\\"srcMac\\":\\"\*\\",\\"dstMac\\":\\"\*\\",\\"vlanId\\":\*,\\"srcIP\\":\\"\*\\",\\"dstIP\\":\\"\*\\",\\"srcTOS\\":\*,\\"dstTOS\\":\*,\\"l4Proto\\":\*,\\"srcPort\\":\*,\\"dstPort\\":\*,\\"tcpFlags\\":\*}}" as HostName,Product,FlowID,FlowStart,FlowEnd,PktsSent,PktsRcvd,BytesSent,BytesRcvd,SrcMac,DstMac,VlanID,SrcIP,DstIP,SrcTos,DstTos,Protocol,SrcPort,DstPort,TcpFlags<br />\| where !isNull(srcip)<br />\| where !isNull(dstip)<br />// Categorize the source address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", srcip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", srcip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", srcip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", srcip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", srcip, toInt(24))),"internal","external") as srcip\_type<br />// Categorize the destination address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", dstip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", dstip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", dstip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", dstip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", dstip, toInt(24))),"internal","external") as dstip\_type<br />// Look for internal conversations between subnets that shouldn't be talking. In this case we are looking for conversations between the 10.0.0.0/8 subnet and any other internal subnet.<br />\| where dstip\_type="internal" AND srcip\_type="internal"<br />\| where compareCIDRPrefix("10.0.0.0", srcip, toInt(8))<br />\| where !compareCIDRPrefix("10.0.0.0", dstip, toInt(8))<br />\| count(dstip) as Conversations by srcip, dstip<br />\| where Conversations \> 1<br />\| sort by Conversations|
|ARIA Packet Intelligence|Possible Policy Violations Over Time|Logs|Installed Apps/ARIA Packet Intelligence/ARIA PI - Threat Summary|\_sourceCategory={{\_sourceCategory}} <br />\| parse "\\"hostName\\":\\"\*\\",\\"product\\":\\"\*\\",\\"metaData\\":{\\"flowID\\":\*,\\"flowStart\\":\*,\\"flowEnd\\":\*,\\"pktsSent\\":\*,\\"pktsRcvd\\":\*,\\"bytesSent\\":\*,\\"bytesRcvd\\":\*,\\"srcMac\\":\\"\*\\",\\"dstMac\\":\\"\*\\",\\"vlanId\\":\*,\\"srcIP\\":\\"\*\\",\\"dstIP\\":\\"\*\\",\\"srcTOS\\":\*,\\"dstTOS\\":\*,\\"l4Proto\\":\*,\\"srcPort\\":\*,\\"dstPort\\":\*,\\"tcpFlags\\":\*}}" as HostName,Product,FlowID,FlowStart,FlowEnd,PktsSent,PktsRcvd,BytesSent,BytesRcvd,SrcMac,DstMac,VlanID,SrcIP,DstIP,SrcTos,DstTos,Protocol,SrcPort,DstPort,TcpFlags<br />\| where !isNull(srcip)<br />\| where !isNull(dstip)<br />// Categorize the source address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", srcip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", srcip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", srcip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", srcip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", srcip, toInt(24))),"internal","external") as srcip\_type<br />// Categorize the destination address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", dstip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", dstip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", dstip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", dstip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", dstip, toInt(24))),"internal","external") as dstip\_type<br />// Look for internal conversations between subnets that shouldn't be talking. In this case we are looking for conversations between the 10.0.0.0/8 subnet and any other internal subnet.<br />\| where dstip\_type="internal" AND srcip\_type="internal"<br />\| where compareCIDRPrefix("10.0.0.0", srcip, toInt(8))<br />\| where !compareCIDRPrefix("10.0.0.0", dstip, toInt(8))<br />\| timeslice 1d<br />\| count(dstip) as Conversations by srcip, dstip, \_timeslice<br />\| where Conversations \> 1<br />\| sort by srcip<br />\| count by \_timeslice<br />\| fillmissing timeslice(1d)<br />|
|ARIA Packet Intelligence|Query example|Logs|Installed Apps/ARIA Packet Intelligence/Query example|\_sourceCategory={{\_sourceCategory}} <br />\| parse "\\"hostName\\":\\"\*\\",\\"product\\":\\"\*\\",\\"metaData\\":{\\"flowID\\":\*,\\"flowStart\\":\*,\\"flowEnd\\":\*,\\"pktsSent\\":\*,\\"pktsRcvd\\":\*,\\"bytesSent\\":\*,\\"bytesRcvd\\":\*,\\"srcMac\\":\\"\*\\",\\"dstMac\\":\\"\*\\",\\"vlanId\\":\*,\\"srcIP\\":\\"\*\\",\\"dstIP\\":\\"\*\\",\\"srcTOS\\":\*,\\"dstTOS\\":\*,\\"l4Proto\\":\*,\\"srcPort\\":\*,\\"dstPort\\":\*,\\"tcpFlags\\":\*}}" as HostName,Product,FlowID,FlowStart,FlowEnd,PktsSent,PktsRcvd,BytesSent,BytesRcvd,SrcMac,DstMac,VlanID,SrcIP,DstIP,SrcTos,DstTos,Protocol,SrcPort,DstPort,TcpFlags<br />\| where !isNull(srcip)<br />\| where !isNull(dstip)<br />// Categorize the source address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", srcip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", srcip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", srcip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", srcip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", srcip, toInt(24))),"internal","external") as srcip\_type<br />// Categorize the destination address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", dstip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", dstip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", dstip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", dstip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", dstip, toInt(24))),"internal","external") as dstip\_type<br />// specify that we look at internal traffic only<br />\| where ((dstip\_type="internal") AND (srcip\_type="internal"))<br />// accumulate all of the destination address over the time specified and report the top 10 most frequent<br />\| count by dstip \| sort by \_count \| limit 10<br />|
|ARIA Packet Intelligence|Query example 2|Logs|Installed Apps/ARIA Packet Intelligence/Query example 2|\_sourceCategory={{\_sourceCategory}} <br />\| parse "\\"hostName\\":\\"\*\\",\\"product\\":\\"\*\\",\\"metaData\\":{\\"flowID\\":\*,\\"flowStart\\":\*,\\"flowEnd\\":\*,\\"pktsSent\\":\*,\\"pktsRcvd\\":\*,\\"bytesSent\\":\*,\\"bytesRcvd\\":\*,\\"srcMac\\":\\"\*\\",\\"dstMac\\":\\"\*\\",\\"vlanId\\":\*,\\"srcIP\\":\\"\*\\",\\"dstIP\\":\\"\*\\",\\"srcTOS\\":\*,\\"dstTOS\\":\*,\\"l4Proto\\":\*,\\"srcPort\\":\*,\\"dstPort\\":\*,\\"tcpFlags\\":\*}}" as HostName,Product,FlowID,FlowStart,FlowEnd,PktsSent,PktsRcvd,BytesSent,BytesRcvd,SrcMac,DstMac,VlanID,SrcIP,DstIP,SrcTos,DstTos,Protocol,SrcPort,DstPort,TcpFlags<br />\| where !isNull(srcip)<br />\| where !isNull(dstip)<br />// Categorize the source address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", srcip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", srcip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", srcip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", srcip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", srcip, toInt(24))),"internal","external") as srcip\_type<br />// Categorize the destination address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", dstip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", dstip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", dstip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", dstip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", dstip, toInt(24))),"internal","external") as dstip\_type<br />// specify that we look at internal sourced traffic only<br />\| where ((dstip\_type="external") AND (srcip\_type="internal"))<br />// map all of the external addresses communicating with internal addresses<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = dstip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br /><br />|
|ARIA Packet Intelligence|Traffic by Type|Logs|Installed Apps/ARIA Packet Intelligence/Traffic by Type|\_sourceCategory={{\_sourceCategory}} <br />\| parse "\\"hostName\\":\\"\*\\",\\"product\\":\\"\*\\",\\"metaData\\":{\\"flowID\\":\*,\\"flowStart\\":\*,\\"flowEnd\\":\*,\\"pktsSent\\":\*,\\"pktsRcvd\\":\*,\\"bytesSent\\":\*,\\"bytesRcvd\\":\*,\\"srcMac\\":\\"\*\\",\\"dstMac\\":\\"\*\\",\\"vlanId\\":\*,\\"srcIP\\":\\"\*\\",\\"dstIP\\":\\"\*\\",\\"srcTOS\\":\*,\\"dstTOS\\":\*,\\"l4Proto\\":\*,\\"srcPort\\":\*,\\"dstPort\\":\*,\\"tcpFlags\\":\*}}" as HostName,Product,FlowID,FlowStart,FlowEnd,PktsSent,PktsRcvd,BytesSent,BytesRcvd,SrcMac,DstMac,VlanID,SrcIP,DstIP,SrcTos,DstTos,Protocol,SrcPort,DstPort,TcpFlags<br />\| where !isNull(srcip)<br />\| where !isNull(dstip)<br />// Categorize the source address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", srcip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", srcip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", srcip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", srcip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", srcip, toInt(24))),"internal","external") as srcip\_type<br />// Categorize the destination address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", dstip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", dstip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", dstip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", dstip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", dstip, toInt(24))),"internal","external") as dstip\_type<br /><br />\| if ((dstip\_type matches "internal" AND srcip\_type matches "internal"), "internal","external") as conv\_type<br />\| timeslice 1m <br />\| count by \_timeslice, conv\_type<br />\| transpose row \_timeslice column conv\_type|
|ARIA Packet Intelligence|Traffic by Type|Logs|Installed Apps/ARIA Packet Intelligence/ARIA PI - Network Traffic Visibility|\_sourceCategory={{\_sourceCategory}} <br />\| parse "\\"hostName\\":\\"\*\\",\\"product\\":\\"\*\\",\\"metaData\\":{\\"flowID\\":\*,\\"flowStart\\":\*,\\"flowEnd\\":\*,\\"pktsSent\\":\*,\\"pktsRcvd\\":\*,\\"bytesSent\\":\*,\\"bytesRcvd\\":\*,\\"srcMac\\":\\"\*\\",\\"dstMac\\":\\"\*\\",\\"vlanId\\":\*,\\"srcIP\\":\\"\*\\",\\"dstIP\\":\\"\*\\",\\"srcTOS\\":\*,\\"dstTOS\\":\*,\\"l4Proto\\":\*,\\"srcPort\\":\*,\\"dstPort\\":\*,\\"tcpFlags\\":\*}}" as HostName,Product,FlowID,FlowStart,FlowEnd,PktsSent,PktsRcvd,BytesSent,BytesRcvd,SrcMac,DstMac,VlanID,SrcIP,DstIP,SrcTos,DstTos,Protocol,SrcPort,DstPort,TcpFlags<br />\| where !isNull(srcip)<br />\| where !isNull(dstip)<br />// Categorize the source address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", srcip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", srcip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", srcip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", srcip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", srcip, toInt(24))),"internal","external") as srcip\_type<br />// Categorize the destination address of the traffic seen as either internal or external based on comparison to defined (RFC 1918) ipv4 private addressing. Site specific private addresses 5.1.99.0 and 192.41.172.0 have been added. <br />\| if(( compareCIDRPrefix("10.0.0.0", dstip, toInt(8)) OR compareCIDRPrefix("172.16.0.0", dstip, toInt(12)) OR compareCIDRPrefix("192.168.0.0", dstip, toInt(16)) OR compareCIDRPrefix("5.1.99.0", dstip, toInt(24)) OR compareCIDRPrefix("192.41.172.0", dstip, toInt(24))),"internal","external") as dstip\_type<br />\| if ((dstip\_type matches "internal" AND srcip\_type matches "internal"), "internal","external") as conv\_type<br />\| timeslice 1m <br />\| count by \_timeslice, conv\_type<br />\| transpose row \_timeslice column conv\_type|

