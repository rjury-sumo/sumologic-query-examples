# Google Cloud VPC
## Sumo Logic App For: Google Cloud VPC
The Sumo Logic App for Google Cloud VPC provides visibility into the activities, traffic, metrics, and VPC flow in your GCP. The preconfigured dashboards provide you details on the VPC flows, latency, traffic, source and destination IP addresses, ports, protocols, and messages.
Docs Link: [Google Cloud VPC](https://help.sumologic.com/?cid=4060)

## Searches

### Log Searches

- **Average Latency (ms) by Destination VPC**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity 
- **Average Latency (ms) by Source VPC**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity 
- **Average Latency (ms) by Subnetwork ID**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity 
- **Average Latency (ms) per Minute - Outlier**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics 
- **Average Latency (ms) per Minute - Trend**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics 
- **Flows by Destination Address**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity 
- **Flows by Destination Port**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity 
- **Flows by Source Address**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity 
- **Flows by Source Port**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity 
- **Google Cloud VPC Flow Durations**: from Search: Google Cloud VPC/Google Cloud VPC Flow Durations 
- **Google Cloud VPC Flow Durations**: from Search: Installed Apps/Google Cloud VPC/Google Cloud VPC Flow Durations 
- **Google Cloud VPC Max Flow Time**: from Search: Google Cloud VPC/Google Cloud VPC Max Flow Time 
- **Google Cloud VPC Max Flow Time**: from Search: Installed Apps/Google Cloud VPC/Google Cloud VPC Max Flow Time 
- **Google Cloud VPC Top 10 Source IPs by Flow Time**: from Search: Google Cloud VPC/Google Cloud VPC Top 10 Source IPs by Flow Time 
- **Google Cloud VPC Top 10 Source IPs by Flow Time**: from Search: Installed Apps/Google Cloud VPC/Google Cloud VPC Top 10 Source IPs by Flow Time 
- **Inbound Source Address Locations**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity 
- **Inbound Source Address Locations**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview 
- **Latency (ms) Box Plot**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics 
- **MBs Box Plot**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics 
- **MBs per Minute - Outlier**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics 
- **MBs per Minute - Trend**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics 
- **Messages per Minute - Outlier**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics 
- **Messages per Minute - Trend**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics 
- **Messages per Minute by Project**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics 
- **Outbound Destination Address Locations**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity 
- **Outbound Destination Address Locations**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview 
- **Packets Box Plot**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics 
- **Packets by Destination VM Over Time**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity 
- **Packets by Source VM Over Time**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity 
- **Packets by Subnetwork ID**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity 
- **Packets per Minute - Outlier**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics 
- **Packets per Minute - Trend**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics 
- **Top 10 Destination VMs by Traffic (MiB)**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview 
- **Top 10 Destination VMs per VPC by Traffic (MiB)**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview 
- **Top 10 External Destination Ports by VPC Flows**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview 
- **Top 10 External IPs by Traffic (MiB)**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview 
- **Top 10 External IPs by VPC Flows**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview 
- **Top 10 Internal Destination Ports by VPC Flows**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview 
- **Top 10 Source VMs by Traffic (MiB)**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview 
- **Top 10 Source VMs per VPC by Traffic (MiB)**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview 
- **Traffic (MiB)  by VPC**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview 
- **Traffic (MiB) by Destination VM Over Time**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity 
- **Traffic (MiB) by Project**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview 
- **Traffic (MiB) by Source VM Over Time**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity 
- **Traffic (MiB) by Subnetwork**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview 
- **Traffic (MiB) by Subnetwork ID**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity 
- **VPC Flows per Protocol by Hour**: from Dashboard: Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Google Cloud VPC|Average Latency (ms) by Destination VPC|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets  <br />\| where dest\_vpc!="" && !isNull(dest\_vpc)<br />\| timeslice 1m<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|avg(rtt) as latency by \_timeslice, dest\_vpc<br />\| transpose row \_timeslice column dest\_vpc|
|Google Cloud VPC|Average Latency (ms) by Source VPC|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets  <br />\| where src\_vpc!="" && !isNull(src\_vpc)<br />\| timeslice 1m<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|avg(rtt) as latency by \_timeslice, src\_vpc<br />\| transpose row \_timeslice column src\_vpc|
|Google Cloud VPC|Average Latency (ms) by Subnetwork ID|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets  <br />\| timeslice 1m<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|avg(rtt) as latency by \_timeslice, subnetwork\_id, subnetwork\_name <br />\| transpose row \_timeslice column subnetwork\_id,subnetwork\_name|
|Google Cloud VPC|Average Latency (ms) per Minute - Outlier|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets <br />\| timeslice 1m<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|avg(rtt) as latency by \_timeslice<br />\| outlier latency direction=+|
|Google Cloud VPC|Average Latency (ms) per Minute - Trend|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets <br />\| timeslice 1m<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|avg(rtt) as latency by \_timeslice<br />\| predict latency by 1m|
|Google Cloud VPC|Flows by Destination Address|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity|\_sourceCategory={{Logsdatasource}}  logName resource timestamp dest\_instance<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|count as flows by dest\_ip<br />\| sort by flows|
|Google Cloud VPC|Flows by Destination Port|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity|\_sourceCategory={{Logsdatasource}}  logName resource timestamp dest\_instance<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|count as flows by dest\_port<br />\| sort by flows|
|Google Cloud VPC|Flows by Source Address|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity|\_sourceCategory={{Logsdatasource}}  logName resource timestamp dest\_instance<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|count as flows by src\_ip<br />\| sort by flows|
|Google Cloud VPC|Flows by Source Port|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity|\_sourceCategory={{Logsdatasource}}  logName resource timestamp dest\_instance<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|count as flows by src\_port<br />\| sort by flows|
|Google Cloud VPC|Google Cloud VPC Flow Durations|Logs|Google Cloud VPC/Google Cloud VPC Flow Durations|\_sourceCategory = Labs/GCP/vpc logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.jsonPayload.connection.src\_ip", "message.data.jsonPayload.start\_time", "message.data.jsonPayload.end\_time" as src\_ip, start\_time, end\_time<br /><br />\| concat(substring(start\_time, 0, 23), "Z") as start\_substr<br />\| concat(substring(end\_time, 0, 23), "Z") as end\_substr<br />\| toMillis(parseDate(start\_substr, "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'")) as start\_millis<br />\| toMillis(parseDate(end\_substr, "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'")) as end\_millis<br />\| end\_millis - start\_millis as duration<br /><br />\| count by src\_ip, start\_time, end\_time, duration<br />\| sort by duration desc<br />\| fields -\_count|
|Google Cloud VPC|Google Cloud VPC Flow Durations|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC Flow Durations|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.jsonPayload.connection.src\_ip", "message.data.jsonPayload.start\_time", "message.data.jsonPayload.end\_time" as src\_ip, start\_time, end\_time<br /><br />\| concat(substring(start\_time, 0, 23), "Z") as start\_substr<br />\| concat(substring(end\_time, 0, 23), "Z") as end\_substr<br />\| toMillis(parseDate(start\_substr, "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'")) as start\_millis<br />\| toMillis(parseDate(end\_substr, "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'")) as end\_millis<br />\| end\_millis - start\_millis as duration<br /><br />\| count by src\_ip, start\_time, end\_time, duration<br />\| sort by duration desc<br />\| fields -\_count|
|Google Cloud VPC|Google Cloud VPC Max Flow Time|Logs|Google Cloud VPC/Google Cloud VPC Max Flow Time|\_sourceCategory = Labs/GCP/vpc logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.jsonPayload.connection.src\_ip", "message.data.jsonPayload.start\_time", "message.data.jsonPayload.end\_time" as src\_ip, start\_time, end\_time<br /><br />\| concat(substring(start\_time, 0, 23), "Z") as start\_substr<br />\| concat(substring(end\_time, 0, 23), "Z") as end\_substr<br />\| toMillis(parseDate(start\_substr, "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'")) as start\_millis<br />\| toMillis(parseDate(end\_substr, "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'")) as end\_millis<br />\| end\_millis - start\_millis as duration<br /><br />\| max(duration)|
|Google Cloud VPC|Google Cloud VPC Max Flow Time|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC Max Flow Time|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.jsonPayload.connection.src\_ip", "message.data.jsonPayload.start\_time", "message.data.jsonPayload.end\_time" as src\_ip, start\_time, end\_time<br /><br />\| concat(substring(start\_time, 0, 23), "Z") as start\_substr<br />\| concat(substring(end\_time, 0, 23), "Z") as end\_substr<br />\| toMillis(parseDate(start\_substr, "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'")) as start\_millis<br />\| toMillis(parseDate(end\_substr, "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'")) as end\_millis<br />\| end\_millis - start\_millis as duration<br /><br />\| max(duration)|
|Google Cloud VPC|Google Cloud VPC Top 10 Source IPs by Flow Time|Logs|Google Cloud VPC/Google Cloud VPC Top 10 Source IPs by Flow Time|\_sourceCategory = Labs/GCP/vpc logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.jsonPayload.connection.src\_ip", "message.data.jsonPayload.start\_time", "message.data.jsonPayload.end\_time" as src\_ip, start\_time, end\_time<br /><br />\| concat(substring(start\_time, 0, 23), "Z") as start\_substr<br />\| concat(substring(end\_time, 0, 23), "Z") as end\_substr<br />\| toMillis(parseDate(start\_substr, "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'")) as start\_millis<br />\| toMillis(parseDate(end\_substr, "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'")) as end\_millis<br />\| end\_millis - start\_millis as duration<br /><br />\| count by src\_ip, duration<br />\| top 10 src\_ip by duration|
|Google Cloud VPC|Google Cloud VPC Top 10 Source IPs by Flow Time|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC Top 10 Source IPs by Flow Time|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.jsonPayload.connection.src\_ip", "message.data.jsonPayload.start\_time", "message.data.jsonPayload.end\_time" as src\_ip, start\_time, end\_time<br /><br />\| concat(substring(start\_time, 0, 23), "Z") as start\_substr<br />\| concat(substring(end\_time, 0, 23), "Z") as end\_substr<br />\| toMillis(parseDate(start\_substr, "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'")) as start\_millis<br />\| toMillis(parseDate(end\_substr, "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'")) as end\_millis<br />\| end\_millis - start\_millis as duration<br /><br />\| count by src\_ip, duration<br />\| top 10 src\_ip by duration|
|Google Cloud VPC|Inbound Source Address Locations|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br /><br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets <br />\| lookup latitude, longitude from geo://location on ip=src\_ip<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|count by latitude, longitude<br />\| sort \_count|
|Google Cloud VPC|Inbound Source Address Locations|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br /><br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets <br />\| lookup latitude, longitude from geo://location on ip=src\_ip<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|count by latitude, longitude<br />\| sort \_count|
|Google Cloud VPC|Latency (ms) Box Plot|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets <br />\| timeslice 1m<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|min(rtt), pct(rtt,25), pct(rtt,50), pct(rtt,75), max(rtt) by \_timeslice|
|Google Cloud VPC|MBs Box Plot|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| timeslice 1m<br /><br />\| json "message.data.jsonPayload.bytes\_sent" as bytes\_sent \| number(bytes\_sent) / 1024 as mbs\_sent<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|min(mbs\_sent), pct(mbs\_sent,25), pct(mbs\_sent,50), pct(mbs\_sent,75), max(mbs\_sent) by \_timeslice|
|Google Cloud VPC|MBs per Minute - Outlier|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| timeslice 1m<br /><br />\| json "message.data.jsonPayload.bytes\_sent" as bytes\_sent \| number(bytes\_sent) / 1024 as mbs\_sent<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|sum(mbs\_sent) as total\_mbs\_sent by \_timeslice<br />\| outlier total\_mbs\_sent direction=+|
|Google Cloud VPC|MBs per Minute - Trend|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| timeslice 1m<br /><br />\| json "message.data.jsonPayload.bytes\_sent" as bytes\_sent \| number(bytes\_sent) / 1024 as mbs\_sent<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|sum(mbs\_sent) as total\_mbs\_sent by \_timeslice<br />\| predict total\_mbs\_sent by 1m|
|Google Cloud VPC|Messages per Minute - Outlier|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| timeslice 1m<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|count as messages by \_timeslice<br />\| outlier messages direction=+|
|Google Cloud VPC|Messages per Minute - Trend|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| timeslice 1m<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|count as messages by \_timeslice<br />\| predict messages by 1m|
|Google Cloud VPC|Messages per Minute by Project|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| timeslice 1m<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|count as messages by \_timeslice, project<br />\| transpose row \_timeslice column project|
|Google Cloud VPC|Outbound Destination Address Locations|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets <br /><br />\| lookup latitude, longitude from geo://location on ip=dest\_ip<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|count by latitude, longitude<br />\| sort \_count|
|Google Cloud VPC|Outbound Destination Address Locations|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets <br /><br />\| lookup latitude, longitude from geo://location on ip=dest\_ip<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|count by latitude, longitude<br />\| sort \_count|
|Google Cloud VPC|Packets Box Plot|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets <br />\| timeslice 1m<br /><br />\| json "message.data.jsonPayload.packets\_sent" as packets\_sent<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|min(packets\_sent), pct(packets\_sent,25), pct(packets\_sent,50), pct(packets\_sent,75), max(packets\_sent) by \_timeslice|
|Google Cloud VPC|Packets by Destination VM Over Time|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity|\_sourceCategory={{Logsdatasource}}  logName resource timestamp dest\_instance<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets <br />// we look at internal sources only<br />\| where !isNull(dest\_vm) && dest\_vm !=""<br />\| timeslice 1m<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|sum(packets) as packets by \_timeslice, dest\_vm,dest\_region<br />\| transpose row \_timeslice column dest\_vm,dest\_region|
|Google Cloud VPC|Packets by Source VM Over Time|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity|\_sourceCategory={{Logsdatasource}}  logName resource timestamp (dest\_instance or src\_instance)<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets <br />// we look at internal sources only<br />\| where (src\_vm!="") && (!isNull(src\_vm))<br />\| timeslice 1m<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|sum(packets) as packets by \_timeslice, src\_vm,src\_region<br />\| transpose row \_timeslice column src\_vm,src\_region|
|Google Cloud VPC|Packets by Subnetwork ID|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity|\_sourceCategory={{Logsdatasource}}  logName resource timestamp dest\_instance<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets  <br />\| timeslice 1m<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|sum(packets) as packets by subnetwork\_id,subnetwork\_name,\_timeslice<br />\| transpose row \_timeslice column subnetwork\_id,subnetwork\_name|
|Google Cloud VPC|Packets per Minute - Outlier|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets <br />\| timeslice 1m<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|sum(packets) as total\_packets\_sent by \_timeslice<br />\| outlier total\_packets\_sent direction=+|
|Google Cloud VPC|Packets per Minute - Trend|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Advanced Metrics|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets <br />\| timeslice 1m<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|sum(packets) as total\_packets\_sent by \_timeslice<br />\| predict total\_packets\_sent by 1m|
|Google Cloud VPC|Top 10 Destination VMs by Traffic (MiB)|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| where (dest\_instance!="") and (!isNull(dest\_instance))<br />\| json field=payload "bytes\_sent" as bytes \| (bytes/1Mi) as mbs\_sent<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|sum(mbs\_sent) as total\_mbs\_sent by dest\_vm, dest\_zone, dest\_project \| top 10 dest\_vm, dest\_zone, dest\_project by total\_mbs\_sent|
|Google Cloud VPC|Top 10 Destination VMs per VPC by Traffic (MiB)|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| where (dest\_instance!="") and (!isNull(dest\_instance))<br />\| json field=payload "bytes\_sent" as bytes \| (bytes/1Mi) as mbs\_sent<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|sum(mbs\_sent) as total\_mbs\_sent by dest\_vpc, dest\_vm, dest\_zone, dest\_project <br />// trick to get top 10 instances per VPC <br />\| sort by total\_mbs\_sent \| 1 as dummy \| accum dummy as rank by dest\_vpc \| where rank \<= 10 \| fields -dummy,rank<br />\| transpose row dest\_vpc column dest\_vm, dest\_zone, dest\_project|
|Google Cloud VPC|Top 10 External Destination Ports by VPC Flows|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| where isNull(dest\_instance) or dest\_instance="" // we only look at outbound flows, assuming all connections will have at least some outbound data<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|count as flows dest\_port \| top 10 dest\_port by flows|
|Google Cloud VPC|Top 10 External IPs by Traffic (MiB)|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br /><br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| if (isNull(src\_instance) \|\| src\_instance="",src\_ip,if(isNull(dest\_instance)\|\| dest\_instance="",dest\_ip,"")) as external\_ip<br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent" as bytes <br />\| if (external\_ip=src\_ip, bytes,0) as bytes\_sent \| if (external\_ip=dest\_ip,bytes,0) as bytes\_rcv<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|sum(bytes\_sent) as bytes\_sent, sum(bytes\_rcv) as bytes\_rcv by external\_ip  \| (bytes\_sent+bytes\_rcv) as bytes\_total <br />\| (bytes\_sent/1Ki) as mbs\_sent \| (bytes\_rcv/1Ki) as mbs\_rcv \| (bytes\_total/1Ki) as mbs\_total<br />\| order by mbs\_total \| limit 10<br />\| fields -bytes\_sent, bytes\_rcv,bytes\_total, mbs\_total|
|Google Cloud VPC|Top 10 External IPs by VPC Flows|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| if (isNull(src\_instance) \|\| src\_instance="",src\_ip,if(isNull(dest\_instance)\|\| dest\_instance="",dest\_ip,"")) as external\_ip<br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|count as flows by external\_ip  \| order by flows|
|Google Cloud VPC|Top 10 Internal Destination Ports by VPC Flows|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| where isNull(src\_instance) or src\_instance="" // we only look at inbound flows, assuming all connections will have at least some inbound data<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|count as flows dest\_port \| top 10 dest\_port by flows|
|Google Cloud VPC|Top 10 Source VMs by Traffic (MiB)|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| where (src\_vm!="") and (!isNull(src\_vm))<br />\| json field=payload "bytes\_sent" as bytes \| (bytes/1Mi) as mbs\_sent<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|sum(mbs\_sent) as total\_mbs\_sent by src\_vm, src\_zone, src\_project \| top 10 src\_vm, src\_zone, src\_project by total\_mbs\_sent|
|Google Cloud VPC|Top 10 Source VMs per VPC by Traffic (MiB)|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview|\_sourceCategory={{Logsdatasource}}  logName resource timestamp<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| where (src\_instance!="") and (!isNull(src\_instance))<br />\| json field=payload "bytes\_sent" as bytes \| (bytes/1Mi) as mbs\_sent<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|sum(mbs\_sent) as total\_mbs\_sent by src\_vpc, src\_vm, src\_zone, src\_project <br />// trick to get top 10 instances per VPC <br />\| sort by total\_mbs\_sent \| 1 as dummy \| accum dummy as rank by src\_vpc \| where rank \<= 10 \| fields -dummy,rank<br />\| transpose row src\_vpc column src\_vm, src\_zone, src\_project|
|Google Cloud VPC|Traffic (MiB)  by VPC|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview|\_sourceCategory={{Logsdatasource}}  logName resource timestamp <br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets <br />\| if (!isNull(src\_vpc),src\_vpc,dest\_vpc) as vpc\_name<br />\| timeslice 1h<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|sum(bytes) by vpc\_name,\_timeslice  \| (\_sum/1Mi) as \_sum<br />\| transpose row \_timeslice column vpc\_name|
|Google Cloud VPC|Traffic (MiB) by Destination VM Over Time|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity|\_sourceCategory={{Logsdatasource}}  logName resource timestamp dest\_instance<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets <br />// we look at internal sources only<br />\| where !isNull(dest\_vm) && dest\_vm !=""<br />\| timeslice 1m \| (bytes/1Mi) as mbytes<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|sum(mbytes) as mbytes by \_timeslice, dest\_vm,dest\_region<br />\| transpose row \_timeslice column dest\_vm,dest\_region|
|Google Cloud VPC|Traffic (MiB) by Project|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview|\_sourceCategory={{Logsdatasource}}  logName resource timestamp <br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets <br />\| timeslice 1h<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|sum(bytes) by project,\_timeslice \| (\_sum/1Mi) as \_sum<br />\| transpose row \_timeslice column project|
|Google Cloud VPC|Traffic (MiB) by Source VM Over Time|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity|\_sourceCategory={{Logsdatasource}}  logName resource timestamp (dest\_instance or src\_instance)<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets <br />// we look at internal sources only<br />\| where (src\_vm!="") && (!isNull(src\_vm))<br />\| timeslice 1m \| (bytes/1Mi) as mbytes<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|sum(mbytes) as  mbytes by \_timeslice, src\_vm,src\_region<br />\| transpose row \_timeslice column src\_vm,src\_region|
|Google Cloud VPC|Traffic (MiB) by Subnetwork|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview|\_sourceCategory={{Logsdatasource}}  logName resource timestamp <br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets  <br />\| timeslice 1h<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|sum(bytes) by subnetwork\_name,subnetwork\_id, \_timeslice  \| (\_sum/1Mi) as \_sum<br />\| transpose row \_timeslice column subnetwork\_name,subnetwork\_id|
|Google Cloud VPC|Traffic (MiB) by Subnetwork ID|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Activity|\_sourceCategory={{Logsdatasource}}  logName resource timestamp dest\_instance<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br />\| json field=payload "bytes\_sent","rtt\_msec","packets\_sent"  as bytes, rtt,packets  <br />\| timeslice 1m \| (bytes/1Mi) as mbytes<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|sum(mbytes) as mbytes by subnetwork\_id,subnetwork\_name,\_timeslice<br />\| transpose row \_timeslice column subnetwork\_id,subnetwork\_name|
|Google Cloud VPC|VPC Flows per Protocol by Hour|Logs|Installed Apps/Google Cloud VPC/Google Cloud VPC - Overview|(\_sourceCategory={{Logsdatasource}}  logName resource timestamp)<br />\| json "message.data.resource.type" as type <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type = "gce\_subnetwork" \| where log\_name matches "projects/\*/logs/compute.googleapis.com%2Fvpc\_flows"<br />\| json "message.data.resource" as resource \| json field=resource "labels.location","labels.project\_id","labels.subnetwork\_id","labels.subnetwork\_name" as zone,project,subnetwork\_id,subnetwork\_name nodrop<br />\| json "message.data.resource.labels", "message.data.jsonPayload" as labels, payload<br />\| json field=payload "src\_instance","dest\_instance" as src\_instance,dest\_instance nodrop <br />\| json field=payload "src\_vpc.vpc\_name","dest\_vpc.vpc\_name" as src\_vpc,dest\_vpc nodrop<br />\| json field=payload "connection.src\_ip","connection.dest\_ip","connection.dest\_port","connection.src\_port" as src\_ip,dest\_ip,dest\_port,src\_port <br />\| json field=src\_instance "project\_id", "zone", "region", "vm\_name" as src\_project, src\_zone, src\_region, src\_vm nodrop <br />\| json field=dest\_instance "project\_id", "zone", "region", "vm\_name" as dest\_project, dest\_zone, dest\_region, dest\_vm nodrop<br /><br />\| timeslice 1h<br />\| json "message.data.jsonPayload.connection.protocol" as protocol\_num<br />\| lookup keyword from https://s3.amazonaws.com/sumologic-app-data/protocol-numbers.csv on protocol\_num=decimal<br />\|where if ("{{Src VPC}}" = "\*", true, src\_vpc matches "{{Src VPC}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{Subnetwork ID}}" = "\*", true, subnetwork\_id matches "{{Subnetwork ID}}") AND if ("{{Zone}}" = "\*", true, zone matches "{{Zone}}") AND if ("{{Dest VPC}}" = "\*", true, dest\_vpc matches "{{Dest VPC}}")<br />\|count by \_timeslice,keyword<br />\| transpose row \_timeslice column keyword|

