# PCI Compliance For Windows

## Searches

### Log Searches

- **Actions by Privileged Accounts**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New 
- **All Windows Updates**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 06 - Windows Updates Activity - New 
- **Default Login - Failure**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 02, 10 - Login Activity - New 
- **Default Login - Success**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 02, 10 - Login Activity - New 
- **Excessive Failed Access Attempts**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 08 - Other User Activity - New 
- **Failed Logins**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 02, 10 - Login Activity - New 
- **Failed Logins**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 02, 10 - Login Activity - New 
- **Policy Changes**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New 
- **Recent Windows Update Failures**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 06 - Windows Updates Activity - New 
- **Service Execution Trend**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New 
- **Service Stopped**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New 
- **Successful Logins**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 02, 10 - Login Activity - New 
- **Successful Logins**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 02, 10 - Login Activity - New 
- **System Restarted**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New 
- **System Time Change**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New 
- **Tampering Audit Logs**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New 
- **User Account Created**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New 
- **User Account Deleted**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New 
- **User Account Disabled**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New 
- **User Account disabled but not deleted**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 08 - Other User Activity - New 
- **User Account Enabled**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New 
- **User Account Locked**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New 
- **User Account Password Changes**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 08 - Other User Activity - New 
- **User Account Password Reset**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 08 - Other User Activity - New 
- **User Account UnLocked**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 08 - Other User Activity - New 
- **Windows Update Summary**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 06 - Windows Updates Activity - New 
- **Windows Update Summary by Host**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 06 - Windows Updates Activity - New 
- **Windows Update Trend**: from Dashboard: PCI Compliance For Windows/Windows - PCI Req 06 - Windows Updates Activity - New

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|PCI Compliance For Windows|Actions by Privileged Accounts|Logs|PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse "User = \\"\*\\"" as src\_user nodrop \| parse regex "Logon Type:\\s+(?\<logon\_type\>\\d+)\*" nodrop \| parse regex "Failure Information:\\s+Failure Reason:\\s+(?\<fail\_reason\>[^.\\r]+?)[.\\r]" nodrop \| parse regex "Result Code:\\s+(?\<result\_code\>[^\\r]+)\\r" nodrop \| parse regex "Failure Code:\\s+(?\<failure\_code\>[^\\r]+)\\r" nodrop \| parse regex "Logon Account:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Source Workstation:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Error Code:\\s+(?\<error\_code\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)(?:\\r\|\\";\|\\")" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject:[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r\\"]+?)\\r[\\s\\S]+?(?:New\|Deleted) Group:[\\s\\S]+?(?:Account\|Group) Name:\\s+(?\<group\_name\>[^\\r\\"]+?)\\r\\s+?(?:Account\|Group) Domain:\\s+(?\<group\_domain\>[^\\r\\"]+?)(?:\\r\|\\")" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject:[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Member:[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r\\"]+?)\\r[\\s\\S]+?Group:[\\s\\S]+?(?:Account\|Group) Name:\\s+(?\<group\_name\>[^\\r\\"]+?)\\r\\s+?(?:Account\|Group) Domain:\\s+(?\<group\_domain\>[^\\r\\"]+?)(?:\\r\|\\")" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Domain Name:\\s+(?\<src\_domain\>[^\\r]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject:[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Group:[\\s\\S]+?Group Name:\\s+(?\<group\_name\>[^\\r]+?)\\r\\s+?Group Domain:\\s+(?\<group\_domain\>[^\\r]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Workstation Name:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop<br />\| comp\_name as dest\_host<br />\| src\_user as %"Source User" \| dest\_user as %"Target User" \| dest\_host as %"Target Host" <br />\| format("%S",src\_user) as %"Source User" \| format("%S",dest\_user) as %"Target User"<br />\| fields eventCode, msg\_summary, src\_host, src\_port, %"Source User", %"Target Host", %"Target User"<br />\| where (%"Source User" in ("ROOT","ADMIN","ADMINISTRATOR")) or (%"Target User" in ("ROOT","ADMIN","ADMINISTRATOR"))<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{src\_host}}" = "\*", true, src\_host matches "{{src\_host}}")<br />\|count as %"Count" by eventCode, %"Source User", %"Target Host", %"Target User" \| sort by Count|
|PCI Compliance For Windows|All Windows Updates|Logs|PCI Compliance For Windows/Windows - PCI Req 06 - Windows Updates Activity - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=System (19 or 20) ("EventCode = 19;" or "EventCode = 20;")<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse "Message = \\"\*\\";" as msg\_summary nodrop \| parse "User = \\"\*\\";" as src\_user nodrop \| parse field=src\_user "\*\\\\\*" as src\_domain, src\_user nodrop <br />\| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop<br />\| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as errorCode, Update nodrop<br />\| if(msg\_summary matches "Installation Failure\*", "Update/Failure", if (msg\_summary matches "Installation Successful\*", "Update/Success", "Update/Attempt")) as %"Installation Status"<br />\| fields -\_raw \| comp\_name as %"Destination Host"<br />\| timeslice 1s<br />\|where if ("{{destinationhost}}" = "\*", true, destination host matches "{{destinationhost}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{update}}" = "\*", true, update matches "{{update}}") AND if ("{{installationstatus}}" = "\*", true, installation status matches "{{installationstatus}}")<br />\|count by \_timeslice, %"Destination Host", update, %"Installation Status", errorCode, src\_user, src\_domain, eventCode|
|PCI Compliance For Windows|Default Login - Failure|Logs|PCI Compliance For Windows/Windows - PCI Req 02, 10 - Login Activity - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4625 or 4768 or 4771 or 4776) ("EventCode = 4625;" or "EventCode = 4768;" or "EventCode = 4771;" or "EventCode = 4776;")<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse regex "Logon Type:\\s+(?\<logon\_type\>\\d+)\*" nodrop \| parse regex "Failure Information:\\s+Failure Reason:\\s+(?\<fail\_reason\>[^.\\r]+?)[.\\r]" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop \| parse regex "Result Code:\\s+(?\<result\_code\>[^\\r]+)\\r" nodrop \| parse "Type = \\"\*\\";" as type \| parse regex "Logon Account:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Source Workstation:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Error Code:\\s+(?\<error\_code\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse regex "Failure Code:\\s+(?\<failure\_code\>[^\\r]+)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Workstation Name:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop<br />\| where (eventCode in ("4625", "4771") or (eventCode="4768" and result\_code !="0x0") or (eventCode="4776" and error\_code !="0x0")) and (((touppercase(src\_user) in ("ROOT","ADMIN","ADMINISTRATOR","DBSNMP","SYS","SYSMAN","SYSTEM","CISCO15","SADMIN","CISCO","NETSCREEN")) or (touppercase(dest\_user) in ("ROOT","ADMIN","ADMINISTRATOR","DBSNMP","SYS","SYSMAN","SYSTEM","CISCO15","SADMIN","CISCO","NETSCREEN"))))<br />\| comp\_name as dest\_host <br />\| fields dest\_host, dest\_user, dest\_domain, src\_host, src\_ip, src\_port, src\_user, src\_domain, logon\_type, type, fail\_reason, result\_code, failure\_code, error\_code, eventCode, msg\_summary<br />\| fields -\_raw<br />\| if (dest\_domain="Failure Information:", "", dest\_domain) as dest\_domain<br />\| if (isEmpty(src\_host), src\_ip, src\_host) as src\_host<br />\| timeslice 1s<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{dest\_domain}}" = "\*", true, dest\_domain matches "{{dest\_domain}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{src\_host}}" = "\*", true, src\_host matches "{{src\_host}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{logon\_type}}" = "\*", true, logon\_type matches "{{logon\_type}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount by \_timeslice, dest\_host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, fail\_reason, msg\_summary, eventCode, result\_code, failure\_code, error\_code<br />\| sort by \_timeslice|
|PCI Compliance For Windows|Default Login - Success|Logs|PCI Compliance For Windows/Windows - PCI Req 02, 10 - Login Activity - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4624 "EventCode = 4624;"<br />\| parse "EventCode = \*;" as eventCode \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse regex "Logon Type:\\s+(?\<logon\_type\>\\d+)\*" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Name:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Client Address:[\\s\\r]+(?\<src\_ip\>[^\\r]+)" nodrop<br />\| comp\_name as dest\_host<br />\| where eventCode="4624" and ((touppercase(src\_user) in ("ROOT","ADMIN","ADMINISTRATOR","DBSNMP","SYS","SYSMAN","SYSTEM","CISCO15","SADMIN","CISCO","NETSCREEN")) or (touppercase(dest\_user) in ("ROOT","ADMIN","ADMINISTRATOR","DBSNMP","SYS","SYSMAN","SYSTEM","CISCO15","SADMIN","CISCO","NETSCREEN")))<br />\| fields dest\_host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, eventCode, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{dest\_domain}}" = "\*", true, dest\_domain matches "{{dest\_domain}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{src\_host}}" = "\*", true, src\_host matches "{{src\_host}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{logon\_type}}" = "\*", true, logon\_type matches "{{logon\_type}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount by \_timeslice, dest\_host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, msg\_summary, eventCode<br />\| sort by \_timeslice|
|PCI Compliance For Windows|Excessive Failed Access Attempts|Logs|PCI Compliance For Windows/Windows - PCI Req 08 - Other User Activity - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4625 or 4768 or 4771 or 4776) ("EventCode = 4625;" or "EventCode = 4768;" or "EventCode = 4771;" or "EventCode = 4776;")<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse regex "Logon Type:\\s+(?\<logon\_type\>\\d+)\*" nodrop \| parse regex "Failure Information:\\s+Failure Reason:\\s+(?\<fail\_reason\>[^.\\r]+?)[.\\r]" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Workstation Name:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop \| parse regex "Result Code:\\s+(?\<result\_code\>[^\\r]+)\\r" nodrop \| parse "Type = \\"\*\\";" as type \| parse regex "Logon Account:\\s+(?\<src\_user\>[^\\r]\*?)\\r[\\s\\S]+?Source Workstation:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Error Code:\\s+(?\<error\_code\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse regex "Failure Code:\\s+(?\<failure\_code\>[^\\r]+)\\r" nodrop <br />\| where eventCode in ("4625", "4771") or (eventCode="4768" and result\_code !="0x0") or (eventCode="4776" and error\_code !="0x0")<br />\| comp\_name as dest\_host<br />\| if (dest\_domain="Failure Information:", "", dest\_domain) as dest\_domain<br />\| if (isEmpty(src\_host), src\_ip, src\_host) as src\_host<br />\| src\_user as %"Source User" \| dest\_host as %"Target Host" \| dest\_user as %"Target User" \| src\_host as %"Source Host" <br />\| timeslice 5m<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{dest\_domain}}" = "\*", true, dest\_domain matches "{{dest\_domain}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{src\_host}}" = "\*", true, src\_host matches "{{src\_host}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{logon\_type}}" = "\*", true, logon\_type matches "{{logon\_type}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as %"Attempts" by \_timeslice, %"Source Host", %"Source User", src\_domain, %"Target Host", %"Target User", dest\_domain<br />\| format("Excessive (%d) login failures observed", %"Attempts") as message<br />\| 3 as threshold<br />\| where %"Attempts" \> threshold<br />\| sort by \_timeslice, %"Attempts"<br />\| fields -threshold, %"Attempts"|
|PCI Compliance For Windows|Failed Logins|Logs|PCI Compliance For Windows/Windows - PCI Req 02, 10 - Login Activity - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4625 or 4768 or 4771 or 4776) ("EventCode = 4625;" or "EventCode = 4768;" or "EventCode = 4771;" or "EventCode = 4776;")<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse regex "Logon Type:\\s+(?\<logon\_type\>\\d+)\*" nodrop \| parse regex "Failure Information:\\s+Failure Reason:\\s+(?\<fail\_reason\>[^.\\r]+?)[.\\r]" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop \| parse regex "Result Code:\\s+(?\<result\_code\>[^\\r]+)\\r" nodrop \| parse "Type = \\"\*\\";" as type \| parse regex "Logon Account:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Source Workstation:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Error Code:\\s+(?\<error\_code\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse regex "Failure Code:\\s+(?\<failure\_code\>[^\\r]+)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Workstation Name:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop<br />\| where eventCode in ("4625", "4771") or (eventCode="4768" and result\_code !="0x0") or (eventCode="4776" and error\_code !="0x0")<br />\| comp\_name as dest\_host<br />\| fields dest\_host, dest\_user, dest\_domain, src\_host, src\_ip, src\_port, src\_user, src\_domain, logon\_type, type, fail\_reason, result\_code, failure\_code, error\_code, eventCode, msg\_summary \| fields -\_raw<br />\| if (dest\_domain="Failure Information:", "", dest\_domain) as dest\_domain<br />\| if (isEmpty(src\_host), src\_ip, src\_host) as src\_host<br />\| timeslice 1s<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{dest\_domain}}" = "\*", true, dest\_domain matches "{{dest\_domain}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{src\_host}}" = "\*", true, src\_host matches "{{src\_host}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{logon\_type}}" = "\*", true, logon\_type matches "{{logon\_type}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount by \_timeslice, dest\_host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, fail\_reason, msg\_summary, eventCode, result\_code, failure\_code, error\_code<br />\| sort by \_timeslice|
|PCI Compliance For Windows|Failed Logins|Logs|PCI Compliance For Windows/Windows - PCI Req 02, 10 - Login Activity - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4625 or 4768 or 4771 or 4776) ("EventCode = 4625;" or "EventCode = 4768;" or "EventCode = 4771;" or "EventCode = 4776;")<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse regex "Logon Type:\\s+(?\<logon\_type\>\\d+)\*" nodrop \| parse regex "Failure Information:\\s+Failure Reason:\\s+(?\<fail\_reason\>[^.\\r]+?)[.\\r]" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop \| parse regex "Result Code:\\s+(?\<result\_code\>[^\\r]+)\\r" nodrop \| parse "Type = \\"\*\\";" as type \| parse regex "Logon Account:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Source Workstation:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Error Code:\\s+(?\<error\_code\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse regex "Failure Code:\\s+(?\<failure\_code\>[^\\r]+)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Workstation Name:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop<br />\| where eventCode in ("4625", "4771") or (eventCode="4768" and result\_code !="0x0") or (eventCode="4776" and error\_code !="0x0")<br />\| comp\_name as dest\_host <br />\| fields dest\_host, dest\_user, dest\_domain, src\_host, src\_ip, src\_port, src\_user, src\_domain, logon\_type, type, fail\_reason, result\_code, failure\_code, error\_code, eventCode, msg\_summary<br />\| fields -\_raw<br />\| if (dest\_domain="Failure Information:", "", dest\_domain) as dest\_domain<br />\| if (isEmpty(src\_host), src\_ip, src\_host) as src\_host<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{dest\_domain}}" = "\*", true, dest\_domain matches "{{dest\_domain}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{src\_host}}" = "\*", true, src\_host matches "{{src\_host}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{logon\_type}}" = "\*", true, logon\_type matches "{{logon\_type}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount|
|PCI Compliance For Windows|Policy Changes|Logs|PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New|\_sourceCategory = Labs/Windows/OS/Windows (\_sourceName=Security or \_sourceName=System) ("EventCode = 4902;" or "EventCode = 4904;" or "EventCode = 4905;" or "EventCode = 4906;" or "EventCode = 4907;" or "EventCode = 4912;" or "EventCode = 4715;" or "EventCode = 4717;" or "EventCode = 4719;" or "Audit Policy Change" or "System audit policy was changed" or \*policy\*change\*)<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\.]+?)(?:\\r\|\\.\|\\";)" nodrop \| parse "User = \\"\*\\"" as src\_user nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:[\\s&&[^\\r]]+(?\<src\_user\>[^\\r]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject:[\\s\\S]+?Account Name:[\\s&&[^\\r]]+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Name:[\\s&&[^\\r]]+(?\<dest\_user\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Logon Account:\\s(?\<dest\_user\>[^\\r\\n]+?)(?:\\n\|\\r)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject:[\\s\\S]+?Account Name:[\\s&&[^\\r]]+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Member:[\\s\\S]+?Account Name:[\\s&&[^\\r]]+(?\<dest\_user\>[^\\r\\"]+?)\\r[\\s\\S]+?Group:[\\s\\S]+?(?:Account\|Group) Name:[\\s&&[^\\r]]+(?\<group\_name\>[^\\r\\"]+?)\\r\\s+?(?:Account\|Group) Domain:[\\s&&[^\\r]]+(?\<group\_domain\>[^\\r\\"]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject\\s\*:[\\s\\S]+?Account Domain:[\\s&&[^\\r]]+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:[\\s&&[^\\r]]+(?\<dest\_domain\>[^\\r]+?)(?:\\r\|\\";)" nodrop \| parse regex "\\sType = \\"(?\<msg\_type\>[^\\"]+?)\\";" nodrop \| parse "CategoryString = \\"\*\\";" as CategoryString nodrop \| parse regex "Audit Policy Change:[\\s\\S]+Category:[\\s\\S]+Subcategory:\\s+(?\<subcategory\>[\\s\\S]+)Subcategory GUID:[\\s\\S]+Changes:\\s+(?\<changes\>[^\\"]\*)\\";" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject\\s\*:[\\s\\S]+?Account Domain:[\\s&&[^\\r]]+(?\<src\_domain\>[^\\r]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r" nodrop <br />\| where eventCode in ("4902", "4904", "4905", "4906", "4907", "4912", "4715", "4717", "4719" ) or msg\_summary="System audit policy was changed" or CategoryString matches "\*policy\*change\*" or CategoryString matches "\*Policy\*Change\*"<br />\| comp\_name as dest\_host<br />\| if (msg\_type matches "\*Success","Change/Configuration/Policy/Success", if (msg\_type matches "\*Fail\*", "Change/Configuration/Policy/Failure", "Change/Configuration/Policy/Attempt")) as classification<br />\| src\_ip as src\_host<br />\| fields dest\_host, src\_user, src\_domain, classification, eventCode, msg\_summary<br />\| timeslice 1s<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}")<br />\|count as eventCount by \_timeslice, dest\_host, src\_user, src\_domain, classification, eventCode, msg\_summary<br />\| sort by \_timeslice|
|PCI Compliance For Windows|Recent Windows Update Failures|Logs|PCI Compliance For Windows/Windows - PCI Req 06 - Windows Updates Activity - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=System (19 or 20) ("EventCode = 19;" or "EventCode = 20;")<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse "Message = \\"\*\\";" as msg\_summary nodrop \| parse "User = \\"\*\\";" as src\_user nodrop \| parse field=src\_user "\*\\\\\*" as src\_domain, src\_user nodrop <br />\| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop<br />\| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as errorCode, Update nodrop<br />\| if(msg\_summary matches "Installation Failure\*", "Update/Failure", if (msg\_summary matches "Installation Successful\*", "Update/Success", "Update/Attempt")) as %"Installation Status"<br />\| fields -\_raw \| comp\_name as %"Destination Host"<br />\| timeslice 1s<br />\| withtime %"Installation Status"<br />\|where if ("{{destinationhost}}" = "\*", true, destination host matches "{{destinationhost}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{update}}" = "\*", true, update matches "{{update}}") AND if ("{{installationstatus}}" = "\*", true, installation status matches "{{installationstatus}}")<br />\|most\_recent(%"Installation Status\_withtime") as %"LastStatus" by %"Destination Host", update, \_timeslice<br />\| where %"LastStatus"="Update/Failure"|
|PCI Compliance For Windows|Service Execution Trend|Logs|PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=System 7036 "EventCode = 7036;"<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\.]+?)(?:\\r\|\\.\|\\";)" nodrop \| parse regex field=msg\_summary "The (?\<service\>\\w.+?) service entered the (?\<state\>\\w+) state"<br />\| comp\_name as dest\_host<br />\| where eventCode="7036"<br />\| fields eventCode, dest\_host, msg\_summary, service, state<br />\| timeslice 1h<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{service}}" = "\*", true, service matches "{{service}}") AND if ("{{state}}" = "\*", true, state matches "{{state}}")<br />\|count by \_timeslice, service<br />\| transpose row \_timeslice column service|
|PCI Compliance For Windows|Service Stopped|Logs|PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=System 7036 "stopped state" "EventCode = 7036;"<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\.]+?)(?:\\r\|\\.\|\\";)" nodrop \| parse regex field=msg\_summary "The (?\<service\>\\w.+?) service entered the (?\<state\>\\w+) state"<br />\| comp\_name as dest\_host<br />\| where eventCode="7036"<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}") AND if ("{{service}}" = "\*", true, service matches "{{service}}") AND if ("{{state}}" = "\*", true, state matches "{{state}}")<br />\|count as eventCount, first(\_messagetime) as latest, last(\_messagetime) as earliest by service, dest\_host, state \| latest as \_timeslice<br />\| fields \_timeslice, dest\_host, service, state, latest, earliest, eventCount<br />\| where state="stopped"<br />\| formatDate(fromMillis(latest),"yyyy/MM/dd HH:mm:ss Z") as %"LatestTime" <br />\| formatDate(fromMillis(earliest),"yyyy/MM/dd HH:mm:ss Z") as %"EarliestTime" <br />\| fields -latest, earliest<br />\| sort by \_timeslice|
|PCI Compliance For Windows|Successful Logins|Logs|PCI Compliance For Windows/Windows - PCI Req 02, 10 - Login Activity - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4624 "EventCode = 4624;"<br />\| parse "EventCode = \*;" as eventCode \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse regex "Logon Type:\\s+(?\<logon\_type\>\\d+)\*" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Name:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Client Address:[\\s\\r]+(?\<src\_ip\>[^\\r]+)" nodrop<br />\| comp\_name as dest\_host<br />\| where eventCode="4624" <br />\| fields dest\_host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, eventCode, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{dest\_domain}}" = "\*", true, dest\_domain matches "{{dest\_domain}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{src\_host}}" = "\*", true, src\_host matches "{{src\_host}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{logon\_type}}" = "\*", true, logon\_type matches "{{logon\_type}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount by \_timeslice, dest\_host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, msg\_summary, eventCode<br />\| sort by \_timeslice|
|PCI Compliance For Windows|Successful Logins|Logs|PCI Compliance For Windows/Windows - PCI Req 02, 10 - Login Activity - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4624 "EventCode = 4624;"<br />\| parse "EventCode = \*;" as eventCode \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse regex "Logon Type:\\s+(?\<logon\_type\>\\d+)\*" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Name:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Client Address:[\\s\\r]+(?\<src\_ip\>[^\\r]+)" nodrop<br />\| comp\_name as dest\_host<br />\| where eventCode="4624" <br />\| fields dest\_host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, eventCode, msg\_summary<br />\| fields -\_raw<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{dest\_domain}}" = "\*", true, dest\_domain matches "{{dest\_domain}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{src\_host}}" = "\*", true, src\_host matches "{{src\_host}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{logon\_type}}" = "\*", true, logon\_type matches "{{logon\_type}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount|
|PCI Compliance For Windows|System Restarted|Logs|PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4608 "EventCode = 4608;"<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\.]+?)(?:\\r\|\\.\|\\";)" nodrop<br />\| comp\_name as dest\_host<br />\| fields dest\_host, msg\_summary, eventCode<br />\| timeslice 1s<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}")<br />\|count as eventCount by \_timeslice, dest\_host, msg\_summary, eventCode<br />\| where eventCode="4608"<br />\| sort by \_timeslice|
|PCI Compliance For Windows|System Time Change|Logs|PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New|\_sourceCategory = Labs/Windows/OS/Windows ((\_sourceName=Security 4616 "EventCode = 4616;") or (\_sourceName=System (35 or 37) ("EventCode = 35;" or "EventCode = 37;")))<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\.]+?)(?:\\r\|\\.\|\\";)" nodrop \| parse "User = \\"\*\\"" as src\_user nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r" nodrop<br />\| comp\_name as dest\_host<br />\| where eventCode in ("4616", "35", "37") <br />\| if (msg\_summary="The system time was changed" and src\_user \<\> "LOCAL SERVICE" and src\_domain \<\> "NT AUTHORITY", "Critical", "Low") as Severity<br />\| fields dest\_host, src\_user, src\_domain, Severity, eventCode, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}")<br />\|count as eventCount by \_timeslice, dest\_host, src\_user, src\_domain, Severity, eventCode, msg\_summary<br />\| sort by Severity asc, \_timeslice|
|PCI Compliance For Windows|Tampering Audit Logs|Logs|PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New|\_sourceCategory = Labs/Windows/OS/Windows (\_sourceName=Security or \_sourceName=System) (1102 or 517 or 104) ("EventCode = 1102;" or "EventCode = 517;" or "EventCode = 104;")<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\.]+?)(?:\\r\|\\.\|\\";)" nodrop \| parse "User = \\"\*\\"" as src\_user nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Domain Name:\\s+(?\<src\_domain\>[^\\r]+?)\\r" nodrop<br />\| comp\_name as dest\_host<br />\| fields dest\_host, src\_user, src\_domain, eventCode, msg\_summary<br />\| fields -\_raw<br />\| where eventCode in ("1102", "517", "104")<br />\| timeslice 1s<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}")<br />\|count as eventCount by \_timeslice, dest\_host, src\_user, src\_domain, eventCode, msg\_summary<br />\| sort by \_timeslice|
|PCI Compliance For Windows|User Account Created|Logs|PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4720 "EventCode = 4720;"<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r]+?)\\r" nodrop<br />\| comp\_name as dest\_host<br />\| fields dest\_host, dest\_user, dest\_domain, src\_user, src\_domain, eventCode, msg\_summary<br />\| timeslice 1s<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{dest\_domain}}" = "\*", true, dest\_domain matches "{{dest\_domain}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount by \_timeslice, dest\_host, dest\_user, dest\_domain, src\_user, src\_domain, eventCode, msg\_summary<br />\| where eventCode="4720"<br />\| sort by \_timeslice|
|PCI Compliance For Windows|User Account Deleted|Logs|PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4726 "EventCode = 4726;"<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r]+?)\\r" nodrop<br />\| comp\_name as dest\_host<br />\| fields dest\_host, dest\_user, dest\_domain, src\_user, src\_domain, eventCode, msg\_summary<br />\| timeslice 1s<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{dest\_domain}}" = "\*", true, dest\_domain matches "{{dest\_domain}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount by \_timeslice, dest\_host, dest\_user, dest\_domain, src\_user, src\_domain, eventCode, msg\_summary<br />\| where eventCode="4726"<br />\| sort by \_timeslice|
|PCI Compliance For Windows|User Account Disabled|Logs|PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4725 "EventCode = 4725;"<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\.]+?)(?:\\r\|\\.\|\\";)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)(?:\\r\|\\")" nodrop<br />\| where eventCode="4725"<br />\| comp\_name as dest\_host <br />\| fields dest\_host, dest\_user, dest\_domain, src\_user, src\_domain, eventCode, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{dest\_domain}}" = "\*", true, dest\_domain matches "{{dest\_domain}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount by \_timeslice, dest\_host, dest\_user, dest\_domain, src\_user, src\_domain, eventCode, msg\_summary<br />\| sort by \_timeslice|
|PCI Compliance For Windows|User Account disabled but not deleted|Logs|PCI Compliance For Windows/Windows - PCI Req 08 - Other User Activity - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security ((4726 "EventCode = 4726;") or (4725 "EventCode = 4725;"))<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\.]+?)(?:\\r\|\\.\|\\";)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)(?:\\r\|\\")" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r]+?)\\r" nodrop<br />\| comp\_name as dest\_host<br />\| where eventCode="4725" or eventCode="4726"<br />\| withtime msg\_summary \| withtime \_messagetime<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{dest\_domain}}" = "\*", true, dest\_domain matches "{{dest\_domain}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|most\_recent(msg\_summary\_withtime) as action, most\_recent(\_messagetime\_withtime) as m\_time by dest\_host, dest\_user<br />\| formatDate(fromMillis(m\_time), "MM-dd-yyyy HH:mm:ss:SSS z") as event\_time<br />\| 1000\*60\*60\*24 as Oneday<br />\| 1 as threshold <br />\| num(threshold) as threshold<br />\| ((toMillis(now())-m\_time)/oneday) as since\_days \| format("%.2f", since\_days) as since\_days\_str<br />\| concat ("User account was disabled since ", since\_days\_str, " days but not yet deleted.") as Remark<br />\| where (action  != "A user account was deleted")<br />\| where since\_days \>= threshold<br />\| sort by since\_days<br />\| fields - m\_time, Oneday, since\_days\_str, action, since\_days, threshold|
|PCI Compliance For Windows|User Account Enabled|Logs|PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4722 "EventCode = 4722;"<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\.]+?)(?:\\r\|\\.\|\\";)" nodrop <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)(?:\\r\|\\")" nodrop<br />\| comp\_name as dest\_host<br />\| where eventCode="4722"<br />\| fields dest\_host, dest\_user, dest\_domain, src\_user, src\_domain, eventCode, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{dest\_domain}}" = "\*", true, dest\_domain matches "{{dest\_domain}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount by \_timeslice, dest\_host, dest\_user, dest\_domain, src\_user, src\_domain, eventCode, msg\_summary<br />\| sort by \_timeslice|
|PCI Compliance For Windows|User Account Locked|Logs|PCI Compliance For Windows/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4740 or 644) ("EventCode = 4740;" or "EventCode = 644;")<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r" nodrop<br />\| comp\_name as dest\_host<br />\| fields dest\_host, dest\_user, src\_user, src\_domain, eventCode, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount by \_timeslice, dest\_host, dest\_user, src\_user, src\_domain, eventCode, msg\_summary<br />\| where eventCode in ("4740", "644")<br />\| sort by \_timeslice|
|PCI Compliance For Windows|User Account Password Changes|Logs|PCI Compliance For Windows/Windows - PCI Req 08 - Other User Activity - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4723 "EventCode = 4723;"<br />\| parse "EventCode = \*;" as eventCode nodrop<br />\| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r]+?)\\r" nodrop<br />\| where eventCode="4723"<br />\| timeslice 1s<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{dest\_domain}}" = "\*", true, dest\_domain matches "{{dest\_domain}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount by \_timeslice, dest\_user, dest\_domain, src\_user, src\_domain, msg\_summary, eventCode<br />\| sort by \_timeslice|
|PCI Compliance For Windows|User Account Password Reset|Logs|PCI Compliance For Windows/Windows - PCI Req 08 - Other User Activity - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4724 "EventCode = 4724;"<br />\| parse "EventCode = \*;" as eventCode nodrop<br />\| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop<br />\| where eventCode="4724"<br />\| comp\_name as dest\_host<br />\| timeslice 1s<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{dest\_domain}}" = "\*", true, dest\_domain matches "{{dest\_domain}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount by \_timeslice, dest\_host, dest\_user, dest\_domain, src\_user, src\_domain, msg\_summary, eventCode<br />\| sort by \_timeslice|
|PCI Compliance For Windows|User Account UnLocked|Logs|PCI Compliance For Windows/Windows - PCI Req 08 - Other User Activity - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4767 "EventCode = 4767;"<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\"]\*)\\";" nodrop<br />\| where eventCode="4767"<br />\| comp\_name as dest\_host<br />\| timeslice 1s<br />\|where if ("{{eventcode}}" = "\*", true, eventcode matches "{{eventcode}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{dest\_domain}}" = "\*", true, dest\_domain matches "{{dest\_domain}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{dest\_host}}" = "\*", true, dest\_host matches "{{dest\_host}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as eventCount by \_timeslice, dest\_host, src\_user, src\_domain, dest\_user, dest\_domain, msg\_summary, eventCode<br />\| sort by \_timeslice|
|PCI Compliance For Windows|Windows Update Summary|Logs|PCI Compliance For Windows/Windows - PCI Req 06 - Windows Updates Activity - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=System (19 or 20) ("EventCode = 19;" or "EventCode = 20;")<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse "Message = \\"\*\\";" as msg\_summary nodrop<br />\| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop<br />\| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as errorCode, Update nodrop<br />\| where !isEmpty(Update)<br />\| if(msg\_summary matches "Installation Failure\*", "Update/Failure", if (msg\_summary matches "Installation Successful\*", "Update/Success", "Update/Attempt")) as %"Installation Status"<br />\| comp\_name as %"Destination Host"<br />\| withtime %"Installation Status"<br />\|where if ("{{destinationhost}}" = "\*", true, destination host matches "{{destinationhost}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{update}}" = "\*", true, update matches "{{update}}") AND if ("{{installationstatus}}" = "\*", true, installation status matches "{{installationstatus}}")<br />\|most\_recent(%"Installation Status\_withtime") as %"LastStatus" by %"Destination Host", update<br />\| count\_distinct(%"Destination Host") as %"Hosts" by LastStatus, update<br />\| transpose row update column LastStatus|
|PCI Compliance For Windows|Windows Update Summary by Host|Logs|PCI Compliance For Windows/Windows - PCI Req 06 - Windows Updates Activity - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=System (19 or 20) ("EventCode = 19;" or "EventCode = 20;")<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse "Message = \\"\*\\";" as msg\_summary nodrop<br />\| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop<br />\| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as errorCode, Update nodrop<br />\| if(msg\_summary matches "Installation Failure\*", "Update/Failure", if (msg\_summary matches "Installation Successful\*", "Update/Success", "Update/Attempt")) as %"Installation Status"<br />\| comp\_name as %"Destination Host"<br />\| withtime %"Installation Status"<br />\|where if ("{{destinationhost}}" = "\*", true, destination host matches "{{destinationhost}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{update}}" = "\*", true, update matches "{{update}}") AND if ("{{installationstatus}}" = "\*", true, installation status matches "{{installationstatus}}")<br />\|most\_recent(%"Installation Status\_withtime") as %"LastStatus" by %"Destination Host", update<br />\| count by %"Destination Host", %"LastStatus"<br />\| transpose row %"Destination Host" column %"LastStatus"|
|PCI Compliance For Windows|Windows Update Trend|Logs|PCI Compliance For Windows/Windows - PCI Req 06 - Windows Updates Activity - New|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=System (19 or 20) ("EventCode = 19;" or "EventCode = 20;")<br />\| parse "EventCode = \*;" as eventCode nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse "Message = \\"\*\\";" as msg\_summary nodrop<br />\| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop<br />\| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as errorCode, Update nodrop<br />\| if(msg\_summary matches "Installation Failure\*", "Update/Failure", if (msg\_summary matches "Installation Successful\*", "Update/Success", "Update/Attempt")) as %"Installation Status"<br />\| comp\_name as %"Destination Host"<br />\| timeslice 1h<br />\| withtime %"Installation Status"<br />\|where if ("{{destinationhost}}" = "\*", true, destination host matches "{{destinationhost}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{update}}" = "\*", true, update matches "{{update}}") AND if ("{{installationstatus}}" = "\*", true, installation status matches "{{installationstatus}}")<br />\|most\_recent(%"Installation Status\_withtime") as %"LastStatus" by %"Destination Host", update, \_timeslice<br />\| count\_distinct(%"Destination Host") by LastStatus, \_timeslice<br />\| transpose row \_timeslice column LastStatus|

