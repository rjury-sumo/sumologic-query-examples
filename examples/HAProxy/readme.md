# HAProxy
## Sumo Logic App For: HAProxy
HAProxy is open source software that provides a high availability load balancer and proxy server for TCP and HTTP-based applications that spreads requests across multiple servers. The Sumo Logic App for HAProxy is a unified logs and metrics app that helps you monitor the availability, performance and health of your HAProxy cluster. Preconfigured dashboards provide insights into active servers, visitor locations, sessions, errors, response time and throughput.
Docs Link: [HAProxy](https://help.sumologic.com/?cid=210511)

## Searches

### Log Searches

- **Backend Errors**: from Dashboard: HAProxy/Logs/HAProxy - Error Log Analysis 
- **Bytes Served**: from Dashboard: HAProxy/Logs/HAProxy - Visitor Traffic Insight 
- **Bytes Served - Outlier**: from Dashboard: HAProxy/Logs/HAProxy - Outlier Analysis 
- **Client Errors**: from Dashboard: HAProxy/Logs/HAProxy - Outlier Analysis 
- **Client Locations - 4xx Errors**: from Dashboard: HAProxy/Logs/HAProxy - Visitor Access Types 
- **Client Locations - 4xx Errors**: from Dashboard: HAProxy/Logs/HAProxy - Web Server Operations 
- **Client Locations with Critical Errors**: from Dashboard: HAProxy/Logs/HAProxy - Error Log Analysis 
- **Critical Errors**: from Dashboard: HAProxy/Logs/HAProxy - Error Log Analysis 
- **Highly Malicious Threats**: from Dashboard: HAProxy/Logs/HAProxy - Threat Analysis 
- **HTTP Methods**: from Dashboard: HAProxy/Logs/HAProxy - Visitor Traffic Insight 
- **Media Types Served**: from Dashboard: HAProxy/Logs/HAProxy - Visitor Traffic Insight 
- **Non 200 Response Status Codes**: from Dashboard: HAProxy/Logs/HAProxy - Visitor Access Types 
- **Non 200 Response Status Codes**: from Dashboard: HAProxy/Logs/HAProxy - Web Server Operations 
- **Number of Hits by Server - One Day Time Comparison**: from Dashboard: HAProxy/Logs/HAProxy - Trends 
- **Number of Visitors**: from Dashboard: HAProxy/Logs/HAProxy - Outlier Analysis 
- **Responses Over Time**: from Dashboard: HAProxy/HAProxy - Overview 
- **Responses Over Time**: from Dashboard: HAProxy/Logs/HAProxy - Trends 
- **Server Down Events**: from Dashboard: HAProxy/Logs/HAProxy - Error Log Analysis 
- **Server Errors**: from Dashboard: HAProxy/Logs/HAProxy - Outlier Analysis 
- **Threat Count**: from Dashboard: HAProxy/Logs/HAProxy - Threat Analysis 
- **Threat Locations**: from Dashboard: HAProxy/Logs/HAProxy - Threat Analysis 
- **Threats by Actors**: from Dashboard: HAProxy/Logs/HAProxy - Threat Analysis 
- **Threats by Malicious Confidence**: from Dashboard: HAProxy/Logs/HAProxy - Threat Analysis 
- **Threats by Source**: from Dashboard: HAProxy/Logs/HAProxy - Threat Analysis 
- **Top 10 Search Terms from Popular Search Engines**: from Dashboard: HAProxy/Logs/HAProxy - Visitor Traffic Insight 
- **Top 10 Threats**: from Dashboard: HAProxy/Logs/HAProxy - Threat Analysis 
- **Top 5 Clients Causing 4xx Errors**: from Dashboard: HAProxy/Logs/HAProxy - Visitor Access Types 
- **Top 5 Clients Causing 4xx Errors**: from Dashboard: HAProxy/Logs/HAProxy - Web Server Operations 
- **Top 5 Clients Causing Errors**: from Dashboard: HAProxy/Logs/HAProxy - Error Log Analysis 
- **Top 5 Highly Malicious URLs**: from Dashboard: HAProxy/Logs/HAProxy - Threat Analysis 
- **Top 5 Referrers**: from Dashboard: HAProxy/Logs/HAProxy - Visitor Traffic Insight 
- **Top 5 Urls**: from Dashboard: HAProxy/Logs/HAProxy - Visitor Traffic Insight 
- **Top 5 URLs Causing 4xx Responses**: from Dashboard: HAProxy/Logs/HAProxy - Web Server Operations 
- **Top 5 URLs Causing 4xx Responses**: from Dashboard: HAProxy/Logs/HAProxy - Visitor Access Types 
- **Top 5 URLs with Errors**: from Dashboard: HAProxy/HAProxy - Overview 
- **Traffic Distribution by Server**: from Dashboard: HAProxy/Logs/HAProxy - Trends 
- **Traffic Volume and Bytes Served**: from Dashboard: HAProxy/Logs/HAProxy - Trends 
- **United States**: from Dashboard: HAProxy/Logs/HAProxy - Visitor Locations 
- **Visitor Locations**: from Dashboard: HAProxy/HAProxy - Overview 
- **Visitor Locations - One Day Time Comparison**: from Dashboard: HAProxy/Logs/HAProxy - Trends 
- **Visitor Platforms**: from Dashboard: HAProxy/Logs/HAProxy - Visitor Access Types 
- **Visitor Platforms**: from Dashboard: HAProxy/Logs/HAProxy - Web Server Operations 
- **Visits by Country Over Time**: from Dashboard: HAProxy/Logs/HAProxy - Visitor Locations 
- **Visits by US Regions Over Time**: from Dashboard: HAProxy/Logs/HAProxy - Visitor Locations 
- **Worldwide**: from Dashboard: HAProxy/Logs/HAProxy - Visitor Locations

### Metric Searches

- **4xx Responses**: from Dashboard: HAProxy/Metrics/HAProxy - Server Metrics 
- **Active Backend Servers**: from Dashboard: HAProxy/Metrics/HAProxy - Server Metrics 
- **Active Servers**: from Dashboard: HAProxy/Metrics/HAProxy - Backend Metrics 
- **Active Servers**: from Dashboard: HAProxy/HAProxy - Overview 
- **Availability - Redispatch Warnings/ Retry Warnings**: from Dashboard: HAProxy/Metrics/HAProxy - Server Metrics 
- **Availability - Redispatch/Retry Warnings**: from Dashboard: HAProxy/Metrics/HAProxy - Backend Metrics 
- **Average Connect Latency**: from Dashboard: HAProxy/Metrics/HAProxy - Backend Metrics 
- **Average Connect Latency**: from Dashboard: HAProxy/Metrics/HAProxy - Server Metrics 
- **Average Latency**: from Dashboard: HAProxy/Metrics/HAProxy - Backend Metrics 
- **Average Latency**: from Dashboard: HAProxy/Metrics/HAProxy - Server Metrics 
- **Average Queue Latency**: from Dashboard: HAProxy/Metrics/HAProxy - Server Metrics 
- **Average Queue Latency**: from Dashboard: HAProxy/Metrics/HAProxy - Backend Metrics 
- **Average Response Latency**: from Dashboard: HAProxy/Metrics/HAProxy - Backend Metrics 
- **Average Response Latency**: from Dashboard: HAProxy/Metrics/HAProxy - Server Metrics 
- **Backend Connection Errors**: from Dashboard: HAProxy/Metrics/HAProxy - Backend Metrics 
- **Backend Denials**: from Dashboard: HAProxy/HAProxy - Overview 
- **Backend Network Traffic**: from Dashboard: HAProxy/HAProxy - Overview 
- **Backend Queue**: from Dashboard: HAProxy/HAProxy - Overview 
- **Backend Response Time**: from Dashboard: HAProxy/HAProxy - Overview 
- **Backend Server Connection Errors**: from Dashboard: HAProxy/Metrics/HAProxy - Server Metrics 
- **Backend Sessions %**: from Dashboard: HAProxy/HAProxy - Overview 
- **Backend Sessions %**: from Dashboard: HAProxy/HAProxy - Overview 
- **Backend Weight**: from Dashboard: HAProxy/Metrics/HAProxy - Backend Metrics 
- **Backup Backend Servers**: from Dashboard: HAProxy/Metrics/HAProxy - Server Metrics 
- **Backup Servers**: from Dashboard: HAProxy/Metrics/HAProxy - Backend Metrics 
- **Bytes - IN**: from Dashboard: HAProxy/Metrics/HAProxy - Frontend Metrics 
- **Bytes - OUT**: from Dashboard: HAProxy/Metrics/HAProxy - Frontend Metrics 
- **Bytes In**: from Dashboard: HAProxy/Metrics/HAProxy - Backend Metrics 
- **Bytes In**: from Dashboard: HAProxy/Metrics/HAProxy - Server Metrics 
- **Bytes Out**: from Dashboard: HAProxy/Metrics/HAProxy - Server Metrics 
- **Bytes Out**: from Dashboard: HAProxy/Metrics/HAProxy - Backend Metrics 
- **Connections Errors**: from Dashboard: HAProxy/HAProxy - Overview 
- **Connections Utilization %**: from Dashboard: HAProxy/Metrics/HAProxy - Server Metrics 
- **Current Session Count**: from Dashboard: HAProxy/Metrics/HAProxy - Backend Metrics 
- **Current Sessions**: from Dashboard: HAProxy/Metrics/HAProxy - Frontend Metrics 
- **Current Sessions/s**: from Dashboard: HAProxy/Metrics/HAProxy - Server Metrics 
- **Failed Health Checks**: from Dashboard: HAProxy/Metrics/HAProxy - Server Metrics 
- **Frontend Denials**: from Dashboard: HAProxy/HAProxy - Overview 
- **Frontend Network Traffic**: from Dashboard: HAProxy/HAProxy - Overview 
- **Frontend Requests / Second**: from Dashboard: HAProxy/HAProxy - Overview 
- **Frontend Sessions %**: from Dashboard: HAProxy/HAProxy - Overview 
- **Frontend Sessions %**: from Dashboard: HAProxy/HAProxy - Overview 
- **HTTP Response Codes**: from Dashboard: HAProxy/Metrics/HAProxy - Server Metrics 
- **HTTP Response Codes**: from Dashboard: HAProxy/Metrics/HAProxy - Backend Metrics 
- **HTTP Response Codes (Total)**: from Dashboard: HAProxy/Metrics/HAProxy - Frontend Metrics 
- **HTTP Response Codes Ratio 4xx**: from Dashboard: HAProxy/Metrics/HAProxy - Frontend Metrics 
- **HTTP Response Codes Ratio 5xx**: from Dashboard: HAProxy/Metrics/HAProxy - Frontend Metrics 
- **Percent of 4XX HTTP Response Codes**: from Dashboard: HAProxy/Metrics/HAProxy - Backend Metrics 
- **Percent of 5XX HTTP Response Codes**: from Dashboard: HAProxy/Metrics/HAProxy - Server Metrics 
- **Percent of 5XX HTTP Response Codes**: from Dashboard: HAProxy/Metrics/HAProxy - Backend Metrics 
- **Percent of Backend Session Utilized**: from Dashboard: HAProxy/Metrics/HAProxy - Backend Metrics 
- **Percent of Frontend Sessions Utilized**: from Dashboard: HAProxy/Metrics/HAProxy - Frontend Metrics 
- **Percentage of 3xx Errors**: from Dashboard: HAProxy/HAProxy - Overview 
- **Percentage of 4xx Errors**: from Dashboard: HAProxy/HAProxy - Overview 
- **Percentage of 5xx Errors**: from Dashboard: HAProxy/HAProxy - Overview 
- **Queued Requests Utilization %**: from Dashboard: HAProxy/Metrics/HAProxy - Server Metrics 
- **Request Errors**: from Dashboard: HAProxy/Metrics/HAProxy - Frontend Metrics 
- **Requests Denied**: from Dashboard: HAProxy/Metrics/HAProxy - Frontend Metrics 
- **Response Errors**: from Dashboard: HAProxy/Metrics/HAProxy - Backend Metrics 
- **Response Errors**: from Dashboard: HAProxy/Metrics/HAProxy - Server Metrics 
- **Response Time**: from Dashboard: HAProxy/HAProxy - Overview 
- **Server Weight**: from Dashboard: HAProxy/Metrics/HAProxy - Server Metrics 
- **Unassigned Queued Requests**: from Dashboard: HAProxy/Metrics/HAProxy - Backend Metrics

## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|HAProxy/Metrics|4xx Responses|Metrics|HAProxy/Metrics/HAProxy - Server Metrics|proxy\_cluster=\* metric=haproxy\_http\_response\_4xx type=server proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} sv={{backend\_server}} \| sum by proxy\_cluster, host, proxy, sv|
|HAProxy/Metrics|Active Backend Servers|Metrics|HAProxy/Metrics/HAProxy - Server Metrics|proxy\_cluster=\* metric=haproxy\_active\_servers type=server proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} sv={{backend\_server}} \| sum by proxy\_cluster,host,proxy|
|HAProxy/Metrics|Active Servers|Metrics|HAProxy/Metrics/HAProxy - Backend Metrics|proxy\_cluster=\* metric=haproxy\_active\_servers type=backend proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}} \| sum by metric|
|HAProxy|Active Servers|Metrics|HAProxy/HAProxy - Overview|proxy\_cluster=\* metric=haproxy\_active\_servers host={{host}} proxy\_cluster={{proxy\_cluster}} proxy\_system=haproxy component=proxy \| sum|
|HAProxy/Metrics|Availability - Redispatch Warnings/ Retry Warnings|Metrics|HAProxy/Metrics/HAProxy - Server Metrics|proxy\_cluster=\* metric=haproxy\_wredis type=server proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} sv={{backend\_server}} \| sum by proxy\_cluster,host,proxy, sv|
|HAProxy/Metrics|Availability - Redispatch/Retry Warnings|Metrics|HAProxy/Metrics/HAProxy - Backend Metrics|proxy\_cluster=\* metric=haproxy\_wredis type=backend proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}} \| sum by proxy\_cluster,host,proxy |
|HAProxy/Metrics|Average Connect Latency|Metrics|HAProxy/Metrics/HAProxy - Server Metrics|proxy\_cluster=\* metric=haproxy\_ctime type=server proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}} sv={{backend\_server}} \| avg by proxy\_cluster,host,proxy, sv|
|HAProxy/Metrics|Average Connect Latency|Metrics|HAProxy/Metrics/HAProxy - Backend Metrics|proxy\_cluster=\* metric=haproxy\_ctime type=backend proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}} \| avg by proxy\_cluster,host,proxy|
|HAProxy/Metrics|Average Latency|Metrics|HAProxy/Metrics/HAProxy - Server Metrics|proxy\_cluster=\* metric=haproxy\_ttime type=server proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}} sv={{backend\_server}}  \| avg by proxy\_cluster,host,proxy, sv|
|HAProxy/Metrics|Average Latency|Metrics|HAProxy/Metrics/HAProxy - Backend Metrics|proxy\_cluster=\* metric=haproxy\_ttime type=backend proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}} \| avg by proxy\_cluster,host,proxy|
|HAProxy/Metrics|Average Queue Latency|Metrics|HAProxy/Metrics/HAProxy - Backend Metrics|proxy\_cluster=\* metric=haproxy\_qtime type=backend proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}} \| sum by proxy\_cluster,host,proxy|
|HAProxy/Metrics|Average Queue Latency|Metrics|HAProxy/Metrics/HAProxy - Server Metrics|proxy\_cluster=\* metric=haproxy\_qtime type=server proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}} sv={{backend\_server}} \| sum by proxy\_cluster,host,proxy, sv|
|HAProxy/Metrics|Average Response Latency|Metrics|HAProxy/Metrics/HAProxy - Backend Metrics|proxy\_cluster=\* metric=haproxy\_rtime type=backend proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}} \| sum by proxy\_cluster,host,proxy|
|HAProxy/Metrics|Average Response Latency|Metrics|HAProxy/Metrics/HAProxy - Server Metrics|proxy\_cluster=\* metric=haproxy\_rtime type=server proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}} sv={{backend\_server}} \| sum by proxy\_cluster,host,proxy|
|HAProxy/Metrics|Backend Connection Errors|Metrics|HAProxy/Metrics/HAProxy - Backend Metrics|proxy\_cluster=\* metric=haproxy\_econ type=backend proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}} \| filter latest \> 0|
|HAProxy|Backend Denials|Metrics|HAProxy/HAProxy - Overview|proxy\_cluster=\* metric=haproxy\_dresp type=backend proxy\_cluster={{proxy\_cluster}} host={{host}} proxy\_system=haproxy component=proxy \| sum by host, proxy\_cluster|
|HAProxy/Logs|Backend Errors|Logs|HAProxy/Logs/HAProxy - Error Log Analysis|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy backend<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+backend\\s+(?\<frontend\_name\>\\S+)\\s+(?\<msg\>.\*)" nodrop<br />\| where length(frontend\_name) \> 0<br />\| timeslice 1s<br />\| count as count by \_timeslice, proxy\_cluster, frontend\_name, msg<br />\| fields -count|
|HAProxy|Backend Network Traffic|Metrics|HAProxy/HAProxy - Overview|proxy\_cluster=\* metric=haproxy\_bin type=backend proxy\_cluster={{proxy\_cluster}} host={{host}} proxy\_system=haproxy component=proxy\| sum by proxy\_cluster, host|
|HAProxy|Backend Queue|Metrics|HAProxy/HAProxy - Overview|proxy\_cluster=\* metric=haproxy\_qcur type=backend proxy\_cluster={{proxy\_cluster}} host={{host}} proxy\_system=haproxy component=proxy \| sum|
|HAProxy|Backend Response Time|Metrics|HAProxy/HAProxy - Overview|proxy\_cluster=\* metric=haproxy\_rtime proxy\_cluster={{proxy\_cluster}} host={{host}} type=backend proxy\_system=haproxy component=proxy \| sum by proxy\_cluster,host|
|HAProxy/Metrics|Backend Server Connection Errors|Metrics|HAProxy/Metrics/HAProxy - Server Metrics|proxy\_cluster=\* metric=haproxy\_econ type=server proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} sv={{backend\_server}} \| sum by proxy\_cluster, host, proxy, sv|
|HAProxy|Backend Sessions %|Metrics|HAProxy/HAProxy - Overview|proxy\_cluster=\* metric=haproxy\_scur type=backend proxy\_cluster={{proxy\_cluster}} host={{host}} proxy\_system=haproxy component=proxy\| sum by proxy\_cluster,host|
|HAProxy|Backend Sessions %|Metrics|HAProxy/HAProxy - Overview|proxy\_cluster=\* metric=haproxy\_scur type=backend proxy\_cluster={{proxy\_cluster}} host={{host}} proxy\_system=haproxy component=proxy \| sum|
|HAProxy/Metrics|Backend Weight|Metrics|HAProxy/Metrics/HAProxy - Backend Metrics|proxy\_cluster=\* metric=haproxy\_weight type=backend proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}}|
|HAProxy/Metrics|Backup Backend Servers|Metrics|HAProxy/Metrics/HAProxy - Server Metrics|proxy\_cluster=\* metric=haproxy\_backup\_servers type=server proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} sv={{backend\_server}} \| sum by proxy\_cluster,host,proxy|
|HAProxy/Metrics|Backup Servers|Metrics|HAProxy/Metrics/HAProxy - Backend Metrics|proxy\_cluster=\* metric=haproxy\_backup\_servers type=backend proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}} \| sum by metric|
|HAProxy/Metrics|Bytes - IN|Metrics|HAProxy/Metrics/HAProxy - Frontend Metrics|proxy\_cluster=\* metric=haproxy\_bin type=frontend proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}}\| sum by proxy\_cluster, host, proxy |
|HAProxy/Metrics|Bytes - OUT|Metrics|HAProxy/Metrics/HAProxy - Frontend Metrics|proxy\_cluster=\* metric=haproxy\_bout type=frontend proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}}\| sum by proxy\_cluster, host, proxy |
|HAProxy/Metrics|Bytes In|Metrics|HAProxy/Metrics/HAProxy - Server Metrics|proxy\_cluster=\* metric=haproxy\_bin type=server proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} sv={{backend\_server}} \|avg by proxy\_cluster,host,proxy,sv|
|HAProxy/Metrics|Bytes In|Metrics|HAProxy/Metrics/HAProxy - Backend Metrics|proxy\_cluster=\* metric=haproxy\_bin type=backend proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}} \| sum by proxy\_cluster,host,proxy |
|HAProxy/Metrics|Bytes Out|Metrics|HAProxy/Metrics/HAProxy - Server Metrics|proxy\_cluster=\* metric=haproxy\_bout type=server proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} sv={{backend\_server}} \|avg by proxy\_cluster,host,proxy, sv|
|HAProxy/Metrics|Bytes Out|Metrics|HAProxy/Metrics/HAProxy - Backend Metrics|proxy\_cluster=\* metric=haproxy\_bout type=backend proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}}\| sum by proxy\_cluster,host,proxy |
|HAProxy/Logs|Bytes Served|Logs|HAProxy/Logs/HAProxy - Visitor Traffic Insight|proxy\_cluster=\* proxy\_system=haproxy proxy\_cluster={{proxy\_cluster}}<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| sum(bytes\_read) as Bytes\_Served<br />\| Bytes\_Served/(1024\*1024\*1024) as Gbytes\_Served<br />\| fields Gbytes\_Served|
|HAProxy/Logs|Bytes Served - Outlier|Logs|HAProxy/Logs/HAProxy - Outlier Analysis|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| where bytes\_read != "-" and !isEmpty(bytes\_read)<br />\| number(bytes\_read)<br />\| (bytes\_read/(1024\*1024)) as mbytes <br />\| timeslice {{timeslice}}<br />\| sum(mbytes) as mbytes by \_timeslice <br />\| sort \_timeslice asc<br />\| outlier mbytes window={{window}}, threshold={{threshold}}, consecutive={{consecutive}}, direction=+|
|HAProxy/Logs|Client Errors|Logs|HAProxy/Logs/HAProxy - Outlier Analysis|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| where (status\_code matches "4\*") <br />\| timeslice {{timeslice}}<br />\| count as client\_errors by \_timeslice<br />\| sort \_timeslice asc<br />\| outlier client\_errors window={{window}}, threshold={{threshold}}, consecutive={{consecutive}}, direction=+|
|HAProxy/Logs|Client Locations - 4xx Errors|Logs|HAProxy/Logs/HAProxy - Visitor Access Types|proxy\_cluster=\* proxy\_system=haproxy proxy\_cluster={{proxy\_cluster}}<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>[\\w\\-\\.]+) (?\<ps\>\\w+)\\[(?\<pid\>\\d+)\\]: (?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+) (?\<rs\>[^\\"]\*) (?\<TR1\>\\d+)/(?\<Tw\>\\d+)/(?\<Tc\>\\d+)/(?\<Tr\>\\d+)/(?\<Ta\>\\d+) (?\<status\_code\>\\d+) (?\<bytes\>\\d+) (?\<req\_cookie\>\\S+) (?\<res\_cookie\>\\S+) (?\<t\_state\>[\\w-]+) (?\<actconn\>\\d+)/(?\<feconn\>\\d+)/(?\<beconn\>\\d+)\\/(?\<srv\_conn\>\\d+)/(?\<retries\>\\d+) (?\<srv\_queue\>\\d+)/(?\<backend\_queue\>\\d+) \\"(?\<method\>\\w+) (?\<request\>[^\\"]\*) (?\<http\_version\>\\w+)" <br />\| where status\_code matches "4\*" <br />\| count by c\_ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = c\_ip|
|HAProxy/Logs|Client Locations - 4xx Errors|Logs|HAProxy/Logs/HAProxy - Web Server Operations|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| where status\_code matches "4\*" <br />\| count by c\_ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = c\_ip|
|HAProxy/Logs|Client Locations with Critical Errors|Logs|HAProxy/Logs/HAProxy - Error Log Analysis|proxy\_cluster=\* proxy\_cluster={{proxy\_cluster}}<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)/1:\\s+(?\<msg\>.\*)"<br />\| where length(msg) \> 0<br />\| where !isEmpty(c\_ip)<br />\| count by c\_ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = c\_ip<br />\| where !isNull(latitude)|
|HAProxy|Connections Errors|Metrics|HAProxy/HAProxy - Overview|proxy\_cluster=\* metric=haproxy\_econ host={{host}} proxy\_cluster={{proxy\_cluster}} proxy\_system=haproxy component=proxy \| sum by metric|
|HAProxy/Metrics|Connections Utilization %|Metrics|HAProxy/Metrics/HAProxy - Server Metrics|proxy\_cluster=\* metric=haproxy\_scur type=server proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} sv={{backend\_server}} \| sum by proxy\_cluster, host, proxy, sv|
|HAProxy/Logs|Critical Errors|Logs|HAProxy/Logs/HAProxy - Error Log Analysis|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)/1:\\s+(?\<msg\>.\*)"<br />\| where length(msg) \> 0<br />\| timeslice 1s<br />\| count as count by \_timeslice, proxy\_cluster, c\_ip, frontend\_name, msg<br />\| sort by \_timeslice<br />\| limit 100|
|HAProxy/Metrics|Current Session Count|Metrics|HAProxy/Metrics/HAProxy - Backend Metrics|proxy\_cluster=\* metric=haproxy\_scur type=backend proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} \| sum by proxy\_cluster,host,proxy |
|HAProxy/Metrics|Current Sessions|Metrics|HAProxy/Metrics/HAProxy - Frontend Metrics|proxy\_cluster=\* metric=haproxy\_scur type=frontend proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} \| avg by proxy\_cluster, host, proxy|
|HAProxy/Metrics|Current Sessions/s|Metrics|HAProxy/Metrics/HAProxy - Server Metrics|proxy\_cluster=\* metric=haproxy\_scur type=server proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} sv={{backend\_server}} \| sum by proxy\_cluster, host, proxy, sv|
|HAProxy/Metrics|Failed Health Checks|Metrics|HAProxy/Metrics/HAProxy - Server Metrics|proxy\_cluster=\* metric=haproxy\_chkfail type=server proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} sv={{backend\_server}} \| sum by proxy\_cluster, host, proxy, sv|
|HAProxy|Frontend Denials|Metrics|HAProxy/HAProxy - Overview|proxy\_cluster=\* metric=haproxy\_dresp type=frontend proxy\_cluster={{proxy\_cluster}} host={{host}} proxy\_system=haproxy component=proxy \| sum by host, proxy\_cluster|
|HAProxy|Frontend Network Traffic|Metrics|HAProxy/HAProxy - Overview|proxy\_cluster=\* metric=haproxy\_bin type=frontend proxy\_cluster={{proxy\_cluster}} host={{host}} proxy\_system=haproxy component=proxy \| sum by host, proxy\_cluster|
|HAProxy|Frontend Requests / Second|Metrics|HAProxy/HAProxy - Overview|proxy\_cluster=\* metric=haproxy\_rate type=frontend proxy\_cluster={{proxy\_cluster}} host={{host}} proxy\_system=haproxy component=proxy \| sum by host, proxy\_cluster|
|HAProxy|Frontend Sessions %|Metrics|HAProxy/HAProxy - Overview|proxy\_cluster=\* metric=haproxy\_scur type=frontend proxy\_cluster={{proxy\_cluster}} host={{host}} proxy\_system=haproxy component=proxy \| sum by proxy\_cluster,host|
|HAProxy|Frontend Sessions %|Metrics|HAProxy/HAProxy - Overview|proxy\_cluster=\* metric=haproxy\_scur type=frontend proxy\_cluster={{proxy\_cluster}} host={{host}} proxy\_system=haproxy component=proxy \| sum|
|HAProxy/Logs|Highly Malicious Threats|Logs|HAProxy/Logs/HAProxy - Threat Analysis|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| count as threat\_count by c\_ip, method, status\_code, bytes\_read, referrer, user\_agent, request<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=c\_ip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence) and malicious\_confidence matches "high"<br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum(threat\_count) as threat\_count by c\_ip, method, status\_code, bytes\_read, referrer, user\_agent, request, malicious\_confidence, actor<br />\| sort by threat\_count<br />\| limit 20|
|HAProxy/Logs|HTTP Methods|Logs|HAProxy/Logs/HAProxy - Visitor Traffic Insight|proxy\_cluster=\* proxy\_system=haproxy proxy\_cluster={{proxy\_cluster}}<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| where !isBlank(method)<br />\| count as count by method<br />\| sort by count, method asc<br />\| limit 5|
|HAProxy/Metrics|HTTP Response Codes|Metrics|HAProxy/Metrics/HAProxy - Server Metrics|proxy\_cluster=\* metric=haproxy\_http\_response\_\* type=server proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} sv={{backend\_server}} \| parse field=metric haproxy\_http\_response\_\* as code \| avg by proxy\_cluster, host, proxy, code, sv|
|HAProxy/Metrics|HTTP Response Codes|Metrics|HAProxy/Metrics/HAProxy - Backend Metrics|proxy\_cluster=\* metric=haproxy\_http\_response\_\* type=backend proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}} \| parse field=metric haproxy\_http\_response\_\* as code \| avg by proxy\_cluster,host, proxy, code |
|HAProxy/Metrics|HTTP Response Codes (Total)|Metrics|HAProxy/Metrics/HAProxy - Frontend Metrics|proxy\_cluster=\* metric=haproxy\_http\_response\_\* type=frontend proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} \| sum by proxy\_cluster, host |
|HAProxy/Metrics|HTTP Response Codes Ratio 4xx|Metrics|HAProxy/Metrics/HAProxy - Frontend Metrics|proxy\_cluster=\* metric=haproxy\_http\_response\_\* type=frontend proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} \| sum by proxy\_cluster, host, proxy |
|HAProxy/Metrics|HTTP Response Codes Ratio 5xx|Metrics|HAProxy/Metrics/HAProxy - Frontend Metrics|proxy\_cluster=\* metric=haproxy\_http\_response\_\* type=frontend proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} \| sum by proxy\_cluster, host, proxy |
|HAProxy/Logs|Media Types Served|Logs|HAProxy/Logs/HAProxy - Visitor Traffic Insight|proxy\_cluster=\* proxy\_system=haproxy  proxy\_cluster={{proxy\_cluster}}<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| parse regex field=request "^/[^\\?]+?\\.(?\<type\>[a-zA-Z]{2,4})\$" nodrop<br />\| parse regex field=request "/\\S+?(?\<email\_prefix\>(?:%40\|@)[^.]+?)\\.\\w+" nodrop<br />\| where email\_prefix = "" and !isBlank(type)<br />\| count as count by type<br />\| sort count, type asc|
|HAProxy/Logs|Non 200 Response Status Codes|Logs|HAProxy/Logs/HAProxy - Web Server Operations|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| where !(status\_code matches "2\*")<br />\| count as count by status\_code <br />\| sort by count, status\_code asc|
|HAProxy/Logs|Non 200 Response Status Codes|Logs|HAProxy/Logs/HAProxy - Visitor Access Types|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>[\\w\\-\\.]+) (?\<ps\>\\w+)\\[(?\<pid\>\\d+)\\]: (?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+) (?\<rs\>[^\\"]\*) (?\<TR1\>\\d+)/(?\<Tw\>\\d+)/(?\<Tc\>\\d+)/(?\<Tr\>\\d+)/(?\<Ta\>\\d+) (?\<status\_code\>\\d+) (?\<bytes\>\\d+) (?\<req\_cookie\>\\S+) (?\<res\_cookie\>\\S+) (?\<t\_state\>[\\w-]+) (?\<actconn\>\\d+)/(?\<feconn\>\\d+)/(?\<beconn\>\\d+)\\/(?\<srv\_conn\>\\d+)/(?\<retries\>\\d+) (?\<srv\_queue\>\\d+)/(?\<backend\_queue\>\\d+) \\"(?\<method\>\\w+) (?\<request\>[^\\"]\*) (?\<http\_version\>\\w+)"<br />\| where !(status\_code matches "2\*")<br />\| count as count by status\_code <br />\| sort by count, status\_code asc|
|HAProxy/Logs|Number of Hits by Server - One Day Time Comparison|Logs|HAProxy/Logs/HAProxy - Trends|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| if (isEmpty(pod),\_sourceHost,pod) as host<br />\| count as Number\_of\_Hits by host  <br />\| compare with timeshift 1d|
|HAProxy/Logs|Number of Visitors|Logs|HAProxy/Logs/HAProxy - Outlier Analysis|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| where !isEmpty(c\_ip)<br />\| timeslice {{timeslice}}<br />\| count as hits by \_timeslice <br />\| sort \_timeslice asc<br />\| outlier hits window={{window}}, threshold={{threshold}}, consecutive={{consecutive}}, direction=+|
|HAProxy/Metrics|Percent of 4XX HTTP Response Codes|Metrics|HAProxy/Metrics/HAProxy - Backend Metrics|proxy\_cluster=\* metric=haproxy\_http\_response\_4xx type=backend proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}} \| sum by proxy\_cluster,host,proxy |
|HAProxy/Metrics|Percent of 5XX HTTP Response Codes|Metrics|HAProxy/Metrics/HAProxy - Server Metrics|proxy\_cluster=\* metric=haproxy\_http\_response\_5xx type=server proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} sv={{backend\_server}} \| sum by proxy\_cluster, host, proxy, sv|
|HAProxy/Metrics|Percent of 5XX HTTP Response Codes|Metrics|HAProxy/Metrics/HAProxy - Backend Metrics|proxy\_cluster=\* metric=haproxy\_http\_response\_5xx type=backend proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}} \| sum by proxy\_cluster,host,proxy|
|HAProxy/Metrics|Percent of Backend Session Utilized|Metrics|HAProxy/Metrics/HAProxy - Backend Metrics|proxy\_cluster=\* metric=haproxy\_scur type=backend proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}}\| sum by proxy\_cluster,host,proxy|
|HAProxy/Metrics|Percent of Frontend Sessions Utilized|Metrics|HAProxy/Metrics/HAProxy - Frontend Metrics|proxy\_cluster=\* metric=haproxy\_scur type=frontend proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} \| sum by proxy\_cluster, host, proxy|
|HAProxy|Percentage of 3xx Errors|Metrics|HAProxy/HAProxy - Overview|proxy\_cluster=\* metric=haproxy\_http\_response\_\* proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} \| sum by host, proxy\_cluster, type|
|HAProxy|Percentage of 4xx Errors|Metrics|HAProxy/HAProxy - Overview|proxy\_cluster=\* metric=haproxy\_http\_response\_\* proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} proxy\_system=haproxy component=proxy \| sum by proxy\_cluster, type, host|
|HAProxy|Percentage of 5xx Errors|Metrics|HAProxy/HAProxy - Overview|proxy\_cluster=\* metric=haproxy\_http\_response\_\*  proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} proxy\_system=haproxy component=proxy \| sum by proxy\_cluster, type, host|
|HAProxy/Metrics|Queued Requests Utilization %|Metrics|HAProxy/Metrics/HAProxy - Server Metrics|proxy\_cluster=\* metric=haproxy\_qmax type=server proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} sv={{backend\_server}} \| avg by proxy\_cluster, host, proxy, sv|
|HAProxy/Metrics|Request Errors|Metrics|HAProxy/Metrics/HAProxy - Frontend Metrics|proxy\_cluster=\* metric=haproxy\_ereq type=frontend proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} \| sum by proxy\_cluster, host, proxy |
|HAProxy/Metrics|Requests Denied|Metrics|HAProxy/Metrics/HAProxy - Frontend Metrics|proxy\_cluster=\* metric=haproxy\_dreq type=frontend proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} \| sum by proxy\_cluster, host, proxy |
|HAProxy/Metrics|Response Errors|Metrics|HAProxy/Metrics/HAProxy - Server Metrics|proxy\_cluster=\* metric=haproxy\_eresp type=server proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}}\| sum by proxy\_cluster,host,proxy,sv|
|HAProxy/Metrics|Response Errors|Metrics|HAProxy/Metrics/HAProxy - Backend Metrics|proxy\_cluster=\* metric=haproxy\_eresp type=backend proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}} \| filter latest \> 0|
|HAProxy|Response Time|Metrics|HAProxy/HAProxy - Overview|proxy\_cluster=\* metric=haproxy\_rtime host={{host}} proxy\_cluster={{proxy\_cluster}} proxy\_system=haproxy component=proxy \| sum by metric|
|HAProxy/Logs|Responses Over Time|Logs|HAProxy/Logs/HAProxy - Trends|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| if(status\_code matches "2\*", 1, 0) as successes <br />\| if(status\_code matches "3\*", 1, 0) as redirects <br />\| if(status\_code matches "4\*", 1, 0) as client\_errors <br />\| if(status\_code matches "5\*", 1, 0) as server\_errors <br />\| timeslice by 5m<br />\| sum(successes) as successes, sum(client\_errors) as client\_errors,  sum(redirects) as redirects, sum(server\_errors) as server\_errors by \_timeslice|
|HAProxy|Responses Over Time|Logs|HAProxy/HAProxy - Overview|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| !isEmpty(c\_ip)<br />\| if(status\_code matches "2\*", 1, 0) as Successes <br />\| if(status\_code matches "3\*", 1, 0) as Redirects <br />\| if(status\_code matches "4\*", 1, 0) as Client\_Errors <br />\| if(status\_code matches "5\*", 1, 0) as Server\_Errors <br />\| timeslice by 5m<br />\| sum(Successes) as Successes, sum(Client\_Errors) as Client\_Errors,  sum(Redirects) as Redirects, sum(Server\_Errors) as Server\_Errors by \_timeslice<br />\| sort by \_timeslice asc<br />|
|HAProxy/Logs|Server Down Events|Logs|HAProxy/Logs/HAProxy - Error Log Analysis|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy Server<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+Server\\s+(?\<frontend\_name\>\\S+)/(?\<backend\_name\>\\S+)\\s+is\\s+DOWN,\\s+reason:\\s+(?\<reason\>.\*),\\s+info:\\s+\\"(?\<info\>.\*)\\",\\s+check\\s+duration:\\s+(?\<check\_duration\>\\d+)ms.\\s+(?\<active\>\\d+)\\s+active\\s+and\\s+(?\<backup\>\\d+)\\s+backup\\s+servers\\s+left.\\s+(?\<sessions\>\\d+) sessions\\s+active,\\s+(?\<requeued\>\\d+)\\s+requeued,\\s+(?\<remaining\>\\d+)\\s+remaining\\s+in\\s+queue." nodrop<br />\| where length(frontend\_name) \> 0 and length(backend\_name) \> 0<br />\| timeslice 1s<br />\| count as count by \_timeslice, proxy\_cluster, frontend\_name, backend\_name, reason, info<br />\| fields -count|
|HAProxy/Logs|Server Errors|Logs|HAProxy/Logs/HAProxy - Outlier Analysis|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| where (status\_code matches "5\*") <br />\| timeslice {{timeslice}}<br />\| count as server\_errors by \_timeslice<br />\| sort \_timeslice asc<br />\| outlier server\_errors window={{window}}, threshold={{threshold}}, consecutive={{consecutive}}, direction=+|
|HAProxy/Metrics|Server Weight|Metrics|HAProxy/Metrics/HAProxy - Server Metrics|proxy\_cluster=\* metric=haproxy\_weight type=server proxy\_cluster={{proxy\_cluster}} host={{host}} proxy={{proxy}} sv={{backend\_server}} \| sum by proxy\_cluster, host, proxy, sv|
|HAProxy/Logs|Threat Count|Logs|HAProxy/Logs/HAProxy - Threat Analysis|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| count as ip\_count by c\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=c\_ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum(ip\_count) as threat\_count|
|HAProxy/Logs|Threat Locations|Logs|HAProxy/Logs/HAProxy - Threat Analysis|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| count as ip\_count by c\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=c\_ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = c\_ip<br />\| where !isNull(latitude)|
|HAProxy/Logs|Threats by Actors|Logs|HAProxy/Logs/HAProxy - Threat Analysis|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| count as ip\_count by c\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=c\_ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum (ip\_count) as threat\_count by Actor|
|HAProxy/Logs|Threats by Malicious Confidence|Logs|HAProxy/Logs/HAProxy - Threat Analysis|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| count as ip\_count by c\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=c\_ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum (ip\_count) as threat\_count by malicious\_confidence|
|HAProxy/Logs|Threats by Source|Logs|HAProxy/Logs/HAProxy - Threat Analysis|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| count as ip\_count by c\_ip,  \_source<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=c\_ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| \_source as source<br />\| sum (ip\_count) as threat\_count by source|
|HAProxy/Logs|Top 10 Search Terms from Popular Search Engines|Logs|HAProxy/Logs/HAProxy - Visitor Traffic Insight|proxy\_cluster=\* proxy\_system=haproxy proxy\_cluster={{proxy\_cluster}}<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\|parse regex field=request\_headers "(?\<referrer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| parse regex field=referrer "(?:\\?\|&)(?:p\|q\|wd\|searchfor)=(?\<search\_term\>[^=]+?)(?:&\|\$)" nodrop <br />\| where !isBlank(search\_term)<br />\| urldecode(search\_term)<br />\| if(referrer matches "\*google.\*","Google","") as engine<br />\| if(referrer matches "\*bing.\*","Bing",engine) as engine<br />\| if(referrer matches "\*ask.com\*","Ask.com",engine) as engine<br />\| if(referrer matches "\*aol.\*","AOL",engine) as engine<br />\| if(referrer matches "\*yahoo.\*","Yahoo",engine) as engine<br />\| where !isBlank(engine) <br />\| count as count by search\_term<br />\| sort count, search\_term asc<br />\| limit 10|
|HAProxy/Logs|Top 10 Threats|Logs|HAProxy/Logs/HAProxy - Threat Analysis|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| count as threat\_count by c\_ip, method, status\_code, bytes\_read, referrer, user\_agent, request<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=c\_ip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence) and malicious\_confidence matches "high"<br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum(threat\_count) as request\_count by c\_ip, method, status\_code, bytes\_read, referrer, user\_agent, request, malicious\_confidence, actor<br />\| sort by request\_count<br />\| limit 10|
|HAProxy/Logs|Top 5 Clients Causing 4xx Errors|Logs|HAProxy/Logs/HAProxy - Visitor Access Types|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>[\\w\\-\\.]+) (?\<ps\>\\w+)\\[(?\<pid\>\\d+)\\]: (?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+) (?\<rs\>[^\\"]\*) (?\<TR1\>\\d+)/(?\<Tw\>\\d+)/(?\<Tc\>\\d+)/(?\<Tr\>\\d+)/(?\<Ta\>\\d+) (?\<status\_code\>\\d+) (?\<bytes\>\\d+) (?\<req\_cookie\>\\S+) (?\<res\_cookie\>\\S+) (?\<t\_state\>[\\w-]+) (?\<actconn\>\\d+)/(?\<feconn\>\\d+)/(?\<beconn\>\\d+)\\/(?\<srv\_conn\>\\d+)/(?\<retries\>\\d+) (?\<srv\_queue\>\\d+)/(?\<backend\_queue\>\\d+) \\"(?\<method\>\\w+) (?\<request\>[^\\"]\*) (?\<http\_version\>\\w+)"<br />\| where status\_code matches "4\*"<br />\| count as count by c\_ip<br />\| sort count, c\_ip asc<br />\| limit 5|
|HAProxy/Logs|Top 5 Clients Causing 4xx Errors|Logs|HAProxy/Logs/HAProxy - Web Server Operations|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| where status\_code matches "4\*"<br />\| count as count by c\_ip<br />\| sort count, c\_ip asc<br />\| limit 5|
|HAProxy/Logs|Top 5 Clients Causing Errors|Logs|HAProxy/Logs/HAProxy - Error Log Analysis|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)/1:\\s+(?\<msg\>.\*)"<br />\| where length(msg) \> 0 and !isEmpty(c\_ip)<br />\| count as count by c\_ip \| sort by count, c\_ip asc<br />\| limit 5|
|HAProxy/Logs|Top 5 Highly Malicious URLs|Logs|HAProxy/Logs/HAProxy - Threat Analysis|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| count as ip\_count by c\_ip, request<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=c\_ip <br />\| where malicious\_confidence matches "high"<br />\| count by request<br />\| limit 5|
|HAProxy/Logs|Top 5 Referrers|Logs|HAProxy/Logs/HAProxy - Visitor Traffic Insight|proxy\_cluster=\* proxy\_system=haproxy  proxy\_cluster={{proxy\_cluster}}<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| where !isBlank(referer)<br />\| count as count by referer<br />\| sort by count, referer asc<br />\| limit 5|
|HAProxy/Logs|Top 5 Urls|Logs|HAProxy/Logs/HAProxy - Visitor Traffic Insight|proxy\_cluster=\* proxy\_system=haproxy  proxy\_cluster={{proxy\_cluster}}<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| where !isBlank(request)<br />\| count as count by request<br />\| sort by count, request asc<br />\| limit 5|
|HAProxy/Logs|Top 5 URLs Causing 4xx Responses|Logs|HAProxy/Logs/HAProxy - Web Server Operations|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| where status\_code matches "4\*"<br />\| count as count by request<br />\| sort count, request asc<br />\| limit 5|
|HAProxy/Logs|Top 5 URLs Causing 4xx Responses|Logs|HAProxy/Logs/HAProxy - Visitor Access Types|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>[\\w\\-\\.]+) (?\<ps\>\\w+)\\[(?\<pid\>\\d+)\\]: (?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+) (?\<rs\>[^\\"]\*) (?\<TR1\>\\d+)/(?\<Tw\>\\d+)/(?\<Tc\>\\d+)/(?\<Tr\>\\d+)/(?\<Ta\>\\d+) (?\<status\_code\>\\d+) (?\<bytes\>\\d+) (?\<req\_cookie\>\\S+) (?\<res\_cookie\>\\S+) (?\<t\_state\>[\\w-]+) (?\<actconn\>\\d+)/(?\<feconn\>\\d+)/(?\<beconn\>\\d+)\\/(?\<srv\_conn\>\\d+)/(?\<retries\>\\d+) (?\<srv\_queue\>\\d+)/(?\<backend\_queue\>\\d+) \\"(?\<method\>\\w+) (?\<request\>[^\\"]\*) (?\<http\_version\>\\w+)"<br />\| where status\_code matches "4\*"<br />\| count as count by request<br />\| sort count, request asc<br />\| limit 5|
|HAProxy|Top 5 URLs with Errors|Logs|HAProxy/HAProxy - Overview|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"\| where status\_code matches "4\*" or status\_code matches "5\*" and  !isEmpty(c\_ip) \|count by status\_code,request<br />\| sort by \_count<br />\| limit 5|
|HAProxy/Logs|Traffic Distribution by Server|Logs|HAProxy/Logs/HAProxy - Trends|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| if (isEmpty(pod),\_sourceHost,pod) as host<br />\| timeslice 5m<br />\| count by \_timeslice, host  <br />\| transpose row \_timeslice column host|
|HAProxy/Logs|Traffic Volume and Bytes Served|Logs|HAProxy/Logs/HAProxy - Trends|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| where bytes\_read != "-" and !isEmpty(bytes\_read)<br />\| (bytes\_read/(1024\*1024)) as mbytes <br />\| timeslice 5m<br />\| count as hits, sum(mbytes) as mbytes by \_timeslice |
|HAProxy/Metrics|Unassigned Queued Requests|Metrics|HAProxy/Metrics/HAProxy - Backend Metrics|proxy\_cluster=\* metric=haproxy\_qmax type=backend proxy\_cluster={{proxy\_cluster}} host={{host}}  proxy={{proxy}} \| sum by proxy\_cluster,host,proxy|
|HAProxy/Logs|United States|Logs|HAProxy/Logs/HAProxy - Visitor Locations|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| count by c\_ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = c\_ip<br />\| where country\_name = "United States"|
|HAProxy|Visitor Locations|Logs|HAProxy/HAProxy - Overview|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| count by c\_ip \| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = c\_ip <br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code <br />\| sort \_count|
|HAProxy/Logs|Visitor Locations - One Day Time Comparison|Logs|HAProxy/Logs/HAProxy - Trends|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| count c\_ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = c\_ip<br />\| where !isNull(latitude) and !isEmpty(country\_name)<br />\| sum(\_count) as Visitors\_Locations by country\_name<br />\| sort Visitors\_Locations <br />\| compare with timeshift 1d<br />\| limit 10|
|HAProxy/Logs|Visitor Platforms|Logs|HAProxy/Logs/HAProxy - Web Server Operations|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| if (user\_agent matches "\*iPad\*" OR user\_agent matches "\*iPhone\*" OR user\_agent matches "\*Android\*" OR user\_agent matches "\*BlackBerry\*" OR user\_agent matches "\*Galaxy\*" OR user\_agent matches "LGE-\*" OR user\_agent matches "SCH-\*" OR user\_agent matches "\*HUAWEI-\*" OR user\_agent matches "\*SAMSUNG\*" OR user\_agent matches "\*samsung\*" OR user\_agent matches "Dalvik/\*" OR user\_agent matches "Nokia\*" OR user\_agent matches "LG-\*" OR user\_agent matches "\*CFNetwork\*"  OR user\_agent matches "\*UP.Browser/\*" OR user\_agent matches "\*QQ\*rowser\*" OR user\_agent matches "\*NetFront/\*" OR user\_agent matches "\*Windows Phone\*" OR user\_agent matches "\*Mobile Safari\*" OR user\_agent matches "\*iemobile\*","Mobile","") as type<br />\| if (user\_agent matches "\*Windows\*" OR user\_agent matches "\*Win64\*" OR user\_agent matches "\*Win32\*" OR user\_agent matches "\*i686\*" OR user\_agent matches "\*x86\*","PC",type) as type<br />\| if (user\_agent matches "\*Macintosh\*" OR user\_agent matches "\*Mac OS\*","Mac",type) as type<br />\| if (type = "", "bots/unknown", type) as type<br />\| count type<br />\| sort by \_count, type asc|
|HAProxy/Logs|Visitor Platforms|Logs|HAProxy/Logs/HAProxy - Visitor Access Types|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>[\\w\\-\\.]+) (?\<ps\>\\w+)\\[(?\<pid\>\\d+)\\]: (?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+) (?\<rs\>[^\\"]\*) (?\<TR1\>\\d+)/(?\<Tw\>\\d+)/(?\<Tc\>\\d+)/(?\<Tr\>\\d+)/(?\<Ta\>\\d+) (?\<status\_code\>\\d+) (?\<bytes\>\\d+) (?\<req\_cookie\>\\S+) (?\<res\_cookie\>\\S+) (?\<t\_state\>[\\w-]+) (?\<actconn\>\\d+)/(?\<feconn\>\\d+)/(?\<beconn\>\\d+)\\/(?\<srv\_conn\>\\d+)/(?\<retries\>\\d+) (?\<srv\_queue\>\\d+)/(?\<backend\_queue\>\\d+) \\{(?\<referer\>.\*)\|(?\<user\_agent\>.\*)\\} \\"(?\<method\>\\w+) (?\<request\>[^\\"]\*) (?\<http\_version\>\\w+)"<br />\| if (user\_agent matches "\*iPad\*" OR user\_agent matches "\*iPhone\*" OR user\_agent matches "\*Android\*" OR user\_agent matches "\*BlackBerry\*" OR user\_agent matches "\*Galaxy\*" OR user\_agent matches "LGE-\*" OR user\_agent matches "SCH-\*" OR user\_agent matches "\*HUAWEI-\*" OR user\_agent matches "\*SAMSUNG\*" OR user\_agent matches "\*samsung\*" OR user\_agent matches "Dalvik/\*" OR user\_agent matches "Nokia\*" OR user\_agent matches "LG-\*" OR user\_agent matches "\*CFNetwork\*"  OR user\_agent matches "\*UP.Browser/\*" OR user\_agent matches "\*QQ\*rowser\*" OR user\_agent matches "\*NetFront/\*" OR user\_agent matches "\*Windows Phone\*" OR user\_agent matches "\*Mobile Safari\*" OR user\_agent matches "\*iemobile\*","Mobile","") as type<br />\| if (user\_agent matches "\*Windows\*" OR user\_agent matches "\*Win64\*" OR user\_agent matches "\*Win32\*" OR user\_agent matches "\*i686\*" OR user\_agent matches "\*x86\*","PC",type) as type<br />\| if (user\_agent matches "\*Macintosh\*" OR user\_agent matches "\*Mac OS\*","Mac",type) as type<br />\| if (type = "", "bots/unknown", type) as type<br />\| count type<br />\| sort by \_count, type asc|
|HAProxy/Logs|Visits by Country Over Time|Logs|HAProxy/Logs/HAProxy - Visitor Locations|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = c\_ip<br />\| where !isNull(latitude) and !isEmpty(country\_name)<br />\| timeslice 5m<br />\| count by \_timeslice, country\_name<br />\| transpose row \_timeslice column country\_name as \* |
|HAProxy/Logs|Visits by US Regions Over Time|Logs|HAProxy/Logs/HAProxy - Visitor Locations|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| timeslice 5m<br />\| count by c\_ip, \_timeslice<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = c\_ip<br />\| where !isNull(latitude) and country\_name = "United States" AND !isEmpty(region)<br />\| sum(\_count) as count by \_timeslice, region<br />\| transpose row \_timeslice column region as \*|
|HAProxy/Logs|Worldwide|Logs|HAProxy/Logs/HAProxy - Visitor Locations|proxy\_cluster=\* proxy\_cluster = {{proxy\_cluster}} proxy\_system=haproxy<br />\| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as haproxy\_log\_message<br />\| parse regex field=haproxy\_log\_message "(?\<syslog\_host\>.\*)\\]:\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message ":\\s+(?\<c\_ip\>[\\w\\.]+):(?\<c\_port\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\[(?\<accept\_date\>.+)\\]\\s+(?\<frontend\_name\>\\S+)\\s+(?\<backend\_name\>\\S+)/(?\<server\_name\>\\S+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<tq\>-?\\d+)/(?\<tw\>-?\\d+)/(?\<tc\>-?\\d+)/(?\<tr\>-?\\d+)/(?\<tt\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<status\_code\>\\d+)\\s+(?\<bytes\_read\>[\\d-]+)\\s+(?\<tsc\>.\*)\\s+(?\<act\>\\d+)/(?\<fe\>\\d+)/(?\<be\>\\d+)/(?\<srv\>\\d+)/(?\<retries\>\\+?\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+(?\<queue\_server\>\\d+)/(?\<queue\_backend\>\\d+)\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\{(?\<request\_headers\>.\*)\\}\\s+" nodrop<br />\| parse regex field=haproxy\_log\_message "\\s+\\"(?\<http\_request\>.\*)\\"" nodrop<br />\| parse regex field=request\_headers "(?\<referer\>\\S+)\\\|(?\<user\_agent\>[^\\"]\*)"<br />\| parse regex field=http\_request "(?\<method\>\\w+)\\s+(?\<request\>[^\\"]\*)\\s+(?\<http\_version\>\\w+)"<br />\| count by c\_ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = c\_ip<br />\| where !isNull(latitude)|

