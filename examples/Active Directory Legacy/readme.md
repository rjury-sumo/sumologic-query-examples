# Active Directory Legacy

## Searches

### Log Searches

- **Account Lock Out Events**: from Search: Active Directory Legacy/Security Status/Account Lock Out Events 
- **Computer OS per Domain**: from Dashboard: Active Directory Legacy/Active Directory Information - New 
- **Directory Service Object Changes**: from Search: Active Directory Legacy/Security Status/Directory Service Object Changes 
- **Failed User Logins**: from Search: Active Directory Legacy/User Activity/Failed User Logins 
- **Groups per Domain**: from Dashboard: Active Directory Legacy/Active Directory Information - New 
- **Last Successful Login for a specific user**: from Search: Active Directory Legacy/User Activity/Last Successful Login for a specific user 
- **Last Successful Login Report**: from Search: Active Directory Legacy/User Activity/Last Successful Login Report 
- **LDAP Replication Failures**: from Search: Active Directory Legacy/Security Status/LDAP Replication Failures 
- **Login attempts to disabled accounts**: from Search: Active Directory Legacy/Security Status/Login attempts to disabled accounts 
- **New Account Creation**: from Search: Active Directory Legacy/Security Status/New Account Creation 
- **New Computer Account Creation**: from Search: Active Directory Legacy/Security Status/New Computer Account Creation 
- **New Group Creation**: from Search: Active Directory Legacy/Security Status/New Group Creation 
- **Organizational Units per Domain**: from Dashboard: Active Directory Legacy/Active Directory Information - New 
- **OU Creation**: from Search: Active Directory Legacy/Security Status/OU Creation 
- **OU Deletion**: from Search: Active Directory Legacy/Security Status/OU Deletion 
- **Password Change Attempts**: from Search: Active Directory Legacy/User Activity/Password Change Attempts 
- **Password Reset Attempts**: from Search: Active Directory Legacy/User Activity/Password Reset Attempts 
- **Policy Changes**: from Search: Active Directory Legacy/Security Status/Policy Changes 
- **Successful User Logins**: from Search: Active Directory Legacy/User Activity/Successful User Logins 
- **Top 10 Domain Controllers with Most Login Failures**: from Search: Active Directory Legacy/User Activity/Top 10 Domain Controllers with Most Login Failures 
- **Top 10 Domain Controllers with the Most Login Failure Rate**: from Search: Active Directory Legacy/User Activity/Top 10 Domain Controllers with the Most Login Failure Rate 
- **Top 10 Domains with Most Login Failures**: from Search: Active Directory Legacy/User Activity/Top 10 Domains with Most Login Failures 
- **Topology**: from Dashboard: Active Directory Legacy/Active Directory Information - New 
- **Trend of new users and disabled users over time**: from Search: Active Directory Legacy/Security Status/Trend of new users and disabled users over time 
- **User Account Changes**: from Search: Active Directory Legacy/User Activity/User Account Changes 
- **User added to group**: from Search: Active Directory Legacy/Security Status/User added to group

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Active Directory Legacy/Security Status|Account Lock Out Events|Logs|Active Directory Legacy/Security Status/Account Lock Out Events|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4740 or 644) ("EventCode = 4740;" or "EventCode = 644;")<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop   <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r" nodrop<br />\| where event\_id in ("4740","644") <br />\| fields host, event\_id, msg\_summary, src\_user, src\_domain, dest\_user|
|Active Directory Legacy|Computer OS per Domain|Logs|Active Directory Legacy/Active Directory Information - New|\_sourceCategory = Labs/Windows/OS/Windows "Computer" <br />\| parse regex "^Computer SearchBase==\\"(?\<searchBase\>[^\\"]+)\\" DistinguishedName==\\"(?\<computerDN\>[^\\"]+)\\" Name==\\"(?\<computerName\>[^\\"]+)\\" ObjectGUID==\\"(?\<computerGUID\>[^ ]+)\\" DNSHostName==\\"(?\<computerDNSName\>[^\\" ]+)\\" OperatingSystem==\\"(?\<computerOS\>[^\\"]+)\\" IPv4Address==\\"(?\<computerIP\>[^ ]+)\\"" <br />\| searchBase as domain<br />\| count by domain,computerDN,computerName,computerGUID,computerDNSName,computerOS,computerIP <br />\| count as computers by computerOS,domain |
|Active Directory Legacy/Security Status|Directory Service Object Changes|Logs|Active Directory Legacy/Security Status/Directory Service Object Changes|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security "Directory Service Changes" <br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse "CategoryString = \\"\*\\";" as CategoryString nodrop \| parse regex "Subcategory:\\s+(?\<subcategory\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r" nodrop <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r]+?)(?:\\r\|\\";)" nodrop<br />\| parse regex "Directory Service:[\\s\\S]+?Name:\\s+(?\<directory\_ServiceName\>[^\\r]+?)\\r" nodrop \| parse regex "Directory Service:[\\s\\S]+?Type:\\s+(?\<directory\_ServiceType\>[^\\r]+?)\\r" nodrop \| parse "Object:\\r\\n\\tDN:\\t\*\\r\\n\\tGUID" as dest\_ou nodrop<br />\| fields msg\_summary, categoryString, subcategory, event\_id, src\_user, src\_domain, dest\_user, dest\_domain, host<br />\| where categoryString="Directory Service Changes" or subcategory="Directory Service Changes"|
|Active Directory Legacy/User Activity|Failed User Logins|Logs|Active Directory Legacy/User Activity/Failed User Logins|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4625 or 4768 or 4771 or 4776) ("EventCode = 4625;" or "EventCode = 4768;" or "EventCode = 4771;" or "EventCode = 4776;")<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse regex "Logon Type:\\s+(?\<logon\_type\>\\d+)\*" nodrop \| parse regex "Failure Information:\\s+Failure Reason:\\s+(?\<fail\_reason\>[^.\\r]+?)[.\\r]" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop \| parse regex "Result Code:\\s+(?\<result\_code\>[^\\r]+)\\r" nodrop \| parse "Type = \\"\*\\";" as type \| parse regex "Logon Account:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Source Workstation:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Error Code:\\s+(?\<error\_code\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse regex "Failure Code:\\s+(?\<failure\_code\>[^\\r]+)\\r" nodrop <br />\| where event\_id in ("4625", "4771") or (event\_id="4768" and result\_code !="0x0") or (event\_id="4776" and error\_code !="0x0")<br />\| fields host, event\_id, msg\_summary, src\_user, src\_ip, src\_port, src\_domain, dest\_user, dest\_domain, fail\_reason, logon\_type, result\_code, failure\_code, src\_host, error\_code, type|
|Active Directory Legacy|Groups per Domain|Logs|Active Directory Legacy/Active Directory Information - New|\_sourceCategory = Labs/Windows/OS/Windows "Group" <br />\| parse regex "^Group SearchBase==\\"(?\<searchBase\>[^\\"]+)\\" DistinguishedName==\\"(?\<groupDN\>[^\\"]+)\\" Name==\\"(?\<groupName\>[^\\"]+)\\" ObjectGUID==\\"(?\<groupGUID\>[^ ]+)\\" GroupCategory==\\"(?\<groupCat\>[^\\"]\*)\\"" \| searchBase as Domain <br />\| count\_distinct(groupDN) as groups by Domain,groupCat  \| transpose row domain column groupCat as %"Security",%"Distribution"|
|Active Directory Legacy/User Activity|Last Successful Login for a specific user|Logs|Active Directory Legacy/User Activity/Last Successful Login for a specific user|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4624 "EventCode = 4624;" myuser <br />\| parse "EventCode = \*;" as event\_id \| parse "Computer = \\"\*\\";" as dest\_host nodrop \| parse "ComputerName = \\"\*\\";" as dest\_host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse regex "Logon Type:\\s+(?\<logon\_type\>\\d+)\*" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop  <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Name:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Client Address:[\\s\\r]+(?\<src\_ip\>[^\\r]+)" nodrop <br />\| where event\_id="4624" and (logon\_type in ("2","7","8","10","11")) and dest\_user="myuser" <br />\| first(\_messagetime) as last\_login by src\_ip, dest\_user, dest\_domain, logon\_type, dest\_host, src\_port, src\_domain, src\_user, src\_host<br />\| sort by last\_login <br />\| formatDate(fromMillis(last\_login), "MM-dd-yyyy HH:mm:ss z") as last\_login|
|Active Directory Legacy/User Activity|Last Successful Login Report|Logs|Active Directory Legacy/User Activity/Last Successful Login Report|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4624 "EventCode = 4624;" <br />\| parse "EventCode = \*;" as event\_id \| parse "Computer = \\"\*\\";" as dest\_host nodrop \| parse "ComputerName = \\"\*\\";" as dest\_host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse regex "Logon Type:\\s+(?\<logon\_type\>\\d+)\*" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop  <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Name:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Client Address:[\\s\\r]+(?\<src\_ip\>[^\\r]+)" nodrop <br />\| where event\_id="4624" and (logon\_type in ("2","7","8","10","11")) <br />\| first(\_messagetime) as last\_login by src\_ip, dest\_user, dest\_domain, logon\_type, dest\_host, src\_port, src\_domain, src\_user, src\_host<br />\| sort by last\_login <br />\| formatDate(fromMillis(last\_login), "MM-dd-yyyy HH:mm:ss z") as last\_login|
|Active Directory Legacy/Security Status|LDAP Replication Failures|Logs|Active Directory Legacy/Security Status/LDAP Replication Failures|\_sourceCategory = Labs/Windows/OS/Windows (\_sourceName="Directory Service" or \_sourceName=Security) <br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse "CategoryString = \\"\*\\";" as CategoryString nodrop \| parse regex "Subcategory:\\s+(?\<subcategory\>[^\\r]+?)\\r" nodrop \| parse "Type = \\"\*\\";" as msg\_type \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r" nodrop <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r]+?)(?:\\r\|\\";)" nodrop<br />\| where event\_id in ("4935","1388","1988","2042","1925","2087","2088","1311") or (\_sourceName="Directory Service" and msg\_type="Error" and (CategoryString="Replication" or CategoryString="DS RPC Client" or CategoryString="Knowledge Consistency Checker")) or (\_sourceName="Security" and msg\_type="Audit Failure" and CategoryString="Detailed Directory Service Replication") <br />\| fields msg\_summary, CategoryString, event\_id, src\_user, src\_domain, dest\_user, dest\_domain, msg\_type, host|
|Active Directory Legacy/Security Status|Login attempts to disabled accounts|Logs|Active Directory Legacy/Security Status/Login attempts to disabled accounts|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4625 or 4768 or 4771 or 4776) ("EventCode = 4625;" or "EventCode = 4768;" or "EventCode = 4771;" or "EventCode = 4776;") "Account currently disabled" <br /> \| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse regex "Logon Type:\\s+(?\<logon\_type\>\\d+)\*" nodrop \| parse regex "Failure Information:\\s+Failure Reason:\\s+(?\<fail\_reason\>[^.\\r]+?)[.\\r]" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r]+?)(?:\\r\|\\";)" nodrop \| parse regex "Result Code:\\s+(?\<result\_code\>[^\\r]+)\\r" nodrop \| parse "Type = \\"\*\\";" as type \| parse regex "Logon Account:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Source Workstation:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Error Code:\\s+(?\<error\_code\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse regex "Failure Code:\\s+(?\<failure\_code\>[^\\r]+)\\r" nodrop  <br />\| where event\_id in ("4625", "4771") or (event\_id="4768" and result\_code !="0x0") or (event\_id="4776" and error\_code !="0x0")<br />\| fields host, event\_id, msg\_summary, src\_user, src\_ip, src\_port, src\_domain, dest\_user, dest\_domain, fail\_reason, logon\_type, result\_code, failure\_code, src\_host, error\_code, type|
|Active Directory Legacy/Security Status|New Account Creation|Logs|Active Directory Legacy/Security Status/New Account Creation|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4720 "EventCode = 4720;" <br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r]+?)\\r" nodrop<br />\| where event\_id="4720" <br />\| fields host, event\_id, msg\_summary, src\_user, dest\_user, src\_domain, dest\_domain|
|Active Directory Legacy/Security Status|New Computer Account Creation|Logs|Active Directory Legacy/Security Status/New Computer Account Creation|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security "EventCode = 4741;" "computer account" "was created"<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse "CategoryString = \\"\*\\";" as CategoryString nodrop \| parse regex "Subcategory:\\s+(?\<subcategory\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r" nodrop <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r]+?)(?:\\r\|\\";)" nodrop<br />\| where event\_id="4741" <br />\| fields msg\_summary, categoryString, subcategory, event\_id, src\_user, src\_domain, dest\_user, dest\_domain, host|
|Active Directory Legacy/Security Status|New Group Creation|Logs|Active Directory Legacy/Security Status/New Group Creation|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4727 or 4731 or 4754) ("EventCode = 4727;" or "EventCode = 4731;" or "EventCode = 4754;")<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject:[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?(?:New\|Deleted\|\\s\*)\\s\*Group:[\\s\\S]+?(?:Account\|Group) Name:\\s+(?\<group\_name\>[^\\r\\"]+?)\\r\\s+?(?:Account\|Group) Domain:\\s+(?\<group\_domain\>[^\\r\\"]+?)(?:\\r\|\\")" nodrop<br />\| where event\_id in ("4727", "4731", "4754")<br />\| fields host, event\_id, msg\_summary, src\_user, src\_domain, group\_name, group\_domain|
|Active Directory Legacy|Organizational Units per Domain|Logs|Active Directory Legacy/Active Directory Information - New|\_sourceCategory = Labs/Windows/OS/Windows "OU" \| parse regex "^OU SearchBase==\\"(?\<searchBase\>[^\\"]+)\\" DistinguishedName==\\"(?\<ouDN\>[^\\"]+)\\" Name==\\"(?\<ouName\>[^\\"]+)\\" ObjectGUID==\\"(?\<ouGUID\>[^ ]+)\\"" \| searchBase as domain \| count\_distinct(ouDN) as OrganizationalUnits by domain|
|Active Directory Legacy/Security Status|OU Creation|Logs|Active Directory Legacy/Security Status/OU Creation|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 5137 "EventCode = 5137;"<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Directory Service:[\\s\\S]+?Name:\\s+(?\<directory\_ServiceName\>[^\\r]+?)\\r" nodrop<br />\| parse "Object:\\r\\n\\tDN:\\t\*\\r\\n\\tGUID" as dest\_ou nodrop<br />\| where event\_id="5137" <br />\| fields msg\_summary, src\_user, src\_domain, dest\_ou, host, directory\_ServiceName, event\_id|
|Active Directory Legacy/Security Status|OU Deletion|Logs|Active Directory Legacy/Security Status/OU Deletion|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 5141 "EventCode = 5141;"<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Directory Service:[\\s\\S]+?Name:\\s+(?\<directory\_ServiceName\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Directory Service:[\\s\\S]+?Type:\\s+(?\<directory\_ServiceType\>[^\\r]+?)\\r" nodrop<br />\| parse "Object:\\r\\n\\tDN:\\t\*\\r\\n\\tGUID" as dest\_ou nodrop<br />\| where event\_id="5141" <br />\| fields msg\_summary, src\_user, src\_domain, dest\_ou, host, directory\_ServiceName, directory\_ServiceType, event\_id|
|Active Directory Legacy/User Activity|Password Change Attempts|Logs|Active Directory Legacy/User Activity/Password Change Attempts|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4723 "EventCode = 4723;" <br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r]+?)\\r" nodrop<br />\| where event\_id="4723"<br />\| fields host, event\_id, msg\_summary, src\_user, dest\_user, src\_domain, dest\_domain|
|Active Directory Legacy/User Activity|Password Reset Attempts|Logs|Active Directory Legacy/User Activity/Password Reset Attempts|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4724 "EventCode = 4724;"<br />\| parse "EventCode = \*;" as event\_id nodrop<br />\| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop<br />\| where event\_id="4724"<br />\| fields host, event\_id, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain|
|Active Directory Legacy/Security Status|Policy Changes|Logs|Active Directory Legacy/Security Status/Policy Changes|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security "Policy Change"<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse "CategoryString = \\"\*\\";" as CategoryString nodrop \| parse regex "Subcategory:\\s+(?\<subcategory\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r" nodrop <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r]+?)(?:\\r\|\\";)" nodrop<br />\| where categoryString matches "\*Policy\*Change\*" or msg\_summary matches "\*policy\*change\*"<br />\| count as num\_changes, first(\_messageTime) as last\_change by src\_domain, comp\_name, categoryString, msg\_summary<br />\| sort by last\_change <br />\| formatDate(fromMillis(last\_change), "MM-dd-yyyy HH:mm:ss z") as last\_change|
|Active Directory Legacy/User Activity|Successful User Logins|Logs|Active Directory Legacy/User Activity/Successful User Logins|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4624 "EventCode = 4624;"<br />\| parse "EventCode = \*;" as event\_id \| parse "Computer = \\"\*\\";" as dest\_host nodrop \| parse "ComputerName = \\"\*\\";" as dest\_host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse regex "Logon Type:\\s+(?\<logon\_type\>\\d+)\*" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop  <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Name:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Client Address:[\\s\\r]+(?\<src\_ip\>[^\\r]+)" nodrop<br />\| where event\_id="4624" <br />\| fields event\_id, msg\_summary, src\_host, src\_ip, src\_user, src\_domain, dest\_user, dest\_domain, logon\_type, dest\_host, src\_port|
|Active Directory Legacy/User Activity|Top 10 Domain Controllers with Most Login Failures|Logs|Active Directory Legacy/User Activity/Top 10 Domain Controllers with Most Login Failures|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4625 or 4768 or 4771 or 4776) ("EventCode = 4625;" or "EventCode = 4768;" or "EventCode = 4771;" or "EventCode = 4776;") <br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse regex "Logon Type:\\s+(?\<logon\_type\>\\d+)\*" nodrop \| parse regex "Failure Information:\\s+Failure Reason:\\s+(?\<fail\_reason\>[^.\\r]+?)[.\\r]" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop \| parse regex "Result Code:\\s+(?\<result\_code\>[^\\r]+)\\r" nodrop \| parse "Type = \\"\*\\";" as type \| parse regex "Logon Account:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Source Workstation:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Error Code:\\s+(?\<error\_code\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse regex "Failure Code:\\s+(?\<failure\_code\>[^\\r]+)\\r" nodrop <br />\| where event\_id in ("4625", "4771") or (event\_id="4768" and result\_code !="0x0") or (event\_id="4776" and error\_code !="0x0")<br />\| fields host, event\_id, msg\_summary, src\_user, src\_ip, src\_port, src\_domain, dest\_user, dest\_domain, fail\_reason, logon\_type, result\_code, failure\_code, src\_host, error\_code, type<br />\| \_sourceHost as ReportingDC \| count as %"LoginFailureCount" by ReportingDC \| sort - %"LoginFailureCount" \| limit 10|
|Active Directory Legacy/User Activity|Top 10 Domain Controllers with the Most Login Failure Rate|Logs|Active Directory Legacy/User Activity/Top 10 Domain Controllers with the Most Login Failure Rate|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4624 or 4625 or 4768 or 4771 or 4776) ("EventCode = 4624;" or "EventCode = 4625;" or "EventCode = 4768;" or "EventCode = 4771;" or "EventCode = 4776;") <br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse regex "Logon Type:\\s+(?\<logon\_type\>\\d+)\*" nodrop \| parse regex "Failure Information:\\s+Failure Reason:\\s+(?\<fail\_reason\>[^.\\r]+?)[.\\r]" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop \| parse regex "Result Code:\\s+(?\<result\_code\>[^\\r]+)\\r" nodrop \| parse "Type = \\"\*\\";" as type \| parse regex "Logon Account:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Source Workstation:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Error Code:\\s+(?\<error\_code\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse regex "Failure Code:\\s+(?\<failure\_code\>[^\\r]+)\\r" nodrop <br />\| fields host, event\_id, msg\_summary, src\_user, src\_ip, src\_port, src\_domain, dest\_user, dest\_domain, fail\_reason, logon\_type, result\_code, failure\_code, src\_host, error\_code, type<br />\| where (event\_id in ("4625","4771","4624")) or (event\_id="4768" AND result\_code != "0x0") or (event\_id="4776" and error\_code != "0x0")<br />\| \_sourceHost as ReportingDC <br />\| if (event\_id="4624",1,0) as Success <br />\| if (event\_id="4624",0,1) as Failure <br />\| sum(Success) as SuccessCount, sum(Failure) as FailureCount by ReportingDC <br />\| FailureCount/SuccessCount as %"LoginFailureRatio" \| sort - %"LoginFailureRatio" \| limit 10|
|Active Directory Legacy/User Activity|Top 10 Domains with Most Login Failures|Logs|Active Directory Legacy/User Activity/Top 10 Domains with Most Login Failures|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4625 or 4768 or 4771 or 4776) ("EventCode = 4625;" or "EventCode = 4768;" or "EventCode = 4771;" or "EventCode = 4776;") <br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse regex "Logon Type:\\s+(?\<logon\_type\>\\d+)\*" nodrop \| parse regex "Failure Information:\\s+Failure Reason:\\s+(?\<fail\_reason\>[^.\\r]+?)[.\\r]" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop \| parse regex "Result Code:\\s+(?\<result\_code\>[^\\r]+)\\r" nodrop \| parse "Type = \\"\*\\";" as type \| parse regex "Logon Account:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Source Workstation:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Error Code:\\s+(?\<error\_code\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse regex "Failure Code:\\s+(?\<failure\_code\>[^\\r]+)\\r" nodrop<br />\| where event\_id in ("4625", "4771") or (event\_id="4768" and result\_code != "0x0") or (event\_id="4776" and error\_code != "0x0")<br />\| fields host, event\_id, msg\_summary, src\_user, src\_ip, src\_port, src\_domain, dest\_user, dest\_domain, fail\_reason, logon\_type, result\_code, failure\_code, src\_host, error\_code, type<br />\| where dest\_domain != ""<br />\| count as %"LoginFailureCount" by dest\_domain \| sort - %"LoginFailureCount" \| limit 10|
|Active Directory Legacy|Topology|Logs|Active Directory Legacy/Active Directory Information - New|\_sourceCategory = Labs/Windows/OS/Windows "DomainController" \| parse regex "^DomainController DName==\\"(?\<domainDN\>[^ \\"]+)\\" DomainName==\\"(?\<domainName\>[^\\"]+)\\" Forest==\\"(?\<forest\>[^\\"]+)\\" NetBIOSName==\\"(?\<NetBiosName\>[^\\"]+)\\" ControllerHostName==\\"(?\<dcHostName\>[^\\"]+)\\" IP==\\"(?\<dcIP\>[^ ]+)\\" Site==\\"(?\<site\>[^ ]+)\\"" \| count by forest,site,domainDN,NetBiosName \| fields - \_count|
|Active Directory Legacy/Security Status|Trend of new users and disabled users over time|Logs|Active Directory Legacy/Security Status/Trend of new users and disabled users over time|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4720 or 4725) ("EventCode = 4720;" or "EventCode = 4725;")<br />\| timeslice by 1d <br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r]+?)(?:\\r\|\\";)" nodrop<br />\| where event\_id in ("4720","4725") <br />\| if (event\_id="4720","New Users","Disabled Users") as type <br />\| count by \_timeslice, type <br />\| sort by \_timeslice asc <br />\| transpose row \_timeslice column type|
|Active Directory Legacy/User Activity|User Account Changes|Logs|Active Directory Legacy/User Activity/User Account Changes|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security "User Account Management" <br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse "CategoryString = \\"\*\\";" as CategoryString nodrop \| parse regex "Subcategory:\\s+(?\<subcategory\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r]+?)(?:\\r\|\\";)" nodrop<br />\| fields msg\_summary, categoryString, subcategory, event\_id, src\_user, src\_domain, dest\_user, dest\_domain, host<br />\| where categoryString="User Account Management" or subcategory="User Account Management"|
|Active Directory Legacy/Security Status|User added to group|Logs|Active Directory Legacy/Security Status/User added to group|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4728 or 4732 or 4746 or 4751 or 4756 or 4761) ("EventCode = 4728;" or "EventCode = 4732;" or "EventCode = 4746;" or "EventCode = 4751;" or "EventCode = 4756;" or "EventCode = 4761;" )<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject:[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r\\"]+?)\\r[\\s\\S]+?(?:New\|Deleted) Group:[\\s\\S]+?(?:Account\|Group) Name:\\s+(?\<group\_name\>[^\\r\\"]+?)\\r\\s+?(?:Account\|Group) Domain:\\s+(?\<group\_domain\>[^\\r\\"]+?)(?:\\r\|\\")" nodrop <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r" nodrop <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject:[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Member:[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r\\"]+?)\\r[\\s\\S]+?Group:[\\s\\S]+?(?:Account\|Group) Name:\\s+(?\<group\_name\>[^\\r\\"]+?)\\r\\s+?(?:Account\|Group) Domain:\\s+(?\<group\_domain\>[^\\r\\"]+?)(?:\\r\|\\")" nodrop <br />\| where event\_id in ("4728", "4732", "4746", "4751", "4756", "4761")<br />\| fields host, event\_id, msg\_summary, src\_user, dest\_user, src\_domain, group\_name, group\_domain|

