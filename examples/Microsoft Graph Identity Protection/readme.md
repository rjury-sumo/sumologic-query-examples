# Microsoft Graph Identity Protection
## Sumo Logic App For: Microsoft Graph Identity Protection
The Microsoft Graph Identity Protection App for Sumo Logic provides organizations with advanced security monitoring and analytics capabilities for their Microsoft Graph Identity Protection data. The app leverages Sumo Logic's cloud-to-cloud source to collect and analyze data from the Microsoft Graph Identity Protection Source, allowing organizations to proactively identify potential security risks and take action to mitigate them.
Docs Link: [Microsoft Graph Identity Protection](https://help.sumologic.com/?cid=6050)

## Searches

### Log Searches

- **Actions on Risk**: from Dashboard: Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections 
- **Actions on Risk**: from Dashboard: Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risky Users 
- **Geo Locations of Risk**: from Dashboard: Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections 
- **Latency between Risk Occurrence and Detection**: from Dashboard: Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections 
- **One Day Frequency Comparison of Risk by Type**: from Dashboard: Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections 
- **Risk by Activity**: from Dashboard: Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections 
- **Risk by Detection Type**: from Dashboard: Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections 
- **Risk by Level**: from Dashboard: Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections 
- **Risk by State**: from Dashboard: Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections 
- **Risk by Token Issuer Type**: from Dashboard: Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections 
- **Risk Detections Summary**: from Dashboard: Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections 
- **Risk Level Over Time**: from Dashboard: Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections 
- **Risky Users by Level**: from Dashboard: Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risky Users 
- **Risky Users by Processing State**: from Dashboard: Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risky Users 
- **Risky Users by State**: from Dashboard: Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risky Users 
- **Risky Users by Status**: from Dashboard: Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risky Users 
- **Risky Users Summary**: from Dashboard: Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risky Users 
- **Risky Users Trend by Level**: from Dashboard: Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risky Users 
- **Top 10 Sources of Risk**: from Dashboard: Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Microsoft Graph Identity Protection|Actions on Risk|Logs|Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections|\_sourceCategory={{Logsdatasource}}   riskEventType // Distinguish Risky Users data from Risk Detections data which have "riskEventType" field<br />\| json "activity", "activityDateTime", "detectedDateTime", "detectionTimingType", "id", "ipAddress", "lastUpdatedDateTime", "location", "location.geoCoordinates.latitude", "location.geoCoordinates.longitude", "riskDetail", "riskEventType", "riskLevel", "riskState", "source", "tokenIssuerType", "userPrincipalName", "userId" as activity, activity\_date\_time, detected\_date\_time, detection\_timing\_type, risk\_id, ip\_address, last\_updated\_date\_time, location, latitude, longitude, risk\_action, risk\_event\_type, risk\_level, risk\_state, source, token\_issuer\_type, user, user\_id nodrop<br />\| concat(location.city, ", ", location.state, ", ", location.countryOrRegion) as location<br /><br />// Apply global filters.<br />\| where activity matches "{{activity}}"<br />\| where risk\_event\_type matches "{{risk\_event\_type}}"<br />\| where risk\_level matches "{{risk\_level}}"<br />\| where risk\_state matches "{{risk\_state}}"<br />\| where risk\_action matches "{{risk\_action}}"<br />\| where location matches "{{location}}"<br /><br />\| count(risk\_id) as frequency by risk\_action<br />\| sort by frequency|
|Microsoft Graph Identity Protection|Actions on Risk|Logs|Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risky Users|\_sourceCategory={{Logsdatasource}}   !riskEventType // Distinguish Risky Users data from Risk Detections data which have "riskEventType" field<br />\| json "id", "userPrincipalName", "isDeleted", "isProcessing", "riskLevel", "riskState", "riskDetail", "riskLastUpdatedDateTime" as user\_id, user, is\_deleted, is\_processing, risk\_level, risk\_state, risk\_action, risk\_last\_updated\_date\_time nodrop<br /><br />// Apply global filters.<br />\| "{{user\_status}}" as user\_status\_filter<br />\| if(user\_status\_filter matches "active", "false", user\_status\_filter) as user\_status\_filter<br />\| if(user\_status\_filter matches "deleted", "true", user\_status\_filter) as user\_status\_filter<br />\| where is\_deleted matches user\_status\_filter<br />\| "{{processing\_state}}" as processing\_state\_filter<br />\| if(processing\_state\_filter matches "processing", "true", processing\_state\_filter) as processing\_state\_filter<br />\| if(processing\_state\_filter matches "not processing", "false", processing\_state\_filter) as processing\_state\_filter<br />\| where is\_processing matches processing\_state\_filter<br />\| where risk\_level matches "{{risk\_level}}"<br />\| where risk\_state matches "{{risk\_state}}"<br />\| where risk\_action matches "{{risk\_action}}"<br /><br />\| count(user\_id) as frequency by risk\_action<br />\| sort by frequency|
|Microsoft Graph Identity Protection|Geo Locations of Risk|Logs|Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections|\_sourceCategory={{Logsdatasource}}   riskEventType // Distinguish Risky Users data from Risk Detections data which have "riskEventType" field<br />\| json "activity", "activityDateTime", "detectedDateTime", "detectionTimingType", "id", "ipAddress", "lastUpdatedDateTime", "location", "location.geoCoordinates.latitude", "location.geoCoordinates.longitude", "riskDetail", "riskEventType", "riskLevel", "riskState", "source", "tokenIssuerType", "userPrincipalName", "userId" as activity, activity\_date\_time, detected\_date\_time, detection\_timing\_type, risk\_id, ip\_address, last\_updated\_date\_time, location, latitude, longitude, risk\_action, risk\_event\_type, risk\_level, risk\_state, source, token\_issuer\_type, user, user\_id nodrop<br />\| concat(location.city, ", ", location.state, ", ", location.countryOrRegion) as location<br />\| topk(1, last\_updated\_date\_time) by risk\_id // Consider only most recent details of the risk.<br /><br />// Apply global filters.<br />\| where activity matches "{{activity}}"<br />\| where risk\_event\_type matches "{{risk\_event\_type}}"<br />\| where risk\_level matches "{{risk\_level}}"<br />\| where risk\_state matches "{{risk\_state}}"<br />\| where risk\_action matches "{{risk\_action}}"<br />\| where location matches "{{location}}"<br /><br />\| count as frequency by latitude, longitude<br />\| sort by frequency|
|Microsoft Graph Identity Protection|Latency between Risk Occurrence and Detection|Logs|Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections|\_sourceCategory={{Logsdatasource}}   riskEventType // Distinguish Risky Users data from Risk Detections data which have "riskEventType" field<br />\| json "activity", "activityDateTime", "detectedDateTime", "detectionTimingType", "id", "ipAddress", "lastUpdatedDateTime", "location", "location.geoCoordinates.latitude", "location.geoCoordinates.longitude", "riskDetail", "riskEventType", "riskLevel", "riskState", "source", "tokenIssuerType", "userPrincipalName", "userId" as activity, activity\_date\_time, detected\_date\_time, detection\_timing\_type, risk\_id, ip\_address, last\_updated\_date\_time, location, latitude, longitude, risk\_action, risk\_event\_type, risk\_level, risk\_state, source, token\_issuer\_type, user, user\_id nodrop<br />\| concat(location.city, ", ", location.state, ", ", location.countryOrRegion) as location<br />\| topk(1, last\_updated\_date\_time) by risk\_id // Consider only most recent details of the risk.<br /><br />// Apply global filters.<br />\| where activity matches "{{activity}}"<br />\| where risk\_event\_type matches "{{risk\_event\_type}}"<br />\| where risk\_level matches "{{risk\_level}}"<br />\| where risk\_state matches "{{risk\_state}}"<br />\| where risk\_action matches "{{risk\_action}}"<br />\| where location matches "{{location}}"<br /><br />\| extract field=activity\_date\_time "(?\<activity\_date\_time\_ms\>.\*\\.\\d{3}).\*Z"<br />\| extract field=detected\_date\_time "(?\<detected\_date\_time\_ms\>.\*\\.\\d{3}).\*Z"<br />\| parseDate(activity\_date\_time\_ms, "yyyy-MM-dd'T'HH:mm:ss.SSS", "etc/utc")/1000 as occurred\_timestamp\_secs<br />\| parseDate(detected\_date\_time\_ms, "yyyy-MM-dd'T'HH:mm:ss.SSS", "etc/utc")/1000 as detected\_timestamp\_secs<br />\| (detected\_timestamp\_secs - occurred\_timestamp\_secs) as diff\_time<br />\| timeslice 1h<br />\| fillmissing timeslice with 0 for diff\_time<br />\| avg(diff\_time) by \_timeslice|
|Microsoft Graph Identity Protection|One Day Frequency Comparison of Risk by Type|Logs|Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections|\_sourceCategory={{Logsdatasource}}   riskEventType // Distinguish Risky Users data from Risk Detections data which have "riskEventType" field<br />\| json "activity", "activityDateTime", "detectedDateTime", "detectionTimingType", "id", "ipAddress", "lastUpdatedDateTime", "location", "location.geoCoordinates.latitude", "location.geoCoordinates.longitude", "riskDetail", "riskEventType", "riskLevel", "riskState", "source", "tokenIssuerType", "userPrincipalName", "userId" as activity, activity\_date\_time, detected\_date\_time, detection\_timing\_type, risk\_id, ip\_address, last\_updated\_date\_time, location, latitude, longitude, risk\_action, risk\_event\_type, risk\_level, risk\_state, source, token\_issuer\_type, user, user\_id nodrop<br />\| concat(location.city, ", ", location.state, ", ", location.countryOrRegion) as location<br />\| topk(1, last\_updated\_date\_time) by risk\_id // Consider only most recent details of the risk.<br /><br />// Apply global filters.<br />\| where activity matches "{{activity}}"<br />\| where risk\_event\_type matches "{{risk\_event\_type}}"<br />\| where risk\_level matches "{{risk\_level}}"<br />\| where risk\_state matches "{{risk\_state}}"<br />\| where risk\_action matches "{{risk\_action}}"<br />\| where location matches "{{location}}"<br /><br />\| count(risk\_id) as frequency by risk\_event\_type<br />\| sort by frequency<br />\| compare with timeshift 1d<br />\| if(isNull(frequency\_1d), 0, frequency\_1d) as frequency\_1d|
|Microsoft Graph Identity Protection|Risk by Activity|Logs|Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections|\_sourceCategory={{Logsdatasource}}   riskEventType // Distinguish Risky Users data from Risk Detections data which have "riskEventType" field<br />\| json "activity", "activityDateTime", "detectedDateTime", "detectionTimingType", "id", "ipAddress", "lastUpdatedDateTime", "location", "location.geoCoordinates.latitude", "location.geoCoordinates.longitude", "riskDetail", "riskEventType", "riskLevel", "riskState", "source", "tokenIssuerType", "userPrincipalName", "userId" as activity, activity\_date\_time, detected\_date\_time, detection\_timing\_type, risk\_id, ip\_address, last\_updated\_date\_time, location, latitude, longitude, risk\_action, risk\_event\_type, risk\_level, risk\_state, source, token\_issuer\_type, user, user\_id nodrop<br />\| concat(location.city, ", ", location.state, ", ", location.countryOrRegion) as location<br />\| topk(1, last\_updated\_date\_time) by risk\_id // Consider only most recent details of the risk.<br /><br />// Apply global filters.<br />\| where activity matches "{{activity}}"<br />\| where risk\_event\_type matches "{{risk\_event\_type}}"<br />\| where risk\_level matches "{{risk\_level}}"<br />\| where risk\_state matches "{{risk\_state}}"<br />\| where risk\_action matches "{{risk\_action}}"<br />\| where location matches "{{location}}"<br /><br />\| count(risk\_id) by activity<br />\| sort by \_count|
|Microsoft Graph Identity Protection|Risk by Detection Type|Logs|Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections|\_sourceCategory={{Logsdatasource}}   riskEventType // Distinguish Risky Users data from Risk Detections data which have "riskEventType" field<br />\| json "activity", "activityDateTime", "detectedDateTime", "detectionTimingType", "id", "ipAddress", "lastUpdatedDateTime", "location", "location.geoCoordinates.latitude", "location.geoCoordinates.longitude", "riskDetail", "riskEventType", "riskLevel", "riskState", "source", "tokenIssuerType", "userPrincipalName", "userId" as activity, activity\_date\_time, detected\_date\_time, detection\_timing\_type, risk\_id, ip\_address, last\_updated\_date\_time, location, latitude, longitude, risk\_action, risk\_event\_type, risk\_level, risk\_state, source, token\_issuer\_type, user, user\_id nodrop<br />\| concat(location.city, ", ", location.state, ", ", location.countryOrRegion) as location<br />\| topk(1, last\_updated\_date\_time) by risk\_id // Consider only most recent details of the risk.<br /><br />// Apply global filters.<br />\| where activity matches "{{activity}}"<br />\| where risk\_event\_type matches "{{risk\_event\_type}}"<br />\| where risk\_level matches "{{risk\_level}}"<br />\| where risk\_state matches "{{risk\_state}}"<br />\| where risk\_action matches "{{risk\_action}}"<br />\| where location matches "{{location}}"<br /><br />\| count(risk\_id) by detection\_timing\_type<br />\| sort by \_count|
|Microsoft Graph Identity Protection|Risk by Level|Logs|Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections|\_sourceCategory={{Logsdatasource}}   riskEventType // Distinguish Risky Users data from Risk Detections data which have "riskEventType" field<br />\| json "activity", "activityDateTime", "detectedDateTime", "detectionTimingType", "id", "ipAddress", "lastUpdatedDateTime", "location", "location.geoCoordinates.latitude", "location.geoCoordinates.longitude", "riskDetail", "riskEventType", "riskLevel", "riskState", "source", "tokenIssuerType", "userPrincipalName", "userId" as activity, activity\_date\_time, detected\_date\_time, detection\_timing\_type, risk\_id, ip\_address, last\_updated\_date\_time, location, latitude, longitude, risk\_action, risk\_event\_type, risk\_level, risk\_state, source, token\_issuer\_type, user, user\_id nodrop<br />\| concat(location.city, ", ", location.state, ", ", location.countryOrRegion) as location<br />\| topk(1, last\_updated\_date\_time) by risk\_id // Consider only most recent details of the risk.<br /><br />// Apply global filters.<br />\| where activity matches "{{activity}}"<br />\| where risk\_event\_type matches "{{risk\_event\_type}}"<br />\| where risk\_level matches "{{risk\_level}}"<br />\| where risk\_state matches "{{risk\_state}}"<br />\| where risk\_action matches "{{risk\_action}}"<br />\| where location matches "{{location}}"<br /><br />\| count(risk\_id) by risk\_level<br />\| sort by \_count|
|Microsoft Graph Identity Protection|Risk by State|Logs|Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections|\_sourceCategory={{Logsdatasource}}   riskEventType // Distinguish Risky Users data from Risk Detections data which have "riskEventType" field<br />\| json "activity", "activityDateTime", "detectedDateTime", "detectionTimingType", "id", "ipAddress", "lastUpdatedDateTime", "location", "location.geoCoordinates.latitude", "location.geoCoordinates.longitude", "riskDetail", "riskEventType", "riskLevel", "riskState", "source", "tokenIssuerType", "userPrincipalName", "userId" as activity, activity\_date\_time, detected\_date\_time, detection\_timing\_type, risk\_id, ip\_address, last\_updated\_date\_time, location, latitude, longitude, risk\_action, risk\_event\_type, risk\_level, risk\_state, source, token\_issuer\_type, user, user\_id nodrop<br />\| concat(location.city, ", ", location.state, ", ", location.countryOrRegion) as location<br />\| topk(1, last\_updated\_date\_time) by risk\_id // Consider only most recent details of the risk.<br /><br />// Apply global filters.<br />\| where activity matches "{{activity}}"<br />\| where risk\_event\_type matches "{{risk\_event\_type}}"<br />\| where risk\_level matches "{{risk\_level}}"<br />\| where risk\_state matches "{{risk\_state}}"<br />\| where risk\_action matches "{{risk\_action}}"<br />\| where location matches "{{location}}"<br /><br />\| count(risk\_id) by risk\_state<br />\| sort by \_count|
|Microsoft Graph Identity Protection|Risk by Token Issuer Type|Logs|Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections|\_sourceCategory={{Logsdatasource}}   riskEventType // Distinguish Risky Users data from Risk Detections data which have "riskEventType" field<br />\| json "activity", "activityDateTime", "detectedDateTime", "detectionTimingType", "id", "ipAddress", "lastUpdatedDateTime", "location", "location.geoCoordinates.latitude", "location.geoCoordinates.longitude", "riskDetail", "riskEventType", "riskLevel", "riskState", "source", "tokenIssuerType", "userPrincipalName", "userId" as activity, activity\_date\_time, detected\_date\_time, detection\_timing\_type, risk\_id, ip\_address, last\_updated\_date\_time, location, latitude, longitude, risk\_action, risk\_event\_type, risk\_level, risk\_state, source, token\_issuer\_type, user, user\_id nodrop<br />\| concat(location.city, ", ", location.state, ", ", location.countryOrRegion) as location<br />\| topk(1, last\_updated\_date\_time) by risk\_id // Consider only most recent details of the risk.<br /><br />// Apply global filters.<br />\| where activity matches "{{activity}}"<br />\| where risk\_event\_type matches "{{risk\_event\_type}}"<br />\| where risk\_level matches "{{risk\_level}}"<br />\| where risk\_state matches "{{risk\_state}}"<br />\| where risk\_action matches "{{risk\_action}}"<br />\| where location matches "{{location}}"<br /><br />\| count(risk\_id) by token\_issuer\_type<br />\| sort by \_count|
|Microsoft Graph Identity Protection|Risk Detections Summary|Logs|Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections|\_sourceCategory={{Logsdatasource}}   riskEventType // Distinguish Risky Users data from Risk Detections data which have "riskEventType" field<br />\| json "activity", "activityDateTime", "detectedDateTime", "detectionTimingType", "id", "ipAddress", "lastUpdatedDateTime", "location", "location.geoCoordinates.latitude", "location.geoCoordinates.longitude", "riskDetail", "riskEventType", "riskLevel", "riskState", "source", "tokenIssuerType", "userPrincipalName", "userId" as activity, activity\_date\_time, detected\_date\_time, detection\_timing\_type, risk\_id, ip\_address, last\_updated\_date\_time, location, latitude, longitude, risk\_action, risk\_event\_type, risk\_level, risk\_state, source, token\_issuer\_type, user, user\_id nodrop<br />\| concat(location.city, ", ", location.state, ", ", location.countryOrRegion) as location<br />\| topk(1, last\_updated\_date\_time) by risk\_id // Consider only most recent details of the risk.<br /><br />// Apply global filters.<br />\| where activity matches "{{activity}}"<br />\| where risk\_event\_type matches "{{risk\_event\_type}}"<br />\| where risk\_level matches "{{risk\_level}}"<br />\| where risk\_state matches "{{risk\_state}}"<br />\| where risk\_action matches "{{risk\_action}}"<br />\| where location matches "{{location}}"<br /><br />\| count by risk\_id, user, activity, ip\_address, location, risk\_event\_type, risk\_level, risk\_state, risk\_action, last\_updated\_date\_time<br />\| sort by last\_updated\_date\_time<br />\| fields - risk\_id, \_count|
|Microsoft Graph Identity Protection|Risk Level Over Time|Logs|Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections|\_sourceCategory={{Logsdatasource}}   riskEventType // Distinguish Risky Users data from Risk Detections data which have "riskEventType" field<br />\| json "activity", "activityDateTime", "detectedDateTime", "detectionTimingType", "id", "ipAddress", "lastUpdatedDateTime", "location", "location.geoCoordinates.latitude", "location.geoCoordinates.longitude", "riskDetail", "riskEventType", "riskLevel", "riskState", "source", "tokenIssuerType", "userPrincipalName", "userId" as activity, activity\_date\_time, detected\_date\_time, detection\_timing\_type, risk\_id, ip\_address, last\_updated\_date\_time, location, latitude, longitude, risk\_action, risk\_event\_type, risk\_level, risk\_state, source, token\_issuer\_type, user, user\_id nodrop<br />\| concat(location.city, ", ", location.state, ", ", location.countryOrRegion) as location<br />\| topk(1, last\_updated\_date\_time) by risk\_id // Consider only most recent details of the risk.<br /><br />// Apply global filters.<br />\| where activity matches "{{activity}}"<br />\| where risk\_event\_type matches "{{risk\_event\_type}}"<br />\| where risk\_level matches "{{risk\_level}}"<br />\| where risk\_state matches "{{risk\_state}}"<br />\| where risk\_action matches "{{risk\_action}}"<br />\| where location matches "{{location}}"<br /><br />\| timeslice 1d<br />\| fillmissing timeslice, values all in risk\_level<br />\| count(risk\_id) as risk\_count by \_timeslice, risk\_level<br />\| transpose row \_timeslice column risk\_level|
|Microsoft Graph Identity Protection|Risky Users by Level|Logs|Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risky Users|\_sourceCategory={{Logsdatasource}}   !riskEventType // Distinguish Risky Users data from Risk Detections data which have "riskEventType" field<br />\| json "id", "userPrincipalName", "isDeleted", "isProcessing", "riskLevel", "riskState", "riskDetail", "riskLastUpdatedDateTime" as user\_id, user, is\_deleted, is\_processing, risk\_level, risk\_state, risk\_action, risk\_last\_updated\_date\_time nodrop<br />\| topk(1, risk\_last\_updated\_date\_time) by user\_id // Consider only most recent risk details of the user.<br /><br />// Apply global filters.<br />\| "{{user\_status}}" as user\_status\_filter<br />\| if(user\_status\_filter matches "active", "false", user\_status\_filter) as user\_status\_filter<br />\| if(user\_status\_filter matches "deleted", "true", user\_status\_filter) as user\_status\_filter<br />\| where is\_deleted matches user\_status\_filter<br />\| "{{processing\_state}}" as processing\_state\_filter<br />\| if(processing\_state\_filter matches "processing", "true", processing\_state\_filter) as processing\_state\_filter<br />\| if(processing\_state\_filter matches "not processing", "false", processing\_state\_filter) as processing\_state\_filter<br />\| where is\_processing matches processing\_state\_filter<br />\| where risk\_level matches "{{risk\_level}}"<br />\| where risk\_state matches "{{risk\_state}}"<br />\| where risk\_action matches "{{risk\_action}}"<br /><br />\| count(user\_id) by risk\_level<br />\| sort by \_count|
|Microsoft Graph Identity Protection|Risky Users by Processing State|Logs|Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risky Users|\_sourceCategory={{Logsdatasource}}   !riskEventType // Distinguish Risky Users data from Risk Detections data which have "riskEventType" field<br />\| json "id", "userPrincipalName", "isDeleted", "isProcessing", "riskLevel", "riskState", "riskDetail", "riskLastUpdatedDateTime" as user\_id, user, is\_deleted, is\_processing, risk\_level, risk\_state, risk\_action, risk\_last\_updated\_date\_time nodrop<br />\| topk(1, risk\_last\_updated\_date\_time) by user\_id // Consider only most recent risk details of the user.<br /><br />// Apply global filters.<br />\| "{{user\_status}}" as user\_status\_filter<br />\| if(user\_status\_filter matches "active", "false", user\_status\_filter) as user\_status\_filter<br />\| if(user\_status\_filter matches "deleted", "true", user\_status\_filter) as user\_status\_filter<br />\| where is\_deleted matches user\_status\_filter<br />\| "{{processing\_state}}" as processing\_state\_filter<br />\| if(processing\_state\_filter matches "processing", "true", processing\_state\_filter) as processing\_state\_filter<br />\| if(processing\_state\_filter matches "not processing", "false", processing\_state\_filter) as processing\_state\_filter<br />\| where is\_processing matches processing\_state\_filter<br />\| where risk\_level matches "{{risk\_level}}"<br />\| where risk\_state matches "{{risk\_state}}"<br />\| where risk\_action matches "{{risk\_action}}"<br /><br />\| if(is\_processing matches "true", "processing", "not processing") as processing\_state<br />\| count(user\_id) by processing\_state<br />\| sort by \_count|
|Microsoft Graph Identity Protection|Risky Users by State|Logs|Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risky Users|\_sourceCategory={{Logsdatasource}}   !riskEventType // Distinguish Risky Users data from Risk Detections data which have "riskEventType" field<br />\| json "id", "userPrincipalName", "isDeleted", "isProcessing", "riskLevel", "riskState", "riskDetail", "riskLastUpdatedDateTime" as user\_id, user, is\_deleted, is\_processing, risk\_level, risk\_state, risk\_action, risk\_last\_updated\_date\_time nodrop<br />\| topk(1, risk\_last\_updated\_date\_time) by user\_id // Consider only most recent risk details of the user.<br /><br />// Apply global filters.<br />\| "{{user\_status}}" as user\_status\_filter<br />\| if(user\_status\_filter matches "active", "false", user\_status\_filter) as user\_status\_filter<br />\| if(user\_status\_filter matches "deleted", "true", user\_status\_filter) as user\_status\_filter<br />\| where is\_deleted matches user\_status\_filter<br />\| "{{processing\_state}}" as processing\_state\_filter<br />\| if(processing\_state\_filter matches "processing", "true", processing\_state\_filter) as processing\_state\_filter<br />\| if(processing\_state\_filter matches "not processing", "false", processing\_state\_filter) as processing\_state\_filter<br />\| where is\_processing matches processing\_state\_filter<br />\| where risk\_level matches "{{risk\_level}}"<br />\| where risk\_state matches "{{risk\_state}}"<br />\| where risk\_action matches "{{risk\_action}}"<br /><br />\| count(user\_id) by risk\_state<br />\| sort by \_count|
|Microsoft Graph Identity Protection|Risky Users by Status|Logs|Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risky Users|\_sourceCategory={{Logsdatasource}}   !riskEventType // Distinguish Risky Users data from Risk Detections data which have "riskEventType" field<br />\| json "id", "userPrincipalName", "isDeleted", "isProcessing", "riskLevel", "riskState", "riskDetail", "riskLastUpdatedDateTime" as user\_id, user, is\_deleted, is\_processing, risk\_level, risk\_state, risk\_action, risk\_last\_updated\_date\_time nodrop<br />\| topk(1, risk\_last\_updated\_date\_time) by user\_id // Consider only most recent risk details of the user.<br /><br />// Apply global filters.<br />\| "{{user\_status}}" as user\_status\_filter<br />\| if(user\_status\_filter matches "active", "false", user\_status\_filter) as user\_status\_filter<br />\| if(user\_status\_filter matches "deleted", "true", user\_status\_filter) as user\_status\_filter<br />\| where is\_deleted matches user\_status\_filter<br />\| "{{processing\_state}}" as processing\_state\_filter<br />\| if(processing\_state\_filter matches "processing", "true", processing\_state\_filter) as processing\_state\_filter<br />\| if(processing\_state\_filter matches "not processing", "false", processing\_state\_filter) as processing\_state\_filter<br />\| where is\_processing matches processing\_state\_filter<br />\| where risk\_level matches "{{risk\_level}}"<br />\| where risk\_state matches "{{risk\_state}}"<br />\| where risk\_action matches "{{risk\_action}}"<br /><br />\| if(is\_deleted matches "true", "deleted", "active") as user\_status<br />\| count(user\_id) by user\_status<br />\| sort by \_count|
|Microsoft Graph Identity Protection|Risky Users Summary|Logs|Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risky Users|\_sourceCategory={{Logsdatasource}}   !riskEventType // Distinguish Risky Users data from Risk Detections data which have "riskEventType" field<br />\| json "id", "userPrincipalName", "isDeleted", "isProcessing", "riskLevel", "riskState", "riskDetail", "riskLastUpdatedDateTime" as user\_id, user, is\_deleted, is\_processing, risk\_level, risk\_state, risk\_action, risk\_last\_updated\_date\_time nodrop<br />\| topk(1,risk\_last\_updated\_date\_time) by user\_id // Consider only most recent risk details of the user.<br /><br />// Apply global filters.<br />\| "{{user\_status}}" as user\_status\_filter<br />\| if(user\_status\_filter matches "active", "false", user\_status\_filter) as user\_status\_filter<br />\| if(user\_status\_filter matches "deleted", "true", user\_status\_filter) as user\_status\_filter<br />\| where is\_deleted matches user\_status\_filter<br />\| "{{processing\_state}}" as processing\_state\_filter<br />\| if(processing\_state\_filter matches "processing", "true", processing\_state\_filter) as processing\_state\_filter<br />\| if(processing\_state\_filter matches "not processing", "false", processing\_state\_filter) as processing\_state\_filter<br />\| where is\_processing matches processing\_state\_filter<br />\| where risk\_level matches "{{risk\_level}}"<br />\| where risk\_state matches "{{risk\_state}}"<br />\| where risk\_action matches "{{risk\_action}}"<br /><br />\| if(is\_deleted matches "true", "deleted", "active") as user\_status<br />\| if(is\_processing matches "true", "processing", "not processing") as processing\_state<br />\| count by user\_id, user, user\_status, risk\_state, risk\_level, risk\_action, risk\_last\_updated\_date\_time, processing\_state<br />\| sort by risk\_last\_updated\_date\_time<br />\| fields - \_count, user\_id|
|Microsoft Graph Identity Protection|Risky Users Trend by Level|Logs|Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risky Users|\_sourceCategory={{Logsdatasource}}   !riskEventType // Distinguish Risky Users data from Risk Detections data which have "riskEventType" field<br />\| json "id", "userPrincipalName", "isDeleted", "isProcessing", "riskLevel", "riskState", "riskDetail", "riskLastUpdatedDateTime" as user\_id, user, is\_deleted, is\_processing, risk\_level, risk\_state, risk\_action, risk\_last\_updated\_date\_time nodrop<br />\| topk(1, risk\_last\_updated\_date\_time) by user\_id // Consider only most recent risk details of the user.<br /><br />// Apply global filters.<br />\| "{{user\_status}}" as user\_status\_filter<br />\| if(user\_status\_filter matches "active", "false", user\_status\_filter) as user\_status\_filter<br />\| if(user\_status\_filter matches "deleted", "true", user\_status\_filter) as user\_status\_filter<br />\| where is\_deleted matches user\_status\_filter<br />\| "{{processing\_state}}" as processing\_state\_filter<br />\| if(processing\_state\_filter matches "processing", "true", processing\_state\_filter) as processing\_state\_filter<br />\| if(processing\_state\_filter matches "not processing", "false", processing\_state\_filter) as processing\_state\_filter<br />\| where is\_processing matches processing\_state\_filter<br />\| where risk\_level matches "{{risk\_level}}"<br />\| where risk\_state matches "{{risk\_state}}"<br />\| where risk\_action matches "{{risk\_action}}"<br /><br />\| timeslice 1d<br />\| fillmissing timeslice, values all in risk\_level<br />\| count(user\_id) as user\_count by \_timeslice, risk\_level<br />\| transpose row \_timeslice column risk\_level|
|Microsoft Graph Identity Protection|Top 10 Sources of Risk|Logs|Installed Apps/Microsoft Graph Identity Protection/Microsoft Graph Identity Protection - Risk Detections|\_sourceCategory={{Logsdatasource}}   riskEventType // Distinguish Risky Users data from Risk Detections data which have "riskEventType" field<br />\| json "activity", "activityDateTime", "detectedDateTime", "detectionTimingType", "id", "ipAddress", "lastUpdatedDateTime", "location", "location.geoCoordinates.latitude", "location.geoCoordinates.longitude", "riskDetail", "riskEventType", "riskLevel", "riskState", "source", "tokenIssuerType", "userPrincipalName", "userId" as activity, activity\_date\_time, detected\_date\_time, detection\_timing\_type, risk\_id, ip\_address, last\_updated\_date\_time, location, latitude, longitude, risk\_action, risk\_event\_type, risk\_level, risk\_state, source, token\_issuer\_type, user, user\_id nodrop<br />\| concat(location.city, ", ", location.state, ", ", location.countryOrRegion) as location<br />\| topk(1, last\_updated\_date\_time) by risk\_id // Consider only most recent details of the risk.<br /><br />// Apply global filters.<br />\| where activity matches "{{activity}}"<br />\| where risk\_event\_type matches "{{risk\_event\_type}}"<br />\| where risk\_level matches "{{risk\_level}}"<br />\| where risk\_state matches "{{risk\_state}}"<br />\| where risk\_action matches "{{risk\_action}}"<br />\| where location matches "{{location}}"<br /><br />\| count(risk\_id) as frequency by source<br />\| sort by frequency<br />\| limit 10|

