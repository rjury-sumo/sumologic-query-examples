# Amazon VPC Flow - Cloud Security Monitoring and Analytics

## Searches

### Log Searches

- **Bytes Accepted by Destination Port**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects 
- **Bytes Accepted by Transport Protocol**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects 
- **Bytes Accepted Comparison for Last 3 Days**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Destination Address Locations**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Destination ASN by TCP Destination Port**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects 
- **Destination ASN Bytes by Destination Port**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Destination IP Bytes by InterfaceID**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Destination Port by InterfaceID**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Destination Port by InterfaceID**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Flows Rejected by AccountID**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects 
- **Flows Rejected by Destination Port**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects 
- **Flows Rejected by InterfaceID**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects 
- **Flows Rejected Comparison for Last 3 Days**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Geo Location of Threat Intel Destinations with Accepted Flow Logs**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Geo Location of Threat Intel Sources with Accepted Flow Logs**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Geo Location of Threats with Accepted Flow Logs**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects 
- **Geo Location of Threats with Inbound Accepted Flows**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring 
- **Geo Location of Threats with Outbound Accepted Flows**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring 
- **Geo Location of Threats with Rejected Flow Logs**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects 
- **Inbound Accepted Flows**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring 
- **Inbound Rejected Flows**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring 
- **Inbound Top 10 dstDevice_ip by MB**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring 
- **Inbound Top 10 srcDevice_ip by MB**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring 
- **Outbound Accepted Flows**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring 
- **Outbound Rejected Flows**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring 
- **Outbound Top 10 dstDevice_ip by MB**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring 
- **Outbound Top 10 srcDevice_ip by MB**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring 
- **Rejects by InterfaceID, dstDevice_ip**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Source Address Locations**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Threat Intel Destinations Over Time by Action**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Threat Intel Sources Over Time by Action**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Threats Associated with Accepted Flow Logs**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects 
- **Threats Associated with Rejected Flow Logs**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects 
- **Top 10 Inbound Destination Ports by Flow Records**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring 
- **Top 10 Outbound Destination Ports by Flow Records**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring 
- **Top TCP Destination Ports by ASN Organization**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Top10 AccountIDs by Bytes**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Top10 Rejected TCP Destination Ports**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Top10 TCP Destination Ports**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Top10 TCP Destination Ports**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Top20 Accepted by dstDevice_ip**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects 
- **Top20 Accepted by srcDevice_ip**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects 
- **Top20 InterfaceID by Bytes**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Top20 Rejected by dstDevice_ip**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects 
- **Top20 Rejected by srcDevice_ip**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects 
- **Total Accepted Flow Records**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Total Hits from Threat Intel Source**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Total Hits to Threat Intel Destination**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview 
- **Total Rejected Flow Records**: from Dashboard: Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Bytes Accepted by Destination Port|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects|\_sourceCategory = Labs/AWS/VPC\* ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version, accountID, interfaceID, srcDevice\_ip, dstDevice\_ip, src\_port, dest\_port, Protocol, packets, bytes, start, end, action, log\_status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where action="ACCEPT"<br />\| timeslice 5m<br />\| sum(bytes) as total\_bytes by \_timeslice,dest\_port<br />\| transpose row \_timeslice column dest\_port|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Bytes Accepted by Transport Protocol|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects|\_sourceCategory = Labs/AWS/VPC\* ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version, accountID, interfaceID, srcDevice\_ip, dstDevice\_ip, src\_port, dest\_port, Protocol, packets, bytes, start, end, action, log\_status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where action="ACCEPT"<br />\| sum(bytes) by protocol \| protocol as Protocol\_Val<br />\| lookup Keyword from https://s3.amazonaws.com/sumologic-app-data/protocol-numbers.csv on Decimal=Protocol\_val <br />\| if (isNull(keyword), Protocol\_val, Keyword) as Protocol \| fields -keyword, protocol\_val <br />|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Bytes Accepted Comparison for Last 3 Days|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\* ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where Action="ACCEPT" <br />\| timeslice 5m<br />\| sum(bytes) as total\_bytes by \_timeslice <br />\| compare with timeshift 1d 3|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Destination Address Locations|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\* ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where Action="ACCEPT" and dstDevice\_ip != "-"<br />\| count by dstDevice\_ip<br />\| where isPublicIP(dstDevice\_ip)<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = dstDevice\_ip|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Destination ASN by TCP Destination Port|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects|\_sourceCategory = Labs/AWS/VPC\* ACCEPT 6 <br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version, accountID, interfaceID, srcDevice\_ip, dstDevice\_ip, src\_port, dest\_port, Protocol, packets, bytes, start, end,action,log\_status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where Action="ACCEPT" and Protocol="6" and dstDevice\_ip != "-"<br />\| where isPublicIP(dstDevice\_ip)<br />\| lookup asn from asn://default on ip=dstDevice\_ip<br />\| count as dest\_port\_count by asn,dest\_port|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Destination ASN Bytes by Destination Port|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\* ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version, accountID, interfaceID, srcDevice\_ip, dstDevice\_ip, src\_port, dest\_port, Protocol, packets, bytes, start, end,action,log\_status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where Action="ACCEPT" and dstDevice\_ip \<\> "-"<br />\| where isPublicIP(dstDevice\_ip)<br />\| lookup asn from asn://default on ip=dstDevice\_ip<br />\| sum(bytes) as dest\_port\_bytes by asn,dest\_port|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Destination IP Bytes by InterfaceID|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\*   ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where dstDevice\_ip != "-"<br />\| where srcDevice\_ip != "-"<br />\| where Action="ACCEPT" and IsPrivateIP(dstDevice\_ip) and isPrivateIP(srcDevice\_ip)<br />\| sum(bytes) as bytes\_sum by interfaceID, dstDevice\_ip<br />\| sort by bytes\_sum|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Destination Port by InterfaceID|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\*   ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where dstDevice\_ip != "-"<br />\| where srcDevice\_ip != "-"<br />\| where Action="ACCEPT" and IsPrivateIP(dstDevice\_ip) and isPrivateIP(srcDevice\_ip)<br />\| count by interfaceID, dest\_port<br />\| sort by \_count|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Destination Port by InterfaceID|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\*   ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where dstDevice\_ip != "-"<br />\| where Action="ACCEPT" and IsPublicIP(dstDevice\_ip)<br />\| count by interfaceID, dest\_port<br />\| sort by \_count|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Flows Rejected by AccountID|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects|\_sourceCategory = Labs/AWS/VPC\* REJECT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where action="REJECT" <br />\| count as Records by accountid<br />\| sort by Records|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Flows Rejected by Destination Port|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects|\_sourceCategory = Labs/AWS/VPC\* REJECT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version, accountID, interfaceID, srcDevice\_ip, dstDevice\_ip, src\_port, dest\_port, Protocol, packets, bytes, start, end, action, log\_status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where action="REJECT"<br />\| timeslice 5m<br />\| sum(packets) as total\_packets by \_timeslice,dest\_port<br />\| transpose row \_timeslice column dest\_port|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Flows Rejected by InterfaceID|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects|\_sourceCategory = Labs/AWS/VPC\* REJECT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where action="REJECT" <br />\| count as Records by interfaceID<br />\| sort by Records|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Flows Rejected Comparison for Last 3 Days|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\* REJECT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where Action="REJECT" <br />\| timeslice 5m<br />\| sum(Packets) as total\_records by \_timeslice <br />\| compare with timeshift 1d 3|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Geo Location of Threat Intel Destinations with Accepted Flow Logs|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\* ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where dstDevice\_ip != "-"<br />\| where action="ACCEPT" and isPublicIP(dstDevice\_ip)<br />\| count by dstDevice\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence, threat from sumo://threat/cs on threat=dstDevice\_ip<br />\| where type="ip\_address"<br />\| json field=raw "malware\_families[\*]" as threat\_malware\_families nodrop<br />\| json field=raw "last\_updated" as last\_updated nodrop<br />\| formatDate(fromseconds(last\_updated), "MM-dd-yyyy") as threat\_last\_updated <br />\| json field=raw "labels[\*].name" as label\_name nodrop<br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip=dstDevice\_ip<br />\| sum(\_count) as \_count by latitude, longitude, label\_name, threat\_last\_updated<br />\| where !isNull(latitude)|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Geo Location of Threat Intel Sources with Accepted Flow Logs|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\* ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where srcDevice\_ip != "-"<br />\| where action="ACCEPT" and isPublicIP(srcDevice\_ip)<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| count by srcDevice\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence, threat from sumo://threat/cs on threat=srcDevice\_ip<br />\| where type="ip\_address"<br />\| json field=raw "malware\_families[\*]" as threat\_malware\_families nodrop<br />\| json field=raw "last\_updated" as last\_updated nodrop<br />\| formatDate(fromseconds(last\_updated), "MM-dd-yyyy") as threat\_last\_updated <br />\| json field=raw "labels[\*].name" as label\_name nodrop<br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip=srcDevice\_ip<br />\| sum(\_count) as \_count by latitude, longitude, label\_name, threat\_last\_updated<br />\| where !isNull(latitude)|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Geo Location of Threats with Accepted Flow Logs|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects|\_sourceCategory = Labs/AWS/VPC\* ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where srcDevice\_ip != "-"<br />\| where action="ACCEPT" and isPublicIP(srcDevice\_ip)<br />\| count by srcDevice\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence, threat from sumo://threat/cs on threat=srcDevice\_ip<br />\| where type="ip\_address"<br />\| json field=raw "malware\_families[\*]" as threat\_malware\_families nodrop<br />\| json field=raw "last\_updated" as last\_updated nodrop<br />\| formatDate(fromseconds(last\_updated), "MM-dd-yyyy") as threat\_last\_updated <br />\| json field=raw "labels[\*].name" as label\_name nodrop<br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip=srcDevice\_ip<br />\| sum(\_count) as \_count by latitude, longitude, label\_name, threat\_last\_updated<br />\| where !isNull(latitude)|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Geo Location of Threats with Inbound Accepted Flows|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring|\_sourceCategory = Labs/AWS/VPC\* ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where action="ACCEPT" and srcDevice\_ip != "-" and isPublicIP(srcDevice\_ip)<br />\| count by srcDevice\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence, threat from sumo://threat/cs on threat=srcDevice\_ip<br />\| where type="ip\_address"<br />\| json field=raw "malware\_families[\*]" as threat\_malware\_families nodrop<br />\| json field=raw "last\_updated" as last\_updated nodrop<br />\| formatDate(fromseconds(last\_updated), "MM-dd-yyyy") as threat\_last\_updated <br />\| json field=raw "labels[\*].name" as label\_name nodrop<br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip=srcDevice\_ip<br />\| sum(\_count) as \_count by latitude, longitude, label\_name, threat\_last\_updated<br />\| where !isNull(latitude)|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Geo Location of Threats with Outbound Accepted Flows|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring|\_sourceCategory = Labs/AWS/VPC\* ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where dstDevice\_ip != "-"<br />\| where action="ACCEPT" and isPublicIP(dstDevice\_ip)<br />\| count by srcDevice\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence, threat from sumo://threat/cs on threat=srcDevice\_ip<br />\| where type="ip\_address"<br />\| json field=raw "malware\_families[\*]" as threat\_malware\_families nodrop<br />\| json field=raw "last\_updated" as last\_updated nodrop<br />\| formatDate(fromseconds(last\_updated), "MM-dd-yyyy") as threat\_last\_updated <br />\| json field=raw "labels[\*].name" as label\_name nodrop<br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip=srcDevice\_ip<br />\| sum(\_count) as \_count by latitude, longitude, label\_name, threat\_last\_updated<br />\| where !isNull(latitude)|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Geo Location of Threats with Rejected Flow Logs|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects|\_sourceCategory = Labs/AWS/VPC\* REJECT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where srcDevice\_ip != "-"<br />\| where action="REJECT" and isPublicIP(srcDevice\_ip)<br />\| count by srcDevice\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence, threat from sumo://threat/cs on threat=srcDevice\_ip<br />\| where type="ip\_address"<br />\| json field=raw "malware\_families[\*]" as threat\_malware\_families nodrop<br />\| json field=raw "last\_updated" as last\_updated nodrop<br />\| formatDate(fromseconds(last\_updated), "MM-dd-yyyy") as threat\_last\_updated <br />\| json field=raw "labels[\*].name" as label\_name nodrop<br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip=srcDevice\_ip<br />\| sum(\_count) as \_count by latitude, longitude, label\_name, threat\_last\_updated<br />\| where !isNull(latitude)|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Inbound Accepted Flows|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring|\_sourceCategory = Labs/AWS/VPC\* ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where srcDevice\_ip !="-"<br />\| where Action="ACCEPT" and IsPublicIP(srcDevice\_ip)<br />\| timeslice 5m<br />\| count by \_timeslice<br />\| sort \_timeslice|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Inbound Rejected Flows|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring|\_sourceCategory = Labs/AWS/VPC\* REJECT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where srcDevice\_ip !="-"<br />\| where Action="REJECT" and IsPublicIP(srcDevice\_ip)<br />\| timeslice 5m<br />\| count by \_timeslice<br />\| sort \_timeslice|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Inbound Top 10 dstDevice\_ip by MB|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring|\_sourceCategory = Labs/AWS/VPC\* <br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where srcDevice\_ip != "-"<br />\| where isPublicIP(srcDevice\_ip)<br />\| sum(bytes) as bytes by dstDevice\_ip \| bytes/(1024\*1024) as MB<br />\| top 10 dstDevice\_ip by MB|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Inbound Top 10 srcDevice\_ip by MB|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring|\_sourceCategory = Labs/AWS/VPC\* <br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where srcDevice\_ip != "-"<br />\| where isPublicIP(srcDevice\_ip)<br />\| sum(bytes) as bytes by srcDevice\_ip \| bytes/(1024\*1024) as MB<br />\| top 10 srcDevice\_ip by MB|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Outbound Accepted Flows|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring|\_sourceCategory = Labs/AWS/VPC\* ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where dstDevice\_ip !="-"<br />\| where Action="ACCEPT" and IsPublicIP(dstDevice\_ip)<br />\| timeslice 5m<br />\| count by \_timeslice<br />\| sort \_timeslice|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Outbound Rejected Flows|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring|\_sourceCategory = Labs/AWS/VPC\* REJECT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where dstDevice\_ip !="-"<br />\| where Action="REJECT" and IsPublicIP(dstDevice\_ip)<br />\| timeslice 5m<br />\| count by \_timeslice<br />\| sort \_timeslice|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Outbound Top 10 dstDevice\_ip by MB|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring|\_sourceCategory = Labs/AWS/VPC\* <br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where dstDevice\_ip != "-"<br />\| where isPublicIP(dstDevice\_ip)<br />\| sum(bytes) as bytes by dstDevice\_ip \| bytes/(1024\*1024) as MB<br />\| top 10 dstDevice\_ip by MB|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Outbound Top 10 srcDevice\_ip by MB|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring|\_sourceCategory = Labs/AWS/VPC\* <br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where dstDevice\_ip != "-"<br />\| where isPublicIP(dstDevice\_ip)<br />\| sum(bytes) as bytes by srcDevice\_ip \| bytes/(1024\*1024) as MB<br />\| top 10 srcDevice\_ip by MB|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Rejects by InterfaceID, dstDevice\_ip|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\*  REJECT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where Action="REJECT" <br />\| count by interfaceID, dstDevice\_ip<br />\| sort by \_count|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Source Address Locations|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\* ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where Action="ACCEPT" and srcDevice\_ip != "-"<br />\| count by srcDevice\_ip<br />\| where isPublicIP(srcDevice\_ip)<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = srcDevice\_ip|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Threat Intel Destinations Over Time by Action|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\* <br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| timeslice 5m<br />\| count by \_timeslice, dstDevice\_ip, action<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence, threat from sumo://threat/cs on threat=dstDevice\_ip<br />\| where type="ip\_address"<br />\| json field=raw "malware\_families[\*]" as threat\_malware\_families nodrop<br />\| json field=raw "last\_updated" as last\_updated nodrop<br />\| formatDate(fromseconds(last\_updated), "MM-dd-yyyy") as threat\_last\_updated <br />\| json field=raw "labels[\*].name" as label\_name nodrop<br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| sum(\_count) as count by \_timeslice, Action<br />\| transpose row \_timeslice column Action|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Threat Intel Sources Over Time by Action|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\* <br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| timeslice 5m<br />\| count by \_timeslice, srcDevice\_ip, action<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence, threat from sumo://threat/cs on threat=srcDevice\_ip<br />\| where type="ip\_address" <br />\| json field=raw "malware\_families[\*]" as threat\_malware\_families nodrop<br />\| json field=raw "last\_updated" as last\_updated nodrop<br />\| formatDate(fromseconds(last\_updated), "MM-dd-yyyy") as threat\_last\_updated <br />\| json field=raw "labels[\*].name" as label\_name nodrop<br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| sum(\_count) as count by \_timeslice, Action<br />\| transpose row \_timeslice column Action|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Threats Associated with Accepted Flow Logs|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects|\_sourceCategory = Labs/AWS/VPC\* ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where action="ACCEPT"<br />\| count by srcDevice\_ip, src\_port, dstDevice\_ip, dest\_port, interfaceID, accountID, Protocol<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence, threat from sumo://threat/cs on threat=srcDevice\_ip<br />\| where type="ip\_address" <br />\| json field=raw "malware\_families[\*]" as threat\_malware\_families nodrop<br />\| json field=raw "last\_updated" as last\_updated nodrop<br />\| formatDate(fromseconds(last\_updated), "MM-dd-yyyy") as threat\_last\_updated <br />\| json field=raw "labels[\*].name" as label\_name nodrop<br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| concat ( srcDevice\_ip," : ", src\_port) as src<br />\| concat ( dstDevice\_ip," : ", dest\_port) as dest<br />\| sum(\_count) as count by interfaceID, accountID, src, dest, Protocol, malicious\_confidence, label\_name, threat\_malware\_families, threat\_last\_updated<br />\|where malicious\_confidence matches "high"|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Threats Associated with Rejected Flow Logs|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects|\_sourceCategory = Labs/AWS/VPC\* REJECT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where action="REJECT"<br />\| count by srcDevice\_ip, src\_port, dstDevice\_ip, dest\_port, interfaceID, accountID, Protocol<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence, threat from sumo://threat/cs on threat=srcDevice\_ip<br />\| where type="ip\_address" <br />\| json field=raw "malware\_families[\*]" as threat\_malware\_families nodrop<br />\| json field=raw "last\_updated" as last\_updated nodrop<br />\| formatDate(fromseconds(last\_updated), "MM-dd-yyyy") as threat\_last\_updated <br />\| json field=raw "labels[\*].name" as label\_name nodrop<br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| concat ( srcDevice\_ip," : ", src\_port) as src<br />\| concat ( dstDevice\_ip," : ", dest\_port) as dest<br />\| sum(\_count) as count by interfaceID, accountID, src, dest, Protocol, malicious\_confidence, label\_name, threat\_malware\_families, threat\_last\_updated<br />\|where malicious\_confidence matches "high"|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Top 10 Inbound Destination Ports by Flow Records|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring|\_sourceCategory = Labs/AWS/VPC\* <br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where srcDevice\_ip != "-"<br />\| where IsPublicIP(srcDevice\_ip)<br />\| where dest\_port != "-"<br />\| count as Records by dest\_port \| top 10 dest\_port by Records|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Top 10 Outbound Destination Ports by Flow Records|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Traffic Direction Monitoring|\_sourceCategory = Labs/AWS/VPC\* <br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where dstDevice\_ip != "-"<br />\| where IsPublicIP(dstDevice\_ip)<br />\| where dest\_port != "-"<br />\| count as Records by dest\_port \| top 10 dest\_port by Records|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Top TCP Destination Ports by ASN Organization|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\* ACCEPT 6 <br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version, accountID, interfaceID, srcDevice\_ip, dstDevice\_ip, src\_port, dest\_port, Protocol, packets, bytes, start, end,action,log\_status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where Action="ACCEPT" and Protocol="6"<br />\| where dstDevice\_ip != "-"<br />\| where srcDevice\_ip != "-"<br />\| where isPublicIP(dstDevice\_ip) and isPrivateIP(srcDevice\_ip)<br />\| lookup asn,organization from asn://default on ip=dstDevice\_ip<br />\| count as dest\_port\_count by asn,organization,dest\_port<br />\| sort by dest\_port\_count|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Top10 AccountIDs by Bytes|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\* ACCEPT 6 <br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version, accountID, interfaceID, srcDevice\_ip, dstDevice\_ip, src\_port, dest\_port, Protocol, packets, bytes, start, end,action,log\_status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where Action="ACCEPT" and Protocol="6"<br />\| where dstDevice\_ip != "-"<br />\| where srcDevice\_ip != "-"<br />\| where isPublicIP(dstDevice\_ip) or isPublicIP(srcDevice\_ip)<br />\| sum(bytes) as account\_id\_bytes by accountID|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Top10 Rejected TCP Destination Ports|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\* REJECT 6 <br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version, accountID, interfaceID, srcDevice\_ip, dstDevice\_ip, src\_port, dest\_port, Protocol, packets, bytes, start, end,action,log\_status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where Action="REJECT" and Protocol="6"<br />\| where dstDevice\_ip != "-"<br />\| where isPublicIP(dstDevice\_ip) <br />\| count as dest\_port\_count by dest\_port<br />\| sort by dest\_port\_count|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Top10 TCP Destination Ports|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\* ACCEPT 6 <br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version, accountID, interfaceID, srcDevice\_ip, dstDevice\_ip, src\_port, dest\_port, Protocol, packets, bytes, start, end,action,log\_status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where Action="ACCEPT" and Protocol="6" and isPrivateIP(dstDevice\_ip) and isPrivateIP(srcDevice\_ip)<br />\| count as dest\_port\_count by dest\_port|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Top10 TCP Destination Ports|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\* ACCEPT 6 <br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version, accountID, interfaceID, srcDevice\_ip, dstDevice\_ip, src\_port, dest\_port, Protocol, packets, bytes, start, end,action,log\_status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where Action="ACCEPT" and Protocol="6" and dstDevice\_ip \<\> "-"<br />\| where isPublicIP(dstDevice\_ip) <br />\| count as dest\_port\_count by dest\_port<br />\| sort by dest\_port\_count|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Top20 Accepted by dstDevice\_ip|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects|\_sourceCategory = Labs/AWS/VPC\* ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version, accountID, interfaceID, srcDevice\_ip, dstDevice\_ip, src\_port, dest\_port, Protocol, packets, bytes, start, end, action, log\_status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where action="ACCEPT"<br />\| count by dstDevice\_ip <br />\| top 20 dstDevice\_ip by \_count|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Top20 Accepted by srcDevice\_ip|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects|\_sourceCategory = Labs/AWS/VPC\* ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version, accountID, interfaceID, srcDevice\_ip, dstDevice\_ip, src\_port, dest\_port, Protocol, packets, bytes, start, end, action, log\_status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where action="ACCEPT"<br />\| count by srcDevice\_ip <br />\| top 20 srcDevice\_ip by \_count|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Top20 InterfaceID by Bytes|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\*   ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where dstDevice\_ip != "-"<br />\| where srcDevice\_ip != "-"<br />\| where Action="ACCEPT" and IsPrivateIP(dstDevice\_ip) and isPrivateIP(srcDevice\_ip)<br />\| sum(bytes) as bytes\_sum by interfaceID<br />\| sort by bytes\_sum|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Top20 Rejected by dstDevice\_ip|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects|\_sourceCategory = Labs/AWS/VPC\* REJECT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version, accountID, interfaceID, srcDevice\_ip, dstDevice\_ip, src\_port, dest\_port, Protocol, packets, bytes, start, end, action, log\_status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where action="REJECT"<br />\| count by dstDevice\_ip <br />\| top 20 dstDevice\_ip by \_count|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Top20 Rejected by srcDevice\_ip|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Analytics - Accepts & Rejects|\_sourceCategory = Labs/AWS/VPC\* REJECT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version, accountID, interfaceID, srcDevice\_ip, dstDevice\_ip, src\_port, dest\_port, Protocol, packets, bytes, start, end, action, log\_status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where action="REJECT"<br />\| count by srcDevice\_ip <br />\| top 20 srcDevice\_ip by \_count|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Total Accepted Flow Records|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\* ACCEPT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where Action="ACCEPT" <br />\| timeslice 15m<br />\| count as RecordCount by \_timeslice<br />\| sort \_timeslice|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Total Hits from Threat Intel Source|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\* <br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop <br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where srcDevice\_ip != "-"<br />\| lookup type from sumo://threat/cs on threat=srcDevice\_ip<br />\| where type="ip\_address" and isPublicIP(srcDevice\_ip)<br />\| timeslice 15m<br />\| count as ThreatCount by \_timeslice<br />\| sort \_timeslice|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Total Hits to Threat Intel Destination|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\* <br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop <br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where dstDevice\_ip != "-"<br />\| lookup type from sumo://threat/cs on threat=dstDevice\_ip<br />\| where type="ip\_address" and isPublicIP(dstDevice\_ip)<br />\| timeslice 15m<br />\| count as ThreatCount by \_timeslice<br />\| sort \_timeslice|
|Amazon VPC Flow - Cloud Security Monitoring and Analytics|Total Rejected Flow Records|Logs|Amazon VPC Flow - Cloud Security Monitoring and Analytics/Amazon VPC Flow - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/VPC\* REJECT<br />\| json "logStream", "logGroup", "message", "direction" as logStream, logGroup, message, direction nodrop <br />\| if (\_raw matches "{\*", message, \_raw) as message<br />\| parse field=message "\* \* \* \* \* \* \* \* \* \* \* \* \* \*" as version,accountID,interfaceID,srcDevice\_ip,dstDevice\_ip,src\_port,dest\_port,Protocol,Packets,bytes,StartSample,EndSample,Action,status nodrop<br />\| where accountID matches "{{accountID}}"<br />\| where interfaceID matches "{{interfaceID}}"<br />\| where srcDevice\_ip matches "{{srcDevice\_ip}}"<br />\| where dstDevice\_ip matches "{{dstDevice\_ip}}"<br />\| where dest\_port matches "{{dest\_port}}"<br />\| where src\_port matches "{{src\_port}}"<br />\| where Action="REJECT" <br />\| timeslice 15m<br />\| count as RecordCount by \_timeslice<br />\| sort \_timeslice|

