# Microsoft Graph Security
## Sumo Logic App For: Microsoft Graph Security
The Microsoft Graph Security App for Sumo Logic empowers you to analyze security threats and take proactive measures to safeguard your organization. With its comprehensive widgets, you can track and analyze your security alerts in detail. The App utilizes Sumo Logicâ€™s cloud-to-cloud Microsoft Graph Security source to collect and analyze alerts from the Microsoft Graph Security API endpoint. With this information, organizations can swiftly detect and respond to potential security incidents.
Docs Link: [Microsoft Graph Security](https://help.sumologic.com/?cid=10205)

## Searches

### Log Searches

- **Alerts by Classification**: from Dashboard: Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview 
- **Alerts by Detection Source**: from Dashboard: Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview 
- **Alerts by Determination**: from Dashboard: Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview 
- **Alerts by Service Source**: from Dashboard: Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview 
- **Alerts by Severity Over Time**: from Dashboard: Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Security Overview 
- **Alerts by Status**: from Dashboard: Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview 
- **Alerts from Risky Countries**: from Dashboard: Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Security Overview 
- **Geo Locations of Alerts**: from Dashboard: Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview 
- **High Severity Alerts**: from Dashboard: Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Security Overview 
- **Recent Alerts**: from Dashboard: Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview 
- **Top 10 Alert Categories**: from Dashboard: Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview 
- **Top 10 Analysts**: from Dashboard: Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview 
- **Top 10 Attacked Device**: from Dashboard: Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Security Overview 
- **Top 10 Country with Suspicious or Malicious IP Verdict**: from Dashboard: Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Security Overview 
- **Top 10 User Account with Compromised Role**: from Dashboard: Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Security Overview 
- **Top 10 Users Associated with Alerts**: from Dashboard: Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview 
- **Total Alerts**: from Dashboard: Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Microsoft Graph Security|Alerts by Classification|Logs|Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview|\_sourceCategory={{Logsdatasource}}  <br />\|json"id","status","severity","category","title","description","classification","determination","serviceSource","detectionSource","alertWebUrl" ,"comments[\*]","evidence[\*]"as  alert\_id,status,severity,category,title,description,classification,determination,service\_source,detection\_source,alert\_url,comments,evidence\_info nodrop<br />\| where severity matches "{{severity}}" and status matches "{{status}}" and classification matches "{{classification}}" <br />\| where !isBlank(classification)<br />\| count by classification,alert\_id \| count by classification<br />\| sort by \_count|
|Microsoft Graph Security|Alerts by Detection Source|Logs|Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview|\_sourceCategory={{Logsdatasource}}  <br />\|json"id","status","severity","category","title","description","classification","determination","serviceSource","detectionSource","alertWebUrl" ,"comments[\*]","evidence[\*]"as  alert\_id,status,severity,category,title,description,classification,determination,service\_source,detection\_source,alert\_url,comments,evidence\_info nodrop<br />\| where severity matches "{{severity}}" and status matches "{{status}}" and classification matches "{{classification}}" <br />\| where !isBlank(detection\_source)<br />\| count by detection\_source,alert\_id \| count by detection\_source<br />\| sort by \_count|
|Microsoft Graph Security|Alerts by Determination|Logs|Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview|\_sourceCategory={{Logsdatasource}}  <br />\|json"id","status","severity","category","title","description","classification","determination","serviceSource","detectionSource","alertWebUrl" ,"comments[\*]","evidence[\*]"as  alert\_id,status,severity,category,title,description,classification,determination,service\_source,detection\_source,alert\_url,comments,evidence\_info nodrop<br />\| where severity matches "{{severity}}" and status matches "{{status}}" and classification matches "{{classification}}" <br />\| where !isBlank(determination)<br />\| count by determination,alert\_id \| count by determination<br />\| sort by \_count|
|Microsoft Graph Security|Alerts by Service Source|Logs|Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview|\_sourceCategory={{Logsdatasource}}  <br />\|json"id","status","severity","category","title","description","classification","determination","serviceSource","detectionSource","alertWebUrl" ,"comments[\*]","evidence[\*]"as  alert\_id,status,severity,category,title,description,classification,determination,service\_source,detection\_source,alert\_url,comments,evidence\_info nodrop<br />\| where severity matches "{{severity}}" and status matches "{{status}}" and classification matches "{{classification}}" <br />\| where !isBlank(service\_source)<br />\| count service\_source,alert\_id \| count by service\_source<br />\| sort by \_count|
|Microsoft Graph Security|Alerts by Severity Over Time|Logs|Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Security Overview|\_sourceCategory={{Logsdatasource}}  <br />\|json"id","status","severity","category","title","description","classification","determination","serviceSource","detectionSource" ,"comments[\*]","evidence[\*]"as  alert\_id,status,severity,category,title,description,classification,determination,service\_source,detection\_source,comments,evidence\_info nodrop<br />\| where severity matches "{{severity}}" and status matches "{{status}}" and classification matches "{{classification}}" <br />\| timeslice 1d<br />\| count by \_timeslice, severity, alert\_id \| count by \_timeslice, severity <br />\| fillmissing timeslice, values all in severity<br />\| transpose row \_timeslice column severity|
|Microsoft Graph Security|Alerts by Status|Logs|Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview|\_sourceCategory={{Logsdatasource}}  <br />\|json"id","status","severity","category","title","description","classification","determination","serviceSource","detectionSource","alertWebUrl" ,"comments[\*]","evidence[\*]"as  alert\_id,status,severity,category,title,description,classification,determination,service\_source,detection\_source,alert\_url,comments,evidence\_info nodrop<br />\| where severity matches "{{severity}}" and status matches "{{status}}" and classification matches "{{classification}}" <br />\| count by status,alert\_id \| count by status<br />\| sort by \_count|
|Microsoft Graph Security|Alerts from Risky Countries|Logs|Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Security Overview|\_sourceCategory={{Logsdatasource}}  <br />\|json"id","status","severity","category","title","description","classification","determination","serviceSource","detectionSource" ,"comments[\*]","evidence[\*]"as  alert\_id,status,severity,category,title,description,classification,determination,service\_source,detection\_source,comments,evidence\_info nodrop<br />\| where severity matches "{{severity}}" and status matches "{{status}}" and classification matches "{{classification}}" <br />\| where evidence\_info !="[]"<br />\| extract field=evidence\_info "(?\<evidence\_detail\>\\{.\*?\\})" multi<br />\| json field=evidence\_detail "\$['@odata.type']" as data\_type<br />\| where data\_type matches "#microsoft.graph.security.ipEvidence"<br />\| json field=evidence\_detail "ipAddress" as ip<br />\| where isValidIPv4(ip) or isValidIPv6(ip)<br />\| where !isEmpty(ip)<br />\| count by ip,alert\_id \| count by ip<br />\| lookup latitude, longitude , country\_code from geo://location on ip = ip<br />\| lookup country\_code from https://sumologic-app-data.s3.amazonaws.com/riskycountries.csv on country\_code=country\_code <br />\| where !isBlank(country\_code)|
|Microsoft Graph Security|Geo Locations of Alerts|Logs|Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview|\_sourceCategory={{Logsdatasource}}  <br />\|json"id","status","severity","category","title","description","classification","determination","serviceSource","detectionSource","alertWebUrl" ,"comments[\*]","evidence[\*]"as  alert\_id,status,severity,category,title,description,classification,determination,service\_source,detection\_source,alert\_url,comments,evidence\_info nodrop<br />\| where severity matches "{{severity}}" and status matches "{{status}}" and classification matches "{{classification}}" <br />\| where evidence\_info !="[]"<br />\| extract field=evidence\_info "(?\<evidence\_detail\>\\{.\*?\\})" multi<br />\| json field=evidence\_detail "\$['@odata.type']" as data\_type<br />\| where data\_type matches "#microsoft.graph.security.ipEvidence"<br />\| json field=evidence\_detail "ipAddress" as ip<br />\| where isValidIPv4(ip) or isValidIPv6(ip)<br />\| where !isEmpty(ip)<br />\| count by ip,alert\_id \| count by ip<br />\| lookup latitude, longitude from geo://location on ip = ip|
|Microsoft Graph Security|High Severity Alerts|Logs|Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Security Overview|\_sourceCategory={{Logsdatasource}}  <br />\|json"id","status","severity","category","title","description","classification","determination","serviceSource","detectionSource" ,"comments[\*]","evidence[\*]"as  alert\_id,status,severity,category,title,description,classification,determination,service\_source,detection\_source,comments,evidence\_info nodrop<br />\| where status matches "{{status}}" and classification matches "{{classification}}" <br />\| where severity in ("high")<br />\| count by alert\_id \| count|
|Microsoft Graph Security|Recent Alerts|Logs|Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview|\_sourceCategory={{Logsdatasource}}  <br />\|json"id","status","severity","category","title","description","classification","determination","serviceSource","detectionSource","alertWebUrl" ,"comments[\*]","evidence[\*]"as  alert\_id,status,severity,category,title,description,classification,determination,service\_source,detection\_source,alert\_url,comments,evidence\_info nodrop<br />\| where severity matches "\*" and status matches "\*" and classification matches "\*" <br />\| if(isNull(category),"-",category) as category<br />\| if(isNull(classification),"-",classification) as classification<br />\| if(isNull(determination),"-",determination) as determination<br />\| count by \_messageTime,status,severity,category,title,description,classification,determination,alert\_url,alert\_id<br />\| formatDate(toLong(\_messageTime), "dd-MM-yyyy HH:mm:ss") as time<br />\| tourl (alert\_url,alert\_id) as alert\_id<br />\| fields time,alert\_id,title,description,alert\_url,status,severity,category,classification,determination<br />\| fields -\_messageTime    <br />\| sort by time<br />\| limit 100|
|Microsoft Graph Security|Top 10 Alert Categories|Logs|Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview|\_sourceCategory={{Logsdatasource}}  <br />\|json"id","status","severity","category","title","description","classification","determination","serviceSource","detectionSource","alertWebUrl" ,"comments[\*]","evidence[\*]"as  alert\_id,status,severity,category,title,description,classification,determination,service\_source,detection\_source,alert\_url,comments,evidence\_info nodrop<br />\| where severity matches "{{severity}}" and status matches "{{status}}" and classification matches "{{classification}}" <br />\| where !isBlank(category)<br />\| count by category,alert\_id \| count by category<br />\| sort by \_count<br />\| limit 10|
|Microsoft Graph Security|Top 10 Analysts|Logs|Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview|\_sourceCategory={{Logsdatasource}}  <br />\|json"id","status","severity","category","title","description","classification","determination","serviceSource","detectionSource","alertWebUrl" ,"comments[\*]","evidence[\*]"as  alert\_id,status,severity,category,title,description,classification,determination,service\_source,detection\_source,alert\_url,comments,evidence\_info nodrop<br />\| where severity matches "{{severity}}" and status matches "{{status}}" and classification matches "{{classification}}" <br />\| where comments !="[]"<br />\| extract field=comments "(?\<comment\_info\>\\{.\*?\\})" multi<br />\| json field=comment\_info "createdByDisplayName" as analyst<br />\| count by analyst,alert\_id \| count by analyst<br />\| sort by \_count<br />\| limit 10|
|Microsoft Graph Security|Top 10 Attacked Device|Logs|Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Security Overview|\_sourceCategory={{Logsdatasource}}  <br />\|json"id","status","severity","category","title","description","classification","determination","serviceSource","detectionSource" ,"comments[\*]","evidence[\*]"as  alert\_id,status,severity,category,title,description,classification,determination,service\_source,detection\_source,comments,evidence\_info nodrop<br />\| where severity matches "{{severity}}" and status matches "{{status}}" and classification matches "{{classification}}" <br />\| where evidence\_info !="[]"<br />\| extract field=evidence\_info "(?\<evidence\_detail\>\\{[^\\{\\}]\*?\\"vmMetadata\\"[^\\{\\}]\*?\\{[^\\{\\}]\*?\\}[^\\{\\}]\*?\\})" multi<br />\| json field=evidence\_detail "\$['@odata.type']" as data\_type<br />\| where data\_type matches "#microsoft.graph.security.deviceEvidence"<br />\| json field=evidence\_detail "roles[\*]" as roles<br />\| where contains(roles, "attacked")<br />\| json field=evidence\_detail "mdeDeviceId" as device\_id<br />\| where !isBlank("device\_id")<br />\| json field=evidence\_detail "riskScore" as risk\_score<br />\| json field=evidence\_detail "healthStatus" as health\_status<br />\| json field=evidence\_detail "osPlatform" as os <br />\| json field=evidence\_detail "deviceDnsName" as dns\_name<br />\| json field=evidence\_detail "azureAdDeviceId" as azure\_id<br />\| if(isNull(risk\_score),"-",risk\_score) as risk\_score<br />\| if(isNull(health\_status),"-",health\_status) as health\_status<br />\| if(isNull(azure\_id),"-",azure\_id) as azure\_id<br />\| if(isNull(os),"-",os) as os<br />\| if(isNull(dns\_name),"-",dns\_name) as dns\_name<br />\| count as alert\_count by device\_id,risk\_score,health\_status,os,dns\_name,azure\_id,alert\_id<br />\| sort by alert\_count<br />\| limit 10|
|Microsoft Graph Security|Top 10 Country with Suspicious or Malicious IP Verdict|Logs|Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Security Overview|\_sourceCategory={{Logsdatasource}}  <br />\|json"id","status","severity","category","title","description","classification","determination","serviceSource","detectionSource" ,"comments[\*]","evidence[\*]"as  alert\_id,status,severity,category,title,description,classification,determination,service\_source,detection\_source,comments,evidence\_info nodrop<br />\| where severity matches "{{severity}}" and status matches "{{status}}" and classification matches "{{classification}}" <br />\| where evidence\_info !="[]"<br />\| extract field=evidence\_info "(?\<evidence\_detail\>\\{.\*?\\})" multi<br />\| json field=evidence\_detail "\$['@odata.type']" as data\_type<br />\| where data\_type matches "#microsoft.graph.security.ipEvidence"<br />\| json field=evidence\_detail "verdict" as verdict<br />\| where verdict in ("suspicious","malicious")<br />\| json field=evidence\_detail "ipAddress" as ip<br />\| where isValidIPv4(ip) or isValidIPv6(ip)<br />\| where !isBlank(ip)<br />\| lookup country\_name from geo://location on ip = ip<br />\| count as ip\_count by country\_name<br />\| sort by ip\_count<br />\| limit 10|
|Microsoft Graph Security|Top 10 User Account with Compromised Role|Logs|Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Security Overview|\_sourceCategory={{Logsdatasource}}  <br />\|json"id","status","severity","category","title","description","classification","determination","serviceSource","detectionSource" ,"comments[\*]","evidence[\*]"as  alert\_id,status,severity,category,title,description,classification,determination,service\_source,detection\_source,comments,evidence\_info nodrop<br />\| where severity matches "{{severity}}" and status matches "{{status}}" and classification matches "{{classification}}" <br />\| where evidence\_info !="[]"<br />\| extract field=evidence\_info "(?\<evidence\_detail\>\\{[^\\{\\}]\*?\\"userAccount\\"[^\\{\\}]\*?\\{[^\\{\\}]\*?\\}[^\\{\\}]\*?\\})" multi<br />\| json field=evidence\_detail "\$['@odata.type']" as data\_type<br />\| where data\_type matches "#microsoft.graph.security.userEvidence"<br />\| json field=evidence\_detail "roles[\*]" as roles<br />\| where contains(roles, "compromised")<br />\| json field=evidence\_detail "userAccount" as user\_account<br />\| json field = user\_account "userPrincipalName" as user\_name<br />\| json field = user\_account "userSid" as user\_id<br />\| json field = user\_account "azureAdUserId" as user\_azure\_id<br />\| json field = user\_account "accountName" as user\_account\_name<br />\| json field = user\_account "displayName" as user\_display\_name<br />\| json field = user\_account "domainName"  as domain\_name<br />\| if(isNull(user\_name),"-",user\_name) as user\_name<br />\| if(isNull(user\_id),"-",user\_id) as user\_id<br />\| if(isNull(user\_azure\_id),"-",user\_azure\_id) as user\_azure\_id<br />\| if(isNull(user\_account\_name),"-",user\_account\_name) as user\_account\_name<br />\| if(isNull(user\_display\_name),"-",user\_display\_name) as user\_display\_name<br />\| if(isNull(domain\_name),"-",domain\_name) as domain\_name<br />\| count as alert\_count by user\_name,user\_id,user\_account\_name,user\_display\_name,user\_azure\_id,domain\_name,alert\_id<br />\| sort by alert\_count<br />\| limit 10|
|Microsoft Graph Security|Top 10 Users Associated with Alerts|Logs|Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview|\_sourceCategory={{Logsdatasource}}  <br />\|json"id","status","severity","category","title","description","classification","determination","serviceSource","detectionSource","alertWebUrl" ,"comments[\*]","evidence[\*]"as  alert\_id,status,severity,category,title,description,classification,determination,service\_source,detection\_source,alert\_url,comments,evidence\_info nodrop<br />\| where severity matches "{{severity}}" and status matches "{{status}}" and classification matches "{{classification}}" <br />\| where evidence\_info !="[]"<br />\| extract field=evidence\_info "(?\<evidence\_detail\>\\{[^\\{\\}]\*?\\"userAccount\\"[^\\{\\}]\*?\\{[^\\{\\}]\*?\\}[^\\{\\}]\*?\\})" multi<br />\| json field=evidence\_detail "\$['@odata.type']" as data\_type<br />\| where data\_type matches "#microsoft.graph.security.userEvidence"<br />\| json field= evidence\_detail "userAccount" as user\_account<br />\| json field = user\_account "userPrincipalName" as user\_name<br />\| json field = user\_account "userSid" as user\_id<br />\| json field = user\_account "azureAdUserId" as user\_azure\_id<br />\| json field = user\_account "accountName" as user\_account\_name<br />\| json field = user\_account "displayName" as user\_display\_name<br />\| json field = user\_account "domainName"  as domain\_name<br />\| if(isNull(user\_name),"-",user\_name) as user\_name<br />\| if(isNull(user\_id),"-",user\_id) as user\_id<br />\| if(isNull(user\_azure\_id),"-",user\_azure\_id) as user\_azure\_id<br />\| if(isNull(user\_account\_name),"-",user\_account\_name) as user\_account\_name<br />\| if(isNull(user\_display\_name),"-",user\_display\_name) as user\_display\_name<br />\| if(isNull(domain\_name),"-",domain\_name) as domain\_name<br />\| count by user\_name,user\_id,user\_account\_name,user\_display\_name,user\_azure\_id,domain\_name,alert\_id<br />\| count as alert\_count by user\_name,user\_id,user\_account\_name,user\_display\_name,user\_azure\_id,domain\_name<br />\| sort by alert\_count<br />\| limit 10|
|Microsoft Graph Security|Total Alerts|Logs|Installed Apps/Microsoft Graph Security/Microsoft Graph Security - Alerts Overview|\_sourceCategory={{Logsdatasource}}  <br />\|json"id","status","severity","category","title","description","classification","determination","serviceSource","detectionSource","alertWebUrl" ,"comments[\*]","evidence[\*]"as  alert\_id,status,severity,category,title,description,classification,determination,service\_source,detection\_source,alert\_url,comments,evidence\_info nodrop<br />\| where severity matches "{{severity}}" and status matches "{{status}}" and classification matches "{{classification}}" <br />\| count by alert\_id \| count|

