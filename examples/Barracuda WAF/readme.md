# Barracuda WAF
## Sumo Logic App For: Barracuda WAF
The Barracuda Web Application Firewall (WAF) protects applications, APIs, and mobile app backends against the most critical security risks to web applications, zero-day threats, data leakage, and application-layer denial of service (DoS) attacks. Barracuda WAF combines both positive signature-based policies with robust anomaly detection capabilities to protect your web applications from the most sophisticated attacks.
The Barracuda WAF App provides detailed analytics on system, firewall, and network security so you can identify, monitor, and take judicious action to protect your environment from malicious attacks. Security Analysis dashboards provide insights into the types of attacks, severity, malicious IPs, blocked and allowed content, and attacks by services. Traffic Analysis dashboards provide detailed information on client, server, and service traffic, as well as errors, bandwidth trends, and service performance.
Docs Link: [Barracuda WAF](https://help.sumologic.com/?cid=1970)

## Searches

### Log Searches

- **Admin Access Locations**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - Admin Activities 
- **Alerts Severity**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview 
- **Allowed Threat Locations**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis 
- **Allowed Traffic - Details**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis 
- **Allowed Traffic - Threat Intel**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis 
- **Allowed Traffic - Threat Intel - Actors**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview 
- **Allowed Traffic - Threat Intel - Confidence**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview 
- **Allowed Traffic by Attack Category**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis 
- **Allowed Traffic by Severity**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis 
- **Allowed Traffic by Unit Name**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis 
- **Attack Origins**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview 
- **Attack Trend**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview 
- **Attacks by Service IP**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview 
- **Blocked Threat Locations**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis 
- **Blocked Traffic - Details**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis 
- **Blocked Traffic - Threat Intel**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis 
- **Blocked Traffic - Threat Intel - Actors**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview 
- **Blocked Traffic - Threat Intel - Confidence**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview 
- **Blocked Traffic by Attack Category**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis 
- **Blocked Traffic by Severity**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis 
- **Blocked Traffic by Unit Name**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis 
- **Browsers and Operating Systems**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Client Traffic 
- **Cache Hit Percentage**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Traffic Overview 
- **Cache Hit Percentage Over Time**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Service Traffic 
- **Cache Performance**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Service Traffic 
- **Change Type Over Time**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - Admin Activities 
- **Client Access Type**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - Admin Activities 
- **Client Errors Over Time**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic 
- **Client Location 4XX Errors**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic 
- **CPU usage Alert Outlier**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - System Activities 
- **Destination Locations**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - Network Activities 
- **Error Responses by Server**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic 
- **Firmware Storage Alert Outlier**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - System Activities 
- **HTTP Methods Over Time**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic 
- **HTTP Protocols Over Time**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic 
- **HTTP Versions**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic 
- **Log Level Distribution - System Logs**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - System Activities 
- **Log Storage Alert Outlier**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - System Activities 
- **Memory Usage Alert Outlier**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - System Activities 
- **Modified Object Types**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - Admin Activities 
- **Outlier - Allowed Network Traffic**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - Network Activities 
- **Outlier - Allowed Traffic**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis 
- **Outlier - Blocked Network Traffic**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - Network Activities 
- **Outlier - Blocked Traffic**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis 
- **Outlier - Client Errors(4XX)**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Traffic Overview 
- **Outlier - Server Errors(5XX)**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Traffic Overview 
- **Outlier - Service Performance**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Traffic Overview 
- **Performance (ms) by Service**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Traffic Overview 
- **Recent - Attacks**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis 
- **Recent - Audit Logs**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - Admin Activities 
- **Recent - Cluster Activities**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - System Activities 
- **Recent Alerts in System Logs**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - System Activities 
- **Requests by Service IPs**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Traffic Overview 
- **Response Code Distribution**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Traffic Overview 
- **Rule Distribution**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview 
- **Rule Type Distribution**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview 
- **Server Errors(5XX) Over Time**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic 
- **Severity - Network Logs**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - Network Activities 
- **Source Locations**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - Network Activities 
- **Top 10 ACL Rules**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - Network Activities 
- **Top 10 Destinations**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - Network Activities 
- **Top 10 Module Names**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - System Activities 
- **Top 10 OS Versions**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Client Traffic 
- **Top 10 Sources**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - Network Activities 
- **Top 10 Transaction Types**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - Admin Activities 
- **Top 5 Backend Servers**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic 
- **Top 5 Clients Causing 4XX Erros**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic 
- **Top 5 URIs - 404 Responses**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic 
- **Top Admins**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - Admin Activities 
- **Top Attacked Domains**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview 
- **Top Attacked Services**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview 
- **Top Attacked URLs**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview 
- **Top Attackers**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview 
- **Top Attacking Country/Region**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview 
- **Top Attacking Referrers**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview 
- **Top Attacking User Agents**: from Dashboard: Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview 
- **Top Bots Observed**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Client Traffic 
- **Top Client Errors**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic 
- **Top Clients by Bandwidth**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Client Traffic 
- **Top Clients by Requests**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Client Traffic 
- **Top Countries by Requests**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Client Traffic 
- **Top Domains by Bandwidth**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Service Traffic 
- **Top Domains by Requests**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Service Traffic 
- **Top Referrers**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Client Traffic 
- **Top Server Errors**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic 
- **Top Services by Bandwidth**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Service Traffic 
- **Top Services by Bandwidth**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Service Traffic 
- **Top URL by Bandwidth**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Service Traffic 
- **Top URL by Requests**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Service Traffic 
- **Total Request Size Over Time**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic 
- **Total Response Size Over Time**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic 
- **Unsuccessful Login Over Time**: from Dashboard: Installed Apps/Barracuda WAF/Barracuda WAF - Admin Activities 
- **Visitor Platforms by Requests**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Client Traffic 
- **Visitors Platform by Bandwidth**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Client Traffic 
- **Visitors Platform Over Time**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Traffic Overview 
- **Visits by Countries Over Time**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Client Traffic 
- **Worldwide Location of Clients**: from Dashboard: Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Traffic Overview

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Barracuda WAF|Admin Access Locations|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - Admin Activities|\_sourceCategory={{\_sourceCategory}} " AUDIT "<br />\| parse regex "(?\<Activity\_Time\>\\d\\d\\d\\d-\\d\\d-\\d\\d\\s{1,3}.\* )(?\<Unit\_Name\>[^ ]+) AUDIT(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Admin\_Name, 3 as Client\_Type, 4 as Login\_Ip, 5 as Login\_Port, 6 as Transaction\_Type, 7 as Transaction\_Id, 8 as Command\_Name, 9 as Change\_Type, 10 as Object\_Type, 11 as Object\_Name, 12 as Variable\_Name, 13 as Old\_Value, 14 as New\_Value, 15 as Additional\_Data<br />\|where if ("{{Transaction\_Type}}" = "\*", true, Transaction\_Type matches "{{Transaction\_Type}}") AND if ("{{Admin\_Name}}" = "\*", true, Admin\_Name matches "{{Admin\_Name}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Login\_Ip}}" = "\*", true, Login\_Ip matches "{{Login\_Ip}}") AND if ("{{Client\_Type}}" = "\*", true, Client\_Type matches "{{Client\_Type}}") AND if ("{{Change\_Type}}" = "\*", true, Change\_Type matches "{{Change\_Type}}")<br />\|count by Login\_Ip<br />\| lookup latitude, longitude from geo://location on ip = Login\_Ip|
|Barracuda WAF/Security Analysis|Alerts Severity|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview|\_sourceCategory={{\_sourceCategory}} " WF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| if(Severity matches "ALE\*", "ALERT", if(Severity matches "EME\*", "EMERGENCY", if(Severity matches "CRI\*", "CRITICAL", if(Severity matches "ERR\*", "ERROR", if(Severity matches "WAR\*", "WARNING", if(Severity matches "NOT\*", "NOTICE", if(Severity matches "INF\*", "INFORMATION", if(Severity matches "DEB\*", "DEBUG", "")))))))) as Severity\_Level<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{severity}}" = "\*", true, severity matches "{{severity}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{Rule\_Type}}" = "\*", true, Rule\_Type matches "{{Rule\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|topk(1, Severity\_Level) by UID, Unit\_Name, Attack\_Type<br />\| timeslice 1h<br />\| count as Count by \_timeSlice, Severity\_Level<br />\| fillmissing timeslice(1h), values("ALERT", "EMERGENCY", "CRITICAL", "ERROR", "WARNING", "NOTICE", "INFORMATION", "DEBUG") in Severity\_Level<br />\| transpose row \_timeslice column Severity\_Level<br />\| sort by \_timeslice|
|Barracuda WAF/Security Analysis|Allowed Threat Locations|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis|\_sourceCategory={{\_sourceCategory}} " WF " ("LOG" OR "WARN" OR "CLOAK")<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| where Action in ("LOG", "WARN", "CLOAK")<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{Attack\_Type}}" = "\*", true, Attack\_Type matches "{{Attack\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Severity}}" = "\*", true, Severity matches "{{Severity}}") AND if ("{{UID}}" = "\*", true, UID matches "{{UID}}") AND if ("{{Action}}" = "\*", true, Action matches "{{Action}}")<br />\|topk(1, Client\_Ip) by UID, Unit\_Name, Attack\_Type<br />\| count by Client\_Ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip|
|Barracuda WAF/Security Analysis|Allowed Traffic - Details|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis|\_sourceCategory={{\_sourceCategory}} " WF " ("LOG" OR "WARN" OR "CLOAK")<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| where Action in ("LOG", "WARN", "CLOAK")<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{Attack\_Type}}" = "\*", true, Attack\_Type matches "{{Attack\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Severity}}" = "\*", true, Severity matches "{{Severity}}") AND if ("{{UID}}" = "\*", true, UID matches "{{UID}}") AND if ("{{Action}}" = "\*", true, Action matches "{{Action}}")<br />\|topk(1, Client\_Ip) by UID, Unit\_Name, Attack\_Type<br />\| concat(Service\_Ip, ":",Service\_Port) as Service<br />\| lookup Severity as Attack\_Severity, Attack\_Category as Attack\_Category from https://s3.amazonaws.com/sumologic-app-data/Barracuda\_Attack\_Description\_and\_Category.csv on Attack\_Name=Attack\_Type<br />\| tourl("https://campus.barracuda.com/product/webapplicationfirewall/doc/29819001/attacks-description-action-policy", Attack\_Type) as Attack\_Type<br />\| count as Count by Client\_Ip, Attack\_Type, Attack\_Details, Attack\_Category, Attack\_Severity<br />\| sort by Count<br />\| limit 10|
|Barracuda WAF/Security Analysis|Allowed Traffic - Threat Intel|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis|\_sourceCategory={{\_sourceCategory}} " WF " ("LOG" OR "WARN" OR "CLOAK")<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| where Action in ("LOG", "WARN", "CLOAK")<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{Attack\_Type}}" = "\*", true, Attack\_Type matches "{{Attack\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Severity}}" = "\*", true, Severity matches "{{Severity}}") AND if ("{{UID}}" = "\*", true, UID matches "{{UID}}") AND if ("{{Action}}" = "\*", true, Action matches "{{Action}}")<br />\|count as allowed\_ips by Client\_Ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=Client\_Ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum (allowed\_ips) as threat\_count by Client\_Ip, malicious\_confidence, Actor, label\_name<br />\| sort by threat\_count|
|Barracuda WAF/Security Analysis|Allowed Traffic - Threat Intel - Actors|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview|\_sourceCategory={{\_sourceCategory}} " WF " ("LOG" OR "WARN" OR "CLOAK")<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| where Action in ("LOG", "WARN", "CLOAK")<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{severity}}" = "\*", true, severity matches "{{severity}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{Rule\_Type}}" = "\*", true, Rule\_Type matches "{{Rule\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|count as allowed\_ips by Client\_Ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=Client\_Ip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum (allowed\_ips) as threat\_count by Actor<br />\| sort by threat\_count<br />\| limit 10|
|Barracuda WAF/Security Analysis|Allowed Traffic - Threat Intel - Confidence|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview|\_sourceCategory={{\_sourceCategory}} " WF " ("LOG" OR "WARN" OR "CLOAK")<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| where Action in ("LOG", "WARN", "CLOAK")<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{severity}}" = "\*", true, severity matches "{{severity}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{Rule\_Type}}" = "\*", true, Rule\_Type matches "{{Rule\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|count as allowed\_ips by Client\_Ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=Client\_Ip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum (allowed\_ips) as threat\_count by malicious\_confidence<br />\| sort by threat\_count|
|Barracuda WAF/Security Analysis|Allowed Traffic by Attack Category|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis|\_sourceCategory={{\_sourceCategory}} " WF " ("LOG" OR "WARN" OR "CLOAK")<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| where Action in ("LOG", "WARN", "CLOAK")<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{Attack\_Type}}" = "\*", true, Attack\_Type matches "{{Attack\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Severity}}" = "\*", true, Severity matches "{{Severity}}") AND if ("{{UID}}" = "\*", true, UID matches "{{UID}}") AND if ("{{Action}}" = "\*", true, Action matches "{{Action}}")<br />\|topk(1, Client\_Ip) by UID, Unit\_Name, Attack\_Type<br />\| lookup Severity, Attack\_Category from https://s3.amazonaws.com/sumologic-app-data/Barracuda\_Attack\_Description\_and\_Category.csv on Attack\_Name=Attack\_Type<br />\| count as Count by Attack\_Category<br />\| sort by Count<br />\| limit 10|
|Barracuda WAF/Security Analysis|Allowed Traffic by Severity|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis|\_sourceCategory={{\_sourceCategory}} " WF " ("LOG" OR "WARN" OR "CLOAK")<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| where Action in ("LOG", "WARN", "CLOAK")<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{Attack\_Type}}" = "\*", true, Attack\_Type matches "{{Attack\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Severity}}" = "\*", true, Severity matches "{{Severity}}") AND if ("{{UID}}" = "\*", true, UID matches "{{UID}}") AND if ("{{Action}}" = "\*", true, Action matches "{{Action}}")<br />\|topk(1, Severity) by UID, Unit\_Name, Attack\_Type<br />\| if(Severity matches "ALE\*", "ALERT", if(Severity matches "EME\*", "EMERGENCY", if(Severity matches "CRI\*", "CRITICAL", if(Severity matches "ERR\*", "ERROR", if(Severity matches "WAR\*", "WARNING", if(Severity matches "NOT\*", "NOTICE", if(Severity matches "INF\*", "INFORMATION", if(Severity matches "DEB\*", "DEBUG", "")))))))) as Severity\_Level<br />\| where !isEmpty(Severity\_Level)<br />\| count as Count by Severity\_Level|
|Barracuda WAF/Security Analysis|Allowed Traffic by Unit Name|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis|\_sourceCategory={{\_sourceCategory}} " WF " ("LOG" OR "WARN" OR "CLOAK")<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| where Action in ("LOG", "WARN", "CLOAK")<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{Attack\_Type}}" = "\*", true, Attack\_Type matches "{{Attack\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Severity}}" = "\*", true, Severity matches "{{Severity}}") AND if ("{{UID}}" = "\*", true, UID matches "{{UID}}") AND if ("{{Action}}" = "\*", true, Action matches "{{Action}}")<br />\|topk(1, Unit\_Name) by UID, Unit\_Name, Attack\_Type<br />\| count as Count by Unit\_Name<br />\| sort by Count<br />\| limit 5|
|Barracuda WAF/Security Analysis|Attack Origins|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview|\_sourceCategory={{\_sourceCategory}} " WF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{severity}}" = "\*", true, severity matches "{{severity}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{Rule\_Type}}" = "\*", true, Rule\_Type matches "{{Rule\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|topk(1, Client\_Ip) by UID, Unit\_Name, Attack\_Type<br />\| count by Client\_Ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip|
|Barracuda WAF/Security Analysis|Attack Trend|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview|\_sourceCategory={{\_sourceCategory}} " WF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{severity}}" = "\*", true, severity matches "{{severity}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{Rule\_Type}}" = "\*", true, Rule\_Type matches "{{Rule\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|topk(1, Action) by UID, Unit\_Name, Attack\_Type<br />\| timeslice 15m<br />\| if(Action in ("LOG", "WARN", "CLOAK"),1,0) as Allowed\_count<br />\| if(Action matches "DEN\*",1,0) as Blocked\_count<br />\| sum(Blocked\_count) as Blocked, sum(Allowed\_count) as Allowed by \_timeslice<br />\| fillmissing timeslice(15m)|
|Barracuda WAF/Security Analysis|Attacks by Service IP|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview|\_sourceCategory={{\_sourceCategory}} " WF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| concat(Service\_Ip,":",Service\_Port) as Service<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{severity}}" = "\*", true, severity matches "{{severity}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{Rule\_Type}}" = "\*", true, Rule\_Type matches "{{Rule\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|topk(1, Service) by UID, Unit\_Name, Attack\_Type<br />\| timeslice 15m<br />\| count as Count by \_timeslice, Service<br />\| filter Service in (sum(Count) by Service \| top 5 Service by \_sum )<br />\| transpose row \_timeslice column Service<br />\| fillmissing timeslice(15m)|
|Barracuda WAF/Security Analysis|Blocked Threat Locations|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis|\_sourceCategory={{\_sourceCategory}} " WF " "DENY"<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| where Action in ("DENY")<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{Attack\_Type}}" = "\*", true, Attack\_Type matches "{{Attack\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Severity}}" = "\*", true, Severity matches "{{Severity}}") AND if ("{{UID}}" = "\*", true, UID matches "{{UID}}") AND if ("{{Action}}" = "\*", true, Action matches "{{Action}}")<br />\|topk(1, Client\_Ip) by UID, Unit\_Name, Attack\_Type<br />\| count by Client\_Ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip|
|Barracuda WAF/Security Analysis|Blocked Traffic - Details|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis|\_sourceCategory={{\_sourceCategory}} " WF " "DENY"<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| where Action matches "DENY"<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{Attack\_Type}}" = "\*", true, Attack\_Type matches "{{Attack\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Severity}}" = "\*", true, Severity matches "{{Severity}}") AND if ("{{UID}}" = "\*", true, UID matches "{{UID}}") AND if ("{{Action}}" = "\*", true, Action matches "{{Action}}")<br />\|topk(1, Client\_Ip) by UID, Unit\_Name, Attack\_Type<br />\| concat(Service\_Ip, ":",Service\_Port) as Service<br />\| lookup Severity, Attack\_Category from https://s3.amazonaws.com/sumologic-app-data/Barracuda\_Attack\_Description\_and\_Category.csv on Attack\_Name=Attack\_Type<br />\| tourl("https://campus.barracuda.com/product/webapplicationfirewall/doc/29819001/attacks-description-action-policy", Attack\_Type) as Attack\_Type<br />\| count as Count by Client\_Ip, Attack\_Type, Attack\_Details, Attack\_Category, Severity<br />\| sort by Count<br />\| limit 10|
|Barracuda WAF/Security Analysis|Blocked Traffic - Threat Intel|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis|\_sourceCategory={{\_sourceCategory}} " WF " ("DENY")<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| where Action in ("DENY")<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{Attack\_Type}}" = "\*", true, Attack\_Type matches "{{Attack\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Severity}}" = "\*", true, Severity matches "{{Severity}}") AND if ("{{UID}}" = "\*", true, UID matches "{{UID}}") AND if ("{{Action}}" = "\*", true, Action matches "{{Action}}")<br />\|count as blocked\_ips by Client\_Ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=Client\_Ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum (blocked\_ips) as threat\_count by Client\_Ip, malicious\_confidence, Actor, label\_name<br />\| sort by threat\_count|
|Barracuda WAF/Security Analysis|Blocked Traffic - Threat Intel - Actors|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview|\_sourceCategory={{\_sourceCategory}} " WF " ("DENY")<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| where Action in ("DENY")<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{severity}}" = "\*", true, severity matches "{{severity}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{Rule\_Type}}" = "\*", true, Rule\_Type matches "{{Rule\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|count as blocked\_ips by Client\_Ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=Client\_Ip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum (blocked\_ips) as threat\_count by Actor<br />\| sort by threat\_count<br />\| limit 10|
|Barracuda WAF/Security Analysis|Blocked Traffic - Threat Intel - Confidence|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview|\_sourceCategory={{\_sourceCategory}} " WF " ("DENY")<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| where Action in ("DENY")<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{severity}}" = "\*", true, severity matches "{{severity}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{Rule\_Type}}" = "\*", true, Rule\_Type matches "{{Rule\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|count as blocked\_ips by Client\_Ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=Client\_Ip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum (blocked\_ips) as threat\_count by malicious\_confidence<br />\| sort by threat\_count|
|Barracuda WAF/Security Analysis|Blocked Traffic by Attack Category|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis|\_sourceCategory={{\_sourceCategory}} " WF " "DENY"<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| where Action matches "DENY"<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{Attack\_Type}}" = "\*", true, Attack\_Type matches "{{Attack\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Severity}}" = "\*", true, Severity matches "{{Severity}}") AND if ("{{UID}}" = "\*", true, UID matches "{{UID}}") AND if ("{{Action}}" = "\*", true, Action matches "{{Action}}")<br />\|topk(1, Client\_Ip) by UID, Unit\_Name, Attack\_Type<br />\| lookup Severity, Attack\_Category from https://s3.amazonaws.com/sumologic-app-data/Barracuda\_Attack\_Description\_and\_Category.csv on Attack\_Name=Attack\_Type<br />\| count as Count by Attack\_Category<br />\| sort by Count<br />\| limit 10|
|Barracuda WAF/Security Analysis|Blocked Traffic by Severity|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis|\_sourceCategory={{\_sourceCategory}} " WF " "DENY"<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| where Action in ("DENY")<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{Attack\_Type}}" = "\*", true, Attack\_Type matches "{{Attack\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Severity}}" = "\*", true, Severity matches "{{Severity}}") AND if ("{{UID}}" = "\*", true, UID matches "{{UID}}") AND if ("{{Action}}" = "\*", true, Action matches "{{Action}}")<br />\|topk(1, Severity) by UID, Unit\_Name, Attack\_Type<br />\| if(Severity matches "ALE\*", "ALERT", if(Severity matches "EME\*", "EMERGENCY", if(Severity matches "CRI\*", "CRITICAL", if(Severity matches "ERR\*", "ERROR", if(Severity matches "WAR\*", "WARNING", if(Severity matches "NOT\*", "NOTICE", if(Severity matches "INF\*", "INFORMATION", if(Severity matches "DEB\*", "DEBUG", "")))))))) as Severity\_Level<br />\| where !isEmpty(Severity\_Level)<br />\| count as Count by Severity\_Level|
|Barracuda WAF/Security Analysis|Blocked Traffic by Unit Name|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis|\_sourceCategory={{\_sourceCategory}} " WF " "DENY"<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| where Action in ("DENY")<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{Attack\_Type}}" = "\*", true, Attack\_Type matches "{{Attack\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Severity}}" = "\*", true, Severity matches "{{Severity}}") AND if ("{{UID}}" = "\*", true, UID matches "{{UID}}") AND if ("{{Action}}" = "\*", true, Action matches "{{Action}}")<br />\|topk(1, Unit\_Name) by UID, Unit\_Name, Attack\_Type<br />\| count as Count by Unit\_Name<br />\| sort by Count<br />\| limit 5|
|Barracuda WAF/Traffic Analysis|Browsers and Operating Systems|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Client Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Service\_Ip, 3 as Service\_Port<br />\| parse regex "HTTP\\/[\\d\\.]+\\s+\\d+\\s+\\d+\\s+\\d+\\s+\\d+\\s+\\d+\\s+\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\s+\\d+\\s+\\d+\\s+(?\<agent\>.+)"<br />\| if (agent matches "\*Windows \*" OR agent matches "\*Win32\*" OR agent matches "\*Win64\*","Windows","") as OS <br />\| if (agent matches "\*Macintosh\*" OR agent matches "\*Darwin/\*" OR agent matches "\*Mac OS\*","Mac OS",OS) as OS <br />\| if (agent matches "\* CrOS \*","Chrome OS",OS) as OS<br />\| if (agent matches "\*Linux\*","Linux",OS) as OS <br />\| if (agent matches "\*iPad\*","iPad",OS) as OS <br />\| if (agent matches "\*iPhone\*","iPhone",OS) as OS <br />\|  if (agent matches "\*Android\*","Android",OS) as OS <br />\| if (agent matches "\*Windows Phone\*","Windows Phone",OS) as OS <br />\| if (OS == "","Other",OS) as OS <br />\| if (agent matches "Mozilla/\*; rv:\*)\*","Mozilla","") as Browser<br />\| if (agent matches "\*MSIE\*","Internet Explorer",Browser) as Browser <br />\| if (agent matches "\*Firefox\*","Firefox",Browser) as Browser <br />\| if (agent matches "\*Safari\*","Safari",Browser) as Browser <br />\| if (OS=="Android" AND agent matches "\*WebKit\*","WebKit",Browser) as Browser<br />\| if ((OS=="iPhone" OR OS=="iPad") AND (agent matches "\*Mobile/\*" OR agent matches "\*AppleWebKit\*(KHTML\*Gecko)\*"),"Mobile Safari",Browser) as Browser<br />\| if (browser ="" AND OS=="Mac OS" AND agent matches "Mozilla/\* (Macintosh;\*(KHTML, like Gecko)\*","Safari",Browser) as Browser <br />\| if (agent matches "\*MobileSafari/\*","Mobile Safari",Browser) as Browser<br />\| if (agent matches "\*Chrome\*","Chrome",Browser) as Browser <br />\| if (agent matches "Opera\*","Opera",Browser) as Browser <br />\| if (agent matches "Dolphin\*","Dolphin",Browser) as Browser <br />\|  if (Browser == "","Other",Browser) as Browser<br />\| where OS matches "{{OS}}"<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}")<br />\|count as Count by OS, Browser<br />\| transpose row OS column Browser|
|Barracuda WAF/Traffic Analysis|Cache Hit Percentage|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Traffic Overview|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Service\_Ip, 3 as Service\_Port, 15 as Cache\_Hit<br />\| concat(Service\_Ip, ":", Service\_Port) as Service<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}")<br />\|count as totalCount, sum(Cache\_Hit) as Cache\_Hit<br />\| toInt((Cache\_Hit/totalCount)\*100) as CacheOffloadPct<br />\| fields -totalCount, Cache\_Hit|
|Barracuda WAF/Traffic Analysis|Cache Hit Percentage Over Time|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Service Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Service\_Ip, 3 as Service\_Port, 15 as Cache\_Hit<br />\| concat(Service\_Ip, ":", Service\_Port) as Service<br />\| timeslice 5m<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Cache\_Hit}}" = "\*", true, Cache\_Hit matches "{{Cache\_Hit}}")<br />\|count as totalCount, sum(Cache\_Hit) as Cache\_Hit by \_timeslice , Service<br />\| toInt((Cache\_Hit/totalCount)\*100) as CacheOffloadPct<br />\| filter Service in (sum(CacheOffloadPct) by Service \| top 5 Service by \_sum )<br />\| fields -totalCount, Cache\_Hit<br />\| transpose row \_timeslice column Service<br />\| fillmissing timeslice(5m)|
|Barracuda WAF/Traffic Analysis|Cache Performance|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Service Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Service\_Ip, 3 as Service\_Port, 15 as Cache\_Hit<br />\| if(Cache\_hit=1, "Hit", "Miss") as Cache\_hit<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Cache\_Hit}}" = "\*", true, Cache\_Hit matches "{{Cache\_Hit}}")<br />\|count as Count by Cache\_Hit|
|Barracuda WAF|Change Type Over Time|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - Admin Activities|\_sourceCategory={{\_sourceCategory}} " AUDIT "<br />\| parse regex "(?\<Activity\_Time\>\\d\\d\\d\\d-\\d\\d-\\d\\d\\s{1,3}.\* )(?\<Unit\_Name\>[^ ]+) AUDIT(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Admin\_Name, 3 as Client\_Type, 4 as Login\_Ip, 5 as Login\_Port, 6 as Transaction\_Type, 7 as Transaction\_Id, 8 as Command\_Name, 9 as Change\_Type, 10 as Object\_Type, 11 as Object\_Name, 12 as Variable\_Name, 13 as Old\_Value, 14 as New\_Value, 15 as Additional\_Data<br />\| if(Change\_Type in ("SET", "ADD", "DELETE"), Change\_Type, "NONE") as Change\_Type<br />\| timeslice 30m<br />\|where if ("{{Transaction\_Type}}" = "\*", true, Transaction\_Type matches "{{Transaction\_Type}}") AND if ("{{Admin\_Name}}" = "\*", true, Admin\_Name matches "{{Admin\_Name}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Login\_Ip}}" = "\*", true, Login\_Ip matches "{{Login\_Ip}}") AND if ("{{Client\_Type}}" = "\*", true, Client\_Type matches "{{Client\_Type}}") AND if ("{{Change\_Type}}" = "\*", true, Change\_Type matches "{{Change\_Type}}")<br />\|count as Count by \_timeslice, Change\_type<br />\| fillmissing timeslice(30m), values("SET", "ADD", "DELETE", "NONE") in Change\_Type<br />\| transpose row \_timeslice column Change\_type|
|Barracuda WAF|Client Access Type|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - Admin Activities|\_sourceCategory={{\_sourceCategory}} " AUDIT "<br />\| parse regex "(?\<Activity\_Time\>\\d\\d\\d\\d-\\d\\d-\\d\\d\\s{1,3}.\* )(?\<Unit\_Name\>[^ ]+) AUDIT(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Admin\_Name, 3 as Client\_Type, 4 as Login\_Ip, 5 as Login\_Port, 6 as Transaction\_Type, 7 as Transaction\_Id, 8 as Command\_Name, 9 as Change\_Type, 10 as Object\_Type, 11 as Object\_Name, 12 as Variable\_Name, 13 as Old\_Value, 14 as New\_Value, 15 as Additional\_Data<br />\| where !isEmpty(Client\_Type)<br />\|where if ("{{Transaction\_Type}}" = "\*", true, Transaction\_Type matches "{{Transaction\_Type}}") AND if ("{{Admin\_Name}}" = "\*", true, Admin\_Name matches "{{Admin\_Name}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Login\_Ip}}" = "\*", true, Login\_Ip matches "{{Login\_Ip}}") AND if ("{{Client\_Type}}" = "\*", true, Client\_Type matches "{{Client\_Type}}") AND if ("{{Change\_Type}}" = "\*", true, Change\_Type matches "{{Change\_Type}}")<br />\|count as Count by Client\_Type<br />\| sort by Count<br />\| limit 10|
|Barracuda WAF/Traffic Analysis|Client Errors Over Time|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 4 as Client\_Ip, 2 as Service\_Ip, 3 as Service\_Port, 21 as Response\_Type, 12 as Response\_Code, 17 as Backend\_Server<br />\| tolong(Response\_Code) <br />\| where Response\_Code \>= 400 AND Response\_Code \< 500<br />\| timeslice 15m<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Response\_Type}}" = "\*", true, Response\_Type matches "{{Response\_Type}}") AND if ("{{Backend\_Server}}" = "\*", true, Backend\_Server matches "{{Backend\_Server}}")<br />\|count as count by \_timeslice, Response\_Code<br />\| transpose row \_timeslice column Response\_Code<br />\| fillmissing timeslice(15m)|
|Barracuda WAF/Traffic Analysis|Client Location 4XX Errors|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 4 as Client\_Ip, 2 as Service\_Ip, 3 as Service\_Port, 21 as Response\_Type, 12 as Response\_Code, 17 as Backend\_Server<br />\| tolong(Response\_Code)<br />\| where Response\_Code \>= 400 AND Response\_Code \< 500<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Response\_Type}}" = "\*", true, Response\_Type matches "{{Response\_Type}}") AND if ("{{Backend\_Server}}" = "\*", true, Backend\_Server matches "{{Backend\_Server}}")<br />\|count by Client\_Ip<br />\|  lookup latitude, longitude from geo://location on ip = Client\_Ip|
|Barracuda WAF|CPU usage Alert Outlier|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - System Activities|\_sourceCategory={{\_sourceCategory}} " SYS "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) SYS(?\<Log\>.\*)"<br />\| parse field=log " \* \* \* \*" as Module\_Name, Log\_Level, Event\_Id, Log\_Details<br />\| where Log\_Details matches "CPU Usage \*"<br />\| timeslice 10m<br />\|where if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Module\_Name}}" = "\*", true, Module\_Name matches "{{Module\_Name}}")<br />\|count as Count by \_timeslice<br />\| fillmissing timeslice(10m)<br />\| outlier Count|
|Barracuda WAF|Destination Locations|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - Network Activities|\_sourceCategory={{\_sourceCategory}} " NF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) NF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \*" as Log\_Level, Protocol, Source\_Ip, Source\_Port, Destination\_Ip, Destination\_Port, ACL\_Policy, ACL\_Name, Log\_Details<br />\|where if ("{{ACL\_Name}}" = "\*", true, ACL\_Name matches "{{ACL\_Name}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Log\_Level}}" = "\*", true, Log\_Level matches "{{Log\_Level}}") AND if ("{{Destination\_Ip}}" = "\*", true, Destination\_Ip matches "{{Destination\_Ip}}")<br />\|count by Destination\_Ip<br />\| lookup latitude, longitude from geo://location on ip = Destination\_Ip|
|Barracuda WAF/Traffic Analysis|Error Responses by Server|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic|\_sourceCategory={{\_sourceCategory}} " TR " SERVER<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 4 as Client\_Ip, 2 as Service\_Ip, 3 as Service\_Port, 21 as Response\_Type, 12 as Response\_Code, 17 as Backend\_Server<br />\| tolong(Response\_Code)<br />\| where Response\_Type = "SERVER" AND Response\_Code \>= 400<br />\| timeslice 15m<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Response\_Type}}" = "\*", true, Response\_Type matches "{{Response\_Type}}") AND if ("{{Backend\_Server}}" = "\*", true, Backend\_Server matches "{{Backend\_Server}}")<br />\|count as Count by \_timeslice, Backend\_Server<br />\| filter Backend\_Server in (sum(Count) by Backend\_Server \| top 5 Backend\_Server by \_sum)<br />\| transpose row \_timeslice column Backend\_Server<br />\| fillmissing timeslice(15m)|
|Barracuda WAF|Firmware Storage Alert Outlier|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - System Activities|\_sourceCategory={{\_sourceCategory}} " SYS "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) SYS(?\<Log\>.\*)"<br />\| parse field=log " \* \* \* \*" as Module\_Name, Log\_Level, Event\_Id, Log\_Details<br />\| where Log\_Details matches "Firmware storage exceeds \*"<br />\| timeslice 10m<br />\|where if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Module\_Name}}" = "\*", true, Module\_Name matches "{{Module\_Name}}")<br />\|count as Count by \_timeslice<br />\| fillmissing timeslice(10m)<br />\| outlier Count|
|Barracuda WAF/Traffic Analysis|HTTP Methods Over Time|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 8 as Http\_Method, 4 as Client\_Ip, 2 as Service\_Ip, 3 as Service\_Port, 21 as Response\_Type, 17 as Backend\_Server<br />\| timeslice 15m<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Response\_Type}}" = "\*", true, Response\_Type matches "{{Response\_Type}}") AND if ("{{Backend\_Server}}" = "\*", true, Backend\_Server matches "{{Backend\_Server}}")<br />\|count as count by \_timeslice, Http\_Method<br />\| transpose row \_timeslice column Http\_Method<br />\| fillmissing timeslice(15m)|
|Barracuda WAF/Traffic Analysis|HTTP Protocols Over Time|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 9 as Http\_Protocol, 4 as Client\_Ip, 2 as Service\_Ip, 3 as Service\_Port, 21 as Response\_Type, 17 as Backend\_Server<br />\| timeslice 15m<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Response\_Type}}" = "\*", true, Response\_Type matches "{{Response\_Type}}") AND if ("{{Backend\_Server}}" = "\*", true, Backend\_Server matches "{{Backend\_Server}}")<br />\|count as count by \_timeslice, Http\_Protocol<br />\| transpose row \_timeslice column Http\_Protocol<br />\| fillmissing timeslice(15m)|
|Barracuda WAF/Traffic Analysis|HTTP Versions|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 11 as HttpVersion, 4 as Client\_Ip, 2 as Service\_Ip, 3 as Service\_Port, 21 as Response\_Type, 17 as Backend\_Server<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Response\_Type}}" = "\*", true, Response\_Type matches "{{Response\_Type}}") AND if ("{{Backend\_Server}}" = "\*", true, Backend\_Server matches "{{Backend\_Server}}")<br />\|count as Count by HttpVersion<br />\| sort by Count<br />\| limit 5|
|Barracuda WAF|Log Level Distribution - System Logs|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - System Activities|\_sourceCategory={{\_sourceCategory}} " SYS "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) SYS(?\<Log\>.\*)"<br />\| parse field=log " \* \* \* \*" as Module\_Name, Log\_Level, Event\_Id, Log\_Details<br />\| if(Log\_Level matches "ALE\*", "ALERT", if(Log\_Level matches "EME\*", "EMERGENCY", if(Log\_Level matches "CRI\*", "CRITICAL", if(Log\_Level matches "ERR\*", "ERROR", if(Log\_Level matches "WAR\*", "WARNING", if(Log\_Level matches "NOT\*", "NOTICE", if(Log\_Level matches "INF\*", "INFORMATION", if(Log\_Level matches "DEB\*", "DEBUG", "")))))))) as Log\_Level<br />\|where if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Module\_Name}}" = "\*", true, Module\_Name matches "{{Module\_Name}}")<br />\|count as Count by Log\_Level<br />\| sort by Count<br />\| limit 10|
|Barracuda WAF|Log Storage Alert Outlier|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - System Activities|\_sourceCategory={{\_sourceCategory}} " SYS "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) SYS(?\<Log\>.\*)"<br />\| parse field=log " \* \* \* \*" as Module\_Name, Log\_Level, Event\_Id, Log\_Details<br />\| where Log\_Details matches "Log storage exceeds \*"<br />\| timeslice 10m<br />\|where if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Module\_Name}}" = "\*", true, Module\_Name matches "{{Module\_Name}}")<br />\|count as Count by \_timeslice<br />\| fillmissing timeslice(10m)<br />\| outlier Count|
|Barracuda WAF|Memory Usage Alert Outlier|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - System Activities|\_sourceCategory={{\_sourceCategory}} " SYS "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) SYS(?\<Log\>.\*)"<br />\| parse field=log " \* \* \* \*" as Module\_Name, Log\_Level, Event\_Id, Log\_Details<br />\| where Log\_Details matches "Memory Usage exceeds \*"<br />\| timeslice 10m<br />\|where if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Module\_Name}}" = "\*", true, Module\_Name matches "{{Module\_Name}}")<br />\|count as Count by \_timeslice<br />\| fillmissing timeslice(10m)<br />\| outlier Count|
|Barracuda WAF|Modified Object Types|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - Admin Activities|\_sourceCategory={{\_sourceCategory}} " AUDIT "<br />\| parse regex "(?\<Activity\_Time\>\\d\\d\\d\\d-\\d\\d-\\d\\d\\s{1,3}.\* )(?\<Unit\_Name\>[^ ]+) AUDIT(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Admin\_Name, 3 as Client\_Type, 4 as Login\_Ip, 5 as Login\_Port, 6 as Transaction\_Type, 7 as Transaction\_Id, 8 as Command\_Name, 9 as Change\_Type, 10 as Object\_Type, 11 as Object\_Name, 12 as Variable\_Name, 13 as Old\_Value, 14 as New\_Value, 15 as Additional\_Data<br />\|where if ("{{Transaction\_Type}}" = "\*", true, Transaction\_Type matches "{{Transaction\_Type}}") AND if ("{{Admin\_Name}}" = "\*", true, Admin\_Name matches "{{Admin\_Name}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Login\_Ip}}" = "\*", true, Login\_Ip matches "{{Login\_Ip}}") AND if ("{{Client\_Type}}" = "\*", true, Client\_Type matches "{{Client\_Type}}") AND if ("{{Change\_Type}}" = "\*", true, Change\_Type matches "{{Change\_Type}}")<br />\|count as Count by Object\_Type<br />\| sort by Count<br />\| limit 10|
|Barracuda WAF|Outlier - Allowed Network Traffic|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - Network Activities|\_sourceCategory={{\_sourceCategory}} " NF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) NF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \*" as Log\_Level, Protocol, Source\_Ip, Source\_Port, Destination\_Ip, Destination\_Port, ACL\_Policy, ACL\_Name, Log\_Details<br />\| where ACL\_Policy matches "ALLOW"<br />\| timeslice 10m<br />\|where if ("{{ACL\_Name}}" = "\*", true, ACL\_Name matches "{{ACL\_Name}}") AND if ("{{ACL\_Policy}}" = "\*", true, ACL\_Policy matches "{{ACL\_Policy}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Log\_Level}}" = "\*", true, Log\_Level matches "{{Log\_Level}}") AND if ("{{Destination\_Ip}}" = "\*", true, Destination\_Ip matches "{{Destination\_Ip}}") AND if ("{{Source\_Ip}}" = "\*", true, Source\_Ip matches "{{Source\_Ip}}")<br />\|count as Count by \_timeslice<br />\| fillmissing timeslice(10m)<br />\| outlier Count|
|Barracuda WAF/Security Analysis|Outlier - Allowed Traffic|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis|\_sourceCategory={{\_sourceCategory}} " WF " ("LOG" OR "WARN" OR "CLOAK")<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| where Action in ("LOG", "WARN", "CLOAK")<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{Attack\_Type}}" = "\*", true, Attack\_Type matches "{{Attack\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Severity}}" = "\*", true, Severity matches "{{Severity}}") AND if ("{{UID}}" = "\*", true, UID matches "{{UID}}") AND if ("{{Action}}" = "\*", true, Action matches "{{Action}}")<br />\|topk(1, Client\_Ip) by UID, Unit\_Name, Attack\_Type<br />\| timeslice 10m<br />\| count as Count by \_timeslice<br />\| fillmissing timeslice(10m)<br />\| outlier Count|
|Barracuda WAF|Outlier - Blocked Network Traffic|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - Network Activities|\_sourceCategory={{\_sourceCategory}} " NF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) NF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \*" as Log\_Level, Protocol, Source\_Ip, Source\_Port, Destination\_Ip, Destination\_Port, ACL\_Policy, ACL\_Name, Log\_Details<br />\| where ACL\_Policy matches "DENY"<br />\| timeslice 10m<br />\|where if ("{{ACL\_Name}}" = "\*", true, ACL\_Name matches "{{ACL\_Name}}") AND if ("{{ACL\_Policy}}" = "\*", true, ACL\_Policy matches "{{ACL\_Policy}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Log\_Level}}" = "\*", true, Log\_Level matches "{{Log\_Level}}") AND if ("{{Destination\_Ip}}" = "\*", true, Destination\_Ip matches "{{Destination\_Ip}}") AND if ("{{Source\_Ip}}" = "\*", true, Source\_Ip matches "{{Source\_Ip}}")<br />\|count as Count by \_timeslice<br />\| fillmissing timeslice(10m)<br />\| outlier Count|
|Barracuda WAF/Security Analysis|Outlier - Blocked Traffic|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis|\_sourceCategory={{\_sourceCategory}} " WF " "DENY"<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| where Action in ("DENY")<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{Attack\_Type}}" = "\*", true, Attack\_Type matches "{{Attack\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Severity}}" = "\*", true, Severity matches "{{Severity}}") AND if ("{{UID}}" = "\*", true, UID matches "{{UID}}") AND if ("{{Action}}" = "\*", true, Action matches "{{Action}}")<br />\|topk(1, Client\_Ip) by UID, Unit\_Name, Attack\_Type<br />\| timeslice 10m<br />\| count as Count by \_timeslice<br />\| fillmissing timeslice(10m)<br />\| outlier Count|
|Barracuda WAF/Traffic Analysis|Outlier - Client Errors(4XX)|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Traffic Overview|\_sourceCategory={{\_sourceCategory}} " TR "   <br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Service\_Ip, 3 as Service\_Port, 12 as Response\_Code<br />\| num(Response\_Code)<br />\| where Response\_Code \>= 400 AND Response\_Code \< 500<br />\| timeslice 30m<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}")<br />\|count as Count by \_timeslice<br />\| fillmissing timeslice(30m)<br />\| outlier Count|
|Barracuda WAF/Traffic Analysis|Outlier - Server Errors(5XX)|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Traffic Overview|\_sourceCategory={{\_sourceCategory}} " TR "   <br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Service\_Ip, 3 as Service\_Port, 12 as Response\_Code<br />\| num(Response\_Code)<br />\| where Response\_Code \>= 500 AND Response\_Code \< 600<br />\| timeslice 30m<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}")<br />\|count as Count by \_timeslice<br />\| fillmissing timeslice(30m)<br />\| outlier Count|
|Barracuda WAF/Traffic Analysis|Outlier - Service Performance|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Traffic Overview|\_sourceCategory={{\_sourceCategory}} " TR "   <br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Service\_Ip, 3 as Service\_Port, 16 as Time\_Taken<br />\| timeslice 15m<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}")<br />\|avg(Time\_Taken) as Avg\_Res\_Time\_ms by \_timeslice<br />\| fillmissing timeslice(15m)<br />\| outlier Avg\_Res\_Time\_ms|
|Barracuda WAF/Traffic Analysis|Performance (ms) by Service|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Traffic Overview|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Service\_Ip, 16 as Time\_Taken, 3 as Service\_Port<br />\| concat(Service\_Ip,":",Service\_Port) as Service<br />\| timeslice 15m<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}")<br />\|avg(Time\_Taken) as Avg\_Res\_Time\_ms by Service, \_timeslice<br />\| filter Service in (sum(Avg\_Res\_Time\_ms) by Service \| top 5 Service by \_sum )<br />\| transpose row \_timeslice column Service<br />\| fillmissing timeslice(15m)|
|Barracuda WAF/Security Analysis|Recent - Attacks|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Threat Analysis|\_sourceCategory={{\_sourceCategory}} " WF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as messageDate<br />\| count by messageDate, Unit\_Name, UID, Action, Severity, Attack\_Type, Client\_Ip, Service\_Ip, Service\_Port, Rule, Rule\_Type, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer<br />\| sort by messageDate<br />\| fields - \_count<br />\| limit 50|
|Barracuda WAF|Recent - Audit Logs|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - Admin Activities|\_sourceCategory={{\_sourceCategory}} " AUDIT "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) AUDIT(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Admin\_Name, 3 as Client\_Type, 4 as Login\_Ip, 5 as Login\_Port, 6 as Transaction\_Type, 7 as Transaction\_Id, 8 as Command\_Name, 9 as Change\_Type, 10 as Object\_Type, 11 as Object\_Name, 12 as Variable\_Name, 13 as Old\_Value, 14 as New\_Value, 15 as Additional\_Data<br />\|where Change\_Type matches "{{Change\_Type}}" AND Transaction\_Type matches "{{Transaction\_Type}}" AND Unit\_Name matches "{{Unit\_Name}}"<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as messageDate<br />\|where if ("{{Admin\_Name}}" = "\*", true, Admin\_Name matches "{{Admin\_Name}}") AND if ("{{Login\_Ip}}" = "\*", true, Login\_Ip matches "{{Login\_Ip}}") AND if ("{{Client\_Type}}" = "\*", true, Client\_Type matches "{{Client\_Type}}")<br />\|count as Count by messageDate, Unit\_Name, Admin\_Name, Client\_Type, Login\_Ip, Login\_Port, Transaction\_Type, Transaction\_Id, Command\_Name, Change\_Type, Object\_Type, Object\_Name, Variable\_Name, Old\_Value, New\_Value, Additional\_Data<br />\| fields - Count<br />\| sort by messageDate<br />\| limit 100|
|Barracuda WAF|Recent - Cluster Activities|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - System Activities|\_sourceCategory={{\_sourceCategory}} " SYS " ("Deleted" OR "Adding Peer node" OR "Failed to send message to peer dispatcher" OR "Received message from peer node")<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) SYS(?\<Log\>.\*)"<br />\| parse field=log " \* \* \* \*" as Module\_Name, Log\_Level, Event\_Id, Log\_Details<br />\| parse regex field=Log\_Details "(?\<Peer\_Ip\>\\d{1,3}.\\d{1,3}.\\d{1,3}.\\d{1,3})"<br />\| sort by \_messageTime<br />\|where if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Module\_Name}}" = "\*", true, Module\_Name matches "{{Module\_Name}}")<br />\|first(Log\_Details) as Log\_Details by Unit\_Name, Peer\_Ip<br />\| if(Log\_Details matches "Deleted\*", "Node Deleted", if(Log\_Details matches "\*Adding Peer\*", "Node Added", if(Log\_Details matches "\*Failed to send\*", "Node Down",  if(Log\_details matches "\*Received message from peer node\*", "Node Up", "")))) as Peer\_Status<br />\| where !isEmpty(Peer\_Status)<br />\| count by Unit\_Name, Peer\_Ip, Peer\_Status, Log\_details<br />\| fields - \_count|
|Barracuda WAF|Recent Alerts in System Logs|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - System Activities|\_sourceCategory={{\_sourceCategory}} " SYS "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) SYS(?\<Log\>.\*)"<br />\| parse field=log " \* \* \* \*" as Module\_Name, Log\_Level, Event\_Id, Log\_Details<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as messageDate<br />\| if(Log\_Level matches "ALE\*", "ALERT", if(Log\_Level matches "EME\*", "EMERGENCY", if(Log\_Level matches "CRI\*", "CRITICAL", if(Log\_Level matches "ERR\*", "ERROR", if(Log\_Level matches "WAR\*", "WARNING", if(Log\_Level matches "NOT\*", "NOTICE", if(Log\_Level matches "INF\*", "INFORMATION", if(Log\_Level matches "DEB\*", "DEBUG", "")))))))) as Log\_Level<br />\| where Log\_Level matches "{{Log\_Level}}" AND Unit\_Name matches "{{Unit\_Name}}" AND Module\_Name matches "{{Module\_Name}}"<br />\| count as Count by messageDate, Unit\_Name, Event\_Id, Log\_Level, Module\_Name, Log\_Details<br />\| sort by messageDate<br />\| fields - Count<br />\| limit 50|
|Barracuda WAF/Traffic Analysis|Requests by Service IPs|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Traffic Overview|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Service\_Ip, 3 as Service\_Port<br />\| concat(Service\_Ip,":",Service\_Port) as Service<br />\| timeslice 15m<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}")<br />\|count as count by \_timeslice, Service<br />\| filter Service in (sum(Count) by Service \| top 5 Service by \_sum )<br />\| transpose row \_timeslice column Service<br />\| fillmissing timeslice(15m)|
|Barracuda WAF/Traffic Analysis|Response Code Distribution|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Traffic Overview|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Service\_Ip, 3 as Service\_Port, 4 as Client\_Ip,12 as Response\_Code<br />\| num(Response\_Code)<br />\| if(Response\_Code\>=500, "Server Errors (5xx)" , if(Response\_Code \>= 400, "Client Errors (4xx)", if(Response\_Code \>= 300, "Redirection Responses (3xx)",if(Response\_Code \>= 200, "Successful Responses (2xx)", "")))) as Response\_Code<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|count as count by Response\_Code<br />\| sort by count|
|Barracuda WAF/Security Analysis|Rule Distribution|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview|\_sourceCategory={{\_sourceCategory}} " WF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{severity}}" = "\*", true, severity matches "{{severity}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{Rule\_Type}}" = "\*", true, Rule\_Type matches "{{Rule\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|topk(1, User\_Agent) by UID, Unit\_Name, Attack\_Type<br />\| count as Count by Rule<br />\| sort by Count<br />\| limit 5|
|Barracuda WAF/Security Analysis|Rule Type Distribution|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview|\_sourceCategory={{\_sourceCategory}} " WF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{severity}}" = "\*", true, severity matches "{{severity}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{Rule\_Type}}" = "\*", true, Rule\_Type matches "{{Rule\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|topk(1, Rule\_Type) by UID, Unit\_Name, Attack\_Type<br />\| count as Count by Rule\_Type<br />\| sort by Count<br />\| limit 5|
|Barracuda WAF/Traffic Analysis|Server Errors(5XX) Over Time|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 4 as Client\_Ip, 2 as Service\_Ip, 3 as Service\_Port, 21 as Response\_Type, 12 as Response\_Code, 17 as Backend\_Server<br />\| tolong(Response\_Code) <br />\| where Response\_Code \>= 500 AND Response\_Code \< 600<br />\| timeslice 15m<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Response\_Type}}" = "\*", true, Response\_Type matches "{{Response\_Type}}") AND if ("{{Backend\_Server}}" = "\*", true, Backend\_Server matches "{{Backend\_Server}}")<br />\|count as count by \_timeslice, Response\_Code<br />\| transpose row \_timeslice column Response\_Code<br />\| fillmissing timeslice(15m)|
|Barracuda WAF|Severity - Network Logs|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - Network Activities|\_sourceCategory={{\_sourceCategory}} " NF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) NF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \*" as Log\_Level, Protocol, Source\_Ip, Source\_Port, Destination\_Ip, Destination\_Port, ACL\_Policy, ACL\_Name, Log\_Details<br />\| if(Log\_Level matches "ALE\*", "ALERT", if(Log\_Level matches "EME\*", "EMERGENCY", if(Log\_Level matches "CRI\*", "CRITICAL", if(Log\_Level matches "ERR\*", "ERROR", if(Log\_Level matches "WAR\*", "WARNING", if(Log\_Level matches "NOT\*", "NOTICE", if(Log\_Level matches "INF\*", "INFORMATION", if(Log\_Level matches "DEB\*", "DEBUG", "")))))))) as Severity<br />\|where if ("{{ACL\_Name}}" = "\*", true, ACL\_Name matches "{{ACL\_Name}}") AND if ("{{ACL\_Policy}}" = "\*", true, ACL\_Policy matches "{{ACL\_Policy}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Log\_Level}}" = "\*", true, Log\_Level matches "{{Log\_Level}}") AND if ("{{Destination\_Ip}}" = "\*", true, Destination\_Ip matches "{{Destination\_Ip}}") AND if ("{{Source\_Ip}}" = "\*", true, Source\_Ip matches "{{Source\_Ip}}")<br />\|count as Count by Severity<br />\| sort by Count<br />\| limit 10|
|Barracuda WAF|Source Locations|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - Network Activities|\_sourceCategory={{\_sourceCategory}} " NF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) NF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \*" as Log\_Level, Protocol, Source\_Ip, Source\_Port, Destination\_Ip, Destination\_Port, ACL\_Policy, ACL\_Name, Log\_Details<br />\|where if ("{{ACL\_Name}}" = "\*", true, ACL\_Name matches "{{ACL\_Name}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Log\_Level}}" = "\*", true, Log\_Level matches "{{Log\_Level}}") AND if ("{{Source\_Ip}}" = "\*", true, Source\_Ip matches "{{Source\_Ip}}")<br />\|count by Source\_Ip<br />\| lookup latitude, longitude from geo://location on ip = Source\_Ip|
|Barracuda WAF|Top 10 ACL Rules|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - Network Activities|\_sourceCategory={{\_sourceCategory}} " NF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) NF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \*" as Log\_Level, Protocol, Source\_Ip, Source\_Port, Destination\_Ip, Destination\_Port, ACL\_Policy, ACL\_Name, Log\_Details<br />\|where if ("{{ACL\_Name}}" = "\*", true, ACL\_Name matches "{{ACL\_Name}}") AND if ("{{ACL\_Policy}}" = "\*", true, ACL\_Policy matches "{{ACL\_Policy}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Log\_Level}}" = "\*", true, Log\_Level matches "{{Log\_Level}}")<br />\|count as Count by ACL\_Name<br />\| sort by Count<br />\| limit 10|
|Barracuda WAF|Top 10 Destinations|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - Network Activities|\_sourceCategory={{\_sourceCategory}} " NF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) NF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \*" as Log\_Level, Protocol, Source\_Ip, Source\_Port, Destination\_Ip, Destination\_Port, ACL\_Policy, ACL\_Name, Log\_Details<br />\| concat(Destination\_Ip, ":", Destination\_Port) as Destination<br />\|where if ("{{ACL\_Name}}" = "\*", true, ACL\_Name matches "{{ACL\_Name}}") AND if ("{{ACL\_Policy}}" = "\*", true, ACL\_Policy matches "{{ACL\_Policy}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Log\_Level}}" = "\*", true, Log\_Level matches "{{Log\_Level}}") AND if ("{{Destination\_Ip}}" = "\*", true, Destination\_Ip matches "{{Destination\_Ip}}")<br />\|count as Count by Destination<br />\| sort by Count<br />\| limit 10|
|Barracuda WAF|Top 10 Module Names|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - System Activities|\_sourceCategory={{\_sourceCategory}} " SYS "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) SYS(?\<Log\>.\*)"<br />\| parse field=log " \* \* \* \*" as Module\_Name, Log\_Level, Event\_Id, Log\_Details<br />\|where if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Module\_Name}}" = "\*", true, Module\_Name matches "{{Module\_Name}}")<br />\|count as Count by Module\_Name<br />\| sort by Count<br />\| limit 10|
|Barracuda WAF/Traffic Analysis|Top 10 OS Versions|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Client Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Service\_Ip, 3 as Service\_Port<br />\| parse regex "HTTP\\/[\\d\\.]+\\s+\\d+\\s+\\d+\\s+\\d+\\s+\\d+\\s+\\d+\\s+\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\s+\\d+\\s+\\d+\\s+(?\<agent\>.+)"<br />\| parse regex field=agent "(?\<OS\>Mac OS) (?\<Version\>[^;\\)]+?)(?:;\|\\))" nodrop <br />\| parse regex field=agent "(?\<OS\>Windows)(?: NT \| )(?\<Version\>[\\d.]+)" nodrop <br />\| parse regex field=agent "(?\<OS\>Linux) (?\<Version\>\\S+?)(?:\\)\|;)" nodrop <br />\| parse regex field=agent "\\((?\<OS\>iPhone).+? CPU iPhone OS (?\<Version\>.+?) like Mac"  nodrop <br />\| parse regex field=agent "\\((?\<OS\>iPad).+? CPU OS (?\<Version\>.+?) like Mac"  nodrop <br />\| parse regex field=agent " (?\<OS\>Android) (?\<Version\>[\\d\\.]+)" nodrop <br />\| parse regex "(?\<OS\>SAMSUNG).+?(?\<Version\>(?:GT-\\w+\|SGH-\\w+\|SPH-\\w+\|SCH-\\w+))"<br />\| where OS!=""<br />\| where OS matches "{{OS}}"<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}")<br />\|count as Count by OS, Version<br />\| sort by Count<br />\| limit 10|
|Barracuda WAF|Top 10 Sources|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - Network Activities|\_sourceCategory={{\_sourceCategory}} " NF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) NF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \*" as Log\_Level, Protocol, Source\_Ip, Source\_Port, Destination\_Ip, Destination\_Port, ACL\_Policy, ACL\_Name, Log\_Details<br />\| concat(Source\_Ip, ":", Source\_Port) as Source<br />\|where if ("{{ACL\_Name}}" = "\*", true, ACL\_Name matches "{{ACL\_Name}}") AND if ("{{ACL\_Policy}}" = "\*", true, ACL\_Policy matches "{{ACL\_Policy}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Log\_Level}}" = "\*", true, Log\_Level matches "{{Log\_Level}}") AND if ("{{Source\_Ip}}" = "\*", true, Source\_Ip matches "{{Source\_Ip}}")<br />\|count as Count by Source<br />\| sort by Count<br />\| limit 10|
|Barracuda WAF|Top 10 Transaction Types|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - Admin Activities|\_sourceCategory={{\_sourceCategory}} " AUDIT "<br />\| parse regex "(?\<Activity\_Time\>\\d\\d\\d\\d-\\d\\d-\\d\\d\\s{1,3}.\* )(?\<Unit\_Name\>[^ ]+) AUDIT(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Admin\_Name, 3 as Client\_Type, 4 as Login\_Ip, 5 as Login\_Port, 6 as Transaction\_Type, 7 as Transaction\_Id, 8 as Command\_Name, 9 as Change\_Type, 10 as Object\_Type, 11 as Object\_Name, 12 as Variable\_Name, 13 as Old\_Value, 14 as New\_Value, 15 as Additional\_Data<br />\| where !isEmpty(Transaction\_Type)<br />\|where if ("{{Transaction\_Type}}" = "\*", true, Transaction\_Type matches "{{Transaction\_Type}}") AND if ("{{Admin\_Name}}" = "\*", true, Admin\_Name matches "{{Admin\_Name}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Login\_Ip}}" = "\*", true, Login\_Ip matches "{{Login\_Ip}}") AND if ("{{Client\_Type}}" = "\*", true, Client\_Type matches "{{Client\_Type}}") AND if ("{{Change\_Type}}" = "\*", true, Change\_Type matches "{{Change\_Type}}")<br />\|count as Count by Transaction\_Type<br />\| sort by Count<br />\| limit 10|
|Barracuda WAF/Traffic Analysis|Top 5 Backend Servers|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 4 as Client\_Ip, 2 as Service\_Ip, 3 as Service\_Port, 21 as Response\_Type, 17 as Backend\_Server<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Response\_Type}}" = "\*", true, Response\_Type matches "{{Response\_Type}}") AND if ("{{Backend\_Server}}" = "\*", true, Backend\_Server matches "{{Backend\_Server}}")<br />\|count as Count by Backend\_Server<br />\| sort by Count<br />\| limit 5|
|Barracuda WAF/Traffic Analysis|Top 5 Clients Causing 4XX Erros|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 4 as Client\_Ip, 2 as Service\_Ip, 3 as Service\_Port, 21 as Response\_Type, 12 as Response\_Code, 17 as Backend\_Server<br />\| tolong(Response\_Code)<br />\| where Response\_Code \>= 400 AND Response\_Code \< 500<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Response\_Type}}" = "\*", true, Response\_Type matches "{{Response\_Type}}") AND if ("{{Backend\_Server}}" = "\*", true, Backend\_Server matches "{{Backend\_Server}}")<br />\|count as count by Client\_Ip<br />\| sort count <br />\| limit 5|
|Barracuda WAF/Traffic Analysis|Top 5 URIs - 404 Responses|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 4 as Client\_Ip, 25 as URL, 2 as Service\_Ip, 3 as Service\_Port, 21 as Response\_Type, 12 as Response\_Code, 17 as Backend\_Server<br />\| tolong(Response\_Code)<br />\| where Response\_Code = 404<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Response\_Type}}" = "\*", true, Response\_Type matches "{{Response\_Type}}") AND if ("{{Backend\_Server}}" = "\*", true, Backend\_Server matches "{{Backend\_Server}}")<br />\|count as count by URL<br />\| sort count <br />\| limit 5|
|Barracuda WAF|Top Admins|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - Admin Activities|\_sourceCategory={{\_sourceCategory}} " AUDIT "<br />\| parse regex "(?\<Activity\_Time\>\\d\\d\\d\\d-\\d\\d-\\d\\d\\s{1,3}.\* )(?\<Unit\_Name\>[^ ]+) AUDIT(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Admin\_Name, 3 as Client\_Type, 4 as Login\_Ip, 5 as Login\_Port, 6 as Transaction\_Type, 7 as Transaction\_Id, 8 as Command\_Name, 9 as Change\_Type, 10 as Object\_Type, 11 as Object\_Name, 12 as Variable\_Name, 13 as Old\_Value, 14 as New\_Value, 15 as Additional\_Data<br />\| where Transaction\_Type = "LOGIN"<br />\|where if ("{{Transaction\_Type}}" = "\*", true, Transaction\_Type matches "{{Transaction\_Type}}") AND if ("{{Admin\_Name}}" = "\*", true, Admin\_Name matches "{{Admin\_Name}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Login\_Ip}}" = "\*", true, Login\_Ip matches "{{Login\_Ip}}") AND if ("{{Client\_Type}}" = "\*", true, Client\_Type matches "{{Client\_Type}}") AND if ("{{Change\_Type}}" = "\*", true, Change\_Type matches "{{Change\_Type}}")<br />\|count as Count by Admin\_Name<br />\| sort by Count<br />\| limit 10|
|Barracuda WAF/Security Analysis|Top Attacked Domains|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview|\_sourceCategory={{\_sourceCategory}} " WF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| split URL delim='/' extract 1 as Host<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{severity}}" = "\*", true, severity matches "{{severity}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{Rule\_Type}}" = "\*", true, Rule\_Type matches "{{Rule\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|topk(1, Host) by UID, Unit\_Name, Attack\_Type<br />\| count as Count by Host<br />\| sort by Count<br />\| limit 5|
|Barracuda WAF/Security Analysis|Top Attacked Services|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview|\_sourceCategory={{\_sourceCategory}} " WF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| concat(Service\_Ip,":",Service\_Port) as Service<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{severity}}" = "\*", true, severity matches "{{severity}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{Rule\_Type}}" = "\*", true, Rule\_Type matches "{{Rule\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|topk(1, Service) by UID, Unit\_Name, Attack\_Type<br />\| count as Count by Service<br />\| sort by Count<br />\| limit 5|
|Barracuda WAF/Security Analysis|Top Attacked URLs|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview|\_sourceCategory={{\_sourceCategory}} " WF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{severity}}" = "\*", true, severity matches "{{severity}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{Rule\_Type}}" = "\*", true, Rule\_Type matches "{{Rule\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|topk(1, URL) by UID, Unit\_Name, Attack\_Type<br />\| count as Count by URL<br />\| sort by Count<br />\| limit 10|
|Barracuda WAF/Security Analysis|Top Attackers|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview|\_sourceCategory={{\_sourceCategory}} " WF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{severity}}" = "\*", true, severity matches "{{severity}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{Rule\_Type}}" = "\*", true, Rule\_Type matches "{{Rule\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|topk(1, Client\_Ip) by UID, Unit\_Name, Attack\_Type<br />\| count as Count by Client\_Ip<br />\| sort by Count<br />\| limit 5|
|Barracuda WAF/Security Analysis|Top Attacking Country/Region|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview|\_sourceCategory={{\_sourceCategory}} " WF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{severity}}" = "\*", true, severity matches "{{severity}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{Rule\_Type}}" = "\*", true, Rule\_Type matches "{{Rule\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|topk(1, Client\_Ip) by UID, Unit\_Name, Attack\_Type<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip<br />\| count by country\_name<br />\| sort \_count<br />\| limit 5|
|Barracuda WAF/Security Analysis|Top Attacking Referrers|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview|\_sourceCategory={{\_sourceCategory}} " WF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\| where !(isEmpty(Referrer) OR Referrer="\\"-\\"")<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{severity}}" = "\*", true, severity matches "{{severity}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{Rule\_Type}}" = "\*", true, Rule\_Type matches "{{Rule\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|topk(1, Referrer) by UID, Unit\_Name, Attack\_Type<br />\| count as Count by Referrer<br />\| sort by Count<br />\| limit 5|
|Barracuda WAF/Security Analysis|Top Attacking User Agents|Logs|Installed Apps/Barracuda WAF/Security Analysis/Barracuda WAF - Security Overview|\_sourceCategory={{\_sourceCategory}} " WF "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) WF(?\<Log\>.\*)"<br />\| parse field=Log " \* \* \* \* \* \* \* \* \* \* [\*] \* \* \* \* \\"\*\\" \* \* \* \* \*" as Severity, Attack\_Type, Client\_Ip, Client\_Port, Service\_Ip, Service\_Port, Rule, Rule\_Type, Action, Follow\_Up\_Action, Attack\_Details, Method, URL, Protocol, Session\_Id, User\_Agent, Proxy\_Ip, Proxy\_Port, User, Referrer, UID<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{severity}}" = "\*", true, severity matches "{{severity}}") AND if ("{{Rule}}" = "\*", true, Rule matches "{{Rule}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{Rule\_Type}}" = "\*", true, Rule\_Type matches "{{Rule\_Type}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|topk(1, User\_Agent) by UID, Unit\_Name, Attack\_Type<br />\| count as Count by User\_Agent<br />\| sort by Count<br />\| limit 5|
|Barracuda WAF/Traffic Analysis|Top Bots Observed|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Client Traffic|\_sourceCategory={{\_sourceCategory}} " TR " ("Googlebot" OR "AskJeeves" OR "Digger" OR "Lycos" OR "msnbot" OR "Inktomi Slurp" OR "Yahoo" OR "Nutch" OR "bingbot" OR<br />"BingPreview" OR "Mediapartners-Google" OR "proximic" OR "AhrefsBot" OR "AdsBot-Google" OR "Ezooms" OR "AddThis.com" OR "facebookexternalhit" OR<br />"MetaURI" OR "Feedfetcher-Google" OR "PaperLiBot" OR "TweetmemeBot" OR "Sogou web spider" OR "GoogleProducer" OR "RockmeltEmbedder" OR<br />"ShareThisFetcher" OR "YandexBot" OR "rogerbot-crawler" OR "ShowyouBot" OR "Baiduspider" OR "Sosospider" OR "Exabot" OR "Slackbot")<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 29 as agent, 2 as Service\_Ip, 3 as Service\_Port<br />\| parse regex field=agent "(?\<bot\_name\>facebook)externalhit?\\W+" nodrop<br />\| parse regex field=agent "Feedfetcher-(?\<bot\_name\>Google?)\\S+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>PaperLiBot?)/.+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>TweetmemeBot?)/.+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>msn?)bot\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Nutch?)-.+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Google?)bot\\W" nodrop<br />\| parse regex field=agent "Feedfetcher-(?\<bot\_name\>Google?)\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Yahoo?)!\\s+Slurp[;/].+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>bing?)bot\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Bing?)Preview\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Sogou?)\\s+web\\s" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Yandex?)Bot\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>rogerbot?)\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>AddThis\\.com?)\\s+robot\\s+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>ShareThis?)Fetcher/.+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Ahrefs?)Bot/.+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>MetaURI?)\\s+API/.+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Showyou?)Bot\\s+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Google?)Producer;" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Ezooms?)\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Rockmelt?)Embedder\\s+" nodrop <br />\| parse regex field=agent "(?\<bot\_name\>Sosospider?)\\W" nodrop <br />\| parse regex field=agent "(?\<bot\_name\>Baidu?)spider" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Exabot?)\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Slackbot?)\\W" nodrop<br />\| where bot\_name != ""<br />\| if (bot\_name="bing","Bing",bot\_name) as bot\_name<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}")<br />\|count by bot\_name<br />\| sort by \_count <br />\| limit 10|
|Barracuda WAF/Traffic Analysis|Top Client Errors|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 4 as Client\_Ip, 2 as Service\_Ip, 3 as Service\_Port, 21 as Response\_Type, 12 as Response\_Code, 17 as Backend\_Server<br />\| tolong(Response\_Code) <br />\| where Response\_Code \>= 400 AND Response\_Code \< 500<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Response\_Type}}" = "\*", true, Response\_Type matches "{{Response\_Type}}") AND if ("{{Backend\_Server}}" = "\*", true, Backend\_Server matches "{{Backend\_Server}}")<br />\|count as count by Response\_Code|
|Barracuda WAF/Traffic Analysis|Top Clients by Bandwidth|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Client Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 4 as Client\_Ip, 13 as Bytes\_Sent, 2 as Service\_Ip, 3 as Service\_Port<br />\| round((Bytes\_Sent / 1024),2) as Bandwidth<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|sum(Bandwidth) as Bandwidth\_Consumed\_KB by Client\_Ip<br />\| sort by Bandwidth\_Consumed\_KB<br />\| limit 5|
|Barracuda WAF/Traffic Analysis|Top Clients by Requests|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Client Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 4 as Client\_Ip, 2 as Service\_Ip, 3 as Service\_Port<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|count as Count by Client\_Ip<br />\| sort by Count<br />\| limit 5|
|Barracuda WAF/Traffic Analysis|Top Countries by Requests|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Client Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 4 as Client\_Ip, 2 as Service\_Ip, 3 as Service\_Port<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|count by Client\_Ip<br />\|  lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip<br />\| where !isNull(country\_name) AND country\_name !=""<br />\| sum(\_count) as Count by country\_name<br />\| sort by Count<br />\| limit 5|
|Barracuda WAF/Traffic Analysis|Top Domains by Bandwidth|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Service Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 10 as Domain, 13 as Bytes\_Sent, 2 as Service\_Ip, 3 as Service\_Port<br />\| round((Bytes\_Sent / 1024),2) as Bandwidth<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}")<br />\|sum(Bandwidth) as Bandwidth\_Consumed\_KB by Domain<br />\| sort by Bandwidth\_Consumed\_KB<br />\| limit 10|
|Barracuda WAF/Traffic Analysis|Top Domains by Requests|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Service Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 10 as Domain, 2 as Service\_Ip, 3 as Service\_Port<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}")<br />\|count as Count by Domain<br />\| sort by Count<br />\| limit 5|
|Barracuda WAF/Traffic Analysis|Top Referrers|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Client Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 27 as referrer, 2 as Service\_Ip, 3 as Service\_Port<br />\| where !isNull(referrer) AND referrer!="-"<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}")<br />\|count as Count by referrer<br />\| sort by Count<br />\| limit 5|
|Barracuda WAF/Traffic Analysis|Top Server Errors|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 4 as Client\_Ip, 2 as Service\_Ip, 3 as Service\_Port, 21 as Response\_Type, 12 as Response\_Code, 17 as Backend\_Server<br />\| tolong(Response\_Code) <br />\| where Response\_Code \>= 500 AND Response\_Code \< 600<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Response\_Type}}" = "\*", true, Response\_Type matches "{{Response\_Type}}") AND if ("{{Backend\_Server}}" = "\*", true, Backend\_Server matches "{{Backend\_Server}}")<br />\|count as count by Response\_Code|
|Barracuda WAF/Traffic Analysis|Top Services by Bandwidth|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Service Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Service\_Ip, 3 as Service\_Port<br />\| concat(Service\_Ip,":",Service\_Port) as Service<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}")<br />\|count as Count by Service<br />\| sort by Count<br />\| limit 5|
|Barracuda WAF/Traffic Analysis|Top Services by Bandwidth|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Service Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Service\_Ip, 13 as Bytes\_Sent, 3 as Service\_Port<br />\| concat(Service\_Ip,":",Service\_Port) as Service<br />\| round((Bytes\_Sent / 1024),2) as Bandwidth<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}")<br />\|sum(Bandwidth) as Bandwidth\_Consumed\_KB by Service<br />\| sort by Bandwidth\_Consumed\_KB<br />\| limit 10|
|Barracuda WAF/Traffic Analysis|Top URL by Bandwidth|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Service Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 25 as URL, 13 as Bytes\_Sent, 2 as Service\_Ip, 3 as Service\_Port<br />\| round((Bytes\_Sent / 1024),2) as Bandwidth<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}")<br />\|sum(Bandwidth) as Bandwidth\_Consumed\_KB by URL<br />\| sort by Bandwidth\_Consumed\_KB<br />\| limit 5|
|Barracuda WAF/Traffic Analysis|Top URL by Requests|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Service Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 25 as URL, 2 as Service\_Ip, 3 as Service\_Port<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}")<br />\|count as Count by URL<br />\| sort by Count<br />\| limit 5|
|Barracuda WAF/Traffic Analysis|Total Request Size Over Time|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 14 as Bytes\_Received, 4 as Client\_Ip, 2 as Service\_Ip, 3 as Service\_Port, 21 as Response\_Type, 17 as Backend\_Server<br />\| timeslice 15m<br />\| round((Bytes\_Received / 1024),2) as Bytes\_Received<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Response\_Type}}" = "\*", true, Response\_Type matches "{{Response\_Type}}") AND if ("{{Backend\_Server}}" = "\*", true, Backend\_Server matches "{{Backend\_Server}}")<br />\|sum(Bytes\_Received) as Total\_Request\_Size\_KB by \_timeslice<br />\| fillmissing timeslice(15m)|
|Barracuda WAF/Traffic Analysis|Total Response Size Over Time|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Server Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 13 as Bytes\_Sent, 4 as Client\_Ip, 2 as Service\_Ip, 3 as Service\_Port, 21 as Response\_Type, 17 as Backend\_Server<br />\| timeslice 15m<br />\| round((Bytes\_Sent / 1024),2) as Bytes\_Sent<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{url}}" = "\*", true, url matches "{{url}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}") AND if ("{{Response\_Type}}" = "\*", true, Response\_Type matches "{{Response\_Type}}") AND if ("{{Backend\_Server}}" = "\*", true, Backend\_Server matches "{{Backend\_Server}}")<br />\|sum(Bytes\_Sent) as Total\_Response\_Size\_KB by \_timeslice<br />\| fillmissing timeslice(15m)|
|Barracuda WAF|Unsuccessful Login Over Time|Logs|Installed Apps/Barracuda WAF/Barracuda WAF - Admin Activities|\_sourceCategory={{\_sourceCategory}} " AUDIT " "UNSUCCESSFUL\_LOGIN"<br />\| parse regex "(?\<Activity\_Time\>\\d\\d\\d\\d-\\d\\d-\\d\\d\\s{1,3}.\* )(?\<Unit\_Name\>[^ ]+) AUDIT(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Admin\_Name, 3 as Client\_Type, 4 as Login\_Ip, 5 as Login\_Port, 6 as Transaction\_Type, 7 as Transaction\_Id, 8 as Command\_Name, 9 as Change\_Type, 10 as Object\_Type, 11 as Object\_Name, 12 as Variable\_Name, 13 as Old\_Value, 14 as New\_Value, 15 as Additional\_Data<br />\| where Transaction\_Type matches "UNSUCCESSFUL\_LOGIN"<br />\| timeslice 15m<br />\|where if ("{{Transaction\_Type}}" = "\*", true, Transaction\_Type matches "{{Transaction\_Type}}") AND if ("{{Admin\_Name}}" = "\*", true, Admin\_Name matches "{{Admin\_Name}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Login\_Ip}}" = "\*", true, Login\_Ip matches "{{Login\_Ip}}") AND if ("{{Client\_Type}}" = "\*", true, Client\_Type matches "{{Client\_Type}}") AND if ("{{Change\_Type}}" = "\*", true, Change\_Type matches "{{Change\_Type}}")<br />\|count as Count by \_timeslice<br />\| fillmissing timeslice(15m)|
|Barracuda WAF/Traffic Analysis|Visitor Platforms by Requests|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Client Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Service\_Ip, 3 as Service\_Port<br />\| parse regex "HTTP\\/[\\d\\.]+\\s+\\d+\\s+\\d+\\s+\\d+\\s+\\d+\\s+\\d+\\s+\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\s+\\d+\\s+\\d+\\s+(?\<agent\>.+)"<br />\| if (agent matches "\*iPad\*" OR agent matches "\*iPhone\*" OR agent matches "\*Android\*" OR agent matches "\*BlackBerry\*" OR agent matches "\*Galaxy\*" OR agent matches "LGE-\*" OR agent matches "SCH-\*" OR agent matches "\*HUAWEI-\*" OR agent matches "\*SAMSUNG\*" OR agent matches "\*samsung\*" OR agent matches "Dalvik/\*" OR agent matches "Nokia\*" OR agent matches "LG-\*" OR agent matches "\*CFNetwork\*"  OR agent matches "\*UP.Browser/\*" OR agent matches "\*QQ\*rowser\*" OR agent matches "\*NetFront/\*" OR agent matches "\*Windows Phone\*" OR agent matches "\*Mobile Safari\*" OR agent matches "\*iemobile\*","Mobile","") as Platform<br />\| if (agent matches "\*Windows\*" OR agent matches "\*Win64\*" OR agent matches "\*Win32\*" OR agent matches "\*i686\*" OR agent matches "\*x86\*","PC",Platform) as Platform<br />\| if (agent matches "\*Macintosh\*" OR agent matches "\*Mac OS\*","Mac",Platform) as Platform<br />\| if (Platform = "","bots/unknown",Platform) as Platform<br />\|where Platform matches "{{Platform}}"<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}")<br />\|count as Count by Platform|
|Barracuda WAF/Traffic Analysis|Visitors Platform by Bandwidth|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Client Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 13 as Bytes\_Sent, 2 as Service\_Ip, 3 as Service\_Port<br />\| parse regex "HTTP\\/[\\d\\.]+\\s+\\d+\\s+\\d+\\s+\\d+\\s+\\d+\\s+\\d+\\s+\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\s+\\d+\\s+\\d+\\s+(?\<agent\>.+)"<br />\| if (agent matches "\*iPad\*" OR agent matches "\*iPhone\*" OR agent matches "\*Android\*" OR agent matches "\*BlackBerry\*" OR agent matches "\*Galaxy\*" OR agent matches "LGE-\*" OR agent matches "SCH-\*" OR agent matches "\*HUAWEI-\*" OR agent matches "\*SAMSUNG\*" OR agent matches "\*samsung\*" OR agent matches "Dalvik/\*" OR agent matches "Nokia\*" OR agent matches "LG-\*" OR agent matches "\*CFNetwork\*"  OR agent matches "\*UP.Browser/\*" OR agent matches "\*QQ\*rowser\*" OR agent matches "\*NetFront/\*" OR agent matches "\*Windows Phone\*" OR agent matches "\*Mobile Safari\*" OR agent matches "\*iemobile\*","Mobile","") as Platform<br />\| if (agent matches "\*Windows\*" OR agent matches "\*Win64\*" OR agent matches "\*Win32\*" OR agent matches "\*i686\*" OR agent matches "\*x86\*","PC",Platform) as Platform<br />\| if (agent matches "\*Macintosh\*" OR agent matches "\*Mac OS\*","Mac",Platform) as Platform<br />\| if (Platform = "","bots/unknown",Platform) as Platform<br />\| round((Bytes\_Sent / 1024),2) as Bandwidth<br />\|where Platform matches "{{Platform}}"<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}")<br />\|sum(Bandwidth) as BandWidth\_Consumed\_KB by Platform<br />\| sort by BandWidth\_Consumed\_KB|
|Barracuda WAF/Traffic Analysis|Visitors Platform Over Time|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Traffic Overview|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 2 as Service\_Ip, 3 as Service\_Port<br />\| parse regex "HTTP\\/[\\d\\.]+\\s+\\d+\\s+\\d+\\s+\\d+\\s+\\d+\\s+\\d+\\s+\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\s+\\d+\\s+\\d+\\s+(?\<agent\>.+)"<br />\| if (agent matches "\*iPad\*" OR agent matches "\*iPhone\*" OR agent matches "\*Android\*" OR agent matches "\*BlackBerry\*" OR agent matches "\*Galaxy\*" OR agent matches "LGE-\*" OR agent matches "SCH-\*" OR agent matches "\*HUAWEI-\*" OR agent matches "\*SAMSUNG\*" OR agent matches "\*samsung\*" OR agent matches "Dalvik/\*" OR agent matches "Nokia\*" OR agent matches "LG-\*" OR agent matches "\*CFNetwork\*"  OR agent matches "\*UP.Browser/\*" OR agent matches "\*QQ\*rowser\*" OR agent matches "\*NetFront/\*" OR agent matches "\*Windows Phone\*" OR agent matches "\*Mobile Safari\*" OR agent matches "\*iemobile\*","Mobile","") as Type<br />\| if (agent matches "\*Windows\*" OR agent matches "\*Win64\*" OR agent matches "\*Win32\*" OR agent matches "\*i686\*" OR agent matches "\*x86\*","PC",Type) as Type<br />\| if (agent matches "\*Macintosh\*" OR agent matches "\*Mac OS\*","Mac",Type) as Type<br />\| if (type = "","bots/unknown",Type) as Type<br />\| timeslice 15m<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}")<br />\|count as Count by \_timeslice, Type<br />\| fillmissing timeslice(15m), values("Mac", "Mobile", "PC", "bots/unknown") in Type<br />\| transpose row \_timeslice column type|
|Barracuda WAF/Traffic Analysis|Visits by Countries Over Time|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Client Traffic|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 4 as Client\_Ip, 2 as Service\_Ip, 3 as Service\_Port<br />\| timeslice 30m<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|count by \_timeslice, Client\_Ip<br />\| lookup country\_name from geo://location on ip = Client\_Ip<br />\| where !isNull(country\_name) AND country\_name !=""<br />\| sum(\_count) by \_timeslice, country\_name<br />\| transpose row \_timeslice column country\_name<br />\| fillmissing timeslice(30m)|
|Barracuda WAF/Traffic Analysis|Worldwide Location of Clients|Logs|Installed Apps/Barracuda WAF/Traffic Analysis/Barracuda WAF - Traffic Overview|\_sourceCategory={{\_sourceCategory}} " TR "<br />\| parse regex "(?\<Unit\_Name\>[^ ]+) TR(?\<Log\>.\*)"<br />\| split Log delim=' ' extract 4 as Client\_Ip, 2 as Service\_Ip, 3 as Service\_Port<br />\|where if ("{{Service\_Port}}" = "\*", true, Service\_Port matches "{{Service\_Port}}") AND if ("{{Service\_Ip}}" = "\*", true, Service\_Ip matches "{{Service\_Ip}}") AND if ("{{Unit\_Name}}" = "\*", true, Unit\_Name matches "{{Unit\_Name}}") AND if ("{{Client\_Ip}}" = "\*", true, Client\_Ip matches "{{Client\_Ip}}")<br />\|count by Client\_Ip<br />\|  lookup latitude, longitude from geo://location on ip = Client\_Ip|

