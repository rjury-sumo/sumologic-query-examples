# Google Cloud SQL
## Sumo Logic App For: Google Cloud SQL
The Sumo Logic app for Google Cloud SQL helps you monitor your usage of Google Cloud SQL. The preconfigured dashboards provide insight into created and deleted resources, messages, authorization failures, user activities, and error logs.
Docs Link: [Google Cloud SQL](https://help.sumologic.com/?cid=22675)

## Searches

### Log Searches

- **Aborted Connections**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs 
- **Actions Over Time**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs 
- **Audit Event by Severity**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs 
- **Authorization Failures**: from Dashboard: Google Cloud SQL/Google Cloud SQL - Overview - New 
- **Authorization Failures**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs 
- **Avg Execution Time by Slow SQL Cmds**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Slow Query Logs 
- **Crash Recovery Attempts Over Time**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs 
- **Created Resources**: from Dashboard: Google Cloud SQL/Google Cloud SQL - Overview - New 
- **Created Resources Over Time**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs 
- **Deleted Resources**: from Dashboard: Google Cloud SQL/Google Cloud SQL - Overview - New 
- **Deleted Resources Over Time**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs 
- **Error Events - Outlier**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs 
- **Failed Auth Attempts**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs 
- **Failed Auth Attempts by Host**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs 
- **Failed Auth Attempts by User**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs 
- **Failed Authentication - Details**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs 
- **Failed Authentication - Trend**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs 
- **Failed Authentication - User Location**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs 
- **Google Cloud SQL - Authorization Failures**: from Search: Google Cloud SQL/Google Cloud SQL - Authorization Failures 
- **Google Cloud SQL - Authorization Failures**: from Search: Installed Apps/Google Cloud SQL/Google Cloud SQL - Authorization Failures 
- **Google Cloud SQL - Common Error Log Messages**: from Search: Google Cloud SQL/Google Cloud SQL - Common Error Log Messages 
- **Google Cloud SQL - Common Error Log Messages**: from Search: Installed Apps/Google Cloud SQL/Google Cloud SQL - Common Error Log Messages 
- **Google Cloud SQL - Instance Activity**: from Search: Google Cloud SQL/Google Cloud SQL - Instance Activity 
- **Google Cloud SQL - Instance Activity**: from Search: Installed Apps/Google Cloud SQL/Google Cloud SQL - Instance Activity 
- **Google Cloud SQL - User Activity**: from Search: Installed Apps/Google Cloud SQL/Google Cloud SQL - User Activity 
- **Google Cloud SQL - User Activity**: from Search: Google Cloud SQL/Google Cloud SQL - User Activity 
- **Location of Activity**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs 
- **Location of Activity**: from Dashboard: Google Cloud SQL/Google Cloud SQL - Overview - New 
- **Log Level**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs 
- **Log Level - Trend**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs 
- **Messages by Region**: from Dashboard: Google Cloud SQL/Google Cloud SQL - Overview - New 
- **Messages Over Time by Severity**: from Dashboard: Google Cloud SQL/Google Cloud SQL - Overview - New 
- **Messages Over Time by Severity**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs 
- **Operations by Instance**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs 
- **Operations by Resources**: from Dashboard: Google Cloud SQL/Google Cloud SQL - Overview - New 
- **Recent Authorization Failures**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs 
- **Recent Error Activities**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs 
- **Recent User Activities**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs 
- **Recent Warning Events**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs 
- **Server Start and Shutdown Events Over Time**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs 
- **Slow Queries**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Slow Query Logs 
- **Slow Queries - Time Compare**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Slow Query Logs 
- **Slow Queries by Hosts**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Slow Query Logs 
- **Slow Queries Over Time**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Slow Query Logs 
- **Slow Query by Cmd Type**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Slow Query Logs 
- **Stopped Server**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs 
- **Top 10 Slow Queries by Average Execution Time**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Slow Query Logs 
- **Top 10 Users by Messages**: from Dashboard: Google Cloud SQL/Google Cloud SQL - Overview - New 
- **Top IP Firing Slow Queries**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Slow Query Logs 
- **Top Note Events**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs 
- **Top Users Firing Slow Queries**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Slow Query Logs 
- **Top Warnings**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs

### Metric Searches

- **Available for failover**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance 
- **Avg CPU Utilization**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview 
- **Avg CPU Utilization**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview 
- **Avg Disk Utilization**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview 
- **Avg Memory Usage**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview 
- **Avg Memory Utilization**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview 
- **Avg Number of Connections**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview 
- **Connections**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - DB Instance 
- **CPU Usage Time**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - DB Instance 
- **CPU Utilization**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - DB Instance 
- **CPU Utilization**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview 
- **Database Info - CPU/Disk/Memory**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview 
- **Database Status**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview 
- **Disk Input/Output Operations**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview 
- **Disk Used by Data Type**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - DB Instance 
- **Disk Utilization**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - DB Instance 
- **Innodb Buffer Pool Pages**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance 
- **Innodb Data (Read, Write)**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance 
- **InnoDB Data Fsync**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance 
- **InnoDB Dictionary Memory (in Bytes)**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance 
- **Innodb Fsyncs - OS, Data**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance 
- **Memory Used (In GB)**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview 
- **Memory Utilization**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - DB Instance 
- **Memory Utilization Distribution**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - DB Instance 
- **Number of Connection**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - DB Instance 
- **Open Tables**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance 
- **Opened Tables Over Time**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance 
- **Queries**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance 
- **Queries Executed**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance 
- **Questions**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance 
- **Received Bytes**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance 
- **Received/Sent Bytes**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - DB Instance 
- **Replica Lag**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance 
- **Replica Lag (in seconds)**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance 
- **Replication Lag**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview 
- **Replication Network Lag**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview 
- **Replication State**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance 
- **Sent Bytes**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance 
- **Swap Used**: from Dashboard: Installed Apps/Google Cloud SQL/Google Cloud SQL - DB Instance

## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Google Cloud SQL|Aborted Connections|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs|\_sourceCategory={{Logsdatasource}}  "Aborted connection"<br />\| json "message.data.textPayload" as message<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse field=message "Aborted connection \* to db: '\*' user: '\*' host: '\*' (\*)" as requestId, database, user, host, errorDetails nodrop<br />\| timeslice 15m<br />\| count as frequency by \_timeslice, database\_id, requestId, database, user, host, errorDetails<br />\| sort by \_timeslice|
|Google Cloud SQL|Actions Over Time|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs|\_sourceCategory={{Logsdatasource}}  data "type":"cloudsql\_database" methodName<br />\| json "message.data.logName" as log\_name<br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com\*"<br />\| json  "message.data.protoPayload.methodName" as method<br />\| json  "message.data.resource.labels.project\_id", "message.data.resource.labels.database\_id", "message.data.resource.labels.region" as project\_id, database\_id, region<br />\| timeslice 1h<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\|count as changes by \_timeslice, method<br />\| transpose row \_timeslice column method|
|Google Cloud SQL|Audit Event by Severity|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs|\_sourceCategory={{Logsdatasource}}  authorizationInfo logName principalEmail resource timestamp "\\"type\\":\\"cloudsql\_database\\""<br />\| json "message.data.logName" as log\_name<br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload" as labels, payload<br />\| json "message.data.severity" as severity<br />\| json "message.data.operation","message.data.operation.last" as operation,islast nodrop<br />\| where (islast="true" or isNull(operation))<br />\| json field=labels "database\_id", "project\_id", "region" as database\_id, project\_id, region<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| count by severity|
|Google Cloud SQL|Authorization Failures|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs|\_sourceCategory={{Logsdatasource}}  authorizationInfo logName principalEmail resource timestamp "\\"type\\":\\"cloudsql\_database\\""<br />\| json "message.data.logName" as log\_name<br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload" as labels, payload<br />\| json field=payload "authenticationInfo.principalEmail", "authorizationInfo[\*]" as user, permissions<br />\| where !isNull(permissions)<br />\| parse regex field=permissions "\\"granted\\":(?\<granted\>[^,]+)" multi<br />\| where granted != "true"<br />\| json field=labels "database\_id", "project\_id", "region" as database\_id, project\_id, region<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| count as failures|
|Google Cloud SQL|Authorization Failures|Logs|Google Cloud SQL/Google Cloud SQL - Overview - New|\_sourceCategory = Labs/GCP/sql authorizationInfo logName principalEmail resource timestamp "\\"type\\":\\"cloudsql\_database\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\""<br />\| where log\_name matches "projects/\*/logs/\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload" as labels, payload<br />\| json field=labels "database\_id", "project\_id", "region" as instance, project, region<br />\| json field=payload "authenticationInfo.principalEmail", "authorizationInfo[\*]" as user, permissions<br />\| where !isNull(permissions)<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\",\\"granted\\":(?\<granted\>[a-z]+)}" multi<br />\| where granted != "true"<br />\|where if ("{{Region}}" = "\*", true, region matches "{{Region}}") AND if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{UserLabels}}" = "\*", true, labels matches "{{UserLabels}}") AND if ("{{Instance}}" = "\*", true, instance matches "{{Instance}}")<br />\|count as failures|
|Google Cloud SQL|Available for failover|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/mysql/replication/available\_for\_failover \| avg |
|Google Cloud SQL|Avg CPU Utilization|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/cpu/utilization  statistic=average \| eval \_value\*100 \| avg |
|Google Cloud SQL|Avg CPU Utilization|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/cpu/utilization statistic=average \| eval \_value\*100 \| avg by project\_id,region,cloud.platform,database\_id |
|Google Cloud SQL|Avg Disk Utilization|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/disk/utilization   statistic=average \| eval \_value\*100 \| avg |
|Google Cloud SQL|Avg Execution Time by Slow SQL Cmds|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Slow Query Logs|\_sourceCategory={{Logsdatasource}}  "User@Host" "Query\_time" <br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql-slow.log"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse regex field=message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @  \\[(?\<ip\_addr\>\\S\*?)\\]" nodrop<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+" nodrop<br />\| parse regex field=query\_block "SET timestamp=(?\<set\_timestamp\>\\d\*);(?:\\\\n\|\\n)(?\<sql\_cmd\>[\\s\\S]\*);" nodrop<br />\| parse regex field=sql\_cmd "[^a-zA-Z]\*(?\<sql\_cmd\_type\>[a-zA-Z]+)(?:\\s\|\\\\n\|\\n)" nodrop<br />\| parse field=sql\_cmd "# administrator command: \*" as admn\_sql\_cmd<br />\| if (sql\_cmd matches "# administrator command: \*", admn\_sql\_cmd, sql\_cmd\_type) as sql\_cmd\_type<br />\| toUpperCase(sql\_cmd\_type)<br />\| fields -query\_block<br />\| timeslice 1h<br />\| avg(query\_time) as avg\_query\_time group by \_timeslice, sql\_cmd\_type<br />\| transpose row \_timeslice column sql\_cmd\_type|
|Google Cloud SQL|Avg Memory Usage|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/memory/utilization  statistic=average \| eval \_value\*100 \| avg by project\_id,region,cloud.platform,database\_id |
|Google Cloud SQL|Avg Memory Utilization|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/memory/utilization  statistic=average \| eval \_value\*100 \| avg |
|Google Cloud SQL|Avg Number of Connections|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/network/connections   statistic=average \| avg by project\_id,region,database\_id |
|Google Cloud SQL|Connections|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - DB Instance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/network/connections   statistic=average \| avg by project\_id, region,database\_id |
|Google Cloud SQL|CPU Usage Time|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - DB Instance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/cpu/usage\_time \| avg by project\_id, region, database\_id |
|Google Cloud SQL|CPU Utilization|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/cpu/utilization statistic=average \| eval \_value\*100 \| avg by project\_id,region,cloud.platform,database\_id |
|Google Cloud SQL|CPU Utilization|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - DB Instance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/cpu/utilization  statistic=average \| eval \_value\*100 \| avg |
|Google Cloud SQL|Crash Recovery Attempts Over Time|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs|\_sourceCategory={{Logsdatasource}}  "Starting crash recovery"<br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql.err"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse regex field=message "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| timeslice 1h<br />\| count as recovery\_attempts by \_timeslice|
|Google Cloud SQL|Created Resources|Logs|Google Cloud SQL/Google Cloud SQL - Overview - New|\_sourceCategory = Labs/GCP/sql authorizationInfo logName principalEmail resource timestamp "\\"type\\":\\"cloudsql\_database\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\""<br />\| where log\_name matches "projects/\*/logs/\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload" as labels, payload<br />\| json field=labels "database\_id", "project\_id", "region" as instance, project, region<br />\| json field=payload "authenticationInfo.principalEmail", "authorizationInfo[\*]" as user, permissions<br />\| where !isNull(permissions)<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\"" multi<br />\| where method = "create"<br />\|where if ("{{Region}}" = "\*", true, region matches "{{Region}}") AND if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{UserLabels}}" = "\*", true, labels matches "{{UserLabels}}") AND if ("{{Instance}}" = "\*", true, instance matches "{{Instance}}")<br />\|count as creations by resource\_type<br />\| sort by creations|
|Google Cloud SQL|Created Resources Over Time|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs|\_sourceCategory={{Logsdatasource}}  data "type":"cloudsql\_database" methodName<br />\| json "message.data.logName" as log\_name<br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload.methodName" as labels, method<br />\| json "message.data.protoPayload.authorizationInfo[\*]" as permissions<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\"" multi<br />\| where method = "create"<br />\| timeslice 1h<br />\| json "message.data.operation","message.data.operation.last" as operation,islast nodrop<br />\| where (islast="true" or isNull(operation))<br />\| json field=labels "database\_id", "project\_id", "region" as database\_id, project\_id, region<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\|count as creations by \_timeslice, resource\_type<br />\| transpose row \_timeslice column resource\_type|
|Google Cloud SQL|Database Info - CPU/Disk/Memory|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/cpu/reserved\_cores  statistic=average \| avg by project\_id, region, database\_id,metric|
|Google Cloud SQL|Database Status|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/up statistic=average \| avg by project\_id,region,database\_id |
|Google Cloud SQL|Deleted Resources|Logs|Google Cloud SQL/Google Cloud SQL - Overview - New|\_sourceCategory = Labs/GCP/sql authorizationInfo logName principalEmail resource timestamp "\\"type\\":\\"cloudsql\_database\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\""<br />\| where log\_name matches "projects/\*/logs/\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload" as labels, payload<br />\| json field=labels "database\_id", "project\_id", "region" as instance, project, region<br />\| json field=payload "authenticationInfo.principalEmail", "authorizationInfo[\*]" as user, permissions<br />\| where !isNull(permissions)<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\"" multi<br />\| where method = "delete"<br />\|where if ("{{Region}}" = "\*", true, region matches "{{Region}}") AND if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{UserLabels}}" = "\*", true, labels matches "{{UserLabels}}") AND if ("{{Instance}}" = "\*", true, instance matches "{{Instance}}")<br />\|count as deletions by resource\_type<br />\| sort by deletions|
|Google Cloud SQL|Deleted Resources Over Time|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs|\_sourceCategory={{Logsdatasource}}  data "type":"cloudsql\_database" methodName<br />\| json "message.data.logName" as log\_name<br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload.methodName" as labels, method<br />\| json "message.data.protoPayload.authorizationInfo[\*]" as permissions<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\"" multi<br />\| where method = "delete"<br />\| timeslice 1h<br />\| json "message.data.operation","message.data.operation.last" as operation,islast nodrop<br />\| where (islast="true" or isNull(operation))<br />\| json field=labels "database\_id", "project\_id", "region" as database\_id, project\_id, region<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\|count as creations by \_timeslice, resource\_type<br />\| transpose row \_timeslice column resource\_type|
|Google Cloud SQL|Disk Input/Output Operations|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/disk/read\_ops\_count \| quantize using sum \| sum by project\_id,region,cloud.platform,database\_id |
|Google Cloud SQL|Disk Used by Data Type|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - DB Instance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/disk/bytes\_used\_by\_data\_type data\_type=\*   statistic=average \| avg by data\_type |
|Google Cloud SQL|Disk Utilization|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - DB Instance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/disk/utilization   statistic=average \| eval \_value\*100 \| avg |
|Google Cloud SQL|Error Events - Outlier|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs|\_sourceCategory={{Logsdatasource}} <br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql.err"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| timeslice 15m<br />\| count as errorEvents by \_timeslice<br />\| outlier errorEvents window=10,threshold=3,consecutive=1,direction=+-|
|Google Cloud SQL|Failed Auth Attempts|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs|\_sourceCategory={{Logsdatasource}}  "Access denied for user"<br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql.err"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| count as eventCount|
|Google Cloud SQL|Failed Auth Attempts by Host|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs|\_sourceCategory={{Logsdatasource}}  "Access denied for user"<br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql.err"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse field=message " [\*] " as LogLevel<br />\| parse field=message " \* [Note] Access denied for user '\*'@'\*' (using \*: \*)" as requestid, user, host, authenticationType, flag nodrop<br />\| parse field=message "[Warning] Access denied for user '\*'@'\*' (using \*: \*)" as user, host, authenticationType, flag nodrop<br />\| parse field=message "[Note] [\*] [\*] Access denied for user '\*'@'\*' (using \*: \*)" as errorcode,subsystem,user,host, authenticationType, flag nodrop<br />\| count as frequency by host<br />\| top 10 host by frequency, host asc|
|Google Cloud SQL|Failed Auth Attempts by User|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs|\_sourceCategory={{Logsdatasource}}  "Access denied for user"<br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql.err"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse field=message " [\*] " as LogLevel<br />\| parse field=message " \* [Note] Access denied for user '\*'@'\*' (using \*: \*)" as requestid, user, host, authenticationType, flag nodrop<br />\| parse field=message "[Warning] Access denied for user '\*'@'\*' (using \*: \*)" as user, host, authenticationType, flag nodrop<br />\| parse field=message "[Note] [\*] [\*] Access denied for user '\*'@'\*' (using \*: \*)" as errorcode,subsystem,user,host, authenticationType, flag nodrop<br />\| count as frequency by user<br />\| top 10 user by frequency, user asc|
|Google Cloud SQL|Failed Authentication - Details|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs|\_sourceCategory={{Logsdatasource}}  "Access denied for user"<br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql.err"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse field=message " [\*] " as LogLevel<br />\| parse field=message " \* [Note] Access denied for user '\*'@'\*' (using \*: \*)" as requestid, user, host, authenticationType, flag nodrop<br />\| parse field=message "[Warning] Access denied for user '\*'@'\*' (using \*: \*)" as user, host, authenticationType, flag nodrop<br />\| parse field=message "[Note] [\*] [\*] Access denied for user '\*'@'\*' (using \*: \*)" as errorcode,subsystem,user,host, authenticationType, flag nodrop<br />\| timeslice 15m<br />\| count as frequency by \_timeslice, requestid, user, host, authenticationType, flag, errorcode, subsystem<br />\| sort by \_timeslice|
|Google Cloud SQL|Failed Authentication - Trend|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs|\_sourceCategory={{Logsdatasource}}  "Access denied for user"<br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql.err"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse field=message " [\*] " as LogLevel<br />\| parse field=message " \* [Note] Access denied for user '\*'@'\*' (using \*: \*)" as requestid, user, host, authenticationType, flag nodrop<br />\| parse field=message "[Warning] Access denied for user '\*'@'\*' (using \*: \*)" as user, host, authenticationType, flag nodrop<br />\| parse field=message "[Note] [\*] [\*] Access denied for user '\*'@'\*' (using \*: \*)" as errorcode,subsystem,user,host, authenticationType, flag nodrop<br />\| timeslice 15m<br />\| count as event\_count by \_timeslice|
|Google Cloud SQL|Failed Authentication - User Location|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs|\_sourceCategory={{Logsdatasource}}  "Access denied for user"<br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql.err"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse field=message " [\*] " as LogLevel<br />\| parse field=message " \* [Note] Access denied for user '\*'@'\*' (using \*: \*)" as requestid, user, host, authenticationType, flag nodrop<br />\| parse field=message "[Warning] Access denied for user '\*'@'\*' (using \*: \*)" as user, host, authenticationType, flag nodrop<br />\| parse field=message "[Note] [\*] [\*] Access denied for user '\*'@'\*' (using \*: \*)" as errorcode,subsystem,user,host, authenticationType, flag nodrop<br />\| parse field=message "[Note] [\*] [\*] Access denied for user '\*'@'\*' (using \*: \*)" as errorcode,subsystem,user,host, authenticationType, flag nodrop<br />\| where host != "localhost"<br />\| count by host<br />\| lookup latitude, longitude from geo://location on ip = host|
|Google Cloud SQL|Google Cloud SQL - Authorization Failures|Logs|Google Cloud SQL/Google Cloud SQL - Authorization Failures|\_sourceCategory = Labs/GCP/sql authorizationInfo callerIp logName principalEmail resource timestamp "\\"type\\":\\"cloudsql\_database\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\""<br />\| where log\_name matches "projects/\*/logs/\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload", "message.data.timestamp" as labels, payload, timestamp<br />\| json field=labels "database\_id", "project\_id", "region" as instance, project, region<br />\| json field=payload "authenticationInfo.principalEmail", "requestMetadata.callerIp", "authorizationInfo[\*]" as user, caller\_ip, permissions<br />\| where !isNull(permissions)<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<action\>[a-zA-Z\\.]+)\\",\\"granted\\":(?\<granted\>[a-z]+)}" multi<br />\| where granted != "true"<br />\| lookup country\_name, city from geo://location on ip=caller\_ip<br />\| count as operations by timestamp, user, action, instance, country\_name, city, caller\_ip<br />\| fields timestamp, user, action, instance, country\_name, city, caller\_ip<br />\| sort by timestamp|
|Google Cloud SQL|Google Cloud SQL - Authorization Failures|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - Authorization Failures|\_sourceCategory={{Logsdatasource}}  authorizationInfo callerIp logName principalEmail resource timestamp "\\"type\\":\\"cloudsql\_database\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\""<br />\| where log\_name matches "projects/\*/logs/\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload", "message.data.timestamp" as labels, payload, timestamp<br />\| json field=labels "database\_id", "project\_id", "region" as instance, project, region<br />\| json field=payload "authenticationInfo.principalEmail", "requestMetadata.callerIp", "authorizationInfo[\*]" as user, caller\_ip, permissions<br />\| where !isNull(permissions)<br />\| parse regex field=permissions "\\"granted\\":(?\<granted\>(.\*(?=,))),\\"permission\\":\\"(?\<action\>(.\*?(?=\\")))" multi<br />\| where granted != "true"<br />\| lookup country\_name, city from geo://location on ip=caller\_ip<br />\| count as operations by timestamp, user, action, instance, country\_name, city, caller\_ip<br />\| fields timestamp, user, action, instance, country\_name, city, caller\_ip<br />\| sort by timestamp|
|Google Cloud SQL|Google Cloud SQL - Common Error Log Messages|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - Common Error Log Messages|\_sourceCategory={{Logsdatasource}}  logName textPayload "\\"type\\":\\"cloudsql\_database\\"" ("\\"severity\\":\\"WARNING\\"" or "\\"severity\\":\\"ERROR\\"" or "\\"severity\\":\\"CRITICAL\\"" or "\\"severity\\":\\"ALERT\\"" or "\\"severity\\":\\"EMERGENCY\\"")<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\""<br />\| where log\_name matches "projects/\*/logs/\*"<br />\| json "message.data.resource.labels", "message.data.textPayload" as labels, text<br />\| json field=labels "database\_id", "project\_id", "region" as instance, project, region<br />\| logreduce(text) by instance<br />\| signature as summarized\_error<br />\| \_count as occurrences<br />\| fields occurrences, instance, summarized\_error<br />\| sort by occurrences|
|Google Cloud SQL|Google Cloud SQL - Common Error Log Messages|Logs|Google Cloud SQL/Google Cloud SQL - Common Error Log Messages|\_sourceCategory = Labs/GCP/sql logName textPayload "\\"type\\":\\"cloudsql\_database\\"" ("\\"severity\\":\\"WARNING\\"" or "\\"severity\\":\\"ERROR\\"" or "\\"severity\\":\\"CRITICAL\\"" or "\\"severity\\":\\"ALERT\\"" or "\\"severity\\":\\"EMERGENCY\\"")<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\""<br />\| where log\_name matches "projects/\*/logs/\*"<br />\| json "message.data.resource.labels", "message.data.textPayload" as labels, text<br />\| json field=labels "database\_id", "project\_id", "region" as instance, project, region<br />\| logreduce(text) by instance<br />\| signature as summarized\_error<br />\| \_count as occurrences<br />\| fields occurrences, instance, summarized\_error<br />\| sort by occurrences|
|Google Cloud SQL|Google Cloud SQL - Instance Activity|Logs|Google Cloud SQL/Google Cloud SQL - Instance Activity|\_sourceCategory = Labs/GCP/sql data "type":"cloudsql\_database" methodName<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\""<br />\| where log\_name matches "projects/\*/logs/\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload.methodName" as labels, method<br />\| json field=labels "database\_id", "project\_id", "region" as instance, project, region<br />\| count as opertations by instance, method<br />\| transpose row instance column method|
|Google Cloud SQL|Google Cloud SQL - Instance Activity|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - Instance Activity|\_sourceCategory={{Logsdatasource}}  data "type":"cloudsql\_database" methodName<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\""<br />\| where log\_name matches "projects/\*/logs/\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload.methodName" as labels, method<br />\| json field=labels "database\_id", "project\_id", "region" as instance, project, region<br />\| count as opertations by instance, method<br />\| transpose row instance column method|
|Google Cloud SQL|Google Cloud SQL - User Activity|Logs|Google Cloud SQL/Google Cloud SQL - User Activity|\_sourceCategory = Labs/GCP/sql logName principalEmail resource timestamp "\\"type\\":\\"cloudsql\_database\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\""<br />\| where log\_name matches "projects/\*/logs/\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload", "message.data.timestamp", "message.data.severity" as labels, payload, timestamp, severity<br />\| json field=labels "database\_id", "project\_id", "region" as instance, project, region<br />\| json field=payload "authenticationInfo.principalEmail", "methodName" as user, method<br />\| count as messages by timestamp, severity, user, instance, method<br />\| sort by timestamp asc<br />\| 1 as operation<br />\| accum operation as operations by user<br />\| fields timestamp, severity, user, instance, method, operations<br />\| sort by timestamp|
|Google Cloud SQL|Google Cloud SQL - User Activity|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - User Activity|\_sourceCategory={{Logsdatasource}}  logName principalEmail resource timestamp "\\"type\\":\\"cloudsql\_database\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\""<br />\| where log\_name matches "projects/\*/logs/\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload", "message.data.timestamp", "message.data.severity" as labels, payload, timestamp, severity<br />\| json field=labels "database\_id", "project\_id", "region" as instance, project, region<br />\| json field=payload "authenticationInfo.principalEmail", "methodName" as user, method<br />\| count as messages by timestamp, severity, user, instance, method<br />\| sort by timestamp asc<br />\| 1 as operation<br />\| accum operation as operations by user<br />\| fields timestamp, severity, user, instance, method, operations<br />\| sort by timestamp|
|Google Cloud SQL|Innodb Buffer Pool Pages|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/mysql/innodb\_buffer\_pool\_pages\_dirty \| avg by project\_id, region, database\_id |
|Google Cloud SQL|Innodb Data (Read, Write)|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/mysql/innodb\_pages\_read  \| avg by project\_id, region, database\_id |
|Google Cloud SQL|InnoDB Data Fsync|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/mysql/innodb\_data\_fsyncs  \| quantize using sum \| sum|
|Google Cloud SQL|InnoDB Dictionary Memory (in Bytes)|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/mysql/innodb/dictionary\_memory \| avg by project\_id,region,database\_id |
|Google Cloud SQL|Innodb Fsyncs - OS, Data|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/mysql/innodb\_data\_fsyncs  \| avg by project\_id, region, database\_id |
|Google Cloud SQL|Location of Activity|Logs|Google Cloud SQL/Google Cloud SQL - Overview - New|\_sourceCategory = Labs/GCP/sql data resource labels callerIp "\\"type\\":\\"cloudsql\_database\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\""<br />\| where log\_name matches "projects/\*/logs/\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload" as labels, payload<br />\| json "message.data.resource.labels", "message.data.protoPayload.requestMetadata.callerIp" as labels, caller\_ip<br />\| json field=payload "authenticationInfo.principalEmail", "authorizationInfo[\*]" as user, permissions<br />\| json field=labels "database\_id", "project\_id", "region" as instance, project, region<br />\| lookup latitude, longitude from geo://location on ip=caller\_ip<br />\|where if ("{{Region}}" = "\*", true, region matches "{{Region}}") AND if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{UserLabels}}" = "\*", true, labels matches "{{UserLabels}}") AND if ("{{Instance}}" = "\*", true, instance matches "{{Instance}}")<br />\|count by latitude, longitude|
|Google Cloud SQL|Location of Activity|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs|\_sourceCategory={{Logsdatasource}}  data resource labels callerIp "\\"type\\":\\"cloudsql\_database\\""<br />\| json "message.data.logName" as log\_name<br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload" as labels, payload<br />\| json "message.data.resource.labels", "message.data.protoPayload.requestMetadata.callerIp" as labels, caller\_ip<br />\| json field=payload "authenticationInfo.principalEmail", "authorizationInfo[\*]" as user, permissions<br />\| json "message.data.operation","message.data.operation.last" as operation,islast nodrop<br />\| where (islast="true" or isNull(operation))<br />\| json field=labels "database\_id", "project\_id", "region" as database\_id, project\_id, region<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| count by caller\_ip<br />\| lookup latitude, longitude from geo://location on ip=caller\_ip<br />\| where !isNull(latitude)|
|Google Cloud SQL|Log Level|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs|\_sourceCategory={{Logsdatasource}} <br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql.err"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse field=message " [\*] " as LogLevel<br />\|count by LogLevel<br />\| sort by \_count, LogLevel asc|
|Google Cloud SQL|Log Level - Trend|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs|\_sourceCategory={{Logsdatasource}} <br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql.err"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse field=message " [\*] " as LogLevel<br />\| timeslice 15m<br />\| count by \_timeslice, LogLevel<br />\| transpose row \_timeslice column LogLevel|
|Google Cloud SQL|Memory Used (In GB)|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/memory/components component=usage  statistic=average  \| eval \_value/(1073741824) \| avg by project\_id,region,cloud.platform,database\_id |
|Google Cloud SQL|Memory Utilization|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - DB Instance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/memory/utilization  statistic=average \| eval \_value\*100 \| avg |
|Google Cloud SQL|Memory Utilization Distribution|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - DB Instance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/memory/components component=usage statistic=average \| avg by project\_id, region, database\_id |
|Google Cloud SQL|Messages by Region|Logs|Google Cloud SQL/Google Cloud SQL - Overview - New|\_sourceCategory = Labs/GCP/sql data resource labels callerIp "\\"type\\":\\"cloudsql\_database\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\""<br />\| where log\_name matches "projects/\*/logs/\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload", "message.data.protoPayload.requestMetadata.callerIp" as labels, payload, caller\_ip nodrop<br />\| json field=payload "authenticationInfo.principalEmail", "authorizationInfo[\*]" as user, permissions nodrop<br />\| json field=labels "database\_id", "project\_id", "region" as instance, project, region<br />\|where if ("{{Region}}" = "\*", true, region matches "{{Region}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{UserLabels}}" = "\*", true, labels matches "{{UserLabels}}") AND if ("{{Instance}}" = "\*", true, instance matches "{{Instance}}")<br />\|count as messages by region<br />\| sort by messages|
|Google Cloud SQL|Messages Over Time by Severity|Logs|Google Cloud SQL/Google Cloud SQL - Overview - New|\_sourceCategory = Labs/GCP/sql authorizationInfo logName principalEmail resource timestamp "\\"type\\":\\"cloudsql\_database\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\""<br />\| where log\_name matches "projects/\*/logs/\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload" as labels, payload<br />\| json field=labels "database\_id", "project\_id", "region" as instance, project, region<br />\| json field=payload "authenticationInfo.principalEmail" as user<br />\| json "message.data.severity" as severity<br />\| timeslice 1h<br />\|where if ("{{Region}}" = "\*", true, region matches "{{Region}}") AND if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{UserLabels}}" = "\*", true, labels matches "{{UserLabels}}") AND if ("{{Instance}}" = "\*", true, instance matches "{{Instance}}")<br />\|count by \_timeslice, severity<br />\| transpose row \_timeslice column severity|
|Google Cloud SQL|Messages Over Time by Severity|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs|\_sourceCategory={{Logsdatasource}}  authorizationInfo logName principalEmail resource timestamp "\\"type\\":\\"cloudsql\_database\\""<br />\| json "message.data.logName" as log\_name<br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload" as labels, payload<br />\| json field=payload "authenticationInfo.principalEmail" as user<br />\| json "message.data.severity" as severity<br />\| json "message.data.operation","message.data.operation.last" as operation,islast nodrop<br />\| where (islast="true" or isNull(operation))<br />\| json field=labels "database\_id", "project\_id", "region" as database\_id, project\_id, region<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| timeslice 1h<br />\| count by \_timeslice, severity<br />\| transpose row \_timeslice column severity|
|Google Cloud SQL|Number of Connection|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - DB Instance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/network/connections   statistic=average \| avg|
|Google Cloud SQL|Open Tables|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/mysql/open\_tables \| avg |
|Google Cloud SQL|Opened Tables Over Time|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/mysql/open\_tables \| avg by project\_id, region, database\_id |
|Google Cloud SQL|Operations by Instance|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs|\_sourceCategory={{Logsdatasource}}  data "type":"cloudsql\_database" methodName<br />\| json "message.data.logName" as log\_name<br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload.methodName" as labels, method<br />\| json field=labels "database\_id", "project\_id", "region" as database\_id, project\_id, region<br />\| json "message.data.operation","message.data.operation.last" as operation,islast nodrop<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| where (islast="true" or isNull(operation))<br />\| count as opertations by database\_id, method<br />\| transpose row database\_id column method|
|Google Cloud SQL|Operations by Resources|Logs|Google Cloud SQL/Google Cloud SQL - Overview - New|\_sourceCategory = Labs/GCP/sql authorizationInfo logName principalEmail resource timestamp "\\"type\\":\\"cloudsql\_database\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\""<br />\| where log\_name matches "projects/\*/logs/\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload" as labels, payload<br />\| json field=labels "database\_id", "project\_id", "region" as instance, project, region<br />\| json field=payload "authenticationInfo.principalEmail", "authorizationInfo[\*]" as user, permissions<br />\| where !isNull(permissions)<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\"" multi<br />\|where if ("{{Region}}" = "\*", true, region matches "{{Region}}") AND if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{UserLabels}}" = "\*", true, labels matches "{{UserLabels}}") AND if ("{{Instance}}" = "\*", true, instance matches "{{Instance}}")<br />\|count as operations by resource\_type, method<br />\| transpose row resource\_type column method|
|Google Cloud SQL|Queries|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/mysql/queries \| quantize using sum \|  sum|
|Google Cloud SQL|Queries Executed|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/mysql/queries \| quantize using sum |
|Google Cloud SQL|Questions|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/mysql/questions  \| quantize using sum \|  sum|
|Google Cloud SQL|Received Bytes|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/mysql/received\_bytes\_count \| avg by project\_id, region, database\_id |
|Google Cloud SQL|Received/Sent Bytes|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - DB Instance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/network/received\_bytes\_count statistic=average \| avg by project\_id, region, database\_id |
|Google Cloud SQL|Recent Authorization Failures|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs|\_sourceCategory={{Logsdatasource}}  authorizationInfo callerIp logName principalEmail resource timestamp "\\"type\\":\\"cloudsql\_database\\""<br />\| json "message.data.logName" as log\_name<br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload", "message.data.timestamp" as labels, payload, timestamp<br />\| json field=payload "authenticationInfo.principalEmail", "requestMetadata.callerIp", "authorizationInfo[\*]" as user, caller\_ip, permissions<br />\| where !isNull(permissions)<br />\| parse regex field=permissions "\\"granted\\":(?\<granted\>[^,]+)" multi<br />\| where granted != "true"<br />\| lookup country\_name, city from geo://location on ip=caller\_ip<br />\| json field=labels "database\_id", "project\_id", "region" as database\_id, project\_id, region<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\|count as operations by timestamp, user, database\_id, country\_name, city, caller\_ip<br />\| fields timestamp, user, database\_id, country\_name, city, caller\_ip<br />\| sort by timestamp|
|Google Cloud SQL|Recent Error Activities|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs|\_sourceCategory={{Logsdatasource}}  logName principalEmail resource timestamp "\\"type\\":\\"cloudsql\_database\\""<br />\| json "message.data.logName" as log\_name<br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload", "message.data.timestamp", "message.data.severity" as labels, payload, timestamp, severity<br />\| where severity="ERROR"<br />\| json field=payload "authenticationInfo.principalEmail", "methodName", "status.code", "status.message" as user, method, errcode, errmessage<br />\| json field=labels "database\_id", "project\_id", "region" as database\_id, project\_id, region<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| count as messages by timestamp, severity, user, database\_id, method, errcode, errmessage<br />\| sort by timestamp asc<br />\| 1 as operation<br />\| accum operation as operations by user<br />\| fields timestamp, database\_id, user, method,errcode, errmessage, operations<br />\| sort by timestamp|
|Google Cloud SQL|Recent User Activities|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - Audit Logs|\_sourceCategory={{Logsdatasource}}  logName principalEmail resource timestamp "\\"type\\":\\"cloudsql\_database\\""<br />\| json "message.data.logName" as log\_name<br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload", "message.data.timestamp", "message.data.severity" as labels, payload, timestamp, severity<br />\| json field=payload "authenticationInfo.principalEmail", "methodName" as user, method<br />\| json "message.data.operation","message.data.operation.last" as operation,islast nodrop<br />\| where (islast="true" or isNull(operation))<br />\| json field=labels "database\_id", "project\_id", "region" as database\_id, project\_id, region<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| count as messages by timestamp, severity, user, database\_id, method<br />\| sort by timestamp asc<br />\| 1 as operation<br />\| accum operation as operations by user<br />\| fields timestamp, severity, user, database\_id, method, operations<br />\| sort by timestamp|
|Google Cloud SQL|Recent Warning Events|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs|\_sourceCategory={{Logsdatasource}}  Warning<br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql.err"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse field=message "[\*] \*" as LogLevel, msgDetails<br />\| where LogLevel = "Warning"<br />\| timeslice 15m<br />\| count as frequency by \_timeslice, msgDetails<br />\| sort by \_timeslice, msgDetails asc|
|Google Cloud SQL|Replica Lag|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/mysql/replication/seconds\_behind\_master \| avg |
|Google Cloud SQL|Replica Lag (in seconds)|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/mysql/replication/seconds\_behind\_master \| avg by project\_id, region, database\_id |
|Google Cloud SQL|Replication Lag|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/replication/replica\_lag statistic=average \| avg by project\_id,region,cloud.platform,database\_id |
|Google Cloud SQL|Replication Network Lag|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - Performance Overview|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/replication/network\_lag  \| avg by project\_id,region,cloud.platform,database\_id |
|Google Cloud SQL|Replication State|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/mysql/replication/last\_io\_errno  \| avg by project\_id, region, database\_id, metric|
|Google Cloud SQL|Sent Bytes|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL Performance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/mysql/sent\_bytes\_count  \| avg by project\_id, region, database\_id |
|Google Cloud SQL|Server Start and Shutdown Events Over Time|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs|\_sourceCategory={{Logsdatasource}}  mysqld ("ready for connections." or "Shutdown complete" or "Terminated." or "Normal shutdown" or "Shutting down" or "starting as process")<br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql.err"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse regex field=message "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| if (ErrorMsg matches "\*ready for connections.\*", "Up","Unknown") as server\_status<br />\| if (ErrorMsg matches "\*Terminated.\*", "Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Normal shutdown\*", "Shutting Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Shutting down\*", "Shutting Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Shutdown complete\*", "Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*starting as process\*", "Starting",server\_status) as server\_status<br />\| timeslice 15m<br />\| count by \_timeslice, server\_status<br />\| transpose row \_timeslice column server\_status|
|Google Cloud SQL|Slow Queries|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Slow Query Logs|\_sourceCategory={{Logsdatasource}}  "User@Host" "Query\_time"<br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql-slow.log"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse regex field=message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @  \\[(?\<ip\_addr\>\\S\*?)\\]" nodrop<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+" nodrop<br />\| parse regex field=query\_block "SET timestamp=(?\<set\_timestamp\>\\d\*);(?:\\\\n\|\\n)(?\<sql\_cmd\>[\\s\\S]\*);" nodrop<br />\| count|
|Google Cloud SQL|Slow Queries - Time Compare|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Slow Query Logs|\_sourceCategory={{Logsdatasource}}  "User@Host" "Query\_time" <br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql-slow.log"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse regex field=message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @  \\[(?\<ip\_addr\>\\S\*?)\\]" nodrop<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+" nodrop<br />\| parse regex field=query\_block "SET timestamp=(?\<set\_timestamp\>\\d\*);(?:\\\\n\|\\n)(?\<sql\_cmd\>[\\s\\S]\*);" nodrop<br />\| timeslice 15m<br />\| count as count by \_timeslice<br />\| fillmissing timeslice(15m)<br />\| compare with timeshift 1d as yesterday, timeshift 1d 7 avg as last\_seven\_days\_avg|
|Google Cloud SQL|Slow Queries by Hosts|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Slow Query Logs|\_sourceCategory={{Logsdatasource}}  "User@Host" "Query\_time" <br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql-slow.log"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse regex field=message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @  \\[(?\<ip\_addr\>\\S\*?)\\]" nodrop<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+" nodrop<br />\| num(query\_time) as query\_time<br />\| where query\_time \>= {{slow\_query\_latency}}<br />\| \_sourceHost as Host<br />\| fields -query\_block<br />\| count as queries\_count by Host <br />\| sort by queries\_count|
|Google Cloud SQL|Slow Queries Over Time|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Slow Query Logs|\_sourceCategory={{Logsdatasource}}  "User@Host" "Query\_time" <br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql-slow.log"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse regex field=message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @  \\[(?\<ip\_addr\>\\S\*?)\\]" nodrop<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+" nodrop<br />\| num(query\_time) as query\_time<br />\| where query\_time \>= 10<br />\| timeslice 1h<br />\| count as queries\_count by \_timeslice|
|Google Cloud SQL|Slow Query by Cmd Type|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Slow Query Logs|\_sourceCategory={{Logsdatasource}}  "User@Host" "Query\_time" <br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql-slow.log"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse regex field=message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @  \\[(?\<ip\_addr\>\\S\*?)\\]" nodrop<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+" nodrop<br />\| parse regex field=query\_block "SET timestamp=(?\<set\_timestamp\>\\d\*);(?:\\\\n\|\\n)(?\<sql\_cmd\>[\\s\\S]\*);" nodrop<br />\| num(query\_time) as query\_time<br />\| where query\_time \>= {{slow\_query\_latency}}<br />\| parse regex field=sql\_cmd "[^a-zA-Z]\*(?\<sql\_cmd\_type\>[a-zA-Z]+)(?:\\s\|\\\\n\|\\n)" nodrop<br />\| parse field=sql\_cmd "# administrator command: \*" as admn\_sql\_cmd<br />\| if (sql\_cmd matches "# administrator command: \*", admn\_sql\_cmd, sql\_cmd\_type) as sql\_cmd\_type<br />\| toUpperCase(sql\_cmd\_type)<br />\| fields -query\_block<br />\| count as frequency group by sql\_cmd\_type \| sort by frequency|
|Google Cloud SQL|Stopped Server|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs|\_sourceCategory={{Logsdatasource}}  mysqld ("ready for connections."  or "Terminated." or "Shutdown complete" or "Normal shutdown")<br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql.err"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse regex field=message "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| if (ErrorMsg matches "\*ready for connections.\*", "Up","Unknown") as server\_status<br />\| if (ErrorMsg matches "\*Terminated.\*", "Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Normal shutdown\*", "Shutting Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Shutdown complete\*", "Down", server\_status) as server\_status<br />\| timeslice 15m<br />\| withtime server\_status \| withtime \_messagetime<br />\| most\_recent(server\_status\_withtime) as server\_status, most\_recent(\_messagetime\_withtime) as m\_time by project\_id,region,database\_id<br />\| formatDate(fromMillis(m\_time), "MM-dd-yyyy HH:mm:ss:SSS Z") as event\_time<br />\| ((toMillis(now())-m\_time)/(1000\*60)) as since\_mins \| format("%.2f", since\_mins) as since\_minutes<br />\| concat ("Since ", since\_minutes, " minutes") as remark<br />\| where server\_status != "Up"<br />\| fields - m\_time, since\_mins, since\_minutes <br />\| fields event\_time,project\_id,region,database\_id, server\_status, remark|
|Google Cloud SQL|Swap Used|Metrics|Installed Apps/Google Cloud SQL/Google Cloud SQL - DB Instance|project\_id={{project\_id}} region={{region}} cloud.platform={{cloud.platform}} database\_id={{database\_id}} metric=database/swap/bytes\_used  statistic=average \| eval(\_value/(1024\*1024)) \| avg |
|Google Cloud SQL|Top 10 Slow Queries by Average Execution Time|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Slow Query Logs|\_sourceCategory={{Logsdatasource}}  "User@Host" "Query\_time" <br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql-slow.log"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse regex field=message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @  \\[(?\<ip\_addr\>\\S\*?)\\]" nodrop<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+" nodrop<br />\| parse regex field=query\_block "SET timestamp=(?\<set\_timestamp\>\\d\*);(?:\\\\n\|\\n)(?\<sql\_cmd\>[\\s\\S]\*);" nodrop<br />\| fields -query\_block<br />\| avg(query\_time) as avg\_time, sum(query\_time) as total\_time, min(query\_time) as min\_time, max(query\_time) as max\_time, avg(rows\_examined) as avg\_rows\_examined, avg(rows\_sent) as avg\_rows\_sent, avg(Lock\_Time) as avg\_lock\_time, count as frequency group by sql\_cmd, project\_id<br />\| where avg\_time \>= {{slow\_query\_latency}}<br />\| sort by avg\_time \| limit 10|
|Google Cloud SQL|Top 10 Users by Messages|Logs|Google Cloud SQL/Google Cloud SQL - Overview - New|\_sourceCategory = Labs/GCP/sql logName principalEmail resource timestamp "\\"type\\":\\"cloudsql\_database\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\""<br />\| where log\_name matches "projects/\*/logs/\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload.authenticationInfo.principalEmail" as labels, user<br />\| json field=labels "database\_id", "project\_id", "region" as instance, project, region<br />\|where if ("{{Region}}" = "\*", true, region matches "{{Region}}") AND if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}") AND if ("{{UserLabels}}" = "\*", true, labels matches "{{UserLabels}}") AND if ("{{Instance}}" = "\*", true, instance matches "{{Instance}}")<br />\|count as messages by user<br />\| sort by messages<br />\| limit 10|
|Google Cloud SQL|Top IP Firing Slow Queries|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Slow Query Logs|\_sourceCategory={{Logsdatasource}}  "User@Host" "Query\_time" <br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql-slow.log"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse regex field=message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @  \\[(?\<ip\_addr\>\\S\*?)\\]" nodrop<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+" nodrop<br />\| num(query\_time) as query\_time<br />\| where query\_time \>= {{slow\_query\_latency}}<br />\| fields -query\_block<br />\| count as frequency by ip\_addr <br />\| where !isEmpty(ip\_addr)<br />\| sort by frequency|
|Google Cloud SQL|Top Note Events|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs|\_sourceCategory={{Logsdatasource}}  Note<br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql.err"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as projectid,region,databaseid<br />\| where projectid matches "{{project\_id}}" AND region matches "{{region}}" AND databaseid matches "{{database\_id}}"<br />\| parse field=message "[\*] \*" as LogLevel, msgDetails<br />\| where LogLevel = "Note"<br />\| count as frequency by msgDetails<br />\| sort by frequency, msgDetails asc \| limit 100|
|Google Cloud SQL|Top Users Firing Slow Queries|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Slow Query Logs|\_sourceCategory={{Logsdatasource}}  "User@Host" "Query\_time" <br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql-slow.log"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse regex field=message "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @  \\[(?\<ip\_addr\>\\S\*?)\\]" nodrop<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+" nodrop<br />\| num(query\_time) as query\_time<br />\| where query\_time \>= {{slow\_query\_latency}}<br />\| fields -query\_block<br />\| count as frequency by user \| sort by frequency|
|Google Cloud SQL|Top Warnings|Logs|Installed Apps/Google Cloud SQL/Google Cloud SQL - MySQL - Error Logs|\_sourceCategory={{Logsdatasource}}  Warning<br />\| json "message.data.textPayload", "message.data.logName" as message, logname<br />\| where logname matches "projects/\*/logs/cloudsql.googleapis.com%2Fmysql.err"<br />\| json "message.data.resource.labels.project\_id","message.data.resource.labels.region","message.data.resource.labels.database\_id" as project\_id,region,database\_id<br />\| where toLowerCase(project\_id) matches "{{project\_id}}" AND toLowerCase(region) matches "{{region}}" AND toLowerCase(database\_id) matches "{{database\_id}}"<br />\| parse field=message "[\*] \*" as LogLevel, msgDetails<br />\| where LogLevel = "Warning"<br />\| count as frequency by msgDetails<br />\| top 10 msgDetails by frequency, msgDetails asc|

