# Azure Network Watcher
## Sumo Logic App For: Azure Network Watcher
Sumo Logic App for Azure Network Watcher leverages Network Security Group (NSG) flow logs to provide real-time visibility and analysis of your Azure Network. This App provides preconfigured Dashboards that allow you to monitor inbound traffic, outliers in traffic flow, and denied traffic flows.
Docs Link: [Azure Network Watcher](https://help.sumologic.com/?cid=6023)

## Searches

### Log Searches

- **Breakdown of Traffic (Allowed or Denied)**: from Dashboard: Installed Apps/Azure Network Watcher/Network Watcher - Overview 
- **Breakdown of Traffic (Allowed or Denied)**: from Dashboard: Azure Network Watcher/Network Watcher - Overview - New 
- **Denied Flow Traffic by Rule Name**: from Dashboard: Installed Apps/Azure Network Watcher/Network Watcher - Denied Traffic Flow 
- **Denied Traffic Comparison (Today Vs Yesterday) - Outlier**: from Dashboard: Installed Apps/Azure Network Watcher/Network Watcher - Overview 
- **Denied Traffic Comparison (Today Vs Yesterday) - Outlier**: from Dashboard: Azure Network Watcher/Network Watcher - Overview - New 
- **Denied Traffic Flow by Source Location**: from Dashboard: Installed Apps/Azure Network Watcher/Network Watcher - Denied Traffic Flow 
- **Denied Traffic per Hour -  Outlier**: from Dashboard: Azure Network Watcher/Network Watcher - Overview - New 
- **Denied Traffic per Hour -  Outlier**: from Dashboard: Installed Apps/Azure Network Watcher/Network Watcher - Overview 
- **Denied Traffic per Hour -  Outlier**: from Dashboard: Installed Apps/Azure Network Watcher/Network Watcher - Denied Traffic Flow 
- **Denied Traffic per Minute**: from Dashboard: Installed Apps/Azure Network Watcher/Network Watcher - Overview 
- **Denied Traffic per Minute**: from Dashboard: Azure Network Watcher/Network Watcher - Overview - New 
- **Flow Traffic by Protocol**: from Dashboard: Installed Apps/Azure Network Watcher/Network Watcher - Overview 
- **Flow Traffic by Protocol**: from Dashboard: Azure Network Watcher/Network Watcher - Overview - New 
- **Flow Traffic by Rule Name**: from Dashboard: Installed Apps/Azure Network Watcher/Network Watcher - Overview 
- **Flow Traffic by Rule Name**: from Dashboard: Azure Network Watcher/Network Watcher - Overview - New 
- **Source Address Location of Inbound Traffic**: from Dashboard: Azure Network Watcher/Network Watcher - Overview - New 
- **Source Address Location of Inbound Traffic**: from Dashboard: Installed Apps/Azure Network Watcher/Network Watcher - Overview 
- **Top 10 Denied Destination IP**: from Dashboard: Installed Apps/Azure Network Watcher/Network Watcher - Denied Traffic Flow 
- **Top 10 Denied Destination IP, Port**: from Dashboard: Installed Apps/Azure Network Watcher/Network Watcher - Denied Traffic Flow 
- **Top 10 Denied Source IP**: from Dashboard: Installed Apps/Azure Network Watcher/Network Watcher - Denied Traffic Flow 
- **Top 10 Denied Source IP, Port**: from Dashboard: Installed Apps/Azure Network Watcher/Network Watcher - Denied Traffic Flow 
- **Top 10 Destination Ports**: from Dashboard: Installed Apps/Azure Network Watcher/Network Watcher - Overview 
- **Top 10 Destination Ports**: from Dashboard: Azure Network Watcher/Network Watcher - Overview - New

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Azure Network Watcher|Breakdown of Traffic (Allowed or Denied)|Logs|Installed Apps/Azure Network Watcher/Network Watcher - Overview|\_sourceCategory={{Logsdatasource}} <br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "protocol"<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count by traffic\_a\_d|
|Azure Network Watcher|Breakdown of Traffic (Allowed or Denied)|Logs|Azure Network Watcher/Network Watcher - Overview - New|\_sourceCategory = Labs/Azure/NetworkWatcher<br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "protocol"<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count by traffic\_a\_d|
|Azure Network Watcher|Denied Flow Traffic by Rule Name|Logs|Installed Apps/Azure Network Watcher/Network Watcher - Denied Traffic Flow|\_sourceCategory={{Logsdatasource}} <br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "protocol"<br />\| if(protocol="T","TCP", protocol) as protocol <br />\| if(protocol="U","UDP", protocol) as protocol<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\| where traffic\_a\_d = "D"<br />\| timeslice 1h<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count by rule\_name,\_timeslice<br />\| transpose row \_timeslice column rule\_name|
|Azure Network Watcher|Denied Traffic Comparison (Today Vs Yesterday) - Outlier|Logs|Installed Apps/Azure Network Watcher/Network Watcher - Overview|\_sourceCategory={{Logsdatasource}} <br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "protocol"<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| where traffic\_a\_d ="D"<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\| timeslice 1h<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count as  denied\_today by \_timeslice<br />\| compare with timeshift 1d as denied\_yesterday<br />\| (denied\_today - denied\_today\_denied\_yesterday) as delta<br />\| outlier delta|
|Azure Network Watcher|Denied Traffic Comparison (Today Vs Yesterday) - Outlier|Logs|Azure Network Watcher/Network Watcher - Overview - New|\_sourceCategory = Labs/Azure/NetworkWatcher<br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "protocol"<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| where traffic\_a\_d ="D"<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\| timeslice 1h<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count as  denied\_today by \_timeslice<br />\| compare with timeshift 1d as denied\_yesterday<br />\| (denied\_today - denied\_today\_denied\_yesterday) as delta<br />\| outlier delta|
|Azure Network Watcher|Denied Traffic Flow by Source Location|Logs|Installed Apps/Azure Network Watcher/Network Watcher - Denied Traffic Flow|\_sourceCategory={{Logsdatasource}} <br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "protocol"<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\| where traffic\_a\_d = "D"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = src\_ip<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Azure Network Watcher|Denied Traffic per Hour -  Outlier|Logs|Azure Network Watcher/Network Watcher - Overview - New|\_sourceCategory = Labs/Azure/NetworkWatcher<br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "protocol"<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\| where traffic\_a\_d ="D"<br />\| timeslice 1h<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count as  denied by \_timeslice<br />\| outlier denied|
|Azure Network Watcher|Denied Traffic per Hour -  Outlier|Logs|Installed Apps/Azure Network Watcher/Network Watcher - Overview|\_sourceCategory={{Logsdatasource}} <br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "protocol"<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\| where traffic\_a\_d ="D"<br />\| timeslice 1h<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count as  denied by \_timeslice<br />\| outlier denied|
|Azure Network Watcher|Denied Traffic per Hour -  Outlier|Logs|Installed Apps/Azure Network Watcher/Network Watcher - Denied Traffic Flow|\_sourceCategory={{Logsdatasource}} <br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "protocol"<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\| where traffic\_a\_d ="D"<br />\| timeslice 1h<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count as  denied by \_timeslice<br />\| outlier denied|
|Azure Network Watcher|Denied Traffic per Minute|Logs|Installed Apps/Azure Network Watcher/Network Watcher - Overview|\_sourceCategory={{Logsdatasource}} <br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "protocol"<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\| where traffic\_a\_d ="D"<br />\| timeslice 1m<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count by \_timeslice|
|Azure Network Watcher|Denied Traffic per Minute|Logs|Azure Network Watcher/Network Watcher - Overview - New|\_sourceCategory = Labs/Azure/NetworkWatcher<br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "protocol"<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\| where traffic\_a\_d ="D"<br />\| timeslice 1m<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count by \_timeslice|
|Azure Network Watcher|Flow Traffic by Protocol|Logs|Installed Apps/Azure Network Watcher/Network Watcher - Overview|\_sourceCategory={{Logsdatasource}} <br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "protocol"<br />\| if(protocol="T","TCP", protocol) as protocol <br />\| if(protocol="U","UDP", protocol) as protocol<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\| timeslice 1h<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count by protocol,\_timeslice<br />\| transpose row \_timeslice column protocol|
|Azure Network Watcher|Flow Traffic by Protocol|Logs|Azure Network Watcher/Network Watcher - Overview - New|\_sourceCategory = Labs/Azure/NetworkWatcher<br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "protocol"<br />\| if(protocol="T","TCP", protocol) as protocol <br />\| if(protocol="U","UDP", protocol) as protocol<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\| timeslice 1h<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count by protocol,\_timeslice<br />\| transpose row \_timeslice column protocol|
|Azure Network Watcher|Flow Traffic by Rule Name|Logs|Installed Apps/Azure Network Watcher/Network Watcher - Overview|\_sourceCategory={{Logsdatasource}} <br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "protocol"<br />\| if(protocol="T","TCP", protocol) as protocol <br />\| if(protocol="U","UDP", protocol) as protocol<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| timeslice 1h<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count by rule\_name,\_timeslice<br />\| transpose row \_timeslice column rule\_name|
|Azure Network Watcher|Flow Traffic by Rule Name|Logs|Azure Network Watcher/Network Watcher - Overview - New|\_sourceCategory = Labs/Azure/NetworkWatcher<br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "protocol"<br />\| if(protocol="T","TCP", protocol) as protocol <br />\| if(protocol="U","UDP", protocol) as protocol<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| timeslice 1h<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count by rule\_name,\_timeslice<br />\| transpose row \_timeslice column rule\_name|
|Azure Network Watcher|Source Address Location of Inbound Traffic|Logs|Azure Network Watcher/Network Watcher - Overview - New|\_sourceCategory = Labs/Azure/NetworkWatcher<br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\| json field=\_raw "protocol"<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| where traffic\_destination = "I"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = src\_ip<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Azure Network Watcher|Source Address Location of Inbound Traffic|Logs|Installed Apps/Azure Network Watcher/Network Watcher - Overview|\_sourceCategory={{Logsdatasource}} <br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\| json field=\_raw "protocol"<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| where traffic\_destination = "I"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = src\_ip<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Azure Network Watcher|Top 10 Denied Destination IP|Logs|Installed Apps/Azure Network Watcher/Network Watcher - Denied Traffic Flow|\_sourceCategory={{Logsdatasource}} <br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "protocol"<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\| where traffic\_a\_d = "D"<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count by dest\_ip<br />\| sort \_count<br />\| limit 10|
|Azure Network Watcher|Top 10 Denied Destination IP, Port|Logs|Installed Apps/Azure Network Watcher/Network Watcher - Denied Traffic Flow|\_sourceCategory={{Logsdatasource}} <br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "protocol"<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\| where traffic\_a\_d = "D"<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count by dest\_ip, dest\_port<br />\| sort \_count<br />\| limit 10|
|Azure Network Watcher|Top 10 Denied Source IP|Logs|Installed Apps/Azure Network Watcher/Network Watcher - Denied Traffic Flow|\_sourceCategory={{Logsdatasource}} <br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "protocol"<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\| where traffic\_a\_d = "D"<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count by src\_ip<br />\| sort \_count<br />\| limit 10|
|Azure Network Watcher|Top 10 Denied Source IP, Port|Logs|Installed Apps/Azure Network Watcher/Network Watcher - Denied Traffic Flow|\_sourceCategory={{Logsdatasource}} <br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "src\_port"<br />\| json field=\_raw "protocol"<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\| where traffic\_a\_d = "D"<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count by src\_ip, src\_port<br />\| sort \_count<br />\| limit 10|
|Azure Network Watcher|Top 10 Destination Ports|Logs|Installed Apps/Azure Network Watcher/Network Watcher - Overview|\_sourceCategory={{Logsdatasource}} <br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "protocol"<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count by dest\_port<br />\| sort by \_count<br />\| limit 10|
|Azure Network Watcher|Top 10 Destination Ports|Logs|Azure Network Watcher/Network Watcher - Overview - New|\_sourceCategory = Labs/Azure/NetworkWatcher<br />\| json field=\_raw "rule\_name" <br />\| json field=\_raw "resource\_id"<br />\| json field=\_raw "event\_name"<br />\| json field=\_raw "mac"<br />\| json field=\_raw "src\_ip"<br />\| json field=\_raw "dest\_IP"<br />\| json field=\_raw "dest\_port"<br />\| json field=\_raw "protocol"<br />\| json field=\_raw "traffic\_destination"<br />\| json field=\_raw "traffic\_a/d" as traffic\_a\_d<br />\| parse regex field=resource\_id"(?\<NSG\>[\\w-\_.]+)\$"<br />\| json field=\_raw "src\_port"<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{mac}}" = "\*", true, mac matches "{{mac}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{traffic\_a\_d}}" = "\*", true, traffic\_a\_d matches "{{traffic\_a\_d}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{rule\_name}}" = "\*", true, rule\_name matches "{{rule\_name}}") AND if ("{{traffic\_destination}}" = "\*", true, traffic\_destination matches "{{traffic\_destination}}") AND if ("{{event\_name}}" = "\*", true, event\_name matches "{{event\_name}}") AND if ("{{nsg}}" = "\*", true, nsg matches "{{nsg}}")<br />\|count by dest\_port<br />\| sort by \_count<br />\| limit 10|

