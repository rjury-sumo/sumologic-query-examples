# Fastly
## Sumo Logic App For: Fastly
Fastly is a content delivery network (CDN) that provides you control over how and where you serve content, access to real-time performance analytics, and the ability to cache unpredictably changing content at the edge. With the Sumo Logic Fastly App, you can examine performance by origin, quality of service, and monitor your visitor traffic for important patterns, and WAF for offenders using the pre-defined searches and dashboards for real-time visibility into your environment.
Docs Link: [Fastly](https://help.sumologic.com/?cid=2068)

## Searches

### Log Searches

- **90%-ile Latency (millisecs) by Origin Host**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Origin Performance 
- **90%-ile Latency (millisecs) by Origin Host**: from Dashboard: Fastly/CDN/Fastly - CDN - Origin Performance 
- **Bot Traffic Over Time**: from Dashboard: Fastly/CDN/Fastly - CDN - Visitors 
- **Bot Traffic Over Time**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Visitors 
- **Cache Hit Percentage Over Time**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Quality of Service 
- **Cache Hit Percentage Over Time**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Overview 
- **Cache Hit Percentage Over Time**: from Dashboard: Fastly/CDN/Fastly - CDN - Quality of Service 
- **Cache Hit Percentage Over Time**: from Dashboard: Fastly/CDN/Fastly - CDN - Overview 
- **Cache Performance**: from Dashboard: Fastly/CDN/Fastly - CDN - Quality of Service 
- **Cache Performance**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Quality of Service 
- **Cacheable Content Download Time (millisecs) Histogram**: from Dashboard: Fastly/CDN/Fastly - CDN - Quality of Service 
- **Cacheable Content Download Time (millisecs) Histogram**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Quality of Service 
- **Client IP (Blocked)**: from Dashboard: Fastly/WAF/Fastly - WAF - Offenders 
- **Client IP (Blocked)**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - Offenders 
- **Client IP (Warn)**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - Offenders 
- **Client IP (Warn)**: from Dashboard: Fastly/WAF/Fastly - WAF - Offenders 
- **Command Injections (932xxx_rules)**: from Dashboard: Fastly/WAF/Fastly - WAF - OWASP 
- **Command Injections (932xxx_rules)**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - OWASP 
- **Count of rules triggered per client**: from Search: Fastly/WAF/Count of rules triggered per client 
- **Count of rules triggered per client**: from Search: Installed Apps/Fastly/WAF/Count of rules triggered per client 
- **Daily Hits**: from Dashboard: Fastly/WAF/Fastly - WAF - Overview 
- **Daily Hits**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - Overview 
- **Download Performance Hotspots - Avg Download Above 300ms**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Quality of Service 
- **Download Performance Hotspots - Avg Download Above 300ms**: from Dashboard: Fastly/CDN/Fastly - CDN - Quality of Service 
- **Download Performance Hotspots - Avg Download Above 300ms by Country**: from Dashboard: Fastly/CDN/Fastly - CDN - Overview 
- **Download Performance Hotspots - Avg Download Above 300ms by Country**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Overview 
- **Error Rate 4xx by Code**: from Dashboard: Fastly/CDN/Fastly - CDN - Origin Performance 
- **Error Rate 4xx by Code**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Origin Performance 
- **Error Rate 5xx**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Origin Performance 
- **Error Rate 5xx**: from Dashboard: Fastly/CDN/Fastly - CDN - Origin Performance 
- **Geo Location of All Users**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - Offenders 
- **Geo Location of All Users**: from Dashboard: Fastly/WAF/Fastly - WAF - Offenders 
- **HTTP**: from Dashboard: Fastly/WAF/Fastly - WAF - Offenders 
- **HTTP**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - Offenders 
- **HTTP Violations (921xxx_rules)**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - OWASP 
- **HTTP Violations (921xxx_rules)**: from Dashboard: Fastly/WAF/Fastly - WAF - OWASP 
- **HTTP2 Usage**: from Dashboard: Fastly/CDN/Fastly - CDN - Visitors 
- **HTTP2 Usage**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Visitors 
- **Inbound HTTP (920xxx_rules)**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - OWASP 
- **Inbound HTTP (920xxx_rules)**: from Dashboard: Fastly/WAF/Fastly - WAF - OWASP 
- **LFI (930xxx_rules)**: from Dashboard: Fastly/WAF/Fastly - WAF - OWASP 
- **LFI (930xxx_rules)**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - OWASP 
- **LFI-RCE-RFI**: from Dashboard: Fastly/WAF/Fastly - WAF - Offenders 
- **LFI-RCE-RFI**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - Offenders 
- **Median Latency (millisecs) by Origin Host**: from Dashboard: Fastly/CDN/Fastly - CDN - Origin Performance 
- **Median Latency (millisecs) by Origin Host**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Origin Performance 
- **Origin Content Download Time (millisecs) Histogram**: from Dashboard: Fastly/CDN/Fastly - CDN - Origin Performance 
- **Origin Content Download Time (millisecs) Histogram**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Origin Performance 
- **Origin Download 90%-ile Latency (Microsecs)**: from Dashboard: Fastly/CDN/Fastly - CDN - Overview 
- **Origin Download 90%-ile Latency (Microsecs)**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Overview 
- **Overall Content Download Time (millisecs) Histogram**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Quality of Service 
- **Overall Content Download Time (millisecs) Histogram**: from Dashboard: Fastly/CDN/Fastly - CDN - Quality of Service 
- **Overall Request Volume**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Visitors 
- **Overall Request Volume**: from Dashboard: Fastly/CDN/Fastly - CDN - Visitors 
- **Overall Threat Trends**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - Offenders 
- **Overall Threat Trends**: from Dashboard: Fastly/WAF/Fastly - WAF - Offenders 
- **OWASP (overall)**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - OWASP 
- **OWASP (overall)**: from Dashboard: Fastly/WAF/Fastly - WAF - OWASP 
- **Performance (millisecs) Stats by Country**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Quality of Service 
- **Performance (millisecs) Stats by Country**: from Dashboard: Fastly/CDN/Fastly - CDN - Quality of Service 
- **Performance (millisecs) Stats by Data Center**: from Dashboard: Fastly/CDN/Fastly - CDN - Quality of Service 
- **Performance (millisecs) Stats by Data Center**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Quality of Service 
- **PHP Injection**: from Dashboard: Fastly/WAF/Fastly - WAF - Offenders 
- **PHP Injection**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - Offenders 
- **PHP Injections (933xxx_rules)**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - OWASP 
- **PHP Injections (933xxx_rules)**: from Dashboard: Fastly/WAF/Fastly - WAF - OWASP 
- **Requests by Content Type**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Visitors 
- **Requests by Content Type**: from Dashboard: Fastly/CDN/Fastly - CDN - Visitors 
- **Requests by Country**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Visitors 
- **Requests by Country**: from Dashboard: Fastly/CDN/Fastly - CDN - Visitors 
- **Requests by DataCenter**: from Dashboard: Fastly/CDN/Fastly - CDN - Visitors 
- **Requests by DataCenter**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Visitors 
- **Requests by User Agent**: from Dashboard: Fastly/CDN/Fastly - CDN - Visitors 
- **Requests by User Agent**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Visitors 
- **RFI (931xxx_rules)**: from Dashboard: Fastly/WAF/Fastly - WAF - OWASP 
- **RFI (931xxx_rules)**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - OWASP 
- **Rule Count Block**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - Overview 
- **Rule Count Block**: from Dashboard: Fastly/WAF/Fastly - WAF - Overview 
- **Rule Count Warn**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - Overview 
- **Rule Count Warn**: from Dashboard: Fastly/WAF/Fastly - WAF - Overview 
- **Session Fixations (943xxx_rules)**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - OWASP 
- **Session Fixations (943xxx_rules)**: from Dashboard: Fastly/WAF/Fastly - WAF - OWASP 
- **Session-Fixation**: from Dashboard: Fastly/WAF/Fastly - WAF - Offenders 
- **Session-Fixation**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - Offenders 
- **Slowest URLs (millisecs)**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Origin Performance 
- **Slowest URLs (millisecs)**: from Dashboard: Fastly/CDN/Fastly - CDN - Origin Performance 
- **SQL Injection**: from Dashboard: Fastly/WAF/Fastly - WAF - Offenders 
- **SQL Injection**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - Offenders 
- **SQL Injections (942xxx_rules)**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - OWASP 
- **SQL Injections (942xxx_rules)**: from Dashboard: Fastly/WAF/Fastly - WAF - OWASP 
- **Threshold Exceptions**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - Offenders 
- **Threshold Exceptions**: from Dashboard: Fastly/WAF/Fastly - WAF - Offenders 
- **TLS Usage**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Visitors 
- **TLS Usage**: from Dashboard: Fastly/CDN/Fastly - CDN - Visitors 
- **Top 10 Referrers**: from Dashboard: Fastly/CDN/Fastly - CDN - Visitors 
- **Top 10 Referrers**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Visitors 
- **Top 404-Causing URLs**: from Dashboard: Fastly/CDN/Fastly - CDN - Origin Performance 
- **Top 404-Causing URLs**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Overview 
- **Top 404-Causing URLs**: from Dashboard: Fastly/CDN/Fastly - CDN - Overview 
- **Top 404-Causing URLs**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Origin Performance 
- **Top 5XX Error-Causing URLs**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Origin Performance 
- **Top 5XX Error-Causing URLs**: from Dashboard: Fastly/CDN/Fastly - CDN - Origin Performance 
- **Top Clients Affected by Threats**: from Dashboard: Fastly/WAF/Fastly - WAF - Offenders 
- **Top Clients Affected by Threats**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - Offenders 
- **Top Messages (Blocked)**: from Dashboard: Fastly/WAF/Fastly - WAF - Overview 
- **Top Messages (Blocked)**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - Overview 
- **Top Messages (Warn)**: from Dashboard: Fastly/WAF/Fastly - WAF - Overview 
- **Top Messages (Warn)**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - Overview 
- **Top Requests**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Visitors 
- **Top Requests**: from Dashboard: Fastly/CDN/Fastly - CDN - Visitors 
- **Top Server Error-Causing URLs**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Overview 
- **Top Server Error-Causing URLs**: from Dashboard: Fastly/CDN/Fastly - CDN - Overview 
- **Top URLS (Blocked)**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - Overview 
- **Top URLS (Blocked)**: from Dashboard: Fastly/WAF/Fastly - WAF - Overview 
- **Top URLS (Warn)**: from Dashboard: Fastly/WAF/Fastly - WAF - Overview 
- **Top URLS (Warn)**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - Overview 
- **Total Request Size Over Time**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Visitors 
- **Total Request Size Over Time**: from Dashboard: Fastly/CDN/Fastly - CDN - Visitors 
- **Total Response Size Over Time**: from Dashboard: Fastly/CDN/Fastly - CDN - Visitors 
- **Total Response Size Over Time**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Visitors 
- **Visitor Countries**: from Dashboard: Fastly/CDN/Fastly - CDN - Overview 
- **Visitor Countries**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Overview 
- **Visitor Geolocations**: from Dashboard: Fastly/CDN/Fastly - CDN - Overview 
- **Visitor Geolocations**: from Dashboard: Fastly/CDN/Fastly - CDN - Visitors 
- **Visitor Geolocations**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Overview 
- **Visitor Geolocations**: from Dashboard: Installed Apps/Fastly/CDN/Fastly - CDN - Visitors 
- **WAF States**: from Dashboard: Fastly/WAF/Fastly - WAF - Overview 
- **WAF States**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - Overview 
- **XSS**: from Dashboard: Fastly/WAF/Fastly - WAF - Offenders 
- **XSS**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - Offenders 
- **XSS (941xxx_rules)**: from Dashboard: Fastly/WAF/Fastly - WAF - OWASP 
- **XSS (941xxx_rules)**: from Dashboard: Installed Apps/Fastly/WAF/Fastly - WAF - OWASP

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Fastly/CDN|90%-ile Latency (millisecs) by Origin Host|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Origin Performance|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status", "origin\_host", "cache\_status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status, origin\_host, cache\_status<br />\| time\_elapsed/1000 as time\_elapsed<br />\| timeslice 1m<br />\| where cache\_status = "MISS" or cache\_status = "PASS"<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|pct(time\_elapsed, 90) as nintieth by origin\_host, \_timeslice<br />\| transpose row \_timeslice column origin\_host|
|Fastly/CDN|90%-ile Latency (millisecs) by Origin Host|Logs|Fastly/CDN/Fastly - CDN - Origin Performance|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status", "origin\_host", "cache\_status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status, origin\_host, cache\_status<br />\| time\_elapsed/1000 as time\_elapsed<br />\| timeslice 1m<br />\| where cache\_status = "MISS" or cache\_status = "PASS"<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|pct(time\_elapsed, 90) as nintieth by origin\_host, \_timeslice<br />\| transpose row \_timeslice column origin\_host|
|Fastly/CDN|Bot Traffic Over Time|Logs|Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}  (\*bot\* or \*index\*)<br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| timeslice 1m<br />\| urldecode(user\_agent) as user\_agent<br />\| where user\_agent matches "\*bot\*" or user\_agent matches "\*index\*"<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by user\_agent, \_timeslice//,evolution,version<br />\| transpose row \_timeslice column user\_agent|
|Fastly/CDN|Bot Traffic Over Time|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}  (\*bot\* or \*index\*)<br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| timeslice 1m<br />\| urldecode(user\_agent) as user\_agent<br />\| where user\_agent matches "\*bot\*" or user\_agent matches "\*index\*"<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by user\_agent, \_timeslice//,evolution,version<br />\| transpose row \_timeslice column user\_agent|
|Fastly/CDN|Cache Hit Percentage Over Time|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Quality of Service|\_sourceCategory={{Logsdatasource}}     <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip", "cache\_status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, cache\_status <br />\| if (cache\_status = "HIT", 1,0) as cache\_offload<br />\| timeslice 5m<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND cache\_status matches "{{Status}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as totalCount, sum(cache\_offload) as cache\_offload by \_timeslice <br />\| toInt((cache\_offload/totalCount)\*100) as CacheOffloadPct \| fields -totalCount,cache\_offload|
|Fastly/CDN|Cache Hit Percentage Over Time|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Overview|\_sourceCategory={{Logsdatasource}}     <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip", "cache\_status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, cache\_status <br />\| if (cache\_status = "HIT", 1,0) as cache\_offload<br />\| timeslice 5m<br />\|count as totalCount, sum(cache\_offload) as cache\_offload by \_timeslice <br />\| toInt((cache\_offload/totalCount)\*100) as CacheOffloadPct \| fields -totalCount,cache\_offload|
|Fastly/CDN|Cache Hit Percentage Over Time|Logs|Fastly/CDN/Fastly - CDN - Quality of Service|\_sourceCategory={{Logsdatasource}}     <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip", "cache\_status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, cache\_status <br />\| if (cache\_status = "HIT", 1,0) as cache\_offload<br />\| timeslice 5m<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND cache\_status matches "{{Status}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as totalCount, sum(cache\_offload) as cache\_offload by \_timeslice <br />\| toInt((cache\_offload/totalCount)\*100) as CacheOffloadPct \| fields -totalCount,cache\_offload|
|Fastly/CDN|Cache Hit Percentage Over Time|Logs|Fastly/CDN/Fastly - CDN - Overview|\_sourceCategory={{Logsdatasource}}     <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip", "cache\_status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, cache\_status <br />\| if (cache\_status = "HIT", 1,0) as cache\_offload<br />\| timeslice 5m<br />\|count as totalCount, sum(cache\_offload) as cache\_offload by \_timeslice <br />\| toInt((cache\_offload/totalCount)\*100) as CacheOffloadPct \| fields -totalCount,cache\_offload|
|Fastly/CDN|Cache Performance|Logs|Fastly/CDN/Fastly - CDN - Quality of Service|\_sourceCategory={{Logsdatasource}}   <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip", "cache\_status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, cache\_status<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND cache\_status matches "{{Status}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by cache\_status|
|Fastly/CDN|Cache Performance|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Quality of Service|\_sourceCategory={{Logsdatasource}}   <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip", "cache\_status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, cache\_status<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND cache\_status matches "{{Status}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by cache\_status|
|Fastly/CDN|Cacheable Content Download Time (millisecs) Histogram|Logs|Fastly/CDN/Fastly - CDN - Quality of Service|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","cache\_status", "status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, cache\_status, status<br />\| where cache\_status = "HIT" or cache\_status = "MISS"<br />\| time\_elapsed/1000 as time\_elapse // convert to milliseconds<br />\| 100 as bucket\_size // use 0.1 second as the bucket size<br />\| floor(time\_elapsed/bucket\_size)\*bucket\_size as response\_time<br />\| format("%.0f-%.0f",floor(time\_elapsed/bucket\_size)\*bucket\_size,ceil(time\_elapsed/bucket\_size)\*bucket\_size) as response\_time\_str<br />\| if (response\_time \> 10\*bucket\_size, format("\>%.0f",10\*bucket\_size),response\_time\_str) as response\_time<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND status matches "{{Status}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as requests by response\_time <br />\| sort by + response\_time|
|Fastly/CDN|Cacheable Content Download Time (millisecs) Histogram|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Quality of Service|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","cache\_status", "status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, cache\_status, status<br />\| where cache\_status = "HIT" or cache\_status = "MISS"<br />\| time\_elapsed/1000 as time\_elapse // convert to milliseconds<br />\| 100 as bucket\_size // use 0.1 second as the bucket size<br />\| floor(time\_elapsed/bucket\_size)\*bucket\_size as response\_time<br />\| format("%.0f-%.0f",floor(time\_elapsed/bucket\_size)\*bucket\_size,ceil(time\_elapsed/bucket\_size)\*bucket\_size) as response\_time\_str<br />\| if (response\_time \> 10\*bucket\_size, format("\>%.0f",10\*bucket\_size),response\_time\_str) as response\_time<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND status matches "{{Status}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as requests by response\_time <br />\| sort by + response\_time|
|Fastly/WAF|Client IP (Blocked)|Logs|Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_block\\":\\"1\\"" and "\\"cache\_status\\":\\"ERROR\\"")<br />\| json "client\_ip","cache\_status","waf\_block" as client\_ip, cache\_status, waf\_block nodrop<br />\| where waf\_block="1" and cache\_status matches "ERROR"<br />\| count as block by client\_ip<br />\| sort by block|
|Fastly/WAF|Client IP (Blocked)|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_block\\":\\"1\\"" and "\\"cache\_status\\":\\"ERROR\\"")<br />\| json "client\_ip","cache\_status","waf\_block" as client\_ip, cache\_status, waf\_block nodrop<br />\| where waf\_block="1" and cache\_status matches "ERROR"<br />\| count as block by client\_ip<br />\| sort by block|
|Fastly/WAF|Client IP (Warn)|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("client\_ip" "waf\_logged") (MISS\* OR NONE\* OR PASS\*)<br />\| json "client\_ip", "cache\_status", "waf\_logged", "waf\_block", "waf\_passed", "waf\_anomaly\_score" as client\_ip, cache\_status, waf\_logged, waf\_block, waf\_passed, waf\_anomaly\_score nodrop<br />\| where ! isEmpty (waf\_logged) and ((waf\_logged = "1" and waf\_block = "0") or (waf\_passed = "1" and waf\_anomaly\_score \> 0)) and (cache\_status matches "MISS\*" or cache\_status matches "PASS\*" or cache\_status matches "NONE\*")<br />\| count as warns by client\_ip<br />\| sort by warns|
|Fastly/WAF|Client IP (Warn)|Logs|Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("client\_ip" "waf\_logged") (MISS\* OR NONE\* OR PASS\*)<br />\| json "client\_ip", "cache\_status", "waf\_logged", "waf\_block", "waf\_passed", "waf\_anomaly\_score" as client\_ip, cache\_status, waf\_logged, waf\_block, waf\_passed, waf\_anomaly\_score nodrop<br />\| where ! isEmpty (waf\_logged) and ((waf\_logged = "1" and waf\_block = "0") or (waf\_passed = "1" and waf\_anomaly\_score \> 0)) and (cache\_status matches "MISS\*" or cache\_status matches "PASS\*" or cache\_status matches "NONE\*")<br />\| count as warns by client\_ip<br />\| sort by warns|
|Fastly/WAF|Command Injections (932xxx\_rules)|Logs|Fastly/WAF/Fastly - WAF - OWASP|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"" "waf\_rce\_score")<br />\| json "waf\_executed", "waf\_rce\_score" as waf\_executed, waf\_rce\_score nodrop<br />\| where waf\_executed="1" and waf\_rce\_score \>= 0<br />\|min(waf\_rce\_score) as min, pct(waf\_rce\_score, 25) as lower, pct(waf\_rce\_score, 50) as median, pct(waf\_rce\_score, 75) as upper, max(waf\_rce\_score) as max, avg(waf\_rce\_score) as avg|
|Fastly/WAF|Command Injections (932xxx\_rules)|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - OWASP|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"" "waf\_rce\_score")<br />\| json "waf\_executed", "waf\_rce\_score" as waf\_executed, waf\_rce\_score nodrop<br />\| where waf\_executed="1" and waf\_rce\_score \>= 0<br />\|min(waf\_rce\_score) as min, pct(waf\_rce\_score, 25) as lower, pct(waf\_rce\_score, 50) as median, pct(waf\_rce\_score, 75) as upper, max(waf\_rce\_score) as max, avg(waf\_rce\_score) as avg|
|Fastly/WAF|Count of rules triggered per client|Logs|Fastly/WAF/Count of rules triggered per client|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"") <br />\| json "client\_ip", "waf\_executed", "waf\_rule\_id" as client\_ip, waf\_executed, waf\_rule\_id nodrop<br />\| where waf\_executed = "1"<br />\| count\_distinct(waf\_rule\_id) as unique\_threats by client\_ip <br />\| top 10 client\_ip by unique\_threats|
|Fastly/WAF|Count of rules triggered per client|Logs|Installed Apps/Fastly/WAF/Count of rules triggered per client|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"") <br />\| json "client\_ip", "waf\_executed", "waf\_rule\_id" as client\_ip, waf\_executed, waf\_rule\_id nodrop<br />\| where waf\_executed = "1"<br />\| count\_distinct(waf\_rule\_id) as unique\_threats by client\_ip <br />\| top 10 client\_ip by unique\_threats|
|Fastly/WAF|Daily Hits|Logs|Fastly/WAF/Fastly - WAF - Overview|//log count within 24h timeslice through waf ruleset <br />\_sourceCategory={{Logsdatasource1}}  ("waf\_executed")<br />\| json "waf\_executed" as waf\_executed nodrop<br />\| timeslice 24h<br />\| if (!isBlank(waf\_executed) and waf\_executed = "1",1,0) as waf\_executed<br />\|sum (waf\_executed) as hits by \_timeslice|
|Fastly/WAF|Daily Hits|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - Overview|//log count within 24h timeslice through waf ruleset <br />\_sourceCategory={{Logsdatasource1}}  ("waf\_executed")<br />\| json "waf\_executed" as waf\_executed nodrop<br />\| timeslice 24h<br />\| if (!isBlank(waf\_executed) and waf\_executed = "1",1,0) as waf\_executed<br />\|sum (waf\_executed) as hits by \_timeslice|
|Fastly/CDN|Download Performance Hotspots - Avg Download Above 300ms|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Quality of Service|\_sourceCategory={{Logsdatasource}}    <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip <br />\| lookup latitude, longitude from geo://location on ip=src\_ip<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|count, avg(time\_elapsed) as avg\_time\_elapsed by geo\_country\_code, latitude, longitude \| round(avg\_time\_elapsed)<br />\| where avg\_time\_elapsed \> 300000 and \_count \> 1\| sort by avg\_time\_elapsed<br />\| fields - avg\_time\_elapsed|
|Fastly/CDN|Download Performance Hotspots - Avg Download Above 300ms|Logs|Fastly/CDN/Fastly - CDN - Quality of Service|\_sourceCategory={{Logsdatasource}}    <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip <br />\| lookup latitude, longitude from geo://location on ip=src\_ip<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|count, avg(time\_elapsed) as avg\_time\_elapsed by geo\_country\_code, latitude, longitude \| round(avg\_time\_elapsed)<br />\| where avg\_time\_elapsed \> 300000 and \_count \> 1\| sort by avg\_time\_elapsed<br />\| fields - avg\_time\_elapsed|
|Fastly/CDN|Download Performance Hotspots - Avg Download Above 300ms by Country|Logs|Fastly/CDN/Fastly - CDN - Overview|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| lookup latitude, longitude from geo://location on ip=src\_ip <br />\| count, avg(time\_elapsed) as avg\_time\_elapsed by geo\_country\_code, latitude, longitude <br />\| round(avg\_time\_elapsed)<br />\| where avg\_time\_elapsed \> 300000 and \_count \> 1\| sort by avg\_time\_elapsed<br />\| fields - avg\_time\_elapsed|
|Fastly/CDN|Download Performance Hotspots - Avg Download Above 300ms by Country|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Overview|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| lookup latitude, longitude from geo://location on ip=src\_ip <br />\| count, avg(time\_elapsed) as avg\_time\_elapsed by geo\_country\_code, latitude, longitude <br />\| round(avg\_time\_elapsed)<br />\| where avg\_time\_elapsed \> 300000 and \_count \> 1\| sort by avg\_time\_elapsed<br />\| fields - avg\_time\_elapsed|
|Fastly/CDN|Error Rate 4xx by Code|Logs|Fastly/CDN/Fastly - CDN - Origin Performance|\_sourceCategory={{Logsdatasource}}  4??<br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","request","status","origin\_host" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, method, status, origin\_host   <br />\| where status matches "4\*" and method = "GET"<br />\| timeslice 10m as \_timeslice<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by \_timeslice, status<br />\| transpose row \_timeslice column status|
|Fastly/CDN|Error Rate 4xx by Code|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Origin Performance|\_sourceCategory={{Logsdatasource}}  4??<br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","request","status","origin\_host" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, method, status, origin\_host   <br />\| where status matches "4\*" and method = "GET"<br />\| timeslice 10m as \_timeslice<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by \_timeslice, status<br />\| transpose row \_timeslice column status|
|Fastly/CDN|Error Rate 5xx|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Origin Performance|\_sourceCategory={{Logsdatasource}}  5??<br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status", "request" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status, method <br />\| where status matches "5\*" and method="GET"<br />\| timeslice 10m as \_timeslice<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by \_timeslice, status<br />\| transpose row \_timeslice column status|
|Fastly/CDN|Error Rate 5xx|Logs|Fastly/CDN/Fastly - CDN - Origin Performance|\_sourceCategory={{Logsdatasource}}  5??<br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status", "request" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status, method <br />\| where status matches "5\*" and method="GET"<br />\| timeslice 10m as \_timeslice<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by \_timeslice, status<br />\| transpose row \_timeslice column status|
|Fastly/WAF|Geo Location of All Users|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - Offenders|// shows user location based on client\_ip when waf ruleset is executed<br />(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"") <br />\| json "waf\_executed", "client\_ip" as waf\_executed, client\_ip nodrop<br />\| where waf\_executed = "1"<br />\| count as count by client\_ip<br />\| lookup latitude, longitude, country\_name, region, city, postal\_code from geo://location on ip = client\_ip<br />\| if (isBlank(country\_name), "unknown", country\_name) as country\_name<br />\| count by latitude, longitude, country\_name, region, city, postal\_code<br />\| sort by country\_name<br />\|where country\_name matches "{{country\_name}}"|
|Fastly/WAF|Geo Location of All Users|Logs|Fastly/WAF/Fastly - WAF - Offenders|// shows user location based on client\_ip when waf ruleset is executed<br />(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"") <br />\| json "waf\_executed", "client\_ip" as waf\_executed, client\_ip nodrop<br />\| where waf\_executed = "1"<br />\| count as count by client\_ip<br />\| lookup latitude, longitude, country\_name, region, city, postal\_code from geo://location on ip = client\_ip<br />\| if (isBlank(country\_name), "unknown", country\_name) as country\_name<br />\| count by latitude, longitude, country\_name, region, city, postal\_code<br />\| sort by country\_name<br />\|where country\_name matches "{{country\_name}}"|
|Fastly/WAF|HTTP|Logs|Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"") (920\* or 921\*)<br />\| json "client\_ip", "waf\_executed", "waf\_rule\_id" as client\_ip, waf\_executed, waf\_rule\_id<br />\| where waf\_executed="1" and (waf\_rule\_id matches "920\*" or waf\_rule\_id matches "921\*")<br />\|where client\_ip matches "{{client\_ip}}"<br />\|count as total\_requests by client\_ip<br />\| top 10 client\_ip by total\_requests|
|Fastly/WAF|HTTP|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"") (920\* or 921\*)<br />\| json "client\_ip", "waf\_executed", "waf\_rule\_id" as client\_ip, waf\_executed, waf\_rule\_id<br />\| where waf\_executed="1" and (waf\_rule\_id matches "920\*" or waf\_rule\_id matches "921\*")<br />\|where client\_ip matches "{{client\_ip}}"<br />\|count as total\_requests by client\_ip<br />\| top 10 client\_ip by total\_requests|
|Fastly/WAF|HTTP Violations (921xxx\_rules)|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - OWASP|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\": \\"1\\"" "waf\_http\_score")<br />\| json "waf\_executed", "waf\_http\_score" as waf\_executed, waf\_http\_score nodrop<br />\| where waf\_executed="1" and waf\_http\_score \>= 0<br />\|where waf\_http\_score matches "{{waf\_http\_score}}"<br />\|min(waf\_http\_score) as min, pct(waf\_http\_score, 25) as lower, pct(waf\_http\_score, 50) as median, pct(waf\_http\_score, 75) as upper, max(waf\_http\_score) as max, avg(waf\_http\_score) as avg|
|Fastly/WAF|HTTP Violations (921xxx\_rules)|Logs|Fastly/WAF/Fastly - WAF - OWASP|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\": \\"1\\"" "waf\_http\_score")<br />\| json "waf\_executed", "waf\_http\_score" as waf\_executed, waf\_http\_score nodrop<br />\| where waf\_executed="1" and waf\_http\_score \>= 0<br />\|where waf\_http\_score matches "{{waf\_http\_score}}"<br />\|min(waf\_http\_score) as min, pct(waf\_http\_score, 25) as lower, pct(waf\_http\_score, 50) as median, pct(waf\_http\_score, 75) as upper, max(waf\_http\_score) as max, avg(waf\_http\_score) as avg|
|Fastly/CDN|HTTP2 Usage|Logs|Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip<br />\| json "is\_h2"<br />\| if(is\_h2 = "true","Http2","Not Http2") as is\_h2<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}"  AND geo\_region matches "{{Geo Region}}"<br />\|count by is\_h2|
|Fastly/CDN|HTTP2 Usage|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip<br />\| json "is\_h2"<br />\| if(is\_h2 = "true","Http2","Not Http2") as is\_h2<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}"  AND geo\_region matches "{{Geo Region}}"<br />\|count by is\_h2|
|Fastly/WAF|Inbound HTTP (920xxx\_rules)|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - OWASP|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"" "waf\_anomaly\_score" "waf\_rule\_id")<br />\| json "waf\_executed", "waf\_anomaly\_score", "waf\_rule\_id" as waf\_executed, waf\_anomaly\_score, waf\_rule\_id nodrop<br />\| where waf\_executed="1" and !isNull(waf\_anomaly\_score) and <br />(waf\_anomaly\_score \>= 0) and <br />(waf\_rule\_id \>= 920000) and <br />(waf\_rule\_id \<= 920999)<br />\|where waf\_anomaly\_score matches "{{waf\_anomaly\_score}}"<br />\|min(waf\_anomaly\_score) as min, pct(waf\_anomaly\_score, 25) as lower, pct(waf\_anomaly\_score, 50) as median, pct(waf\_anomaly\_score, 75) as upper, max(waf\_anomaly\_score) as max, avg(waf\_anomaly\_score) as avg|
|Fastly/WAF|Inbound HTTP (920xxx\_rules)|Logs|Fastly/WAF/Fastly - WAF - OWASP|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"" "waf\_anomaly\_score" "waf\_rule\_id")<br />\| json "waf\_executed", "waf\_anomaly\_score", "waf\_rule\_id" as waf\_executed, waf\_anomaly\_score, waf\_rule\_id nodrop<br />\| where waf\_executed="1" and !isNull(waf\_anomaly\_score) and <br />(waf\_anomaly\_score \>= 0) and <br />(waf\_rule\_id \>= 920000) and <br />(waf\_rule\_id \<= 920999)<br />\|where waf\_anomaly\_score matches "{{waf\_anomaly\_score}}"<br />\|min(waf\_anomaly\_score) as min, pct(waf\_anomaly\_score, 25) as lower, pct(waf\_anomaly\_score, 50) as median, pct(waf\_anomaly\_score, 75) as upper, max(waf\_anomaly\_score) as max, avg(waf\_anomaly\_score) as avg|
|Fastly/WAF|LFI (930xxx\_rules)|Logs|Fastly/WAF/Fastly - WAF - OWASP|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"" "waf\_lfi\_score")<br />\| json "waf\_executed", "waf\_lfi\_score" as waf\_executed, waf\_lfi\_score nodrop<br />\| where waf\_executed="1" and waf\_lfi\_score \>=0<br />\|where waf\_lfi\_score matches "{{waf\_lfi\_score}}"<br />\|min(waf\_lfi\_score) as min, pct(waf\_lfi\_score, 25) as lower, pct(waf\_lfi\_score, 50) as median, pct(waf\_lfi\_score, 75) as upper, max(waf\_lfi\_score) as max, avg(waf\_lfi\_score) as avg|
|Fastly/WAF|LFI (930xxx\_rules)|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - OWASP|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"" "waf\_lfi\_score")<br />\| json "waf\_executed", "waf\_lfi\_score" as waf\_executed, waf\_lfi\_score nodrop<br />\| where waf\_executed="1" and waf\_lfi\_score \>=0<br />\|where waf\_lfi\_score matches "{{waf\_lfi\_score}}"<br />\|min(waf\_lfi\_score) as min, pct(waf\_lfi\_score, 25) as lower, pct(waf\_lfi\_score, 50) as median, pct(waf\_lfi\_score, 75) as upper, max(waf\_lfi\_score) as max, avg(waf\_lfi\_score) as avg|
|Fastly/WAF|LFI-RCE-RFI|Logs|Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"") (930\* or 931\* or 932\*)<br />\| json "client\_ip", "waf\_executed", "waf\_rule\_id" as client\_ip, waf\_executed, waf\_rule\_id nodrop<br />\| where waf\_executed = "1" and (waf\_rule\_id matches "930\*" or waf\_rule\_id matches "931\*" or waf\_rule\_id matches "932\*")<br />\|where client\_ip matches "{{client\_ip}}"<br />\|count as total\_requests by client\_ip<br />\| top 10 client\_ip by total\_requests|
|Fastly/WAF|LFI-RCE-RFI|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"") (930\* or 931\* or 932\*)<br />\| json "client\_ip", "waf\_executed", "waf\_rule\_id" as client\_ip, waf\_executed, waf\_rule\_id nodrop<br />\| where waf\_executed = "1" and (waf\_rule\_id matches "930\*" or waf\_rule\_id matches "931\*" or waf\_rule\_id matches "932\*")<br />\|where client\_ip matches "{{client\_ip}}"<br />\|count as total\_requests by client\_ip<br />\| top 10 client\_ip by total\_requests|
|Fastly/CDN|Median Latency (millisecs) by Origin Host|Logs|Fastly/CDN/Fastly - CDN - Origin Performance|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status", "origin\_host", "cache\_status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status, origin\_host, cache\_status<br />\| time\_elapsed/1000 as time\_elapsed // convert to millisecs<br />\| timeslice 1m<br />\| where cache\_status = "MISS" or cache\_status = "PASS"<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|pct(time\_elapsed, 50) as nintieth by origin\_host, \_timeslice<br />\| transpose row \_timeslice column origin\_host|
|Fastly/CDN|Median Latency (millisecs) by Origin Host|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Origin Performance|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status", "origin\_host", "cache\_status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status, origin\_host, cache\_status<br />\| time\_elapsed/1000 as time\_elapsed // convert to millisecs<br />\| timeslice 1m<br />\| where cache\_status = "MISS" or cache\_status = "PASS"<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|pct(time\_elapsed, 50) as nintieth by origin\_host, \_timeslice<br />\| transpose row \_timeslice column origin\_host|
|Fastly/CDN|Origin Content Download Time (millisecs) Histogram|Logs|Fastly/CDN/Fastly - CDN - Origin Performance|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","cache\_status", "status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, cache\_status, status<br />\| where cache\_status = "MISS" or cache\_status = "PASS"<br />\| time\_elapsed/1000 as time\_elapse // convert to milliseconds<br />\| 100 as bucket\_size // use 0.1 second as the bucket size<br />\| floor(time\_elapsed/bucket\_size)\*bucket\_size as response\_time<br />\| format("%.0f-%.0f",floor(time\_elapsed/bucket\_size)\*bucket\_size,ceil(time\_elapsed/bucket\_size)\*bucket\_size) as response\_time\_str<br />\| if (response\_time \> 10\*bucket\_size, format("\>%.0f",10\*bucket\_size),response\_time\_str) as response\_time<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as requests by response\_time <br />\| sort by + response\_time|
|Fastly/CDN|Origin Content Download Time (millisecs) Histogram|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Origin Performance|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","cache\_status", "status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, cache\_status, status<br />\| where cache\_status = "MISS" or cache\_status = "PASS"<br />\| time\_elapsed/1000 as time\_elapse // convert to milliseconds<br />\| 100 as bucket\_size // use 0.1 second as the bucket size<br />\| floor(time\_elapsed/bucket\_size)\*bucket\_size as response\_time<br />\| format("%.0f-%.0f",floor(time\_elapsed/bucket\_size)\*bucket\_size,ceil(time\_elapsed/bucket\_size)\*bucket\_size) as response\_time\_str<br />\| if (response\_time \> 10\*bucket\_size, format("\>%.0f",10\*bucket\_size),response\_time\_str) as response\_time<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as requests by response\_time <br />\| sort by + response\_time|
|Fastly/CDN|Origin Download 90%-ile Latency (Microsecs)|Logs|Fastly/CDN/Fastly - CDN - Overview|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status", "origin\_host", "cache\_status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status, origin\_host, cache\_status<br />\| timeslice 1m<br />\| where cache\_status = "MISS" or cache\_status = "PASS"<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND status matches "{{Status}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|pct(time\_elapsed, 90) as nintieth by origin\_host, \_timeslice<br />\| transpose row \_timeslice column origin\_host|
|Fastly/CDN|Origin Download 90%-ile Latency (Microsecs)|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Overview|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status", "origin\_host", "cache\_status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status, origin\_host, cache\_status<br />\| timeslice 1m<br />\| where cache\_status = "MISS" or cache\_status = "PASS"<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND status matches "{{Status}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|pct(time\_elapsed, 90) as nintieth by origin\_host, \_timeslice<br />\| transpose row \_timeslice column origin\_host|
|Fastly/CDN|Overall Content Download Time (millisecs) Histogram|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Quality of Service|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","cache\_status", "status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, cache\_status, status<br />\| time\_elapsed/1000 as time\_elapsed // convert to msecs<br />\| 100 as bucket\_size // use 0.1 second as the bucket size<br />\| floor(time\_elapsed/bucket\_size)\*bucket\_size as response\_time<br />\| format("%6.0f-%6.0f",floor(time\_elapsed/bucket\_size)\*bucket\_size,ceil(time\_elapsed/bucket\_size)\*bucket\_size) as response\_time\_str<br />\| if (response\_time \> 10\*bucket\_size, format("\>%6.0f",10\*bucket\_size),response\_time\_str) as response\_time<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND status matches "{{Status}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as requests by response\_time <br />\| sort by + response\_time|
|Fastly/CDN|Overall Content Download Time (millisecs) Histogram|Logs|Fastly/CDN/Fastly - CDN - Quality of Service|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","cache\_status", "status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, cache\_status, status<br />\| time\_elapsed/1000 as time\_elapsed // convert to msecs<br />\| 100 as bucket\_size // use 0.1 second as the bucket size<br />\| floor(time\_elapsed/bucket\_size)\*bucket\_size as response\_time<br />\| format("%6.0f-%6.0f",floor(time\_elapsed/bucket\_size)\*bucket\_size,ceil(time\_elapsed/bucket\_size)\*bucket\_size) as response\_time\_str<br />\| if (response\_time \> 10\*bucket\_size, format("\>%6.0f",10\*bucket\_size),response\_time\_str) as response\_time<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND status matches "{{Status}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as requests by response\_time <br />\| sort by + response\_time|
|Fastly/CDN|Overall Request Volume|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| timeslice 5m<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by \_timeslice|
|Fastly/CDN|Overall Request Volume|Logs|Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| timeslice 5m<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by \_timeslice|
|Fastly/WAF|Overall Threat Trends|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"") <br />\| json "client\_ip", "waf\_executed", "waf\_rule\_id" as client\_ip, waf\_executed, waf\_rule\_id nodrop<br />\| where waf\_executed = "1"<br />\| if (waf\_rule\_id matches "101\*", 1, 0) as ThresholdException<br />\| if (waf\_rule\_id matches "920\*" or waf\_rule\_id matches "921\*", 1, 0) as HTTP<br />\| if (waf\_rule\_id matches "930\*" or waf\_rule\_id matches "931\*" or waf\_rule\_id matches "932\*", 1, 0) as LFI\_RCE\_RFI<br />\| if (waf\_rule\_id matches "933\*", 1, 0) as PHP<br />\| if (waf\_rule\_id matches "941\*", 1, 0) as XSS<br />\| if (waf\_rule\_id matches "942\*", 1, 0) as SQLInjection<br />\| if (waf\_rule\_id matches "943\*", 1, 0) as SessionFixation<br />\| timeslice 1h<br />\| sum (ThresholdException) as ThresholdExceptions, sum (HTTP) as HTTPs, sum (LFI\_RCE\_RFI) as LFI\_RCE\_RFIs, sum (PHP) as PHPs, sum (XSS) as XSS, sum (SQLInjection) as SQLInjections, sum (SessionFixation) as SessionFixations by \_timeslice|
|Fastly/WAF|Overall Threat Trends|Logs|Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"") <br />\| json "client\_ip", "waf\_executed", "waf\_rule\_id" as client\_ip, waf\_executed, waf\_rule\_id nodrop<br />\| where waf\_executed = "1"<br />\| if (waf\_rule\_id matches "101\*", 1, 0) as ThresholdException<br />\| if (waf\_rule\_id matches "920\*" or waf\_rule\_id matches "921\*", 1, 0) as HTTP<br />\| if (waf\_rule\_id matches "930\*" or waf\_rule\_id matches "931\*" or waf\_rule\_id matches "932\*", 1, 0) as LFI\_RCE\_RFI<br />\| if (waf\_rule\_id matches "933\*", 1, 0) as PHP<br />\| if (waf\_rule\_id matches "941\*", 1, 0) as XSS<br />\| if (waf\_rule\_id matches "942\*", 1, 0) as SQLInjection<br />\| if (waf\_rule\_id matches "943\*", 1, 0) as SessionFixation<br />\| timeslice 1h<br />\| sum (ThresholdException) as ThresholdExceptions, sum (HTTP) as HTTPs, sum (LFI\_RCE\_RFI) as LFI\_RCE\_RFIs, sum (PHP) as PHPs, sum (XSS) as XSS, sum (SQLInjection) as SQLInjections, sum (SessionFixation) as SessionFixations by \_timeslice|
|Fastly/WAF|OWASP (overall)|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - OWASP|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"" "waf\_anomaly\_score")<br />\| json "waf\_executed", "waf\_anomaly\_score" as waf\_executed, waf\_anomaly\_score nodrop <br />\| where waf\_executed="1"<br />\|where waf\_anomaly\_score matches "{{waf\_anomaly\_score}}"<br />\|min(waf\_anomaly\_score) as min, pct(waf\_anomaly\_score, 25) as lower, pct(waf\_anomaly\_score, 50) as median, pct(waf\_anomaly\_score, 75) as upper, max(waf\_anomaly\_score) as max, avg(waf\_anomaly\_score) as avg|
|Fastly/WAF|OWASP (overall)|Logs|Fastly/WAF/Fastly - WAF - OWASP|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"" "waf\_anomaly\_score")<br />\| json "waf\_executed", "waf\_anomaly\_score" as waf\_executed, waf\_anomaly\_score nodrop <br />\| where waf\_executed="1"<br />\|where waf\_anomaly\_score matches "{{waf\_anomaly\_score}}"<br />\|min(waf\_anomaly\_score) as min, pct(waf\_anomaly\_score, 25) as lower, pct(waf\_anomaly\_score, 50) as median, pct(waf\_anomaly\_score, 75) as upper, max(waf\_anomaly\_score) as max, avg(waf\_anomaly\_score) as avg|
|Fastly/CDN|Performance (millisecs) Stats by Country|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Quality of Service|\_sourceCategory={{Logsdatasource}}    <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","cache\_status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip , cache\_status<br />\| if (cache\_status = "HIT", 1,0) as cache\_offload<br />\| time\_elapsed/1000 as time\_elapsed<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND cache\_status matches "{{Status}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as requests, sum(cache\_offload) as cache\_offload, pct(time\_elapsed, 5) as pct\_5, pct(time\_elapsed, 25) as lowerq, pct(time\_elapsed, 50) as median, pct(time\_elapsed, 75) as upperq, pct(time\_elapsed, 95) as pct\_95,avg(time\_elapsed) as average by geo\_country\_code<br />\| round(cache\_offload\*100/requests) as hit\_pct \| fields -cache\_offload <br />\| round(pct\_5) \| round(lowerq)\| round(median)\| round(upperq)\| round(pct\_95)\| round(average)<br />\| sort by average|
|Fastly/CDN|Performance (millisecs) Stats by Country|Logs|Fastly/CDN/Fastly - CDN - Quality of Service|\_sourceCategory={{Logsdatasource}}    <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","cache\_status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip , cache\_status<br />\| if (cache\_status = "HIT", 1,0) as cache\_offload<br />\| time\_elapsed/1000 as time\_elapsed<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND cache\_status matches "{{Status}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as requests, sum(cache\_offload) as cache\_offload, pct(time\_elapsed, 5) as pct\_5, pct(time\_elapsed, 25) as lowerq, pct(time\_elapsed, 50) as median, pct(time\_elapsed, 75) as upperq, pct(time\_elapsed, 95) as pct\_95,avg(time\_elapsed) as average by geo\_country\_code<br />\| round(cache\_offload\*100/requests) as hit\_pct \| fields -cache\_offload <br />\| round(pct\_5) \| round(lowerq)\| round(median)\| round(upperq)\| round(pct\_95)\| round(average)<br />\| sort by average|
|Fastly/CDN|Performance (millisecs) Stats by Data Center|Logs|Fastly/CDN/Fastly - CDN - Quality of Service|\_sourceCategory={{Logsdatasource}}    <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","cache\_status","geo\_datacenter" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip , cache\_status, geo\_datacenter<br />\| if (cache\_status = "HIT", 1,0) as cache\_offload<br />\| time\_elapsed/1000 as time\_elapsed<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND cache\_status matches "{{Status}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as requests, sum(cache\_offload) as cache\_offload, pct(time\_elapsed, 5) as pct\_5, pct(time\_elapsed, 25) as lowerq, pct(time\_elapsed, 50) as median, pct(time\_elapsed, 75) as upperq, pct(time\_elapsed, 95) as pct\_95,avg(time\_elapsed) as average by geo\_datacenter<br />\| round(cache\_offload\*100/requests) as hit\_pct \| fields -cache\_offload <br />\| round(pct\_5) \| round(lowerq)\| round(median)\| round(upperq)\| round(pct\_95)\| round(average)<br />\| sort by average|
|Fastly/CDN|Performance (millisecs) Stats by Data Center|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Quality of Service|\_sourceCategory={{Logsdatasource}}    <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","cache\_status","geo\_datacenter" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip , cache\_status, geo\_datacenter<br />\| if (cache\_status = "HIT", 1,0) as cache\_offload<br />\| time\_elapsed/1000 as time\_elapsed<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND cache\_status matches "{{Status}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as requests, sum(cache\_offload) as cache\_offload, pct(time\_elapsed, 5) as pct\_5, pct(time\_elapsed, 25) as lowerq, pct(time\_elapsed, 50) as median, pct(time\_elapsed, 75) as upperq, pct(time\_elapsed, 95) as pct\_95,avg(time\_elapsed) as average by geo\_datacenter<br />\| round(cache\_offload\*100/requests) as hit\_pct \| fields -cache\_offload <br />\| round(pct\_5) \| round(lowerq)\| round(median)\| round(upperq)\| round(pct\_95)\| round(average)<br />\| sort by average|
|Fastly/WAF|PHP Injection|Logs|Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"" and 933\*)<br />\| json "client\_ip", "waf\_executed", "waf\_rule\_id" as client\_ip, waf\_executed, waf\_rule\_id<br />\| where waf\_executed = "1" and (waf\_rule\_id matches "933\*")<br />\|where client\_ip matches "{{client\_ip}}"<br />\|count as total\_requests by client\_ip<br />\| top 10 client\_ip by total\_requests|
|Fastly/WAF|PHP Injection|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"" and 933\*)<br />\| json "client\_ip", "waf\_executed", "waf\_rule\_id" as client\_ip, waf\_executed, waf\_rule\_id<br />\| where waf\_executed = "1" and (waf\_rule\_id matches "933\*")<br />\|where client\_ip matches "{{client\_ip}}"<br />\|count as total\_requests by client\_ip<br />\| top 10 client\_ip by total\_requests|
|Fastly/WAF|PHP Injections (933xxx\_rules)|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - OWASP|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"" "waf\_php\_score")<br />\| json "waf\_executed", "waf\_php\_score" as waf\_executed, waf\_php\_score nodrop<br />\| where waf\_executed="1" and waf\_php\_score \>= 0<br />\|where waf\_php\_score matches "{{waf\_php\_score}}"<br />\|min(waf\_php\_score) as min, pct(waf\_php\_score, 25) as lower, pct(waf\_php\_score, 50) as median, pct(waf\_php\_score, 75) as upper, max(waf\_php\_score) as max, avg(waf\_php\_score) as avg|
|Fastly/WAF|PHP Injections (933xxx\_rules)|Logs|Fastly/WAF/Fastly - WAF - OWASP|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"" "waf\_php\_score")<br />\| json "waf\_executed", "waf\_php\_score" as waf\_executed, waf\_php\_score nodrop<br />\| where waf\_executed="1" and waf\_php\_score \>= 0<br />\|where waf\_php\_score matches "{{waf\_php\_score}}"<br />\|min(waf\_php\_score) as min, pct(waf\_php\_score, 25) as lower, pct(waf\_php\_score, 50) as median, pct(waf\_php\_score, 75) as upper, max(waf\_php\_score) as max, avg(waf\_php\_score) as avg|
|Fastly/CDN|Requests by Content Type|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}     <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip", "content\_type" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, content\_type  <br />\| where !isEmpty(content\_type)<br />\| toLowerCase(content\_type) as content\_type<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by content\_type|
|Fastly/CDN|Requests by Content Type|Logs|Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}     <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip", "content\_type" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, content\_type  <br />\| where !isEmpty(content\_type)<br />\| toLowerCase(content\_type) as content\_type<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by content\_type|
|Fastly/CDN|Requests by Country|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}} <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by geo\_country\_code|
|Fastly/CDN|Requests by Country|Logs|Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}} <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by geo\_country\_code|
|Fastly/CDN|Requests by DataCenter|Logs|Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}} <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code", "geo\_datacenter","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, geo\_datacenter, src\_ip, status<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by geo\_datacenter|
|Fastly/CDN|Requests by DataCenter|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}} <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code", "geo\_datacenter","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, geo\_datacenter, src\_ip, status<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by geo\_datacenter|
|Fastly/CDN|Requests by User Agent|Logs|Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| urldecode(user\_agent) as user\_agent<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by user\_agent \| sort \_count|
|Fastly/CDN|Requests by User Agent|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| urldecode(user\_agent) as user\_agent<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by user\_agent \| sort \_count|
|Fastly/WAF|RFI (931xxx\_rules)|Logs|Fastly/WAF/Fastly - WAF - OWASP|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"" "waf\_rfi\_score")<br />\| json "waf\_executed", "waf\_rfi\_score" as waf\_executed, waf\_rfi\_score nodrop<br />\| where waf\_executed="1" and waf\_rfi\_score \>= 0<br />\|min(waf\_rfi\_score) as min, pct(waf\_rfi\_score, 25) as lower, pct(waf\_rfi\_score, 50) as median, pct(waf\_rfi\_score, 75) as upper, max(waf\_rfi\_score) as max, avg(waf\_rfi\_score) as avg|
|Fastly/WAF|RFI (931xxx\_rules)|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - OWASP|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"" "waf\_rfi\_score")<br />\| json "waf\_executed", "waf\_rfi\_score" as waf\_executed, waf\_rfi\_score nodrop<br />\| where waf\_executed="1" and waf\_rfi\_score \>= 0<br />\|min(waf\_rfi\_score) as min, pct(waf\_rfi\_score, 25) as lower, pct(waf\_rfi\_score, 50) as median, pct(waf\_rfi\_score, 75) as upper, max(waf\_rfi\_score) as max, avg(waf\_rfi\_score) as avg|
|Fastly/WAF|Rule Count Block|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - Overview|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"" "\\"waf\_block\\":\\"1\\"")<br />\| json "waf\_rule\_id", "waf\_block","waf\_message", "client\_ip","waf\_executed" as waf\_rule\_id, waf\_block, waf\_message, client\_ip, waf\_executed nodrop<br />//review logs that went through waf ruleset and<br />\| where waf\_executed="1" and waf\_block="1"<br />\|count\_distinct(client\_ip) as distinct\_ips, count as total by waf\_rule\_id, waf\_message<br />\| top 10 waf\_rule\_id, waf\_message, distinct\_ips by total|
|Fastly/WAF|Rule Count Block|Logs|Fastly/WAF/Fastly - WAF - Overview|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"" "\\"waf\_block\\":\\"1\\"")<br />\| json "waf\_rule\_id", "waf\_block","waf\_message", "client\_ip","waf\_executed" as waf\_rule\_id, waf\_block, waf\_message, client\_ip, waf\_executed nodrop<br />//review logs that went through waf ruleset and<br />\| where waf\_executed="1" and waf\_block="1"<br />\|count\_distinct(client\_ip) as distinct\_ips, count as total by waf\_rule\_id, waf\_message<br />\| top 10 waf\_rule\_id, waf\_message, distinct\_ips by total|
|Fastly/WAF|Rule Count Warn|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - Overview|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"")<br />\| json "waf\_rule\_id", "waf\_logged", "waf\_block", "waf\_passed", "waf\_anomaly\_score", "waf\_message", "client\_ip", "waf\_executed" as waf\_rule\_id, waf\_logged, waf\_block, waf\_passed, waf\_anomaly\_score, waf\_message, client\_ip, waf\_executed nodrop<br />//review logs that went through waf ruleset and<br />// where URL is logged but not blocked (monitor mode) or where URL is logged and not blocked due to not exceeding threshold settings (block mode)<br />\| where waf\_executed="1" and ((waf\_logged = "1" and waf\_block = "0") or (waf\_passed = "1" and waf\_anomaly\_score \> 0))<br />\|count\_distinct(client\_ip) as distinct\_ips, count as total by waf\_rule\_id, waf\_message<br />\| top 10 waf\_rule\_id, waf\_message, distinct\_ips by total|
|Fastly/WAF|Rule Count Warn|Logs|Fastly/WAF/Fastly - WAF - Overview|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"")<br />\| json "waf\_rule\_id", "waf\_logged", "waf\_block", "waf\_passed", "waf\_anomaly\_score", "waf\_message", "client\_ip", "waf\_executed" as waf\_rule\_id, waf\_logged, waf\_block, waf\_passed, waf\_anomaly\_score, waf\_message, client\_ip, waf\_executed nodrop<br />//review logs that went through waf ruleset and<br />// where URL is logged but not blocked (monitor mode) or where URL is logged and not blocked due to not exceeding threshold settings (block mode)<br />\| where waf\_executed="1" and ((waf\_logged = "1" and waf\_block = "0") or (waf\_passed = "1" and waf\_anomaly\_score \> 0))<br />\|count\_distinct(client\_ip) as distinct\_ips, count as total by waf\_rule\_id, waf\_message<br />\| top 10 waf\_rule\_id, waf\_message, distinct\_ips by total|
|Fastly/WAF|Session Fixations (943xxx\_rules)|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - OWASP|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"" "waf\_session\_fixation\_score")<br />\| json "waf\_executed", "waf\_session\_fixation\_score" as waf\_executed, waf\_session\_fixation\_score nodrop<br />\| where waf\_session\_fixation\_score \>= 0 and waf\_executed="1"<br />\|min(waf\_session\_fixation\_score) as min, pct(waf\_session\_fixation\_score, 25) as lower, pct(waf\_session\_fixation\_score, 50) as median, pct(waf\_session\_fixation\_score, 75) as upper, max(waf\_session\_fixation\_score) as max, avg(waf\_session\_fixation\_score) as avg|
|Fastly/WAF|Session Fixations (943xxx\_rules)|Logs|Fastly/WAF/Fastly - WAF - OWASP|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"" "waf\_session\_fixation\_score")<br />\| json "waf\_executed", "waf\_session\_fixation\_score" as waf\_executed, waf\_session\_fixation\_score nodrop<br />\| where waf\_session\_fixation\_score \>= 0 and waf\_executed="1"<br />\|min(waf\_session\_fixation\_score) as min, pct(waf\_session\_fixation\_score, 25) as lower, pct(waf\_session\_fixation\_score, 50) as median, pct(waf\_session\_fixation\_score, 75) as upper, max(waf\_session\_fixation\_score) as max, avg(waf\_session\_fixation\_score) as avg|
|Fastly/WAF|Session-Fixation|Logs|Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"" and 943\*)<br />\| json "client\_ip", "waf\_executed", "waf\_rule\_id" as client\_ip, waf\_executed, waf\_rule\_id nodrop<br />\| where waf\_executed = "1" and waf\_rule\_id matches "943\*"<br />\|where client\_ip matches "{{client\_ip}}"<br />\|count as total\_requests by client\_ip<br />\| top 10 client\_ip by total\_requests|
|Fastly/WAF|Session-Fixation|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"" and 943\*)<br />\| json "client\_ip", "waf\_executed", "waf\_rule\_id" as client\_ip, waf\_executed, waf\_rule\_id nodrop<br />\| where waf\_executed = "1" and waf\_rule\_id matches "943\*"<br />\|where client\_ip matches "{{client\_ip}}"<br />\|count as total\_requests by client\_ip<br />\| top 10 client\_ip by total\_requests|
|Fastly/CDN|Slowest URLs (millisecs)|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Origin Performance|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status","cache\_status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status, cache\_status<br />\| urldecode(url) as url <br />\| time\_elapsed/1000 as time\_elapsed // convert to millisecs<br />\| where cache\_status = "MISS" or cache\_status = "PASS"<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|max(time\_elapsed) as max\_time\_elapsed by url<br />\| sort by max\_time\_elapsed<br />\| limit 10|
|Fastly/CDN|Slowest URLs (millisecs)|Logs|Fastly/CDN/Fastly - CDN - Origin Performance|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status","cache\_status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status, cache\_status<br />\| urldecode(url) as url <br />\| time\_elapsed/1000 as time\_elapsed // convert to millisecs<br />\| where cache\_status = "MISS" or cache\_status = "PASS"<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|max(time\_elapsed) as max\_time\_elapsed by url<br />\| sort by max\_time\_elapsed<br />\| limit 10|
|Fastly/WAF|SQL Injection|Logs|Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"" and 942\*)<br />\| json "client\_ip", "waf\_executed", "waf\_rule\_id" as client\_ip, waf\_executed, waf\_rule\_id nodrop<br />\| where waf\_executed = "1" and (waf\_rule\_id matches "942\*")<br />\|where client\_ip matches "{{client\_ip}}"<br />\|count as total\_requests by client\_ip<br />\| top 10 client\_ip by total\_requests|
|Fastly/WAF|SQL Injection|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"" and 942\*)<br />\| json "client\_ip", "waf\_executed", "waf\_rule\_id" as client\_ip, waf\_executed, waf\_rule\_id nodrop<br />\| where waf\_executed = "1" and (waf\_rule\_id matches "942\*")<br />\|where client\_ip matches "{{client\_ip}}"<br />\|count as total\_requests by client\_ip<br />\| top 10 client\_ip by total\_requests|
|Fastly/WAF|SQL Injections (942xxx\_rules)|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - OWASP|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"" "waf\_sql\_score")<br />\| json "waf\_executed", "waf\_sql\_score" as waf\_executed, waf\_sql\_score nodrop<br />\| where waf\_sql\_score \>= 0 and waf\_executed="1"<br />\|min(waf\_sql\_score) as min, pct(waf\_sql\_score, 25) as lower, pct(waf\_sql\_score, 50) as median, pct(waf\_sql\_score, 75) as upper, max(waf\_sql\_score) as max, avg(waf\_sql\_score) as avg|
|Fastly/WAF|SQL Injections (942xxx\_rules)|Logs|Fastly/WAF/Fastly - WAF - OWASP|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"" "waf\_sql\_score")<br />\| json "waf\_executed", "waf\_sql\_score" as waf\_executed, waf\_sql\_score nodrop<br />\| where waf\_sql\_score \>= 0 and waf\_executed="1"<br />\|min(waf\_sql\_score) as min, pct(waf\_sql\_score, 25) as lower, pct(waf\_sql\_score, 50) as median, pct(waf\_sql\_score, 75) as upper, max(waf\_sql\_score) as max, avg(waf\_sql\_score) as avg|
|Fastly/WAF|Threshold Exceptions|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"" and 101\*)<br />\| json "client\_ip", "waf\_executed", "waf\_rule\_id" as client\_ip, waf\_executed, waf\_rule\_id nodrop<br />\| where waf\_executed = "1" and waf\_rule\_id matches "101\*"<br />\|where client\_ip matches "{{client\_ip}}"<br />\|count as total\_requests by client\_ip<br />\| top 10 client\_ip by total\_requests|
|Fastly/WAF|Threshold Exceptions|Logs|Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"" and 101\*)<br />\| json "client\_ip", "waf\_executed", "waf\_rule\_id" as client\_ip, waf\_executed, waf\_rule\_id nodrop<br />\| where waf\_executed = "1" and waf\_rule\_id matches "101\*"<br />\|where client\_ip matches "{{client\_ip}}"<br />\|count as total\_requests by client\_ip<br />\| top 10 client\_ip by total\_requests|
|Fastly/CDN|TLS Usage|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip<br />\| json "is\_tls"<br />\| if(is\_tls = "true","TLS","Not TLS") as is\_tls<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by is\_tls|
|Fastly/CDN|TLS Usage|Logs|Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip<br />\| json "is\_tls"<br />\| if(is\_tls = "true","TLS","Not TLS") as is\_tls<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by is\_tls|
|Fastly/CDN|Top 10 Referrers|Logs|Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}     <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip", "request\_referer" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, request\_referer<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by request\_referer \| top 10 request\_referer by \_count|
|Fastly/CDN|Top 10 Referrers|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}     <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip", "request\_referer" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, request\_referer<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by request\_referer \| top 10 request\_referer by \_count|
|Fastly/CDN|Top 404-Causing URLs|Logs|Fastly/CDN/Fastly - CDN - Origin Performance|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| urldecode(url) as url<br />\| where status = 404<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as errors by url \| sort by errors \| limit 25|
|Fastly/CDN|Top 404-Causing URLs|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Overview|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| urldecode(url) as url<br />\| where status = 404<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND status matches "{{Status}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as errors by url \| sort by errors \| limit 25|
|Fastly/CDN|Top 404-Causing URLs|Logs|Fastly/CDN/Fastly - CDN - Overview|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| urldecode(url) as url<br />\| where status = 404<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND status matches "{{Status}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as errors by url \| sort by errors \| limit 25|
|Fastly/CDN|Top 404-Causing URLs|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Origin Performance|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| urldecode(url) as url<br />\| where status = 404<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as errors by url \| sort by errors \| limit 25|
|Fastly/CDN|Top 5XX Error-Causing URLs|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Origin Performance|\_sourceCategory={{Logsdatasource}}  50?<br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| urldecode(url) as url <br />\| where status \> 499<br />\| where status \< 600<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as errors by url<br />\| sort by errors|
|Fastly/CDN|Top 5XX Error-Causing URLs|Logs|Fastly/CDN/Fastly - CDN - Origin Performance|\_sourceCategory={{Logsdatasource}}  50?<br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| urldecode(url) as url <br />\| where status \> 499<br />\| where status \< 600<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as errors by url<br />\| sort by errors|
|Fastly/WAF|Top Clients Affected by Threats|Logs|Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"") <br />\| json "client\_ip", "waf\_executed", "waf\_rule\_id", "url" as client\_ip, waf\_executed, waf\_rule\_id, url nodrop<br />\| where waf\_executed = "1"<br />\| "Other" as threatCategory<br />\| if (waf\_rule\_id matches "101\*", "ThresholdException", threatCategory) as threatCategory<br />\| if (waf\_rule\_id matches "920\*" or waf\_rule\_id matches "921\*", "HTTP", threatCategory) as threatCategory<br />\| if (waf\_rule\_id matches "930\*" or waf\_rule\_id matches "931\*" or waf\_rule\_id matches "932\*", "LFI\_RCE\_RFI", threatCategory) as threatCategory<br />\| if (waf\_rule\_id matches "933\*", "PHP", threatCategory) as threatCategory<br />\| if (waf\_rule\_id matches "941\*", "XSS", threatCategory) as threatCategory<br />\| if (waf\_rule\_id matches "942\*", "SQLInjection", threatCategory) as threatCategory<br />\| if (waf\_rule\_id matches "943\*", "SessionFixation", threatCategory) as threatCategory<br />\| count\_distinct(threatCategory) as unique\_threat\_category by client\_ip <br />\| top 10 client\_ip by unique\_threat\_category|
|Fastly/WAF|Top Clients Affected by Threats|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"") <br />\| json "client\_ip", "waf\_executed", "waf\_rule\_id", "url" as client\_ip, waf\_executed, waf\_rule\_id, url nodrop<br />\| where waf\_executed = "1"<br />\| "Other" as threatCategory<br />\| if (waf\_rule\_id matches "101\*", "ThresholdException", threatCategory) as threatCategory<br />\| if (waf\_rule\_id matches "920\*" or waf\_rule\_id matches "921\*", "HTTP", threatCategory) as threatCategory<br />\| if (waf\_rule\_id matches "930\*" or waf\_rule\_id matches "931\*" or waf\_rule\_id matches "932\*", "LFI\_RCE\_RFI", threatCategory) as threatCategory<br />\| if (waf\_rule\_id matches "933\*", "PHP", threatCategory) as threatCategory<br />\| if (waf\_rule\_id matches "941\*", "XSS", threatCategory) as threatCategory<br />\| if (waf\_rule\_id matches "942\*", "SQLInjection", threatCategory) as threatCategory<br />\| if (waf\_rule\_id matches "943\*", "SessionFixation", threatCategory) as threatCategory<br />\| count\_distinct(threatCategory) as unique\_threat\_category by client\_ip <br />\| top 10 client\_ip by unique\_threat\_category|
|Fastly/WAF|Top Messages (Blocked)|Logs|Fastly/WAF/Fastly - WAF - Overview|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"" "\\"waf\_block\\":\\"1\\"")<br />\| json "waf\_rule\_id", "waf\_block", "waf\_message", "waf\_executed" as waf\_rule\_id, waf\_block, waf\_message, waf\_executed nodrop<br />//review logs that went through waf ruleset and URLs that are blocked and<br />\| where waf\_executed="1" and waf\_block="1"<br />\|count as block by waf\_rule\_id, waf\_message<br />\| sort by block|
|Fastly/WAF|Top Messages (Blocked)|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - Overview|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"" "\\"waf\_block\\":\\"1\\"")<br />\| json "waf\_rule\_id", "waf\_block", "waf\_message", "waf\_executed" as waf\_rule\_id, waf\_block, waf\_message, waf\_executed nodrop<br />//review logs that went through waf ruleset and URLs that are blocked and<br />\| where waf\_executed="1" and waf\_block="1"<br />\|count as block by waf\_rule\_id, waf\_message<br />\| sort by block|
|Fastly/WAF|Top Messages (Warn)|Logs|Fastly/WAF/Fastly - WAF - Overview|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"")<br />\| json "waf\_rule\_id", "waf\_logged", "waf\_block", "waf\_passed", "waf\_anomaly\_score", "waf\_message", "waf\_executed" as waf\_rule\_id, waf\_logged, waf\_block, waf\_passed, waf\_anomaly\_score, waf\_message, waf\_executed nodrop<br />//review logs that went through waf ruleset and<br />// where URL is logged but not blocked (monitor mode) or where URL is logged and not blocked due to not exceeding threshold settings (block mode)<br />\| where  waf\_executed="1" and ((waf\_logged = "1" and waf\_block = "0") or (waf\_passed = "1" and waf\_anomaly\_score \> 0))<br />\|count as warns by waf\_rule\_id, waf\_message<br />\| sort by warns|
|Fastly/WAF|Top Messages (Warn)|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - Overview|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"")<br />\| json "waf\_rule\_id", "waf\_logged", "waf\_block", "waf\_passed", "waf\_anomaly\_score", "waf\_message", "waf\_executed" as waf\_rule\_id, waf\_logged, waf\_block, waf\_passed, waf\_anomaly\_score, waf\_message, waf\_executed nodrop<br />//review logs that went through waf ruleset and<br />// where URL is logged but not blocked (monitor mode) or where URL is logged and not blocked due to not exceeding threshold settings (block mode)<br />\| where  waf\_executed="1" and ((waf\_logged = "1" and waf\_block = "0") or (waf\_passed = "1" and waf\_anomaly\_score \> 0))<br />\|count as warns by waf\_rule\_id, waf\_message<br />\| sort by warns|
|Fastly/CDN|Top Requests|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}   <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| urldecode(url) as url<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count\_frequent(url) \| top 10 url by \_approxcount|
|Fastly/CDN|Top Requests|Logs|Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}   <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| urldecode(url) as url<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count\_frequent(url) \| top 10 url by \_approxcount|
|Fastly/CDN|Top Server Error-Causing URLs|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Overview|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| urldecode(url) as url \| int(status) as status<br />\| where (status \> 499) and (status \< 600)<br />\| count as errors by url \| sort by errors \| limit 25|
|Fastly/CDN|Top Server Error-Causing URLs|Logs|Fastly/CDN/Fastly - CDN - Overview|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| urldecode(url) as url \| int(status) as status<br />\| where (status \> 499) and (status \< 600)<br />\| count as errors by url \| sort by errors \| limit 25|
|Fastly/WAF|Top URLS (Blocked)|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - Overview|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"" "\\"waf\_block\\":\\"1\\"")<br />\| json "url", "status", "waf\_executed", "waf\_block" as url, status, waf\_executed, waf\_block nodrop<br />//show Top URLs blocked within reporting time window<br />\| where waf\_executed="1" and waf\_block="1"<br />\|count as block by url, status<br />\| top 10 url, status by block<br />\| urldecode(url) as url|
|Fastly/WAF|Top URLS (Blocked)|Logs|Fastly/WAF/Fastly - WAF - Overview|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"" "\\"waf\_block\\":\\"1\\"")<br />\| json "url", "status", "waf\_executed", "waf\_block" as url, status, waf\_executed, waf\_block nodrop<br />//show Top URLs blocked within reporting time window<br />\| where waf\_executed="1" and waf\_block="1"<br />\|count as block by url, status<br />\| top 10 url, status by block<br />\| urldecode(url) as url|
|Fastly/WAF|Top URLS (Warn)|Logs|Fastly/WAF/Fastly - WAF - Overview|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"")<br />\| json "url", "waf\_logged", "waf\_passed", "waf\_block", "waf\_anomaly\_score","waf\_executed" as url, waf\_logged, waf\_passed, waf\_block, waf\_anomaly\_score, waf\_executed nodrop<br />//review logs that went through waf ruleset and where URL is logged but not blocked (monitor mode) or where URL is logged and not blocked due to not exceeding threshold settings (block mode)<br />\| where waf\_executed="1" and ((waf\_logged = "1" and waf\_block = "0") or (waf\_passed = "1" and waf\_anomaly\_score \> 0))<br />\|count as warns by url<br />\| top 10 url by warns<br />\| urldecode(url) as url|
|Fastly/WAF|Top URLS (Warn)|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - Overview|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"")<br />\| json "url", "waf\_logged", "waf\_passed", "waf\_block", "waf\_anomaly\_score","waf\_executed" as url, waf\_logged, waf\_passed, waf\_block, waf\_anomaly\_score, waf\_executed nodrop<br />//review logs that went through waf ruleset and where URL is logged but not blocked (monitor mode) or where URL is logged and not blocked due to not exceeding threshold settings (block mode)<br />\| where waf\_executed="1" and ((waf\_logged = "1" and waf\_block = "0") or (waf\_passed = "1" and waf\_anomaly\_score \> 0))<br />\|count as warns by url<br />\| top 10 url by warns<br />\| urldecode(url) as url|
|Fastly/CDN|Total Request Size Over Time|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}     <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","req\_header\_size","req\_body\_size" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip,req\_header\_size,req\_body\_size <br />\| timeslice 1h<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as totalCount, sum(req\_header\_size) as req\_header\_size,sum(req\_body\_size) as req\_body\_size by \_timeslice  <br />\| req\_header\_size + req\_body\_size as total\_req\_size <br />\| fields -totalCount,req\_header\_size,req\_body\_size|
|Fastly/CDN|Total Request Size Over Time|Logs|Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}     <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","req\_header\_size","req\_body\_size" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip,req\_header\_size,req\_body\_size <br />\| timeslice 1h<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as totalCount, sum(req\_header\_size) as req\_header\_size,sum(req\_body\_size) as req\_body\_size by \_timeslice  <br />\| req\_header\_size + req\_body\_size as total\_req\_size <br />\| fields -totalCount,req\_header\_size,req\_body\_size|
|Fastly/CDN|Total Response Size Over Time|Logs|Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}     <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","req\_header\_size","resp\_body\_size" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip,req\_header\_size,resp\_body\_size <br />\| timeslice 1h<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as totalCount, sum(req\_header\_size) as req\_header\_size,sum(resp\_body\_size) as resp\_body\_size by \_timeslice  <br />\| req\_header\_size + resp\_body\_size as total\_resp\_size <br />\| fields -totalCount,req\_header\_size,resp\_body\_size|
|Fastly/CDN|Total Response Size Over Time|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}     <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","req\_header\_size","resp\_body\_size" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip,req\_header\_size,resp\_body\_size <br />\| timeslice 1h<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND geo\_region matches "{{Geo Region}}"<br />\|count as totalCount, sum(req\_header\_size) as req\_header\_size,sum(resp\_body\_size) as resp\_body\_size by \_timeslice  <br />\| req\_header\_size + resp\_body\_size as total\_resp\_size <br />\| fields -totalCount,req\_header\_size,resp\_body\_size|
|Fastly/CDN|Visitor Countries|Logs|Fastly/CDN/Fastly - CDN - Overview|\_sourceCategory={{Logsdatasource}} <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND status matches "{{Status}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by geo\_country\_code|
|Fastly/CDN|Visitor Countries|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Overview|\_sourceCategory={{Logsdatasource}} <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND status matches "{{Status}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by geo\_country\_code|
|Fastly/CDN|Visitor Geolocations|Logs|Fastly/CDN/Fastly - CDN - Overview|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| lookup latitude, longitude, country\_code from geo://location on ip = src\_ip<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND status matches "{{Status}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|count\_distinct(src\_ip) as \_count by latitude, longitude|
|Fastly/CDN|Visitor Geolocations|Logs|Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| lookup country\_name,city from geo://location on ip = src\_ip<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by city,country\_name|
|Fastly/CDN|Visitor Geolocations|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Overview|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| lookup latitude, longitude, country\_code from geo://location on ip = src\_ip<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND url matches "{{Url}}" AND status matches "{{Status}}" AND user\_agent matches "{{User Agent}}" AND geo\_region matches "{{Geo Region}}"<br />\|count\_distinct(src\_ip) as \_count by latitude, longitude|
|Fastly/CDN|Visitor Geolocations|Logs|Installed Apps/Fastly/CDN/Fastly - CDN - Visitors|\_sourceCategory={{Logsdatasource}}  <br />\| json "request\_user\_agent", "time\_elapsed", "url","geo\_region","geo\_country\_code","client\_ip","status" as user\_agent, time\_elapsed, url, geo\_region, geo\_country\_code, src\_ip, status<br />\| lookup country\_name,city from geo://location on ip = src\_ip<br />\|where geo\_country\_code matches "{{Country Code}}" AND src\_ip matches "{{Client IP}}" AND status matches "{{Status}}" AND geo\_region matches "{{Geo Region}}"<br />\|count by city,country\_name|
|Fastly/WAF|WAF States|Logs|Fastly/WAF/Fastly - WAF - Overview|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"")<br />\| json "waf\_failures", "waf\_logged", "waf\_passed", "waf\_anomaly\_score", "waf\_block", "waf\_executed" as waf\_failures, waf\_logged, waf\_passed, waf\_anomaly\_score, waf\_block, waf\_executed nodrop<br />//review logs that went through waf ruleset <br />\| where waf\_executed="1"<br />\| timeslice 15m<br />//capture different use cases - log, block, pass, failure(error)<br />\| if ((waf\_logged = "1" and waf\_block = "0") or (waf\_passed = "1" and waf\_anomaly\_score \> 0),1,0) as waf\_logged<br />\| if (waf\_failures = "1",1,0) as waf\_failures<br />\| if (waf\_block = "1",1,0) as waf\_block<br />\| if (waf\_passed = "1" and (waf\_logged = "0" and waf\_block= "0"),1,0) as waf\_passed<br />\|sum(waf\_logged) as warn, sum(waf\_failures) as error, sum(waf\_block) as bad, sum(waf\_passed) as good by \_timeslice|
|Fastly/WAF|WAF States|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - Overview|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"")<br />\| json "waf\_failures", "waf\_logged", "waf\_passed", "waf\_anomaly\_score", "waf\_block", "waf\_executed" as waf\_failures, waf\_logged, waf\_passed, waf\_anomaly\_score, waf\_block, waf\_executed nodrop<br />//review logs that went through waf ruleset <br />\| where waf\_executed="1"<br />\| timeslice 15m<br />//capture different use cases - log, block, pass, failure(error)<br />\| if ((waf\_logged = "1" and waf\_block = "0") or (waf\_passed = "1" and waf\_anomaly\_score \> 0),1,0) as waf\_logged<br />\| if (waf\_failures = "1",1,0) as waf\_failures<br />\| if (waf\_block = "1",1,0) as waf\_block<br />\| if (waf\_passed = "1" and (waf\_logged = "0" and waf\_block= "0"),1,0) as waf\_passed<br />\|sum(waf\_logged) as warn, sum(waf\_failures) as error, sum(waf\_block) as bad, sum(waf\_passed) as good by \_timeslice|
|Fastly/WAF|XSS|Logs|Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"" and 941\*)<br />\| json "client\_ip", "waf\_executed", "waf\_rule\_id" as client\_ip, waf\_executed, waf\_rule\_id nodrop<br />\| where waf\_executed="1" and (waf\_rule\_id matches "941\*")<br />\|where client\_ip matches "{{client\_ip}}"<br />\|count as total\_requests by client\_ip<br />\| top 10 client\_ip by total\_requests|
|Fastly/WAF|XSS|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - Offenders|(\_sourceCategory={{Logsdatasource1}}  OR \_sourceCategory={{Logsdatasource}} ) ("\\"waf\_executed\\":\\"1\\"" and 941\*)<br />\| json "client\_ip", "waf\_executed", "waf\_rule\_id" as client\_ip, waf\_executed, waf\_rule\_id nodrop<br />\| where waf\_executed="1" and (waf\_rule\_id matches "941\*")<br />\|where client\_ip matches "{{client\_ip}}"<br />\|count as total\_requests by client\_ip<br />\| top 10 client\_ip by total\_requests|
|Fastly/WAF|XSS (941xxx\_rules)|Logs|Fastly/WAF/Fastly - WAF - OWASP|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"" "waf\_xss\_score")<br />\| json "waf\_executed", "waf\_xss\_score" as waf\_executed, waf\_xss\_score nodrop<br />\| where waf\_xss\_score \>= 0 and waf\_executed = "1"<br />\|min(waf\_xss\_score) as min, pct(waf\_xss\_score, 25) as lower, pct(waf\_xss\_score, 50) as median, pct(waf\_xss\_score, 75) as upper, max(waf\_xss\_score) as max, avg(waf\_xss\_score) as avg|
|Fastly/WAF|XSS (941xxx\_rules)|Logs|Installed Apps/Fastly/WAF/Fastly - WAF - OWASP|\_sourceCategory={{Logsdatasource1}}  ("\\"waf\_executed\\":\\"1\\"" "waf\_xss\_score")<br />\| json "waf\_executed", "waf\_xss\_score" as waf\_executed, waf\_xss\_score nodrop<br />\| where waf\_xss\_score \>= 0 and waf\_executed = "1"<br />\|min(waf\_xss\_score) as min, pct(waf\_xss\_score, 25) as lower, pct(waf\_xss\_score, 50) as median, pct(waf\_xss\_score, 75) as upper, max(waf\_xss\_score) as max, avg(waf\_xss\_score) as avg|

