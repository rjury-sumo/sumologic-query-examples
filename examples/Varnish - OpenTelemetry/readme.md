# Varnish - OpenTelemetry

## Searches

### Log Searches

- **Browsers and Operating Systems**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight 
- **Bytes Served**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight 
- **Bytes Served - Outlier**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Outlier Analysis 
- **Client Errors**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Outlier Analysis 
- **Client Locations - 4xx Errors**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations 
- **Error Responses by Server**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations 
- **Highly Malicious Threat Table**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Threat Intel 
- **HTTP Methods**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight 
- **Media Types Served**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight 
- **Non 200 Response Status Codes**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations 
- **Number of Hits by Server - One Day Time Comparison**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish  - Traffic Timeline Analysis 
- **Number of Visitors**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Outlier Analysis 
- **Popular Mobile Device Versions**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight 
- **Responses Over Time**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish  - Traffic Timeline Analysis 
- **Responses Over Time**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Overview 
- **Server Errors**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Outlier Analysis 
- **Server Errors Over Time**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations 
- **Threat by Actors**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Threat Intel 
- **Threat by Malicious Confidence**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Threat Intel 
- **Threat Locations**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Threat Intel 
- **Threat Table**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Threat Intel 
- **Threats**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Threat Intel 
- **Top 10 Bots Observed**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations 
- **Top 10 PC and Mac Versions**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight 
- **Top 10 Search Terms from Popular Search Engines**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight 
- **Top 10 URLs causing Errors**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Overview 
- **Top 5 Clients Causing 4xx Errors**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations 
- **Top 5 Clients Causing 5xx Errors**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations 
- **Top 5 Highly Malicious URLs**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Threat Intel 
- **Top 5 Messages in the Error Logs**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations 
- **Top 5 Referrers**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight 
- **Top 5 URIs causing 4xx Responses**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations 
- **Top 5 URIs Causing 5xx Responses**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations 
- **Top 5 URLs**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight 
- **Top Clients**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations 
- **Traffic Distribution by Server**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Overview 
- **Traffic Distribution by Server**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish  - Traffic Timeline Analysis 
- **Traffic Volume and GBytes Served**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish  - Traffic Timeline Analysis 
- **Traffic Volume and MB Served Over Time**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Overview 
- **Visitor Locations**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Overview 
- **Visitor Locations - 4xx Errors**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Overview 
- **Visitor Locations - One Day Time Comparison**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish  - Traffic Timeline Analysis 
- **Visits by Country Over Time**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight 
- **Vistor Platforms**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight 
- **Worldwide**: from Dashboard: Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Varnish - OpenTelemetry|Browsers and Operating Systems|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| if (agent matches "\*Windows \*" OR agent matches "\*Win32\*" OR agent matches "\*Win64\*","Windows","") as OS <br />\| if (agent matches "\*Macintosh\*" OR agent matches "\*Darwin/\*" OR agent matches "\*Mac OS\*","MacOS",OS) as OS <br />\| if (agent matches "\* CrOS \*","Chrome OS",OS) as OS<br />\| if (agent matches "\*Linux\*","Linux",OS) as OS <br />\| if (agent matches "\*iPad\*","iPad",OS) as OS <br />\| if (agent matches "\*iPhone\*","iPhone",OS) as OS <br />\|  if (agent matches "\*Android\*","Android",OS) as OS <br />\| if (agent matches "\*Windows Phone\*","Windows Phone",OS) as OS <br />\| if (OS == "","Other",OS) as OS <br />\| if (agent matches "Mozilla/\*; rv:\*)\*","Mozilla","") as Browser<br />\| if (agent matches "\*MSIE\*","Internet Explorer",Browser) as Browser <br />\| if (agent matches "\*Firefox\*","Firefox",Browser) as Browser <br />\| if (agent matches "\*Safari\*","Safari",Browser) as Browser <br />\| if (OS=="Android" AND agent matches "\*WebKit\*","WebKit",Browser) as Browser<br />\| if ((OS=="iPhone" OR OS=="iPad") AND (agent matches "\*Mobile/\*" OR agent matches "\*AppleWebKit\*(KHTML\*Gecko)\*"),"Mobile Safari",Browser) as Browser<br />\| if (browser ="" AND OS=="MacOS" AND agent matches "Mozilla/\* (Macintosh;\*(KHTML, like Gecko)\*","Safari",Browser) as Browser <br />\| if (agent matches "\*MobileSafari/\*","Mobile Safari",Browser) as Browser<br />\| if (agent matches "\*Chrome\*","Chrome",Browser) as Browser <br />\| if (agent matches "Opera\*","Opera",Browser) as Browser <br />\| if (agent matches "Dolphin\*","Dolphin",Browser) as Browser <br />\|  if (Browser == "","Other",Browser) as Browser  <br />\| count by OS,browser<br />\| transpose row os column browser as \*|
|Varnish - OpenTelemetry|Bytes Served|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where size != "-" and size != ""<br />\| num(size) as size<br />\| sum(size) as Bytes\_Served|
|Varnish - OpenTelemetry|Bytes Served - Outlier|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Outlier Analysis|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where size != "-" and !isEmpty(size)<br />\| number(size)<br />\| (size/(1024\*1024)) as mbytes <br />\| timeslice {{timeslice}}<br />\| sum(mbytes) as mbytes by \_timeslice <br />\| sort \_timeslice asc<br />\| outlier mbytes window={{window}}, threshold={{threshold}}, consecutive={{consecutive}}, direction=+|
|Varnish - OpenTelemetry|Client Errors|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Outlier Analysis|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| if(status\_code matches "4\*", 1, 0) as client\_errors <br />\| timeslice {{timeslice}}<br />\| count as client\_errors by \_timeslice<br />\| sort \_timeslice asc<br />\| outlier client\_errors window={{window}}, threshold={{threshold}}, consecutive={{consecutive}}, direction=+|
|Varnish - OpenTelemetry|Client Locations - 4xx Errors|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where status\_code matches "4\*" <br />\|  lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = client\_ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Varnish - OpenTelemetry|Error Responses by Server|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| num(status\_code)<br />\| where status\_code \>= 400<br />\| timeslice 5m<br />\| count as count by \_timeslice,host.name<br />\| transpose row \_timeslice column host.name|
|Varnish - OpenTelemetry|Highly Malicious Threat Table|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Threat Intel|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| lookup type, actor, raw, threatlevel as Malicious\_Confidence from sumo://threat/cs on threat=remote\_ip <br />\| where  type="ip\_address" and !isNull(Malicious\_Confidence)<br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| where Malicious\_Confidence matches "high"<br />\| count as count by Malicious\_Confidence, Actor, remote\_ip, status\_code, uri<br />\| sort by count<br />\| limit 20|
|Varnish - OpenTelemetry|HTTP Methods|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| count by method|
|Varnish - OpenTelemetry|Media Types Served|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight|sumo.datasource=varnish webengine.system=varnish  webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| parse regex field=uri "^[^\\?]+?\\.(?\<type\>[a-zA-Z]{2,4})\$" <br />\| parse regex field=uri "/\\S+?(?\<email\_prefix\>(?:%40\|@)[^.]+?)\\.\\w+" nodrop <br />\| where email\_prefix="" <br />\| count as count by type|
|Varnish - OpenTelemetry|Non 200 Response Status Codes|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br /> \| where !(status\_code matches "2\*") <br /> \| count as count by status\_code <br />\| sort by count, status\_code asc|
|Varnish - OpenTelemetry|Number of Hits by Server - One Day Time Comparison|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish  - Traffic Timeline Analysis|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| count as Number\_of\_Hits by host.name  <br />\| compare with timeshift 1d|
|Varnish - OpenTelemetry|Number of Visitors|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Outlier Analysis|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where !isEmpty(remote\_ip)<br />\| timeslice {{timeslice}}<br />\| count as hits by \_timeslice <br />\| sort \_timeslice asc<br />\| outlier hits window={{window}}, threshold={{threshold}}, consecutive={{consecutive}}, direction=+|
|Varnish - OpenTelemetry|Popular Mobile Device Versions|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight|sumo.datasource=varnish webengine.system=varnish ( iphone or ipad or android or samsung) webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw  <br />\| parse regex "\\((?\<device\>iPhone).+? CPU iPhone OS (?\<version\>.+?) like Mac"  nodrop <br />\| parse regex "\\((?\<device\>iPad).+? CPU OS (?\<version\>.+?) like Mac"  nodrop <br />\| parse regex " (?\<device\>Android) (?\<version\>[\\d\\.]+)" nodrop <br />\| parse regex "(?\<device\>SAMSUNG).+?(?\<version\>(?:GT-\\w+\|SGH-\\w+\|SPH-\\w+\|SCH-\\w+))" <br />\| count as count by device,version <br />\| sort count <br />\| limit 10 <br />|
|Varnish - OpenTelemetry|Responses Over Time|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish  - Traffic Timeline Analysis|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| if(Status\_Code matches "2\*", 1, 0) as Successes <br />\| if(Status\_Code matches "3\*", 1, 0) as Redirects <br />\| if(status\_code matches "4\*", 1, 0) as Client\_Errors <br />\| if(Status\_Code matches "5\*", 1, 0) as Server\_Errors <br />\| timeslice by 1h <br />\| sum(Successes) as Successes, sum(Client\_Errors) as Client\_Errors,  sum(Redirects) as Redirects, sum(Server\_Errors) as Server\_Errors by \_timeslice<br />\| sort by \_timeslice asc|
|Varnish - OpenTelemetry|Responses Over Time|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Overview|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"\\?]+?)(?:\\"\|\\?)"<br />\| if(status\_code matches "2\*", 1, 0) as successes <br />\| if(status\_code matches "3\*", 1, 0) as redirects <br />\| if(status\_code matches "4\*", 1, 0) as client\_errors <br />\| if(status\_code matches "5\*", 1, 0) as server\_errors <br />\| timeslice by 5m <br />\| sum(successes) as successes, sum(client\_errors) as client\_errors,  sum(redirects) as redirects, sum(server\_errors) as server\_errors by \_timeslice<br />\| sort by \_timeslice asc|
|Varnish - OpenTelemetry|Server Errors|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Outlier Analysis|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| if(status\_code matches "5\*", 1, 0) as server\_errors <br />\| timeslice {{timeslice}}<br />\| count as server\_errors by \_timeslice<br />\| sort \_timeslice asc<br />\| outlier server\_errors window={{window}}, threshold={{threshold}}, consecutive={{consecutive}}, direction=+|
|Varnish - OpenTelemetry|Server Errors Over Time|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where status\_code matches "5\*"<br />\| timeslice 5m<br />\| count as count by \_timeslice,status\_code<br />\| transpose row \_timeslice column status\_code as \*<br />|
|Varnish - OpenTelemetry|Threat by Actors|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Threat Intel|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| count as ip\_count by remote\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=remote\_ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (ip\_count) as threat\_count by Actor|
|Varnish - OpenTelemetry|Threat by Malicious Confidence|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Threat Intel|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| count as ip\_count by remote\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=remote\_ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (ip\_count) as threat\_count by malicious\_confidence|
|Varnish - OpenTelemetry|Threat Locations|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Threat Intel|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| count as ip\_count by client\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=client\_ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where type="ip\_address" and !isNull(malicious\_confidence)<br />\| count by client\_ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = client\_ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Varnish - OpenTelemetry|Threat Table|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Threat Intel|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| lookup type, actor, raw, threatlevel as Malicious\_Confidence from sumo://threat/cs on threat=remote\_ip <br />\| where  type="ip\_address" and !isNull(Malicious\_Confidence)<br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| where Malicious\_Confidence matches "high"<br />\| count as count by Malicious\_Confidence, Actor, remote\_ip, status\_code, uri,referrer,agent<br />\| sort by count<br />\| limit 50|
|Varnish - OpenTelemetry|Threats|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Threat Intel|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| count as ip\_count by remote\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=remote\_ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (ip\_count) as threat\_count|
|Varnish - OpenTelemetry|Top 10 Bots Observed|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations|sumo.datasource=varnish webengine.system=varnish ("Googlebot" OR "AskJeeves" OR "Digger" OR "Lycos"<br />OR "msnbot" OR "Inktomi Slurp" OR "Yahoo" OR "Nutch" OR "bingbot" OR<br />"BingPreview" OR "Mediapartners-Google" OR "proximic" OR "AhrefsBot" OR<br />"AdsBot-Google" OR "Ezooms" OR "AddThis.com" OR "facebookexternalhit" OR<br />"MetaURI" OR "Feedfetcher-Google" OR "PaperLiBot" OR "TweetmemeBot" OR<br />"Sogou web spider" OR "GoogleProducer" OR "RockmeltEmbedder" OR<br />"ShareThisFetcher" OR "YandexBot" OR "rogerbot-crawler" OR "ShowyouBot" OR "Baiduspider" OR "Sosospider" OR "Exabot") webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| parse regex field=agent "(?\<bot\_name\>facebook)externalhit?\\W+" nodrop<br />\| parse regex field=agent "Feedfetcher-(?\<bot\_name\>Google?)\\S+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>PaperLiBot?)/.+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>TweetmemeBot?)/.+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>msn?)bot\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Nutch?)-.+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Google?)bot\\W" nodrop<br />\| parse regex field=agent "Feedfetcher-(?\<bot\_name\>Google?)\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Yahoo?)!\\s+Slurp[;/].+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>bing?)bot\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Bing?)Preview\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Sogou?)\\s+web\\s" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Yandex?)Bot\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>rogerbot?)\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>AddThis\\.com?)\\s+robot\\s+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>ShareThis?)Fetcher/.+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Ahrefs?)Bot/.+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>MetaURI?)\\s+API/.+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Showyou?)Bot\\s+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Google?)Producer;" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Ezooms?)\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Rockmelt?)Embedder\\s+" nodrop <br />\| parse regex field=agent "(?\<bot\_name\>Sosospider?)\\W" nodrop <br />\| parse regex field=agent "(?\<bot\_name\>Baidu?)spider" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Exabot?)\\W"<br />\| where bot\_name != ""<br />\| if (bot\_name="bing","Bing",bot\_name) as bot\_name<br />\| count as count by bot\_name<br />\| sort by count <br />//\| limit 10|
|Varnish - OpenTelemetry|Top 10 PC and Mac Versions|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight|sumo.datasource=varnish webengine.system=varnish ("macintosh" OR "mac os" OR "windows" OR "i686" or "PC" or ("Linux" AND !android)) webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| parse regex field=agent "(?\<os\>Mac OS) (?\<version\>[^;\\)]+?)(?:;\|\\))" nodrop <br />\| parse regex field=agent "(?\<os\>Windows)(?: NT \| )(?\<version\>[\\d.]+)" nodrop <br />\| parse regex field=agent "(?\<os\>Linux) (?\<version\>\\S+?)(?:\\)\|;)" nodrop <br />\| where os!=""<br />\| count as count by os,version<br />\| sort count <br />\| limit 10 |
|Varnish - OpenTelemetry|Top 10 Search Terms from Popular Search Engines|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight|sumo.datasource=varnish webengine.system=varnish  (google OR bing OR aol OR ask OR yahoo) ("p=" OR "q=" OR "wd=" OR "searchfor=") webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| parse regex field=referrer "(?:\\?\|&)(?:p\|q\|wd\|searchfor)=(?\<search\_term\>[^=]+?)(?:&\|\$)" nodrop <br />\| where search\_term!=""<br />\| urldecode(search\_term)<br />\| if(referrer matches "\*google.\*","Google","") as engine<br />\| if(referrer matches "\*bing.\*","Bing",engine) as engine<br />\| if(referrer matches "\*ask.com\*","Ask.com",engine) as engine<br />\| if(referrer matches "\*aol.\*","AOL",engine) as engine<br />\| if(referrer matches "\*yahoo.\*","Yahoo",engine) as engine<br />\| where engine !="" <br />\| count as count  by search\_term<br />\| sort count <br />\| limit 10|
|Varnish - OpenTelemetry|Top 10 URLs causing Errors|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Overview|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where status\_code matches "4\*" or status\_code matches "5\*"<br />\| count by uri,host.name<br />\| top 10 host.name,uri by \_count<br />\| \_count as count<br />\| fields -\_count|
|Varnish - OpenTelemetry|Top 5 Clients Causing 4xx Errors|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations|sumo.datasource=varnish webengine.system=varnish (400 OR 401 OR 402 OR 403 OR 404) webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where status\_code matches "4\*"<br />\| count as count by client\_ip<br />\| sort count <br />\| limit 5 <br />|
|Varnish - OpenTelemetry|Top 5 Clients Causing 5xx Errors|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations|sumo.datasource=varnish webengine.system=varnish (500 or 501 or 502 or 503 or 504 or 505 or 506 or 507 or 508 or 509) webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where status\_code matches "5\*"<br />\| count as count by client\_ip<br />\| sort count <br />\| limit 5 <br />|
|Varnish - OpenTelemetry|Top 5 Highly Malicious URLs|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Threat Intel|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| count as ip\_count by remote\_ip, uri<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=remote\_ip <br />\| where malicious\_confidence matches "high"<br />\| count as count by uri<br />\| limit 5|
|Varnish - OpenTelemetry|Top 5 Messages in the Error Logs|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "\\s\\[(?\<log\_level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<message\>[A-Za-z][^,]+)(?:,\|\$)" nodrop<br />\| where length(message) \>0<br />\| count as count by message<br />\| sort count <br />\| limit 5<br />|
|Varnish - OpenTelemetry|Top 5 Referrers|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where length(referrer)\>0<br />\| count by referrer<br />\| sort by \_count<br />\| limit 5 <br /><br />|
|Varnish - OpenTelemetry|Top 5 URIs causing 4xx Responses|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where status\_code matches "4\*"<br />\| count as count by uri<br />\| sort count, uri asc<br />\| limit 5 |
|Varnish - OpenTelemetry|Top 5 URIs Causing 5xx Responses|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations|sumo.datasource=varnish webengine.system=varnish  (500 or 501 or 502 or 503 or 504 or 505 or 506 or 507 or 508 or 509) webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where status\_code matches "5\*"<br />\| count as count by uri<br />\| sort count, uri asc<br />\| limit 5 |
|Varnish - OpenTelemetry|Top 5 URLs|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight|sumo.datasource=varnish webengine.system=varnish  webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"\\?]+?)(?:\\"\|\\?)s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| count as count by uri<br />\| sort by count<br />\| limit 5|
|Varnish - OpenTelemetry|Top Clients|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Web Server Operations|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| lookup country\_name from geo://location on ip = client\_ip<br />\| count as count by client\_ip, country\_name<br />\| sort count<br />\| limit 10<br />|
|Varnish - OpenTelemetry|Traffic Distribution by Server|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Overview|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| timeslice 5m<br />\| count by \_timeslice,host.name  <br />\| transpose row \_timeslice column host.name|
|Varnish - OpenTelemetry|Traffic Distribution by Server|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish  - Traffic Timeline Analysis|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| timeslice 1h<br />\| count by \_timeslice, host.name  <br />\| transpose row \_timeslice column host.name|
|Varnish - OpenTelemetry|Traffic Volume and GBytes Served|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish  - Traffic Timeline Analysis|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where size != "-"<br />\| timeslice 1h<br />\| (size/(1048576\*1000)) as gbytes <br />\| count as hits, sum(gbytes) as gbytes by \_timeslice <br />\| sort \_timeslice asc|
|Varnish - OpenTelemetry|Traffic Volume and MB Served Over Time|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Overview|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"\\?]+?)(?:\\"\|\\?)"<br />\| where size != "-"<br />\| timeslice 5m <br />\|  (size/(1024\*1024)) as Megabytes <br />\|  count as hits, sum(Megabytes) as Megabytes by \_timeslice <br />\| sort \_timeslice asc|
|Varnish - OpenTelemetry|Visitor Locations|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Overview|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\|  lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = client\_ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Varnish - OpenTelemetry|Visitor Locations - 4xx Errors|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Overview|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where !(client\_ip matches "127.0.0.1")<br />\| where status\_code matches "4\*" <br />\|  lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = client\_ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Varnish - OpenTelemetry|Visitor Locations - One Day Time Comparison|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish  - Traffic Timeline Analysis|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = client\_ip<br />\| where !isEmpty(country\_name)<br />\| count as Visitors\_Locations by country\_name<br />\| sort Visitors\_Locations <br />\| compare with timeshift 1d<br />\| limit 10|
|Varnish - OpenTelemetry|Visits by Country Over Time|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight|sumo.datasource=varnish webengine.system=varnish  webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\|  lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = client\_ip<br />\| where !isNull(country\_name) AND country\_name !=""<br />\| timeslice 5m<br />\| count by \_timeslice,country\_name<br />\| transpose row \_timeslice column country\_name as \* <br />|
|Varnish - OpenTelemetry|Vistor Platforms|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| if (agent matches "\*iPad\*" OR agent matches "\*iPhone\*" OR agent matches "\*Android\*" OR agent matches "\*BlackBerry\*" OR agent matches "\*Galaxy\*" OR agent matches "LGE-\*" OR agent matches "SCH-\*" OR agent matches "\*HUAWEI-\*" OR agent matches "\*SAMSUNG\*" OR agent matches "\*samsung\*" OR agent matches "Dalvik/\*" OR agent matches "Nokia\*" OR agent matches "LG-\*" OR agent matches "\*CFNetwork\*"  OR agent matches "\*UP.Browser/\*" OR agent matches "\*QQ\*rowser\*" OR agent matches "\*NetFront/\*" OR agent matches "\*Windows Phone\*" OR agent matches "\*Mobile Safari\*" OR agent matches "\*iemobile\*","Mobile","") as type<br />\| if (agent matches "\*Windows\*" OR agent matches "\*Win64\*" OR agent matches "\*Win32\*" OR agent matches "\*i686\*" OR agent matches "\*x86\*","PC",type) as type<br />\| if (agent matches "\*Macintosh\*" OR agent matches "\*Mac OS\*","Mac",type) as type<br />\| if (type = "","bots/unknown",type) as type<br />\| count type<br />|
|Varnish - OpenTelemetry|Worldwide|Logs|Installed Apps/Varnish - OpenTelemetry/Varnish - Visitor Traffic Insight|sumo.datasource=varnish webengine.system=varnish webengine.cluster.name={{webengine.cluster.name}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"\\?]+?)(?:\\"\|\\?)s+\\"(?\<agent\>[^\\"]+?)\\""<br />\|  lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = client\_ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|

