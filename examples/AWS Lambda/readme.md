# AWS Lambda
## Sumo Logic App For: AWS Lambda
The Sumo Logic AWS Lambda App uses the Lambda logs via CloudWatch, CloudWatch Metrics and the CloudTrail Lambda Data Events to visualize the operational and performance trends in all the Lambda functions in your account. The preconfigured dashboards provide insights into executions, memory and duration usage by function versions or aliases, errors, billed duration, function callers, IAM users, and threat details.
Docs Link: [AWS Lambda](https://help.sumologic.com/?cid=1991)

## Searches

### Log Searches

- **AWS Services Invoking Functions**: from Dashboard: AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New 
- **AWS Services Invoking Functions - Outlier**: from Dashboard: AWS Lambda/AWS Lambda - CloudTrail Events - Security - New 
- **AWS Services Invoking Functions Over Time**: from Dashboard: AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New 
- **Billed Duration vs Duration**: from Search: AWS Lambda/Billed Duration vs Duration 
- **Function Callers Details**: from Dashboard: AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New 
- **Function Name Invocation Over Time**: from Dashboard: AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New 
- **Function Version Invocation Over Time**: from Dashboard: AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New 
- **IAM User Invoking Functions**: from Dashboard: AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New 
- **IAM User Invoking Functions - Outlier**: from Dashboard: AWS Lambda/AWS Lambda - CloudTrail Events - Security - New 
- **IAM User Invoking Functions Over Time**: from Dashboard: AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New 
- **Invoke Breakdown by Function Name**: from Dashboard: AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New 
- **Invoke Breakdown by Function Version**: from Dashboard: AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New 
- **Lambda Error Messages**: from Search: AWS Lambda/Lambda Error Messages 
- **Location of Callers**: from Dashboard: AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New 
- **Threat Table based on Caller IP Address**: from Dashboard: AWS Lambda/AWS Lambda - CloudTrail Events - Security - New 
- **Time Compare - Yesterday Vs Today**: from Dashboard: AWS Lambda/AWS Lambda - CloudTrail Events - Security - New 
- **Time Compare - Yesterday Vs Today**: from Dashboard: AWS Lambda/AWS Lambda - CloudTrail Events - Security - New 
- **User Agent Breakdown**: from Dashboard: AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|AWS Lambda|AWS Services Invoking Functions|Logs|AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New|\_sourceCategory = Labs/AWS/CloudTrail\* "lambda.amazonaws.com" Invoke<br />\| json field=\_raw "eventName" as event\_name<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "requestParameters.functionName" as func\_name nodrop<br />\| json field=\_raw "additionalEventData.functionVersion" as func\_version nodrop<br />\| parse regex field=func\_name "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_name\>[\\S]+)\$"<br />\| parse regex field=func\_version "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_version\>[\\S]+:[\\S ]+)\$" \| json field=\_raw "userAgent" as user\_agent<br />\| json field=\_raw "userIdentity.type" as caller\_type<br />\| json field=\_raw "userIdentity.invokedBy"as invoked\_by nodrop<br />\| json field=\_raw "userIdentity.userName"as user\_name nodrop<br />\| if (isNull(user\_name), invoked\_by, user\_name ) as caller<br />\| if (isNull(invoked\_by), user\_name, invoked\_by ) as caller<br />\| where caller\_type = "AWSService"<br />\|where if ("{{function\_name}}" = "\*", true, function\_name matches "{{function\_name}}") AND if ("{{user\_name}}" = "\*", true, user\_name matches "{{user\_name}}") AND if ("{{caller}}" = "\*", true, caller matches "{{caller}}") AND if ("{{user\_agent}}" = "\*", true, user\_agent matches "{{user\_agent}}") AND if ("{{aws\_region}}" = "\*", true, aws\_region matches "{{aws\_region}}") AND if ("{{caller\_type}}" = "\*", true, caller\_type matches "{{caller\_type}}")<br />\|count by caller|
|AWS Lambda|AWS Services Invoking Functions - Outlier|Logs|AWS Lambda/AWS Lambda - CloudTrail Events - Security - New|\_sourceCategory = Labs/AWS/CloudTrail\* "lambda.amazonaws.com"  AWSService<br />\| json field=\_raw "eventName" as event\_name <br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "requestParameters.functionName" as func\_name nodrop<br />\| json field=\_raw "additionalEventData.functionVersion" as func\_version nodrop<br />\| parse regex field=func\_name "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_name\>[\\S]+)\$"<br />\| parse regex field=func\_version "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_version\>[\\S]+:[\\S ]+)\$" \| json field=\_raw "userAgent" as user\_agent<br />\| json field=\_raw "userIdentity.type" as caller\_type<br />\| json field=\_raw "userIdentity.invokedBy"as invoked\_by nodrop<br />\| json field=\_raw "userIdentity.userName"as user\_name nodrop<br />\| if (isNull(user\_name), invoked\_by, user\_name ) as caller<br />\| if (isNull(invoked\_by), user\_name, invoked\_by ) as caller<br />\| where caller\_type = "AWSService" <br />\| timeslice 1h<br />\|where if ("{{function\_name}}" = "\*", true, function\_name matches "{{function\_name}}") AND if ("{{function\_version}}" = "\*", true, function\_version matches "{{function\_version}}") AND if ("{{caller}}" = "\*", true, caller matches "{{caller}}") AND if ("{{caller\_type}}" = "\*", true, caller\_type matches "{{caller\_type}}")<br />\|count by caller, \_timeslice<br />\| outlier \_count by caller<br />\| fields \_timeslice,caller, \_count\_violation<br />\| transpose row \_timeslice column caller|
|AWS Lambda|AWS Services Invoking Functions Over Time|Logs|AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New|\_sourceCategory = Labs/AWS/CloudTrail\* "lambda.amazonaws.com" Invoke<br />\| json field=\_raw "eventName" as event\_name<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "requestParameters.functionName" as func\_name nodrop<br />\| json field=\_raw "additionalEventData.functionVersion" as func\_version nodrop<br />\| parse regex field=func\_name "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_name\>[\\S]+)\$"<br />\| parse regex field=func\_version "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_version\>[\\S]+:[\\S ]+)\$" \| json field=\_raw "userAgent" as user\_agent<br />\| json field=\_raw "userIdentity.type" as caller\_type<br />\| json field=\_raw "userIdentity.invokedBy"as invoked\_by nodrop<br />\| json field=\_raw "userIdentity.userName"as user\_name nodrop<br />\| if (isNull(user\_name), invoked\_by, user\_name ) as caller<br />\| if (isNull(invoked\_by), user\_name, invoked\_by ) as caller<br />\| where caller\_type = "AWSService" <br />\| timeslice 1h<br />\|where if ("{{function\_name}}" = "\*", true, function\_name matches "{{function\_name}}") AND if ("{{user\_name}}" = "\*", true, user\_name matches "{{user\_name}}") AND if ("{{caller}}" = "\*", true, caller matches "{{caller}}") AND if ("{{user\_agent}}" = "\*", true, user\_agent matches "{{user\_agent}}") AND if ("{{aws\_region}}" = "\*", true, aws\_region matches "{{aws\_region}}") AND if ("{{caller\_type}}" = "\*", true, caller\_type matches "{{caller\_type}}")<br />\|count by caller, \_timeslice<br />\| transpose row \_timeslice column caller <br />\| fillmissing timeslice (1h)|
|AWS Lambda|Billed Duration vs Duration|Logs|AWS Lambda/Billed Duration vs Duration|\_sourceCategory = Labs/AWS/Lambda\*<br />\| json "message"<br />\| \_sourceName as logStream<br />\| \_sourceHost as logGroup<br />\| parse regex field=message "REPORT\\s+RequestId:\\s+(?\<RequestId\>[^\\s]+)\\s+Duration:\\s+(?\<Duration\>[^\\s]+)\\s+ms\\s+Billed Duration:\\s+(?\<BilledDuration\>[^\\s]+)\\s+ms\\s+Memory\\s+Size:\\s+(?\<MemorySize\>[^\\s]+)\\s+MB\\s+Max\\s+Memory\\s+Used:\\s+(?\<MaxMemoryUsed\>[^\\s]+)\\s+MB" <br />\| parse field=logstream "\*/[\*]\*" as logstreamDate,version,logstreamID<br />\| parse field=loggroup "/aws/lambda/\*" as function<br />\| timeslice 1h<br />\| sum(Duration) as Duration, sum(BilledDuration) as BilledDuration by \_timeslice|
|AWS Lambda|Function Callers Details|Logs|AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New|\_sourceCategory = Labs/AWS/CloudTrail\* "lambda.amazonaws.com" Invoke<br />\| json field=\_raw "eventName" as event\_name<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "requestParameters.functionName" as func\_name nodrop<br />\| json field=\_raw "additionalEventData.functionVersion" as func\_version nodrop<br />\| parse regex field=func\_name "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_name\>[\\S]+)\$"<br />\| parse regex field=func\_version "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_version\>[\\S]+:[\\S ]+)\$" <br />\| json field=\_raw "userAgent" as user\_agent<br />\| json field=\_raw "userIdentity.type" as caller\_type<br />\| json field=\_raw "awsRegion" as aws\_region<br />\| json field=\_raw "userIdentity.invokedBy"as invoked\_by nodrop<br />\| json field=\_raw "userIdentity.userName"as user\_name nodrop<br />\| if (isNull(user\_name), invoked\_by, user\_name ) as caller<br />\| if (isNull(invoked\_by), user\_name, invoked\_by ) as caller<br />\|where if ("{{function\_name}}" = "\*", true, function\_name matches "{{function\_name}}") AND if ("{{user\_name}}" = "\*", true, user\_name matches "{{user\_name}}") AND if ("{{caller}}" = "\*", true, caller matches "{{caller}}") AND if ("{{user\_agent}}" = "\*", true, user\_agent matches "{{user\_agent}}") AND if ("{{aws\_region}}" = "\*", true, aws\_region matches "{{aws\_region}}") AND if ("{{caller\_type}}" = "\*", true, caller\_type matches "{{caller\_type}}")<br />\|count by function\_name, function\_version, caller, caller\_type, src\_ip, aws\_region<br />\| sort by \_count|
|AWS Lambda|Function Name Invocation Over Time|Logs|AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New|\_sourceCategory = Labs/AWS/CloudTrail\* "lambda.amazonaws.com" Invoke<br />\| json field=\_raw "eventName" as event\_name<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "requestParameters.functionName" as func\_name nodrop<br />\| json field=\_raw "additionalEventData.functionVersion" as func\_version nodrop<br />\| parse regex field=func\_name "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_name\>[\\S]+)\$"<br />\| parse regex field=func\_version "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_version\>[\\S]+:[\\S ]+)\$" <br />\| json field=\_raw "userAgent" as user\_agent<br />\| json field=\_raw "userIdentity.type" as caller\_type<br />\| json field=\_raw "userIdentity.invokedBy"as invoked\_by nodrop<br />\| json field=\_raw "userIdentity.userName"as user\_name nodrop<br />\| if (isNull(user\_name), invoked\_by, user\_name ) as caller<br />\| if (isNull(invoked\_by), user\_name, invoked\_by ) as caller<br />\| timeslice 1h<br />\|where if ("{{function\_name}}" = "\*", true, function\_name matches "{{function\_name}}") AND if ("{{user\_name}}" = "\*", true, user\_name matches "{{user\_name}}") AND if ("{{caller}}" = "\*", true, caller matches "{{caller}}") AND if ("{{user\_agent}}" = "\*", true, user\_agent matches "{{user\_agent}}") AND if ("{{aws\_region}}" = "\*", true, aws\_region matches "{{aws\_region}}") AND if ("{{caller\_type}}" = "\*", true, caller\_type matches "{{caller\_type}}")<br />\|count by function\_name, \_timeslice<br />\| transpose row \_timeslice column function\_name <br />\| fillmissing timeslice (1h)|
|AWS Lambda|Function Version Invocation Over Time|Logs|AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New|\_sourceCategory = Labs/AWS/CloudTrail\* "lambda.amazonaws.com" Invoke<br />\| json field=\_raw "eventName" as event\_name<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "requestParameters.functionName" as func\_name nodrop<br />\| json field=\_raw "additionalEventData.functionVersion" as func\_version nodrop<br />\| parse regex field=func\_name "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_name\>[\\S]+)\$"<br />\| parse regex field=func\_version "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_version\>[\\S]+:[\\S ]+)\$" <br />\| json field=\_raw "userAgent" as user\_agent<br />\| json field=\_raw "userIdentity.type" as caller\_type<br />\| json field=\_raw "userIdentity.invokedBy"as invoked\_by nodrop<br />\| json field=\_raw "userIdentity.userName"as user\_name nodrop<br />\| if (isNull(user\_name), invoked\_by, user\_name ) as caller<br />\| if (isNull(invoked\_by), user\_name, invoked\_by ) as caller<br />\| timeslice 1h<br />\|where if ("{{function\_name}}" = "\*", true, function\_name matches "{{function\_name}}") AND if ("{{user\_name}}" = "\*", true, user\_name matches "{{user\_name}}") AND if ("{{caller}}" = "\*", true, caller matches "{{caller}}") AND if ("{{user\_agent}}" = "\*", true, user\_agent matches "{{user\_agent}}") AND if ("{{aws\_region}}" = "\*", true, aws\_region matches "{{aws\_region}}") AND if ("{{caller\_type}}" = "\*", true, caller\_type matches "{{caller\_type}}")<br />\|count by function\_version, \_timeslice<br />\| transpose row \_timeslice column function\_version <br />\| fillmissing timeslice (1h)|
|AWS Lambda|IAM User Invoking Functions|Logs|AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New|\_sourceCategory = Labs/AWS/CloudTrail\* "lambda.amazonaws.com" Invoke<br />\| json field=\_raw "eventName" as event\_name<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "requestParameters.functionName" as func\_name nodrop<br />\| json field=\_raw "additionalEventData.functionVersion" as func\_version nodrop<br />\| parse regex field=func\_name "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_name\>[\\S]+)\$"<br />\| parse regex field=func\_version "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_version\>[\\S]+:[\\S ]+)\$" \| json field=\_raw "userAgent" as user\_agent<br />\| json field=\_raw "userIdentity.type" as caller\_type<br />\| json field=\_raw "userIdentity.invokedBy"as invoked\_by nodrop<br />\| json field=\_raw "userIdentity.userName"as user\_name nodrop<br />\| if (isNull(user\_name), invoked\_by, user\_name ) as caller<br />\| if (isNull(invoked\_by), user\_name, invoked\_by ) as caller<br />\| where caller\_type = "IAMUser"<br />\|where if ("{{function\_name}}" = "\*", true, function\_name matches "{{function\_name}}") AND if ("{{user\_name}}" = "\*", true, user\_name matches "{{user\_name}}") AND if ("{{caller}}" = "\*", true, caller matches "{{caller}}") AND if ("{{user\_agent}}" = "\*", true, user\_agent matches "{{user\_agent}}") AND if ("{{aws\_region}}" = "\*", true, aws\_region matches "{{aws\_region}}") AND if ("{{caller\_type}}" = "\*", true, caller\_type matches "{{caller\_type}}")<br />\|count by caller<br />\| sort by \_count|
|AWS Lambda|IAM User Invoking Functions - Outlier|Logs|AWS Lambda/AWS Lambda - CloudTrail Events - Security - New|\_sourceCategory = Labs/AWS/CloudTrail\* "lambda.amazonaws.com" Invoke IAMUser<br />\| json field=\_raw "eventName" as event\_name<br />\| json field=\_raw "sourceIPAddress" as  IAMUser<br />\| json field=\_raw "requestParameters.functionName" as func\_name nodrop<br />\| json field=\_raw "additionalEventData.functionVersion" as func\_version nodrop<br />\| parse regex field=func\_name "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_name\>[\\S]+)\$"<br />\| parse regex field=func\_version "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_version\>[\\S]+:[\\S ]+)\$" \| json field=\_raw "userAgent" as user\_agent<br />\| json field=\_raw "userIdentity.type" as caller\_type<br />\| json field=\_raw "userIdentity.invokedBy"as invoked\_by nodrop<br />\| json field=\_raw "userIdentity.userName"as user\_name nodrop<br />\| if (isNull(user\_name), invoked\_by, user\_name ) as caller<br />\| if (isNull(invoked\_by), user\_name, invoked\_by ) as caller<br />\| where caller\_type = "IAMUser" <br />\| timeslice 1h<br />\|where if ("{{function\_name}}" = "\*", true, function\_name matches "{{function\_name}}") AND if ("{{function\_version}}" = "\*", true, function\_version matches "{{function\_version}}") AND if ("{{caller}}" = "\*", true, caller matches "{{caller}}") AND if ("{{caller\_type}}" = "\*", true, caller\_type matches "{{caller\_type}}")<br />\|count by caller, \_timeslice<br />\| outlier \_count by caller<br />\| fields \_timeslice,caller, \_count\_violation<br />\| transpose row \_timeslice column caller|
|AWS Lambda|IAM User Invoking Functions Over Time|Logs|AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New|\_sourceCategory = Labs/AWS/CloudTrail\* "lambda.amazonaws.com" Invoke IAMUser<br />\| json field=\_raw "eventName" as event\_name<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "requestParameters.functionName" as func\_name nodrop<br />\| json field=\_raw "additionalEventData.functionVersion" as func\_version nodrop<br />\| parse regex field=func\_name "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_name\>[\\S]+)\$"<br />\| parse regex field=func\_version "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_version\>[\\S]+:[\\S ]+)\$" \| json field=\_raw "userAgent" as user\_agent<br />\| json field=\_raw "userIdentity.type" as caller\_type<br />\| json field=\_raw "userIdentity.invokedBy"as invoked\_by nodrop<br />\| json field=\_raw "userIdentity.userName"as user\_name nodrop<br />\| if (isNull(user\_name), invoked\_by, user\_name ) as caller<br />\| if (isNull(invoked\_by), user\_name, invoked\_by ) as caller<br />\| where caller\_type = "IAMUser" <br />\| timeslice 1h<br />\|where if ("{{function\_name}}" = "\*", true, function\_name matches "{{function\_name}}") AND if ("{{user\_name}}" = "\*", true, user\_name matches "{{user\_name}}") AND if ("{{caller}}" = "\*", true, caller matches "{{caller}}") AND if ("{{user\_agent}}" = "\*", true, user\_agent matches "{{user\_agent}}") AND if ("{{aws\_region}}" = "\*", true, aws\_region matches "{{aws\_region}}") AND if ("{{caller\_type}}" = "\*", true, caller\_type matches "{{caller\_type}}")<br />\|count by caller, \_timeslice<br />\| transpose row \_timeslice column caller <br />\| fillmissing timeslice (1h)|
|AWS Lambda|Invoke Breakdown by Function Name|Logs|AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New|\_sourceCategory = Labs/AWS/CloudTrail\* "lambda.amazonaws.com" <br />\| json field=\_raw "eventName" as event\_name<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "requestParameters.functionName" as func\_name nodrop<br />\| json field=\_raw "additionalEventData.functionVersion" as func\_version nodrop<br />\| parse regex field=func\_name "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_name\>[\\S]+)\$"<br />\| parse regex field=func\_version "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_version\>[\\S]+:[\\S ]+)\$" <br />\| json field=\_raw "userAgent" as user\_agent<br />\| json field=\_raw "userIdentity.type" as caller\_type<br />\| json field=\_raw "userIdentity.invokedBy"as invoked\_by nodrop<br />\| json field=\_raw "userIdentity.userName"as user\_name nodrop<br />\| if (isNull(user\_name), invoked\_by, user\_name ) as caller<br />\| if (isNull(invoked\_by), user\_name, invoked\_by ) as caller<br />\|where if ("{{function\_name}}" = "\*", true, function\_name matches "{{function\_name}}") AND if ("{{user\_name}}" = "\*", true, user\_name matches "{{user\_name}}") AND if ("{{caller}}" = "\*", true, caller matches "{{caller}}") AND if ("{{user\_agent}}" = "\*", true, user\_agent matches "{{user\_agent}}") AND if ("{{aws\_region}}" = "\*", true, aws\_region matches "{{aws\_region}}") AND if ("{{caller\_type}}" = "\*", true, caller\_type matches "{{caller\_type}}")<br />\|count by function\_name<br />\| sort by \_count|
|AWS Lambda|Invoke Breakdown by Function Version|Logs|AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New|\_sourceCategory = Labs/AWS/CloudTrail\* "lambda.amazonaws.com" <br />\| json field=\_raw "eventName" as event\_name<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "requestParameters.functionName" as func\_name nodrop<br />\| json field=\_raw "additionalEventData.functionVersion" as func\_version nodrop<br />\| parse regex field=func\_name "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_name\>[\\S]+)\$"<br />\| parse regex field=func\_version "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_version\>[\\S]+:[\\S ]+)\$" <br />\| json field=\_raw "userAgent" as user\_agent<br />\| json field=\_raw "userIdentity.type" as caller\_type<br />\| json field=\_raw "userIdentity.invokedBy"as invoked\_by nodrop<br />\| json field=\_raw "userIdentity.userName"as user\_name nodrop<br />\| if (isNull(user\_name), invoked\_by, user\_name ) as caller<br />\| if (isNull(invoked\_by), user\_name, invoked\_by ) as caller<br />\|where if ("{{function\_name}}" = "\*", true, function\_name matches "{{function\_name}}") AND if ("{{user\_name}}" = "\*", true, user\_name matches "{{user\_name}}") AND if ("{{caller}}" = "\*", true, caller matches "{{caller}}") AND if ("{{user\_agent}}" = "\*", true, user\_agent matches "{{user\_agent}}") AND if ("{{aws\_region}}" = "\*", true, aws\_region matches "{{aws\_region}}") AND if ("{{caller\_type}}" = "\*", true, caller\_type matches "{{caller\_type}}")<br />\|count by function\_version<br />\| sort by \_count|
|AWS Lambda|Lambda Error Messages|Logs|AWS Lambda/Lambda Error Messages|\_sourceCategory = Labs/AWS/Lambda\* errorMessage<br />\| json "message"<br />\| \_sourceName as logStream<br />\| \_sourceHost as logGroup<br />\| parse field=logstream "\*/[\*]\*" as logstreamDate,version,logstreamID<br />\| parse field=loggroup "/aws/lambda/\*" as function<br />\| parse field=message "\*\\t\*\\t\*" as time,RequestId,errorObj |
|AWS Lambda|Location of Callers|Logs|AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New|\_sourceCategory = Labs/AWS/CloudTrail\* "lambda.amazonaws.com" Invoke<br />\| json field=\_raw "eventName" as event\_name<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "requestParameters.functionName" as func\_name nodrop<br />\| json field=\_raw "additionalEventData.functionVersion" as func\_version nodrop<br />\| parse regex field=func\_name "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_name\>[\\S]+)\$"<br />\| parse regex field=func\_version "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_version\>[\\S]+:[\\S ]+)\$" \| json field=\_raw "userAgent" as user\_agent<br />\| json field=\_raw "userIdentity.type" as caller\_type<br />\| json field=\_raw "userIdentity.invokedBy"as invoked\_by nodrop<br />\| json field=\_raw "userIdentity.userName"as user\_name nodrop<br />\| if (isNull(user\_name), invoked\_by, user\_name ) as caller<br />\| if (isNull(invoked\_by), user\_name, invoked\_by ) as caller<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = src\_ip<br />\|where if ("{{function\_name}}" = "\*", true, function\_name matches "{{function\_name}}") AND if ("{{user\_name}}" = "\*", true, user\_name matches "{{user\_name}}") AND if ("{{caller}}" = "\*", true, caller matches "{{caller}}") AND if ("{{user\_agent}}" = "\*", true, user\_agent matches "{{user\_agent}}") AND if ("{{aws\_region}}" = "\*", true, aws\_region matches "{{aws\_region}}") AND if ("{{caller\_type}}" = "\*", true, caller\_type matches "{{caller\_type}}")<br />\|count by latitude, longitude, country\_code, country\_name, region, city, postal\_code, event\_name<br />\| sort \_count|
|AWS Lambda|Threat Table based on Caller IP Address|Logs|AWS Lambda/AWS Lambda - CloudTrail Events - Security - New|\_sourceCategory = Labs/AWS/CloudTrail\*  "lambda.amazonaws.com" Invoke<br />\| json field=\_raw "eventName" as event\_name<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "requestParameters.functionName" as func\_name nodrop<br />\| json field=\_raw "additionalEventData.functionVersion" as func\_version nodrop<br />\| parse regex field=func\_name "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_name\>[\\S]+)\$"<br />\| parse regex field=func\_version "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_version\>[\\S]+:[\\S ]+)\$" \| json field=\_raw "userAgent" as user\_agent\| json field=\_raw "userAgent" as user\_agent<br />\| json field=\_raw "userIdentity.type" as caller\_type<br />\| json field=\_raw "userIdentity.invokedBy"as invoked\_by nodrop<br />\| json field=\_raw "userIdentity.userName"as user\_name nodrop<br />\| if (isNull(user\_name), invoked\_by, user\_name ) as caller<br />\| if (isNull(invoked\_by), user\_name, invoked\_by ) as caller<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=src\_ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and malicious\_confidence = "high"<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|where if ("{{function\_name}}" = "\*", true, function\_name matches "{{function\_name}}") AND if ("{{function\_version}}" = "\*", true, function\_version matches "{{function\_version}}") AND if ("{{caller}}" = "\*", true, caller matches "{{caller}}") AND if ("{{caller\_type}}" = "\*", true, caller\_type matches "{{caller\_type}}")<br />\|count by  src\_ip, malicious\_confidence, Actor,  function\_name, caller, user\_agent, label\_name<br />\| sort by \_count|
|AWS Lambda|Time Compare - Yesterday Vs Today|Logs|AWS Lambda/AWS Lambda - CloudTrail Events - Security - New|\_sourceCategory = Labs/AWS/CloudTrail\* "lambda.amazonaws.com" Invoke IAMUser<br />\| json field=\_raw "eventName" as event\_name<br />\| json field=\_raw "sourceIPAddress" as  IAMUser<br />\| json field=\_raw "requestParameters.functionName" as func\_name nodrop<br />\| json field=\_raw "additionalEventData.functionVersion" as func\_version nodrop<br />\| parse regex field=func\_name "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_name\>[\\S]+)\$"<br />\| parse regex field=func\_version "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_version\>[\\S]+:[\\S ]+)\$" \| json field=\_raw "userAgent" as user\_agent<br />\| json field=\_raw "userIdentity.type" as caller\_type<br />\| json field=\_raw "userIdentity.invokedBy"as invoked\_by nodrop<br />\| json field=\_raw "userIdentity.userName"as user\_name nodrop<br />\| if (isNull(user\_name), invoked\_by, user\_name ) as caller<br />\| if (isNull(invoked\_by), user\_name, invoked\_by ) as caller<br />\| where caller\_type = "IAMUser"<br />\|where if ("{{function\_name}}" = "\*", true, function\_name matches "{{function\_name}}") AND if ("{{function\_version}}" = "\*", true, function\_version matches "{{function\_version}}") AND if ("{{caller}}" = "\*", true, caller matches "{{caller}}") AND if ("{{caller\_type}}" = "\*", true, caller\_type matches "{{caller\_type}}")<br />\|count by caller<br />\| compare with timeshift 1d as vs\_yesterday<br />\| sort by \_count|
|AWS Lambda|Time Compare - Yesterday Vs Today|Logs|AWS Lambda/AWS Lambda - CloudTrail Events - Security - New|\_sourceCategory = Labs/AWS/CloudTrail\* "lambda.amazonaws.com"  AWSService<br />\| json field=\_raw "eventName" as event\_name <br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "requestParameters.functionName" as func\_name nodrop<br />\| json field=\_raw "additionalEventData.functionVersion" as func\_version nodrop<br />\| parse regex field=func\_name "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_name\>[\\S]+)\$"<br />\| parse regex field=func\_version "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_version\>[\\S]+:[\\S ]+)\$" \| json field=\_raw "userAgent" as user\_agent<br />\| json field=\_raw "userIdentity.type" as caller\_type<br />\| json field=\_raw "userIdentity.invokedBy"as invoked\_by nodrop<br />\| json field=\_raw "userIdentity.userName"as user\_name nodrop<br />\| if (isNull(user\_name), invoked\_by, user\_name ) as caller<br />\| if (isNull(invoked\_by), user\_name, invoked\_by ) as caller<br />\| where caller\_type = "AWSService"<br />\|where if ("{{function\_name}}" = "\*", true, function\_name matches "{{function\_name}}") AND if ("{{function\_version}}" = "\*", true, function\_version matches "{{function\_version}}") AND if ("{{caller}}" = "\*", true, caller matches "{{caller}}") AND if ("{{caller\_type}}" = "\*", true, caller\_type matches "{{caller\_type}}")<br />\|count by caller<br />\| compare with timeshift 1d as vs\_yesterday<br />\| sort by \_count|
|AWS Lambda|User Agent Breakdown|Logs|AWS Lambda/AWS Lambda - CloudTrail Events - Overview - New|\_sourceCategory = Labs/AWS/CloudTrail\*  "lambda.amazonaws.com" Invoke<br />\| json field=\_raw "eventName" as event\_name<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "requestParameters.functionName" as func\_name nodrop<br />\| json field=\_raw "additionalEventData.functionVersion" as func\_version nodrop<br />\| parse regex field=func\_name "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_name\>[\\S]+)\$"<br />\| parse regex field=func\_version "\\w+:\\w+:\\S+:[\\w-]+:\\S+:\\S+:(?\<function\_version\>[\\S]+:[\\S ]+)\$" \| json field=\_raw "userAgent" as user\_agent<br />\| json field=\_raw "userIdentity.type" as caller\_type<br />\| json field=\_raw "userIdentity.invokedBy"as invoked\_by nodrop<br />\| json field=\_raw "userIdentity.userName"as user\_name nodrop<br />\| if (isNull(user\_name), invoked\_by, user\_name ) as caller<br />\| if (isNull(invoked\_by), user\_name, invoked\_by ) as caller<br />\|where if ("{{function\_name}}" = "\*", true, function\_name matches "{{function\_name}}") AND if ("{{user\_name}}" = "\*", true, user\_name matches "{{user\_name}}") AND if ("{{caller}}" = "\*", true, caller matches "{{caller}}") AND if ("{{user\_agent}}" = "\*", true, user\_agent matches "{{user\_agent}}") AND if ("{{aws\_region}}" = "\*", true, aws\_region matches "{{aws\_region}}") AND if ("{{caller\_type}}" = "\*", true, caller\_type matches "{{caller\_type}}")<br />\|count by user\_agent|

