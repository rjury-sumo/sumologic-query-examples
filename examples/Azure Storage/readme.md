# Azure Storage

## Searches

### Log Searches

- **Alerts over time**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Health 
- **Changes**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Audit control plane operations 
- **Changes - Read, Write and Delete**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Audit control plane operations 
- **Container Name by Failed Operations**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Blob Service 
- **Distribution by identity type**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Access 
- **Distribution by user agent**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Access 
- **Failed request count by status text**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Failures 
- **Failed Transaction by Category**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Failures 
- **Failed Transactions**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Failures 
- **File Share by Failed Operations**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - File Service 
- **Non 200 status code by Service Type**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Operations 
- **Non-zero status code by storage account**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Failures 
- **Operations that caused server-side throttling errors**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Audit control plane operations 
- **Operations used**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Audit control plane operations 
- **Queue Name by Failed Operations**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Queue Service 
- **Read**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Queue Service 
- **Read**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Blob Service 
- **Read**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - File Service 
- **Read**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Table Service 
- **Read vs Write**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - File Service 
- **Read vs Write**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Queue Service 
- **Read vs Write**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Blob Service 
- **Read vs Write**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Table Service 
- **Reads by Container Name**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Blob Service 
- **Reads by File Share**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - File Service 
- **Reads by Queue Name**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Queue Service 
- **Reads by Table Name**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Table Service 
- **Recent alerts**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Health 
- **Recent failed policy events**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Security and policy 
- **Recent failed request**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Failures 
- **Recent recommendation events**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Security and policy 
- **Recent Resource health incidents**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Health 
- **Recent security events**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Security and policy 
- **Recent Service Health incidents**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Health 
- **Recent success policy events**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Security and policy 
- **Resource health by event type**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Health 
- **Service Health by event type**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Health 
- **service health by event type-Time chart**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Health 
- **Storage Account Read Statistics**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Operations 
- **Storage Account Write Statistics**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Operations 
- **Table Name by Failed Operations**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Table Service 
- **Top 10 high latency transactions**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Performance 
- **Top 10 most common errors**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Audit control plane operations 
- **Top 10 operations that caused the most errors**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Audit control plane operations 
- **Top 10 Resources  by Failures**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Table Service 
- **Top 10 Resources  by Server Latency**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Table Service 
- **Top 10 Resources by Failures**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - File Service 
- **Top 10 Resources by Failures**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Queue Service 
- **Top 10 Resources by Failures**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Blob Service 
- **Top 10 Resources by Latency**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Blob Service 
- **Top 10 Resources by Reads(MB)**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - File Service 
- **Top 10 Resources by Reads(MB)**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Queue Service 
- **Top 10 Resources by Reads(MB)**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Table Service 
- **Top 10 Resources by Reads(MB)**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Blob Service 
- **Top 10 Resources by Server Latency**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Queue Service 
- **Top 10 Resources by Server Latency**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - File Service 
- **Top 10 Resources by Writes(MB)**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Queue Service 
- **Top 10 Resources by Writes(MB)**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Blob Service 
- **Top 10 Resources by Writes(MB)**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - File Service 
- **Top 10 Resources by Writes(MB)**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Table Service 
- **Total alerts**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Health 
- **Total denied policy events**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Security and policy 
- **Total read**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Operations 
- **Total recommendation events**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Security and policy 
- **Total security events**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Security and policy 
- **Total write**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Operations 
- **Transactions by location**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Access 
- **Transactions by TLS version**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Access 
- **Write**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - File Service 
- **Write**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Table Service 
- **Write**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Blob Service 
- **Write**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Queue Service 
- **Writes by Container Name**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Blob Service 
- **Writes by File Share**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - File Service 
- **Writes by Queue Name**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Queue Service 
- **Writes by Table Name**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Table Service

### Metric Searches

- **API with < 100 availability**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Availability 
- **Availability by storage account**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Overview 
- **Availability(%)**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Availability 
- **Availability(%)  by Storage Account**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Availability 
- **Availability(%) by API name**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Availability 
- **Availability(%) by storage type**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Availability 
- **Average  Success E2E Latency**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Performance 
- **Average  Success Server Latency**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Performance 
- **Average Latency(ms) of successful calls by API name**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Performance 
- **Errors by storage account**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Overview 
- **Failed transactions by API name**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Failures 
- **Failed transactions by authentication**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Failures 
- **Failed transactions by authentication**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Failures 
- **Failed transactions by response type**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Failures 
- **Failed transactions by response type**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Failures 
- **Failed transactions by service type**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Failures 
- **Max Success E2E Latency**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Overview 
- **Max Success Server Latency**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Overview 
- **Requests with anonymous access**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Audit control plane operations 
- **Success E2E Latency vs. Success Server Latency (ms)**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Performance 
- **Success E2E Latency vs. Success Server Latency (ms) by Service Type**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Performance 
- **SuccessE2ELatency(ms)**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Performance 
- **SuccessServerLatency(ms)**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Performance 
- **Top 10 Success Server Latency by API name**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Performance 
- **Top Success E2E Latency by API name**: from Dashboard: Installed Apps/Azure Storage/Azure Storage -  Performance 
- **Total Egress by  Service Type**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Operations 
- **Total Egress by API name**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Operations 
- **Total Egress by storage account**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Overview 
- **Total Ingress by  Service Type**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Operations 
- **Total Ingress by API name**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Operations 
- **Total Ingress by storage account**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Overview 
- **Transactions by Service Type**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Operations 
- **Transactions by Storage Account**: from Dashboard: Installed Apps/Azure Storage/Azure Storage - Overview

## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Azure Storage|Alerts over time|Logs|Installed Apps/Azure Storage/Azure Storage - Health|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}}<br />\| json "category"<br />\| where category="Alert"<br />\| timeslice 1h<br />\| count as Count by \_timeslice<br />|
|Azure Storage|API with \< 100 availability|Metrics|Installed Apps/Azure Storage/Azure Storage -  Availability|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} accountresourceid=\* metric=Availability statistic=minimum  \|  avg by resource\_name, apiname \| filter avg \< 100|
|Azure Storage|Availability by storage account|Metrics|Installed Apps/Azure Storage/Azure Storage - Overview|tenant\_name=\* subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} accountresourceid=\* metric=Availability statistic=minimum \| quantize using min <br />\| min by resource\_name |
|Azure Storage|Availability(%)|Metrics|Installed Apps/Azure Storage/Azure Storage -  Availability|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} accountresourceid=\* metric=Availability statistic=average <br />\| avg<br />|
|Azure Storage|Availability(%)  by Storage Account|Metrics|Installed Apps/Azure Storage/Azure Storage -  Availability|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} accountresourceid=\* metric=Availability statistic=average  <br />\| avg by resource\_name<br />|
|Azure Storage|Availability(%) by API name|Metrics|Installed Apps/Azure Storage/Azure Storage -  Availability|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} accountresourceid=\* metric=Availability statistic=average  <br />\| avg by apiname|
|Azure Storage|Availability(%) by storage type|Metrics|Installed Apps/Azure Storage/Azure Storage -  Availability|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} !(accountresourceid=\*) metric=Availability statistic=average  <br />\| avg by service\_type|
|Azure Storage|Average  Success E2E Latency|Metrics|Installed Apps/Azure Storage/Azure Storage -  Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} !(accountresourceid=\*) service\_type=\* metric=SuccessE2ELatency \| avg by service\_type |
|Azure Storage|Average  Success Server Latency|Metrics|Installed Apps/Azure Storage/Azure Storage -  Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} !(accountresourceid=\*) metric=SuccessServerLatency service\_type=\*<br />\| avg by service\_type<br />|
|Azure Storage|Average Latency(ms) of successful calls by API name|Metrics|Installed Apps/Azure Storage/Azure Storage -  Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} accountresourceid=\* metric=SuccessE2ELatency <br />\| avg by apiname, metric |
|Azure Storage|Changes|Logs|Installed Apps/Azure Storage/Azure Storage -  Audit control plane operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name={{resource\_name}}<br />provider\_name={{provider\_name}} resource\_type={{resource\_type}} \*STORAGE\*<br />\| JSON "properties.statusCode", "properties.message", "resultType", "category", "operationName", "callerIpAddress", "resultSignature", "level", "identity.claims.idtyp", "identity.claims.name", "identity.claims.appid" as statusCode, message, resultType, category, operationName, callerIpAddress, resultSignature, level, idtyp, name, appid nodrop<br />\| where resultType="Accept" and category="Administrative" and resourceid matches /STORAGE/ and toUppercase(operationName) matches /STORAGE/<br />\| if (idtyp =="user", name, appid) as name<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as time<br />\| count as Count by time, category, callerIpAddress, name, resultSignature, level, statusCode, message, location<br />\| order by Count|
|Azure Storage|Changes - Read, Write and Delete|Logs|Installed Apps/Azure Storage/Azure Storage -  Audit control plane operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name={{resource\_name}}<br />provider\_name={{provider\_name}} resource\_type={{resource\_type}} \*STORAGE\*<br />\| json "resultType", "category", "operationName" as resultType, category, operationName<br />\| where (resultType="Accept" or resultType="Success") and category="Administrative" and resourceid matches /STORAGE/ and toUppercase(operationName) matches /STORAGE/ and (toUppercase(operationName) matches /READ/ or toUppercase(operationName) matches /WRITE/ or toUppercase(operationName) matches /DELETE/)<br />\| count by operationName<br />\| sort by \_count|
|Azure Storage|Container Name by Failed Operations|Logs|Installed Apps/Azure Storage/Azure Storage - Blob Service|tenant\_name={{tenant\_name}} location={{location}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "operationName", "statusText" as uri, category, operationName, statusText<br />\| where service\_type="BLOBSERVICES" and statusText != "Success"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<container\_name\>[\$a-zA-Z0-9-]+)(?\<blob\_file\_path\>[^?]+\|\$)?" nodrop<br />\| where container\_name matches "{{container\_name}}"<br />\| count as num\_failures by  operationName, container\_name<br />\| transpose row container\_name column operationName|
|Azure Storage|Distribution by identity type|Logs|Installed Apps/Azure Storage/Azure Storage - Access|tenant\_name={{tenant\_name}} location={{location}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| json "identity.type" as type<br />\| count by type|
|Azure Storage|Distribution by user agent|Logs|Installed Apps/Azure Storage/Azure Storage - Access|tenant\_name={{tenant\_name}} location={{location}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| json "properties.userAgentHeader" as userAgentHeader<br />\| count by userAgentHeader|
|Azure Storage|Errors by storage account|Metrics|Installed Apps/Azure Storage/Azure Storage - Overview|tenant\_name=\* subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" accountresourceid=\* resource\_name={{resource\_name}} responsetype=\*error\*  statistic=total metric=Transactions <br />\| quantize 1h using sum <br />\| sum by resource\_name |
|Azure Storage|Failed request count by status text|Logs|Installed Apps/Azure Storage/Azure Storage -  Failures|tenant\_name={{tenant\_name}}<br />provider\_name="Microsoft.Storage"<br />resource\_type="storageAccounts"<br />subscription\_id={{subscription\_id}}<br />resource\_group={{resource\_group}}<br />resource\_name={{resource\_name}}<br />location={{location}}<br />\*STORAGE\*<br />\| json field=\_raw  "properties.objectKey", "properties.serviceType", "properties.clientRequestId", "statusCode", "category", "operationName", "statusText", "properties.metricResponseType" as filePath, serviceType, clientRequestId, statusCode, category, operationName, statusText, ResponseType <br />\| where statusText != "Success"<br />\| count as Count by statusText|
|Azure Storage|Failed Transaction by Category|Logs|Installed Apps/Azure Storage/Azure Storage -  Failures|tenant\_name={{tenant\_name}}<br />provider\_name="Microsoft.Storage"<br />resource\_type="storageAccounts"<br />subscription\_id={{subscription\_id}}<br />resource\_group={{resource\_group}}<br />resource\_name={{resource\_name}}<br />location={{location}}<br />\*STORAGE\*<br />\| json field=\_raw  "properties.objectKey", "properties.serviceType", "properties.clientRequestId", "statusCode", "category", "operationName", "statusText", "properties.metricResponseType" as filePath, serviceType, clientRequestId, statusCode, category, operationName, statusText, ResponseType <br />\| where statusText != "Success"<br />\| timeslice 5m<br />\| count by category, \_timeslice<br />\| transpose row \_timeslice column category|
|Azure Storage|Failed Transactions|Logs|Installed Apps/Azure Storage/Azure Storage -  Failures|tenant\_name={{tenant\_name}}<br />provider\_name="Microsoft.Storage"<br />resource\_type="storageAccounts"<br />subscription\_id={{subscription\_id}}<br />resource\_group={{resource\_group}}<br />resource\_name={{resource\_name}}<br />location={{location}}<br />\*STORAGE\*<br />\| json field=\_raw  "properties.objectKey", "properties.serviceType", "properties.clientRequestId", "statusCode", "category", "operationName", "statusText", "properties.metricResponseType" as filePath, serviceType, clientRequestId, statusCode, category, operationName, statusText, ResponseType <br />\| where statusText != "Success"<br />\| count|
|Azure Storage|Failed transactions by API name|Metrics|Installed Apps/Azure Storage/Azure Storage -  Failures|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" accountresourceid=\* resource\_name={{resource\_name}} responsetype=\*error\*  statistic=total metric=Transactions <br />\| quantize 1h using sum <br />\| sum by apiname |
|Azure Storage|Failed transactions by authentication|Metrics|Installed Apps/Azure Storage/Azure Storage -  Failures|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" accountresourceid=\* resource\_name={{resource\_name}} responsetype=\*error\*  statistic=total metric=Transactions <br />\| quantize using sum <br />\| sum by Authentication|
|Azure Storage|Failed transactions by authentication|Metrics|Installed Apps/Azure Storage/Azure Storage -  Failures|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" !(accountresourceid=\*) service\_type=\* resource\_name={{resource\_name}} responsetype=\*error\*  statistic=total metric=Transactions <br />\| quantize 1h using sum <br />\| sum by Authentication, resource\_name, service\_type, responsetype|
|Azure Storage|Failed transactions by response type|Metrics|Installed Apps/Azure Storage/Azure Storage -  Failures|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" accountresourceid=\* resource\_name={{resource\_name}} responsetype=\*error\*  statistic=total metric=Transactions <br />\| quantize using sum <br />\| sum by responsetype |
|Azure Storage|Failed transactions by response type|Metrics|Installed Apps/Azure Storage/Azure Storage -  Failures|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" accountresourceid=\* resource\_name={{resource\_name}} responsetype=\*error\*  statistic=total metric=Transactions <br />\| quantize using sum <br />\| sum by responsetype |
|Azure Storage|Failed transactions by service type|Metrics|Installed Apps/Azure Storage/Azure Storage -  Failures|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" !(accountresourceid=\*) resource\_name={{resource\_name}} responsetype=\*error\*  statistic=total metric=Transactions  service\_type=\*<br />\| quantize 1h using sum <br />\| sum by service\_type |
|Azure Storage|File Share by Failed Operations|Logs|Installed Apps/Azure Storage/Azure Storage - File Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "statusText", "operationName" as uri, category, statusText, operationName<br />\| where service\_type="FILESERVICES" and statusText != "Success"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<file\_share\>[a-zA-Z0-9-]\*)(?\<file\_path\>[^?]\*\|\$)?" nodrop<br />\| where file\_share matches "{{file\_share}}"<br />\| count as num\_failures by operationName, file\_share<br />\| transpose row file\_share column operationName|
|Azure Storage|Max Success E2E Latency|Metrics|Installed Apps/Azure Storage/Azure Storage - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} metric=SuccessE2ELatency accountresourceid=\* statistic=maximum \| quantize using max<br />\| max by resource\_name<br />|
|Azure Storage|Max Success Server Latency|Metrics|Installed Apps/Azure Storage/Azure Storage - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} metric=SuccessServerLatency accountresourceid=\* statistic=maximum \| quantize using max<br />\| max by resource\_name<br />|
|Azure Storage|Non 200 status code by Service Type|Logs|Installed Apps/Azure Storage/Azure Storage - Operations|tenant\_name={{tenant\_name}}<br />provider\_name="Microsoft.Storage"<br />resource\_type="storageAccounts"<br />subscription\_id={{subscription\_id}}<br />resource\_group={{resource\_group}}<br />resource\_name={{resource\_name}}<br />location={{location}}<br />\*STORAGE\*<br />\| json "statusCode", "properties.serviceType" as statusCode, service\_type<br />\| where statusCode!=200<br />\| count by  resource\_name, service\_type, statusCode<br />\| transpose row resource\_name, service\_type column statusCode|
|Azure Storage|Non-zero status code by storage account|Logs|Installed Apps/Azure Storage/Azure Storage -  Failures|tenant\_name={{tenant\_name}}<br />provider\_name="Microsoft.Storage"<br />resource\_type="storageAccounts"<br />subscription\_id={{subscription\_id}}<br />resource\_group={{resource\_group}}<br />resource\_name={{resource\_name}}<br />location={{location}}<br />\*STORAGE\*<br />\| json "statusCode" as statusCode<br />\| timeslice 1h<br />\| where statusCode!=200<br />\| count by resource\_name, statusCode, \_timeslice<br />\| transpose row \_timeslice column statusCode, resource\_name|
|Azure Storage|Operations that caused server-side throttling errors|Logs|Installed Apps/Azure Storage/Azure Storage -  Audit control plane operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name={{resource\_name}}<br />provider\_name={{provider\_name}} resource\_type={{resource\_type}} \*STORAGE\*<br />\| json "statusText"<br />\| where statusText="ServerBusy"<br />\| count by operationname|
|Azure Storage|Operations used|Logs|Installed Apps/Azure Storage/Azure Storage -  Audit control plane operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name={{resource\_name}}<br />provider\_name={{provider\_name}} resource\_type={{resource\_type}} \*STORAGE\*<br />\| json "resultType", "category", "operationName" as resultType, category, operationName<br />\| where (resultType="Accept" or resultType="Success") and category="Administrative" and resourceid matches /STORAGE/ and toUppercase(operationName) matches /STORAGE/<br />\| count by operationName<br />\| order by \_count|
|Azure Storage|Queue Name by Failed Operations|Logs|Installed Apps/Azure Storage/Azure Storage - Queue Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "properties.objectKey", "operationName" as uri, category, objectKey, operationName<br />\| where service\_type="QUEUESERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<queue\_name\>[a-zA-Z0-9-]\*)" nodrop<br />\| parse regex field=objectKey "/(?:[^/]+)/(?\<queue\_name\_in\_object\>[^/]+)" nodrop <br />\| if (isBlank(queue\_name), queue\_name\_in\_object, queue\_name) as queue\_name<br />\| where queue\_name matches "{{queue\_name}}"<br />\| count as num\_failures by  operationName, queue\_name<br />\| transpose row queue\_name column operationName|
|Azure Storage|Read|Logs|Installed Apps/Azure Storage/Azure Storage - File Service|tenant\_name={{tenant\_name}} location={{location}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri","category", "properties.responseBodySize" as uri, category, response\_body\_size<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<file\_share\>[a-zA-Z0-9-]\*)(?\<file\_path\>[^?]\*\|\$)?" nodrop<br />\| where category="StorageRead" and service\_type="FILESERVICES" and file\_share matches "{{file\_share}}"<br />\| sum(response\_body\_size) as response\_body\_size\_bytes<br />\| response\_body\_size\_bytes/1Mi as response\_body\_size\_mb<br />\| fields response\_body\_size\_mb|
|Azure Storage|Read|Logs|Installed Apps/Azure Storage/Azure Storage - Table Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "category", "properties.responseBodySize" as category, response\_body\_size<br />\| where category="StorageRead" and service\_type="TABLESERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?:Tables\\(')?(?\<table\_name\>[a-zA-Z0-9]\*)" nodrop <br />\| parse regex field=objectKey "/(?:[^/]+)/(?\<table\_name\_in\_object\>[^/]+)" nodrop <br />\| if (isBlank(table\_name), table\_name\_in\_object, table\_name) as table\_name<br />\| where table\_name matches "{{table\_name}}"<br />\| sum(response\_body\_size) as response\_body\_size\_byte<br />\| response\_body\_size\_byte/1Mi as response\_body\_size\_mb<br />\| fields response\_body\_size\_mb|
|Azure Storage|Read|Logs|Installed Apps/Azure Storage/Azure Storage - Queue Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}}<br />\*STORAGE\*<br />\| JSON "uri", "category", "properties.responseBodySize", "properties.objectKey" as uri, category, response\_body\_size, objectKey nodrop<br />\| where category="StorageRead" and service\_type="QUEUESERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<queue\_name\>[a-zA-Z0-9-]\*)" nodrop<br />\| parse regex field=objectKey "/(?:[^/]+)/(?\<queue\_name\_in\_object\>[^/]+)" nodrop <br />\| if (isBlank(queue\_name), queue\_name\_in\_object, queue\_name) as queue\_name<br />\| where queue\_name matches "{{queue\_name}}"<br />\| sum(response\_body\_size) as response\_body\_size\_bytes<br />\| response\_body\_size\_bytes/1Mi as response\_body\_size\_mb<br />\| fields response\_body\_size\_mb|
|Azure Storage|Read|Logs|Installed Apps/Azure Storage/Azure Storage - Blob Service|tenant\_name={{tenant\_name}} location={{location}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "properties.responseBodySize" as uri, category, response\_body\_size<br />\| where category="StorageRead" and service\_type="BLOBSERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<container\_name\>[\$a-zA-Z0-9-]+)(?\<blob\_file\_path\>[^?]+\|\$)?" nodrop<br />\| where container\_name matches "{{container\_name}}" <br />\| sum(response\_body\_size) as response\_body\_size\_bytes<br />\| response\_body\_size\_bytes/1Mi as response\_body\_size\_mb<br />\| fields response\_body\_size\_mb|
|Azure Storage|Read vs Write|Logs|Installed Apps/Azure Storage/Azure Storage - Table Service|tenant\_name={{tenant\_name}} location={{location}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "category", "properties.responseBodySize" as category, response\_body\_size<br />\| where category="StorageRead" and service\_type="TABLESERVICES"<br />\| timeslice 1h<br />\| sum(response\_body\_size) as response\_body\_size\_bytes by \_timeslice|
|Azure Storage|Read vs Write|Logs|Installed Apps/Azure Storage/Azure Storage - File Service|tenant\_name={{tenant\_name}} location={{location}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "category", "properties.responseBodySize" as category, response\_body\_size<br />\| where category="StorageRead" and service\_type="FILESERVICES"<br />\| timeslice 1h<br />\| sum(response\_body\_size) as response\_body\_size\_bytes by \_timeslice|
|Azure Storage|Read vs Write|Logs|Installed Apps/Azure Storage/Azure Storage - Blob Service|tenant\_name={{tenant\_name}} location={{location}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "category", "properties.responseBodySize" as category, response\_body\_size<br />\| where category="StorageRead" and service\_type="BLOBSERVICES"<br />\| timeslice 1h<br />\| sum(response\_body\_size) as response\_body\_size\_bytes by \_timeslice|
|Azure Storage|Read vs Write|Logs|Installed Apps/Azure Storage/Azure Storage - Queue Service|tenant\_name={{tenant\_name}} location={{location}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "category", "properties.responseBodySize" as category, response\_body\_size<br />\| where category="StorageRead" and service\_type="QUEUESERVICES"<br />\| timeslice 1h<br />\| sum(response\_body\_size) as response\_body\_size\_bytes by \_timeslice<br />\| response\_body\_size\_bytes|
|Azure Storage|Reads by Container Name|Logs|Installed Apps/Azure Storage/Azure Storage - Blob Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri","category", "properties.responseBodySize" as uri, category, response\_body\_size<br />\| where category="StorageRead" and service\_type="BLOBSERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<container\_name\>[\$a-zA-Z0-9-]+)(?\<blob\_file\_path\>[^?]+\|\$)?" nodrop<br />\| where container\_name matches "{{container\_name}}"<br />\| timeslice 15m<br />\| sum(response\_body\_size) as response\_body\_size\_bytes by container\_name, \_timeslice<br />\| transpose row \_timeslice column container\_name|
|Azure Storage|Reads by File Share|Logs|Installed Apps/Azure Storage/Azure Storage - File Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "statusText", "properties.responseBodySize", "properties.objectKey" as uri, category, statusText, response\_body\_size, objectKey<br />\| where category="StorageRead" and service\_type="FILESERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<file\_share\>[a-zA-Z0-9-]\*)(?\<file\_path\>[^?]\*\|\$)?" nodrop<br />\| where file\_share matches "{{file\_share}}"<br />\| timeslice 15m<br />\| sum(response\_body\_size) as response\_body\_size\_bytes by file\_share, \_timeslice<br />\| transpose row \_timeslice column file\_share|
|Azure Storage|Reads by Queue Name|Logs|Installed Apps/Azure Storage/Azure Storage - Queue Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "properties.objectKey", "properties.responseBodySize" as uri, category, objectKey, response\_body\_size<br />\| where category="StorageRead" and service\_type="QUEUESERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<queue\_name\>[a-zA-Z0-9-]\*)" nodrop<br />\| parse regex field=objectKey "/(?:[^/]+)/(?\<queue\_name\_in\_object\>[^/]+)" nodrop <br />\| if (isBlank(queue\_name), queue\_name\_in\_object, queue\_name) as queue\_name<br />\| where queue\_name matches "{{queue\_name}}"<br />\| timeslice 15m<br />\| sum(response\_body\_size) as response\_body\_size\_bytes by queue\_name, \_timeslice<br />\| transpose row \_timeslice column queue\_name|
|Azure Storage|Reads by Table Name|Logs|Installed Apps/Azure Storage/Azure Storage - Table Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "category", "properties.responseBodySize" as category, response\_body\_size<br />\| where category="StorageRead" and service\_type="TABLESERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?:Tables\\(')?(?\<table\_name\>[a-zA-Z0-9]\*)" nodrop <br />\| parse regex field=objectKey "/(?:[^/]+)/(?\<table\_name\_in\_object\>[^/]+)" nodrop <br />\| if (isBlank(table\_name), table\_name\_in\_object, table\_name) as table\_name<br />\| where table\_name matches "{{table\_name}}"<br />\| timeslice 15m<br />\| sum(response\_body\_size) as response\_body\_size\_bytes by table\_name, \_timeslice<br />\| transpose row \_timeslice column table\_name|
|Azure Storage|Recent alerts|Logs|Installed Apps/Azure Storage/Azure Storage - Health|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}}<br />\| JSON "category", "resultType", "properties.eventTimestamp", "properties.operationName", "properties.status" as category, resultType, eventTimestamp, operationName, status<br />\| where category="Alert"<br />\| parse field=operationName "\*/\*/\*" as category, operation\_name, action nodrop<br />\| count as Count by level, resultType, resource\_name, provider\_name, operation\_name, eventTimestamp, status|
|Azure Storage|Recent failed policy events|Logs|Installed Apps/Azure Storage/Azure Storage - Security and policy|tenant\_name={{tenant\_name}}<br />subscription\_id={{subscription\_id}}<br />resource\_group={{resource\_group}}<br />resource\_name={{resource\_name}}<br />provider\_name={{provider\_name}}<br />\| JSON "category", "resultType", "level", "properties.message", "properties.resourceLocation", "properties.entity" as category, resultType, level, message, resource\_location, entity<br />\| parse field=entity "/subscriptions/\*/resourceGroups/\*/providers/\*/virtualMachines/\*" as subscription\_id, resource\_group, providers, virtualMachines nodrop<br />\| parse field=entity "/subscriptions/\*/resourceGroups/\*/providers/\*/storageAccounts/\*" as subscription\_id, resource\_group, providers, resource\_name nodrop<br />\| where category="Policy" and resultType="Failure"<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as time<br />\| count as Count by time, level, resultType, provider\_name, resource\_name, resource\_location|
|Azure Storage|Recent failed request|Logs|Installed Apps/Azure Storage/Azure Storage -  Failures|tenant\_name={{tenant\_name}}<br />provider\_name="Microsoft.Storage"<br />resource\_type="storageAccounts"<br />subscription\_id={{subscription\_id}}<br />resource\_group={{resource\_group}}<br />resource\_name={{resource\_name}}<br />location={{location}}<br />\*STORAGE\*<br />\| json field=\_raw  "properties.objectKey", "properties.serviceType", "properties.clientRequestId", "statusCode", "category", "operationName", "statusText", "properties.metricResponseType" as filePath, serviceType, clientRequestId, statusCode, category, operationName, statusText, ResponseType <br />\| where statusText != "Success"<br />\| count by \_messageTime, resource\_name, filePath, serviceType, clientRequestId, category, operationName, statusText, ResponseType <br />\| sort by \_messageTime \| limit 10 \| fields -\_count|
|Azure Storage|Recent recommendation events|Logs|Installed Apps/Azure Storage/Azure Storage - Security and policy|tenant\_name={{tenant\_name}}<br />subscription\_id={{subscription\_id}}<br />location={{location}}<br />resource\_group={{resource\_group}}<br />resource\_name={{resource\_name}}<br />provider\_name={{provider\_name}}<br />\| JSON "category", "operationName", "resultType", "properties.recommendationImpact", "properties.recommendationName" as category, operationName, resultType, recommendationImpact, recommendationName<br />\| where category="Recommendation"<br />\| parse field=operationName "\*/\*/\*/\*" as provider, category, operation\_name, action nodrop<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as time<br />\| count as Count by time, operation\_name, provider\_name, resource\_name, resultType, recommendationImpact, recommendationName|
|Azure Storage|Recent Resource health incidents|Logs|Installed Apps/Azure Storage/Azure Storage - Health|tenant\_name={{tenant\_name}}<br />provider\_name={{provider\_name}}<br />resource\_type={{resource\_type}}<br />subscription\_id={{subscription\_id}}<br />resource\_group={{resource\_group}}<br />resource\_name={{resource\_name}}<br />location={{location}}<br />\| JSON "category", "operationName", "time","level","resultType", "properties.title", "properties.details", "properties.currentHealthStatus", "properties.type", "properties.cause" as category, operationName, time,level,resultType, title, details, currentHealthStatus, type, cause nodrop<br />\| where category="ResourceHealth" and resourceId matches /STORAGEACCOUNTS/<br />\| parse field=operationName "\*/\*/\*" as category, operation\_name, action nodrop<br />\| count as Count by time, level, resultType, resource\_name, operation\_name, title, details, currentHealthStatus, type, cause|
|Azure Storage|Recent security events|Logs|Installed Apps/Azure Storage/Azure Storage - Security and policy|tenant\_name={{tenant\_name}}<br />subscription\_id={{subscription\_id}}<br />location={{location}}<br />resource\_group={{resource\_group}}<br />resource\_name={{resource\_name}}<br />provider\_name={{provider\_name}}<br />\| Json "category", "properties.status", "properties.timeGeneratedUtc", "properties.processingEndTimeUtc", "properties.version", "properties.vendorName", "properties.productName", "properties.alertType", "properties.startTimeUtc", "properties.endTimeUtc", "properties.severity", "properties.isIncident", "properties.intent", "properties.compromisedEntity", "properties.alertDisplayName", "properties.description", "properties.productComponentName" as category, status, timeGeneratedUtc, processingEndTimeUtc, version, vendorName, productName, alertType, startTimeUtc, endTimeUtc, severity, isIncident, intent, compromisedEntity, alertDisplayName, description, productComponentName nodrop<br />\| where category="Security"<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as time<br />\| count as Count by time, status, timeGeneratedUtc, processingEndTimeUtc, version, vendorName, productName, alertType, startTimeUtc, endTimeUtc, severity, isIncident, intent, compromisedEntity, alertDisplayName, description, productComponentName|
|Azure Storage|Recent Service Health incidents|Logs|Installed Apps/Azure Storage/Azure Storage - Health|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}}<br />\| JSON "category", "operationName", "time","level","resultType", "properties.incidentType", "properties.service", "properties.region", "properties.impactStartTime", "properties.impactMitigationTime", "properties.defaultLanguageTitle", "properties.stage" as category, operationName, time,level,resultType, incidentType, service, service\_region, impactStartTime, impactMitigationTime, defaultLanguageTitle, stage nodrop<br />\| replace(toLowerCase(service\_region), " ", "") as service\_region<br />\| where category="ServiceHealth" and toUpperCase(service) matches /STORAGE/ and service\_region matches "{{location}}"<br />\| parse field=operationName "\*/\*/\*" as category, operation\_name, action nodrop<br />\| count as Count by time , level, resultType, operation\_name, impactStartTime, impactMitigationTime, defaultLanguageTitle, stage|
|Azure Storage|Recent success policy events|Logs|Installed Apps/Azure Storage/Azure Storage - Security and policy|tenant\_name={{tenant\_name}}<br />subscription\_id={{subscription\_id}}<br />resource\_group={{resource\_group}}<br />resource\_name={{resource\_name}}<br />provider\_name={{provider\_name}}<br />\| JSON "category", "resultType", "level", "providers", "properties.message", "properties.resourceLocation", "properties.entity" as category, resultType, level, providers, message, resource\_location, entity nodrop<br />\| parse field=entity "/subscriptions/\*/resourceGroups/\*/providers/\*/virtualMachines/\*" as subscription\_id, resource\_group, providers, virtualMachines nodrop<br />\| parse field=entity "/subscriptions/\*/resourceGroups/\*/providers/\*/storageAccounts/\*" as subscription\_id, resource\_group, providers, resource\_name nodrop<br />\| where category="Policy" and resultType="Success" and resource\_group matches "{{resource\_group}}" and subscription\_id matches "{{subscription\_id}}" and resource\_name matches "{{resource\_name}}"<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as time<br />\| count as Count by time, level, resultType, provider\_name, resource\_name, resource\_location|
|Azure Storage|Requests with anonymous access|Metrics|Installed Apps/Azure Storage/Azure Storage -  Audit control plane operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}}<br />accountresourceid=\* metric=Transactions Authentication="AnonymousPreflight"<br />\| count by ApiName, ResponseType, GeoType, timeGrain|
|Azure Storage|Resource health by event type|Logs|Installed Apps/Azure Storage/Azure Storage - Health|tenant\_name={{tenant\_name}}<br />provider\_name={{provider\_name}}<br />resource\_type={{resource\_type}}<br />subscription\_id={{subscription\_id}}<br />resource\_group={{resource\_group}}<br />resource\_name={{resource\_name}}<br />location={{location}}<br />\| JSON "category", "properties.currentHealthStatus" as category, currentHealthStatus<br />\| where category="ResourceHealth" and resourceId matches /STORAGEACCOUNTS/<br />\| count as Count by currentHealthStatus|
|Azure Storage|Service Health by event type|Logs|Installed Apps/Azure Storage/Azure Storage - Health|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}}<br />\| JSON "category", "properties.incidentType", "properties.service", "properties.region" as category, incidentType, service, service\_region<br />\| replace(toLowerCase(service\_region), " ", "") as service\_region<br />\| where category="ServiceHealth" and toUpperCase(service) matches /STORAGE/ and service\_region matches "{{location}}"<br />\| count by incidentType<br />\| order by incidentType|
|Azure Storage|service health by event type-Time chart|Logs|Installed Apps/Azure Storage/Azure Storage - Health|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}}<br />\| JSON "category", "properties.incidentType", "properties.service", "properties.region" as category, incidentType, service, service\_region<br />\| replace(toLowerCase(service\_region), " ", "") as service\_region<br />\| where category="ServiceHealth" and toUpperCase(service) matches /STORAGE/ and service\_region matches "{{location}}"<br />\| count as Count by incidentType|
|Azure Storage|Storage Account Read Statistics|Logs|Installed Apps/Azure Storage/Azure Storage - Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts"<br />resource\_name={{resource\_name}}<br />location={{location}}<br />\*STORAGE\*<br />\| json "category", "properties.responseBodySize", "properties.serverLatencyMs", "properties.serviceType" as category, response\_body\_size, server\_latency, service\_type<br />\| where category="StorageRead"<br />\| count as read\_count, sum(response\_body\_size) as read\_bytes, max(server\_latency) as max\_read\_server\_latency, avg(server\_latency) as avg\_read\_server\_latency  by resource\_name, service\_type|
|Azure Storage|Storage Account Write Statistics|Logs|Installed Apps/Azure Storage/Azure Storage - Operations|tenant\_name=\* subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts"<br />resource\_name=\*<br />location={{location}}<br />\*STORAGE\*<br />\| json "category", "properties.requestBodySize", "properties.serverLatencyMs","properties.serviceType" as category, request\_body\_size, server\_latency, service\_type  <br />\| where category="StorageWrite"<br />\| count as write\_count, sum(request\_body\_size) as write\_bytes, max(server\_latency) as max\_write\_server\_latency, avg(server\_latency) as avg\_write\_server\_latency  by resource\_name, service\_type|
|Azure Storage|Success E2E Latency vs. Success Server Latency (ms)|Metrics|Installed Apps/Azure Storage/Azure Storage -  Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} accountresourceid=\* metric=SuccessServerLatency  \| avg by metric |
|Azure Storage|Success E2E Latency vs. Success Server Latency (ms) by Service Type|Metrics|Installed Apps/Azure Storage/Azure Storage -  Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} !(accountresourceid=\*) service\_type=\* metric=SuccessServerLatency  \| avg by metric,service\_type |
|Azure Storage|SuccessE2ELatency(ms)|Metrics|Installed Apps/Azure Storage/Azure Storage -  Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} metric=SuccessE2ELatency !(accountresourceid=\*) service\_type=\* statistic=minimum  \| quantize using min  <br />\| min by service\_type,resource\_name<br />|
|Azure Storage|SuccessServerLatency(ms)|Metrics|Installed Apps/Azure Storage/Azure Storage -  Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} metric=SuccessServerLatency !(accountresourceid=\*) service\_type=\* statistic=minimum  \| quantize using min  <br />\| min by service\_type,resource\_name<br />|
|Azure Storage|Table Name by Failed Operations|Logs|Installed Apps/Azure Storage/Azure Storage - Table Service|tenant\_name={{tenant\_name}} location={{location}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "category", "operationName", "statusText", "properties.objectKey" as category, operationName, statusText, objectKey<br />\| where service\_type="TABLESERVICES" and statusText != "Success"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?:Tables\\(')?(?\<table\_name\>[a-zA-Z0-9]\*)" nodrop <br />\| parse regex field=objectKey "/(?:[^/]+)/(?\<table\_name\_in\_object\>[^/]+)" nodrop <br />\| if (isBlank(table\_name), table\_name\_in\_object, table\_name) as table\_name<br />\| where table\_name matches "{{table\_name}}"<br />\| count as num\_failures by  operationName, table\_name<br />\| transpose row table\_name column operationName<br />|
|Azure Storage|Top 10 high latency transactions|Logs|Installed Apps/Azure Storage/Azure Storage -  Performance|tenant\_name={{tenant\_name}}<br />provider\_name="Microsoft.Storage"<br />resource\_type="storageAccounts"<br />subscription\_id={{subscription\_id}}<br />resource\_group={{resource\_group}}<br />resource\_name={{resource\_name}}<br />location={{location}}<br />\*STORAGE\*<br />\| json field=\_raw "properties.responseBodySize", "properties.requestBodySize", "properties.objectKey", "properties.serviceType", "properties.clientRequestId", "statusCode", "durationMs", "category", "operationName" as responseBodySize, requestBodySize, filePath, serviceType, clientRequestId, statusCode, durationMs, category, operationName nodrop<br />\| where statusCode=200<br />\| max(durationMs) as Duration by resource\_name, filePath, serviceType, clientRequestId, category, operationName, responseBodySize, requestBodySize<br />\| top 10 resource\_name, filePath, serviceType, clientRequestId, category, operationName, responseBodySize, requestBodySize by Duration<br />|
|Azure Storage|Top 10 most common errors|Logs|Installed Apps/Azure Storage/Azure Storage -  Audit control plane operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name={{resource\_name}}<br />provider\_name={{provider\_name}} resource\_type={{resource\_type}} \*STORAGE\*<br />\| json "statusText"<br />\| where !(statusText="Success")<br />\| count as Count by statusText<br />\| order by Count<br />\| limit 10|
|Azure Storage|Top 10 operations that caused the most errors|Logs|Installed Apps/Azure Storage/Azure Storage -  Audit control plane operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name={{resource\_name}}<br />provider\_name={{provider\_name}} resource\_type={{resource\_type}} \*STORAGE\*<br />\| json "statusText", "operationName" as statusText, operationName<br />\| where !(statusText="Success")<br />\| count as Count by operationname,statusText<br />\| order by Count<br />\| limit 10|
|Azure Storage|Top 10 Resources  by Failures|Logs|Installed Apps/Azure Storage/Azure Storage - Table Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "category", "statusText", "properties.objectKey" as category,  statusText, objectKey<br />\| where service\_type="TABLESERVICES" and statusText != "Success"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?:Tables\\(')?(?\<table\_name\>[a-zA-Z0-9]\*)" nodrop <br />\| parse regex field=objectKey "/(?:[^/]+)/(?\<table\_name\_in\_object\>[^/]+)" nodrop <br />\| if (isBlank(table\_name), table\_name\_in\_object, table\_name) as table\_name<br />\| where table\_name matches "{{table\_name}}"<br />\| count as num\_failures by resource\_name, table\_name, objectKey, category<br />\| top 10 resource\_name, table\_name, category, objectKey by num\_failures|
|Azure Storage|Top 10 Resources  by Server Latency|Logs|Installed Apps/Azure Storage/Azure Storage - Table Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| where service\_type="TABLESERVICES"<br />\| JSON "category", "statusText", "properties.objectKey", "properties.serverLatencyMs" as category,  statusText, objectKey, server\_latency<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?:Tables\\(')?(?\<table\_name\>[a-zA-Z0-9]\*)" nodrop <br />\| parse regex field=objectKey "/(?:[^/]+)/(?\<table\_name\_in\_object\>[^/]+)" nodrop <br />\| if (isBlank(table\_name), table\_name\_in\_object, table\_name) as table\_name<br />\| where table\_name matches "{{table\_name}}"<br />\| max(server\_latency) as max\_server\_latency\_ms, avg(server\_latency) as avg\_server\_latency\_ms, pct(server\_latency, 95) as p95\_server\_latency\_ms by resource\_name, table\_name, objectKey, category<br />\| top 10 resource\_name, table\_name, category, objectKey by max\_server\_latency\_ms, avg\_server\_latency\_ms, p95\_server\_latency\_ms|
|Azure Storage|Top 10 Resources by Failures|Logs|Installed Apps/Azure Storage/Azure Storage - Queue Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "properties.objectKey" as uri, category, objectKey<br />\| where service\_type="QUEUESERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<queue\_name\>[a-zA-Z0-9-]\*)" nodrop<br />\| parse regex field=objectKey "/(?:[^/]+)/(?\<queue\_name\_in\_object\>[^/]+)" nodrop <br />\| if (isBlank(queue\_name), queue\_name\_in\_object, queue\_name) as queue\_name<br />\| where queue\_name matches "{{queue\_name}}"<br />\| count as num\_failures by resource\_name, queue\_name, objectKey, category<br />\| top 10 resource\_name, queue\_name, category, objectKey by num\_failures|
|Azure Storage|Top 10 Resources by Failures|Logs|Installed Apps/Azure Storage/Azure Storage - File Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "statusText", "properties.objectKey" as uri, category, statusText, objectKey<br />\| where service\_type="FILESERVICES" and statusText != "Success"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<file\_share\>[a-zA-Z0-9-]\*)(?\<file\_path\>[^?]\*\|\$)?" nodrop<br />\| where file\_share matches "{{file\_share}}"<br />\| count as num\_failures by resource\_name, file\_share, objectKey, category<br />\| top 10 resource\_name, file\_share, category, objectKey by num\_failures|
|Azure Storage|Top 10 Resources by Failures|Logs|Installed Apps/Azure Storage/Azure Storage - Blob Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "statusText", "properties.objectKey" as uri, category, statusText, objectKey<br />\| where service\_type="BLOBSERVICES" and statusText != "Success"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<container\_name\>[\$a-zA-Z0-9-]+)(?\<blob\_file\_path\>[^?]+\|\$)?" nodrop<br />\| where container\_name matches "{{container\_name}}"<br />\| count as num\_failures by resource\_name, container\_name, objectKey, category<br />\| top 10 resource\_name, container\_name, category, objectKey by num\_failures|
|Azure Storage|Top 10 Resources by Latency|Logs|Installed Apps/Azure Storage/Azure Storage - Blob Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "statusText", "properties.objectKey", "properties.serverLatencyMs" as uri, category, statusText, objectKey, server\_latency<br />\| where service\_type="BLOBSERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<container\_name\>[\$a-zA-Z0-9-]+)(?\<blob\_file\_path\>[^?]+\|\$)?" nodrop<br />\| where container\_name matches "{{container\_name}}"<br />\| max(server\_latency) as max\_server\_latency\_ms, avg(server\_latency) as avg\_server\_latency\_ms, pct(server\_latency, 95) as p95\_server\_latency\_ms by resource\_name, container\_name, objectKey, category<br />\| top 10 resource\_name, container\_name, category, objectKey by max\_server\_latency\_ms, avg\_server\_latency\_ms, p95\_server\_latency\_ms|
|Azure Storage|Top 10 Resources by Reads(MB)|Logs|Installed Apps/Azure Storage/Azure Storage - Table Service|tenant\_name={{tenant\_name}} location={{location}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| json "category", "properties.responseBodySize", "properties.objectKey", "uri" as category, response\_body\_size, objectKey, uri<br />\| where category="StorageRead" and service\_type="TABLESERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?:Tables\\(')?(?\<table\_name\>[a-zA-Z0-9]\*)" nodrop<br />\| parse regex field=objectKey "/(?:[^/]+)/(?\<table\_name\_in\_object\>[^/]+)" nodrop <br />\| if (isBlank(table\_name), table\_name\_in\_object, table\_name) as table\_name<br />\| where table\_name matches "{{table\_name}}"<br />\| sum(response\_body\_size) as response\_body\_size\_bytes by resource\_name, objectKey, table\_name<br />\| response\_body\_size\_bytes/(1024\*1024) as reads\_mb<br />\| top 10 resource\_name, table\_name, objectKey by reads\_mb|
|Azure Storage|Top 10 Resources by Reads(MB)|Logs|Installed Apps/Azure Storage/Azure Storage - Queue Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "properties.objectKey", "properties.responseBodySize" as uri, category, objectKey, response\_body\_size<br />\| where category="StorageRead" and service\_type="QUEUESERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<queue\_name\>[a-zA-Z0-9-]\*)" nodrop<br />\| parse regex field=objectKey "/(?:[^/]+)/(?\<queue\_name\_in\_object\>[^/]+)" nodrop <br />\| if (isBlank(queue\_name), queue\_name\_in\_object, queue\_name) as queue\_name<br />\| where queue\_name matches "{{queue\_name}}"<br />\| sum(response\_body\_size) as response\_body\_size\_bytes by resource\_name, objectKey, queue\_name<br />\| response\_body\_size\_bytes/(1024\*1024) as reads\_mb<br />\| top 10 resource\_name, queue\_name, objectKey by reads\_mb|
|Azure Storage|Top 10 Resources by Reads(MB)|Logs|Installed Apps/Azure Storage/Azure Storage - Blob Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "statusText", "properties.responseBodySize", "properties.objectKey" as uri, category, statusText, response\_body\_size, objectKey<br />\| where category="StorageRead" and service\_type="BLOBSERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<container\_name\>[\$a-zA-Z0-9-]+)(?\<blob\_file\_path\>[^?]+\|\$)?" nodrop<br />\| where container\_name matches "{{container\_name}}"<br />\| sum(response\_body\_size) as response\_body\_size\_bytes by resource\_name, objectKey, container\_name<br />\| response\_body\_size\_bytes/(1024\*1024) as reads\_mb<br />\| top 10 resource\_name, container\_name, objectKey by reads\_mb|
|Azure Storage|Top 10 Resources by Reads(MB)|Logs|Installed Apps/Azure Storage/Azure Storage - File Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "properties.objectKey", "properties.responseBodySize" as uri, category, objectKey, response\_body\_size<br />\| where category="StorageRead" and service\_type="TABLESERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<file\_share\>[a-zA-Z0-9-]\*)(?\<file\_path\>[^?]\*\|\$)?" nodrop<br />\| where file\_share matches "{{file\_share}}"<br />\| sum(response\_body\_size) as response\_body\_size\_bytes by resource\_name, objectKey, file\_share<br />\| response\_body\_size\_bytes/(1024\*1024) as reads\_mb<br />\| top 10 resource\_name, file\_share, objectKey by reads\_mb|
|Azure Storage|Top 10 Resources by Server Latency|Logs|Installed Apps/Azure Storage/Azure Storage - File Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "statusText", "properties.objectKey", "properties.serverLatencyMs" as uri, category, statusText, objectKey, server\_latency<br />\| where service\_type="FILESERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<file\_share\>[a-zA-Z0-9-]\*)(?\<file\_path\>[^?]\*\|\$)?" nodrop<br />\| where file\_share matches "{{file\_share}}"<br />\| max(server\_latency) as max\_server\_latency\_ms, avg(server\_latency) as avg\_server\_latency\_ms, pct(server\_latency, 95) as p95\_server\_latency\_ms by resource\_name, file\_share, objectKey, category<br />\| top 10 resource\_name, file\_share, category, objectKey by max\_server\_latency\_ms, avg\_server\_latency\_ms, p95\_server\_latency\_ms|
|Azure Storage|Top 10 Resources by Server Latency|Logs|Installed Apps/Azure Storage/Azure Storage - Queue Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "properties.objectKey", "properties.serverLatencyMs" as uri, category, objectKey, server\_latency<br />\| where service\_type="QUEUESERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<queue\_name\>[a-zA-Z0-9-]\*)" nodrop<br />\| parse regex field=objectKey "/(?:[^/]+)/(?\<queue\_name\_in\_object\>[^/]+)" nodrop <br />\| if (isBlank(queue\_name), queue\_name\_in\_object, queue\_name) as queue\_name<br />\| where queue\_name matches "{{queue\_name}}"<br />\| max(server\_latency) as max\_server\_latency\_ms, avg(server\_latency) as avg\_server\_latency\_ms, pct(server\_latency, 95) as p95\_server\_latency\_ms by resource\_name, queue\_name, objectKey, category<br />\| top 10 resource\_name, queue\_name, category, objectKey by max\_server\_latency\_ms, avg\_server\_latency\_ms, p95\_server\_latency\_ms|
|Azure Storage|Top 10 Resources by Writes(MB)|Logs|Installed Apps/Azure Storage/Azure Storage - Blob Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "statusText", "properties.requestBodySize", "properties.objectKey" as uri, category, statusText, request\_body\_size, objectKey<br />\| where category="StorageWrite" and service\_type="BLOBSERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<container\_name\>[\$a-zA-Z0-9-]+)(?\<blob\_file\_path\>[^?]+\|\$)?" nodrop<br />\| where container\_name matches "{{container\_name}}"<br />\| sum(request\_body\_size) as request\_body\_size\_bytes by resource\_name, objectKey, container\_name<br />\| request\_body\_size\_bytes/(1024\*1024) as writes\_mb<br />\| top 10 resource\_name, container\_name, objectKey by writes\_mb|
|Azure Storage|Top 10 Resources by Writes(MB)|Logs|Installed Apps/Azure Storage/Azure Storage - File Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "properties.objectKey", "properties.requestBodySize" as uri, category, objectKey, request\_body\_size<br />\| where category="StorageWrite" and service\_type="TABLESERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<file\_share\>[a-zA-Z0-9-]\*)(?\<file\_path\>[^?]\*\|\$)?" nodrop<br />\| where file\_share matches "{{file\_share}}"<br />\| sum(request\_body\_size) as request\_body\_size\_bytes by resource\_name, objectKey, file\_share<br />\| request\_body\_size\_bytes/(1024\*1024) as writes\_mb<br />\| top 10 resource\_name, file\_share, objectKey by writes\_mb|
|Azure Storage|Top 10 Resources by Writes(MB)|Logs|Installed Apps/Azure Storage/Azure Storage - Table Service|tenant\_name={{tenant\_name}} location={{location}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "category", "properties.requestBodySize", "properties.objectKey", "uri" as category, request\_body\_size, objectKey, uri <br />\| where category="StorageWrite" and service\_type="TABLESERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?:Tables\\(')?(?\<table\_name\>[a-zA-Z0-9]\*)" nodrop<br />\| parse regex field=objectKey "/(?:[^/]+)/(?\<table\_name\_in\_object\>[^/]+)" nodrop <br />\| if (isBlank(table\_name), table\_name\_in\_object, table\_name) as table\_name<br />\| where table\_name matches "{{table\_name}}"<br />\| sum(request\_body\_size) as request\_body\_size\_bytes by resource\_name, objectKey, table\_name<br />\| request\_body\_size\_bytes/(1024\*1024) as writes\_mb<br />\| top 10 resource\_name, table\_name, objectKey by writes\_mb|
|Azure Storage|Top 10 Resources by Writes(MB)|Logs|Installed Apps/Azure Storage/Azure Storage - Queue Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "properties.objectKey", "properties.requestBodySize" as uri, category, objectKey, request\_body\_size<br />\| where category="StorageWrite" and service\_type="QUEUESERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<queue\_name\>[a-zA-Z0-9-]\*)" nodrop<br />\| parse regex field=objectKey "/(?:[^/]+)/(?\<queue\_name\_in\_object\>[^/]+)" nodrop <br />\| if (isBlank(queue\_name), queue\_name\_in\_object, queue\_name) as queue\_name<br />\| where queue\_name matches "{{queue\_name}}"<br />\| sum(request\_body\_size) as request\_body\_size\_bytes by resource\_name, objectKey, queue\_name<br />\| request\_body\_size\_bytes/(1024\*1024) as writes\_mb<br />\| top 10 resource\_name, queue\_name, objectKey by writes\_mb|
|Azure Storage|Top 10 Success Server Latency by API name|Metrics|Installed Apps/Azure Storage/Azure Storage -  Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} accountresourceid=\* metric=SuccessServerLatency \|  quantize using max \| max by apiname \| topk(10, max)|
|Azure Storage|Top Success E2E Latency by API name|Metrics|Installed Apps/Azure Storage/Azure Storage -  Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} accountresourceid=\* metric=SuccessE2ELatency \| quantize using max \| max by apiname \| topk(10, max)|
|Azure Storage|Total alerts|Logs|Installed Apps/Azure Storage/Azure Storage - Health|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}}<br />\| json "category"<br />\| where category="Alert"<br />\| count by time|
|Azure Storage|Total denied policy events|Logs|Installed Apps/Azure Storage/Azure Storage - Security and policy|tenant\_name={{tenant\_name}}<br />subscription\_id={{subscription\_id}}<br />resource\_group={{resource\_group}}<br />resource\_name={{resource\_name}}<br />provider\_name={{provider\_name}}<br />\| JSON "category", "resultType", "properties.message", "properties.resourceLocation", "properties.entity" as category, resultType, message, resourceLocation, entity<br />\| parse field=entity "/subscriptions/\*/resourceGroups/\*/providers/\*/virtualMachines/\*" as subscription\_id, resource\_group, providers, virtualMachines nodrop<br />\| parse field=entity "/subscriptions/\*/resourceGroups/\*/providers/\*/storageAccounts/\*" as subscription\_id, resource\_group, providers, resource\_name nodrop<br />\| replace(toLowerCase(resourceLocation), " ", "") as resourceLocation<br />\| where category="Policy" and resultType="Success" and resource\_group matches "{{resource\_group}}" and subscription\_id matches "{{subscription\_id}}" and resource\_name matches "{{resource\_name}}"<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as time<br />\| count as Count by time|
|Azure Storage|Total Egress by  Service Type|Metrics|Installed Apps/Azure Storage/Azure Storage - Operations|tenant\_name={{tenant\_name}} metric=Egress provider\_name="Microsoft.Storage" resource\_type="storageAccounts" subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} location={{location}} statistic=Total !(accountresourceid = \*)\| quantize using sum \| sum by service\_type|
|Azure Storage|Total Egress by API name|Metrics|Installed Apps/Azure Storage/Azure Storage - Operations|tenant\_name={{tenant\_name}} metric=Egress provider\_name="Microsoft.Storage" resource\_type="storageAccounts" subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} location={{location}} statistic=Total (accountresourceid = \*)\| quantize using sum \| sum by apiname |
|Azure Storage|Total Egress by storage account|Metrics|Installed Apps/Azure Storage/Azure Storage - Overview|tenant\_name={{tenant\_name}} metric=Egress  provider\_name="Microsoft.Storage" resource\_type="storageAccounts" subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} location={{location}} statistic=Total accountresourceid = \*\| quantize using sum \| sum by resource\_name|
|Azure Storage|Total Ingress by  Service Type|Metrics|Installed Apps/Azure Storage/Azure Storage - Operations|tenant\_name={{tenant\_name}} metric=Ingress provider\_name="Microsoft.Storage" resource\_type="storageAccounts" subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} location={{location}} statistic=Total !(accountresourceid = \*)\| quantize using sum \| sum by service\_type|
|Azure Storage|Total Ingress by API name|Metrics|Installed Apps/Azure Storage/Azure Storage - Operations|tenant\_name={{tenant\_name}} metric=Ingress provider\_name="Microsoft.Storage" resource\_type="storageAccounts" subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} location={{location}} statistic=Total (accountresourceid = \*)\| quantize using sum \| sum by apiname |
|Azure Storage|Total Ingress by storage account|Metrics|Installed Apps/Azure Storage/Azure Storage - Overview|tenant\_name={{tenant\_name}} metric=Ingress provider\_name="Microsoft.Storage" resource\_type="storageAccounts" subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} location={{location}} statistic=Total accountresourceid = \*\| quantize using sum \| sum by resource\_name|
|Azure Storage|Total read|Logs|Installed Apps/Azure Storage/Azure Storage - Operations|tenant\_name={{tenant\_name}}<br />provider\_name="Microsoft.Storage"<br />resource\_type="storageAccounts"<br />subscription\_id={{subscription\_id}}<br />resource\_group={{resource\_group}}<br />resource\_name={{resource\_name}}<br />location={{location}}<br />\*STORAGE\*<br />\| JSON "category", "properties.responseBodySize" as category, response\_body\_size<br />\| where category="StorageRead"<br />\| sum(response\_body\_size) as response\_body\_size\_bytes<br />\| response\_body\_size\_bytes/1Mi as response\_body\_size\_mb<br />\| fields response\_body\_size\_mb|
|Azure Storage|Total recommendation events|Logs|Installed Apps/Azure Storage/Azure Storage - Security and policy|tenant\_name={{tenant\_name}}<br />subscription\_id={{subscription\_id}}<br />location={{location}}<br />resource\_group={{resource\_group}}<br />resource\_name={{resource\_name}}<br />provider\_name={{provider\_name}}<br />\| JSON "category"<br />\| where category="Recommendation"<br />\| count as count by time|
|Azure Storage|Total security events|Logs|Installed Apps/Azure Storage/Azure Storage - Security and policy|tenant\_name={{tenant\_name}}<br />subscription\_id={{subscription\_id}}<br />location={{location}}<br />resource\_group={{resource\_group}}<br />resource\_name={{resource\_name}}<br />provider\_name={{provider\_name}}<br />\| JSON "category"<br />\| where category="Security"<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as time<br />\| count as count by time|
|Azure Storage|Total write|Logs|Installed Apps/Azure Storage/Azure Storage - Operations|tenant\_name={{tenant\_name}}<br />provider\_name="Microsoft.Storage"<br />resource\_type="storageAccounts"<br />subscription\_id={{subscription\_id}}<br />resource\_group={{resource\_group}}<br />resource\_name={{resource\_name}}<br />location={{location}}<br />\*STORAGE\*<br />\| json "category", "properties.requestBodySize" as category, request\_body\_size<br />\| where category="StorageWrite"<br />\| sum(request\_body\_size) as request\_body\_size\_bytes<br />\| request\_body\_size\_bytes/1Mi as request\_body\_size\_mb<br />\| fields request\_body\_size\_mb|
|Azure Storage|Transactions by location|Logs|Installed Apps/Azure Storage/Azure Storage - Access|tenant\_name={{tenant\_name}} location={{location}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| json "callerIpAddress" as callerIpAddress<br />\| where !isblank(callerIpAddress)<br />\| split callerIpAddress delim=':' extract 1 as src\_ip, 2 as port<br />\| count as ip\_count by src\_ip<br />\| lookup latitude, longitude from geo://location on ip = src\_ip<br />\| where !isNull(latitude)<br />\| sum(ip\_count) as count by latitude, longitude|
|Azure Storage|Transactions by Service Type|Metrics|Installed Apps/Azure Storage/Azure Storage - Operations|tenant\_name=\* subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name=\*{{resource\_name}}\* !(accountresourceid=\*) metric="Transactions" <br />\| count by service\_type<br />|
|Azure Storage|Transactions by Storage Account|Metrics|Installed Apps/Azure Storage/Azure Storage - Overview|tenant\_name=\* subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name=\*{{resource\_name}}\*  (accountresourceid=\*) metric="Transactions" statistic=total<br />\| quantize 15m using sum<br />\| count by resource\_name|
|Azure Storage|Transactions by TLS version|Logs|Installed Apps/Azure Storage/Azure Storage - Access|tenant\_name={{tenant\_name}} location={{location}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| json "properties.tlsVersion" as tlsVersion<br />\| count by tlsVersion|
|Azure Storage|Write|Logs|Installed Apps/Azure Storage/Azure Storage - Table Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}}<br />\*STORAGE\*<br />\| JSON "category", "properties.requestBodySize" as category, request\_body\_size<br />\| where category="StorageWrite" and service\_type="TABLESERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?:Tables\\(')?(?\<table\_name\>[a-zA-Z0-9]\*)" nodrop <br />\| parse regex field=objectKey "/(?:[^/]+)/(?\<table\_name\_in\_object\>[^/]+)" nodrop <br />\| if (isBlank(table\_name), table\_name\_in\_object, table\_name) as table\_name<br />\| where table\_name matches "{{table\_name}}"<br />\| sum(request\_body\_size) as request\_body\_size\_bytes<br />\| request\_body\_size\_bytes/1Mi as request\_body\_size\_mb<br />\| fields request\_body\_size\_mb|
|Azure Storage|Write|Logs|Installed Apps/Azure Storage/Azure Storage - Blob Service|tenant\_name={{tenant\_name}} location={{location}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri","category", "properties.requestBodySize" as uri, category, request\_body\_size nodrop<br />\| where category="StorageWrite" and service\_type="BLOBSERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<container\_name\>[\$a-zA-Z0-9-]+)(?\<blob\_file\_path\>[^?]+\|\$)?" nodrop<br />\| where container\_name matches "{{container\_name}}"<br />\| if (isBlank(request\_body\_size), 0, request\_body\_size) as request\_body\_size<br />\| sum(request\_body\_size) as request\_body\_size\_bytes<br />\| request\_body\_size\_bytes/1Mi as request\_body\_size\_mb<br />\| fields request\_body\_size\_mb|
|Azure Storage|Write|Logs|Installed Apps/Azure Storage/Azure Storage - File Service|tenant\_name={{tenant\_name}} location={{location}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "properties.requestBodySize" as uri, category, request\_body\_size<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<file\_share\>[a-zA-Z0-9-]\*)(?\<file\_path\>[^?]\*\|\$)?" nodrop<br />\| where category="StorageWrite" and service\_type="FILESERVICES" and file\_share matches "{{file\_share}}"<br />\| sum(request\_body\_size) as request\_body\_size\_bytes<br />\| request\_body\_size\_bytes/1Mi as request\_body\_size\_mb<br />\| fields request\_body\_size\_mb|
|Azure Storage|Write|Logs|Installed Apps/Azure Storage/Azure Storage - Queue Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "properties.requestBodySize", "properties.objectKey" as uri, category, request\_body\_size, objectKey<br />\| where category="StorageWrite" and service\_type="QUEUESERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<queue\_name\>[a-zA-Z0-9-]\*)" nodrop<br />\| parse regex field=objectKey "/(?:[^/]+)/(?\<queue\_name\_in\_object\>[^/]+)" nodrop <br />\| if (isBlank(queue\_name), queue\_name\_in\_object, queue\_name) as queue\_name<br />\| where queue\_name matches "{{queue\_name}}"<br />\| sum(request\_body\_size) as request\_body\_size\_bytes<br />\| request\_body\_size\_bytes/1Mi as request\_body\_size\_mb<br />\| fields request\_body\_size\_mb|
|Azure Storage|Writes by Container Name|Logs|Installed Apps/Azure Storage/Azure Storage - Blob Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri","category", "properties.responseBodySize" as uri, category, response\_body\_size<br />\| where category="StorageWrite" and service\_type="BLOBSERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<container\_name\>[\$a-zA-Z0-9-]+)(?\<blob\_file\_path\>[^?]+\|\$)?" nodrop<br />\| where container\_name matches "{{container\_name}}"<br />\| timeslice 15m<br />\| sum(response\_body\_size) as response\_body\_size\_bytes by container\_name, \_timeslice<br />\| transpose row \_timeslice column container\_name|
|Azure Storage|Writes by File Share|Logs|Installed Apps/Azure Storage/Azure Storage - File Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "statusText", "properties.requestBodySize", "properties.objectKey" as uri, category, statusText, request\_body\_size, objectKey<br />\| where category="StorageWrite" and service\_type="FILESERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<file\_share\>[a-zA-Z0-9-]\*)(?\<file\_path\>[^?]\*\|\$)?" nodrop<br />\| where file\_share matches "{{file\_share}}"<br />\| timeslice 15m<br />\| sum(request\_body\_size) as request\_body\_size\_bytes by file\_share, \_timeslice<br />\| transpose row \_timeslice column file\_share|
|Azure Storage|Writes by Queue Name|Logs|Installed Apps/Azure Storage/Azure Storage - Queue Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "uri", "category", "properties.objectKey", "properties.requestBodySize" as uri, category, objectKey, request\_body\_size<br />\| where category="StorageWrite" and service\_type="QUEUESERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?\<queue\_name\>[a-zA-Z0-9-]\*)" nodrop<br />\| parse regex field=objectKey "/(?:[^/]+)/(?\<queue\_name\_in\_object\>[^/]+)" nodrop <br />\| if (isBlank(queue\_name), queue\_name\_in\_object, queue\_name) as queue\_name<br />\| where queue\_name matches "{{queue\_name}}"<br />\| timeslice 15m<br />\| sum(request\_body\_size) as request\_body\_size\_bytes by queue\_name, \_timeslice<br />\| transpose row \_timeslice column queue\_name|
|Azure Storage|Writes by Table Name|Logs|Installed Apps/Azure Storage/Azure Storage - Table Service|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} provider\_name="Microsoft.Storage" resource\_type="storageAccounts" resource\_name={{resource\_name}} \*STORAGE\*<br />\| JSON "category", "properties.requestBodySize" as category, request\_body\_size<br />\| where category="StorageWrite" and service\_type="TABLESERVICES"<br />\| parse regex field=uri "https?://(?\<storagedomain\>[^/]+)/(?:Tables\\(')?(?\<table\_name\>[a-zA-Z0-9]\*)" nodrop <br />\| parse regex field=objectKey "/(?:[^/]+)/(?\<table\_name\_in\_object\>[^/]+)" nodrop <br />\| if (isBlank(table\_name), table\_name\_in\_object, table\_name) as table\_name<br />\| where table\_name matches "{{table\_name}}"<br />\| timeslice 15m<br />\| sum(request\_body\_size) as request\_body\_size by table\_name, \_timeslice<br />\| transpose row \_timeslice column table\_name|

