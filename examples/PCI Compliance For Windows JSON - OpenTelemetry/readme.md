# PCI Compliance For Windows JSON - OpenTelemetry

## Searches

### Log Searches

- **Actions by Privileged Accounts**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **All Windows Updates**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 06 - Windows Updates Activity 
- **Default Login - Failure**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 10 - Login Activity 
- **Default Login - Success**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 10 - Login Activity 
- **Excessive Failed Access Attempts**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 08 - Other User Activity 
- **Failed Logins**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 10 - Login Activity 
- **Failed Logins**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 10 - Login Activity 
- **Policy Changes**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **Recent Windows Update Failures**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 06 - Windows Updates Activity 
- **Service Execution Trend**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **Service Stopped**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **Successful Logins**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 10 - Login Activity 
- **Sucessful Logins**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 10 - Login Activity 
- **System Restarted**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **System Time Change**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **Tampering Audit Logs**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **User Account Changed**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 08 - Other User Activity 
- **User Account Created**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **User Account Deleted**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **User Account Disabled**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **User Account Disabled, Not Deleted Over 1 Day**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **User Account Enabled**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **User Account Enabled, not Logged in over 1 Day**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 08 - Other User Activity 
- **User Account Locked Out**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **User Account Logged Off**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **User Account Password Changes**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 08 - Other User Activity 
- **User Account Password Reset**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 08 - Other User Activity 
- **Windows Update Summary**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 06 - Windows Updates Activity 
- **Windows Update Summary by Host**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 06 - Windows Updates Activity 
- **Windows Update Trend**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 06 - Windows Updates Activity

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|PCI Compliance For Windows JSON - OpenTelemetry|Actions by Privileged Accounts|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"Security\\""<br />\| json "event\_id.id", "computer", "message", "event\_data" as event\_id, host, msg\_summary, event\_data nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where (touppercase(src\_user) in ("ROOT", "ADMIN", "ADMINISTRATOR")) or (touppercase(dest\_user) in ("ROOT", "ADMIN", "ADMINISTRATOR"))<br />\| where event\_id matches "{{event\_id}}" and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| src\_user as %"Source User" \| dest\_user as %"Target User" \| host as %"Target Host" <br />\| fields event\_id, msg\_summary, src\_host, %"Source User", %"Target Host", %"Target User"<br />\| count as event\_count by event\_id, %"Source User", %"Target Host", %"Target User" <br />\| sort by event\_count, event\_id asc|
|PCI Compliance For Windows JSON - OpenTelemetry|All Windows Updates|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 06 - Windows Updates Activity|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"System\\"" (19 or 20)<br />\| json "event\_id.id", "computer", "message", "event\_data" as event\_id, host, msg\_summary, event\_data nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop<br />\| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as error\_code, Update nodrop<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id in ("19", "20") and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| if(msg\_summary matches "Installation Failure\*", "Update/Failure", if (msg\_summary matches "Installation Successful\*", "Update/Success", "Update/Attempt")) as %"Installation Status"<br />\| fields -\_raw <br />\| host as %"Destination Host"<br />\| parse field=Update "(\*)" as kbnum nodrop <br />\| timeslice 1s<br />\| count by \_timeslice, %"Destination Host", update, %"Installation Status", error\_code, src\_user, src\_domain, event\_id, kbnum|
|PCI Compliance For Windows JSON - OpenTelemetry|Default Login - Failure|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 10 - Login Activity|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"Security\\"" (4771 or 4776 or 4768 or 4769 or 4625) "Audit Failure"<br />\| json "event\_id.id", "computer", "message", "event\_data", "channel", "keywords" as event\_id, host, msg\_summary,event\_data, channel, Keywords nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| parse field=event\_data "\\"IpAddress\\":\\"\*\\"" as src\_ip<br />\| parse field=event\_data "\\"IpPort\\":\\"\*\\"" as src\_port<br />\| parse field=event\_data "\\"LogonType\\":\\"\*\\"" as logon\_type<br />\| parse field=event\_data "\\"WorkstationName\\":\\"\*\\"" as src\_host<br />\| parse field=event\_data "\\"Status\\":\\"\*\\"" as status<br />\| parse field=event\_data "\\"SubStatus\\":\\"\*\\"" as sub\_status<br />\| status as result\_code<br />\| sub\_status as failure\_code<br />\| json "details.Failure Information.Failure Reason" as failure\_reason<br />\| where (event\_id in ("4625", "4771") or (event\_id = "4768" and result\_code != "0x0") or (event\_id = "4769" and failure\_code != "0x0") or (event\_id = "4776" and status != "0x0")) and (((touppercase(src\_user) in ("ROOT", "ADMIN", "ADMINISTRATOR", "DBSNMP", "SYS", "SYSMAN", "SYSTEM", "CISCO15", "SADMIN", "CISCO", "NETSCREEN")) or (touppercase(dest\_user) in ("ROOT", "ADMIN", "ADMINISTRATOR", "DBSNMP", "SYS", "SYSMAN", "SYSTEM", "CISCO15", "SADMIN", "CISCO", "NETSCREEN"))))<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and host matches "{{host.name}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, msg\_summary, event\_id, result\_code, failure\_code, failure\_reason<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON - OpenTelemetry|Default Login - Success|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 10 - Login Activity|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}}<br />"\\"channel\\":\\"Security\\"" 4624 <br />\| json "event\_id.id", "computer", "message", "keywords", "event\_data", "channel", "level" as event\_id, host, msg\_summary, Keywords, event\_data, channel, level nodrop<br />\| json "event\_id.id", "computer", "message", "event\_data", "channel", "keywords" as event\_id, host, msg\_summary,event\_data, channel, Keywords nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| parse field=event\_data "\\"IpAddress\\":\\"\*\\"" as src\_ip<br />\| parse field=event\_data "\\"IpPort\\":\\"\*\\"" as src\_port<br />\| parse field=event\_data "\\"LogonType\\":\\"\*\\"" as logon\_type<br />\| parse field=event\_data "\\"WorkstationName\\":\\"\*\\"" as src\_host<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id = "4624" and ((touppercase(src\_user) in ("ROOT", "ADMIN", "ADMINISTRATOR", "DBSNMP", "SYS", "SYSMAN", "SYSTEM", "CISCO15", "SADMIN", "CISCO", "NETSCREEN")) or (touppercase(dest\_user) in ("ROOT", "ADMIN", "ADMINISTRATOR", "DBSNMP", "SYS", "SYSMAN", "SYSTEM", "CISCO15", "SADMIN", "CISCO", "NETSCREEN")))<br />\| where \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and host matches "{{host.name}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}" <br />\| fields host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, event\_id, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, msg\_summary, event\_id<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON - OpenTelemetry|Excessive Failed Access Attempts|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 08 - Other User Activity|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"Security\\"" (4771 or 4776 or 4768 or 4769 or 4625) "Audit Failure"<br />\| json "event\_id.id", "computer", "message", "event\_data", "channel", "keywords" as event\_id, host, msg\_summary,event\_data, channel, Keywords nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| parse field=event\_data "\\"LogonType\\":\\"\*\\"" as logon\_type nodrop<br />\| parse field=event\_data "\\"IpAddress\\":\\"\*\\"" as src\_ip<br />\| parse field=event\_data "\\"IpPort\\":\\"\*\\"" as src\_port<br />\| parse field=event\_data "\\"WorkstationName\\":\\"\*\\"" as src\_host<br />\| parse field=event\_data "\\"Status\\":\\"\*\\"" as status<br />\| parse field=event\_data "\\"SubStatus\\":\\"\*\\"" as sub\_status<br />\| json "details.Failure Information.Failure Reason" as failure\_reason<br />\| status as result\_code<br />\| sub\_status as failure\_code<br />\| where (event\_id in ("4625", "4771") or (event\_id = "4768" and result\_code != "0x0") or (event\_id = "4769" and failure\_code != "0x0") or (event\_id = "4776" and result\_code != "0x0"))<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}" <br />\| timeslice 5m<br />\| count as attempts by \_timeslice, src\_host, src\_user, src\_domain, dest\_user, dest\_domain<br />\| format("Excessive (%d) login failures observed", attempts) as message<br />\| "{{excessive\_failed\_attempts}}" as threshold<br />\| where attempts \> threshold<br />\| sort by \_timeslice, attempts<br />\| fields -threshold, attempts|
|PCI Compliance For Windows JSON - OpenTelemetry|Failed Logins|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 10 - Login Activity|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"Security\\"" (4771 or 4776 or 4768 or 4769 or 4625) "Audit Failure"<br />\| json "event\_id.id", "computer", "message", "event\_data", "channel", "keywords" as event\_id, host, msg\_summary,event\_data, channel, Keywords nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| parse field=event\_data "\\"IpAddress\\":\\"\*\\"" as src\_ip<br />\| parse field=event\_data "\\"IpPort\\":\\"\*\\"" as src\_port<br />\| parse field=event\_data "\\"LogonType\\":\\"\*\\"" as logon\_type<br />\| parse field=event\_data "\\"WorkstationName\\":\\"\*\\"" as src\_host<br />\| parse field=event\_data "\\"Status\\":\\"\*\\"" as status<br />\| parse field=event\_data "\\"SubStatus\\":\\"\*\\"" as sub\_status<br />\| status as result\_code<br />\| sub\_status as failure\_code<br />\| json "details.Failure Information.Failure Reason" as failure\_reason<br />\| where (event\_id in ("4625", "4771") or (event\_id = "4768" and result\_code != "0x0") or (event\_id = "4769" and failure\_code != "0x0") or (event\_id = "4776" and result\_code != "0x0"))<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and host matches "{{host.name}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}" <br />\| fields host, dest\_user, dest\_domain, src\_host, src\_ip, src\_port, src\_user, src\_domain, logon\_type, result\_code, failure\_code, failure\_reason, event\_id, msg\_summary<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, msg\_summary, event\_id, result\_code, failure\_code, failure\_reason<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON - OpenTelemetry|Failed Logins|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 10 - Login Activity|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"Security\\"" (4771 or 4776 or 4768 or 4769 or 4625) "Audit Failure"<br />\| json "event\_id.id", "computer", "message", "event\_data", "channel", "keywords" as event\_id, host, msg\_summary,event\_data, channel, Keywords nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| parse field=event\_data "\\"IpAddress\\":\\"\*\\"" as src\_ip<br />\| parse field=event\_data "\\"IpPort\\":\\"\*\\"" as src\_port<br />\| parse field=event\_data "\\"LogonType\\":\\"\*\\"" as logon\_type<br />\| parse field=event\_data "\\"WorkstationName\\":\\"\*\\"" as src\_host<br />\| parse field=event\_data "\\"Status\\":\\"\*\\"" as status<br />\| parse field=event\_data "\\"SubStatus\\":\\"\*\\"" as sub\_status<br />\| status as result\_code<br />\| sub\_status as failure\_code<br />\| json "details.Failure Information.Failure Reason" as failure\_reason<br />\| where (event\_id in ("4625", "4771") or (event\_id = "4768" and result\_code != "0x0") or (event\_id = "4769" and failure\_code != "0x0") or (event\_id = "4776" and result\_code != "0x0"))<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and host matches "{{host.name}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}" <br />\| fields host, dest\_user, dest\_domain, src\_host, src\_ip, src\_port, src\_user, src\_domain, logon\_type, result\_code, failure\_code, failure\_reason, event\_id, msg\_summary<br />\| count as event\_count|
|PCI Compliance For Windows JSON - OpenTelemetry|Policy Changes|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} ("\\"channel\\":\\"System\\"" or "\\"channel\\":\\"Security\\"") ("Audit Policy Change" or "System audit policy was changed" or \*policy\*change\*)<br />\| json "event\_id.id", "computer", "message", "event\_data", "keywords" as event\_id, host, msg\_summary, event\_data, msg\_type nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| where event\_id matches "{{event\_id}}" and event\_id in ("4902", "4904", "4905", "4906", "4907", "4912", "4715", "4717", "4719" ) or msg\_summary="System audit policy was changed" or msg\_summary matches "\*policy\*change\*" or msg\_summary matches "\*Policy\*Change\*"<br />\| if (msg\_type matches "\*Success","Change/Configuration/Policy/Success", if (msg\_type matches "\*Fail\*", "Change/Configuration/Policy/Failure", "Change/Configuration/Policy/Attempt")) as classification<br />\| fields host, src\_user, src\_domain, classification, event\_id, msg\_summary, msg\_type<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, src\_user, src\_domain, classification, event\_id, msg\_summary, msg\_type<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON - OpenTelemetry|Recent Windows Update Failures|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 06 - Windows Updates Activity|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"System\\"" (19 or 20)<br />\| json "event\_id.id", "computer", "message", "event\_data" as event\_id, host, msg\_summary, event\_data nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop<br />\| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as error\_code, Update nodrop<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id in ("19", "20") and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| if(msg\_summary matches "Installation Failure\*", "Update/Failure", if (msg\_summary matches "Installation Successful\*", "Update/Success", "Update/Attempt")) as %"Installation Status"<br />\| fields -\_raw<br />\| host as %"Destination Host"<br />\| timeslice 1s<br />\| withtime %"Installation Status" <br />\| most\_recent(%"Installation Status\_withtime") as %"LastStatus" by %"Destination Host", update, \_timeslice<br />\| parse field=Update "(\*)" as kbnum nodrop<br />\| where %"LastStatus"="Update/Failure"|
|PCI Compliance For Windows JSON - OpenTelemetry|Service Execution Trend|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"System\\"" 7036<br />\| json "event\_id.id", "computer", "message", "event\_data" as event\_id, host, msg\_summary,event\_data nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse regex field=msg\_summary "The (?\<service\>\\w.+?) service entered the (?\<state\>\\w+) state" nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| where event\_id = "7036" and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" <br />\| fields event\_id, host, msg\_summary, service, state<br />\| timeslice 1h <br />\| count by \_timeslice, service<br />\| transpose row \_timeslice column service|
|PCI Compliance For Windows JSON - OpenTelemetry|Service Stopped|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"System\\"" 7036 "stopped state"<br />\| json "event\_id.id", "computer", "message", "event\_data" as event\_id, host, msg\_summary, event\_data nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse regex field=msg\_summary "The (?\<service\>\\w.+?) service entered the (?\<state\>\\w+) state" nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| where event\_id = "7036" and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}"<br />\| count as event\_count, first(\_messagetime) as latest, last(\_messagetime) as earliest by service, host, state \| latest as \_timeslice<br />\| fields \_timeslice, host, service, state, latest, earliest, event\_count<br />\| where state = "stopped"<br />\| formatDate(fromMillis(latest),"yyyy/MM/dd HH:mm:ss Z") as %"Latest Time" <br />\| formatDate(fromMillis(earliest),"yyyy/MM/dd HH:mm:ss Z") as %"Earliest Time" <br />\| fields -latest, earliest<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON - OpenTelemetry|Successful Logins|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 10 - Login Activity|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"Security\\"" 4624 <br />\| json "event\_id.id", "computer", "message", "keywords", "event\_data", "channel", "level" as event\_id, host, msg\_summary, Keywords, event\_data, channel, level nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| parse field=event\_data "\\"IpAddress\\":\\"\*\\"" as src\_ip<br />\| parse field=event\_data "\\"IpPort\\":\\"\*\\"" as src\_port<br />\| parse field=event\_data "\\"WorkstationName\\":\\"\*\\"" as src\_host<br />\| parse field=event\_data "\\"LogonType\\":\\"\*\\"" as logon\_type<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id = "4624" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and host matches "{{host.name}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}" <br />\| fields host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, event\_id, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, msg\_summary, event\_id<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON - OpenTelemetry|Sucessful Logins|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 10 - Login Activity|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"Security\\"" 4624 <br />\| json "event\_id.id", "computer", "message", "keywords", "event\_data", "channel", "level" as event\_id, host, msg\_summary, Keywords, event\_data, channel, level nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| parse field=event\_data "\\"IpAddress\\":\\"\*\\"" as src\_ip<br />\| parse field=event\_data "\\"IpPort\\":\\"\*\\"" as src\_port<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id = "4624" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and host matches "{{host.name}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}" <br />\| fields host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, event\_id, msg\_summary<br />\| count as event\_count|
|PCI Compliance For Windows JSON - OpenTelemetry|System Restarted|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"Security\\"" 4608<br />\| json "event\_id.id", "computer", "message" as event\_id, host, msg\_summary nodrop<br />\| where event\_id = "4608" and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}"<br />\| fields host, msg\_summary, event\_id<br />\| timeslice 15m<br />\| count as event\_count by \_timeslice, host, msg\_summary, event\_id<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON - OpenTelemetry|System Time Change|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} (("\\"channel\\":\\"System\\"" or "\\"channel\\":\\"Security\\"") (35 or 37 or 4616))<br />\| json "event\_id.id", "computer", "message", "event\_data" as event\_id, host, msg\_summary, event\_data nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| where event\_id matches "{{event\_id}}" and event\_id in ("4616", "35", "37") and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}"<br />\| if (msg\_summary="The system time was changed" and src\_user \<\> "LOCAL SERVICE" and src\_domain \<\> "NT AUTHORITY", "Critical", "Low") as severity<br />\| fields host, src\_user, src\_domain, severity, event\_id, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, src\_user, src\_domain, severity, event\_id, msg\_summary<br />\| sort by severity asc, \_timeslice|
|PCI Compliance For Windows JSON - OpenTelemetry|Tampering Audit Logs|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} ("\\"channel\\":\\"System\\"" or "\\"channel\\":\\"Security\\"") (1102 or 517 or 104)<br />\| json "event\_id.id", "computer", "message" as event\_id, host, msg\_summary nodrop<br />\| json "details.Subject.Logon ID", "details.Subject.Domain Name" as src\_user, src\_domain nodrop<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| where event\_id in ("1102", "517", "104") and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}"<br />\| fields host, src\_user, src\_domain, event\_id, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, src\_user, src\_domain, event\_id, msg\_summary<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON - OpenTelemetry|User Account Changed|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 08 - Other User Activity|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"Security\\"" 4738<br />\| json "event\_id.id", "computer", "message", "event\_data" as event\_id, host, msg\_summary,event\_data nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id = "4738" and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, src\_user, src\_domain, dest\_user, dest\_domain, msg\_summary, event\_id<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON - OpenTelemetry|User Account Created|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"Security\\"" 4720<br />\| json "event\_id.id", "computer", "message", "event\_data" as event\_id, host, msg\_summary, event\_data nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id = "4720" and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| fields host, dest\_user, dest\_domain, src\_user, src\_domain, event\_id, msg\_summary<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, dest\_user, dest\_domain, src\_user, src\_domain, event\_id, msg\_summary<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON - OpenTelemetry|User Account Deleted|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"Security\\"" 4726<br />\| json "event\_id.id", "computer", "message", "event\_data" as event\_id, host, msg\_summary, event\_data nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id = "4726" and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| fields host, dest\_user, dest\_domain, src\_user, src\_domain, event\_id, msg\_summary<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, dest\_user, dest\_domain, src\_user, src\_domain, event\_id, msg\_summary<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON - OpenTelemetry|User Account Disabled|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"Security\\"" 4725<br />\| json "event\_id.id", "computer", "message", "event\_data" as event\_id, host, msg\_summary, event\_data nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id = "4725" and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| fields host, dest\_user, dest\_domain, src\_user, src\_domain, event\_id, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, dest\_user, dest\_domain, src\_user, src\_domain, event\_id, msg\_summary<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON - OpenTelemetry|User Account Disabled, Not Deleted Over 1 Day|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"Security\\"" (4726 or 4725)<br />\| json "event\_id.id", "computer", "message", "event\_data" as event\_id, host, msg\_summary, event\_data nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id in ("4725", "4726") and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"  <br />\| withtime msg\_summary \| withtime \_messagetime<br />\| most\_recent(msg\_summary\_withtime) as action, most\_recent(\_messagetime\_withtime) as m\_time by host, dest\_user<br />\| formatDate(fromMillis(m\_time), "MM-dd-yyyy HH:mm:ss:SSS z") as event\_time<br />\| 1000\*60\*60\*24 as Oneday<br />\| 1 as threshold <br />\| num(threshold) as threshold<br />\| ((toMillis(now())-m\_time)/oneday) as since\_days \| format("%.2f", since\_days) as since\_days\_str<br />\| concat ("User account was disabled ", since\_days\_str, " days ago, but not yet deleted.") as Remark<br />\| where !(action matches "\*user account was deleted\*")<br />\| where since\_days \>= threshold<br />\| sort by since\_days<br />\| fields - m\_time, Oneday, since\_days\_str, action, since\_days, threshold|
|PCI Compliance For Windows JSON - OpenTelemetry|User Account Enabled|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"Security\\"" 4722<br />\| json "event\_id.id", "computer", "message", "event\_data" as event\_id, host, msg\_summary,event\_data nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id = "4722" and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| fields host, dest\_user, dest\_domain, src\_user, src\_domain, event\_id, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, dest\_user, dest\_domain, src\_user, src\_domain, event\_id, msg\_summary<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON - OpenTelemetry|User Account Enabled, not Logged in over 1 Day|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 08 - Other User Activity|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"Security\\"" (4722 or 4624)<br />\| json "event\_id.id", "computer", "message", "event\_data" as event\_id, host, msg\_summary, event\_data nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id in ("4722", "4624") and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}" <br />\| withtime msg\_summary \| withtime \_messagetime<br />\| most\_recent(msg\_summary\_withtime) as action, most\_recent(\_messagetime\_withtime) as m\_time by host, dest\_user<br />\| formatDate(fromMillis(m\_time), "MM-dd-yyyy HH:mm:ss:SSS z") as event\_time<br />\| 1000\*60\*60\*24 as Oneday<br />\| 1 as threshold <br />\| num(threshold) as threshold<br />\| ((toMillis(now())-m\_time)/oneday) as since\_days \| format("%.2f", since\_days) as since\_days\_str<br />\| concat ("User account was enabled ", since\_days\_str, " days ago, but not yet logged in.") as Remark<br />\| where !(action matches "\*account was successfully logged on\*")<br />\| where since\_days \>= threshold<br />\| sort by since\_days<br />\| fields - m\_time, Oneday, since\_days\_str, action, since\_days, threshold|
|PCI Compliance For Windows JSON - OpenTelemetry|User Account Locked Out|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"Security\\"" 4740<br />\| json "event\_id.id", "computer", "message", "event\_data" as event\_id, host, msg\_summary, event\_data nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id in ("4740") and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| fields host, dest\_user, src\_user, src\_domain, event\_id, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, dest\_user, src\_user, src\_domain, event\_id, msg\_summary<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON - OpenTelemetry|User Account Logged Off|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"Security\\"" 4634<br />\| json "event\_id.id", "computer", "message", "event\_data" as event\_id, host, msg\_summary, event\_data nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user <br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id in ("4634") and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| fields host, dest\_user, src\_user, src\_domain, event\_id, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, dest\_user, src\_user, src\_domain, event\_id, msg\_summary<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON - OpenTelemetry|User Account Password Changes|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 08 - Other User Activity|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}}  "\\"channel\\":\\"Security\\"" 4723<br />\| json "event\_id.id", "computer", "message", "event\_data" as event\_id, host, msg\_summary,event\_data nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id in ("4723") and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, dest\_user, dest\_domain, src\_user, src\_domain, msg\_summary, event\_id<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON - OpenTelemetry|User Account Password Reset|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 08 - Other User Activity|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"Security\\"" 4724<br />\| json "event\_id.id", "computer", "message", "event\_data" as event\_id, host, msg\_summary,event\_data  nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id = "4724" and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}" <br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, dest\_user, dest\_domain, src\_user, src\_domain, msg\_summary, event\_id<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON - OpenTelemetry|Windows Update Summary|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 06 - Windows Updates Activity|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"System\\"" (19 or 20)<br />\| json "event\_id.id", "computer", "message", "event\_data" as event\_id, host, msg\_summary, event\_data nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop<br />\| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as error\_code, Update nodrop<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id in ("19", "20") and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| if(msg\_summary matches "Installation Failure\*", "Update/Failure", if (msg\_summary matches "Installation Successful\*", "Update/Success", "Update/Attempt")) as %"Installation Status"<br />\| fields -\_raw<br />\| host as %"Destination Host"<br />\| timeslice 1s<br />\| withtime %"Installation Status" <br />\| most\_recent(%"Installation Status\_withtime") as %"LastStatus" by %"Destination Host", update, \_timeslice<br />\| parse field=Update "(\*)" as kbnum nodrop<br />\| count\_distinct(%"Destination Host") as %"Hosts" by LastStatus, update<br />\| transpose row update column LastStatus|
|PCI Compliance For Windows JSON - OpenTelemetry|Windows Update Summary by Host|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 06 - Windows Updates Activity|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"System\\"" (19 or 20)<br />\| json "event\_id.id", "computer", "message", "event\_data" as event\_id, host, msg\_summary, event\_data nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop<br />\| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as error\_code, Update nodrop<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id in ("19", "20") and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| if(msg\_summary matches "Installation Failure\*", "Update/Failure", if (msg\_summary matches "Installation Successful\*", "Update/Success", "Update/Attempt")) as %"Installation Status"<br />\| fields -\_raw<br />\| host as %"Destination Host"<br />\| timeslice 1s<br />\| withtime %"Installation Status" <br />\| most\_recent(%"Installation Status\_withtime") as %"LastStatus" by %"Destination Host", update, \_timeslice<br />\| parse field=Update "(\*)" as kbnum nodrop<br />\| count by %"Destination Host", %"LastStatus"<br />\| transpose row %"Destination Host" column %"LastStatus"|
|PCI Compliance For Windows JSON - OpenTelemetry|Windows Update Trend|Logs|Installed Apps/PCI Compliance For Windows JSON - OpenTelemetry/Windows - PCI Req 06 - Windows Updates Activity|sumo.datasource=windows deployment.environment={{deployment.environment}} host.group={{host.group}} "\\"channel\\":\\"System\\"" (19 or 20)<br />\| json "event\_id.id", "computer", "message", "event\_data" as event\_id, host, msg\_summary, event\_data nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user nodrop<br />\| parse field=event\_data "\\"SubjectDomainName\\":\\"\*\\"" as src\_domain nodrop<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user nodrop<br />\| parse field=event\_data "\\"TargetDomainName\\":\\"\*\\"" as dest\_domain nodrop<br />\| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop<br />\| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as error\_code, Update nodrop<br />\| if(isBlank(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isBlank(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isBlank(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isBlank(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id in ("19", "20") and host matches "{{host.name}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| if(msg\_summary matches "Installation Failure\*", "Update/Failure", if (msg\_summary matches "Installation Successful\*", "Update/Success", "Update/Attempt")) as %"Installation Status"<br />\| fields -\_raw<br />\| host as %"Destination Host"<br />\| timeslice 1s<br />\| withtime %"Installation Status" <br />\| most\_recent(%"Installation Status\_withtime") as %"LastStatus" by %"Destination Host", update, \_timeslice<br />\| parse field=Update "(\*)" as kbnum nodrop<br />\| count\_distinct(%"Destination Host") by LastStatus, \_timeslice<br />\| transpose row \_timeslice column LastStatus|

