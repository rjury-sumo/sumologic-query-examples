# AWS EKS - Control Plane

## Searches

### Log Searches

- **Access Granted by Users**: from Dashboard: AWS EKS - Control Plane/EKS - Authenticator 
- **Error Logs**: from Dashboard: AWS EKS - Control Plane/EKS - Controller Manager 
- **Error Logs**: from Dashboard: AWS EKS - Control Plane/EKS - API Server 
- **Error Messages**: from Dashboard: AWS EKS - Control Plane/EKS - Scheduler 
- **Errors**: from Dashboard: AWS EKS - Control Plane/EKS - Authenticator 
- **Failure Rate**: from Dashboard: AWS EKS - Control Plane/EKS - API Server Audit 
- **Failures by Reason and Namespace**: from Dashboard: AWS EKS - Control Plane/EKS - API Server Audit 
- **Job Creations**: from Dashboard: AWS EKS - Control Plane/EKS - Controller Manager 
- **Job Deletions**: from Dashboard: AWS EKS - Control Plane/EKS - Controller Manager 
- **Logs**: from Dashboard: AWS EKS - Control Plane/EKS - Authenticator 
- **Most Active Users**: from Dashboard: AWS EKS - Control Plane/EKS - API Server Audit 
- **Non-200 Total Count**: from Dashboard: AWS EKS - Control Plane/EKS - API Server Audit 
- **Pods Created**: from Dashboard: AWS EKS - Control Plane/EKS - Controller Manager 
- **Pods Deleted**: from Dashboard: AWS EKS - Control Plane/EKS - Controller Manager 
- **Requests by Audit Policy**: from Dashboard: AWS EKS - Control Plane/EKS - API Server Audit 
- **Requests by Stage**: from Dashboard: AWS EKS - Control Plane/EKS - API Server Audit 
- **Scale Operations**: from Dashboard: AWS EKS - Control Plane/EKS - Controller Manager 
- **Severity Breakdown**: from Dashboard: AWS EKS - Control Plane/EKS - API Server 
- **Severity Breakdown**: from Dashboard: AWS EKS - Control Plane/EKS - Scheduler 
- **Severity Over Time**: from Dashboard: AWS EKS - Control Plane/EKS - API Server 
- **Severity Over Time**: from Dashboard: AWS EKS - Control Plane/EKS - Scheduler 
- **Severity Over Time**: from Dashboard: AWS EKS - Control Plane/EKS - Controller Manager 
- **Status Code Trend**: from Dashboard: AWS EKS - Control Plane/EKS - API Server Audit 
- **Top 10 URLS with Problem Status Codes**: from Dashboard: AWS EKS - Control Plane/EKS - API Server Audit 
- **Top Failure Reasons**: from Dashboard: AWS EKS - Control Plane/EKS - API Server Audit 
- **Top URLS with Non-200**: from Dashboard: AWS EKS - Control Plane/EKS - API Server Audit 
- **Top Users by Failures**: from Dashboard: AWS EKS - Control Plane/EKS - API Server Audit

### Metric Searches

- **API Server Request Latency By Method**: from Dashboard: AWS EKS - Control Plane/EKS - API Server 
- **Api Server Request Rates by  Clients**: from Dashboard: AWS EKS - Control Plane/EKS - API Server 
- **API Server Successful Request Rates**: from Dashboard: AWS EKS - Control Plane/EKS - API Server 
- **API Server Successful vs Failure Request Rates**: from Dashboard: AWS EKS - Control Plane/EKS - API Server

## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|AWS EKS - Control Plane|Access Granted by Users|Logs|AWS EKS - Control Plane/EKS - Authenticator|\_sourceCategory = \*eks\* "access granted"<br /> and \_sourceName = \*authenticator\*<br />\| json field=\_raw "message" as log<br />\| parse field=log "msg=\\"\*\\"" as err\_msg<br />\| parse field=log "username=\\"\*\\"" as username<br />\| count by username<br />\| sort by \_count|
|AWS EKS - Control Plane|API Server Request Latency By Method|Metrics|AWS EKS - Control Plane/EKS - API Server|\_origin=kubernetes  metric=apiserver\_request\_latencies\_count  cluster={{cluster}}\| quantize 5m \| rate \| sum by verb|
|AWS EKS - Control Plane|Api Server Request Rates by  Clients|Metrics|AWS EKS - Control Plane/EKS - API Server|\_origin=kubernetes  cluster={{cluster}}  (metric=apiserver\_request\_total or metric=apiserver\_request\_count) \| quantize 5m \| rate \| sum by client|
|AWS EKS - Control Plane|API Server Successful Request Rates|Metrics|AWS EKS - Control Plane/EKS - API Server|\_origin=kubernetes   cluster={{cluster}} (metric=apiserver\_request\_total or metric=apiserver\_request\_count) code=2\*  \| quantize 5m \| rate \| sum by cluster|
|AWS EKS - Control Plane|API Server Successful vs Failure Request Rates|Metrics|AWS EKS - Control Plane/EKS - API Server|\_origin=kubernetes   cluster={{cluster}} (metric=apiserver\_request\_total or metric=apiserver\_request\_count) !code=2\*  \| quantize 5m \| rate \| sum by cluster|
|AWS EKS - Control Plane|Error Logs|Logs|AWS EKS - Control Plane/EKS - API Server|\_sourceCategory = \*eks\* (error OR warning)<br />AND \_sourceName = kube-api\* AND !\_sourceName = kube-apiserver-audit\*<br />\| json field=\_raw "message" as log<br />\| parse regex field=log "^^(?\<severity\>.)(?:[0-9])(?:.\*\\])\\s(?\<log\_msg\>.\*)"<br />\| where severity == "E"<br />\| formatDate(\_messageTime,"MM-dd-yyyy HH:mm") as MessageTime<br />\| count by MessageTime,severity,log\_msg|
|AWS EKS - Control Plane|Error Logs|Logs|AWS EKS - Control Plane/EKS - Controller Manager|\_sourceCategory = \*eks\* error<br />\| json field=\_raw "message"<br />\| parse regex field=message "^(?\<severity\>.)(?:[0-9])"<br />\| where severity == "E"<br />\| formatDate(\_messageTime,"MM-dd-yyyy HH:mm") as MessageTime<br />\| count by MessageTime,severity, container, namespace,pod,message|
|AWS EKS - Control Plane|Error Messages|Logs|AWS EKS - Control Plane/EKS - Scheduler|\_sourceCategory = \*eks\* <br />AND \_sourceName = \*scheduler\*<br />\| json field=\_raw "message" as log<br />\| parse regex field=log "^^(?\<severity\>.)(?:[0-9])(?:.\*\\])\\s(?\<log\_msg\>.\*)"<br />\| where severity in ("E", "W")<br />\| count by  severity, log\_msg<br />\| sort by \_count|
|AWS EKS - Control Plane|Errors|Logs|AWS EKS - Control Plane/EKS - Authenticator|\_sourceCategory = \*eks\* error<br /> and \_sourceName = \*authenticator\*<br />\| json field=\_raw "message" as log<br />\| parse field=log "msg=\\"\*\\"" as err\_msg<br />\| parse field=log "time=\\"\*\\"" as message\_time<br />\| where !(isBlank(message\_time)) <br />\| count by err\_msg<br />\| sort by \_count<br />\| limit 10<br />|
|AWS EKS - Control Plane|Failure Rate|Logs|AWS EKS - Control Plane/EKS - API Server Audit|\_sourceCategory = \*eks\* <br /> and \_sourceName = kube-apiserver-audit\*<br />\| json field=\_raw "message.responseStatus.code", "message.verb", "message.requestURI", "message.objectRef.resource", "message.sourceIPs", "message.responseStatus.reason", "message.objectRef.namespace", "message.user.username"   as status\_code, method, url, k8\_resource, ip, reason, namespace, username<br />\| if (status\_code matches "2\*", 1,0) as success<br />\| if (status\_code matches "4\*", 1,0) as failure<br />\| sum(success) as total\_succes, sum(failure) as total\_failure<br />\| (total\_failure/(total\_succes + total\_failure))\*100 as failure\_rate<br />\| fields failure\_rate|
|AWS EKS - Control Plane|Failures by Reason and Namespace|Logs|AWS EKS - Control Plane/EKS - API Server Audit|\_sourceCategory = \*eks\* <br /> and \_sourceName = kube-apiserver-audit\*<br />\| json field=\_raw "message.responseStatus.code" as status\_code<br />\| json field=\_raw "message.verb" as method<br />\| json field=\_raw "message.requestURI" as url<br />\| json field=\_raw "message.objectRef.resource" as k8\_resource<br />\| json field=\_raw "message.sourceIPs" as ip<br />\| json field=\_raw "message.responseStatus.reason" as reason<br />\| json field=\_raw "message.objectRef.namespace" as namespace<br />\| json field=\_raw "message.user.username" as username<br />\| where !(status\_code matches "2\*")<br />\| count as count\_by\_namespace by reason, namespace<br />//\| transpose row reason column namespace<br />\| sort by count\_by\_namespace<br />\| limit 10<br /><br />|
|AWS EKS - Control Plane|Job Creations|Logs|AWS EKS - Control Plane/EKS - Controller Manager|	\_sourceCategory = \*eks\* "Created job"<br />	\| json field=\_raw "message" as log<br />	\| parse field=log "Created job \*" as job<br />  \| parse field=log "\* \*       " as code,time<br />  \| count by time, job|
|AWS EKS - Control Plane|Job Deletions|Logs|AWS EKS - Control Plane/EKS - Controller Manager|\_sourceCategory = \*eks\* "Deleted job"<br />	\| json field=\_raw "message" as log<br />  \| parse field=log "Deleted job \*" as job\_name<br />\| count|
|AWS EKS - Control Plane|Logs|Logs|AWS EKS - Control Plane/EKS - Authenticator|\_sourceCategory = \*eks\* <br /> and \_sourceName = \*authenticator\*<br />\| json field=\_raw "message" as log<br />\| parse field=log "msg=\\"\*\\"" as message<br />\| parse field=log "username=\\"\*\\"" as username<br />\| parse field=log "time=\\"\*\\"" as message\_time<br />\| count by message\_time, username, message<br />\| sort by message\_time desc|
|AWS EKS - Control Plane|Most Active Users|Logs|AWS EKS - Control Plane/EKS - API Server Audit|\_sourceCategory = \*eks\* <br /> and \_sourceName = kube-apiserver-audit\* <br />\| json field=\_raw "message.responseStatus.code", "message.verb", "message.requestURI", "message.objectRef.resource", "message.sourceIPs", "message.responseStatus.reason", "message.objectRef.namespace", "message.user.username"   as status\_code, method, url, k8\_resource, ip, reason, namespace, username<br />//\| where !(status\_code matches "2\*")<br />\| count as count\_by\_username by username<br />//\| transpose row reason column namespace<br />\| sort by count\_by\_username<br />\| limit 10<br /><br />|
|AWS EKS - Control Plane|Non-200 Total Count|Logs|AWS EKS - Control Plane/EKS - API Server Audit|\_sourceCategory = \*eks\* <br /> and \_sourceName = kube-apiserver-audit\*<br />\| json field=\_raw "message.responseStatus.code", "message.verb", "message.requestURI", "message.objectRef.resource", "message.sourceIPs", "message.responseStatus.reason", "message.objectRef.namespace", "message.user.username"   as status\_code, method, url, k8\_resource, ip, reason, namespace, username<br />\| where !(status\_code matches "2\*")<br />\| count status\_code|
|AWS EKS - Control Plane|Pods Created|Logs|AWS EKS - Control Plane/EKS - Controller Manager|	\_sourceCategory = \*eks\* "Created pod:"<br />  \| json field=\_raw "message" as log<br />  \| parse field=log "Created pod: \*" as pod<br />  \| parse field=log "\* \*       " as code,time<br />  \| count by time, pod|
|AWS EKS - Control Plane|Pods Deleted|Logs|AWS EKS - Control Plane/EKS - Controller Manager|	\_sourceCategory = \*eks\* "Deleted pod:"<br />	\| json field=\_raw "message" as log<br />	\| parse field=log "Deleted pod: \*" as pod<br />  \| parse field=log "\* \*       " as code,time<br />  \| count by time, pod|
|AWS EKS - Control Plane|Requests by Audit Policy|Logs|AWS EKS - Control Plane/EKS - API Server Audit|\_sourceCategory = \*eks\* <br /> and \_sourceName = kube-apiserver-audit\*<br />\| json field=\_raw "message", "message.level" as log, level<br />\| count by level|
|AWS EKS - Control Plane|Requests by Stage|Logs|AWS EKS - Control Plane/EKS - API Server Audit|\_sourceCategory = \*eks\* <br /> and \_sourceName = kube-apiserver-audit\*<br />\| json field=\_raw "message", "message.stage" as log, stage<br />\| count by stage|
|AWS EKS - Control Plane|Scale Operations|Logs|AWS EKS - Control Plane/EKS - Controller Manager|	\_sourceCategory = \*eks\* <br />	\| json field=\_raw "message" as log<br />\| parse regex field=log "^(?\<severity\>.)(?:[0-9])"<br />\| where severity == "I"<br />\| parse field=log "Scaled \* replica set \* to \*" as direction,replica\_set,scaled\_to<br />\| first(scaled\_to) as scaled\_to by  replica\_set |
|AWS EKS - Control Plane|Severity Breakdown|Logs|AWS EKS - Control Plane/EKS - API Server|\_sourceCategory = \*eks\* <br />AND \_sourceName = kube-api\* AND !\_sourceName = kube-apiserver-audit\*<br />\| json field=\_raw "message" as log<br />\| parse regex field=log "^^(?\<severity\>.)(?:[0-9])(?:.\*\\])\\s(?\<log\_msg\>.\*)"<br />\| count by severity<br />\| sort by \_count|
|AWS EKS - Control Plane|Severity Breakdown|Logs|AWS EKS - Control Plane/EKS - Scheduler|\_sourceCategory = \*eks\* <br />AND \_sourceName = \*scheduler\*<br />\| json field=\_raw "message" as log<br />\| parse regex field=log "^^(?\<severity\>.)(?:[0-9])(?:.\*\\])\\s(?\<log\_msg\>.\*)"<br />\| count by severity<br />\| sort by \_count|
|AWS EKS - Control Plane|Severity Over Time|Logs|AWS EKS - Control Plane/EKS - API Server|\_sourceCategory = \*eks\* <br />AND \_sourceName = kube-api\* AND !\_sourceName = kube-apiserver-audit\*<br />\| json field=\_raw "message" as log<br />\| parse regex field=log "^^(?\<severity\>.)(?:[0-9])(?:.\*\\])\\s(?\<log\_msg\>.\*)"<br />\| timeslice 1h<br />\| count by \_timeslice, severity<br />\| transpose row \_timeslice column severity<br />\| fillmissing timeslice(1h)|
|AWS EKS - Control Plane|Severity Over Time|Logs|AWS EKS - Control Plane/EKS - Controller Manager|	\_sourceCategory = \*eks\* <br />	\| json field=\_raw "message" as log<br />	\| parse regex field=log "^(?\<severity\>.)(?:[0-9])"<br />	\| timeslice 1h<br />	\| count \_timeslice, severity <br />	\| transpose row \_timeslice column severity<br />  \| fillmissing timeslice(1h) |
|AWS EKS - Control Plane|Severity Over Time|Logs|AWS EKS - Control Plane/EKS - Scheduler|\_sourceCategory = \*eks\* <br />AND \_sourceName = \*scheduler\*<br />\| json field=\_raw "message" as log<br />\| parse regex field=log "^^(?\<severity\>.)(?:[0-9])(?:.\*\\])\\s(?\<log\_msg\>.\*)"<br />\| timeslice 1h<br />\| count by \_timeslice, severity<br />\| transpose row \_timeslice column severity<br />\| fillmissing timeslice(1h)|
|AWS EKS - Control Plane|Status Code Trend|Logs|AWS EKS - Control Plane/EKS - API Server Audit|\_sourceCategory = \*eks\* <br /> and \_sourceName = kube-apiserver-audit\*<br />\| json field=\_raw "message.responseStatus.code", "message.verb", "message.requestURI", "message.objectRef.resource", "message.sourceIPs", "message.responseStatus.reason", "message.objectRef.namespace", "message.user.username"   as status\_code, method, url, k8\_resource, ip, reason, namespace, username<br />\| timeslice 1h \| count \_timeslice, status\_code \| transpose row \_timeslice column status\_code|
|AWS EKS - Control Plane|Top 10 URLS with Problem Status Codes|Logs|AWS EKS - Control Plane/EKS - API Server Audit|\_sourceCategory = \*eks\* <br /> and \_sourceName = kube-apiserver-audit\*<br />\| json field=\_raw "message.responseStatus.code", "message.verb", "message.requestURI", "message.objectRef.resource", "message.sourceIPs", "message.responseStatus.reason", "message.objectRef.namespace", "message.user.username"   as status\_code, method, url, k8\_resource, ip, reason, namespace, username<br />\| where !(status\_code matches "2\*")<br />\| count as urls\_by\_status by status\_code, url<br />\| sort by urls\_by\_status<br />\| limit 10|
|AWS EKS - Control Plane|Top Failure Reasons|Logs|AWS EKS - Control Plane/EKS - API Server Audit|\_sourceCategory = \*eks\* <br /> and \_sourceName = kube-apiserver-audit\*<br />\| json field=\_raw "message.responseStatus.code", "message.verb", "message.requestURI", "message.objectRef.resource", "message.sourceIPs", "message.responseStatus.reason", "message.objectRef.namespace", "message.user.username"   as status\_code, method, url, k8\_resource, ip, reason, namespace, username<br />\| where !(status\_code matches "2\*")<br />\| count as count\_by\_status by reason<br />\| sort by count\_by\_status<br />\| limit 10|
|AWS EKS - Control Plane|Top URLS with Non-200|Logs|AWS EKS - Control Plane/EKS - API Server Audit|\_sourceCategory = \*eks\* <br /> and \_sourceName = kube-apiserver-audit\*<br />\| json field=\_raw "message.responseStatus.code", "message.verb", "message.requestURI", "message.objectRef.resource", "message.sourceIPs", "message.responseStatus.reason", "message.objectRef.namespace", "message.user.username"   as status\_code, method, url, k8\_resource, ip, reason, namespace, username<br />\| where !(status\_code matches "2\*")<br />\| count url<br />\| top 10 url by \_count|
|AWS EKS - Control Plane|Top Users by Failures|Logs|AWS EKS - Control Plane/EKS - API Server Audit|\_sourceCategory = \*eks\* <br /> and \_sourceName = kube-apiserver-audit\* <br /> \| json field=\_raw "message.responseStatus.code", "message.verb", "message.requestURI", "message.objectRef.resource", "message.sourceIPs", "message.responseStatus.reason", "message.objectRef.namespace", "message.user.username"   as status\_code, method, url, k8\_resource, ip, reason, namespace, username<br />\| where !(status\_code matches "2\*")<br />\| count as count\_by\_username by reason, username<br />//\| transpose row reason column namespace<br />\| sort by count\_by\_username<br />\| limit 10|

