# PCI Compliance For Windows JSON
## Sumo Logic App For: PCI Compliance For Windows JSON
The Sumo Logic App for Payment Card Industry (PCI) Compliance for Windows offers dashboards to monitor systems, account and users activity to ensure that login activity and privileged users are within the expected ranges. The PCI Compliance for Windows App covers PCI requirements 02, 06, 08 and 10.
Docs Link: [PCI Compliance For Windows JSON](https://help.sumologic.com/?cid=210430)

## Searches

### Log Searches

- **Actions by Privileged Accounts**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **All Windows Updates**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 06 - Windows Updates Activity 
- **Default Login - Failure**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 10 - Login Activity 
- **Default Login - Success**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 10 - Login Activity 
- **Excessive Failed Access Attempts**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 08 - Other User Activity 
- **Failed Logins**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 10 - Login Activity 
- **Failed Logins**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 10 - Login Activity 
- **Policy Changes**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **Recent Windows Update Failures**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 06 - Windows Updates Activity 
- **Service Execution Trend**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **Service Stopped**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **Successful Logins**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 10 - Login Activity 
- **Sucessful Logins**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 10 - Login Activity 
- **System Restarted**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **System Time Change**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **Tampering Audit Logs**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **User Account Created**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **User Account Deleted**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **User Account Disabled**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **User Account Disabled, Not Deleted Over 1 Day**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 08 - Other User Activity 
- **User Account Enabled**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **User Account Locked**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring 
- **User Account Password Changes**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 08 - Other User Activity 
- **User Account Password Reset**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 08 - Other User Activity 
- **User Account Unlocked**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 08 - Other User Activity 
- **Windows Update Summary**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 06 - Windows Updates Activity 
- **Windows Update Summary by Host**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 06 - Windows Updates Activity 
- **Windows Update Trend**: from Dashboard: Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 06 - Windows Updates Activity

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|PCI Compliance For Windows JSON|Actions by Privileged Accounts|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|\_sourceCategory={{Logsdatasource}}   \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "EventData.UserWorkstations" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain, src\_host nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where (touppercase(src\_user) in ("ROOT", "ADMIN", "ADMINISTRATOR")) or (touppercase(dest\_user) in ("ROOT", "ADMIN", "ADMINISTRATOR"))<br />\| where event\_id matches "{{event\_id}}" and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| src\_user as %"Source User" \| dest\_user as %"Target User" \| host as %"Target Host" <br />\| fields event\_id, msg\_summary, src\_host, %"Source User", %"Target Host", %"Target User"<br />\| count as event\_count by event\_id, %"Source User", %"Target Host", %"Target User" <br />\| sort by event\_count, event\_id asc|
|PCI Compliance For Windows JSON|All Windows Updates|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 06 - Windows Updates Activity|\_sourceCategory={{Logsdatasource}}   \_sourceName=System ("\\"EventID\\":\\"19\\"" or "\\"EventID\\":\\"20\\"")<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain nodrop<br />\| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop<br />\| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as error\_code, Update nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id in ("19", "20") and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| if(msg\_summary matches "Installation Failure\*", "Update/Failure", if (msg\_summary matches "Installation Successful\*", "Update/Success", "Update/Attempt")) as %"Installation Status"<br />\| fields -\_raw <br />\| host as %"Destination Host"<br />\| parse field=Update "(\*)" as kbnum nodrop <br />\| timeslice 1s<br />\| count by \_timeslice, %"Destination Host", update, %"Installation Status", error\_code, src\_user, src\_domain, event\_id, kbnum|
|PCI Compliance For Windows JSON|Default Login - Failure|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 10 - Login Activity|\_sourceCategory={{Logsdatasource}}  \_sourceName=Security (4771 or 4776 or 4768 or 4769 or 4625) "Audit Failure"<br />\| json "EventID", "Computer", "Message", "EventData.LogonType", "EventData.FailureReason", "EventData.IpAddress", "EventData.IpPort", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "EventData.WorkstationName", "Channel", "EventData.Status", "EventData.SubStatus", "EventData.Workstation", "Keywords" as event\_id, host, msg\_summary, logon\_type, fail\_reason, src\_ip, src\_port, src\_user, src\_domain, dest\_user, dest\_domain, src\_host, channel, status, sub\_status, work\_station, Keywords nodrop<br />\| parse regex field=msg\_summary "Failure Information:\\s+Failure Reason:\\s+(?\<failure\_reason\>[^.\\r]+?)[.\\r]" nodrop<br />\| parse regex field=msg\_summary "Result Code:\\s+(?\<result\_code\>[^\\r]+)\\r" nodrop<br />\| parse regex field=msg\_summary "Failure Code:\\s+(?\<failure\_code\>[^\\r]+)\\r" nodrop<br />\| where (event\_id in ("4625", "4771") or (event\_id = "4768" and result\_code != "0x0") or (event\_id = "4769" and failure\_code != "0x0") or (event\_id = "4776" and status != "0x0")) and (((touppercase(src\_user) in ("ROOT", "ADMIN", "ADMINISTRATOR", "DBSNMP", "SYS", "SYSMAN", "SYSTEM", "CISCO15", "SADMIN", "CISCO", "NETSCREEN")) or (touppercase(dest\_user) in ("ROOT", "ADMIN", "ADMINISTRATOR", "DBSNMP", "SYS", "SYSMAN", "SYSTEM", "CISCO15", "SADMIN", "CISCO", "NETSCREEN"))))<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}" <br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, fail\_reason, msg\_summary, event\_id, result\_code, failure\_code, failure\_reason<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON|Default Login - Success|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 10 - Login Activity|\_sourceCategory={{Logsdatasource}}   \_sourceName=Security "\\"EventID\\":\\"4624\\""<br />\| json "EventID", "Computer", "Message", "Keywords", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "EventData.IpAddress", "EventData.IpPort", "Channel", "Level", "EventData.LogonType", "EventData.WorkstationName" as event\_id, host, msg\_summary, Keywords, src\_user, src\_domain, dest\_user, dest\_domain, src\_ip, src\_port, channel, level, logon\_type, src\_host  nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id = "4624" and ((touppercase(src\_user) in ("ROOT", "ADMIN", "ADMINISTRATOR", "DBSNMP", "SYS", "SYSMAN", "SYSTEM", "CISCO15", "SADMIN", "CISCO", "NETSCREEN")) or (touppercase(dest\_user) in ("ROOT", "ADMIN", "ADMINISTRATOR", "DBSNMP", "SYS", "SYSMAN", "SYSTEM", "CISCO15", "SADMIN", "CISCO", "NETSCREEN")))<br />\| where host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| fields host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, event\_id, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, msg\_summary, event\_id<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON|Excessive Failed Access Attempts|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 08 - Other User Activity|\_sourceCategory={{Logsdatasource}}  \_sourceName=Security (4771 or 4776 or 4768 or 4769 or 4625) "Audit Failure"<br />\| json "EventID", "Computer", "Message", "EventData.LogonType", "EventData.FailureReason", "EventData.IpAddress", "EventData.IpPort", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "EventData.WorkstationName", "Channel", "EventData.Status", "EventData.SubStatus", "EventData.Workstation", "Keywords" as event\_id, dest\_host, msg\_summary, logon\_type, fail\_reason, src\_ip, src\_port, src\_user, src\_domain, dest\_user, dest\_domain, src\_host, channel, status, sub\_status, work\_station, Keywords nodrop<br />\| parse regex field=msg\_summary "Failure Information:\\s+Failure Reason:\\s+(?\<failure\_reason\>[^.\\r]+?)[.\\r]" nodrop<br />\| parse regex field=msg\_summary "Result Code:\\s+(?\<result\_code\>[^\\r]+)\\r" nodrop<br />\| parse regex field=msg\_summary "Failure Code:\\s+(?\<failure\_code\>[^\\r]+)\\r" nodrop<br />\| where (event\_id in ("4625", "4771") or (event\_id = "4768" and result\_code != "0x0") or (event\_id = "4769" and failure\_code != "0x0") or (event\_id = "4776" and status != "0x0"))<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where dest\_host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}" <br />\| timeslice 5m<br />\| count as attempts by \_timeslice, src\_host, src\_user, src\_domain, dest\_host, dest\_user, dest\_domain<br />\| format("Excessive (%d) login failures observed", attempts) as message<br />\| {{excessive\_failed\_attempts}} as threshold<br />\| where attempts \> threshold<br />\| sort by \_timeslice, attempts<br />\| fields -threshold, attempts|
|PCI Compliance For Windows JSON|Failed Logins|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 10 - Login Activity|\_sourceCategory={{Logsdatasource}}  \_sourceName=Security (4771 or 4776 or 4768 or 4769 or 4625) "Audit Failure"<br />\| json "EventID", "Computer", "Message", "EventData.LogonType", "EventData.FailureReason", "EventData.IpAddress", "EventData.IpPort", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "EventData.WorkstationName", "Channel", "EventData.Status", "EventData.SubStatus", "EventData.Workstation", "Keywords" as event\_id, host, msg\_summary, logon\_type, fail\_reason, src\_ip, src\_port, src\_user, src\_domain, dest\_user, dest\_domain, src\_host, channel, status, sub\_status, work\_station, Keywords nodrop<br />\| parse regex field=msg\_summary "Failure Information:\\s+Failure Reason:\\s+(?\<failure\_reason\>[^.\\r]+?)[.\\r]" nodrop<br />\| parse regex field=msg\_summary "Result Code:\\s+(?\<result\_code\>[^\\r]+)\\r" nodrop<br />\| parse regex field=msg\_summary "Failure Code:\\s+(?\<failure\_code\>[^\\r]+)\\r" nodrop<br />\| where (event\_id in ("4625", "4771") or (event\_id = "4768" and result\_code != "0x0") or (event\_id = "4769" and failure\_code != "0x0") or (event\_id = "4776" and status != "0x0"))<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}" <br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, fail\_reason, msg\_summary, event\_id, result\_code, failure\_code, failure\_reason<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON|Failed Logins|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 10 - Login Activity|\_sourceCategory={{Logsdatasource}}  \_sourceName=Security (4771 or 4776 or 4768 or 4769 or 4625) "Audit Failure"<br />\| json "EventID", "Computer", "Message", "EventData.LogonType", "EventData.FailureReason", "EventData.IpAddress", "EventData.IpPort", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "EventData.WorkstationName", "Channel", "EventData.Status", "EventData.SubStatus", "EventData.Workstation", "Keywords" as event\_id, host, msg\_summary, logon\_type, fail\_reason, src\_ip, src\_port, src\_user, src\_domain, dest\_user, dest\_domain, src\_host, channel, status, sub\_status, work\_station, Keywords nodrop<br />\| parse regex field=msg\_summary "Failure Information:\\s+Failure Reason:\\s+(?\<failure\_reason\>[^.\\r]+?)[.\\r]" nodrop<br />\| parse regex field=msg\_summary "Result Code:\\s+(?\<result\_code\>[^\\r]+)\\r" nodrop<br />\| parse regex field=msg\_summary "Failure Code:\\s+(?\<failure\_code\>[^\\r]+)\\r" nodrop<br />\| where (event\_id in ("4625", "4771") or (event\_id = "4768" and result\_code != "0x0") or (event\_id = "4769" and failure\_code != "0x0") or (event\_id = "4776" and status != "0x0"))<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}" <br />\| fields host, dest\_user, dest\_domain, src\_host, src\_ip, src\_port, src\_user, src\_domain, logon\_type, fail\_reason, result\_code, failure\_code, failure\_reason, event\_id, msg\_summary<br />\| count as event\_count|
|PCI Compliance For Windows JSON|Policy Changes|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|\_sourceCategory={{Logsdatasource}}   (\_sourceName=Security or \_sourceName=System) ("Audit Policy Change" or "System audit policy was changed" or \*policy\*change\*)<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "keywords" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain, msg\_type nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| where event\_id matches "{{event\_id}}" and event\_id in ("4902", "4904", "4905", "4906", "4907", "4912", "4715", "4717", "4719" ) or msg\_summary="System audit policy was changed" or msg\_summary matches "\*policy\*change\*" or msg\_summary matches "\*Policy\*Change\*"<br />\| if (msg\_type matches "\*Success","Change/Configuration/Policy/Success", if (msg\_type matches "\*Fail\*", "Change/Configuration/Policy/Failure", "Change/Configuration/Policy/Attempt")) as classification<br />\| fields host, src\_user, src\_domain, classification, event\_id, msg\_summary, msg\_type<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, src\_user, src\_domain, classification, event\_id, msg\_summary, msg\_type<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON|Recent Windows Update Failures|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 06 - Windows Updates Activity|\_sourceCategory={{Logsdatasource}}   \_sourceName=System ("\\"EventID\\":\\"19\\"" or "\\"EventID\\":\\"20\\"")<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain nodrop<br />\| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop<br />\| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as error\_code, Update nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id in ("19", "20") and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| if(msg\_summary matches "Installation Failure\*", "Update/Failure", if (msg\_summary matches "Installation Successful\*", "Update/Success", "Update/Attempt")) as %"Installation Status"<br />\| fields -\_raw<br />\| host as %"Destination Host"<br />\| timeslice 1s<br />\| withtime %"Installation Status" <br />\| most\_recent(%"Installation Status\_withtime") as %"LastStatus" by %"Destination Host", update, \_timeslice<br />\| parse field=Update "(\*)" as kbnum nodrop<br />\| where %"LastStatus"="Update/Failure"|
|PCI Compliance For Windows JSON|Service Execution Trend|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|\_sourceCategory={{Logsdatasource}}   \_sourceName=System "\\"EventID\\":\\"7036\\""<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName", "EventData.SubjectDomainName" as event\_id, host, msg\_summary, src\_user, src\_domain nodrop<br />\| parse regex field=msg\_summary "The (?\<service\>\\w.+?) service entered the (?\<state\>\\w+) state" nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| where event\_id = "7036" and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" <br />\| fields event\_id, host, msg\_summary, service, state<br />\| timeslice 1h <br />\| count by \_timeslice, service<br />\| transpose row \_timeslice column service|
|PCI Compliance For Windows JSON|Service Stopped|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|\_sourceCategory={{Logsdatasource}}   \_sourceName=System "\\"EventID\\":\\"7036\\"" "stopped state"<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName", "EventData.SubjectDomainName" as event\_id, host, msg\_summary, src\_user, src\_domain nodrop<br />\| parse regex field=msg\_summary "The (?\<service\>\\w.+?) service entered the (?\<state\>\\w+) state" nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| where event\_id = "7036" and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}"<br />\| count as event\_count, first(\_messagetime) as latest, last(\_messagetime) as earliest by service, host, state \| latest as \_timeslice<br />\| fields \_timeslice, host, service, state, latest, earliest, event\_count<br />\| where state = "stopped"<br />\| formatDate(fromMillis(latest),"yyyy/MM/dd HH:mm:ss Z") as %"Latest Time" <br />\| formatDate(fromMillis(earliest),"yyyy/MM/dd HH:mm:ss Z") as %"Earliest Time" <br />\| fields -latest, earliest<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON|Successful Logins|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 10 - Login Activity|\_sourceCategory={{Logsdatasource}}   \_sourceName=Security "\\"EventID\\":\\"4624\\""<br />\| json "EventID", "Computer", "Message", "Keywords", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "EventData.IpAddress", "EventData.IpPort", "Channel", "Level", "EventData.LogonType", "EventData.WorkstationName" as event\_id, host, msg\_summary, Keywords, src\_user, src\_domain, dest\_user, dest\_domain, src\_ip, src\_port, channel, level, logon\_type, src\_host  nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id="4624" and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| fields host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, event\_id, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, msg\_summary, event\_id<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON|Sucessful Logins|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 10 - Login Activity|\_sourceCategory={{Logsdatasource}}   \_sourceName=Security "\\"EventID\\":\\"4624\\""<br />\| json "EventID", "Computer", "Message", "Keywords", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "EventData.IpAddress", "EventData.IpPort", "Channel", "Level", "EventData.LogonType", "EventData.WorkstationName" as event\_id, host, msg\_summary, Keywords, src\_user, src\_domain, dest\_user, dest\_domain, src\_ip, src\_port, channel, level, logon\_type, src\_host nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id = "4624" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and host matches "{{host}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}" <br />\| fields host, dest\_user, dest\_domain, src\_host, src\_ip, src\_user, src\_domain, src\_port, logon\_type, event\_id, msg\_summary<br />\| count as event\_count|
|PCI Compliance For Windows JSON|System Restarted|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|\_sourceCategory={{Logsdatasource}}   \_sourceName=Security "\\"EventID\\":\\"4608\\""<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id = "4608" and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| fields host, msg\_summary, event\_id<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, msg\_summary, event\_id<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON|System Time Change|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|\_sourceCategory={{Logsdatasource}}   ((\_sourceName=Security "\\"EventID\\":\\"4616\\"") or (\_sourceName=System ("\\"EventID\\":\\"35\\"" or "\\"EventID\\":\\"37\\"") ))<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName", "EventData.SubjectDomainName" as event\_id, host, msg\_summary, src\_user, src\_domain nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| where event\_id matches "{{event\_id}}" and event\_id in ("4616", "35", "37") and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}"<br />\| if (msg\_summary="The system time was changed" and src\_user \<\> "LOCAL SERVICE" and src\_domain \<\> "NT AUTHORITY", "Critical", "Low") as severity<br />\| fields host, src\_user, src\_domain, severity, event\_id, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, src\_user, src\_domain, severity, event\_id, msg\_summary<br />\| sort by severity asc, \_timeslice|
|PCI Compliance For Windows JSON|Tampering Audit Logs|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|\_sourceCategory={{Logsdatasource}}    (\_sourceName=Security or \_sourceName=System) (1102 or 517 or 104)<br />\| json "EventID", "Computer", "Message" as event\_id, host, msg\_summary nodrop<br />\| json "UserData.LogFileCleared.SubjectUserName", "UserData.LogFileCleared.SubjectDomainName" as src\_user, src\_domain nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| where event\_id in ("1102", "517", "104") and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}"<br />\| fields host, src\_user, src\_domain, event\_id, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, src\_user, src\_domain, event\_id, msg\_summary<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON|User Account Created|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|\_sourceCategory={{Logsdatasource}}   \_sourceName=Security "\\"EventID\\":\\"4720\\""<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id = "4720" and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| fields host, dest\_user, dest\_domain, src\_user, src\_domain, event\_id, msg\_summary<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, dest\_user, dest\_domain, src\_user, src\_domain, event\_id, msg\_summary<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON|User Account Deleted|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|\_sourceCategory={{Logsdatasource}}   \_sourceName=Security "\\"EventID\\":\\"4726\\""<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id = "4726" and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| fields host, dest\_user, dest\_domain, src\_user, src\_domain, event\_id, msg\_summary<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, dest\_user, dest\_domain, src\_user, src\_domain, event\_id, msg\_summary<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON|User Account Disabled|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|\_sourceCategory={{Logsdatasource}}  \_sourceName=Security "\\"EventID\\":\\"4725\\""<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id = "4725" and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| fields host, dest\_user, dest\_domain, src\_user, src\_domain, event\_id, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, dest\_user, dest\_domain, src\_user, src\_domain, event\_id, msg\_summary<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON|User Account Disabled, Not Deleted Over 1 Day|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 08 - Other User Activity|\_sourceCategory={{Logsdatasource}}  \_sourceName=Security ("\\"EventID\\":\\"4726\\"" or  "\\"EventID\\":\\"4725\\"")<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id in ("4725", "4726") and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}" <br />\| withtime msg\_summary \| withtime \_messagetime<br />\| most\_recent(msg\_summary\_withtime) as action, most\_recent(\_messagetime\_withtime) as m\_time by host, dest\_user<br />\| formatDate(fromMillis(m\_time), "MM-dd-yyyy HH:mm:ss:SSS z") as event\_time<br />\| 1000\*60\*60\*24 as Oneday<br />\| 1 as threshold <br />\| num(threshold) as threshold<br />\| ((toMillis(now())-m\_time)/oneday) as since\_days \| format("%.2f", since\_days) as since\_days\_str<br />\| concat ("User account was disabled ", since\_days\_str, " days ago, but not yet deleted.") as Remark<br />\| where !(action matches "\*user account was deleted\*")<br />\| where since\_days \>= threshold<br />\| sort by since\_days<br />\| fields - m\_time, Oneday, since\_days\_str, action, since\_days, threshold|
|PCI Compliance For Windows JSON|User Account Enabled|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|\_sourceCategory={{Logsdatasource}}  \_sourceName=Security "\\"EventID\\":\\"4722\\""<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id = "4722" and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| fields host, dest\_user, dest\_domain, src\_user, src\_domain, event\_id, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, dest\_user, dest\_domain, src\_user, src\_domain, event\_id, msg\_summary<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON|User Account Locked|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 02, 08, 10 - Account, User, System Monitoring|\_sourceCategory={{Logsdatasource}}   \_sourceName=Security ("\\"EventID\\":\\"4740\\"" or "\\"EventID\\":\\"644\\"")<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id in ("4740", "644") and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| fields host, dest\_user, src\_user, src\_domain, event\_id, msg\_summary<br />\| fields -\_raw<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, dest\_user, src\_user, src\_domain, event\_id, msg\_summary<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON|User Account Password Changes|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 08 - Other User Activity|\_sourceCategory={{Logsdatasource}}   \_sourceName=Security "\\"EventID\\":\\"4723\\""<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id = "4723" and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, dest\_user, dest\_domain, src\_user, src\_domain, msg\_summary, event\_id<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON|User Account Password Reset|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 08 - Other User Activity|\_sourceCategory={{Logsdatasource}}   \_sourceName=Security "\\"EventID\\":\\"4724\\""<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id = "4724" and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}" <br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, dest\_user, dest\_domain, src\_user, src\_domain, msg\_summary, event\_id<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON|User Account Unlocked|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 08 - Other User Activity|\_sourceCategory={{Logsdatasource}}  \_sourceName=Security "\\"EventID\\":\\"4767\\"" <br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id = "4767" and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, host, src\_user, src\_domain, dest\_user, dest\_domain, msg\_summary, event\_id<br />\| sort by \_timeslice|
|PCI Compliance For Windows JSON|Windows Update Summary|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 06 - Windows Updates Activity|\_sourceCategory={{Logsdatasource}}   \_sourceName=System ("\\"EventID\\":\\"19\\"" or "\\"EventID\\":\\"20\\"")<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain nodrop<br />\| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop<br />\| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as errorCode, Update nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id in ("19", "20") and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| if(msg\_summary matches "Installation Failure\*", "Update/Failure", if (msg\_summary matches "Installation Successful\*", "Update/Success", "Update/Attempt")) as %"Installation Status"<br />\| fields -\_raw<br />\| host as %"Destination Host"<br />\| timeslice 1s<br />\| withtime %"Installation Status" <br />\| most\_recent(%"Installation Status\_withtime") as %"LastStatus" by %"Destination Host", update, \_timeslice<br />\| parse field=Update "(\*)" as kbnum nodrop<br />\| count\_distinct(%"Destination Host") as %"Hosts" by LastStatus, update<br />\| transpose row update column LastStatus|
|PCI Compliance For Windows JSON|Windows Update Summary by Host|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 06 - Windows Updates Activity|\_sourceCategory={{Logsdatasource}}   \_sourceName=System ("\\"EventID\\":\\"19\\"" or "\\"EventID\\":\\"20\\"")<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain nodrop<br />\| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop<br />\| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as errorCode, Update nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id in ("19", "20") and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| if(msg\_summary matches "Installation Failure\*", "Update/Failure", if (msg\_summary matches "Installation Successful\*", "Update/Success", "Update/Attempt")) as %"Installation Status"<br />\| fields -\_raw<br />\| host as %"Destination Host"<br />\| timeslice 1s<br />\| withtime %"Installation Status" <br />\| most\_recent(%"Installation Status\_withtime") as %"LastStatus" by %"Destination Host", update, \_timeslice<br />\| parse field=Update "(\*)" as kbnum nodrop<br />\| count by %"Destination Host", %"LastStatus"<br />\| transpose row %"Destination Host" column %"LastStatus"|
|PCI Compliance For Windows JSON|Windows Update Trend|Logs|Installed Apps/PCI Compliance For Windows JSON/Windows - PCI Req 06 - Windows Updates Activity|\_sourceCategory={{Logsdatasource}}   \_sourceName=System ("\\"EventID\\":\\"19\\"" or "\\"EventID\\":\\"20\\"")<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain nodrop<br />\| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop<br />\| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as errorCode, Update nodrop<br />\| if(isNull(src\_user), "Unknown", src\_user) as src\_user<br />\| if(isNull(src\_domain), "Unknown", src\_domain) as src\_domain<br />\| if(isNull(dest\_user), "Unknown", dest\_user) as dest\_user<br />\| if(isNull(dest\_domain), "Unknown", dest\_domain) as dest\_domain<br />\| where event\_id in ("19", "20") and host matches "{{host}}" and \_collector matches "{{collector}}" and \_sourceHost matches "{{sourcehost}}" and src\_user matches "{{src\_user}}" and src\_domain matches "{{src\_domain}}" and dest\_user matches "{{dest\_user}}" and dest\_domain matches "{{dest\_domain}}"<br />\| if(msg\_summary matches "Installation Failure\*", "Update/Failure", if (msg\_summary matches "Installation Successful\*", "Update/Success", "Update/Attempt")) as %"Installation Status"<br />\| fields -\_raw<br />\| host as %"Destination Host"<br />\| timeslice 1s<br />\| withtime %"Installation Status" <br />\| most\_recent(%"Installation Status\_withtime") as %"LastStatus" by %"Destination Host", update, \_timeslice<br />\| parse field=Update "(\*)" as kbnum nodrop<br />\| count\_distinct(%"Destination Host") by LastStatus, \_timeslice<br />\| transpose row \_timeslice column LastStatus|

