# Google Cloud Audit
## Sumo Logic App For: Google Cloud Audit
The Sumo Logic App for Google Cloud Audit helps you monitor the activities in your Google Cloud Platform projects. The preconfigured dashboards provide you insights into the network, security, operations, and users of your Google Cloud Platform projects.
Docs Link: [Google Cloud Audit](https://help.sumologic.com/?cid=4061)

## Searches

### Log Searches

- **Actions**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Operations 
- **Authorization Failures**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Overview 
- **Authorization Failures Over Time**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Network and Security 
- **Created Resources**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Overview 
- **Created Resources Over Time**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Operations 
- **Creations and Deletions by User**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Users 
- **Deleted Resources Over Time**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Overview 
- **Deleted Resources Over Time**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Operations 
- **Firewall Rules with All Allowed**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Network and Security 
- **Google Cloud Audit Operation Activity**: from Search: Google Cloud Audit/Google Cloud Audit Operation Activity 
- **Google Cloud Audit Operation Activity**: from Search: Installed Apps/Google Cloud Audit/Google Cloud Audit Operation Activity 
- **Google Cloud Audit Resource Operations**: from Search: Google Cloud Audit/Google Cloud Audit Resource Operations 
- **Google Cloud Audit Resource Operations**: from Search: Installed Apps/Google Cloud Audit/Google Cloud Audit Resource Operations 
- **Google Cloud Audit Service Operations**: from Search: Google Cloud Audit/Google Cloud Audit Service Operations 
- **Google Cloud Audit Service Operations**: from Search: Installed Apps/Google Cloud Audit/Google Cloud Audit Service Operations 
- **Google Cloud Audit Top Users**: from Search: Installed Apps/Google Cloud Audit/Google Cloud Audit Top Users 
- **Google Cloud Audit Top Users**: from Search: Google Cloud Audit/Google Cloud Audit Top Users 
- **Google Cloud Audit User Activity**: from Search: Installed Apps/Google Cloud Audit/Google Cloud Audit User Activity 
- **Google Cloud Audit User Activity**: from Search: Google Cloud Audit/Google Cloud Audit User Activity 
- **Location of Audit Activity**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Overview 
- **Location of Authorization Failures**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Network and Security 
- **Location of Users**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Users 
- **Network and Security Operations**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Network and Security 
- **Network and Security Operations Over Time**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Network and Security 
- **Operations by GCP Project**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Operations 
- **Operations by Resources**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Overview 
- **Recent Authorization Failures**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Network and Security 
- **Recent Firewall Changes**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Network and Security 
- **Recent Operation Activity**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Operations 
- **Recent User Activity**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Users 
- **Requested GCP Service Over Time**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Operations 
- **Short Lived Network Resources**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Network and Security 
- **Top 10 Activities by Users**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Users 
- **Top 10 Users**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Users 
- **Top 10 Users**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Overview 
- **User Activities Over Time**: from Dashboard: Installed Apps/Google Cloud Audit/Google Cloud Audit - Users

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Google Cloud Audit|Actions|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Operations|\_sourceCategory={{Logsdatasource}}  authorizationInfo logName principalEmail resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.authorizationInfo[\*]" as labels, project, user, permissions<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<action\>[a-zA-Z\\.]+)\\"" multi<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as executions by action<br />\| sort by executions|
|Google Cloud Audit|Authorization Failures|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Overview|\_sourceCategory={{Logsdatasource}}  authorizationInfo logName principalEmail resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.authorizationInfo[\*]" as labels, project, user, permissions<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\",\\"granted\\":(?\<granted\>[a-z]+)}" multi<br />\| where granted != "true"<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as failures|
|Google Cloud Audit|Authorization Failures Over Time|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Network and Security|\_sourceCategory={{Logsdatasource}}  authorizationInfo logName principalEmail resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.authorizationInfo[\*]" as labels, project, user, permissions<br />\| parse regex field=permissions "\\"granted\\":(?\<granted\>[a-z]+)}" multi<br />\| where granted != "true"<br />\| timeslice 1h<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as failures by \_timeslice|
|Google Cloud Audit|Created Resources|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Overview|\_sourceCategory={{Logsdatasource}}  authorizationInfo logName principalEmail resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.authorizationInfo[\*]" as labels, project, user, permissions<br />\| where !isNull(permissions)<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\"" multi<br />\| where method = "create"<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as creations by resource\_type<br />\| sort by creations|
|Google Cloud Audit|Created Resources Over Time|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Operations|\_sourceCategory={{Logsdatasource}}  authorizationInfo logName principalEmail resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.authorizationInfo[\*]" as labels, project, user, permissions<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\"" multi<br />\| where method = "create"<br />\| timeslice 1h<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as creations by \_timeslice, resource\_type<br />\| transpose row \_timeslice column resource\_type|
|Google Cloud Audit|Creations and Deletions by User|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Users|\_sourceCategory={{Logsdatasource}}  authorizationInfo logName principalEmail resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.authorizationInfo[\*]" as labels, project, user, permissions<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\"" multi<br />\| where method = "create" or method = "delete"<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as operations by user, method<br />\| transpose row user column method|
|Google Cloud Audit|Deleted Resources Over Time|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Overview|\_sourceCategory={{Logsdatasource}}  authorizationInfo logName principalEmail resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.authorizationInfo[\*]" as labels, project, user, permissions<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\"" multi<br />\| where method = "delete"<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as deletions by resource\_type<br />\| sort by deletions|
|Google Cloud Audit|Deleted Resources Over Time|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Operations|\_sourceCategory={{Logsdatasource}}  authorizationInfo logName principalEmail resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.authorizationInfo[\*]" as labels, project, user, permissions<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\"" multi<br />\| where method = "delete"<br />\| timeslice 1h<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as creations by \_timeslice, resource\_type<br />\| transpose row \_timeslice column resource\_type|
|Google Cloud Audit|Firewall Rules with All Allowed|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Network and Security|\_sourceCategory={{Logsdatasource}}  alloweds logName methodName principalEmail request resource timestamp<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.type" as type<br />\| where type = "gce\_firewall\_rule"<br />\| json field=data "timestamp", "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.methodName", "protoPayload.request" as timestamp, labels, project, user, method, request<br />\| json field=request "direction", "alloweds[\*]" as direction, alloweds<br />\| parse "\\"sourceRanges\\":[\*]" as ranges nodrop<br />\| parse "\\"destinationRanges\\":[\*]" as ranges<br />\| parse regex field=alloweds "\\"IPProtocol\\":\\"(?\<protocol\>[a-zA-Z\\.]+)\\"[,\\"a-z:]\*\\[?(?\<ports\>[0-9-\\",]+)?\\]?" multi<br />\| where protocol = "all"<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as operations by timestamp, user, method, ranges, direction, ports<br />\| fields timestamp, user, method, ranges, direction, ports<br />\| sort by timestamp|
|Google Cloud Audit|Google Cloud Audit Operation Activity|Logs|Google Cloud Audit/Google Cloud Audit Operation Activity|\_sourceCategory = Labs/GCP/cloudaudit logName resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "timestamp", "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.requestMetadata.callerIp", "protoPayload.authorizationInfo[\*]" as timestamp, labels, project, user, ip, permissions<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<action\>[a-zA-Z\\.]+)\\",\\"granted\\":(?\<granted\>[a-z]+)}" multi<br />\| count as operations by timestamp, user, action, granted, project, ip<br />\| fields timestamp, user, action, granted, project, ip<br />\| sort by timestamp|
|Google Cloud Audit|Google Cloud Audit Operation Activity|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit Operation Activity|\_sourceCategory={{Logsdatasource}}  logName resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "timestamp", "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.requestMetadata.callerIp", "protoPayload.authorizationInfo[\*]" as timestamp, labels, project, user, ip, permissions<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<action\>[a-zA-Z\\.]+)\\",\\"granted\\":(?\<granted\>[a-z]+)}" multi<br />\| count as operations by timestamp, user, action, granted, project, ip<br />\| fields timestamp, user, action, granted, project, ip<br />\| sort by timestamp|
|Google Cloud Audit|Google Cloud Audit Resource Operations|Logs|Google Cloud Audit/Google Cloud Audit Resource Operations|\_sourceCategory = Labs/GCP/cloudaudit logName resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.authorizationInfo[\*]" as labels, project, user, permissions<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\"" multi<br />\| count as operations by resource\_type, method<br />\| transpose row resource\_type column method|
|Google Cloud Audit|Google Cloud Audit Resource Operations|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit Resource Operations|\_sourceCategory={{Logsdatasource}}  logName resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.authorizationInfo[\*]" as labels, project, user, permissions<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\"" multi<br />\| count as operations by resource\_type, method<br />\| transpose row resource\_type column method|
|Google Cloud Audit|Google Cloud Audit Service Operations|Logs|Google Cloud Audit/Google Cloud Audit Service Operations|\_sourceCategory = Labs/GCP/cloudaudit logName resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.authorizationInfo[\*]" as labels, project, user, permissions<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<service\_type\>[a-zA-Z]+)\\.\\S+?\\"" multi<br />\| timeslice 1h<br />\| count as operations by \_timeslice, service\_type<br />\| transpose row \_timeslice column service\_type|
|Google Cloud Audit|Google Cloud Audit Service Operations|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit Service Operations|\_sourceCategory={{Logsdatasource}}  logName resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.authorizationInfo[\*]" as labels, project, user, permissions<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<service\_type\>[a-zA-Z]+)\\.\\S+?\\"" multi<br />\| timeslice 1h<br />\| count as operations by \_timeslice, service\_type<br />\| transpose row \_timeslice column service\_type|
|Google Cloud Audit|Google Cloud Audit Top Users|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit Top Users|\_sourceCategory={{Logsdatasource}}  logName resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail" as labels, project, user<br />\| count as messages by user<br />\| sort by messages|
|Google Cloud Audit|Google Cloud Audit Top Users|Logs|Google Cloud Audit/Google Cloud Audit Top Users|\_sourceCategory = Labs/GCP/cloudaudit logName resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail" as labels, project, user<br />\| count as messages by user<br />\| sort by messages|
|Google Cloud Audit|Google Cloud Audit User Activity|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit User Activity|\_sourceCategory={{Logsdatasource}}  logName resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "timestamp", "severity", "resource.labels", "resource.labels.project\_id", "protoPayload.methodName", "protoPayload.authenticationInfo.principalEmail" as timestamp, severity, labels, project, method, user<br />\| count as messages by timestamp, severity, project, method, user<br />\| sort by timestamp asc<br />\| 1 as operation<br />\| accum operation as operations by user<br />\| fields timestamp, user, project, method, severity, operations<br />\| sort by timestamp|
|Google Cloud Audit|Google Cloud Audit User Activity|Logs|Google Cloud Audit/Google Cloud Audit User Activity|\_sourceCategory = Labs/GCP/cloudaudit logName resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "timestamp", "severity", "resource.labels", "resource.labels.project\_id", "protoPayload.methodName", "protoPayload.authenticationInfo.principalEmail" as timestamp, severity, labels, project, method, user<br />\| count as messages by timestamp, severity, project, method, user<br />\| sort by timestamp asc<br />\| 1 as operation<br />\| accum operation as operations by user<br />\| fields timestamp, user, project, method, severity, operations<br />\| sort by timestamp|
|Google Cloud Audit|Location of Audit Activity|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Overview|\_sourceCategory={{Logsdatasource}}  callerIp logName principalEmail resource timestamp<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.requestMetadata.callerIp" as labels, project, user, caller\_ip<br />\| lookup latitude, longitude from geo://location on ip=caller\_ip<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count by latitude, longitude<br />\| sort \_count|
|Google Cloud Audit|Location of Authorization Failures|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Network and Security|\_sourceCategory={{Logsdatasource}}  authorizationInfo callerIp logName principalEmail resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.authorizationInfo[\*]", "protoPayload.requestMetadata.callerIp" as labels, project, user, permissions, caller\_ip<br />\| parse regex field=permissions "\\"granted\\":(?\<granted\>[a-z]+)}" multi<br />\| where granted != "true"<br />\| lookup latitude, longitude from geo://location on ip=caller\_ip<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count by latitude, longitude<br />\| sort \_count|
|Google Cloud Audit|Location of Users|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Users|\_sourceCategory={{Logsdatasource}}  callerIp logName principalEmail resource timestamp<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.requestMetadata.callerIp" as labels, project, user, caller\_ip<br />\| lookup latitude, longitude from geo://location on ip=caller\_ip<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count\_distinct(user) as \_count by latitude, longitude, user|
|Google Cloud Audit|Network and Security Operations|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Network and Security|\_sourceCategory={{Logsdatasource}}  logName methodName principalEmail resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.type" as type<br />\| where type = "gce\_firewall\_rule" or type = "gce\_subnetwork" or type = "gce\_route" or type = "gce\_network"<br />\| json field=data "timestamp", "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.methodName" as timestamp, labels, project, user, method<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as operations by method<br />\| sort by operations|
|Google Cloud Audit|Network and Security Operations Over Time|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Network and Security|\_sourceCategory={{Logsdatasource}}  logName methodName principalEmail resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.type" as type<br />\| where type = "gce\_firewall\_rule" or type = "gce\_subnetwork" or type = "gce\_route" or type = "gce\_network"<br />\| json field=data "timestamp", "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.methodName" as timestamp, labels, project, user, method<br />\| timeslice 1h<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as operations by \_timeslice, method<br />\| transpose row \_timeslice column method|
|Google Cloud Audit|Operations by GCP Project|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Operations|\_sourceCategory={{Logsdatasource}}  authorizationInfo logName principalEmail resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.authorizationInfo[\*]" as labels, project, user, permissions<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\"" multi<br />\| timeslice 1h<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as operations by \_timeslice, project<br />\| transpose row \_timeslice column project|
|Google Cloud Audit|Operations by Resources|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Overview|\_sourceCategory={{Logsdatasource}}  authorizationInfo logName principalEmail resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.authorizationInfo[\*]" as labels, project, user, permissions<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\"" multi<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as operations by resource\_type, method<br />\| transpose row resource\_type column method|
|Google Cloud Audit|Recent Authorization Failures|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Network and Security|\_sourceCategory={{Logsdatasource}}  authorizationInfo callerIp logName principalEmail resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "timestamp", "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.authorizationInfo[\*]", "protoPayload.requestMetadata.callerIp" as timestamp, labels, project, user, permissions, caller\_ip<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<action\>[a-zA-Z\\.]+)\\",\\"granted\\":(?\<granted\>[a-z]+)}" multi<br />\| where granted != "true"<br />\| lookup country\_name, city from geo://location on ip=caller\_ip<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as operations by timestamp, user, action, project, country\_name, city, caller\_ip<br />\| fields timestamp, user, action, project, country\_name, city, caller\_ip<br />\| sort by timestamp|
|Google Cloud Audit|Recent Firewall Changes|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Network and Security|\_sourceCategory={{Logsdatasource}}  logName methodName principalEmail request resource timestamp<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.type" as type<br />\| where type = "gce\_firewall\_rule"<br />\| json field=data "timestamp", "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.methodName", "protoPayload.request" as timestamp, labels, project, user, method, request<br />\| json field=request "direction", "alloweds[\*]", "denieds[\*]" as direction, alloweds, denieds nodrop<br />\| if(isNull(alloweds) OR alloweds="","deny","allow") as action<br />\| parse "\\"sourceRanges\\":[\*]" as ranges nodrop<br />\| parse "\\"destinationRanges\\":[\*]" as ranges<br />\| parse regex field=alloweds "\\"IPProtocol\\":\\"(?\<protocol\>[a-zA-Z\\.]+)\\"[,\\"a-z:]\*\\[?(?\<ports\>[0-9-\\",]+)?\\]?" multi nodrop<br />\| parse regex field=denieds "\\"IPProtocol\\":\\"(?\<protocol\>[a-zA-Z\\.]+)\\"[,\\"a-z:]\*\\[?(?\<ports\>[0-9-\\",]+)?\\]?" multi<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as operations by timestamp, user, method, ranges, direction, action, protocol, ports<br />\| fields timestamp, user, method, ranges, direction, action, protocol, ports<br />\| sort by timestamp|
|Google Cloud Audit|Recent Operation Activity|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Operations|\_sourceCategory={{Logsdatasource}}  authorizationInfo callerIp logName principalEmail resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "timestamp", "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.requestMetadata.callerIp", "protoPayload.authorizationInfo[\*]" as timestamp, labels, project, user, ip, permissions<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<action\>[a-zA-Z\\.]+)\\",\\"granted\\":(?\<granted\>[a-z]+)}" multi<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as operations by timestamp, user, action, granted, project, ip<br />\| fields timestamp, user, action, granted, project, ip<br />\| sort by timestamp|
|Google Cloud Audit|Recent User Activity|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Users|\_sourceCategory={{Logsdatasource}}  logName principalEmail resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "timestamp", "severity", "resource.labels", "resource.labels.project\_id", "protoPayload.methodName", "protoPayload.authenticationInfo.principalEmail" as timestamp, severity, labels, project, method, user<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as messages by timestamp, severity, project, method, user<br />\| sort by timestamp asc<br />\| 1 as operation<br />\| accum operation as operations by user<br />\| fields timestamp, user, project, method, severity, operations<br />\| sort by timestamp|
|Google Cloud Audit|Requested GCP Service Over Time|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Operations|\_sourceCategory={{Logsdatasource}}  authorizationInfo logName principalEmail resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.authorizationInfo[\*]" as labels, project, user, permissions<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<service\_type\>[a-zA-Z]+)\\.\\S+?\\"" multi<br />\| timeslice 1h<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as operations by \_timeslice, service\_type<br />\| transpose row \_timeslice column service\_type|
|Google Cloud Audit|Short Lived Network Resources|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Network and Security|\_sourceCategory={{Logsdatasource}}  logName methodName principalEmail resource <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.type" as type<br />\| where type = "gce\_firewall\_rule" or type = "gce\_subnetwork" or type = "gce\_route" or type = "gce\_network"<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.methodName", "protoPayload.resourceName" as labels, project, user, method, resource\_name<br />\| if(method matches "\*delete\*", user, "") as terminator<br />\| if(isNull(terminator) OR terminator="", user, "") as creator<br />\| concat("creator:", creator, ",", "terminator:", terminator) as users<br />\| if(isNull(terminator) OR terminator="",\_messageTime,0) as start\_messagetime<br />\| if(isNull(creator) OR creator="",\_messageTime,0) as end\_messagetime<br />\| concat(users, ",", "resourceName:", resource\_name, ",", "startTime:", start\_messagetime, ",", "endTime:", end\_messagetime) as \_raw<br />\| join<br />(parse "creator:\*,terminator:,resourceName:\*,startTime:\*,endTime:0.0" as creator, resource\_name, start\_messagetime) as t1,<br />(parse "creator:,terminator:\*,resourceName:\*,startTime:0.0,endTime:\*" as terminator, resource\_name, end\_messagetime) as t2<br />on t1.resource\_name = t2.resource\_name<br />\| where t1\_start\_messagetime !=0 AND t2\_end\_messagetime !=0 AND ((t2\_end\_messagetime-t1\_start\_messagetime)\< 600000)<br />\| t1\_creator as creator<br />\| t2\_terminator as terminator<br />\| t1\_resource\_name as resource\_name<br />\| count by creator, terminator, resource\_name<br />\| fields -\_count|
|Google Cloud Audit|Top 10 Activities by Users|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Users|\_sourceCategory={{Logsdatasource}}  authorizationInfo logName principalEmail resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail", "protoPayload.authorizationInfo[\*]" as labels, project, user, permissions<br />\| where !isNull(permissions)<br />\| parse regex field=permissions "\\"permission\\":\\"(?\<activity\>[a-zA-Z\\.]+)\\"" multi<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as operations by activity<br />\| sort by operations<br />\| limit 10|
|Google Cloud Audit|Top 10 Users|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Users|\_sourceCategory={{Logsdatasource}}  logName principalEmail resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail" as labels, project, user<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as messages by user<br />\| sort by messages<br />\| limit 10|
|Google Cloud Audit|Top 10 Users|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Overview|\_sourceCategory={{Logsdatasource}}  logName principalEmail resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail" as labels, project, user<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as messages by user<br />\| sort by messages<br />\| limit 10|
|Google Cloud Audit|User Activities Over Time|Logs|Installed Apps/Google Cloud Audit/Google Cloud Audit - Users|\_sourceCategory={{Logsdatasource}}  logName resource timestamp <br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2Factivity"<br />\| json "message.data" as data<br />\| json field=data "resource.labels", "resource.labels.project\_id", "protoPayload.authenticationInfo.principalEmail" as labels, project, user<br />\| timeslice 1h<br />\|where if ("{{User}}" = "\*", true, user matches "{{User}}") AND if ("{{Project}}" = "\*", true, project matches "{{Project}}")<br />\|count as messages by \_timeslice, user<br />\| transpose row \_timeslice column user|

