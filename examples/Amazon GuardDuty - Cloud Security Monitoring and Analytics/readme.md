# Amazon GuardDuty - Cloud Security Monitoring and Analytics

## Searches

### Log Searches

- **Findings by Threat Name**: from Dashboard: Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Analysis - Security Analytics 
- **Findings by Threat Purpose**: from Dashboard: Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Analysis - Security Analytics 
- **High Severity Findings Last Hour**: from Dashboard: Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring 
- **High Severity Outliers**: from Dashboard: Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring 
- **Last 20 Findings**: from Dashboard: Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring 
- **Last 20 Low Severity Findings**: from Dashboard: Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring 
- **Last 20 Medium Severity Findings**: from Dashboard: Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring 
- **Last 20 Severity Findings**: from Dashboard: Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring 
- **Latest Findings**: from Dashboard: Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Analysis - Security Analytics 
- **Low Severity Findings Last Hour**: from Dashboard: Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring 
- **Low Severity Outliers**: from Dashboard: Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring 
- **Medium Severity Findings Last Hour**: from Dashboard: Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring 
- **Medium Severity Outliers**: from Dashboard: Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring 
- **Total Findings Last Hour**: from Dashboard: Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring 
- **Trending All Findings**: from Dashboard: Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Amazon GuardDuty - Cloud Security Monitoring and Analytics|Findings by Threat Name|Logs|Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Analysis - Security Analytics|<br />\_sourceCategory = Labs/AWS/GuardDuty\* severity<br />\| json "severity"<br />\| json field=\_raw "accountId", "region", "partition", "id", "arn", "type","service.serviceName","service.detectorId","service.action","title","description" nodrop<br />\| parse field=type "\*:\*/\*" as ThreatPurpose,ResourceType,ThreatName<br />\| json field=%service.action "networkConnectionAction.remoteIpDetails.ipAddressV4","networkConnectionAction.localPortDetails.port" as ip, localPort nodrop<br />\| parse "\\"vpcId\\":\\"\*\\"" as vpcId, "\\"subnetId\\":\\"\*\\"" as subnetId,"\\"groupId\\":\\"\*\\"" as securityGroupId,"\\"tags\\":[\*]" as tags,"\\"groupName\\":\\"\*\\"" as securityGroupName nodrop<br />\| json field=\_raw "resource.instanceDetails.instanceId" as instanceid nodrop<br />\| if(severity=0, "Info",if(severity=2, "Low", if(severity=5, "Medium", if(severity=8, "High",if(severity=9.5, "Critical",severity))))) as severity<br />\| where ThreatPurpose matches "{{ThreatPurpose}}"<br />\| where ThreatName matches "{{ThreatName}}"<br />\| where accountId matches "{{accountId}}"<br />\| where region matches "{{region}}"<br />\| where ResourceType matches "{{ResourceType}}"<br />\| where severity matches "{{severity}}"<br />\| timeslice 15m<br />\| count by ThreatName, \_timeslice<br />\| transpose row \_timeslice column ThreatName|
|Amazon GuardDuty - Cloud Security Monitoring and Analytics|Findings by Threat Purpose|Logs|Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Analysis - Security Analytics|<br />\_sourceCategory = Labs/AWS/GuardDuty\* severity<br />\| json "severity"<br />\| json field=\_raw "accountId", "region", "partition", "id", "arn", "type","service.serviceName","service.detectorId","service.action","title","description" nodrop<br />\| parse field=type "\*:\*/\*" as ThreatPurpose,ResourceType,ThreatName<br />\| json field=%service.action "networkConnectionAction.remoteIpDetails.ipAddressV4","networkConnectionAction.localPortDetails.port" as ip, localPort nodrop<br />\| parse "\\"vpcId\\":\\"\*\\"" as vpcId, "\\"subnetId\\":\\"\*\\"" as subnetId,"\\"groupId\\":\\"\*\\"" as securityGroupId,"\\"tags\\":[\*]" as tags,"\\"groupName\\":\\"\*\\"" as securityGroupName nodrop<br />\| json field=\_raw "resource.instanceDetails.instanceId" as instanceid nodrop<br />\| if(severity=0, "Info",if(severity=2, "Low", if(severity=5, "Medium", if(severity=8, "High",if(severity=9.5, "Critical",severity))))) as severity<br />\| where ThreatPurpose matches "{{ThreatPurpose}}"<br />\| where ThreatName matches "{{ThreatName}}"<br />\| where accountId matches "{{accountId}}"<br />\| where region matches "{{region}}"<br />\| where ResourceType matches "{{ResourceType}}"<br />\| where severity matches "{{severity}}"<br />\| timeslice 15m<br />\| count by ThreatPurpose, \_timeslice<br />\| transpose row \_timeslice column ThreatPurpose|
|Amazon GuardDuty - Cloud Security Monitoring and Analytics|High Severity Findings Last Hour|Logs|Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring|\_sourceCategory = Labs/AWS/GuardDuty\* severity<br />\| json "severity"<br />\| json field=\_raw "accountId", "region", "partition", "id", "arn", "type","service.serviceName","service.detectorId","service.action","title","description" nodrop<br />\| parse field=type "\*:\*/\*" as ThreatPurpose,ResourceType,ThreatName<br />\| json field=%service.action "networkConnectionAction.remoteIpDetails.ipAddressV4","networkConnectionAction.localPortDetails.port" as ip, localPort nodrop<br />\| parse "\\"vpcId\\":\\"\*\\"" as vpcId, "\\"subnetId\\":\\"\*\\"" as subnetId,"\\"groupId\\":\\"\*\\"" as securityGroupId,"\\"tags\\":[\*]" as tags,"\\"groupName\\":\\"\*\\"" as securityGroupName nodrop<br />\| json field=\_raw "resource.instanceDetails.instanceId" as instanceid nodrop<br />\| if(severity=0, "Info",if(severity=2, "Low", if(severity=5, "Medium", if(severity=8, "High",if(severity=9.5, "Critical",severity))))) as severity<br />\| where severity = "High"<br />\| where accountId matches "{{accountId}}"<br />\| where region matches "{{region}}"<br />\| where ResourceType matches "{{ResourceType}}"<br />\| timeslice 1h<br />\| count as FindingCount by \_timeslice<br />\| sort \_timeslice|
|Amazon GuardDuty - Cloud Security Monitoring and Analytics|High Severity Outliers|Logs|Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring|\_sourceCategory = Labs/AWS/GuardDuty\* severity<br />\| json "severity"<br />\| json field=\_raw "accountId", "region", "partition", "id", "arn", "type","service.serviceName","service.detectorId","service.action","title","description" nodrop<br />\| parse field=type "\*:\*/\*" as ThreatPurpose,ResourceType,ThreatName<br />\| json field=%service.action "networkConnectionAction.remoteIpDetails.ipAddressV4","networkConnectionAction.localPortDetails.port" as ip, localPort nodrop<br />\| parse "\\"vpcId\\":\\"\*\\"" as vpcId, "\\"subnetId\\":\\"\*\\"" as subnetId,"\\"groupId\\":\\"\*\\"" as securityGroupId,"\\"tags\\":[\*]" as tags,"\\"groupName\\":\\"\*\\"" as securityGroupName nodrop<br />\| json field=\_raw "resource.instanceDetails.instanceId" as instanceid nodrop<br />\| if(severity=0, "Info",if(severity=2, "Low", if(severity=5, "Medium", if(severity=8, "High",if(severity=9.5, "Critical",severity))))) as severity<br />\| where severity = "High"<br />\| where accountId matches "{{accountId}}"<br />\| where region matches "{{region}}"<br />\| where ResourceType matches "{{ResourceType}}"<br />\| timeslice 15m<br />\| count(severity) as findings by \_timeslice<br />\| outlier findings window=5,threshold=4,consecutive=1,direction=+|
|Amazon GuardDuty - Cloud Security Monitoring and Analytics|Last 20 Findings|Logs|Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring|\_sourceCategory = Labs/AWS/GuardDuty\* <br />\| json field=\_raw "accountId", "region", "partition", "id", "arn", "type","service.serviceName","service.detectorId","service.action","severity","title","description" nodrop<br />\| parse field=type "\*:\*/\*" as ThreatPurpose,ResourceType,ThreatName<br />\| json field=%service.action "networkConnectionAction.remoteIpDetails.ipAddressV4","networkConnectionAction.localPortDetails.port" as ip, localPort nodrop<br />\| parse "\\"vpcId\\":\\"\*\\"" as vpcId, "\\"subnetId\\":\\"\*\\"" as subnetId,"\\"groupId\\":\\"\*\\"" as securityGroupId,"\\"tags\\":[\*]" as tags,"\\"groupName\\":\\"\*\\"" as securityGroupName nodrop<br />\| json field=\_raw "resource.instanceDetails.instanceId" as instanceid nodrop<br />\| if(severity=0, "Info",if(severity=2, "Low", if(severity=5, "Medium", if(severity=8, "High",if(severity=9.5, "Critical",severity))))) as severity<br />\| if(!isNull(instanceid),concat ("https://",region,".console.aws.amazon.com/ec2/v2/home?region=",region,"#Instances:search=",instanceid),"") as link<br />\| json field=%service.action "networkConnectionAction.remoteIpDetails.geoLocation.lon" as longitude nodrop<br />\| where accountId matches "{{accountId}}"<br />\| where region matches "{{region}}"<br />\| where ResourceType matches "{{ResourceType}}"<br />\| timeslice 1m<br />\| count by \_timeslice, severity, description, link<br />\| order by \_timeslice<br />\| fields - \_count<br />\| limit 20|
|Amazon GuardDuty - Cloud Security Monitoring and Analytics|Last 20 Low Severity Findings|Logs|Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring|\_sourceCategory = Labs/AWS/GuardDuty\* <br />\| json field=\_raw "accountId", "region", "partition", "id", "arn", "type","service.serviceName","service.detectorId","service.action","severity","title","description" nodrop<br />\| parse field=type "\*:\*/\*" as ThreatPurpose,ResourceType,ThreatName<br />\| json field=%service.action "networkConnectionAction.remoteIpDetails.ipAddressV4","networkConnectionAction.localPortDetails.port" as ip, localPort nodrop<br />\| parse "\\"vpcId\\":\\"\*\\"" as vpcId, "\\"subnetId\\":\\"\*\\"" as subnetId,"\\"groupId\\":\\"\*\\"" as securityGroupId,"\\"tags\\":[\*]" as tags,"\\"groupName\\":\\"\*\\"" as securityGroupName nodrop<br />\| json field=\_raw "resource.instanceDetails.instanceId" as instanceid nodrop<br />\| if(severity=0, "Info",if(severity=2, "Low", if(severity=5, "Medium", if(severity=8, "High",if(severity=9.5, "Critical",severity))))) as severity<br />\| if(!isNull(instanceid),concat ("https://",region,".console.aws.amazon.com/ec2/v2/home?region=",region,"#Instances:search=",instanceid),"") as link<br />\| json field=%service.action "networkConnectionAction.remoteIpDetails.geoLocation.lon" as longitude nodrop<br />\| where severity = "Low"<br />\| where accountId matches "{{accountId}}"<br />\| where region matches "{{region}}"<br />\| where ResourceType matches "{{ResourceType}}"<br />\| timeslice 1m<br />\| count by \_timeslice, accountId, region, resourceType, description, link<br />\| order by \_timeslice<br />\| fields - \_count<br />\| limit 20|
|Amazon GuardDuty - Cloud Security Monitoring and Analytics|Last 20 Medium Severity Findings|Logs|Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring|\_sourceCategory = Labs/AWS/GuardDuty\* <br />\| json field=\_raw "accountId", "region", "partition", "id", "arn", "type","service.serviceName","service.detectorId","service.action","severity","title","description" nodrop<br />\| parse field=type "\*:\*/\*" as ThreatPurpose,ResourceType,ThreatName<br />\| json field=%service.action "networkConnectionAction.remoteIpDetails.ipAddressV4","networkConnectionAction.localPortDetails.port" as ip, localPort nodrop<br />\| parse "\\"vpcId\\":\\"\*\\"" as vpcId, "\\"subnetId\\":\\"\*\\"" as subnetId,"\\"groupId\\":\\"\*\\"" as securityGroupId,"\\"tags\\":[\*]" as tags,"\\"groupName\\":\\"\*\\"" as securityGroupName nodrop<br />\| json field=\_raw "resource.instanceDetails.instanceId" as instanceid nodrop<br />\| if(severity=0, "Info",if(severity=2, "Low", if(severity=5, "Medium", if(severity=8, "High",if(severity=9.5, "Critical",severity))))) as severity<br />\| if(!isNull(instanceid),concat ("https://",region,".console.aws.amazon.com/ec2/v2/home?region=",region,"#Instances:search=",instanceid),"") as link<br />\| json field=%service.action "networkConnectionAction.remoteIpDetails.geoLocation.lon" as longitude nodrop<br />\| where severity = "Medium"<br />\| where accountId matches "{{accountId}}"<br />\| where region matches "{{region}}"<br />\| where ResourceType matches "{{ResourceType}}"<br />\| timeslice 1m<br />\| count by \_timeslice, accountId, region, resourceType, description, link<br />\| order by \_timeslice<br />\| fields - \_count<br />\| limit 20|
|Amazon GuardDuty - Cloud Security Monitoring and Analytics|Last 20 Severity Findings|Logs|Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring|\_sourceCategory = Labs/AWS/GuardDuty\* <br />\| json field=\_raw "accountId", "region", "partition", "id", "arn", "type","service.serviceName","service.detectorId","service.action","severity","title","description" nodrop<br />\| parse field=type "\*:\*/\*" as ThreatPurpose,ResourceType,ThreatName<br />\| json field=%service.action "networkConnectionAction.remoteIpDetails.ipAddressV4","networkConnectionAction.localPortDetails.port" as ip, localPort nodrop<br />\| parse "\\"vpcId\\":\\"\*\\"" as vpcId, "\\"subnetId\\":\\"\*\\"" as subnetId,"\\"groupId\\":\\"\*\\"" as securityGroupId,"\\"tags\\":[\*]" as tags,"\\"groupName\\":\\"\*\\"" as securityGroupName nodrop<br />\| json field=\_raw "resource.instanceDetails.instanceId" as instanceid nodrop<br />\| if(severity=0, "Info",if(severity=2, "Low", if(severity=5, "Medium", if(severity=8, "High",if(severity=9.5, "Critical",severity))))) as severity<br />\| if(!isNull(instanceid),concat ("https://",region,".console.aws.amazon.com/ec2/v2/home?region=",region,"#Instances:search=",instanceid),"") as link<br />\| json field=%service.action "networkConnectionAction.remoteIpDetails.geoLocation.lon" as longitude nodrop<br />\| where severity = "High"<br />\| where accountId matches "{{accountId}}"<br />\| where region matches "{{region}}"<br />\| where ResourceType matches "{{ResourceType}}"<br />\| timeslice 1m<br />\| count by \_timeslice, accountId, region, resourceType, description, link<br />\| order by \_timeslice<br />\| fields - \_count<br />\| limit 20|
|Amazon GuardDuty - Cloud Security Monitoring and Analytics|Latest Findings|Logs|Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Analysis - Security Analytics|<br />\_sourceCategory = Labs/AWS/GuardDuty\* severity<br />\| json "severity"<br />\| json field=\_raw "accountId", "region", "partition", "id", "arn", "type","service.serviceName","service.detectorId","service.action","title","description" nodrop<br />\| parse field=type "\*:\*/\*" as ThreatPurpose,ResourceType,ThreatName<br />\| json field=%service.action "networkConnectionAction.remoteIpDetails.ipAddressV4","networkConnectionAction.localPortDetails.port" as ip, localPort nodrop<br />\| parse "\\"vpcId\\":\\"\*\\"" as vpcId, "\\"subnetId\\":\\"\*\\"" as subnetId,"\\"groupId\\":\\"\*\\"" as securityGroupId,"\\"tags\\":[\*]" as tags,"\\"groupName\\":\\"\*\\"" as securityGroupName nodrop<br />\| json field=\_raw "resource.instanceDetails.instanceId" as instanceid nodrop<br />\| if(severity=0, "Info",if(severity=2, "Low", if(severity=5, "Medium", if(severity=8, "High",if(severity=9.5, "Critical",severity))))) as severity<br />\| where ThreatPurpose matches "{{ThreatPurpose}}"<br />\| where ThreatName matches "{{ThreatName}}"<br />\| where accountId matches "{{accountId}}"<br />\| where region matches "{{region}}"<br />\| where ResourceType matches "{{ResourceType}}"<br />\| where severity matches "{{severity}}"<br />\| timeslice 1m<br />\| count by \_timeslice, severity, ThreatPurpose, ThreatName, accountId, region, resourceType, description<br />\| order by \_timeslice<br />\| fields - \_count|
|Amazon GuardDuty - Cloud Security Monitoring and Analytics|Low Severity Findings Last Hour|Logs|Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring|\_sourceCategory = Labs/AWS/GuardDuty\* severity<br />\| json "severity"<br />\| json field=\_raw "accountId", "region", "partition", "id", "arn", "type","service.serviceName","service.detectorId","service.action","title","description" nodrop<br />\| parse field=type "\*:\*/\*" as ThreatPurpose,ResourceType,ThreatName<br />\| json field=%service.action "networkConnectionAction.remoteIpDetails.ipAddressV4","networkConnectionAction.localPortDetails.port" as ip, localPort nodrop<br />\| parse "\\"vpcId\\":\\"\*\\"" as vpcId, "\\"subnetId\\":\\"\*\\"" as subnetId,"\\"groupId\\":\\"\*\\"" as securityGroupId,"\\"tags\\":[\*]" as tags,"\\"groupName\\":\\"\*\\"" as securityGroupName nodrop<br />\| json field=\_raw "resource.instanceDetails.instanceId" as instanceid nodrop<br />\| if(severity=0, "Info",if(severity=2, "Low", if(severity=5, "Medium", if(severity=8, "High",if(severity=9.5, "Critical",severity))))) as severity<br />\| where severity = "Low"<br />\| where accountId matches "{{accountId}}"<br />\| where region matches "{{region}}"<br />\| where ResourceType matches "{{ResourceType}}"<br />\| timeslice 1h<br />\| count as FindingCount by \_timeslice<br />\| sort \_timeslice|
|Amazon GuardDuty - Cloud Security Monitoring and Analytics|Low Severity Outliers|Logs|Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring|\_sourceCategory = Labs/AWS/GuardDuty\* severity<br />\| json "severity"<br />\| json field=\_raw "accountId", "region", "partition", "id", "arn", "type","service.serviceName","service.detectorId","service.action","title","description" nodrop<br />\| parse field=type "\*:\*/\*" as ThreatPurpose,ResourceType,ThreatName<br />\| json field=%service.action "networkConnectionAction.remoteIpDetails.ipAddressV4","networkConnectionAction.localPortDetails.port" as ip, localPort nodrop<br />\| parse "\\"vpcId\\":\\"\*\\"" as vpcId, "\\"subnetId\\":\\"\*\\"" as subnetId,"\\"groupId\\":\\"\*\\"" as securityGroupId,"\\"tags\\":[\*]" as tags,"\\"groupName\\":\\"\*\\"" as securityGroupName nodrop<br />\| json field=\_raw "resource.instanceDetails.instanceId" as instanceid nodrop<br />\| if(severity=0, "Info",if(severity=2, "Low", if(severity=5, "Medium", if(severity=8, "High",if(severity=9.5, "Critical",severity))))) as severity<br />\| where severity = "Low"<br />\| where accountId matches "{{accountId}}"<br />\| where region matches "{{region}}"<br />\| where ResourceType matches "{{ResourceType}}"<br />\| timeslice 15m<br />\| count(severity) as findings by \_timeslice<br />//\| count by severity, \_timeslice<br />//\| transpose row \_timeslice column severity<br />\| outlier findings window=5,threshold=4,consecutive=1,direction=+|
|Amazon GuardDuty - Cloud Security Monitoring and Analytics|Medium Severity Findings Last Hour|Logs|Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring|\_sourceCategory = Labs/AWS/GuardDuty\* severity<br />\| json "severity"<br />\| json field=\_raw "accountId", "region", "partition", "id", "arn", "type","service.serviceName","service.detectorId","service.action","title","description" nodrop<br />\| parse field=type "\*:\*/\*" as ThreatPurpose,ResourceType,ThreatName<br />\| json field=%service.action "networkConnectionAction.remoteIpDetails.ipAddressV4","networkConnectionAction.localPortDetails.port" as ip, localPort nodrop<br />\| parse "\\"vpcId\\":\\"\*\\"" as vpcId, "\\"subnetId\\":\\"\*\\"" as subnetId,"\\"groupId\\":\\"\*\\"" as securityGroupId,"\\"tags\\":[\*]" as tags,"\\"groupName\\":\\"\*\\"" as securityGroupName nodrop<br />\| json field=\_raw "resource.instanceDetails.instanceId" as instanceid nodrop<br />\| if(severity=0, "Info",if(severity=2, "Low", if(severity=5, "Medium", if(severity=8, "High",if(severity=9.5, "Critical",severity))))) as severity<br />\| where severity = "Medium"<br />\| where accountId matches "{{accountId}}"<br />\| where region matches "{{region}}"<br />\| where ResourceType matches "{{ResourceType}}"<br />\| timeslice 1h<br />\| count as FindingCount by \_timeslice<br />\| sort \_timeslice|
|Amazon GuardDuty - Cloud Security Monitoring and Analytics|Medium Severity Outliers|Logs|Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring|\_sourceCategory = Labs/AWS/GuardDuty\* severity<br />\| json "severity"<br />\| json field=\_raw "accountId", "region", "partition", "id", "arn", "type","service.serviceName","service.detectorId","service.action","title","description" nodrop<br />\| parse field=type "\*:\*/\*" as ThreatPurpose,ResourceType,ThreatName<br />\| json field=%service.action "networkConnectionAction.remoteIpDetails.ipAddressV4","networkConnectionAction.localPortDetails.port" as ip, localPort nodrop<br />\| parse "\\"vpcId\\":\\"\*\\"" as vpcId, "\\"subnetId\\":\\"\*\\"" as subnetId,"\\"groupId\\":\\"\*\\"" as securityGroupId,"\\"tags\\":[\*]" as tags,"\\"groupName\\":\\"\*\\"" as securityGroupName nodrop<br />\| json field=\_raw "resource.instanceDetails.instanceId" as instanceid nodrop<br />\| if(severity=0, "Info",if(severity=2, "Low", if(severity=5, "Medium", if(severity=8, "High",if(severity=9.5, "Critical",severity))))) as severity<br />\| where severity = "Medium"<br />\| where accountId matches "{{accountId}}"<br />\| where region matches "{{region}}"<br />\| where ResourceType matches "{{ResourceType}}"<br />\| timeslice 15m<br />\| count(severity) as findings by \_timeslice<br />\| outlier findings window=5,threshold=4,consecutive=1,direction=+|
|Amazon GuardDuty - Cloud Security Monitoring and Analytics|Total Findings Last Hour|Logs|Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring|\_sourceCategory = Labs/AWS/GuardDuty\* severity<br />\| json "severity"<br />\| json field=\_raw "accountId", "region", "partition", "id", "arn", "type","service.serviceName","service.detectorId","service.action","title","description" nodrop<br />\| parse field=type "\*:\*/\*" as ThreatPurpose,ResourceType,ThreatName<br />\| json field=%service.action "networkConnectionAction.remoteIpDetails.ipAddressV4","networkConnectionAction.localPortDetails.port" as ip, localPort nodrop<br />\| parse "\\"vpcId\\":\\"\*\\"" as vpcId, "\\"subnetId\\":\\"\*\\"" as subnetId,"\\"groupId\\":\\"\*\\"" as securityGroupId,"\\"tags\\":[\*]" as tags,"\\"groupName\\":\\"\*\\"" as securityGroupName nodrop<br />\| json field=\_raw "resource.instanceDetails.instanceId" as instanceid nodrop<br />\| if(severity=0, "Info",if(severity=2, "Low", if(severity=5, "Medium", if(severity=8, "High",if(severity=9.5, "Critical",severity))))) as severity<br />\| where accountId matches "{{accountId}}"<br />\| where region matches "{{region}}"<br />\| where ResourceType matches "{{ResourceType}}"<br />\| timeslice 1h<br />\| count as FindingCount by \_timeslice<br />\| sort \_timeslice|
|Amazon GuardDuty - Cloud Security Monitoring and Analytics|Trending All Findings|Logs|Amazon GuardDuty - Cloud Security Monitoring and Analytics/Amazon GuardDuty Overview - Security Monitoring|\_sourceCategory = Labs/AWS/GuardDuty\* severity<br />\| json "severity"<br />\| json field=\_raw "accountId", "region", "partition", "id", "arn", "type","service.serviceName","service.detectorId","service.action","title","description" nodrop<br />\| parse field=type "\*:\*/\*" as ThreatPurpose,ResourceType,ThreatName<br />\| json field=%service.action "networkConnectionAction.remoteIpDetails.ipAddressV4","networkConnectionAction.localPortDetails.port" as ip, localPort nodrop<br />\| parse "\\"vpcId\\":\\"\*\\"" as vpcId, "\\"subnetId\\":\\"\*\\"" as subnetId,"\\"groupId\\":\\"\*\\"" as securityGroupId,"\\"tags\\":[\*]" as tags,"\\"groupName\\":\\"\*\\"" as securityGroupName nodrop<br />\| json field=\_raw "resource.instanceDetails.instanceId" as instanceid nodrop<br />\| if(severity=0, "Info",if(severity=2, "Low", if(severity=5, "Medium", if(severity=8, "High",if(severity=9.5, "Critical",severity))))) as severity<br />\| where accountId matches "{{accountId}}"<br />\| where region matches "{{region}}"<br />\| where ResourceType matches "{{ResourceType}}"<br />\| timeslice 15m<br />\| count by severity, \_timeslice<br />\| transpose row \_timeslice column severity|

