# Azure Cosmos DB for PostgreSQL

## Searches

### Log Searches

- **Average Query Duration**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Queries 
- **Average Query Duration by Server**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Queries 
- **Connection Errors**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Network 
- **Connection Errors**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Network 
- **Connections Authorized by  Database - Over Time**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Security 
- **Database Shut Down Events**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Errors 
- **Database System Up Events**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Errors 
- **Distribution  by Operation Type (Read, Write and Delete)**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Administrative Operations 
- **Distribution by Operations**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Administrative Operations 
- **Distribution by Status**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Administrative Operations 
- **Errors by Cluster**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview 
- **Errors by Cluster**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Errors 
- **Errors by Logical Server Name**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Queries 
- **Errors by Server**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Errors 
- **Errors by Sql Errcode**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Errors 
- **Failed Authentication by Server - Over Time**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Security 
- **Failed Authentications**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Security 
- **Failed Authentications by Server and User**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Security 
- **Geolocation of Incoming Connections**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Security 
- **Log by Severity**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Errors 
- **LogLevel Distribution**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview 
- **Nodes by Cluster**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview 
- **Query Distribution by Duration (excluding citus extension)**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview 
- **Query Execution Statistics**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Queries 
- **Query Executions by Server**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Queries 
- **Recent connection errors**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Network 
- **Recent Delete Operations**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Administrative Operations 
- **Recent Resource Health Incidents**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Health 
- **Recent Service Health Incidents**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Health 
- **Recent Write Operations**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Administrative Operations 
- **Recently Denied Operations**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Security 
- **Resource Health by  Status**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Health 
- **Service Health by Incident Type**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Health 
- **Service Health by Incident Type**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Health 
- **Top 10 Error Statements**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Errors 
- **Top 10 Fatal and Panic Errors**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Errors 
- **Top 10 Longest sessions**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Network 
- **Top 10 operations that caused the most errors**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Administrative Operations 
- **Top 10 Query Syntax Errors**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Queries 
- **Top 3 Common Errors by Server**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview 
- **Total Errors**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Errors 
- **Total Queries**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Queries 
- **Users / Applications by Operation type**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Administrative Operations

### Metric Searches

- **Average IOPS**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Performance 
- **Average Memory Utilisation**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Performance 
- **Average Storage Used**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Storage 
- **Average Storage Utilisation**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Storage 
- **Max Active Connections**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview 
- **Max Active Connections**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Network 
- **Max CPU Utilisation**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Performance 
- **Max Reserved Memory Utilisation**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Performance 
- **Max Storage Utilisation**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Storage 
- **Network Activity by Cluster**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview 
- **Network In**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Network 
- **Network Out**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Network 
- **Replication lag by Cluster**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview 
- **Top 10 cluster by Max CPU Utilisation**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview 
- **Top 10 cluster by Max Memory Utilisation**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview 
- **Top 10 cluster by Max Storage Utilisation**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview 
- **Total Storage Used**: from Dashboard: Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Storage

## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Azure Cosmos DB for PostgreSQL|Average IOPS|Metrics|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=iops   statistic=average \| avg by resource\_group, resource\_name |
|Azure Cosmos DB for PostgreSQL|Average Memory Utilisation|Metrics|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=memory\_percent   statistic=average \| avg by resource\_group, resource\_name |
|Azure Cosmos DB for PostgreSQL|Average Query Duration|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Queries|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs duration<br />\| json "category", "properties.errorLevel", "properties.statement", "properties.message", "properties.sqlerrcode", "properties.ReplicaRole", "properties.LogicalServerName" as category, errorLevel, statement, message, sqlerrcode, ReplicaRole, server\_name<br />\| where category="PostgreSQLLogs"<br />\| parse regex field=message "duration: (?\<execution\_time\_ms\>[\\S]+) ms" <br />\| number (execution\_time\_ms)<br />\| avg(execution\_time\_ms) |
|Azure Cosmos DB for PostgreSQL|Average Query Duration by Server|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Queries|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs duration<br />\| json "category", "properties.errorLevel", "properties.statement", "properties.message", "properties.sqlerrcode", "properties.ReplicaRole", "properties.LogicalServerName" as category, errorLevel, statement, message, sqlerrcode, ReplicaRole, server\_name<br />\| where category="PostgreSQLLogs"<br />\| parse regex field=message "duration: (?\<execution\_time\_ms\>[\\S]+) ms" <br />\| number (execution\_time\_ms)<br />\| format("resource\_group=%s resource\_name=%s server\_name=%s", resource\_group, resource\_name, server\_name) as resource\_identifier<br />\| timeslice 15m<br />\| avg(execution\_time\_ms) by \_timeslice, resource\_identifier<br />\| transpose row \_timeslice column resource\_identifier|
|Azure Cosmos DB for PostgreSQL|Average Storage Used|Metrics|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Storage|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=storage\_used statistic=average  \| avg by resource\_group, resource\_name |
|Azure Cosmos DB for PostgreSQL|Average Storage Utilisation|Metrics|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Storage|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=storage\_percent statistic=average \| avg|
|Azure Cosmos DB for PostgreSQL|Connection Errors|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Network|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} \*connect\*<br />\| json "properties.LogicalServerName", "properties.errorLevel", "properties.ReplicaRole", "properties.message", "properties.statement", "properties.timestamp" as server\_name, errorLevel, replica\_role, message, statement, timestamp<br />\|  where errorLevel in ("ERROR", "PANIC", "FATAL") or message matches /(PANIC\|FATAL\|ERROR)/<br />\| count|
|Azure Cosmos DB for PostgreSQL|Connection Errors|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Network|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} \*connect\*<br />\| json "properties.LogicalServerName", "properties.errorLevel", "properties.ReplicaRole", "properties.message", "properties.statement", "properties.timestamp" as server\_name, errorLevel, replica\_role, message, statement, timestamp<br />\|  where errorLevel in ("ERROR", "PANIC", "FATAL") or message matches /(PANIC\|FATAL\|ERROR)/<br />\| timeslice 5m<br />\| count as Count by resource\_group, resource\_name, server\_name, \_timeslice<br />\| format("resource\_group=%s resource\_name=%s server\_name=%s", resource\_group, resource\_name, server\_name) as resource\_identifier<br />\| fields -resource\_group, resource\_name, server\_name<br />\| transpose row \_timeslice column resource\_identifier|
|Azure Cosmos DB for PostgreSQL|Connections Authorized by  Database - Over Time|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Security| tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs "connection authorized" <br />\| json "category", "properties.errorLevel", "properties.message", "properties.sqlerrcode", "properties.LogicalServerName" as category, errorLevel, message, sqlerrcode, server\_name <br />\| where category="PostgreSQLLogs"<br />\| parse regex field=message "user=(?\<user\>[\\S]+) database=(?\<database\>[\\S]+)"<br />\| timeslice 1h<br />\| count by \_timeslice, database, server\_name<br />\| transpose row \_timeslice column database, server\_name|
|Azure Cosmos DB for PostgreSQL|Database Shut Down Events|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs ("database system" AND "shut down")<br />\| json "category", "properties.message", "properties.ReplicaRole" as category, message, ReplicaRole<br />\| where category="PostgreSQLLogs"<br />\| count by resource\_group, resource\_name, ReplicaRole, message<br />\| sort by \_count asc|
|Azure Cosmos DB for PostgreSQL|Database System Up Events|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs "database system is ready to accept connections"<br />\| json "category", "properties.message", "properties.ReplicaRole" as category, message, ReplicaRole<br />\| where category="PostgreSQLLogs"<br />\| count by resource\_group, resource\_name, ReplicaRole, message<br />\| sort by \_count asc|
|Azure Cosmos DB for PostgreSQL|Distribution  by Operation Type (Read, Write and Delete)|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Administrative Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name={{resource\_name}} provider\_name={{provider\_name}} resource\_type={{resource\_type}} Administrative <br />\| json "resultType", "category", "operationName", "resourceId" as resultType, category, operationName, resourceid<br />\| where (resultType="Accept" or resultType="Success") and category="Administrative"<br />\| "OTHERS" as operationType<br />\| if (toUppercase(operationName) matches /WRITE/, "WRITE", operationType) as operationType <br />\| if (toUppercase(operationName) matches /READ/, "READ", operationType) as operationType <br />\| if (toUppercase(operationName) matches /DELETE/, "DELETE", operationType) as operationType <br />\| count by operationType<br />\| sort by \_count, operationType asc|
|Azure Cosmos DB for PostgreSQL|Distribution by Operations|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Administrative Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name={{resource\_name}} provider\_name={{provider\_name}} resource\_type={{resource\_type}} Administrative <br />\| json "resultType", "category", "operationName", "resourceId" as resultType, category, operationName, resourceid<br />\| where (resultType="Accept" or resultType="Success") and category="Administrative" <br />\| parse field=operationName "\*/\*/\*" as provider\_name, resource\_type, operation\_name<br />\| count by operation\_name<br />\| order by \_count, operation\_name asc|
|Azure Cosmos DB for PostgreSQL|Distribution by Status|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Administrative Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name={{resource\_name}} provider\_name={{provider\_name}} resource\_type={{resource\_type}} Administrative <br />\| json "resultType", "category" as resultType, category<br />\| where category="Administrative" <br />\| count by resultType<br />\| order by \_count, resultType asc|
|Azure Cosmos DB for PostgreSQL|Errors by Cluster|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs sqlerrcode !00000<br />\| json "category", "properties.sqlerrcode", "properties.LogicalServerName", "properties.errorLevel" as category, sqlerrcode, server\_name, errorLevel<br />\| where category="PostgreSQLLogs" and (!(sqlerrcode="00000") or errorLevel in ("ERROR", "PANIC", "FATAL"))<br />\| count by resource\_group, resource\_name|
|Azure Cosmos DB for PostgreSQL|Errors by Cluster|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs (WARNING OR FATAL OR ERROR)<br />\| json "category", "properties.sqlerrcode", "properties.errorLevel", "properties.LogicalServerName" as category, sqlerrcode, errorLevel, server\_name<br />\| where category="PostgreSQLLogs" and (!(sqlerrcode="00000") or errorLevel in ("ERROR", "PANIC", "FATAL"))<br />\| timeslice 5m<br />\| count by resource\_group, resource\_name, errorLevel, \_timeslice<br />\| format ("resource\_group=%s resource\_name=%s error\_level=%s", resource\_group, resource\_name, errorLevel) as resource\_identifier<br />\| fields -resource\_group, resource\_name, errorLevel<br />\| transpose row \_timeslice column resource\_identifier|
|Azure Cosmos DB for PostgreSQL|Errors by Logical Server Name|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Queries|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs (WARNING OR FATAL OR ERROR OR PANIC)<br />\| json "category", "properties.LogicalServerName", "properties.errorLevel" as category, server\_name, errorLevel<br />\| where category="PostgreSQLLogs"<br />\| timeslice 5m<br />\| count by resource\_group, resource\_name, server\_name, \_timeslice<br />\| format ("resource\_group=%s resource\_name=%s server\_name=%s", resource\_group, resource\_name, server\_name) as resource\_identifier<br />\| fields -resource\_group, resource\_name, server\_name<br />\| transpose row \_timeslice column resource\_identifier|
|Azure Cosmos DB for PostgreSQL|Errors by Server|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs sqlerrcode !00000<br />\| json "category", "properties.sqlerrcode", "properties.errorLevel", "properties.LogicalServerName" as category, sqlerrcode,errorLevel, server\_name<br />\| where category="PostgreSQLLogs" and (!(sqlerrcode="00000") or errorLevel in ("ERROR", "PANIC", "FATAL"))<br />\| count by resource\_group, resource\_name, server\_name|
|Azure Cosmos DB for PostgreSQL|Errors by Sql Errcode|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs sqlerrcode !00000<br />\| json "category", "properties.sqlerrcode", "properties.errorLevel" as category, sqlerrcode, errorLevel<br />\| where category="PostgreSQLLogs" and (!(sqlerrcode="00000") or errorLevel in ("ERROR", "PANIC", "FATAL"))<br />\| count by sqlerrcode<br />\| top 10 sqlerrcode by \_count|
|Azure Cosmos DB for PostgreSQL|Failed Authentication by Server - Over Time|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Security| tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs  "authentication failed"<br /> \| json "category", "properties.LogicalServerName", "properties.message" as category, server\_name, message \| where message matches /fail/ and message matches /authentication/ <br />\| timeslice 1h<br />\| count by \_timeslice, server\_name<br />\| transpose row \_timeslice column server\_name|
|Azure Cosmos DB for PostgreSQL|Failed Authentications|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Security| tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs  "authentication failed"<br /> \| json "category", "properties.LogicalServerName", "properties.message" as category, server\_name, message \| where message matches /failed/ and message matches /authentication/ <br />\| count as %"Count" |
|Azure Cosmos DB for PostgreSQL|Failed Authentications by Server and User|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Security|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs  "authentication failed"<br /> \| json "category", "properties.LogicalServerName", "properties.message" as category, server\_name, message <br /> \| parse field=message "authentication failed for user \\"\*\\"" as user<br /> \| where message matches /failed/ and message matches /authentication/ <br /> \| count as Count by resource\_name, server\_name, user<br /> \| sort by %"Count"|
|Azure Cosmos DB for PostgreSQL|Geolocation of Incoming Connections|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Security|tenant\_name=\* subscription\_id=\* resource\_group=\* resource\_name=\* resource\_type=SERVERGROUPSV2 provider\_name=MICROSOFT.DBFORPOSTGRESQL location=\* PostgreSQLLogs connection <br />\| json "category", "properties.errorLevel", "properties.message", "properties.sqlerrcode" as category, errorLevel, message, sqlerrcode <br />\| where category="PostgreSQLLogs"  <br />\| parse field=message "connection received: host=[\*]" as ip<br />\| where !(ip matches "localhost" or ip matches "127.0.0.1" or ip matches "local") <br />\| count by ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count<br />|
|Azure Cosmos DB for PostgreSQL|Log by Severity|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs errorLevel<br />\| json "category", "properties.errorLevel" as category, errorLevel<br />\| where category="PostgreSQLLogs"<br />\| count by errorLevel<br />\| sort by \_count, errorLevel asc|
|Azure Cosmos DB for PostgreSQL|LogLevel Distribution|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} <br />\| json "properties.timestamp", "operationName", "properties.errorLevel", "properties.LogicalServerName", "properties.ReplicaRole", "properties.message" as timestamp, operationName, errorLevel, serverName, replicaRole, message<br />\| count by errorLevel<br />\| sort by \_count|
|Azure Cosmos DB for PostgreSQL|Max Active Connections|Metrics|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Network|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=active\_connections   statistic=maximum \| max by resource\_group, resource\_name |
|Azure Cosmos DB for PostgreSQL|Max Active Connections|Metrics|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=active\_connections   statistic=maximum \| max by resource\_group, resource\_name |
|Azure Cosmos DB for PostgreSQL|Max CPU Utilisation|Metrics|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=cpu\_percent  statistic=maximum \| max by resource\_group, resource\_name |
|Azure Cosmos DB for PostgreSQL|Max Reserved Memory Utilisation|Metrics|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Performance|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=apps\_reserved\_memory\_percent   statistic=maximum \| max by resource\_group, resource\_name |
|Azure Cosmos DB for PostgreSQL|Max Storage Utilisation|Metrics|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Storage|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=storage\_percent statistic=maximum  \| quantize using max \| max by resource\_group, resource\_name |
|Azure Cosmos DB for PostgreSQL|Network Activity by Cluster|Metrics|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} (metric=network\_bytes\_egress or metric=network\_bytes\_ingress)   statistic=total \| quantize using sum \| sum by resource\_group, resource\_name, metric |
|Azure Cosmos DB for PostgreSQL|Network In|Metrics|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Network|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=network\_bytes\_ingress    statistic=total \| quantize using sum \| sum by resource\_group, resource\_name |
|Azure Cosmos DB for PostgreSQL|Network Out|Metrics|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Network|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=network\_bytes\_egress    statistic=total \| quantize using sum \| sum by resource\_group, resource\_name |
|Azure Cosmos DB for PostgreSQL|Nodes by Cluster|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} <br />\| json "properties.timestamp", "operationName", "properties.errorLevel", "properties.LogicalServerName", "properties.ReplicaRole", "properties.message" as timestamp, operationName, errorLevel, serverName, replicaRole, message<br />\| count by resource\_name, servername, replicaRole<br />\| count as nodes by resource\_name, replicaRole|
|Azure Cosmos DB for PostgreSQL|Query Distribution by Duration (excluding citus extension)|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs duration !citus<br />\| json "category", "properties.errorLevel", "properties.statement", "properties.message", "properties.sqlerrcode", "properties.ReplicaRole", "properties.LogicalServerName" as category, errorLevel, statement, message, sqlerrcode, ReplicaRole, server\_name<br />\| where category="PostgreSQLLogs"<br />\| parse regex field=message "duration: (?\<execution\_time\_ms\>[\\S]+) ms" <br />\| number (execution\_time\_ms)<br />\| bin execution\_time\_ms width=100, min = 0, max = 5000<br />\| count by \_bin\_label, server\_name<br />\| transpose row \_bin\_label column server\_name|
|Azure Cosmos DB for PostgreSQL|Query Execution Statistics|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Queries|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs duration<br />\| json "category", "properties.errorLevel", "properties.statement", "properties.message", "properties.sqlerrcode", "properties.ReplicaRole", "properties.LogicalServerName" as category, errorLevel, statement, message, sqlerrcode, ReplicaRole, server\_name<br />\| where category="PostgreSQLLogs"<br />\| parse regex field=message "duration: (?\<execution\_time\_ms\>[\\S]+) ms" <br />\| number (execution\_time\_ms)<br />\| count as total\_queries, avg(execution\_time\_ms) as mean\_execution\_time, pct(execution\_time\_ms, 75) as %"75\_pct\_execution\_time", pct(execution\_time\_ms, 95) as %"95\_pct\_execution\_time", pct(execution\_time\_ms, 99) as %"99\_pct\_execution\_time" by resource\_group, resource\_name, server\_name |
|Azure Cosmos DB for PostgreSQL|Query Executions by Server|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Queries|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs duration<br />\| json "category", "properties.errorLevel", "properties.statement", "properties.message", "properties.sqlerrcode", "properties.ReplicaRole", "properties.LogicalServerName" as category, errorLevel, statement, message, sqlerrcode, ReplicaRole, server\_name<br />\| where category="PostgreSQLLogs"<br />\| parse regex field=message "duration: (?\<execution\_time\_ms\>[\\S]+) ms" <br />\| number (execution\_time\_ms)<br />\| format("resource\_group=%s resource\_name=%s server\_name=%s", resource\_group, resource\_name, server\_name) as resource\_identifier<br />\| timeslice 15m<br />\| count by \_timeslice, resource\_identifier<br />\| transpose row \_timeslice column resource\_identifier|
|Azure Cosmos DB for PostgreSQL|Recent connection errors|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Network|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} \*connect\*<br />\| json "properties.LogicalServerName", "properties.errorLevel", "properties.ReplicaRole", "properties.message", "properties.statement", "properties.timestamp" as server\_name, errorLevel, replica\_role, message, statement, timestamp<br />\| where errorLevel in ("ERROR", "PANIC", "FATAL") or message matches /(PANIC\|FATAL\|ERROR)/<br />\| parse field=message "\* UTC [\*][\*] : \*" as time, process\_id, transaction\_id, error\_message<br />\| count as Count by resource\_name, server\_name, error\_message<br />\| sort by Count desc|
|Azure Cosmos DB for PostgreSQL|Recent Delete Operations|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Administrative Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name = {{resource\_name}} provider\_name={{provider\_name}} resource\_type={{resource\_type}}  Administrative <br />\| JSON "properties.statusCode", "properties.message", "resultType", "category", "operationName", "callerIpAddress", "resultSignature", "level", "identity.claims.idtyp", "identity.claims.name", "identity.claims.appid", "properties.entity", "\$['identity']['claims']['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name']","\$['identity']['claims']['http://schemas.microsoft.com/claims/authnmethodsreferences']" as statusCode, message, resultType, category, operationName, callerIpAddress, resultSignature, level, idtyp, name, appid, entity, identity\_claims\_name, authmethods nodrop<br />\| where resultType in ("Accept", "Success") and category="Administrative" and toUppercase(operationName) matches /DELETE/ <br />\| if (idtyp =="user", name, appid) as name<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as time<br />\| count by \_messageTime, time, resource\_name, callerIpAddress, name, identity\_claims\_name, authmethods, resultSignature, statusCode, message, entity<br />\| sort by \_messageTime desc<br />\| limit 20 <br />\| fields -\_count,\_messageTime|
|Azure Cosmos DB for PostgreSQL|Recent Resource Health Incidents|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Health|tenant\_name={{tenant\_name}} <br />provider\_name={{provider\_name}}<br />resource\_type={{resource\_type}}<br />subscription\_id={{subscription\_id}}<br />resource\_group={{resource\_group}}<br />resource\_name={{resource\_name}} ResourceHealth <br />\| JSON "category", "operationName", "time","level","resultType", "properties.title", "properties.details", "properties.currentHealthStatus", "properties.type", "properties.cause" as category, operationName, time,level,resultType, title, details, currentHealthStatus, type, cause nodrop<br />\| where category="ResourceHealth"<br />\| parse field=operationName "\*/\*/\*" as category, operation\_name, action nodrop<br />\| count as Count by time, level, resource\_name, resource\_group, resultType, operation\_name, title, details, currentHealthStatus, type, cause|
|Azure Cosmos DB for PostgreSQL|Recent Service Health Incidents|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Health|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} ServiceHealth<br />\| JSON "category", "properties.incidentType", "properties.service", "properties.region", "properties.impactedServices" as category, incidentType, service, service\_region, impactedServices nodrop<br />\| replace(toLowerCase(service\_region), " ", "") as service\_region <br />\| where service\_region matches "{{location}}"<br />\| where category="ServiceHealth" and (toUpperCase(service) matches /COSMOS/ or toUpperCase(impactedServices) matches /COSMOS/)<br />\| parse field=operationName "\*/\*/\*" as category, operation\_name, action nodrop<br />\| count as Count by time , level, service, impactedServices, resultType, operation\_name, impactStartTime, impactMitigationTime, defaultLanguageTitle, stage|
|Azure Cosmos DB for PostgreSQL|Recent Write Operations|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Administrative Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name = {{resource\_name}} provider\_name={{provider\_name}} resource\_type={{resource\_type}}  Administrative <br />\| JSON "properties.statusCode", "properties.message", "resultType", "category", "operationName", "callerIpAddress", "resultSignature", "level", "identity.claims.idtyp", "identity.claims.name", "identity.claims.appid", "\$['identity']['claims']['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name']","\$['identity']['claims']['http://schemas.microsoft.com/claims/authnmethodsreferences']"  as statusCode, message, resultType, category, operationName, callerIpAddress, resultSignature, level, idtyp, name, appid, identity\_claims\_name, authmethods nodrop<br />\| where category="Administrative" and resultType in ("Accept", "Success") and toUppercase(operationName) matches /WRITE/<br />\| if (idtyp =="user", name, appid) as name<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as time<br />\| count by \_messageTime, time, resource\_name, callerIpAddress, name, identity\_claims\_name, authmethods, resultSignature, statusCode, message<br />\| sort by \_messageTime desc<br />\| limit 20 <br />\| fields -\_count,\_messageTime|
|Azure Cosmos DB for PostgreSQL|Recently Denied Operations|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Security|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} ("permission denied" or 42501)<br />\| json "properties.LogicalServerName", "properties.errorLevel", "properties.ReplicaRole", "properties.message", "properties.statement", "properties.sqlerrcode", "properties.timestamp" as server\_name, errorLevel, replica\_role, message, statement, sqlerrorcode, timestamp<br />\| where message matches /denied/<br />\| count by timestamp, resource\_group, resource\_name, server\_name, sqlerrorcode, message, statement|
|Azure Cosmos DB for PostgreSQL|Replication lag by Cluster|Metrics|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=replication\_lag statistic=average  \| avg by resource\_group, resource\_name |
|Azure Cosmos DB for PostgreSQL|Resource Health by  Status|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Health|tenant\_name={{tenant\_name}}<br />provider\_name={{provider\_name}}<br />resource\_type={{resource\_type}}<br />subscription\_id={{subscription\_id}}<br />resource\_group={{resource\_group}}<br />resource\_name={{resource\_name}} ResourceHealth <br />\| JSON "category", "properties.currentHealthStatus" as category, currentHealthStatus<br />\| where category="ResourceHealth"<br />\| count as Count by currentHealthStatus|
|Azure Cosmos DB for PostgreSQL|Service Health by Incident Type|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Health|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} ServiceHealth<br />\| JSON "category", "properties.incidentType", "properties.service", "properties.region", "properties.impactedServices" as category, incidentType, service, service\_region, impactedServices nodrop<br />\| replace(toLowerCase(service\_region), " ", "") as service\_region <br />\| where service\_region matches "{{location}}"<br />\| where category="ServiceHealth" and (toUpperCase(service) matches /COSMOS/ or toUpperCase(impactedServices) matches /COSMOS/)<br />\| count as Count by incidentType|
|Azure Cosmos DB for PostgreSQL|Service Health by Incident Type|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Health|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} ServiceHealth<br />\| JSON "category", "properties.incidentType", "properties.service", "properties.region", "properties.impactedServices" as category, incidentType, service, service\_region, impactedServices nodrop<br />\| replace(toLowerCase(service\_region), " ", "") as service\_region <br />\| where service\_region matches "{{location}}"<br />\| where category="ServiceHealth" and (toUpperCase(service) matches /COSMOS/ or toUpperCase(impactedServices) matches /COSMOS/)<br />\| count by incidentType<br />\| order by incidentType|
|Azure Cosmos DB for PostgreSQL|Top 10 cluster by Max CPU Utilisation|Metrics|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=cpu\_percent  statistic=maximum  \| quantize using max \| max by resource\_group, resource\_name \| topk(10, max) by resource\_group, resource\_name |
|Azure Cosmos DB for PostgreSQL|Top 10 cluster by Max Memory Utilisation|Metrics|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=memory\_percent  statistic=maximum  \| quantize using max \| max by resource\_group, resource\_name \| topk(10, max) by resource\_group, resource\_name |
|Azure Cosmos DB for PostgreSQL|Top 10 cluster by Max Storage Utilisation|Metrics|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=storage\_percent statistic=maximum  \| quantize using max \| max by resource\_group, resource\_name \| topk(10, max) by resource\_group, resource\_name |
|Azure Cosmos DB for PostgreSQL|Top 10 Error Statements|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs errorLevel<br />\| json "category", "properties.errorLevel", "properties.statement", "properties.message", "properties.sqlerrcode", "properties.ReplicaRole" as category, errorLevel, statement, message, sqlerrcode, ReplicaRole<br />\| where category="PostgreSQLLogs" and (errorLevel="ERROR" or toLowerCase(message) matches /error/)<br />\| parse field=message "\* [\*][\*] : \* \*" as time, process\_id, transaction\_id, application, error\_message<br />\| count as Count by resource\_group, resource\_name, ReplicaRole, sqlerrcode, statement, error\_message<br />\| sort by Count desc<br />\| limit 10|
|Azure Cosmos DB for PostgreSQL|Top 10 Fatal and Panic Errors|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Errors|tenant\_name=\* subscription\_id=\* resource\_group=\* resource\_name=\* resource\_type=SERVERGROUPSV2 provider\_name=MICROSOFT.DBFORPOSTGRESQL location=\* PostgreSQLLogs errorLevel<br />\| json "category", "properties.errorLevel", "properties.message", "properties.sqlerrcode", "properties.ReplicaRole" as category, errorLevel, message, sqlerrcode, ReplicaRole nodrop<br />\| where category="PostgreSQLLogs" and (errorLevel="FATAL" or toLowerCase(message) matches /fatal/ or errorLevel="PANIC" or toLowerCase(message) matches /panic/)<br />\| parse field=message "\* [\*][\*] : \* \*" as time, process\_id, transaction\_id, application, error\_message<br />\| count as Count by resource\_group, resource\_name, ReplicaRole, sqlerrcode, statement, error\_message<br />\| sort by Count desc<br />\| limit 10|
|Azure Cosmos DB for PostgreSQL|Top 10 Longest sessions|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Network|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} "disconnection"<br />\| json "properties.LogicalServerName", "properties.errorLevel", "properties.ReplicaRole", "properties.message", "properties.statement", "properties.timestamp" as server\_name, errorLevel, replica\_role, message, statement, timestamp<br />\| parse field=message "session time: \* user=\* database=\* host=\*" as time, db\_user, database, host<br />\| count by time, resource\_name, server\_name, db\_user, database<br />\| fields -\_count<br />\| sort by time desc<br />\| limit 10|
|Azure Cosmos DB for PostgreSQL|Top 10 operations that caused the most errors|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Administrative Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name = {{resource\_name}} provider\_name={{provider\_name}} resource\_type={{resource\_type}}  Administrative<br />\| json "resultType", "operationName", "properties.statusMessage", "category"  as resultType, operationName, failureMessage, category nodrop<br />\| parse field=operationname "\*/\*/\*" as provider\_name, resource\_type, operation nodrop<br />\| where category="Administrative" and (resultType="Failure" or resultType="Unknown")<br />\| if (isBlank(failureMessage), "Unknown Error", failureMessage) as failureMessage<br />\| count as Count by resource\_name, operation, failureMessage<br />\| order by Count <br />\| limit 10|
|Azure Cosmos DB for PostgreSQL|Top 10 Query Syntax Errors|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Queries|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs errorLevel ("syntax" and "error")<br />\| json "category", "properties.errorLevel", "properties.statement", "properties.message", "properties.sqlerrcode", "properties.LogicalServerName" as category, errorLevel, statement, message, sqlerrcode, server\_name<br />\| where category="PostgreSQLLogs" and message matches "\*syntax error\*"<br />\| parse field=message "\* [\*][\*] : \* \*" as time, process\_id, transaction\_id, application, error\_message<br />\| count as Count by resource\_group, resource\_name, server\_name, error\_message, statement<br />\| sort by Count desc<br />\| limit 10|
|Azure Cosmos DB for PostgreSQL|Top 3 Common Errors by Server|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs sqlerrcode !00000<br />\| json "category", "properties.sqlerrcode", "properties.errorLevel", "properties.LogicalServerName","properties.message" as category, sqlerrcode,errorLevel, server\_name, message<br />\| where category="PostgreSQLLogs" and (!(sqlerrcode="00000") or errorLevel in ("ERROR", "PANIC", "FATAL"))<br />\| parse field=message "\* [\*][\*] : \* \*" as time, process\_id, transaction\_id, application, error\_message<br />\| count by error\_message, resource\_name, server\_name<br />\| topk(3, \_count)  by resource\_name, server\_name|
|Azure Cosmos DB for PostgreSQL|Total Errors|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Errors|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs errorLevel<br />\| json "category", "properties.sqlerrcode", "properties.errorLevel", "properties.LogicalServerName" as category, sqlerrcode,errorLevel, server\_name<br />\| where category="PostgreSQLLogs" and (!(sqlerrcode="00000") or errorLevel in ("ERROR", "PANIC", "FATAL"))<br />\| count |
|Azure Cosmos DB for PostgreSQL|Total Queries|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Queries|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} resource\_name={{resource\_name}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} location={{location}} PostgreSQLLogs duration<br />\| json "category", "properties.errorLevel", "properties.statement", "properties.message", "properties.sqlerrcode", "properties.ReplicaRole", "properties.LogicalServerName" as category, errorLevel, statement, message, sqlerrcode, ReplicaRole, server\_name<br />\| where category="PostgreSQLLogs"<br />\| parse regex field=message "duration: (?\<execution\_time\_ms\>[\\S]+) ms" <br />\| number (execution\_time\_ms)<br />\| count|
|Azure Cosmos DB for PostgreSQL|Total Storage Used|Metrics|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Storage|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=storage\_used statistic=average  \| sum  \| eval \_value / (1024\*1024\*1024)|
|Azure Cosmos DB for PostgreSQL|Users / Applications by Operation type|Logs|Installed Apps/Azure Cosmos DB for PostgreSQL/Azure Cosmos DB for PostgreSQL - Administrative Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name={{resource\_name}} provider\_name={{provider\_name}} resource\_type={{resource\_type}} Administrative <br />\| JSON "properties.statusCode", "properties.message", "resultType", "category", "operationName", "callerIpAddress", "resultSignature", "level", "identity.claims.idtyp", "identity.claims.name", "identity.claims.appid" as statusCode, message, resultType, category, operationName, callerIpAddress, resultSignature, level, idtyp, name, appid nodrop<br />\| where resultType in ("Accept", "Success") and category="Administrative" <br />\| if (idtyp =="user", name, appid) as name<br />\| "Others" as operationType<br />\| if (toUppercase(operationName) matches /WRITE/, "WRITE", operationType) as operationType <br />\| if (toUppercase(operationName) matches /READ/, "READ", operationType) as operationType <br />\| if (toUppercase(operationName) matches /DELETE/, "DELETE", operationType) as operationType <br />\| count by name, operationType<br />\| transpose row name column operationType|

