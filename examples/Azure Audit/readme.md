# Azure Audit
## Sumo Logic App For: Azure Audit
The Sumo Logic App for Azure Audit allows you to monitor the health of your Azure environment. The App provides preconfigured Dashboards that allow you to monitor resource usage, service health, and user activity.
Docs Link: [Azure Audit](https://help.sumologic.com/?cid=6011)

## Searches

### Log Searches

- **Azure Activity by Source Location**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - Overview 
- **Azure Activity by Source Location**: from Dashboard: Azure Audit/Azure Audit - Overview - New 
- **Events by Caller**: from Dashboard: Azure Audit/Azure Audit - Overview - New 
- **Events by Caller**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - Overview 
- **Events by Category**: from Dashboard: Azure Audit/Azure Audit - Overview - New 
- **Events by Category**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - Overview 
- **Events By Level**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - Overview 
- **Events By Level**: from Dashboard: Azure Audit/Azure Audit - Overview - New 
- **Events by Location**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - User Activity 
- **Events by Resource Group**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - Resource Usage 
- **Events by Resource Group**: from Dashboard: Azure Audit/Azure Audit - Resource Usage - New 
- **Events by Resource Group**: from Dashboard: Azure Audit/Azure Audit - Overview - New 
- **Events by Resource Group**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - Overview 
- **Events by Resource Provider**: from Dashboard: Azure Audit/Azure Audit - Resource Usage - New 
- **Events by Resource Provider**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - Resource Usage 
- **Events By Status**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - Overview 
- **Events By Status**: from Dashboard: Azure Audit/Azure Audit - Overview - New 
- **Events by User**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - User Activity 
- **Events Details**: from Dashboard: Azure Audit/Azure Audit - Service Health - New 
- **Events Details**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - Service Health 
- **Events Over Time**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - Service Health 
- **Events Over Time**: from Dashboard: Azure Audit/Azure Audit - Service Health - New 
- **Level**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - Service Health 
- **Level**: from Dashboard: Azure Audit/Azure Audit - Service Health - New 
- **Operations by Resource Group**: from Dashboard: Azure Audit/Azure Audit - Resource Usage - New 
- **Operations by Resource Group**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - Resource Usage 
- **Operations by Resource Provider**: from Dashboard: Azure Audit/Azure Audit - Resource Usage - New 
- **Operations by Resource Provider**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - Resource Usage 
- **Operations by User**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - User Activity 
- **Resource Creations**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - User Activity 
- **Resource Deletions**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - User Activity 
- **Resource Group Events**: from Dashboard: Azure Audit/Azure Audit - Resource Usage - New 
- **Resource Group Events**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - Resource Usage 
- **Resource Groups by Caller**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - User Activity 
- **Resource Provider Events**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - Resource Usage 
- **Resource Provider Events**: from Dashboard: Azure Audit/Azure Audit - Resource Usage - New 
- **Resource Providers by Resource Groups**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - Resource Usage 
- **Resource Providers by Resource Groups**: from Dashboard: Azure Audit/Azure Audit - Resource Usage - New 
- **Status**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - Service Health 
- **Status**: from Dashboard: Azure Audit/Azure Audit - Service Health - New 
- **Top 10 Users**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - User Activity 
- **Unresolved Events**: from Dashboard: Azure Audit/Azure Audit - Service Health - New 
- **Unresolved Events**: from Dashboard: Installed Apps/Azure Audit/Azure Audit - Service Health

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Azure Audit|Azure Activity by Source Location|Logs|Installed Apps/Azure Audit/Azure Audit - Overview|\_sourceCategory={{Logsdatasource}}  (callerIpAddress or (HttpRequest ClientIpAddress))<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "identity.claims.name", "Caller" as src\_user1, src\_user2 nodrop // "identity.claims.name" EventHub, "Caller" Azure Insight API<br />\| json "callerIpAddress", "HttpRequest.ClientIpAddress" as src\_ip1, src\_ip2 nodrop // "callerIpAddress" EventHub, "HttpRequest.ClientIpAddress" API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (src\_user1, src\_user2) as src\_user<br />\| concat (src\_ip1, src\_ip2) as src\_ip<br />\| concat (Category1, Category2) as Category<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields Level, Status, src\_user, src\_ip, Category, OperationName<br />\|where if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by src\_ip \| where !isEmpty(src\_ip)<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = src\_ip<br />\| count by latitude, longitude<br />\| where !isNull(latitude)|
|Azure Audit|Azure Activity by Source Location|Logs|Azure Audit/Azure Audit - Overview - New|\_sourceCategory = Labs/Azure/Audit (callerIpAddress or (HttpRequest ClientIpAddress))<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "identity.claims.name", "Caller" as src\_user1, src\_user2 nodrop // "identity.claims.name" EventHub, "Caller" Azure Insight API<br />\| json "callerIpAddress", "HttpRequest.ClientIpAddress" as src\_ip1, src\_ip2 nodrop // "callerIpAddress" EventHub, "HttpRequest.ClientIpAddress" API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (src\_user1, src\_user2) as src\_user<br />\| concat (src\_ip1, src\_ip2) as src\_ip<br />\| concat (Category1, Category2) as Category<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields Level, Status, src\_user, src\_ip, Category, OperationName<br />\|where if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by src\_ip \| where !isEmpty(src\_ip)<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = src\_ip<br />\| count by latitude, longitude<br />\| where !isNull(latitude)|
|Azure Audit|Events by Caller|Logs|Azure Audit/Azure Audit - Overview - New|\_sourceCategory = Labs/Azure/Audit ((identity claims name) or Caller)<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "identity.claims.name", "Caller" as src\_user1, src\_user2 nodrop // "identity.claims.name" EventHub, "Caller" Azure Insight API<br />\| json "callerIpAddress", "HttpRequest.ClientIpAddress" as src\_ip1, src\_ip2 nodrop // "callerIpAddress" EventHub, "HttpRequest.ClientIpAddress" API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (src\_user1, src\_user2) as src\_user<br />\| concat (src\_ip1, src\_ip2) as src\_ip<br />\| concat (Category1, Category2) as Category<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields Level, Status, src\_user, src\_ip, Category, OperationName<br />\| timeslice 1d<br />\|where if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by \_timeslice, src\_user<br />\| where !isEmpty(src\_user)<br />\| transpose row \_timeslice column src\_user|
|Azure Audit|Events by Caller|Logs|Installed Apps/Azure Audit/Azure Audit - Overview|\_sourceCategory={{Logsdatasource}}  ((identity claims name) or Caller)<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "identity.claims.name", "Caller" as src\_user1, src\_user2 nodrop // "identity.claims.name" EventHub, "Caller" Azure Insight API<br />\| json "callerIpAddress", "HttpRequest.ClientIpAddress" as src\_ip1, src\_ip2 nodrop // "callerIpAddress" EventHub, "HttpRequest.ClientIpAddress" API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (src\_user1, src\_user2) as src\_user<br />\| concat (src\_ip1, src\_ip2) as src\_ip<br />\| concat (Category1, Category2) as Category<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields Level, Status, src\_user, src\_ip, Category, OperationName<br />\| timeslice 1d<br />\|where if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by \_timeslice, src\_user<br />\| where !isEmpty(src\_user)<br />\| transpose row \_timeslice column src\_user|
|Azure Audit|Events by Category|Logs|Azure Audit/Azure Audit - Overview - New|\_sourceCategory = Labs/Azure/Audit ((properties eventCategory) or Category)<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "identity.claims.name", "Caller" as src\_user1, src\_user2 nodrop // "identity.claims.name" EventHub, "Caller" Azure Insight API<br />\| json "callerIpAddress", "HttpRequest.ClientIpAddress" as src\_ip1, src\_ip2 nodrop // "callerIpAddress" EventHub, "HttpRequest.ClientIpAddress" API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (src\_user1, src\_user2) as src\_user<br />\| concat (src\_ip1, src\_ip2) as src\_ip<br />\| concat (Category1, Category2) as Category<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields Level, Status, src\_user, src\_ip, Category, OperationName<br />\| timeslice 1d<br />\|where if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by Category, \_timeslice<br />\| transpose row \_timeslice column Category|
|Azure Audit|Events by Category|Logs|Installed Apps/Azure Audit/Azure Audit - Overview|\_sourceCategory={{Logsdatasource}}  ((properties eventCategory) or Category)<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "identity.claims.name", "Caller" as src\_user1, src\_user2 nodrop // "identity.claims.name" EventHub, "Caller" Azure Insight API<br />\| json "callerIpAddress", "HttpRequest.ClientIpAddress" as src\_ip1, src\_ip2 nodrop // "callerIpAddress" EventHub, "HttpRequest.ClientIpAddress" API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (src\_user1, src\_user2) as src\_user<br />\| concat (src\_ip1, src\_ip2) as src\_ip<br />\| concat (Category1, Category2) as Category<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields Level, Status, src\_user, src\_ip, Category, OperationName<br />\| timeslice 1d<br />\|where if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by Category, \_timeslice<br />\| transpose row \_timeslice column Category|
|Azure Audit|Events By Level|Logs|Installed Apps/Azure Audit/Azure Audit - Overview|\_sourceCategory={{Logsdatasource}}  (level or Level)<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "identity.claims.name", "Caller" as src\_user1, src\_user2 nodrop // "identity.claims.name" EventHub, "Caller" Azure Insight API<br />\| json "callerIpAddress", "HttpRequest.ClientIpAddress" as src\_ip1, src\_ip2 nodrop // "callerIpAddress" EventHub, "HttpRequest.ClientIpAddress" API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (src\_user1, src\_user2) as src\_user<br />\| concat (src\_ip1, src\_ip2) as src\_ip<br />\| concat (Category1, Category2) as Category<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields Level, Status, src\_user, src\_ip, Category, OperationName<br />\|where if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by Level \| where !isEmpty(Level)<br />\| sort by \_count|
|Azure Audit|Events By Level|Logs|Azure Audit/Azure Audit - Overview - New|\_sourceCategory = Labs/Azure/Audit (level or Level)<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "identity.claims.name", "Caller" as src\_user1, src\_user2 nodrop // "identity.claims.name" EventHub, "Caller" Azure Insight API<br />\| json "callerIpAddress", "HttpRequest.ClientIpAddress" as src\_ip1, src\_ip2 nodrop // "callerIpAddress" EventHub, "HttpRequest.ClientIpAddress" API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (src\_user1, src\_user2) as src\_user<br />\| concat (src\_ip1, src\_ip2) as src\_ip<br />\| concat (Category1, Category2) as Category<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields Level, Status, src\_user, src\_ip, Category, OperationName<br />\|where if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by Level \| where !isEmpty(Level)<br />\| sort by \_count|
|Azure Audit|Events by Location|Logs|Installed Apps/Azure Audit/Azure Audit - User Activity|\_sourceCategory={{Logsdatasource}}  (callerIpAddress or (HttpRequest ClientIpAddress))<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "identity.claims.name", "Caller" as src\_user1, src\_user2 nodrop // "identity.claims.name" EventHub, "Caller" Azure Insight API<br />\| json "callerIpAddress", "HttpRequest.ClientIpAddress" as src\_ip1, src\_ip2 nodrop // "callerIpAddress" EventHub, "HttpRequest.ClientIpAddress" API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "category", "EventName" as EventName1, EventName2 nodrop // "category" EventHub, "EventName" Azure Insight API <br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (src\_user1, src\_user2) as src\_user<br />\| concat (src\_ip1, src\_ip2) as src\_ip<br />\| concat (Category1, Category2) as Category<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| concat (EventName1, EventName2) as EventName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields Level, Status, src\_user, src\_ip, Category, OperationName, EventName<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by src\_ip \| where !isEmpty(src\_ip)<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = src\_ip<br />\| count by latitude, longitude<br />\| where !isNull(latitude)|
|Azure Audit|Events by Resource Group|Logs|Installed Apps/Azure Audit/Azure Audit - Resource Usage|\_sourceCategory={{Logsdatasource}}  ((resourceId RESOURCEGROUPS) or (ResourceGroupName))<br />\| json "resourceId" as resourceId1 nodrop // EventHub<br />\| parse regex field=resourceId1 "/RESOURCEGROUPS/(?\<ResourceGroupName1\>[^/]+)" nodrop<br />\| json "ResourceGroupName" as ResourceGroupName2 nodrop // Azure Insight API using our Powershell scripts <br />\| if (isEmpty(ResourceGroupName1), ResourceGroupName2, ResourceGroupName1) as ResourceGroupName<br />\| where !isEmpty(ResourceGroupName)<br />\| tolowercase(ResourceGroupName) as ResourceGroupName<br />\| fields ResourceGroupName<br />\| timeslice 1d<br />\|where if ("{{resourcegroupname}}" = "\*", true, resourcegroupname matches "{{resourcegroupname}}")<br />\|count by ResourceGroupName, \_timeslice<br />\| transpose row \_timeslice column ResourceGroupName|
|Azure Audit|Events by Resource Group|Logs|Azure Audit/Azure Audit - Resource Usage - New|\_sourceCategory = Labs/Azure/Audit ((resourceId RESOURCEGROUPS) or (ResourceGroupName))<br />\| json "resourceId" as resourceId1 nodrop // EventHub<br />\| parse regex field=resourceId1 "/RESOURCEGROUPS/(?\<ResourceGroupName1\>[^/]+)" nodrop<br />\| json "ResourceGroupName" as ResourceGroupName2 nodrop // Azure Insight API using our Powershell scripts <br />\| if (isEmpty(ResourceGroupName1), ResourceGroupName2, ResourceGroupName1) as ResourceGroupName<br />\| where !isEmpty(ResourceGroupName)<br />\| tolowercase(ResourceGroupName) as ResourceGroupName<br />\| fields ResourceGroupName<br />\| timeslice 1d<br />\|where if ("{{resourcegroupname}}" = "\*", true, resourcegroupname matches "{{resourcegroupname}}")<br />\|count by ResourceGroupName, \_timeslice<br />\| transpose row \_timeslice column ResourceGroupName|
|Azure Audit|Events by Resource Group|Logs|Azure Audit/Azure Audit - Overview - New|\_sourceCategory = Labs/Azure/Audit ((resourceId RESOURCEGROUPS) or ResourceGroupName)<br />\| json "resourceId" as resourceId1 nodrop // EventHub<br />\| parse regex field=resourceId1 "/RESOURCEGROUPS/(?\<ResourceGroupName1\>[^/]+)" nodrop // EventHub<br />\| json "ResourceGroupName" as ResourceGroupName2 nodrop // Azure Insight API using our Powershell scripts <br />\| if (isEmpty(ResourceGroupName1), ResourceGroupName2, ResourceGroupName1) as ResourceGroupName<br />\| where !isEmpty(ResourceGroupName)<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "identity.claims.name", "Caller" as src\_user1, src\_user2 nodrop // "identity.claims.name" EventHub, "Caller" Azure Insight API<br />\| json "callerIpAddress", "HttpRequest.ClientIpAddress" as src\_ip1, src\_ip2 nodrop // "callerIpAddress" EventHub, "HttpRequest.ClientIpAddress" API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (src\_user1, src\_user2) as src\_user<br />\| concat (src\_ip1, src\_ip2) as src\_ip<br />\| concat (Category1, Category2) as Category<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields Level, Status, src\_user, src\_ip, Category, OperationName, ResourceGroupName<br />\| timeslice 1d<br />\| tolowercase(ResourceGroupName) as ResourceGroupName<br />\|where if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by ResourceGroupName, \_timeslice<br />\| transpose row \_timeslice column ResourceGroupName|
|Azure Audit|Events by Resource Group|Logs|Installed Apps/Azure Audit/Azure Audit - Overview|\_sourceCategory={{Logsdatasource}}  ((resourceId RESOURCEGROUPS) or ResourceGroupName)<br />\| json "resourceId" as resourceId1 nodrop // EventHub<br />\| parse regex field=resourceId1 "/RESOURCEGROUPS/(?\<ResourceGroupName1\>[^/]+)" nodrop // EventHub<br />\| json "ResourceGroupName" as ResourceGroupName2 nodrop // Azure Insight API using our Powershell scripts <br />\| if (isEmpty(ResourceGroupName1), ResourceGroupName2, ResourceGroupName1) as ResourceGroupName<br />\| where !isEmpty(ResourceGroupName)<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "identity.claims.name", "Caller" as src\_user1, src\_user2 nodrop // "identity.claims.name" EventHub, "Caller" Azure Insight API<br />\| json "callerIpAddress", "HttpRequest.ClientIpAddress" as src\_ip1, src\_ip2 nodrop // "callerIpAddress" EventHub, "HttpRequest.ClientIpAddress" API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (src\_user1, src\_user2) as src\_user<br />\| concat (src\_ip1, src\_ip2) as src\_ip<br />\| concat (Category1, Category2) as Category<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields Level, Status, src\_user, src\_ip, Category, OperationName, ResourceGroupName<br />\| timeslice 1d<br />\| tolowercase(ResourceGroupName) as ResourceGroupName<br />\|where if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by ResourceGroupName, \_timeslice<br />\| transpose row \_timeslice column ResourceGroupName|
|Azure Audit|Events by Resource Provider|Logs|Azure Audit/Azure Audit - Resource Usage - New|\_sourceCategory = Labs/Azure/Audit ((resourceId PROVIDERS) or (ResourceProviderName))<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "resourceId" as resourceId1 nodrop // EventHub<br />\| parse regex field=resourceId1 "/PROVIDERS/(?\<ResourceProviderName1\>[^/]+)" nodrop // EventHub<br />\| json "ResourceProviderName" as ResourceProviderName2 nodrop // Azure Insight API using our Powershell scripts <br />\| concat (OperationName1, OperationName2) as OperationName<br />\| if (isEmpty(ResourceProviderName1), ResourceProviderName2, ResourceProviderName1) as ResourceProviderName<br />\| where !isEmpty(ResourceProviderName)<br />\| tolowercase(ResourceProviderName) as ResourceProviderName<br />\| fields ResourceProviderName, OperationName<br />\| timeslice 1d<br />\|where if ("{{resourceprovidername}}" = "\*", true, resourceprovidername matches "{{resourceprovidername}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}")<br />\|count by ResourceProviderName, \_timeslice<br />\| transpose row \_timeslice column ResourceProviderName|
|Azure Audit|Events by Resource Provider|Logs|Installed Apps/Azure Audit/Azure Audit - Resource Usage|\_sourceCategory={{Logsdatasource}}  ((resourceId PROVIDERS) or (ResourceProviderName))<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "resourceId" as resourceId1 nodrop // EventHub<br />\| parse regex field=resourceId1 "/PROVIDERS/(?\<ResourceProviderName1\>[^/]+)" nodrop // EventHub<br />\| json "ResourceProviderName" as ResourceProviderName2 nodrop // Azure Insight API using our Powershell scripts <br />\| concat (OperationName1, OperationName2) as OperationName<br />\| if (isEmpty(ResourceProviderName1), ResourceProviderName2, ResourceProviderName1) as ResourceProviderName<br />\| where !isEmpty(ResourceProviderName)<br />\| tolowercase(ResourceProviderName) as ResourceProviderName<br />\| fields ResourceProviderName, OperationName<br />\| timeslice 1d<br />\|where if ("{{resourceprovidername}}" = "\*", true, resourceprovidername matches "{{resourceprovidername}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}")<br />\|count by ResourceProviderName, \_timeslice<br />\| transpose row \_timeslice column ResourceProviderName|
|Azure Audit|Events By Status|Logs|Installed Apps/Azure Audit/Azure Audit - Overview|\_sourceCategory={{Logsdatasource}}  (resultType or Status)<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "identity.claims.name", "Caller" as src\_user1, src\_user2 nodrop // "identity.claims.name" EventHub, "Caller" Azure Insight API<br />\| json "callerIpAddress", "HttpRequest.ClientIpAddress" as src\_ip1, src\_ip2 nodrop // "callerIpAddress" EventHub, "HttpRequest.ClientIpAddress" API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (src\_user1, src\_user2) as src\_user<br />\| concat (src\_ip1, src\_ip2) as src\_ip<br />\| concat (Category1, Category2) as Category<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields Level, Status, src\_user, src\_ip, Category, OperationName<br />\| timeslice 1d<br />\|where if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by Status, \_timeslice<br />\| where !isEmpty(Status)<br />\| transpose row \_timeslice column Status|
|Azure Audit|Events By Status|Logs|Azure Audit/Azure Audit - Overview - New|\_sourceCategory = Labs/Azure/Audit (resultType or Status)<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "identity.claims.name", "Caller" as src\_user1, src\_user2 nodrop // "identity.claims.name" EventHub, "Caller" Azure Insight API<br />\| json "callerIpAddress", "HttpRequest.ClientIpAddress" as src\_ip1, src\_ip2 nodrop // "callerIpAddress" EventHub, "HttpRequest.ClientIpAddress" API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (src\_user1, src\_user2) as src\_user<br />\| concat (src\_ip1, src\_ip2) as src\_ip<br />\| concat (Category1, Category2) as Category<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields Level, Status, src\_user, src\_ip, Category, OperationName<br />\| timeslice 1d<br />\|where if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by Status, \_timeslice<br />\| where !isEmpty(Status)<br />\| transpose row \_timeslice column Status|
|Azure Audit|Events by User|Logs|Installed Apps/Azure Audit/Azure Audit - User Activity|\_sourceCategory={{Logsdatasource}}  ((identity claims name operationName category) or (Caller OperationName Category EventName))<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "identity.claims.name", "Caller" as src\_user1, src\_user2 nodrop // "identity.claims.name" EventHub, "Caller" Azure Insight API<br />\| json "callerIpAddress", "HttpRequest.ClientIpAddress" as src\_ip1, src\_ip2 nodrop // "callerIpAddress" EventHub, "HttpRequest.ClientIpAddress" API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "category", "EventName" as EventName1, EventName2 nodrop // "category" EventHub, "EventName" Azure Insight API <br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (src\_user1, src\_user2) as src\_user<br />\| concat (src\_ip1, src\_ip2) as src\_ip<br />\| concat (Category1, Category2) as Category<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| concat (EventName1, EventName2) as EventName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| toLowerCase(OperationName) as OperationName<br />\| where !(OperationName matches "\*listkeys/action") and Category != "ServiceHealth"<br />\| fields Level, Status, src\_user, src\_ip, Category, OperationName, EventName<br />\| timeslice 1d<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by \_timeslice, src\_user<br />\| transpose row \_timeslice column src\_user|
|Azure Audit|Events Details|Logs|Azure Audit/Azure Audit - Service Health - New|\_sourceCategory = Labs/Azure/Audit "ServiceHealth" ((properties eventCategory level resultType) or (Category Level Status))<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "resultDescription", "Description" as Description1, Description2 nodrop // "resultDescription" EventHub, "Description" Azure Insight API<br />\| json "correlationId", "CorrelationId" as CorrelationId1, CorrelationId2 nodrop // "correlationId" EventHub, "CorrelationId" Azure Insight API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "category", "EventName" as EventName1, EventName2 nodrop // "category" EventHub, "EventName" Azure Insight API <br />\| json "location" as Location nodrop // EventHub<br />\| concat (Category1, Category2) as Category<br />\| where Category = "ServiceHealth"<br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| concat (Description1, Description2) as Description<br />\| concat (CorrelationId1, CorrelationId2) as CorrelationId<br />\| concat (EventName1, EventName2) as EventName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields OperationName, Description, CorrelationId, Level, EventName, Location, Status, Category<br />\| withtime Status \| withtime \_messagetime<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{description}}" = "\*", true, description matches "{{description}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{location}}" = "\*", true, location matches "{{location}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}") AND if ("{{correlationid}}" = "\*", true, correlationid matches "{{correlationid}}")<br />\|most\_recent(Status\_withtime) as Status, most\_recent(\_messagetime\_withtime) as Time by OperationName, Description, CorrelationId, Level, EventName, Location<br />\| sort by Time<br />\| formatDate(toLong(Time),"yyyy-MM-dd HH:mm:ss Z") as Time|
|Azure Audit|Events Details|Logs|Installed Apps/Azure Audit/Azure Audit - Service Health|\_sourceCategory={{Logsdatasource}}  "ServiceHealth" ((properties eventCategory level resultType) or (Category Level Status))<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "resultDescription", "Description" as Description1, Description2 nodrop // "resultDescription" EventHub, "Description" Azure Insight API<br />\| json "correlationId", "CorrelationId" as CorrelationId1, CorrelationId2 nodrop // "correlationId" EventHub, "CorrelationId" Azure Insight API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "category", "EventName" as EventName1, EventName2 nodrop // "category" EventHub, "EventName" Azure Insight API <br />\| json "location" as Location nodrop // EventHub<br />\| concat (Category1, Category2) as Category<br />\| where Category = "ServiceHealth"<br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| concat (Description1, Description2) as Description<br />\| concat (CorrelationId1, CorrelationId2) as CorrelationId<br />\| concat (EventName1, EventName2) as EventName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields OperationName, Description, CorrelationId, Level, EventName, Location, Status, Category<br />\| withtime Status \| withtime \_messagetime<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{description}}" = "\*", true, description matches "{{description}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{location}}" = "\*", true, location matches "{{location}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}") AND if ("{{correlationid}}" = "\*", true, correlationid matches "{{correlationid}}")<br />\|most\_recent(Status\_withtime) as Status, most\_recent(\_messagetime\_withtime) as Time by OperationName, Description, CorrelationId, Level, EventName, Location<br />\| sort by Time<br />\| formatDate(toLong(Time),"yyyy-MM-dd HH:mm:ss Z") as Time|
|Azure Audit|Events Over Time|Logs|Installed Apps/Azure Audit/Azure Audit - Service Health|\_sourceCategory={{Logsdatasource}}  "ServiceHealth" ((properties eventCategory level) or (Category Level))<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "resultDescription", "Description" as Description1, Description2 nodrop // "resultDescription" EventHub, "Description" Azure Insight API<br />\| json "correlationId", "CorrelationId" as CorrelationId1, CorrelationId2 nodrop // "correlationId" EventHub, "CorrelationId" Azure Insight API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "category", "EventName" as EventName1, EventName2 nodrop // "category" EventHub, "EventName" Azure Insight API <br />\| json "location" as Location nodrop // EventHub<br />\| concat (Category1, Category2) as Category<br />\| where Category = "ServiceHealth"<br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| concat (Description1, Description2) as Description<br />\| concat (CorrelationId1, CorrelationId2) as CorrelationId<br />\| concat (EventName1, EventName2) as EventName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields OperationName, Description, CorrelationId, Level, EventName, Location, Status, Category<br />\| timeslice 1d<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{description}}" = "\*", true, description matches "{{description}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{location}}" = "\*", true, location matches "{{location}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}") AND if ("{{correlationid}}" = "\*", true, correlationid matches "{{correlationid}}")<br />\|count by \_timeslice, Level<br />\| transpose row \_timeslice column Level|
|Azure Audit|Events Over Time|Logs|Azure Audit/Azure Audit - Service Health - New|\_sourceCategory = Labs/Azure/Audit "ServiceHealth" ((properties eventCategory level) or (Category Level))<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "resultDescription", "Description" as Description1, Description2 nodrop // "resultDescription" EventHub, "Description" Azure Insight API<br />\| json "correlationId", "CorrelationId" as CorrelationId1, CorrelationId2 nodrop // "correlationId" EventHub, "CorrelationId" Azure Insight API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "category", "EventName" as EventName1, EventName2 nodrop // "category" EventHub, "EventName" Azure Insight API <br />\| json "location" as Location nodrop // EventHub<br />\| concat (Category1, Category2) as Category<br />\| where Category = "ServiceHealth"<br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| concat (Description1, Description2) as Description<br />\| concat (CorrelationId1, CorrelationId2) as CorrelationId<br />\| concat (EventName1, EventName2) as EventName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields OperationName, Description, CorrelationId, Level, EventName, Location, Status, Category<br />\| timeslice 1d<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{description}}" = "\*", true, description matches "{{description}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{location}}" = "\*", true, location matches "{{location}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}") AND if ("{{correlationid}}" = "\*", true, correlationid matches "{{correlationid}}")<br />\|count by \_timeslice, Level<br />\| transpose row \_timeslice column Level|
|Azure Audit|Level|Logs|Installed Apps/Azure Audit/Azure Audit - Service Health|\_sourceCategory={{Logsdatasource}}  "ServiceHealth" ((properties eventCategory level) or (category Level))<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "resultDescription", "Description" as Description1, Description2 nodrop // "resultDescription" EventHub, "Description" Azure Insight API<br />\| json "correlationId", "CorrelationId" as CorrelationId1, CorrelationId2 nodrop // "correlationId" EventHub, "CorrelationId" Azure Insight API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "category", "EventName" as EventName1, EventName2 nodrop // "category" EventHub, "EventName" Azure Insight API <br />\| json "location" as Location nodrop // EventHub<br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| concat (Description1, Description2) as Description<br />\| concat (CorrelationId1, CorrelationId2) as CorrelationId<br />\| concat (Category1, Category2) as Category<br />\| concat (EventName1, EventName2) as EventName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields Level, Status, Category, OperationName, Description, CorrelationId, EventName, Location<br />\| where Category = "ServiceHealth"<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{description}}" = "\*", true, description matches "{{description}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{location}}" = "\*", true, location matches "{{location}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}") AND if ("{{correlationid}}" = "\*", true, correlationid matches "{{correlationid}}")<br />\|count by Level<br />\| sort by \_count desc|
|Azure Audit|Level|Logs|Azure Audit/Azure Audit - Service Health - New|\_sourceCategory = Labs/Azure/Audit "ServiceHealth" ((properties eventCategory level) or (category Level))<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "resultDescription", "Description" as Description1, Description2 nodrop // "resultDescription" EventHub, "Description" Azure Insight API<br />\| json "correlationId", "CorrelationId" as CorrelationId1, CorrelationId2 nodrop // "correlationId" EventHub, "CorrelationId" Azure Insight API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "category", "EventName" as EventName1, EventName2 nodrop // "category" EventHub, "EventName" Azure Insight API <br />\| json "location" as Location nodrop // EventHub<br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| concat (Description1, Description2) as Description<br />\| concat (CorrelationId1, CorrelationId2) as CorrelationId<br />\| concat (Category1, Category2) as Category<br />\| concat (EventName1, EventName2) as EventName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields Level, Status, Category, OperationName, Description, CorrelationId, EventName, Location<br />\| where Category = "ServiceHealth"<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{description}}" = "\*", true, description matches "{{description}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{location}}" = "\*", true, location matches "{{location}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}") AND if ("{{correlationid}}" = "\*", true, correlationid matches "{{correlationid}}")<br />\|count by Level<br />\| sort by \_count desc|
|Azure Audit|Operations by Resource Group|Logs|Azure Audit/Azure Audit - Resource Usage - New|\_sourceCategory = Labs/Azure/Audit ((resourceId RESOURCEGROUPS operationName) or (ResourceGroupName OperationName))<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "resourceId" as resourceId1 nodrop // EventHub<br />\| parse regex field=resourceId1 "/RESOURCEGROUPS/(?\<ResourceGroupName1\>[^/]+)" nodrop // EventHub<br />\| json "ResourceGroupName" as ResourceGroupName2 nodrop // Azure Insight API using our Powershell scripts <br />\| concat (OperationName1, OperationName2) as OperationName<br />\| if (isEmpty(ResourceGroupName1), ResourceGroupName2, ResourceGroupName1) as ResourceGroupName<br />\| parse field=OperationName "/\*" as action<br />\| tolowercase(ResourceGroupName) as ResourceGroupName<br />\| fields ResourceGroupName, action, OperationName<br />\|where if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{resourcegroupname}}" = "\*", true, resourcegroupname matches "{{resourcegroupname}}")<br />\|count by ResourceGroupName, action<br />\| transpose row ResourceGroupName column action|
|Azure Audit|Operations by Resource Group|Logs|Installed Apps/Azure Audit/Azure Audit - Resource Usage|\_sourceCategory={{Logsdatasource}}  ((resourceId RESOURCEGROUPS operationName) or (ResourceGroupName OperationName))<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "resourceId" as resourceId1 nodrop // EventHub<br />\| parse regex field=resourceId1 "/RESOURCEGROUPS/(?\<ResourceGroupName1\>[^/]+)" nodrop // EventHub<br />\| json "ResourceGroupName" as ResourceGroupName2 nodrop // Azure Insight API using our Powershell scripts <br />\| concat (OperationName1, OperationName2) as OperationName<br />\| if (isEmpty(ResourceGroupName1), ResourceGroupName2, ResourceGroupName1) as ResourceGroupName<br />\| parse field=OperationName "/\*" as action<br />\| tolowercase(ResourceGroupName) as ResourceGroupName<br />\| fields ResourceGroupName, action, OperationName<br />\|where if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{resourcegroupname}}" = "\*", true, resourcegroupname matches "{{resourcegroupname}}")<br />\|count by ResourceGroupName, action<br />\| transpose row ResourceGroupName column action|
|Azure Audit|Operations by Resource Provider|Logs|Azure Audit/Azure Audit - Resource Usage - New|\_sourceCategory = Labs/Azure/Audit ((PROVIDERS resourceId operationName) or (ResourceProviderName OperationName))<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "resourceId" as resourceId1 nodrop // EventHub<br />\| parse regex field=resourceId1 "/PROVIDERS/(?\<ResourceProviderName1\>[^/]+)" nodrop // EventHub<br />\| json "ResourceProviderName" as ResourceProviderName2 nodrop // Azure Insight API using our Powershell scripts <br />\| concat (OperationName1, OperationName2) as OperationName<br />\| if (isEmpty(ResourceProviderName1), ResourceProviderName2, ResourceProviderName1) as ResourceProviderName<br />\| parse field=operationName "/\*" as action<br />\| where !isEmpty(ResourceProviderName)<br />\| tolowercase(ResourceProviderName) as ResourceProviderName<br />\| fields ResourceProviderName, action, OperationName<br />\|where if ("{{resourceprovidername}}" = "\*", true, resourceprovidername matches "{{resourceprovidername}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}")<br />\|count by ResourceProviderName, action<br />\| transpose row ResourceProviderName column action|
|Azure Audit|Operations by Resource Provider|Logs|Installed Apps/Azure Audit/Azure Audit - Resource Usage|\_sourceCategory={{Logsdatasource}}  ((PROVIDERS resourceId operationName) or (ResourceProviderName OperationName))<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "resourceId" as resourceId1 nodrop // EventHub<br />\| parse regex field=resourceId1 "/PROVIDERS/(?\<ResourceProviderName1\>[^/]+)" nodrop // EventHub<br />\| json "ResourceProviderName" as ResourceProviderName2 nodrop // Azure Insight API using our Powershell scripts <br />\| concat (OperationName1, OperationName2) as OperationName<br />\| if (isEmpty(ResourceProviderName1), ResourceProviderName2, ResourceProviderName1) as ResourceProviderName<br />\| parse field=operationName "/\*" as action<br />\| where !isEmpty(ResourceProviderName)<br />\| tolowercase(ResourceProviderName) as ResourceProviderName<br />\| fields ResourceProviderName, action, OperationName<br />\|where if ("{{resourceprovidername}}" = "\*", true, resourceprovidername matches "{{resourceprovidername}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}")<br />\|count by ResourceProviderName, action<br />\| transpose row ResourceProviderName column action|
|Azure Audit|Operations by User|Logs|Installed Apps/Azure Audit/Azure Audit - User Activity|\_sourceCategory={{Logsdatasource}}  ((identity claims name operationName) or (Caller OperationName))<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "identity.claims.name", "Caller" as src\_user1, src\_user2 nodrop // "identity.claims.name" EventHub, "Caller" Azure Insight API<br />\| json "callerIpAddress", "HttpRequest.ClientIpAddress" as src\_ip1, src\_ip2 nodrop // "callerIpAddress" EventHub, "HttpRequest.ClientIpAddress" API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "category", "EventName" as EventName1, EventName2 nodrop // "category" EventHub, "EventName" Azure Insight API <br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (src\_user1, src\_user2) as src\_user<br />\| concat (src\_ip1, src\_ip2) as src\_ip<br />\| concat (Category1, Category2) as Category<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| concat (EventName1, EventName2) as EventName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| where Category \<\> "ServiceHealth"<br />\| parse field=OperationName "/\*" as action<br />\| where !(isEmpty(src\_user) and isEmpty(action))<br />\| fields Level, Status, src\_user, src\_ip, Category, OperationName, EventName, action<br />\| timeslice 1d<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by src\_user, action<br />\| transpose row src\_user column action|
|Azure Audit|Resource Creations|Logs|Installed Apps/Azure Audit/Azure Audit - User Activity|\_sourceCategory={{Logsdatasource}}  operationName (category or Eventname) WRITE<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "identity.claims.name", "Caller" as src\_user1, src\_user2 nodrop // "identity.claims.name" EventHub, "Caller" Azure Insight API<br />\| json "callerIpAddress", "HttpRequest.ClientIpAddress" as src\_ip1, src\_ip2 nodrop // "callerIpAddress" EventHub, "HttpRequest.ClientIpAddress" API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "category", "EventName" as EventName1, EventName2 nodrop // "category" EventHub, "EventName" Azure Insight API <br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (src\_user1, src\_user2) as src\_user<br />\| concat (src\_ip1, src\_ip2) as src\_ip<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| concat (EventName1, EventName2) as EventName<br />\| concat (Category1, Category2) as Category<br />\| parse field=operationName "\*/\*/\*" as provider, object, action nodrop<br />\| parse field=operationName "\*/\*/\*/\*" as provider, object, subject, action nodrop<br />\| where action in ("WRITE", "Write", "write") or EventName in ("Write")<br />\| fields Level, Status, src\_user, src\_ip, OperationName, EventName, provider, object, subject, action, Category<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by object<br />\| sort by \_count|
|Azure Audit|Resource Deletions|Logs|Installed Apps/Azure Audit/Azure Audit - User Activity|\_sourceCategory={{Logsdatasource}}  operationName (category or Eventname) (DELETE or REMOVE)<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "identity.claims.name", "Caller" as src\_user1, src\_user2 nodrop // "identity.claims.name" EventHub, "Caller" Azure Insight API<br />\| json "callerIpAddress", "HttpRequest.ClientIpAddress" as src\_ip1, src\_ip2 nodrop // "callerIpAddress" EventHub, "HttpRequest.ClientIpAddress" API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "category", "EventName" as EventName1, EventName2 nodrop // "category" EventHub, "EventName" Azure Insight API <br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (src\_user1, src\_user2) as src\_user<br />\| concat (src\_ip1, src\_ip2) as src\_ip<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| concat (EventName1, EventName2) as EventName<br />\| concat (Category1, Category2) as Category<br />\| parse field=OperationName "\*/\*/\*" as provider, object, action nodrop<br />\| parse field=OperationName "\*/\*/\*/\*" as provider, object, subject, action nodrop<br />\| where action in ("DELETE", "REMOVE", "delete", "remove") or EventName in ("Delete", "Remove")<br />\| fields Level, Status, src\_user, src\_ip, OperationName, EventName, provider, object, subject, action, Category<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by object<br />\| sort by \_count|
|Azure Audit|Resource Group Events|Logs|Azure Audit/Azure Audit - Resource Usage - New|\_sourceCategory = Labs/Azure/Audit ((resourceId RESOURCEGROUPS) or (ResourceGroupName))<br />\| json "resourceId" as resourceId1 nodrop // EventHub<br />\| parse regex field=resourceId1 "/RESOURCEGROUPS/(?\<ResourceGroupName1\>[^/]+)" nodrop<br />\| json "ResourceGroupName" as ResourceGroupName2 nodrop // Azure Insight API using our Powershell scripts <br />\| if (isEmpty(ResourceGroupName1), ResourceGroupName2, ResourceGroupName1) as ResourceGroupName<br />\| where !isEMpty(ResourceGroupName)<br />\| toLowerCase(ResourceGroupName) as ResourceGroupName<br />\| fields ResourceGroupName<br />\| timeslice 1d<br />\|where if ("{{resourcegroupname}}" = "\*", true, resourcegroupname matches "{{resourcegroupname}}")<br />\|count by ResourceGroupName<br />\| sort by \_count desc|
|Azure Audit|Resource Group Events|Logs|Installed Apps/Azure Audit/Azure Audit - Resource Usage|\_sourceCategory={{Logsdatasource}}  ((resourceId RESOURCEGROUPS) or (ResourceGroupName))<br />\| json "resourceId" as resourceId1 nodrop // EventHub<br />\| parse regex field=resourceId1 "/RESOURCEGROUPS/(?\<ResourceGroupName1\>[^/]+)" nodrop<br />\| json "ResourceGroupName" as ResourceGroupName2 nodrop // Azure Insight API using our Powershell scripts <br />\| if (isEmpty(ResourceGroupName1), ResourceGroupName2, ResourceGroupName1) as ResourceGroupName<br />\| where !isEMpty(ResourceGroupName)<br />\| toLowerCase(ResourceGroupName) as ResourceGroupName<br />\| fields ResourceGroupName<br />\| timeslice 1d<br />\|where if ("{{resourcegroupname}}" = "\*", true, resourcegroupname matches "{{resourcegroupname}}")<br />\|count by ResourceGroupName<br />\| sort by \_count desc|
|Azure Audit|Resource Groups by Caller|Logs|Installed Apps/Azure Audit/Azure Audit - User Activity|\_sourceCategory={{Logsdatasource}}  ((identity claims name resourceId RESOURCEGROUPS) or (Caller ResourceGroupName))<br />\| json "resourceId" as resourceId1 nodrop // EventHub<br />\| parse regex field=resourceId1 "/RESOURCEGROUPS/(?\<ResourceGroupName1\>[^/]+)" nodrop // EventHub<br />\| json "ResourceGroupName" as ResourceGroupName2 nodrop // Azure Insight API using our Powershell scripts <br />\| if (isEmpty(ResourceGroupName1), ResourceGroupName2, ResourceGroupName1) as ResourceGroupName<br />\| where !isEmpty(ResourceGroupName)<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "identity.claims.name", "Caller" as src\_user1, src\_user2 nodrop // "identity.claims.name" EventHub, "Caller" Azure Insight API<br />\| json "callerIpAddress", "HttpRequest.ClientIpAddress" as src\_ip1, src\_ip2 nodrop // "callerIpAddress" EventHub, "HttpRequest.ClientIpAddress" API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "category", "EventName" as EventName1, EventName2 nodrop // "category" EventHub, "EventName" Azure Insight API <br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (src\_user1, src\_user2) as src\_user<br />\| concat (src\_ip1, src\_ip2) as src\_ip<br />\| concat (Category1, Category2) as Category<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| concat (EventName1, EventName2) as EventName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields Level, Status, src\_user, src\_ip, Category, OperationName, ResourceGroupName, EventName<br />\| timeslice 1d<br />\| tolowercase(ResourceGroupName) as ResourceGroupName<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by src\_user, ResourceGroupName<br />\| transpose row src\_user column ResourceGroupName|
|Azure Audit|Resource Provider Events|Logs|Installed Apps/Azure Audit/Azure Audit - Resource Usage|\_sourceCategory={{Logsdatasource}}  ((resourceId PROVIDERS) or (ResourceProviderName))<br />\| json "resourceId" as resourceId1 nodrop // EventHub<br />\| parse regex field=resourceId1 "/PROVIDERS/(?\<ResourceProviderName1\>[^/]+)" nodrop // EventHub<br />\| json "ResourceProviderName" as ResourceProviderName2 nodrop // Azure Insight API using our Powershell scripts <br />\| if (isEmpty(ResourceProviderName1), ResourceProviderName2, ResourceProviderName1) as ResourceProviderName<br />\| where !isEMpty(ResourceProviderName)<br />\| tolowercase(ResourceProviderName) as ResourceProviderName<br />\| fields ResourceProviderName<br />\|where if ("{{resourceprovidername}}" = "\*", true, resourceprovidername matches "{{resourceprovidername}}")<br />\|count by ResourceProviderName<br />\| sort by \_count desc|
|Azure Audit|Resource Provider Events|Logs|Azure Audit/Azure Audit - Resource Usage - New|\_sourceCategory = Labs/Azure/Audit ((resourceId PROVIDERS) or (ResourceProviderName))<br />\| json "resourceId" as resourceId1 nodrop // EventHub<br />\| parse regex field=resourceId1 "/PROVIDERS/(?\<ResourceProviderName1\>[^/]+)" nodrop // EventHub<br />\| json "ResourceProviderName" as ResourceProviderName2 nodrop // Azure Insight API using our Powershell scripts <br />\| if (isEmpty(ResourceProviderName1), ResourceProviderName2, ResourceProviderName1) as ResourceProviderName<br />\| where !isEMpty(ResourceProviderName)<br />\| tolowercase(ResourceProviderName) as ResourceProviderName<br />\| fields ResourceProviderName<br />\|where if ("{{resourceprovidername}}" = "\*", true, resourceprovidername matches "{{resourceprovidername}}")<br />\|count by ResourceProviderName<br />\| sort by \_count desc|
|Azure Audit|Resource Providers by Resource Groups|Logs|Installed Apps/Azure Audit/Azure Audit - Resource Usage|\_sourceCategory={{Logsdatasource}}  ((resourceId ("PROVIDERS" or "RESOURCEGROUPS")) or (ResourceGroupName ResourceProviderName))<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| concat (OperationName1, OperationName2) as OperationName<br />\| json "resourceId" as resourceId1 nodrop // EventHub<br />\| parse regex field=resourceId1 "/RESOURCEGROUPS/(?\<ResourceGroupName1\>[^/]+)" nodrop // EventHub<br />\| parse regex field=resourceId1 "/PROVIDERS/(?\<ResourceProviderName1\>[^/]+)" nodrop // EventHub<br />\| json "ResourceGroupName" as ResourceGroupName2 nodrop // Azure Insight API using our Powershell scripts <br />\| json "ResourceProviderName" as ResourceProviderName2 nodrop // Azure Insight API using our Powershell scripts <br />\| if (isEmpty(ResourceGroupName1), ResourceGroupName2, ResourceGroupName1) as ResourceGroupName<br />\| if (isEmpty(ResourceProviderName1), ResourceProviderName2, ResourceProviderName1) as ResourceProviderName<br />\| toLowerCase(ResourceGroupName) as ResourceGroupName \| tolowercase(ResourceProviderName) as ResourceProviderName<br />\| fields ResourceGroupName, ResourceProviderName, OperationName<br />\|where if ("{{resourceprovidername}}" = "\*", true, resourceprovidername matches "{{resourceprovidername}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{resourcegroupname}}" = "\*", true, resourcegroupname matches "{{resourcegroupname}}")<br />\|count by ResourceGroupName, ResourceProviderName<br />\| where !(isEmpty(ResourceGroupName) and isEmpty(ResourceProviderName))<br />\| transpose row ResourceGroupName column ResourceProviderName|
|Azure Audit|Resource Providers by Resource Groups|Logs|Azure Audit/Azure Audit - Resource Usage - New|\_sourceCategory = Labs/Azure/Audit ((resourceId ("PROVIDERS" or "RESOURCEGROUPS")) or (ResourceGroupName ResourceProviderName))<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| concat (OperationName1, OperationName2) as OperationName<br />\| json "resourceId" as resourceId1 nodrop // EventHub<br />\| parse regex field=resourceId1 "/RESOURCEGROUPS/(?\<ResourceGroupName1\>[^/]+)" nodrop // EventHub<br />\| parse regex field=resourceId1 "/PROVIDERS/(?\<ResourceProviderName1\>[^/]+)" nodrop // EventHub<br />\| json "ResourceGroupName" as ResourceGroupName2 nodrop // Azure Insight API using our Powershell scripts <br />\| json "ResourceProviderName" as ResourceProviderName2 nodrop // Azure Insight API using our Powershell scripts <br />\| if (isEmpty(ResourceGroupName1), ResourceGroupName2, ResourceGroupName1) as ResourceGroupName<br />\| if (isEmpty(ResourceProviderName1), ResourceProviderName2, ResourceProviderName1) as ResourceProviderName<br />\| toLowerCase(ResourceGroupName) as ResourceGroupName \| tolowercase(ResourceProviderName) as ResourceProviderName<br />\| fields ResourceGroupName, ResourceProviderName, OperationName<br />\|where if ("{{resourceprovidername}}" = "\*", true, resourceprovidername matches "{{resourceprovidername}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{resourcegroupname}}" = "\*", true, resourcegroupname matches "{{resourcegroupname}}")<br />\|count by ResourceGroupName, ResourceProviderName<br />\| where !(isEmpty(ResourceGroupName) and isEmpty(ResourceProviderName))<br />\| transpose row ResourceGroupName column ResourceProviderName|
|Azure Audit|Status|Logs|Installed Apps/Azure Audit/Azure Audit - Service Health|\_sourceCategory={{Logsdatasource}}  "ServiceHealth" ((properties eventCategory resultType) or (Category Status))<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "resultDescription", "Description" as Description1, Description2 nodrop // "resultDescription" EventHub, "Description" Azure Insight API<br />\| json "correlationId", "CorrelationId" as CorrelationId1, CorrelationId2 nodrop // "correlationId" EventHub, "CorrelationId" Azure Insight API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "category", "EventName" as EventName1, EventName2 nodrop // "category" EventHub, "EventName" Azure Insight API <br />\| json "location" as Location nodrop // EventHub<br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| concat (Description1, Description2) as Description<br />\| concat (CorrelationId1, CorrelationId2) as CorrelationId<br />\| concat (Category1, Category2) as Category<br />\| concat (EventName1, EventName2) as EventName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields Level, Status, Category, OperationName, Description, CorrelationId, EventName, Location<br />\| where Category = "ServiceHealth"<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{description}}" = "\*", true, description matches "{{description}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{location}}" = "\*", true, location matches "{{location}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}") AND if ("{{correlationid}}" = "\*", true, correlationid matches "{{correlationid}}")<br />\|count by Status<br />\| sort by \_count desc|
|Azure Audit|Status|Logs|Azure Audit/Azure Audit - Service Health - New|\_sourceCategory = Labs/Azure/Audit "ServiceHealth" ((properties eventCategory resultType) or (Category Status))<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "resultDescription", "Description" as Description1, Description2 nodrop // "resultDescription" EventHub, "Description" Azure Insight API<br />\| json "correlationId", "CorrelationId" as CorrelationId1, CorrelationId2 nodrop // "correlationId" EventHub, "CorrelationId" Azure Insight API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "category", "EventName" as EventName1, EventName2 nodrop // "category" EventHub, "EventName" Azure Insight API <br />\| json "location" as Location nodrop // EventHub<br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| concat (Description1, Description2) as Description<br />\| concat (CorrelationId1, CorrelationId2) as CorrelationId<br />\| concat (Category1, Category2) as Category<br />\| concat (EventName1, EventName2) as EventName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields Level, Status, Category, OperationName, Description, CorrelationId, EventName, Location<br />\| where Category = "ServiceHealth"<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{description}}" = "\*", true, description matches "{{description}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{location}}" = "\*", true, location matches "{{location}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}") AND if ("{{correlationid}}" = "\*", true, correlationid matches "{{correlationid}}")<br />\|count by Status<br />\| sort by \_count desc|
|Azure Audit|Top 10 Users|Logs|Installed Apps/Azure Audit/Azure Audit - User Activity|\_sourceCategory={{Logsdatasource}}  ((identity claims name) or Caller)<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "identity.claims.name", "Caller" as src\_user1, src\_user2 nodrop // "identity.claims.name" EventHub, "Caller" Azure Insight API<br />\| json "callerIpAddress", "HttpRequest.ClientIpAddress" as src\_ip1, src\_ip2 nodrop // "callerIpAddress" EventHub, "HttpRequest.ClientIpAddress" API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "category", "EventName" as EventName1, EventName2 nodrop // "category" EventHub, "EventName" Azure Insight API <br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (src\_user1, src\_user2) as src\_user<br />\| concat (src\_ip1, src\_ip2) as src\_ip<br />\| concat (Category1, Category2) as Category<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| concat (EventName1, EventName2) as EventName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields Level, Status, src\_user, src\_ip, Category, OperationName, EventName<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count src\_user \| where !isEmpty(src\_user)<br />\| top 10 src\_user by \_count|
|Azure Audit|Unresolved Events|Logs|Azure Audit/Azure Audit - Service Health - New|\_sourceCategory = Labs/Azure/Audit "ServiceHealth" ((properties eventCategory level resultType) or (Category Level Status))<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "resultDescription", "Description" as Description1, Description2 nodrop // "resultDescription" EventHub, "Description" Azure Insight API<br />\| json "correlationId", "CorrelationId" as CorrelationId1, CorrelationId2 nodrop // "correlationId" EventHub, "CorrelationId" Azure Insight API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "category", "EventName" as EventName1, EventName2 nodrop // "category" EventHub, "EventName" Azure Insight API <br />\| json "location" as Location nodrop // EventHub<br />\| concat (Category1, Category2) as Category<br />\| where Category = "ServiceHealth"<br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| concat (Description1, Description2) as Description<br />\| concat (CorrelationId1, CorrelationId2) as CorrelationId<br />\| concat (EventName1, EventName2) as EventName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields OperationName, Description, CorrelationId, Level, EventName, Location, Status, Category<br />\| withtime Status \| withtime \_messagetime<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{description}}" = "\*", true, description matches "{{description}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{location}}" = "\*", true, location matches "{{location}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}") AND if ("{{correlationid}}" = "\*", true, correlationid matches "{{correlationid}}")<br />\|most\_recent(Status\_withtime) as Status, most\_recent(\_messagetime\_withtime) as Time by CorrelationId, Level, EventName, Location<br />\| where Status != "Resolved" <br />\| sort by Time<br />\| formatDate(toLong(Time),"yyyy-MM-dd HH:mm:ss Z") as Time|
|Azure Audit|Unresolved Events|Logs|Installed Apps/Azure Audit/Azure Audit - Service Health|\_sourceCategory={{Logsdatasource}}  "ServiceHealth" ((properties eventCategory level resultType) or (Category Level Status))<br />\| json "level", "Level" as level1, level2 nodrop // "level" EventHub, "Level"  Azure Insight API<br />\| json "resultType", "Status" as status1, status2 nodrop // "resultType" EventHub, "Status" Azure Insight API<br />\| json "operationName", "OperationName" as OperationName1, OperationName2 nodrop // "operationName" EventHub, "OperationName" Azure Insight API <br />\| json "resultDescription", "Description" as Description1, Description2 nodrop // "resultDescription" EventHub, "Description" Azure Insight API<br />\| json "correlationId", "CorrelationId" as CorrelationId1, CorrelationId2 nodrop // "correlationId" EventHub, "CorrelationId" Azure Insight API<br />\| json "properties.eventCategory", "Category"  as Category1, Category2 nodrop // "properties.eventCategory" EventHub, "Category" Azure Insight API<br />\| json "category", "EventName" as EventName1, EventName2 nodrop // "category" EventHub, "EventName" Azure Insight API <br />\| json "location" as Location nodrop // EventHub<br />\| concat (Category1, Category2) as Category<br />\| where Category = "ServiceHealth"<br />\| concat (level1, level2) as Level<br />\| concat (status1, status2) as Status<br />\| concat (OperationName1, OperationName2) as OperationName<br />\| concat (Description1, Description2) as Description<br />\| concat (CorrelationId1, CorrelationId2) as CorrelationId<br />\| concat (EventName1, EventName2) as EventName<br />\| if (IsEmpty(Category), "Undefined", Category) as Category<br />\| if(Level="1","Critical", if (Level="2","Error", if (Level="3","Warning", if (Level="4","Information", Level) ))) as Level<br />\| fields OperationName, Description, CorrelationId, Level, EventName, Location, Status, Category<br />\| withtime Status \| withtime \_messagetime<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{description}}" = "\*", true, description matches "{{description}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{status}}" = "\*", true, status matches "{{status}}") AND if ("{{location}}" = "\*", true, location matches "{{location}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}") AND if ("{{correlationid}}" = "\*", true, correlationid matches "{{correlationid}}")<br />\|most\_recent(Status\_withtime) as Status, most\_recent(\_messagetime\_withtime) as Time by CorrelationId, Level, EventName, Location<br />\| where Status != "Resolved" <br />\| sort by Time<br />\| formatDate(toLong(Time),"yyyy-MM-dd HH:mm:ss Z") as Time|

