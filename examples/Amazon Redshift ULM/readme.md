# Amazon Redshift ULM
## Sumo Logic App For: Amazon Redshift ULM
Amazon Redshift is Amazon's data warehousing service. The Sumo Logic App for Amazon Redshift ULM helps you monitor activity in Amazon Redshift. The app is a unified logs and metrics application with preconfigured dashboards provide insight into database connections, SQL command and statement execution, database user account events, CloudTrail events, and resource utilization by node and cluster.
Docs Link: [Amazon Redshift ULM](https://help.sumologic.com/?cid=52621)

## Searches

### Log Searches

- **90%ile Session Duration by User**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis 
- **90%ile Session Duration by User**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New 
- **Alter User Events**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Log Analysis 
- **Authentication Failures**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis 
- **Authentication Failures**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Authentication Failures**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New 
- **Authentication Method Used**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Authentication Method Used**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis 
- **Authentication Method Used**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New 
- **Authentication Method Used - Trend**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis 
- **Authentication Method Used - Trend**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New 
- **Authentication Status**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis 
- **Authentication Status**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New 
- **Authentication Status Trend**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New 
- **Authentication Status Trend**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis 
- **Authentication Success**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Connection Session Stats**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New 
- **Connection Session Stats**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis 
- **Connection Sessions**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Create User Events**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Log Analysis 
- **Drop User Events**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Log Analysis 
- **Event Status**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview 
- **Event Status Trend**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview 
- **Event Trend**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Log Analysis 
- **Event Trend**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New 
- **Event Trend**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis 
- **Events**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Log Analysis 
- **Events by AccountId**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview 
- **Events by AccountId**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Events by Regions**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview 
- **Events by User**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview 
- **Events by User Agents**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview 
- **Events Trend by Event Name**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview 
- **Failed Event Locations**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview 
- **Failed Events**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview 
- **Recent Failed Event Details**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview 
- **Recent Successful Event Details**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview 
- **Recent User Related Events**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Log Analysis 
- **Session Duration Stats**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New 
- **Session Duration Stats**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Session Duration Stats**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis 
- **SQL Command Execution Trend**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis 
- **SQL Command Execution Trend**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **SSL Cipher Used**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New 
- **SSL Cipher Used**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis 
- **SSL Used**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis 
- **SSL Used**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New 
- **SSL Used**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Successful Event Locations**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview 
- **Successful Events**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview 
- **Top Alter Command Execution**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis 
- **Top Applications**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New 
- **Top Applications**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis 
- **Top Cluster Identifiers**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview 
- **Top Cluster Identifiers**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Top Create Command Execution**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis 
- **Top Databases**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Top Databases**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Top Databases**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis 
- **Top Databases**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New 
- **Top Databases**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis 
- **Top Delete Command Execution**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis 
- **Top Drop Command Execution**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis 
- **Top Error Codes**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview 
- **Top Events**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New 
- **Top Events**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis 
- **Top Grant Command Execution**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis 
- **Top Remote Hosts**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Top Remote Hosts**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New 
- **Top Remote Hosts**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis 
- **Top Revoke Command Execution**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis 
- **Top SQL Commands**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Top SQL Commands**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis 
- **Top SQL Statements**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis 
- **Top Successful Events**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Top Truncate Command Execution**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis 
- **Top Users**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Top Users**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Top Users**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New 
- **Top Users**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis 
- **Top Users**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis 
- **Top Users by Type**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Top Users by Type**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview 
- **Top Vacuum Command Execution**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis 
- **User Type Trend**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview

### Metric Searches

- **Commit Queue Length**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New 
- **Commit Queue Length**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID 
- **CPU Utilization**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **CPU Utilization**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier - New 
- **CPU Utilization**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New 
- **CPU Utilization**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID 
- **CPU Utilization**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier 
- **Database Connections**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier - New 
- **Database Connections**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier 
- **Database Connections**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Health Status**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Health Status**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier 
- **Health Status**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier - New 
- **Maintenance Mode**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier 
- **Maintenance Mode**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Maintenance Mode**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier - New 
- **Network Receive and Transmit Throughput**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Network Receive Throughput**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier - New 
- **Network Receive Throughput**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New 
- **Network Receive Throughput**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID 
- **Network Receive Throughput**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier 
- **Network Transmit Throughput**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID 
- **Network Transmit Throughput**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier 
- **Network Transmit Throughput**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier - New 
- **Network Transmit Throughput**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New 
- **Percentage Disk Space Utilization**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview 
- **Percentage Disk Space Utilization**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID 
- **Percentage Disk Space Utilization**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier - New 
- **Percentage Disk Space Utilization**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier 
- **Percentage Disk Space Utilization**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New 
- **Read IOPS**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID 
- **Read IOPS**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New 
- **Read Latency**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID 
- **Read Latency**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New 
- **Read Throughput**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New 
- **Read Throughput**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID 
- **WLM Queue Length**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID 
- **WLM Queue Length**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New 
- **Write IOPS**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New 
- **Write IOPS**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID 
- **Write Latency**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID 
- **Write Latency**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New 
- **Write Throughput**: from Dashboard: Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID 
- **Write Throughput**: from Dashboard: Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New

## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Amazon Redshift ULM|90%ile Session Duration by User|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  "disconnecting session"<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| where event matches "disconnecting session\*" <br />\| timeslice 1h<br />\| where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\| pct(duration, 90) as %"90%ile" by \_timeslice, username<br />\| transpose row \_timeslice column username|
|Amazon Redshift ULM|90%ile Session Duration by User|Logs|Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New|\_sourceCategory = Labs/AWS/Redshift/Audit\* "disconnecting session"<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| where event matches "disconnecting session\*" <br />\| timeslice 1h<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{application\_name}}" = "\*", true, application\_name matches "{{application\_name}}") AND if ("{{pid}}" = "\*", true, pid matches "{{pid}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|pct(duration, 90) as %"90%ile" by \_timeslice, username<br />\| transpose row \_timeslice column username|
|Amazon Redshift ULM|Alter User Events|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG Alte\* user<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| touppercase(command) as command \| touppercase (sqlstatement) as temp\_sqlstatement<br />\| where command matches "ALTE\*" and temp\_sqlstatement matches "\*ALTER\*USER \*"<br />\| where if ("{{dbName}}" = "\*", true, dbName matches "{{dbName}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{userid}}" = "\*", true, userid matches "{{userid}}")<br />\|count as eventCount by time, command, dbname, userid, username, pid, xid, sqlstatement|
|Amazon Redshift ULM|Authentication Failures|Logs|Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New|\_sourceCategory = Labs/AWS/Redshift/Audit\* "authentication failure"<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s\\']\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| where event matches "authentication failure\*"<br />\| timeslice 1s<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{application\_name}}" = "\*", true, application\_name matches "{{application\_name}}") AND if ("{{pid}}" = "\*", true, pid matches "{{pid}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as eventCount by \_timeslice, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, sslversion, sslcipher<br />\| sort by \_timeslice \| fields -\_timeslice|
|Amazon Redshift ULM|Authentication Failures|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  "authentication failure"<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s\\']\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| where event matches "authentication failure\*"<br />\| timeslice 1s<br />\| where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\| count as eventCount by \_timeslice, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, sslversion, sslcipher<br />\| sort by \_timeslice \| fields -\_timeslice|
|Amazon Redshift ULM|Authentication Failures|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{ReshiftAuditLogsDataSource}}  "authentication failure"<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s\\']\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| if (event matches "authenticated\*", "authenticated", if (event matches "authentication failure\*", "authentication failure", event)) as event<br />\| where event = "authentication failure"<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}") AND if ("{{type}}" = "\*", true, type matches "{{type}}")<br />\|count as %"Requests" by event|
|Amazon Redshift ULM|Authentication Method Used|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| if (authmethod matches "password\*", "password", if (authmethod matches "Ident\*", "Ident", authmethod)) as authmethod<br />\| where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests" by authmethod<br />\| top 10 authmethod by %"Requests", authmethod asc|
|Amazon Redshift ULM|Authentication Method Used|Logs|Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New|\_sourceCategory = Labs/AWS/Redshift/Audit\* ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| if (authmethod matches "password\*", "password", if (authmethod matches "Ident\*", "Ident", authmethod)) as authmethod<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{application\_name}}" = "\*", true, application\_name matches "{{application\_name}}") AND if ("{{pid}}" = "\*", true, pid matches "{{pid}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests" by authmethod<br />\| top 10 authmethod by %"Requests", authmethod asc|
|Amazon Redshift ULM|Authentication Method Used|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{ReshiftAuditLogsDataSource}}  ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| if (authmethod matches "password\*", "password", if (authmethod matches "Ident\*", "Ident", authmethod)) as authmethod<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}") AND if ("{{type}}" = "\*", true, type matches "{{type}}")<br />\|count as %"Requests" by authmethod<br />\| top 10 authmethod by %"Requests", authmethod asc|
|Amazon Redshift ULM|Authentication Method Used - Trend|Logs|Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New|\_sourceCategory = Labs/AWS/Redshift/Audit\* ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| if (authmethod matches "password\*", "password", if (authmethod matches "Ident\*", "Ident", authmethod)) as authmethod<br />\| timeslice 1h<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{application\_name}}" = "\*", true, application\_name matches "{{application\_name}}") AND if ("{{pid}}" = "\*", true, pid matches "{{pid}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests" by \_timeslice, authmethod<br />\| transpose row \_timeslice column authmethod|
|Amazon Redshift ULM|Authentication Method Used - Trend|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| if (authmethod matches "password\*", "password", if (authmethod matches "Ident\*", "Ident", authmethod)) as authmethod<br />\| timeslice 1h<br />\| where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests" by \_timeslice, authmethod<br />\| transpose row \_timeslice column authmethod|
|Amazon Redshift ULM|Authentication Status|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  ("authenticated" or "authentication failure")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s\\']\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| if (event matches "authenticated\*", "authenticated", if (event matches "authentication failure\*", "authentication failure", event)) as event<br />\| where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests" by event<br />\| where event in ("authenticated", "authentication failure")|
|Amazon Redshift ULM|Authentication Status|Logs|Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New|\_sourceCategory = Labs/AWS/Redshift/Audit\* ("authenticated" or "authentication failure")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s\\']\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| if (event matches "authenticated\*", "authenticated", if (event matches "authentication failure\*", "authentication failure", event)) as event<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{application\_name}}" = "\*", true, application\_name matches "{{application\_name}}") AND if ("{{pid}}" = "\*", true, pid matches "{{pid}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests" by event<br />\| where event in ("authenticated", "authentication failure")|
|Amazon Redshift ULM|Authentication Status Trend|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  ("authenticated" or "authentication failure")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s\\']\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| if (event matches "authenticated\*", "authenticated", if (event matches "authentication failure\*", "authentication failure", event)) as event<br />\| where event in ("authenticated", "authentication failure")<br />\| timeslice 1h<br />\| where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\| count as %"Requests" by \_timeslice, event<br />\| transpose row \_timeslice column event|
|Amazon Redshift ULM|Authentication Status Trend|Logs|Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New|\_sourceCategory = Labs/AWS/Redshift/Audit\* ("authenticated" or "authentication failure")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s\\']\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| if (event matches "authenticated\*", "authenticated", if (event matches "authentication failure\*", "authentication failure", event)) as event<br />\| where event in ("authenticated", "authentication failure")<br />\| timeslice 1h<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{application\_name}}" = "\*", true, application\_name matches "{{application\_name}}") AND if ("{{pid}}" = "\*", true, pid matches "{{pid}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests" by \_timeslice, event<br />\| transpose row \_timeslice column event|
|Amazon Redshift ULM|Authentication Success|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{ReshiftAuditLogsDataSource}}  "authenticated"<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s\\']\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| if (event matches "authenticated\*", "authenticated", if (event matches "authentication failure\*", "authentication failure", event)) as event<br />\| where event = "authenticated"<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}") AND if ("{{type}}" = "\*", true, type matches "{{type}}")<br />\|count as %"Requests" by event|
|Amazon Redshift ULM|Commit Queue Length|Metrics|Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New|metric={{metric}} namespace={{namespace}} nodeid={{nodeid}} statistic={{statistic}}  Namespace=AWS/Redshift metric=CommitQueueLength Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|Commit Queue Length|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=CommitQueueLength Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|Connection Session Stats|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}   ("initiating session" or "disconnecting session")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| join<br />(where event matches "initiating session\*") as t1,<br />(where event matches "disconnecting session\*" ) as t2<br />on t1.pid = t2.pid and t1.remotehost = t2.remotehost and t1.remoteport = t2.remoteport<br />\| fields t1\_pid, t1\_remotehost, t1\_remoteport, t1\_username, t2\_duration, t1\_recordtime , t2\_recordtime, t1\_application\_name,  t1\_dbname, t1\_authmethod, t1\_sslversion, t1\_sslcipher<br />\| t1\_pid as pid \| t1\_remotehost as remotehost \| t1\_remoteport as remoteport \| t1\_username as username \| t2\_duration as duration \| t1\_recordtime as connection\_recordtime \| t2\_recordtime as disconnection\_recordtime \| t1\_application\_name as application\_name \| t1\_dbname as dbname \| t1\_authmethod as authmethod \| t1\_sslversion as sslversion \| t1\_sslcipher as sslcipher<br />\| where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\| count as eventCount by pid, remotehost, remoteport, username, duration, connection\_recordtime, disconnection\_recordtime|
|Amazon Redshift ULM|Connection Session Stats|Logs|Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New|\_sourceCategory = Labs/AWS/Redshift/Audit\*  ("initiating session" or "disconnecting session")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| join<br />(where event matches "initiating session\*") as t1,<br />(where event matches "disconnecting session\*" ) as t2<br />on t1.pid = t2.pid and t1.remotehost = t2.remotehost and t1.remoteport = t2.remoteport<br />\| fields t1\_pid, t1\_remotehost, t1\_remoteport, t1\_username, t2\_duration, t1\_recordtime , t2\_recordtime, t1\_application\_name,  t1\_dbname, t1\_authmethod, t1\_sslversion, t1\_sslcipher<br />\| t1\_pid as pid \| t1\_remotehost as remotehost \| t1\_remoteport as remoteport \| t1\_username as username \| t2\_duration as duration \| t1\_recordtime as connection\_recordtime \| t2\_recordtime as disconnection\_recordtime \| t1\_application\_name as application\_name \| t1\_dbname as dbname \| t1\_authmethod as authmethod \| t1\_sslversion as sslversion \| t1\_sslcipher as sslcipher<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{application\_name}}" = "\*", true, application\_name matches "{{application\_name}}") AND if ("{{pid}}" = "\*", true, pid matches "{{pid}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as eventCount by pid, remotehost, remoteport, username, duration, connection\_recordtime, disconnection\_recordtime|
|Amazon Redshift ULM|Connection Sessions|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{ReshiftAuditLogsDataSource}}  "initiating session"<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| if (event matches "initiating session\*", "initiating session", event) as event<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}") AND if ("{{type}}" = "\*", true, type matches "{{type}}")<br />\|count as %"Requests" by event|
|Amazon Redshift ULM|CPU Utilization|Metrics|Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier - New|clusteridentifier={{clusteridentifier}} metric={{metric}} namespace={{namespace}} statistic={{statistic}}  Namespace=AWS/Redshift metric=CPUUtilization Statistic=Average ClusterIdentifier=\* \| avg by ClusterIdentifier |
|Amazon Redshift ULM|CPU Utilization|Metrics|Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New|metric={{metric}} namespace={{namespace}} nodeid={{nodeid}} statistic={{statistic}}  Namespace=AWS/Redshift metric=CPUUtilization Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|CPU Utilization|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=CPUUtilization Statistic=Average ClusterIdentifier=\* \| avg by ClusterIdentifier |
|Amazon Redshift ULM|CPU Utilization|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=CPUUtilization Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|CPU Utilization|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=CPUUtilization Statistic=Average ClusterIdentifier=\* \| avg by ClusterIdentifier |
|Amazon Redshift ULM|Create User Events|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG crea\* user<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| touppercase(command) as command \| touppercase (sqlstatement) as temp\_sqlstatement<br />\| where command matches "CREA\*" and temp\_sqlstatement matches "\*CREA\*USER \*"<br />\| where if ("{{dbName}}" = "\*", true, dbName matches "{{dbName}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{userid}}" = "\*", true, userid matches "{{userid}}")<br />\|count as eventCount by time, command, dbname, userid, username, pid, xid, sqlstatement|
|Amazon Redshift ULM|Database Connections|Metrics|Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier - New|clusteridentifier={{clusteridentifier}} metric={{metric}} namespace={{namespace}} statistic={{statistic}}  Namespace=AWS/Redshift metric=DatabaseConnections Statistic=SampleCount ClusterIdentifier=\* \| sum by ClusterIdentifier |
|Amazon Redshift ULM|Database Connections|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=DatabaseConnections Statistic=SampleCount ClusterIdentifier=\* \| sum by ClusterIdentifier |
|Amazon Redshift ULM|Database Connections|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=DatabaseConnections Statistic=SampleCount ClusterIdentifier=\* \| sum by ClusterIdentifier |
|Amazon Redshift ULM|Drop User Events|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG drop\* user<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| touppercase(command) as command \| touppercase (sqlstatement) as temp\_sqlstatement<br />\| where command matches "DROP\*" and temp\_sqlstatement matches "\*DROP\*USER \*"<br />\| where if ("{{dbName}}" = "\*", true, dbName matches "{{dbName}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{userid}}" = "\*", true, userid matches "{{userid}}")<br />\| count as eventCount by time, command, dbname, userid, username, pid, xid, sqlstatement|
|Amazon Redshift ULM|Event Status|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\""<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| where eventSource="redshift.amazonaws.com"<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus<br />\| if (isEmpty(userName), user, userName) as user<br />\| where if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{awsRegion}}" = "\*", true, awsRegion matches "{{awsRegion}}") AND if ("{{clusterIdentifier}}" = "\*", true, clusterIdentifier matches "{{clusterIdentifier}}") AND if ("{{errorCode}}" = "\*", true, errorCode matches "{{errorCode}}") AND if ("{{eventName}}" = "\*", true, eventName matches "{{eventName}}")  AND if ("{{eventStatus}}" = "\*", true, eventStatus matches "{{eventStatus}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}")<br />\| count as eventCount by eventStatus|
|Amazon Redshift ULM|Event Status Trend|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\""<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| where eventSource="redshift.amazonaws.com"<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus<br />\| if (isEmpty(userName), user, userName) as user<br />\| timeslice 1d<br />\| where if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{awsRegion}}" = "\*", true, awsRegion matches "{{awsRegion}}") AND if ("{{clusterIdentifier}}" = "\*", true, clusterIdentifier matches "{{clusterIdentifier}}") AND if ("{{errorCode}}" = "\*", true, errorCode matches "{{errorCode}}") AND if ("{{eventName}}" = "\*", true, eventName matches "{{eventName}}")  AND if ("{{eventStatus}}" = "\*", true, eventStatus matches "{{eventStatus}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}")<br />\|count by \_timeslice, eventStatus<br />\| fillmissing timeslice(1d), values ("Success", "Failure") in eventStatus<br />\| transpose row \_timeslice column eventStatus|
|Amazon Redshift ULM|Event Trend|Logs|Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New|\_sourceCategory = Labs/AWS/Redshift/Audit\* ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s\\']\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| if (event matches "authenticated\*", "authenticated", if (event matches "set\*application\_name\*", "set application\_name", if (event matches "disconnecting session\*", "disconnecting session", if (event matches "initiating session\*", "initiating session", event)))) as event<br />\| timeslice 1h<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{application\_name}}" = "\*", true, application\_name matches "{{application\_name}}") AND if ("{{pid}}" = "\*", true, pid matches "{{pid}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests" by \_timeslice, event<br />\| transpose row \_timeslice column event|
|Amazon Redshift ULM|Event Trend|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG (crea\* or drop\* or alte\*) user<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| touppercase(command) as command \| touppercase (sqlstatement) as temp\_sqlstatement<br />\| where (command matches "CREA\*" or command matches "DROP\*" or command matches "ALTE\*") and (temp\_sqlstatement matches "\*CREA\*USER \*" or temp\_sqlstatement matches "\*DROP\*USER \*" or temp\_sqlstatement matches "\*ALTE\*USER \*")<br />\| timeslice 15m<br />\| where if ("{{command}}" = "\*", true, command matches "{{command}}") AND if ("{{dbName}}" = "\*", true, dbName matches "{{dbName}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{userid}}" = "\*", true, userid matches "{{userid}}")<br />\|count as eventCount by \_timeslice, command<br />\| transpose row \_timeslice column command|
|Amazon Redshift ULM|Event Trend|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s\\']\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| if (event matches "authenticated\*", "authenticated", if (event matches "set\*application\_name\*", "set application\_name", if (event matches "disconnecting session\*", "disconnecting session", if (event matches "initiating session\*", "initiating session", event)))) as event<br />\| timeslice 1h<br />\| where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests" by \_timeslice, event<br />\| transpose row \_timeslice column event|
|Amazon Redshift ULM|Events|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG (crea\* or drop\* or alte\*) user<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| touppercase(command) as command \| touppercase (sqlstatement) as temp\_sqlstatement<br />\| where (command matches "CREA\*" or command matches "DROP\*" or command matches "ALTE\*") and (temp\_sqlstatement matches "\*CREA\*USER \*" or temp\_sqlstatement matches "\*DROP\*USER \*" or temp\_sqlstatement matches "\*ALTE\*USER \*")<br />\| where if ("{{command}}" = "\*", true, command matches "{{command}}") AND if ("{{dbName}}" = "\*", true, dbName matches "{{dbName}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{userid}}" = "\*", true, userid matches "{{userid}}")<br />\| count as eventCount by command|
|Amazon Redshift ULM|Events by AccountId|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\""<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| where eventSource="redshift.amazonaws.com"<br />\| if (isEmpty(userName), user, userName) as user<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus <br />\| timeslice 1h<br />\| where if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{awsRegion}}" = "\*", true, awsRegion matches "{{awsRegion}}") AND if ("{{clusterIdentifier}}" = "\*", true, clusterIdentifier matches "{{clusterIdentifier}}") AND if ("{{errorCode}}" = "\*", true, errorCode matches "{{errorCode}}") AND if ("{{eventName}}" = "\*", true, eventName matches "{{eventName}}")  AND if ("{{eventStatus}}" = "\*", true, eventStatus matches "{{eventStatus}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}")<br />\|count as eventCount by eventName, accountId<br />\| transpose row accountId column eventName|
|Amazon Redshift ULM|Events by AccountId|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\""<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| where eventSource="redshift.amazonaws.com"<br />\| if (isEmpty(userName), user, userName) as user<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus <br />\| timeslice 1h<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{sourceipaddress}}" = "\*", true, sourceipaddress matches "{{sourceipaddress}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}") AND if ("{{awsregion}}" = "\*", true, awsregion matches "{{awsregion}}") AND if ("{{type}}" = "\*", true, type matches "{{type}}") AND if ("{{clusteridentifier}}" = "\*", true, clusteridentifier matches "{{clusteridentifier}}")<br />\|count as eventCount by accountId, awsRegion<br />\| transpose row accountId column awsRegion|
|Amazon Redshift ULM|Events by Regions|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\""<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| where eventSource="redshift.amazonaws.com"<br />\| if (isEmpty(userName), user, userName) as user<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus <br />\| timeslice 1h<br />\| where if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{awsRegion}}" = "\*", true, awsRegion matches "{{awsRegion}}") AND if ("{{clusterIdentifier}}" = "\*", true, clusterIdentifier matches "{{clusterIdentifier}}") AND if ("{{errorCode}}" = "\*", true, errorCode matches "{{errorCode}}") AND if ("{{eventName}}" = "\*", true, eventName matches "{{eventName}}")  AND if ("{{eventStatus}}" = "\*", true, eventStatus matches "{{eventStatus}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}")<br />\|count as eventCount by eventName, awsRegion<br />\| transpose row awsRegion column eventName|
|Amazon Redshift ULM|Events by User|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\""<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus<br />\| where eventSource="redshift.amazonaws.com"<br />\| if (isEmpty(userName), user, userName) as user<br />\| timeslice 1d<br />\| where if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{awsRegion}}" = "\*", true, awsRegion matches "{{awsRegion}}") AND if ("{{clusterIdentifier}}" = "\*", true, clusterIdentifier matches "{{clusterIdentifier}}") AND if ("{{errorCode}}" = "\*", true, errorCode matches "{{errorCode}}") AND if ("{{eventName}}" = "\*", true, eventName matches "{{eventName}}")  AND if ("{{eventStatus}}" = "\*", true, eventStatus matches "{{eventStatus}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}")<br />\|count as eventCount by user, eventName<br />\| transpose row user column eventName|
|Amazon Redshift ULM|Events by User Agents|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\""<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| where eventSource="redshift.amazonaws.com"<br />\| if (isEmpty(userName), user, userName) as user<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus <br />\| timeslice 1h<br />\| where if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{awsRegion}}" = "\*", true, awsRegion matches "{{awsRegion}}") AND if ("{{clusterIdentifier}}" = "\*", true, clusterIdentifier matches "{{clusterIdentifier}}") AND if ("{{errorCode}}" = "\*", true, errorCode matches "{{errorCode}}") AND if ("{{eventName}}" = "\*", true, eventName matches "{{eventName}}")  AND if ("{{eventStatus}}" = "\*", true, eventStatus matches "{{eventStatus}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}")<br />\|count as eventCount by eventName, userAgent<br />\| transpose row userAgent column eventName|
|Amazon Redshift ULM|Events Trend by Event Name|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\""<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| where eventSource="redshift.amazonaws.com"<br />\| if (isEmpty(userName), user, userName) as user<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus <br />\| timeslice 1h<br />\| where if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{awsRegion}}" = "\*", true, awsRegion matches "{{awsRegion}}") AND if ("{{clusterIdentifier}}" = "\*", true, clusterIdentifier matches "{{clusterIdentifier}}") AND if ("{{errorCode}}" = "\*", true, errorCode matches "{{errorCode}}") AND if ("{{eventName}}" = "\*", true, eventName matches "{{eventName}}")  AND if ("{{eventStatus}}" = "\*", true, eventStatus matches "{{eventStatus}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}")<br />\|count as eventCount by \_timeslice, eventName<br />\| transpose row \_timeslice column eventName|
|Amazon Redshift ULM|Failed Event Locations|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\"" errorCode<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus<br />\| where eventSource="redshift.amazonaws.com" and eventStatus="Failure"<br />\| if (isEmpty(userName), user, userName) as user<br />\| where if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{awsRegion}}" = "\*", true, awsRegion matches "{{awsRegion}}") AND if ("{{clusterIdentifier}}" = "\*", true, clusterIdentifier matches "{{clusterIdentifier}}") AND if ("{{errorCode}}" = "\*", true, errorCode matches "{{errorCode}}") AND if ("{{eventName}}" = "\*", true, eventName matches "{{eventName}}")  AND if ("{{eventStatus}}" = "\*", true, eventStatus matches "{{eventStatus}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}")<br />\|count by sourceIPAddress, eventName<br />\| lookup latitude, longitude from geo://location on ip = sourceIPAddress<br />\| sort \_count|
|Amazon Redshift ULM|Failed Events|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\"" errorCode<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus<br />\| where eventSource="redshift.amazonaws.com" and eventStatus="Failure"<br />\| if (isEmpty(userName), user, userName) as user<br />\| where if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{awsRegion}}" = "\*", true, awsRegion matches "{{awsRegion}}") AND if ("{{clusterIdentifier}}" = "\*", true, clusterIdentifier matches "{{clusterIdentifier}}") AND if ("{{errorCode}}" = "\*", true, errorCode matches "{{errorCode}}") AND if ("{{eventName}}" = "\*", true, eventName matches "{{eventName}}")  AND if ("{{eventStatus}}" = "\*", true, eventStatus matches "{{eventStatus}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}")<br />\|count as eventCount by eventName<br />\| sort by eventCount|
|Amazon Redshift ULM|Health Status|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=HealthStatus Statistic=Maximum ClusterIdentifier=\* \| max by ClusterIdentifier |
|Amazon Redshift ULM|Health Status|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=HealthStatus Statistic=Maximum ClusterIdentifier=\* \| max by ClusterIdentifier |
|Amazon Redshift ULM|Health Status|Metrics|Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier - New|clusteridentifier={{clusteridentifier}} metric={{metric}} namespace={{namespace}} statistic={{statistic}}  Namespace=AWS/Redshift metric=HealthStatus Statistic=Maximum ClusterIdentifier=\* \| max by ClusterIdentifier |
|Amazon Redshift ULM|Maintenance Mode|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=MaintenanceMode Statistic=Maximum ClusterIdentifier=\* \| max by ClusterIdentifier |
|Amazon Redshift ULM|Maintenance Mode|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=MaintenanceMode Statistic=Maximum ClusterIdentifier=\* \| max by ClusterIdentifier |
|Amazon Redshift ULM|Maintenance Mode|Metrics|Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier - New|clusteridentifier={{clusteridentifier}} metric={{metric}} namespace={{namespace}} statistic={{statistic}}  Namespace=AWS/Redshift metric=MaintenanceMode Statistic=Maximum ClusterIdentifier=\* \| max by ClusterIdentifier |
|Amazon Redshift ULM|Network Receive and Transmit Throughput|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=NetworkReceiveThroughput Statistic=Average ClusterIdentifier=\* \| avg by ClusterIdentifier |
|Amazon Redshift ULM|Network Receive Throughput|Metrics|Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier - New|clusteridentifier={{clusteridentifier}} metric={{metric}} namespace={{namespace}} statistic={{statistic}}  Namespace=AWS/Redshift metric=NetworkReceiveThroughput Statistic=Average ClusterIdentifier=\* \| avg by ClusterIdentifier |
|Amazon Redshift ULM|Network Receive Throughput|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=NetworkReceiveThroughput Statistic=Average ClusterIdentifier=\* \| avg by ClusterIdentifier |
|Amazon Redshift ULM|Network Receive Throughput|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=NetworkReceiveThroughput Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|Network Receive Throughput|Metrics|Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New|metric={{metric}} namespace={{namespace}} nodeid={{nodeid}} statistic={{statistic}}  Namespace=AWS/Redshift metric=NetworkReceiveThroughput Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|Network Transmit Throughput|Metrics|Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier - New|clusteridentifier={{clusteridentifier}} metric={{metric}} namespace={{namespace}} statistic={{statistic}}  Namespace=AWS/Redshift metric=NetworkTransmitThroughput Statistic=Average ClusterIdentifier=\* \| avg by ClusterIdentifier |
|Amazon Redshift ULM|Network Transmit Throughput|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=NetworkTransmitThroughput Statistic=Average ClusterIdentifier=\* \| avg by ClusterIdentifier |
|Amazon Redshift ULM|Network Transmit Throughput|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=NetworkTransmitThroughput Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|Network Transmit Throughput|Metrics|Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New|metric={{metric}} namespace={{namespace}} nodeid={{nodeid}} statistic={{statistic}}  Namespace=AWS/Redshift metric=NetworkTransmitThroughput Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|Percentage Disk Space Utilization|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=PercentageDiskSpaceUsed Statistic=Maximum ClusterIdentifier=\* \| max by ClusterIdentifier |
|Amazon Redshift ULM|Percentage Disk Space Utilization|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=PercentageDiskSpaceUsed Statistic=Maximum ClusterIdentifier=\* \| max by ClusterIdentifier |
|Amazon Redshift ULM|Percentage Disk Space Utilization|Metrics|Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New|metric={{metric}} namespace={{namespace}} nodeid={{nodeid}} statistic={{statistic}}  Namespace=AWS/Redshift metric=PercentageDiskSpaceUsed Statistic=Maximum NodeID=\* \| max by NodeID|
|Amazon Redshift ULM|Percentage Disk Space Utilization|Metrics|Amazon Redshift ULM/Amazon Redshift - Resource Utilization by ClusterIdentifier - New|clusteridentifier={{clusteridentifier}} metric={{metric}} namespace={{namespace}} statistic={{statistic}}  Namespace=AWS/Redshift metric=PercentageDiskSpaceUsed Statistic=Maximum ClusterIdentifier=\* \| max by ClusterIdentifier |
|Amazon Redshift ULM|Percentage Disk Space Utilization|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=PercentageDiskSpaceUsed Statistic=Maximum NodeID=\* \| max by NodeID|
|Amazon Redshift ULM|Read IOPS|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=ReadIOPS Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|Read IOPS|Metrics|Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New|metric={{metric}} namespace={{namespace}} nodeid={{nodeid}} statistic={{statistic}}  Namespace=AWS/Redshift metric=ReadIOPS Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|Read Latency|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=ReadLatency Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|Read Latency|Metrics|Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New|metric={{metric}} namespace={{namespace}} nodeid={{nodeid}} statistic={{statistic}}  Namespace=AWS/Redshift metric=ReadLatency Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|Read Throughput|Metrics|Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New|metric={{metric}} namespace={{namespace}} nodeid={{nodeid}} statistic={{statistic}}  Namespace=AWS/Redshift metric=ReadThroughput Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|Read Throughput|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=ReadThroughput Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|Recent Failed Event Details|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\"" errorCode<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus<br />\| where eventSource="redshift.amazonaws.com" and eventStatus="Failure"<br />\| if (isEmpty(userName), user, userName) as user<br />\| timeslice 1s<br />\| where if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{awsRegion}}" = "\*", true, awsRegion matches "{{awsRegion}}") AND if ("{{clusterIdentifier}}" = "\*", true, clusterIdentifier matches "{{clusterIdentifier}}") AND if ("{{errorCode}}" = "\*", true, errorCode matches "{{errorCode}}") AND if ("{{eventName}}" = "\*", true, eventName matches "{{eventName}}")  AND if ("{{eventStatus}}" = "\*", true, eventStatus matches "{{eventStatus}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}")<br />\|count as eventCount by \_timeslice, eventName, errorCode, errorMessage, awsRegion, sourceIPAddress, accountId, user, type, requestID<br />\| sort by \_timeslice|
|Amazon Redshift ULM|Recent Successful Event Details|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\""<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus<br />\| where eventSource="redshift.amazonaws.com" and eventStatus="Success"<br />\| if (isEmpty(userName), user, userName) as user<br />\| timeslice 1s<br />\| where if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{awsRegion}}" = "\*", true, awsRegion matches "{{awsRegion}}") AND if ("{{clusterIdentifier}}" = "\*", true, clusterIdentifier matches "{{clusterIdentifier}}") AND if ("{{errorCode}}" = "\*", true, errorCode matches "{{errorCode}}") AND if ("{{eventName}}" = "\*", true, eventName matches "{{eventName}}")  AND if ("{{eventStatus}}" = "\*", true, eventStatus matches "{{eventStatus}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}")<br />\| count as eventCount by \_timeslice, eventName, awsRegion, sourceIPAddress, accountId, user, type, requestId, userAgent, clusterIdentifier<br />\| sort by \_timeslice|
|Amazon Redshift ULM|Recent User Related Events|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG (crea\* or drop\* or alte\*) user<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| touppercase(command) as command \| touppercase (sqlstatement) as temp\_sqlstatement<br />\| where (command matches "CREA\*" or command matches "DROP\*" or command matches "ALTE\*") and (temp\_sqlstatement matches "\*CREA\*USER \*" or temp\_sqlstatement matches "\*DROP\*USER \*" or temp\_sqlstatement matches "\*ALTE\*USER \*")<br />\| where if ("{{command}}" = "\*", true, command matches "{{command}}") AND if ("{{dbName}}" = "\*", true, dbName matches "{{dbName}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{userid}}" = "\*", true, userid matches "{{userid}}")<br />\|count as eventCount by time, command, dbname, userid, username, pid, xid, sqlstatement<br />\| sort by time|
|Amazon Redshift ULM|Session Duration Stats|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  "disconnecting session"<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| where event matches "disconnecting session\*"<br />\| where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as sessionCount, sum(duration) as totalSessionTime, avg(duration) as avgSessionTime, min(duration) as minSessionTime, max(duration) as maxSessionTime, pct(duration, 90) as %"90%ile", pct(duration, 95) as %"95%ile"by username|
|Amazon Redshift ULM|Session Duration Stats|Logs|Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New|\_sourceCategory = Labs/AWS/Redshift/Audit\* "disconnecting session"<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| where event matches "disconnecting session\*"<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{application\_name}}" = "\*", true, application\_name matches "{{application\_name}}") AND if ("{{pid}}" = "\*", true, pid matches "{{pid}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as sessionCount, sum(duration) as totalSessionTime, avg(duration) as avgSessionTime, min(duration) as minSessionTime, max(duration) as maxSessionTime, pct(duration, 90) as %"90%ile", pct(duration, 95) as %"95%ile"by username|
|Amazon Redshift ULM|Session Duration Stats|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{ReshiftAuditLogsDataSource}}  "disconnecting session"<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| where event matches "disconnecting session\*"<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}") AND if ("{{type}}" = "\*", true, type matches "{{type}}") <br />\|count as sessionCount, sum(duration) as totalSessionTime, avg(duration) as avgSessionTime, min(duration) as minSessionTime, max(duration) as maxSessionTime, pct(duration, 90) as %"90%ile", pct(duration, 95) as %"95%ile"by username|
|Amazon Redshift ULM|SQL Command Execution Trend|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| touppercase(command) as command<br />\| timeslice 1h<br />\| where if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{dbName}}" = "\*", true, dbName matches "{{dbName}}") AND if ("{{command}}" = "\*", true, command matches "{{command}}")<br />\|count by \_timeslice, command<br />\| transpose row \_timeslice column command|
|Amazon Redshift ULM|SQL Command Execution Trend|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| touppercase(command) as command<br />\| timeslice 1h<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}") AND if ("{{type}}" = "\*", true, type matches "{{type}}") AND if ("{{command}}" = "\*", true, command matches "{{command}}")<br />\|count by \_timeslice, command<br />\| transpose row \_timeslice column command|
|Amazon Redshift ULM|SSL Cipher Used|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests" by sslcipher<br />\| where sslcipher != " "<br />\| sort by  %"Requests", sslcipher asc|
|Amazon Redshift ULM|SSL Cipher Used|Logs|Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New|\_sourceCategory = Labs/AWS/Redshift/Audit\* ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{application\_name}}" = "\*", true, application\_name matches "{{application\_name}}") AND if ("{{pid}}" = "\*", true, pid matches "{{pid}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests" by sslcipher<br />\| where sslcipher != " "<br />\| sort by  %"Requests", sslcipher asc|
|Amazon Redshift ULM|SSL Used|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests" by sslversion<br />\| if (sslversion==" ", "None", sslversion) as sslversion<br />\| top 10 sslversion by %"Requests", sslversion asc|
|Amazon Redshift ULM|SSL Used|Logs|Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New|\_sourceCategory = Labs/AWS/Redshift/Audit\* ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{application\_name}}" = "\*", true, application\_name matches "{{application\_name}}") AND if ("{{pid}}" = "\*", true, pid matches "{{pid}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests" by sslversion<br />\| if (sslversion==" ", "None", sslversion) as sslversion<br />\| top 10 sslversion by %"Requests", sslversion asc|
|Amazon Redshift ULM|SSL Used|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{ReshiftAuditLogsDataSource}}  ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s\\']\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}") AND if ("{{type}}" = "\*", true, type matches "{{type}}") <br />\|count as %"Requests" by sslversion<br />\| if (sslversion==" ", "None", sslversion) as sslversion<br />\| top 10 sslversion by %"Requests", sslversion asc|
|Amazon Redshift ULM|Successful Event Locations|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\""<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus<br />\| where eventSource="redshift.amazonaws.com" and eventStatus="Success"<br />\| if (isEmpty(userName), user, userName) as user<br />\| where if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{awsRegion}}" = "\*", true, awsRegion matches "{{awsRegion}}") AND if ("{{clusterIdentifier}}" = "\*", true, clusterIdentifier matches "{{clusterIdentifier}}") AND if ("{{errorCode}}" = "\*", true, errorCode matches "{{errorCode}}") AND if ("{{eventName}}" = "\*", true, eventName matches "{{eventName}}")  AND if ("{{eventStatus}}" = "\*", true, eventStatus matches "{{eventStatus}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}")<br />\|count by sourceIPAddress, eventName<br />\| lookup latitude, longitude from geo://location on ip = sourceIPAddress<br />\| sort \_count|
|Amazon Redshift ULM|Successful Events|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\""<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus<br />\| where eventSource="redshift.amazonaws.com" and eventStatus="Success"<br />\| if (isEmpty(userName), user, userName) as user<br />\| where if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{awsRegion}}" = "\*", true, awsRegion matches "{{awsRegion}}") AND if ("{{clusterIdentifier}}" = "\*", true, clusterIdentifier matches "{{clusterIdentifier}}") AND if ("{{errorCode}}" = "\*", true, errorCode matches "{{errorCode}}") AND if ("{{eventName}}" = "\*", true, eventName matches "{{eventName}}")  AND if ("{{eventStatus}}" = "\*", true, eventStatus matches "{{eventStatus}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}")<br />\|count as eventCount by eventName<br />\| sort by eventCount|
|Amazon Redshift ULM|Top Alter Command Execution|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG Alte\*<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| touppercase(command) as command<br />\| where command matches "ALTE\*"<br />\| count as eventCount by command, dbname, username, sqlstatement<br />\| top 20 sqlstatement, command, dbname, username by eventCount, command, dbname, username, sqlstatement asc|
|Amazon Redshift ULM|Top Applications|Logs|Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New|\_sourceCategory = Labs/AWS/Redshift/Audit\* ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| where !isBlank(application\_name)<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{application\_name}}" = "\*", true, application\_name matches "{{application\_name}}") AND if ("{{pid}}" = "\*", true, pid matches "{{pid}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests"by application\_name<br />\| top 10 application\_name by %"Requests", application\_name asc|
|Amazon Redshift ULM|Top Applications|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| where !isBlank(application\_name)<br />\| where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests"by application\_name<br />\| top 10 application\_name by %"Requests", application\_name asc|
|Amazon Redshift ULM|Top Cluster Identifiers|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\"" clusterIdentifier<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus<br />\| where eventSource="redshift.amazonaws.com"<br />\| where if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{awsRegion}}" = "\*", true, awsRegion matches "{{awsRegion}}") AND if ("{{clusterIdentifier}}" = "\*", true, clusterIdentifier matches "{{clusterIdentifier}}") AND if ("{{errorCode}}" = "\*", true, errorCode matches "{{errorCode}}") AND if ("{{eventName}}" = "\*", true, eventName matches "{{eventName}}")  AND if ("{{eventStatus}}" = "\*", true, eventStatus matches "{{eventStatus}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}")<br />\|count as eventCount by clusterIdentifier<br />\| sort by eventCount, clusterIdentifier asc|
|Amazon Redshift ULM|Top Cluster Identifiers|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\"" clusterIdentifier<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus<br />\| where eventSource="redshift.amazonaws.com"<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{sourceipaddress}}" = "\*", true, sourceipaddress matches "{{sourceipaddress}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}") AND if ("{{awsregion}}" = "\*", true, awsregion matches "{{awsregion}}") AND if ("{{type}}" = "\*", true, type matches "{{type}}") AND if ("{{clusteridentifier}}" = "\*", true, clusteridentifier matches "{{clusteridentifier}}")<br />\|count as eventCount by clusterIdentifier<br />\| sort by eventCount, clusterIdentifier asc|
|Amazon Redshift ULM|Top Create Command Execution|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG CREA\*<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| touppercase(command) as command<br />\| where command matches "CREA\*"<br />\| count as eventCount by command, dbname, username, sqlstatement<br />\| top 20 sqlstatement, command, dbname, username by eventCount, command, dbname, username, sqlstatement asc|
|Amazon Redshift ULM|Top Databases|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}") AND if ("{{type}}" = "\*", true, type matches "{{type}}") AND if ("{{command}}" = "\*", true, command matches "{{command}}")<br />\|count as eventCount by dbName<br />\| top 10 dbName by eventCount, dbName asc|
|Amazon Redshift ULM|Top Databases|Logs|Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New|\_sourceCategory = Labs/AWS/Redshift/Audit\* ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| parse regex field = dbname "(?\<dbname\>[^\\s]+)\\s\*" nodrop<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{application\_name}}" = "\*", true, application\_name matches "{{application\_name}}") AND if ("{{pid}}" = "\*", true, pid matches "{{pid}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests" by dbname<br />\| top 10 dbname by %"Requests", dbname asc|
|Amazon Redshift ULM|Top Databases|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| parse regex field = dbname "(?\<dbname\>[^\\s]+)\\s\*" nodrop<br />\| where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\| count as %"Requests" by dbname<br />\| top 10 dbname by %"Requests", dbname asc|
|Amazon Redshift ULM|Top Databases|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| where if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{dbName}}" = "\*", true, dbName matches "{{dbName}}") AND if ("{{command}}" = "\*", true, command matches "{{command}}")<br />\| count as eventCount by dbName<br />\| top 10 dbName by eventCount, dbName asc|
|Amazon Redshift ULM|Top Databases|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{ReshiftAuditLogsDataSource}}  ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s\\']\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| parse regex field = dbname "(?\<dbname\>[^\\s]+)\\s\*" nodrop<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}") AND if ("{{type}}" = "\*", true, type matches "{{type}}")<br />\|count as %"Requests" by dbname<br />\| top 10 dbname by %"Requests", dbname asc|
|Amazon Redshift ULM|Top Delete Command Execution|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG DELE\*<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| touppercase(command) as command<br />\| where command matches "DELE\*"<br />\| count as eventCount by command, dbname, username, sqlstatement<br />\| top 20 sqlstatement, command, dbname, username by eventCount, command, dbname, username, sqlstatement asc|
|Amazon Redshift ULM|Top Drop Command Execution|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG DROP\*<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| touppercase(command) as command<br />\| where command matches "DROP\*"<br />\| count as eventCount by command, dbname, username, sqlstatement<br />\| top 20 sqlstatement, command, dbname, username by eventCount, command, dbname, username, sqlstatement asc|
|Amazon Redshift ULM|Top Error Codes|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\"" errorCode<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus<br />\| where eventSource="redshift.amazonaws.com" and eventStatus="Failure"<br />\| where if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{awsRegion}}" = "\*", true, awsRegion matches "{{awsRegion}}") AND if ("{{clusterIdentifier}}" = "\*", true, clusterIdentifier matches "{{clusterIdentifier}}") AND if ("{{errorCode}}" = "\*", true, errorCode matches "{{errorCode}}") AND if ("{{eventName}}" = "\*", true, eventName matches "{{eventName}}")  AND if ("{{eventStatus}}" = "\*", true, eventStatus matches "{{eventStatus}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}")<br />\|count as eventCount by errorCode <br />\| top 10 errorCode by eventCount|
|Amazon Redshift ULM|Top Events|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| if (event matches "authenticated\*", "authenticated", if (event matches "set\*application\_name\*", "set application\_name", if (event matches "disconnecting session\*", "disconnecting session", if (event matches "initiating session\*", "initiating session", event)))) as event<br />\| where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\| count as %"Requests" by event<br />\| top 10 event by %"Requests", event asc|
|Amazon Redshift ULM|Top Events|Logs|Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New|\_sourceCategory = Labs/AWS/Redshift/Audit\* ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| if (event matches "authenticated\*", "authenticated", if (event matches "set\*application\_name\*", "set application\_name", if (event matches "disconnecting session\*", "disconnecting session", if (event matches "initiating session\*", "initiating session", event)))) as event<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{application\_name}}" = "\*", true, application\_name matches "{{application\_name}}") AND if ("{{pid}}" = "\*", true, pid matches "{{pid}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests" by event<br />\| top 10 event by %"Requests", event asc|
|Amazon Redshift ULM|Top Grant Command Execution|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG GRAN\*<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| touppercase(command) as command<br />\| where command matches "GRAN\*"<br />\| count as eventCount by command, dbname, username, sqlstatement<br />\| top 20 sqlstatement, command, dbname, username by eventCount, command, dbname, username, sqlstatement asc|
|Amazon Redshift ULM|Top Remote Hosts|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{ReshiftAuditLogsDataSource}}  ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s\\']\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}") AND if ("{{type}}" = "\*", true, type matches "{{type}}")<br />\|count as %"Requests" by remotehost<br />\| top 10 remotehost by %"Requests", remotehost asc|
|Amazon Redshift ULM|Top Remote Hosts|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests" by remotehost<br />\| top 10 remotehost by %"Requests", remotehost asc|
|Amazon Redshift ULM|Top Remote Hosts|Logs|Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New|\_sourceCategory = Labs/AWS/Redshift/Audit\* ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{application\_name}}" = "\*", true, application\_name matches "{{application\_name}}") AND if ("{{pid}}" = "\*", true, pid matches "{{pid}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests" by remotehost<br />\| top 10 remotehost by %"Requests", remotehost asc|
|Amazon Redshift ULM|Top Revoke Command Execution|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG REVO\*<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| touppercase(command) as command<br />\| where command matches "REVO\*"<br />\| count as eventCount by command, dbname, username, sqlstatement<br />\| top 20 sqlstatement, command, dbname, username by eventCount, command, dbname, username, sqlstatement asc|
|Amazon Redshift ULM|Top SQL Commands|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| touppercase(command) as command<br />\| where if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{dbName}}" = "\*", true, dbName matches "{{dbName}}") AND if ("{{command}}" = "\*", true, command matches "{{command}}")<br />\|count as eventCount by command<br />\| top 20 command by eventCount, command asc|
|Amazon Redshift ULM|Top SQL Commands|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| touppercase(command) as command<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}") AND if ("{{type}}" = "\*", true, type matches "{{type}}") AND if ("{{command}}" = "\*", true, command matches "{{command}}")<br />\|count as eventCount by command<br />\| top 20 command by eventCount, command asc|
|Amazon Redshift ULM|Top SQL Statements|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| where if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{dbName}}" = "\*", true, dbName matches "{{dbName}}") AND if ("{{command}}" = "\*", true, command matches "{{command}}")<br />\|count as eventCount by sqlstatement<br />\| top 20 sqlstatement by eventCount, sqlstatement asc|
|Amazon Redshift ULM|Top Successful Events|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\""<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus<br />\| where eventSource="redshift.amazonaws.com" and eventStatus="Success"<br />\| if (isEmpty(userName), user, userName) as user<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{sourceipaddress}}" = "\*", true, sourceipaddress matches "{{sourceipaddress}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}") AND if ("{{awsregion}}" = "\*", true, awsregion matches "{{awsregion}}") AND if ("{{type}}" = "\*", true, type matches "{{type}}") AND if ("{{clusteridentifier}}" = "\*", true, clusteridentifier matches "{{clusteridentifier}}")<br />\|count as eventCount by eventName<br />\| sort by eventCount|
|Amazon Redshift ULM|Top Truncate Command Execution|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG TRUN\*<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| touppercase(command) as command<br />\| where command matches "TRUN\*"<br />\| count as eventCount by command, dbname, username, sqlstatement<br />\| top 20 sqlstatement, command, dbname, username by eventCount, command, dbname, username, sqlstatement asc|
|Amazon Redshift ULM|Top Users|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}") AND if ("{{type}}" = "\*", true, type matches "{{type}}") AND if ("{{command}}" = "\*", true, command matches "{{command}}")<br />\|count as eventCount by username<br />\| top 10 username by eventCount, username asc|
|Amazon Redshift ULM|Top Users|Logs|Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis - New|\_sourceCategory = Labs/AWS/Redshift/Audit\* ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{application\_name}}" = "\*", true, application\_name matches "{{application\_name}}") AND if ("{{pid}}" = "\*", true, pid matches "{{pid}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests" by username<br />\| top 10 username by %"Requests", username asc|
|Amazon Redshift ULM|Top Users|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{ReshiftAuditLogsDataSource}}  ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\|where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}") AND if ("{{type}}" = "\*", true, type matches "{{type}}")<br />\|count as %"Requests" by username<br />\| top 10 username by %"Requests", username asc|
|Amazon Redshift ULM|Top Users|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| where if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{dbName}}" = "\*", true, dbName matches "{{dbName}}") AND if ("{{command}}" = "\*", true, command matches "{{command}}")<br />\| count as eventCount by username<br />\| top 10 username by eventCount, username asc|
|Amazon Redshift ULM|Top Users|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - Connection Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  ("authenticated" or "authentication failure" or "initiating session" or "connecting session" or "disconnecting session" or "set application\_name" or "Terminating backend on administrator")<br />\| parse regex "^(?\<event\>[\\w]+[\\w\\s]\*)\\\|(?\<eventDetails\>.\*)"<br />\| parse "\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*\|\*" as event, recordtime, remotehost, remoteport, pid, dbname, username, authmethod, duration, sslversion, sslcipher, mtu, sslcompression, sslexpansion, something1, application\_name<br />\| where if ("{{dbname}}" = "\*", true, dbname matches "{{dbname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{event}}" = "\*", true, event matches "{{event}}") AND if ("{{sslversion}}" = "\*", true, sslversion matches "{{sslversion}}") AND if ("{{authmethod}}" = "\*", true, authmethod matches "{{authmethod}}") AND if ("{{remotehost}}" = "\*", true, remotehost matches "{{remotehost}}") AND if ("{{remoteport}}" = "\*", true, remoteport matches "{{remoteport}}") AND if ("{{sslcipher}}" = "\*", true, sslcipher matches "{{sslcipher}}")<br />\|count as %"Requests" by username<br />\| top 10 username by %"Requests", username asc|
|Amazon Redshift ULM|Top Users by Type|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\""<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| where eventSource="redshift.amazonaws.com"<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus<br />\| if (isEmpty(userName), user, userName) as user<br />\| where if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{awsRegion}}" = "\*", true, awsRegion matches "{{awsRegion}}") AND if ("{{clusterIdentifier}}" = "\*", true, clusterIdentifier matches "{{clusterIdentifier}}") AND if ("{{errorCode}}" = "\*", true, errorCode matches "{{errorCode}}") AND if ("{{eventName}}" = "\*", true, eventName matches "{{eventName}}")  AND if ("{{eventStatus}}" = "\*", true, eventStatus matches "{{eventStatus}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}")<br />\|count as eventCount by user, type<br />\| topk(10,eventCount) by type|
|Amazon Redshift ULM|Top Users by Type|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\""<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| where eventSource="redshift.amazonaws.com"<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus<br />\| if (isEmpty(userName), user, userName) as user<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{username}}" = "\*", true, username matches "{{username}}") AND if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{sourceipaddress}}" = "\*", true, sourceipaddress matches "{{sourceipaddress}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}") AND if ("{{awsregion}}" = "\*", true, awsregion matches "{{awsregion}}") AND if ("{{type}}" = "\*", true, type matches "{{type}}") AND if ("{{clusteridentifier}}" = "\*", true, clusteridentifier matches "{{clusteridentifier}}")<br />\|count as eventCount by user, type<br />\| topk(10,eventCount) by type|
|Amazon Redshift ULM|Top Vacuum Command Execution|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Audit - User Activity Log Analysis|\_sourceCategory={{ReshiftAuditLogsDataSource}}  LOG VACU\*<br />\| parse regex "^\\'(?\<time\>\\d+\\-\\d+\\-\\d+T\\d+:\\d+:\\d+Z \\w+)\\s+\\[\\s\*(?\<parameters\>[^\\]]+)\\]\\'\\s+LOG:\\s+(?\<sqlstatement\>[^;]\*)"<br />\| parse field=parameters "db=\* user=\* pid=\* userid=\* xid=\*" as dbName, username, pid, userid, xid nodrop<br />\| parse regex field = sqlstatement "^/\\\*(?:.\|[\\r\\n])\*?\\\*/\\s+(?\<command\>\\w+)\\s\*" nodrop<br />\| parse regex field = sqlstatement "^(?\<command\>\\w+)\\s\*" nodrop<br />\| touppercase(command) as command<br />\| where command matches "VACU\*"<br />\| count as eventCount by command, dbname, username, sqlstatement<br />\| top 20 sqlstatement, command, dbname, username by eventCount, command, dbname, username, sqlstatement asc|
|Amazon Redshift ULM|User Type Trend|Logs|Installed Apps/Amazon Redshift ULM/Amazon Redshift - CloudTrail Events Overview|\_sourceCategory={{ReshiftCloudTrailLogsDataSource}}  "\\"eventSource\\":\\"redshift.amazonaws.com\\""<br />\| json "eventTime" nodrop \| json "eventSource" nodrop \| json "eventName" nodrop \| json "awsRegion" nodrop \| json "sourceIPAddress" nodrop \| json "eventType" nodrop \| json "errorCode" nodrop \| json "errorMessage" nodrop \| json "userAgent" nodrop \| json "requestID" nodrop \| json "userIdentity.accountId" as accountId nodrop \| json "userIdentity.arn" as arn nodrop \| parse field=arn ":assumed-role/\*" as user nodrop \| parse field=arn "arn:aws:iam::\*:\*" as accountId, user nodrop \| json "userIdentity.userName" as username nodrop \| json "userIdentity.type" as type nodrop \| json "requestParameters.clusterIdentifier" as clusterIdentifier1 nodrop \| json "responseElements.clusters" as clusters nodrop \| parse regex "clusterIdentifier\\":\\"(?\<clusterIdentifier2\>[^\\"]\*)\\"" nodrop<br />\| if (!isEMpty(clusterIdentifier1), clusterIdentifier1, clusterIdentifier2) as clusterIdentifier<br />\| where eventSource="redshift.amazonaws.com"<br />\| if (isEmpty(errorCode), "Success", "Failure") as eventStatus<br />\| if (isEmpty(userName), user, userName) as user<br />\| timeslice 1d<br />\| where if ("{{accountid}}" = "\*", true, accountid matches "{{accountid}}") AND if ("{{awsRegion}}" = "\*", true, awsRegion matches "{{awsRegion}}") AND if ("{{clusterIdentifier}}" = "\*", true, clusterIdentifier matches "{{clusterIdentifier}}") AND if ("{{errorCode}}" = "\*", true, errorCode matches "{{errorCode}}") AND if ("{{eventName}}" = "\*", true, eventName matches "{{eventName}}")  AND if ("{{eventStatus}}" = "\*", true, eventStatus matches "{{eventStatus}}") AND if ("{{user}}" = "\*", true, user matches "{{user}}")<br />\|count as eventCount by \_timeslice, type<br />\| transpose row \_timeslice column type|
|Amazon Redshift ULM|WLM Queue Length|Metrics|Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New|metric={{metric}} namespace={{namespace}} nodeid={{nodeid}} statistic={{statistic}}  Namespace=AWS/Redshift metric=WLMQueueLength Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|WLM Queue Length|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=WLMQueueLength Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|Write IOPS|Metrics|Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New|metric={{metric}} namespace={{namespace}} nodeid={{nodeid}} statistic={{statistic}}  Namespace=AWS/Redshift metric=WriteIOPS Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|Write IOPS|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=WriteIOPS Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|Write Latency|Metrics|Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New|metric={{metric}} namespace={{namespace}} nodeid={{nodeid}} statistic={{statistic}}  Namespace=AWS/Redshift metric=WriteLatency Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|Write Latency|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=WriteLatency Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|Write Throughput|Metrics|Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID - New|metric={{metric}} namespace={{namespace}} nodeid={{nodeid}} statistic={{statistic}}  Namespace=AWS/Redshift metric=WriteThroughput Statistic=Average NodeID=\* \| avg by NodeID |
|Amazon Redshift ULM|Write Throughput|Metrics|Installed Apps/Amazon Redshift ULM/Amazon Redshift - Resource Utilization by NodeID|\_sourceCategory={{Metricsdatasource}}  Namespace=AWS/Redshift metric=WriteThroughput Statistic=Average NodeID=\* \| avg by NodeID |

