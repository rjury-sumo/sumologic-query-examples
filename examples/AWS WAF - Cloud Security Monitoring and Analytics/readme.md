# AWS WAF - Cloud Security Monitoring and Analytics

## Searches

### Log Searches

- **All Traffic by Rule ID**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Monitoring - Overview 
- **All Traffic by Rule Type**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Monitoring - Overview 
- **Allowed Threats Breakdown by Sources**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence 
- **Allowed Threats by Actors**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence 
- **Allowed Threats Trend**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence 
- **Allowed traffic by Country**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Traffic 
- **Allowed Traffic by Location**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Traffic 
- **Allowed Traffic by Malicious IPs**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence 
- **Allowed traffic by Rule ID**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Traffic 
- **Allowed traffic by Rule Type**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Traffic 
- **Allowed Traffic by Threat Confidence**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence 
- **Anomalies within Allowed Traffic**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Traffic 
- **Anomalies within Blocked Traffic**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Traffic 
- **Blocked Threat Breakdown by Sources**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence 
- **Blocked Threats by Actors**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence 
- **Blocked Threats Trend**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence 
- **Blocked Traffic by Country**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Traffic 
- **Blocked Traffic by Location**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Traffic 
- **Blocked Traffic by Malicious IPs**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence 
- **Blocked Traffic by Rule ID**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Traffic 
- **Blocked Traffic by Rule Type**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Traffic 
- **Blocked Traffic by Threat Confidence**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence 
- **HTTP Methods**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Monitoring - Overview 
- **HTTP Versions**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Monitoring - Overview 
- **IP Count**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Monitoring - Overview 
- **Traffic Map**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Monitoring - Overview 
- **Traffic Trend**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Monitoring - Overview 
- **Unique Allowed Threats Map**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence 
- **Unique Blocked Threats Map**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence 
- **URI Hits**: from Dashboard: AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Monitoring - Overview

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|AWS WAF - Cloud Security Monitoring and Analytics|All Traffic by Rule ID|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/WAF <br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where httpMethod matches "{{Client\_Request\_Method}}"<br />\| where clientIP matches "{{Client\_IP}}" <br />\| where action matches "{{Action}}"<br />\| count as count by terminatingruleid<br />|
|AWS WAF - Cloud Security Monitoring and Analytics|All Traffic by Rule Type|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/WAF <br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where httpMethod matches "{{Client\_Request\_Method}}"<br />\| where clientIP matches "{{Client\_IP}}" <br />\| where action matches "{{Action}}"<br />\| timeslice 15m<br />\| count by terminatingruletype, \_timeslice<br />\| transpose row \_timeslice column terminatingruletype<br />|
|AWS WAF - Cloud Security Monitoring and Analytics|Allowed Threats Breakdown by Sources|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where clientIP matches "{{Client\_IP}}"<br />\| count as allowed\_ips by clientip, \_sourceCategory<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (allowed\_ips) as threat\_count by \_sourceCategory |
|AWS WAF - Cloud Security Monitoring and Analytics|Allowed Threats by Actors|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where clientIP matches "{{Client\_IP}}"<br />\| count as allowed\_ips by clientip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (allowed\_ips) as threat\_count by Actor|
|AWS WAF - Cloud Security Monitoring and Analytics|Allowed Threats Trend|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where clientIP matches "{{Client\_IP}}"<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| timeslice 5m<br />\| count as count by \_timeslice<br /><br />|
|AWS WAF - Cloud Security Monitoring and Analytics|Allowed traffic by Country|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Traffic|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\| timeslice 5m<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where httpMethod matches "{{Client\_Request\_Method}}"<br />\| where clientIP matches "{{Client\_IP}}" <br />\| count by country\_name, \_timeslice<br />\| transpose row \_timeslice column country\_name|
|AWS WAF - Cloud Security Monitoring and Analytics|Allowed Traffic by Location|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Traffic|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where httpMethod matches "{{Client\_Request\_Method}}"<br />\| where clientIP matches "{{Client\_IP}}" <br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count<br />|
|AWS WAF - Cloud Security Monitoring and Analytics|Allowed Traffic by Malicious IPs|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where clientIP matches "{{Client\_IP}}"<br />\| count as allowed\_ips by clientip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (allowed\_ips) as threat\_count by clientip, malicious\_confidence, Actor, label\_name<br />\| sort by threat\_count|
|AWS WAF - Cloud Security Monitoring and Analytics|Allowed traffic by Rule ID|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Traffic|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where httpMethod matches "{{Client\_Request\_Method}}"<br />\| where clientIP matches "{{Client\_IP}}" <br />\| count as count by terminatingRuleId<br />\| sort count<br />|
|AWS WAF - Cloud Security Monitoring and Analytics|Allowed traffic by Rule Type|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Traffic|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where httpMethod matches "{{Client\_Request\_Method}}"<br />\| where clientIP matches "{{Client\_IP}}" <br />\| count by terminatingruletype<br />|
|AWS WAF - Cloud Security Monitoring and Analytics|Allowed Traffic by Threat Confidence|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where clientIP matches "{{Client\_IP}}"<br />\| count as allowed\_ips by clientip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum (allowed\_ips) as threat\_count by malicious\_confidence<br />\| sort by threat\_count|
|AWS WAF - Cloud Security Monitoring and Analytics|Anomalies within Allowed Traffic|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Traffic|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where httpMethod matches "{{Client\_Request\_Method}}"<br />\| where clientIP matches "{{Client\_IP}}" <br />\| timeslice 15m<br />\| count as Blocked by \_timeslice<br />\| outlier Blocked|
|AWS WAF - Cloud Security Monitoring and Analytics|Anomalies within Blocked Traffic|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Traffic|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where httpMethod matches "{{Client\_Request\_Method}}"<br />\| where clientIP matches "{{Client\_IP}}" <br />\| timeslice 15m<br />\| count as Blocked by \_timeslice<br />\| outlier Blocked|
|AWS WAF - Cloud Security Monitoring and Analytics|Blocked Threat Breakdown by Sources|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where clientIP matches "{{Client\_IP}}"<br />\| count as blocked\_ips by clientip, \_sourceCategory<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (blocked\_ips) as threat\_count by \_sourceCategory |
|AWS WAF - Cloud Security Monitoring and Analytics|Blocked Threats by Actors|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where clientIP matches "{{Client\_IP}}"<br />\| count as blocked\_ips by clientip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (blocked\_ips) as threat\_count by Actor|
|AWS WAF - Cloud Security Monitoring and Analytics|Blocked Threats Trend|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where clientIP matches "{{Client\_IP}}"<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| timeslice 5m<br />\| count by \_timeslice<br /><br />|
|AWS WAF - Cloud Security Monitoring and Analytics|Blocked Traffic by Country|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Traffic|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\| timeslice 5m<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where httpMethod matches "{{Client\_Request\_Method}}"<br />\| where clientIP matches "{{Client\_IP}}" <br />\| count by country\_name, \_timeslice<br />\| transpose row \_timeslice column country\_name|
|AWS WAF - Cloud Security Monitoring and Analytics|Blocked Traffic by Location|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Traffic|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where httpMethod matches "{{Client\_Request\_Method}}"<br />\| where clientIP matches "{{Client\_IP}}" <br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count<br />|
|AWS WAF - Cloud Security Monitoring and Analytics|Blocked Traffic by Malicious IPs|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where clientIP matches "{{Client\_IP}}"<br />\| count as blocked\_ips by clientip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (blocked\_ips) as threat\_count by clientip, malicious\_confidence, Actor, label\_name<br />\| sort by threat\_count|
|AWS WAF - Cloud Security Monitoring and Analytics|Blocked Traffic by Rule ID|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Traffic|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where httpMethod matches "{{Client\_Request\_Method}}"<br />\| where clientIP matches "{{Client\_IP}}" <br />\| count as count by terminatingRuleId<br />\| sort count<br />|
|AWS WAF - Cloud Security Monitoring and Analytics|Blocked Traffic by Rule Type|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Traffic|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where httpMethod matches "{{Client\_Request\_Method}}"<br />\| where clientIP matches "{{Client\_IP}}" <br />\| count by terminatingruletype<br />|
|AWS WAF - Cloud Security Monitoring and Analytics|Blocked Traffic by Threat Confidence|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where clientIP matches "{{Client\_IP}}"<br />\| count as blocked\_ips by clientip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum (blocked\_ips) as threat\_count by malicious\_confidence<br />\| sort by threat\_count|
|AWS WAF - Cloud Security Monitoring and Analytics|HTTP Methods|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/WAF <br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where httpMethod matches "{{Client\_Request\_Method}}"<br />\| where clientIP matches "{{Client\_IP}}" <br />\| count as count by httpmethod<br />\| sort count<br />|
|AWS WAF - Cloud Security Monitoring and Analytics|HTTP Versions|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/WAF <br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where httpMethod matches "{{Client\_Request\_Method}}"<br />\| where clientIP matches "{{Client\_IP}}" <br />\| where action matches "{{Action}}"<br />\| count as count by httpversion<br />\| sort count<br />|
|AWS WAF - Cloud Security Monitoring and Analytics|IP Count|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/WAF <br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where httpMethod matches "{{Client\_Request\_Method}}"<br />\| where clientIP matches "{{Client\_IP}}" <br />\| where action matches "{{Action}}" <br />\| timeslice 15m<br />\| count by terminatingruletype, \_timeslice<br />\| transpose row \_timeslice column terminatingruletype    |
|AWS WAF - Cloud Security Monitoring and Analytics|Traffic Map|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/WAF <br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where httpMethod matches "{{Client\_Request\_Method}}"<br />\| where clientIP matches "{{Client\_IP}}" <br />\| where action matches "{{Action}}"<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count<br />|
|AWS WAF - Cloud Security Monitoring and Analytics|Traffic Trend|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/WAF <br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where httpMethod matches "{{Client\_Request\_Method}}"<br />\| where clientIP matches "{{Client\_IP}}" <br />\| timeslice 15m<br />\| if(action="BLOCK",1,0) as Blocked\_count<br />\| if(action="ALLOW",1,0) as Allowed\_count<br />\| sum(Blocked\_count) as Blocked, sum(Allowed\_count) as Allowed by \_timeslice|
|AWS WAF - Cloud Security Monitoring and Analytics|Unique Allowed Threats Map|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence|\_sourceCategory = Labs/AWS/WAF  ALLOW<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="ALLOW"<br />\| count as allowed\_ips by clientip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where clientIP matches "{{Client\_IP}}"<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count<br />|
|AWS WAF - Cloud Security Monitoring and Analytics|Unique Blocked Threats Map|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Analytics - Threat Intelligence|\_sourceCategory = Labs/AWS/WAF  BLOCK<br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId nodrop<br />\| where action="BLOCK"<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where clientIP matches "{{Client\_IP}}"<br />\| count as allowed\_ips by clientip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=clientip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = clientip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count<br />|
|AWS WAF - Cloud Security Monitoring and Analytics|URI Hits|Logs|AWS WAF - Cloud Security Monitoring and Analytics/AWS WAF - Security Monitoring - Overview|\_sourceCategory = Labs/AWS/WAF <br />\| parse "\\"httpMethod\\":\\"\*\\"," as httpMethod,"\\"httpVersion\\":\\"\*\\"," as httpVersion,"\\"uri\\":\\"\*\\"," as uri, "{\\"clientIp\\":\\"\*\\",\\"country\\":\\"\*\\"" as clientIp,country, "\\"action\\":\\"\*\\"" as action, "\\"matchingNonTerminatingRules\\":[\*]" as matchingNonTerminatingRules, "\\"rateBasedRuleList\\":[\*]" as rateBasedRuleList, "\\"ruleGroupList\\":[\*]" as ruleGroupList, "\\"httpSourceId\\":\\"\*\\"" as httpSourceId, "\\"httpSourceName\\":\\"\*\\"" as httpSourceName, "\\"terminatingRuleType\\":\\"\*\\"" as terminatingRuleType, "\\"terminatingRuleId\\":\\"\*\\"" as terminatingRuleId, "\\"webaclId\\":\\"\*\\"" as webaclId<br />\| lookup country\_name from geo://location on ip = clientip<br />\| where country\_name matches "{{Country\_of\_Interest}}"<br />\| where httpMethod matches "{{Client\_Request\_Method}}"<br />\| where clientIP matches "{{Client\_IP}}" <br />\| where action matches "{{Action}}"<br />\| count as count by uri<br />\| sort count<br />|

