# CIS AWS Foundations Benchmark
## Sumo Logic App For: CIS AWS Foundations Benchmark
The Sumo Logic App for CIS AWS Benchmark - Monitoring maps to Section 3 (Monitoring) of the CIS AWS Benchmarks Foundation Recommendations. This App provides preconfigured Dashboards and searches that allow you to alert on and gain operational visibility into your AWS security posture.
Docs Link: [CIS AWS Foundations Benchmark](https://help.sumologic.com/?cid=1095)

## Searches

### Log Searches

- **Alert - CloudTrail Changes**: from Search: CIS AWS Foundations Benchmark/Alerts/Alert - CloudTrail Changes 
- **Alert - Config Changes**: from Search: CIS AWS Foundations Benchmark/Alerts/Alert - Config Changes 
- **Alert - Console Logins without MFA**: from Search: CIS AWS Foundations Benchmark/Alerts/Alert - Console Logins without MFA 
- **Alert - Disabled or Scheduled Deletion of CMK**: from Search: CIS AWS Foundations Benchmark/Alerts/Alert - Disabled or Scheduled Deletion of CMK 
- **Alert - Failed Console Logins**: from Search: CIS AWS Foundations Benchmark/Alerts/Alert - Failed Console Logins 
- **Alert - Gateway Changes**: from Search: CIS AWS Foundations Benchmark/Alerts/Alert - Gateway Changes 
- **Alert - IAM Policy Changes**: from Search: CIS AWS Foundations Benchmark/Alerts/Alert - IAM Policy Changes 
- **Alert - Network ACL Changes**: from Search: CIS AWS Foundations Benchmark/Alerts/Alert - Network ACL Changes 
- **Alert - Root Account Logins**: from Search: CIS AWS Foundations Benchmark/Alerts/Alert - Root Account Logins 
- **Alert - Route Table Changes**: from Search: CIS AWS Foundations Benchmark/Alerts/Alert - Route Table Changes 
- **Alert - S3 Bucket Policy Changes**: from Search: CIS AWS Foundations Benchmark/Alerts/Alert - S3 Bucket Policy Changes 
- **Alert - Security Group Changes**: from Search: CIS AWS Foundations Benchmark/Alerts/Alert - Security Group Changes 
- **Alert - Unauthorized AWS API Requests**: from Search: CIS AWS Foundations Benchmark/Alerts/Alert - Unauthorized AWS API Requests 
- **Alert - VPC Changes**: from Search: CIS AWS Foundations Benchmark/Alerts/Alert - VPC Changes 
- **Console Logins without MFA**: from Dashboard: CIS AWS Foundations Benchmark/CIS AWS Benchmark (Monitoring) - Access and Authentication - New 
- **Disabled or Scheduled Deletion of CMK**: from Dashboard: CIS AWS Foundations Benchmark/CIS AWS Benchmark (Monitoring) - Access and Authentication - New 
- **Failed Console Logins**: from Dashboard: CIS AWS Foundations Benchmark/CIS AWS Benchmark (Monitoring) - Access and Authentication - New 
- **Failed Console Logins by Location**: from Dashboard: CIS AWS Foundations Benchmark/CIS AWS Benchmark (Monitoring) - Access and Authentication - New 
- **Outlier - Failed Console Logins**: from Dashboard: CIS AWS Foundations Benchmark/CIS AWS Benchmark (Monitoring) - Access and Authentication - New 
- **Root Account Logins**: from Dashboard: CIS AWS Foundations Benchmark/CIS AWS Benchmark (Monitoring) - Access and Authentication - New 
- **Unauthorized AWS API Requests**: from Dashboard: CIS AWS Foundations Benchmark/CIS AWS Benchmark (Monitoring) - Access and Authentication - New

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|CIS AWS Foundations Benchmark/Alerts|Alert - CloudTrail Changes|Logs|CIS AWS Foundations Benchmark/Alerts/Alert - CloudTrail Changes|\_sourceCategory = Labs/AWS/CloudTrail\* (\*Trail or StartLogging or StopLogging)<br />\| json field=\_raw "awsRegion" as region<br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json field=\_raw "sourceIPAddress" as ip\_add<br />\| json field=\_raw "userIdentity.userName" as user\_name<br />\| json "eventName"<br />\| where (eventName matches "\*Trail" or eventName matches "StartLogging" or eventName matches "StopLogging")<br />\| count by eventName, user\_name<br />\| transpose row user\_name column eventName|
|CIS AWS Foundations Benchmark/Alerts|Alert - Config Changes|Logs|CIS AWS Foundations Benchmark/Alerts/Alert - Config Changes|\_sourceCategory = Labs/AWS/CloudTrail\* ("StopConfigurationRecorder" or "DeleteDeliveryChannel" or "PutDeliveryChannel" or "PutConfigurationRecorder")<br />\| json field=\_raw "awsRegion" as region<br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json field=\_raw "sourceIPAddress" as ip\_add<br />\| json field=\_raw "userIdentity.userName" as user\_name<br />\| json "eventName"<br />\| where eventName matches "StopConfigurationRecorder" or eventName matches "DeleteDeliveryChannel" or eventName matches "PutDeliveryChannel" or eventName matches "PutConfigurationRecorder"<br />\| count by eventName, user\_name<br />\| transpose row user\_name column eventName|
|CIS AWS Foundations Benchmark/Alerts|Alert - Console Logins without MFA|Logs|CIS AWS Foundations Benchmark/Alerts/Alert - Console Logins without MFA|\_sourceCategory = Labs/AWS/CloudTrail\* (!Failure and "ConsoleLogin")<br />\| json field=\_raw "awsRegion" as region<br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json "eventName", "additionalEventData.MFAUsed" as eventName, MFAUsed nodrop<br />\| json "userIdentity.userName", "responseElements.ConsoleLogin" as user\_name, loginResult nodrop<br />\| json "sourceIPAddress" as src\_ip<br />\| where loginResult\<\>"Failure"<br />\| where eventName matches "ConsoleLogin"<br />\| where mfaUsed\<\>"Yes"<br />\| count by user\_name<br />\| sort by \_count|
|CIS AWS Foundations Benchmark/Alerts|Alert - Disabled or Scheduled Deletion of CMK|Logs|CIS AWS Foundations Benchmark/Alerts/Alert - Disabled or Scheduled Deletion of CMK|\_sourceCategory = Labs/AWS/CloudTrail\* ("DisableKey" or "ScheduleKeyDeletion")<br />\| json field=\_raw "awsRegion" as region<br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json field=\_raw "userIdentity.userName" as user\_name<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json "eventName"<br />\| where eventName matches "DisableKey" or eventName matches "ScheduleKeyDeletion"<br />\| count by eventName, user\_name<br />\| transpose row user\_name column eventName|
|CIS AWS Foundations Benchmark/Alerts|Alert - Failed Console Logins|Logs|CIS AWS Foundations Benchmark/Alerts/Alert - Failed Console Logins|\_sourceCategory = Labs/AWS/CloudTrail\* ("ConsoleLogin" and "Failed authentication")<br />\| json field=\_raw "awsRegion" as region<br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json "eventName"<br />\| json "errorMessage"<br />\| json "responseElements.ConsoleLogin", "userIdentity.userName" as loginResult, user\_name<br />\| where (eventName matches "ConsoleLogin" and errorMessage matches "Failed authentication")<br />\| count by user\_name|
|CIS AWS Foundations Benchmark/Alerts|Alert - Gateway Changes|Logs|CIS AWS Foundations Benchmark/Alerts/Alert - Gateway Changes|\_sourceCategory = Labs/AWS/CloudTrail\* ("CreateCustomerGateway" or "DeleteCustomerGateway" or "AttachInternetGateway" or "CreateInternetGateway" or "DeleteInternetGateway" or "DetachInternetGateway")<br />\| json field=\_raw "userIdentity.sessionContext.sessionIssuer.userName" as user\_name<br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "awsRegion" as region<br />\| json "eventName"<br />\| where eventName matches "CreateCustomerGateway" or eventName matches "DeleteCustomerGateway" or eventName matches "AttachInternetGateway" or eventName matches "CreateInternetGateway" or eventName matches "DeleteInternetGateway" or eventName matches "DetachInternetGateway"<br />\| count by eventName, user\_name<br />\| transpose row user\_name column eventName|
|CIS AWS Foundations Benchmark/Alerts|Alert - IAM Policy Changes|Logs|CIS AWS Foundations Benchmark/Alerts/Alert - IAM Policy Changes|\_sourceCategory = Labs/AWS/CloudTrail\* (Put\*Policy or Delete\*Policy\* or Attach\*Policy or Detach\*Policy or CreatePolicy\*)<br />\| json field=\_raw "awsRegion" as region<br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json field=\_raw "sourceIPAddress" as ip\_add<br />\| json field=\_raw "userIdentity.userName" as user\_name<br />\| json "eventName"<br />\| where (eventName matches "Put\*Policy" or eventName matches "Delete\*Policy\*" or eventName matches "Attach\*Policy" or eventName matches "Detach\*Policy" or eventName matches "CreatePolicy\*")<br />\| count by eventName, user\_name<br />\| transpose row user\_name column eventName|
|CIS AWS Foundations Benchmark/Alerts|Alert - Network ACL Changes|Logs|CIS AWS Foundations Benchmark/Alerts/Alert - Network ACL Changes|\_sourceCategory = Labs/AWS/CloudTrail\* ("CreateNetworkAcl" or "CreateNetworkAclEntry" or "DeleteNetworkAcl" or "DeleteNetworkAclEntry" or "ReplaceNetworkAclEntry" or "ReplaceNetworkAclAssociation")<br />\| json field=\_raw "userIdentity.sessionContext.sessionIssuer.userName" as user\_name<br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "awsRegion" as region<br />\| json "eventName"<br />\| where eventName matches "CreateNetworkAcl" or eventName matches "CreateNetworkAclEntry" or eventName matches "DeleteNetworkAcl" or eventName matches "DeleteNetworkAclEntry" or eventName matches  "ReplaceNetworkAclEntry" or eventName matches "ReplaceNetworkAclAssociation"<br />\| count by eventName,user\_name<br />\| transpose row user\_name column eventName|
|CIS AWS Foundations Benchmark/Alerts|Alert - Root Account Logins|Logs|CIS AWS Foundations Benchmark/Alerts/Alert - Root Account Logins|\_sourceCategory = Labs/AWS/CloudTrail\* "Root"<br />\| json field=\_raw "awsRegion" as region<br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "eventName"<br />\| json "userIdentity.type" as loginType<br />\| json "userIdentity.userName" as user\_name<br />\| where loginType="Root"<br />\| count by user\_name|
|CIS AWS Foundations Benchmark/Alerts|Alert - Route Table Changes|Logs|CIS AWS Foundations Benchmark/Alerts/Alert - Route Table Changes|\_sourceCategory = Labs/AWS/CloudTrail\* ("CreateRoute" or "CreateRouteTable" or "ReplaceRoute" or "ReplaceRouteTableAssociation" or "DeleteRouteTable" or  "DeleteRoute" or "DisassociateRouteTable")<br />\| json field=\_raw "userIdentity.sessionContext.sessionIssuer.userName" as user\_name<br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "awsRegion" as region<br />\| json "eventName"<br />\| where eventName matches "CreateRoute" or eventName matches "CreateRouteTable" or eventName matches "ReplaceRoute" or eventName matches "ReplaceRouteTableAssociation" or eventName matches "DeleteRouteTable" or eventName matches "DeleteRoute" or eventName matches "DisassociateRouteTable"<br />\| count by eventName,user\_name<br />\| transpose row user\_name column eventName|
|CIS AWS Foundations Benchmark/Alerts|Alert - S3 Bucket Policy Changes|Logs|CIS AWS Foundations Benchmark/Alerts/Alert - S3 Bucket Policy Changes|\_sourceCategory = Labs/AWS/CloudTrail\* (\*BucketAcl or \*BucketPolicy or \*BucketCors or \*BucketLifecycle)<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "userIdentity.userName" as user\_name<br />\| json field=\_raw "awsRegion" as region <br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json "eventName"<br />\| where eventName matches "\*BucketAcl" or eventName matches "\*BucketPolicy" or eventName matches "\*BucketCors" or eventName matches "\*BucketLifecycle"<br />\| count by eventName,user\_name<br />\| transpose row user\_name column eventName|
|CIS AWS Foundations Benchmark/Alerts|Alert - Security Group Changes|Logs|CIS AWS Foundations Benchmark/Alerts/Alert - Security Group Changes|\_sourceCategory = Labs/AWS/CloudTrail\* ("CreateSecurityGroup" or "DeleteSecurityGroup" or "RevokeSecurityGroupEgress" or "RevokeSecurityGroupIngress")<br />\| json field=\_raw "userIdentity.sessionContext.sessionIssuer.userName" as user\_name<br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "awsRegion" as region<br />\| json "eventName" <br />\| where eventName matches "CreateSecurityGroup" or eventName matches "DeleteSecurityGroup" or eventName matches "RevokeSecurityGroupEgress" or eventName matches "RevokeSecurityGroupIngress"<br />\| count by eventName,user\_name<br />\| transpose row user\_name column eventName|
|CIS AWS Foundations Benchmark/Alerts|Alert - Unauthorized AWS API Requests|Logs|CIS AWS Foundations Benchmark/Alerts/Alert - Unauthorized AWS API Requests|\_sourceCategory = Labs/AWS/CloudTrail\* ("AccessDenied" or "UnauthorizedOperation")<br />\| json field=\_raw "awsRegion" as region<br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json "errorCode" as error<br />\| json field=\_raw "eventName"<br />\| json "userIdentity.sessionContext.sessionIssuer.userName" as user\_name<br />\| where error="AccessDenied" or error="UnauthorizedOperation"<br />\| count by user\_name, error <br />\| transpose row user\_name column error|
|CIS AWS Foundations Benchmark/Alerts|Alert - VPC Changes|Logs|CIS AWS Foundations Benchmark/Alerts/Alert - VPC Changes|\_sourceCategory = Labs/AWS/CloudTrail\* ("CreateVpc" or "DeleteVpc" or "ModifyVpcAttribute" or \*VpcPeeringConnection or \*tachClassicLink or \*ableVpcClassic)<br />\| json field=\_raw "userIdentity.sessionContext.sessionIssuer.userName" as user\_name<br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "awsRegion" as region<br />\| json "eventName" <br />\| where eventName matches "CreateVpc" or eventName matches "DeleteVpc" or eventName matches "ModifyVpcAttribute" or eventName matches "\*VpcPeeringConnection" or eventName matches "\*tachClassicLink" or eventName matches "\*ableVpcClassic"<br />\| count by eventName,user\_name<br />\| transpose row user\_name column eventName|
|CIS AWS Foundations Benchmark|Console Logins without MFA|Logs|CIS AWS Foundations Benchmark/CIS AWS Benchmark (Monitoring) - Access and Authentication - New|\_sourceCategory = Labs/AWS/CloudTrail\* (!Failure and "ConsoleLogin")<br />\| json field=\_raw "awsRegion" as region<br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json "eventName", "additionalEventData.MFAUsed" as eventName, MFAUsed nodrop<br />\| json "userIdentity.userName", "responseElements.ConsoleLogin" as user\_name, loginResult nodrop<br />\| json "sourceIPAddress" as src\_ip<br />\| where loginResult\<\>"Failure"<br />\| where eventName matches "ConsoleLogin"<br />\| where mfaUsed\<\>"Yes"<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{user\_name}}" = "\*", true, user\_name matches "{{user\_name}}") AND if ("{{region}}" = "\*", true, region matches "{{region}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{acc\_id}}" = "\*", true, acc\_id matches "{{acc\_id}}")<br />\|count by user\_name<br />\| sort by \_count|
|CIS AWS Foundations Benchmark|Disabled or Scheduled Deletion of CMK|Logs|CIS AWS Foundations Benchmark/CIS AWS Benchmark (Monitoring) - Access and Authentication - New|\_sourceCategory = Labs/AWS/CloudTrail\* ("DisableKey" or "ScheduleKeyDeletion")<br />\| json field=\_raw "awsRegion" as region<br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json field=\_raw "userIdentity.userName" as user\_name<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json "eventName"<br />\| where eventName matches "DisableKey" or eventName matches "ScheduleKeyDeletion"<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{user\_name}}" = "\*", true, user\_name matches "{{user\_name}}") AND if ("{{region}}" = "\*", true, region matches "{{region}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{acc\_id}}" = "\*", true, acc\_id matches "{{acc\_id}}")<br />\|count by eventName, user\_name<br />\| transpose row user\_name column eventName|
|CIS AWS Foundations Benchmark|Failed Console Logins|Logs|CIS AWS Foundations Benchmark/CIS AWS Benchmark (Monitoring) - Access and Authentication - New|\_sourceCategory = Labs/AWS/CloudTrail\* ("ConsoleLogin" and "Failed authentication")<br />\| json field=\_raw "awsRegion" as region<br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json "eventName"<br />\| json "errorMessage"<br />\| json "responseElements.ConsoleLogin", "userIdentity.userName" as loginResult, user\_name<br />\| where (eventName matches "ConsoleLogin" and errorMessage matches "Failed authentication")<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{user\_name}}" = "\*", true, user\_name matches "{{user\_name}}") AND if ("{{region}}" = "\*", true, region matches "{{region}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{acc\_id}}" = "\*", true, acc\_id matches "{{acc\_id}}")<br />\|count by user\_name|
|CIS AWS Foundations Benchmark|Failed Console Logins by Location|Logs|CIS AWS Foundations Benchmark/CIS AWS Benchmark (Monitoring) - Access and Authentication - New|\_sourceCategory = Labs/AWS/CloudTrail\* ("ConsoleLogin" and "Failed authentication")<br />\| json field=\_raw "awsRegion" as region<br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "userIdentity.userName" as user\_name<br />\| json "eventName"<br />\| json "errorMessage"<br />\| json "responseElements.ConsoleLogin", "userIdentity.userName" as loginResult, user\_name<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = src\_ip<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{user\_name}}" = "\*", true, user\_name matches "{{user\_name}}") AND if ("{{region}}" = "\*", true, region matches "{{region}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{acc\_id}}" = "\*", true, acc\_id matches "{{acc\_id}}")<br />\|count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|CIS AWS Foundations Benchmark|Outlier - Failed Console Logins|Logs|CIS AWS Foundations Benchmark/CIS AWS Benchmark (Monitoring) - Access and Authentication - New|\_sourceCategory = Labs/AWS/CloudTrail\* ("ConsoleLogin" and "Failed authentication")<br />\| json field=\_raw "awsRegion" as region<br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json "eventName"<br />\| json "errorMessage"<br />\| json "responseElements.ConsoleLogin", "userIdentity.userName" as loginResult, user\_name<br />\| where (eventName matches "ConsoleLogin" and errorMessage matches "Failed authentication")<br />\| timeslice 1h<br />\| count by \_timeslice<br />\| outlier \_count  <br /><br />|
|CIS AWS Foundations Benchmark|Root Account Logins|Logs|CIS AWS Foundations Benchmark/CIS AWS Benchmark (Monitoring) - Access and Authentication - New|\_sourceCategory = Labs/AWS/CloudTrail\* "Root"<br />\| json field=\_raw "awsRegion" as region<br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json field=\_raw "eventName"<br />\| json "userIdentity.type" as loginType<br />\| json "userIdentity.userName" as user\_name<br />\| where loginType="Root"<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{user\_name}}" = "\*", true, user\_name matches "{{user\_name}}") AND if ("{{region}}" = "\*", true, region matches "{{region}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{acc\_id}}" = "\*", true, acc\_id matches "{{acc\_id}}")<br />\|count by user\_name|
|CIS AWS Foundations Benchmark|Unauthorized AWS API Requests|Logs|CIS AWS Foundations Benchmark/CIS AWS Benchmark (Monitoring) - Access and Authentication - New|\_sourceCategory = Labs/AWS/CloudTrail\* ("AccessDenied" or "UnauthorizedOperation")<br />\| json field=\_raw "awsRegion" as region<br />\| json field=\_raw "userIdentity.accountId" as acc\_id<br />\| json field=\_raw "sourceIPAddress" as src\_ip<br />\| json "errorCode" as error<br />\| json field=\_raw "eventName"<br />\| json "userIdentity.sessionContext.sessionIssuer.userName" as user\_name<br />\| where error="AccessDenied" or error="UnauthorizedOperation"<br />\|where if ("{{eventname}}" = "\*", true, eventname matches "{{eventname}}") AND if ("{{user\_name}}" = "\*", true, user\_name matches "{{user\_name}}") AND if ("{{region}}" = "\*", true, region matches "{{region}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{acc\_id}}" = "\*", true, acc\_id matches "{{acc\_id}}")<br />\|count by user\_name, error <br />\| transpose row user\_name column error|

