# Nginx Plus
## Sumo Logic App For: Nginx Plus
The Nginx Plus app is a unified logs and metrics app that helps you monitor the availability, performance, health and resource utilization of your Nginx Plus web servers. Preconfigured dashboards and searches provide insight into server status, location zones, server zones, upstreams, resolvers, visitor locations, visitor access types, traffic patterns, errors, web server operations and access from known malicious sources.
Docs Link: [Nginx Plus](https://help.sumologic.com/?cid=210525)

## Searches

### Log Searches

- **5xx Codes by Server**: from Dashboard: Nginx Plus/Nginx Plus - Overview 
- **All Errors**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Error Logs Analysis 
- **Browsers and Operating Systems**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Visitor Access Types 
- **Bytes Served**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Visitor Traffic Insight 
- **Bytes Served**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Outlier Analysis 
- **Client Errors**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Outlier Analysis 
- **Client Locations 4xx Errors**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Web Server Operations 
- **Client Locations with Critical Errors**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Error Logs Analysis 
- **Critical Error Messages**: from Dashboard: Nginx Plus/Nginx Plus - Overview 
- **Critical Messages**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Error Logs Analysis 
- **Desktop OS Version**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Visitor Access Types 
- **Error Responses by Server**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Web Server Operations 
- **Highly Malicious Threat Table**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Threat Intel 
- **HTTP Methods**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Visitor Traffic Insight 
- **Log Level - One Day Time Comparison**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Error Logs Analysis 
- **Media Types Served**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Visitor Traffic Insight 
- **Messages by Log Level - Over Time**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Error Logs Analysis 
- **Nginx Plus - All Error Messages**: from Search: Nginx Plus/Searches/Nginx Plus - All Error Messages 
- **Nginx Plus - All HTTP Response codes with their count**: from Search: Nginx Plus/Searches/Nginx Plus - All HTTP Response codes with their count 
- **Nginx Plus - Client Errors (4xx response codes) per day**: from Search: Nginx Plus/Searches/Nginx Plus - Client Errors (4xx response codes) per day 
- **Nginx Plus - HTTP status code summary over time**: from Search: Nginx Plus/Searches/Nginx Plus - HTTP status code summary over time 
- **Nginx Plus - Top 404 referrers**: from Search: Nginx Plus/Searches/Nginx Plus - Top 404 referrers 
- **Nginx Plus - Top browsers**: from Search: Nginx Plus/Searches/Nginx Plus - Top browsers 
- **Nginx Plus - Top clients**: from Search: Nginx Plus/Searches/Nginx Plus - Top clients 
- **Nginx Plus - Top clients causing errors**: from Search: Nginx Plus/Searches/Nginx Plus - Top clients causing errors 
- **Nginx Plus - Top URLs by bytes served**: from Search: Nginx Plus/Searches/Nginx Plus - Top URLs by bytes served 
- **Nginx Plus - Traffic volume and bytes served per day**: from Search: Nginx Plus/Searches/Nginx Plus - Traffic volume and bytes served per day 
- **Non 200 Response Status Codes**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Web Server Operations 
- **Number of Hits by Server - One Day Time Comparison**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Logs Timeline Analysis 
- **Number of Requests by Client - One Day Time Comparison**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Error Logs Analysis 
- **Number of Visitors**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Outlier Analysis 
- **Popular Mobile Device Versions**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Visitor Access Types 
- **Responses Over Time**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Logs Timeline Analysis 
- **Responses Over Time**: from Dashboard: Nginx Plus/Nginx Plus - Overview 
- **Server Errors**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Outlier Analysis 
- **Server Errors Over Time**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Web Server Operations 
- **Threat Breakdown by Sources**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Threat Intel 
- **Threat by Actors**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Threat Intel 
- **Threat by Malicious Confidence**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Threat Intel 
- **Threat Count**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Threat Intel 
- **Threat Locations**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Threat Intel 
- **Threat Table**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Threat Intel 
- **Top 10 Bots Observed**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Web Server Operations 
- **Top 10 Search Terms from Popular Search Engines**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Visitor Traffic Insight 
- **Top 5 Clients Causing 4xx Errors**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Web Server Operations 
- **Top 5 Clients causing Errors**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Error Logs Analysis 
- **Top 5 Critical Messages**: from Dashboard: Nginx Plus/Nginx Plus - Overview 
- **Top 5 Highly Malicious URLs**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Threat Intel 
- **Top 5 Referrers**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Visitor Traffic Insight 
- **Top 5 Servers with Errors**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Error Logs Analysis 
- **Top 5 URIs causing 404 Responses**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Web Server Operations 
- **Top 5 URLs**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Visitor Traffic Insight 
- **Top 5 URLs with Errors**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Error Logs Analysis 
- **Traffic Distribution by Server**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Logs Timeline Analysis 
- **Traffic Volume and Bytes Served**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Logs Timeline Analysis 
- **Unique Visitors**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Visitor Access Types 
- **United States**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Visitor Locations 
- **Visitor Locations**: from Dashboard: Nginx Plus/Nginx Plus - Overview 
- **Visitor Locations - One Day Time Comparison**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Logs Timeline Analysis 
- **Visitor Platforms**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Visitor Access Types 
- **Visitors Platforms Over Time**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Visitor Access Types 
- **Visits by Country Over Time**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Visitor Locations 
- **Visits by US Regions Over Time**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Visitor Locations 
- **WorldWide**: from Dashboard: Nginx Plus/Logs/Nginx Plus - Visitor Locations

### Metric Searches

- **1xx Responses**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones 
- **1xx Responses**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams 
- **1xx Responses**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones 
- **2xx Responses**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones 
- **2xx Responses**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones 
- **2xx Responses**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams 
- **3xx Responses**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones 
- **3xx Responses**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams 
- **3xx Responses**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones 
- **4xx Error Percentage by Server**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones 
- **4xx Error Percentage by Server**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones 
- **4xx Response Percentage by Upstream**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams 
- **4xx Responses**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones 
- **4xx Responses**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones 
- **4xx Responses**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams 
- **5xx Error Percentage by Server**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones 
- **5xx Error Percentage by Server**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones 
- **5xx Response Percentage by Upstream**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams 
- **5xx Responses**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones 
- **5xx Responses**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams 
- **5xx Responses**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones 
- **Accepted and Dropped Connections per Second**: from Dashboard: Nginx Plus/Nginx Plus - Overview 
- **Accepted Connections / Second**: from Dashboard: Nginx Plus/Nginx Plus - Overview 
- **Active Connections**: from Dashboard: Nginx Plus/Nginx Plus - Overview 
- **Active Connections**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams 
- **All Error Responses by Server and Zone**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Resolvers 
- **Backup Servers**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams 
- **BackUp Servers**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams 
- **Cache Hit Rate**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Caches 
- **Cache Hit Rate Over Time**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Caches 
- **Cache Hit Rate Percentage**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Caches 
- **Cold Caches**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Caches 
- **Connect Time**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams 
- **Connections per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Zones 
- **Connections per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams 
- **Current Connections**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Zones 
- **Current Connections**: from Dashboard: Nginx Plus/Nginx Plus - Overview 
- **Current Requests**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones 
- **Current Requests**: from Dashboard: Nginx Plus/Nginx Plus - Overview 
- **Discarded Traffic per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones 
- **Discarded Traffic per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones 
- **Disk Usage**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Caches 
- **Disk Usage Over Time**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Caches 
- **Disk Usage Percentage**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Caches 
- **Dropped Connections**: from Dashboard: Nginx Plus/Nginx Plus - Overview 
- **Errors**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Resolvers 
- **Failed Handshakes per Second**: from Dashboard: Nginx Plus/Nginx Plus - Overview 
- **Failed Health Checks per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams 
- **Failed Health Checks per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams 
- **Failed Servers**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams 
- **Failed Upstream Server Checks per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams 
- **Failed Upstream Server Checks per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams 
- **Failed Upstream Servers**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams 
- **Format Errors per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Resolvers 
- **Host Not Found Errors per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Resolvers 
- **Idle Connections**: from Dashboard: Nginx Plus/Nginx Plus - Overview 
- **Operation Refused Errors per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Resolvers 
- **Received Traffic per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Zones 
- **Received Traffic per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones 
- **Received Traffic per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams 
- **Received Traffic per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams 
- **Received Traffic per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones 
- **Requests**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Resolvers 
- **Requests per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams 
- **Requests per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones 
- **Requests per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Resolvers 
- **Requests per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones 
- **Response Time**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams 
- **Sent Traffic per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Zones 
- **Sent Traffic per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams 
- **Sent Traffic per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones 
- **Sent Traffic per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams 
- **Sent Traffic per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones 
- **Server Failures per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Resolvers 
- **Sessions Reuses per Second**: from Dashboard: Nginx Plus/Nginx Plus - Overview 
- **Successes**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Resolvers 
- **Successes per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Resolvers 
- **Timed Out Requests per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Resolvers 
- **Total Caches**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Caches 
- **Total Connections**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Zones 
- **Total Requests**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones 
- **Total Requests**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones 
- **Total Requests**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones 
- **Total Requests per Second**: from Dashboard: Nginx Plus/Nginx Plus - Overview 
- **Total Zones**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Resolvers 
- **Total Zones**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Zones 
- **Traffic Received**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones 
- **Traffic Received**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Zones 
- **Traffic Received**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones 
- **Traffic Sent**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Zones 
- **Traffic Sent**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones 
- **Traffic Sent**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones 
- **Unavailable Upstream Server Checks per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams 
- **Unavailable Upstream Server Checks per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams 
- **Unhealthy Upstream Server Checks per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams 
- **Unhealthy Upstream Server Checks per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams 
- **Unimplemented Errors per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Resolvers 
- **Unknown Errors per Second**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Resolvers 
- **Upstream Response Time**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams 
- **Upstream Server Downtime**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams 
- **Upstream Servers Downtime (minutes)**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams 
- **Upstreams**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams 
- **Upstreams**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams 
- **Upstreams Servers**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams 
- **Upstreams Servers**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams 
- **Warm Caches**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Caches 
- **Warnings**: from Dashboard: Nginx Plus/Metrics/Nginx Plus - Caches

## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Nginx Plus/Metrics|1xx Responses|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_upstream\_peers\_responses\_total upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| sum by upstream, upstream\_address, source|
|Nginx Plus/Metrics|1xx Responses|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_location\_zones\_responses\_total zone = {{Zone}} source = {{Server}} \| sum by Zone, Source|
|Nginx Plus/Metrics|1xx Responses|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_server\_zones\_responses\_total zone = {{Zone}} source = {{Server}} \| sum by Zone, Source|
|Nginx Plus/Metrics|2xx Responses|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_upstream\_peers\_responses\_total upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| sum by upstream, upstream\_address, source|
|Nginx Plus/Metrics|2xx Responses|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_server\_zones\_responses\_total zone = {{Zone}} source = {{Server}} \| sum by Zone, Source|
|Nginx Plus/Metrics|2xx Responses|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_location\_zones\_responses\_total zone = {{Zone}} source = {{Server}} \| sum by Zone, Source|
|Nginx Plus/Metrics|3xx Responses|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_upstream\_peers\_responses\_total upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| sum by upstream, upstream\_address, source|
|Nginx Plus/Metrics|3xx Responses|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_server\_zones\_responses\_total zone = {{Zone}} source = {{Server}} \| sum by Zone, Source|
|Nginx Plus/Metrics|3xx Responses|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_location\_zones\_responses\_total zone = {{Zone}} source = {{Server}} \| sum by Zone, Source|
|Nginx Plus/Metrics|4xx Error Percentage by Server|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_location\_zones\_responses\_total zone = {{Zone}} source = {{Server}} \| sum by Zone, Source|
|Nginx Plus/Metrics|4xx Error Percentage by Server|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_server\_zones\_responses\_total zone = {{Zone}} source = {{Server}} \| sum by Zone, Source|
|Nginx Plus/Metrics|4xx Response Percentage by Upstream|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_upstream\_peers\_responses\_total upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| sum by upstream, upstream\_address, source|
|Nginx Plus/Metrics|4xx Responses|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_upstream\_peers\_responses\_total upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| sum by upstream, upstream\_address, source|
|Nginx Plus/Metrics|4xx Responses|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_location\_zones\_responses\_total zone = {{Zone}} source = {{Server}} \| sum by Zone, Source|
|Nginx Plus/Metrics|4xx Responses|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_server\_zones\_responses\_total zone = {{Zone}} source = {{Server}} \| sum by Zone, Source|
|Nginx Plus|5xx Codes by Server|Logs|Nginx Plus/Nginx Plus - Overview|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" <br />\| where status\_code matches "5\*"<br />\| count as count by status\_code, \_sourceHost|
|Nginx Plus/Metrics|5xx Error Percentage by Server|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_server\_zones\_responses\_total zone = {{Zone}} source = {{Server}} \| sum by Zone, Source|
|Nginx Plus/Metrics|5xx Error Percentage by Server|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_location\_zones\_responses\_total zone = {{Zone}} source = {{Server}} \| sum by Zone, Source|
|Nginx Plus/Metrics|5xx Response Percentage by Upstream|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_upstream\_peers\_responses\_total upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| sum by upstream, upstream\_address, source|
|Nginx Plus/Metrics|5xx Responses|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_upstream\_peers\_responses\_total upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| sum by upstream, upstream\_address, source|
|Nginx Plus/Metrics|5xx Responses|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_location\_zones\_responses\_total zone = {{Zone}} source = {{Server}} \| sum by Zone, Source|
|Nginx Plus/Metrics|5xx Responses|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_server\_zones\_responses\_total zone = {{Zone}} source = {{Server}} \| sum by Zone, Source|
|Nginx Plus|Accepted and Dropped Connections per Second|Metrics|Nginx Plus/Nginx Plus - Overview|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_connections\_accepted source={{Source}} \| rate|
|Nginx Plus|Accepted Connections / Second|Metrics|Nginx Plus/Nginx Plus - Overview|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_connections\_accepted source={{Source}} \| sum \| rate|
|Nginx Plus|Active Connections|Metrics|Nginx Plus/Nginx Plus - Overview|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_connections\_active source={{Source}} \| sum|
|Nginx Plus/Metrics/Nginx Plus - TCP|Active Connections|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_upstream\_peers\_active upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| sum by source, upstream, upstream\_address|
|Nginx Plus/Metrics|All Error Responses by Server and Zone|Metrics|Nginx Plus/Metrics/Nginx Plus - Resolvers|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_resolver\_zones\_formerr source = {{Server}} zone = {{Zone}} \| sum by zone, source|
|Nginx Plus/Logs|All Errors|Logs|Nginx Plus/Logs/Nginx Plus - Error Logs Analysis|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| where Log\_Level matches "{{Log\_Level}}" and Client\_Ip matches "{{Client\_Ip}}" and Server matches "{{Server}}" and Method matches "{{Method}}" and URL matches "{{URL}}"<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss:SSS") as messageDate<br />\| count by messageDate, log\_level, Client\_Ip, Server, Method, URL, Message<br />\| fields - \_count<br />\| sort by messageDate<br />\| limit 50|
|Nginx Plus/Metrics|BackUp Servers|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_upstream\_peers\_backup upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| quantize 60s \| sum|
|Nginx Plus/Metrics/Nginx Plus - TCP|Backup Servers|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_upstream\_peers\_backup upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| quantize 60s \| sum|
|Nginx Plus/Logs|Browsers and Operating Systems|Logs|Nginx Plus/Logs/Nginx Plus - Visitor Access Types|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| if (user\_agent matches "\*Windows \*" OR user\_agent matches "\*Win32\*" OR user\_agent matches "\*Win64\*","Windows","") as OS <br />\| if (user\_agent matches "\*Macintosh\*" OR user\_agent matches "\*Darwin/\*" OR user\_agent matches "\*Mac OS\*","MacOS",OS) as OS <br />\| if (user\_agent matches "\* CrOS \*","Chrome OS",OS) as OS<br />\| if (user\_agent matches "\*Linux\*","Linux",OS) as OS <br />\| if (user\_agent matches "\*iPad\*","iPad",OS) as OS <br />\| if (user\_agent matches "\*iPhone\*","iPhone",OS) as OS <br />\| if (user\_agent matches "\*Android\*","Android",OS) as OS <br />\| if (user\_agent matches "\*Windows Phone\*","Windows Phone",OS) as OS <br />\| if (OS == "","Other",OS) as OS <br />\| if (user\_agent matches "Mozilla/\*; rv:\*)\*","Mozilla","") as Browser<br />\| if (user\_agent matches "\*MSIE\*","Internet Explorer",Browser) as Browser <br />\| if (user\_agent matches "\*Firefox\*","Firefox",Browser) as Browser <br />\| if (user\_agent matches "\*Safari\*","Safari",Browser) as Browser <br />\| if (OS=="Android" AND user\_agent matches "\*WebKit\*","WebKit",Browser) as Browser<br />\| if ((OS=="iPhone" OR OS=="iPad") AND (user\_agent matches "\*Mobile/\*" OR user\_agent matches "\*AppleWebKit\*(KHTML\*Gecko)\*"),"Mobile Safari",Browser) as Browser<br />\| if (browser == "" AND OS=="MacOS" AND user\_agent matches "Mozilla/\* (Macintosh;\*(KHTML, like Gecko)\*","Safari",Browser) as Browser <br />\| if (user\_agent matches "\*MobileSafari/\*","Mobile Safari",Browser) as Browser<br />\| if (user\_agent matches "\*Chrome\*","Chrome",Browser) as Browser <br />\| if (user\_agent matches "Opera\*","Opera",Browser) as Browser <br />\| if (user\_agent matches "Dolphin\*","Dolphin",Browser) as Browser <br />\| if (Browser == "","Other",Browser) as Browser  <br />\| count by OS,browser<br />\| transpose row Browser column OS|
|Nginx Plus/Logs|Bytes Served|Logs|Nginx Plus/Logs/Nginx Plus - Visitor Traffic Insight|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| sum(Size) as Bytes\_Served<br />\| Bytes\_Served/(1024\*1024\*1000) as Gbytes\_Served<br />\| fields Gbytes\_Served|
|Nginx Plus/Logs|Bytes Served|Logs|Nginx Plus/Logs/Nginx Plus - Outlier Analysis|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}"<br />\| where size != "-" and !isEmpty(size)<br />\| number(size)<br />\| timeslice {{TimeSlice}} \| (size/(1048576\*1000)) as gbytes <br />\| sum(gbytes) as gbytes by \_timeslice <br />\| sort \_timeslice asc<br />\| outlier gbytes window={{Window}},threshold={{Threshold}},consecutive={{Consecutive}},direction=+- |
|Nginx Plus/Metrics|Cache Hit Rate|Metrics|Nginx Plus/Metrics/Nginx Plus - Caches|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_caches\_hit\_bytes source = {{Server}} cache = {{Cache}} \| quantize 60s \| sum|
|Nginx Plus/Metrics|Cache Hit Rate Over Time|Metrics|Nginx Plus/Metrics/Nginx Plus - Caches|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_caches\_hit\_bytes source = {{Server}} cache = {{Cache}} \| sum by cache, source|
|Nginx Plus/Metrics|Cache Hit Rate Percentage|Metrics|Nginx Plus/Metrics/Nginx Plus - Caches|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_caches\_hit\_bytes source = {{Server}} cache = {{Cache}} \| sum by cache, source|
|Nginx Plus/Logs|Client Errors|Logs|Nginx Plus/Logs/Nginx Plus - Outlier Analysis|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}"<br />\| if(status\_code matches "4\*", 1, 0) as client\_errors <br />\| timeslice {{TimeSlice}}<br />\| sum(client\_errors) as client\_errors by \_timeslice<br />\| sort \_timeslice asc<br />\| outlier client\_errors window={{Window}},threshold={{Threshold}},consecutive={{Consecutive}},direction=+|
|Nginx Plus/Logs|Client Locations 4xx Errors|Logs|Nginx Plus/Logs/Nginx Plus - Web Server Operations|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| where status\_code matches "4\*"<br />\| count by Client\_Ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Nginx Plus/Logs|Client Locations with Critical Errors|Logs|Nginx Plus/Logs/Nginx Plus - Error Logs Analysis|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| where Log\_Level matches "{{Log\_Level}}" and Client\_Ip matches "{{Client\_Ip}}" and Server matches "{{Server}}" and Method matches "{{Method}}" and URL matches "{{URL}}"<br />\| where log\_level in ("emerg", "alert", "crit")<br />\| count by Client\_Ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Nginx Plus/Metrics|Cold Caches|Metrics|Nginx Plus/Metrics/Nginx Plus - Caches|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_caches\_cold source = {{Server}} cache = {{Cache}} \| quantize 60s \| filter latest=1 \| count|
|Nginx Plus/Metrics/Nginx Plus - TCP|Connect Time|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_upstream\_peers\_connect\_time upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| sum by upstream, upstream\_address, source|
|Nginx Plus/Metrics/Nginx Plus - TCP|Connections per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_server\_zones\_connections zone = {{Zone}} source = {{Server}} \| rate|
|Nginx Plus/Metrics/Nginx Plus - TCP|Connections per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_upstream\_peers\_active upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| rate|
|Nginx Plus|Critical Error Messages|Logs|Nginx Plus/Nginx Plus - Overview|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| where Client\_Ip matches "{{Client\_Ip}}" and Server matches "{{Server}}" and Method matches "{{Method}}" and URL matches "{{URL}}"<br />\| where log\_level in ("emerg", "alert", "crit")<br />\| count|
|Nginx Plus/Logs|Critical Messages|Logs|Nginx Plus/Logs/Nginx Plus - Error Logs Analysis|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| where Log\_Level matches "{{Log\_Level}}" and Client\_Ip matches "{{Client\_Ip}}" and Server matches "{{Server}}" and Method matches "{{Method}}" and URL matches "{{URL}}"<br />\| where log\_level in ("emerg", "alert", "crit")<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss:SSS") as messageDate<br />\| count by messageDate, log\_level, Server, Message<br />\| fields messageDate, log\_level, Server, Message<br />\| sort by messageDate<br />\| limit 20|
|Nginx Plus|Current Connections|Metrics|Nginx Plus/Nginx Plus - Overview|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_connections\_idle source={{Source}} \| sum<br />|
|Nginx Plus/Metrics/Nginx Plus - TCP|Current Connections|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_server\_zones\_connections zone = {{Zone}} source = {{Server}} \| sum by zone, source|
|Nginx Plus/Metrics|Current Requests|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_server\_zones\_processing zone = {{Zone}} source = {{Server}} \| sum by zone, source|
|Nginx Plus|Current Requests|Metrics|Nginx Plus/Nginx Plus - Overview|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_requests\_current source={{Source}} \| sum<br />|
|Nginx Plus/Logs|Desktop OS Version|Logs|Nginx Plus/Logs/Nginx Plus - Visitor Access Types|\_sourceCategory = Labs/Nginx/Logs ("macintosh" OR "mac os" OR "windows" OR "i686" or "PC" or ("Linux" AND !android))<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| parse regex field=user\_agent "(?\<os\>Mac OS) (?\<version\>[^;\\)]+?)(?:;\|\\))" nodrop <br />\| parse regex field=user\_agent "(?\<os\>Windows)(?: NT \| )(?\<version\>[\\d.]+)" nodrop <br />\| parse regex field=user\_agent "(?\<os\>Linux) (?\<version\>\\S+?)(?:\\)\|;)" nodrop <br />\| where os != ""<br />\| count as count by os, version<br />\| transpose row Version column Os|
|Nginx Plus/Metrics|Discarded Traffic per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_location\_zones\_discarded  zone = {{Zone}} source = {{Server}} \| rate|
|Nginx Plus/Metrics|Discarded Traffic per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_server\_zones\_discarded  zone = {{Zone}} source = {{Server}} \| rate|
|Nginx Plus/Metrics|Disk Usage|Metrics|Nginx Plus/Metrics/Nginx Plus - Caches|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_caches\_size source = {{Server}} cache = {{Cache}} \| quantize 60s \| sum|
|Nginx Plus/Metrics|Disk Usage Over Time|Metrics|Nginx Plus/Metrics/Nginx Plus - Caches|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_caches\_size source = {{Server}} cache = {{Cache}} \| sum by cache, source|
|Nginx Plus/Metrics|Disk Usage Percentage|Metrics|Nginx Plus/Metrics/Nginx Plus - Caches|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_caches\_size source = {{Server}} cache = {{Cache}} \| sum by cache, source|
|Nginx Plus|Dropped Connections|Metrics|Nginx Plus/Nginx Plus - Overview|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_connections\_dropped source={{Source}} \| sum|
|Nginx Plus/Logs|Error Responses by Server|Logs|Nginx Plus/Logs/Nginx Plus - Web Server Operations|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| where status\_code matches "4\*" or status\_code matches "5\*"<br />\| timeslice 5m<br />\| count as count by \_timeslice, \_sourceHost<br />\| transpose row \_timeslice column \_sourceHost|
|Nginx Plus/Metrics|Errors|Metrics|Nginx Plus/Metrics/Nginx Plus - Resolvers|\_sourceCategory = Labs/Nginx/Plus/Metrics (metric = nginx\_plus\_api\_resolver\_zones\_formerr or metric = nginx\_plus\_api\_resolver\_zones\_servfail or metric = nginx\_plus\_api\_resolver\_zones\_nxdomain or metric = nginx\_plus\_api\_resolver\_zones\_notimp or metric = nginx\_plus\_api\_resolver\_zones\_refused or metric = nginx\_plus\_api\_resolver\_zones\_timedout or metric = nginx\_plus\_api\_resolver\_zones\_unknown) source = {{Server}} zone = {{Zone}} \| quantize 60s \| sum \| rate|
|Nginx Plus|Failed Handshakes per Second|Metrics|Nginx Plus/Nginx Plus - Overview|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_ssl\_handshakes\_failed source={{Source}} \| rate|
|Nginx Plus/Metrics/Nginx Plus - TCP|Failed Health Checks per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_upstream\_peers\_healthchecks\_fails upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| rate|
|Nginx Plus/Metrics|Failed Health Checks per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_upstream\_peers\_healthchecks\_fails upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| rate|
|Nginx Plus/Metrics/Nginx Plus - TCP|Failed Servers|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_upstream\_peers\_healthchecks\_last\_passed source = {{Server}} upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} \| quantize 60s \| filter latest=0 \| count|
|Nginx Plus/Metrics/Nginx Plus - TCP|Failed Upstream Server Checks per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_upstream\_peers\_fails upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| rate|
|Nginx Plus/Metrics|Failed Upstream Server Checks per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_upstream\_peers\_fails upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| rate|
|Nginx Plus/Metrics/Nginx Plus - TCP|Failed Upstream Servers|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_upstream\_peers\_healthchecks\_last\_passed source = {{Server}} upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} \| sum by source, upstream, upstream\_address|
|Nginx Plus/Metrics|Format Errors per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - Resolvers|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_resolver\_zones\_formerr source = {{Server}} zone = {{Zone}} \| rate|
|Nginx Plus/Logs|Highly Malicious Threat Table|Logs|Nginx Plus/Logs/Nginx Plus - Threat Intel|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| lookup type, actor, raw, threatlevel as Malicious\_Confidence from sumo://threat/cs on threat=Client\_Ip <br />\| where  type="ip\_address" and !isNull(Malicious\_Confidence)<br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| where Malicious\_Confidence matches "high"<br />\| count by Malicious\_Confidence, Actor, Client\_Ip, Status\_Code, URL, Referrer, User\_Agent<br />\| sort by \_count<br />\| limit 20|
|Nginx Plus/Metrics|Host Not Found Errors per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - Resolvers|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_resolver\_zones\_nxdomain source = {{Server}} zone = {{Zone}} \| rate|
|Nginx Plus/Logs|HTTP Methods|Logs|Nginx Plus/Logs/Nginx Plus - Visitor Traffic Insight|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| count by Method|
|Nginx Plus|Idle Connections|Metrics|Nginx Plus/Nginx Plus - Overview|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_connections\_idle source={{Source}} \| sum|
|Nginx Plus/Logs|Log Level - One Day Time Comparison|Logs|Nginx Plus/Logs/Nginx Plus - Error Logs Analysis|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| where Log\_Level matches "{{Log\_Level}}" and Client\_Ip matches "{{Client\_Ip}}" and Server matches "{{Server}}" and Method matches "{{Method}}" and URL matches "{{URL}}"<br />\| count by log\_level<br />\| sort by \_count \| compare with timeshift 1d|
|Nginx Plus/Logs|Media Types Served|Logs|Nginx Plus/Logs/Nginx Plus - Visitor Traffic Insight|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| parse regex field=url "^/[^\\?]+?\\.(?\<type\>[a-zA-Z]{2,4})\$" <br />\| parse regex field=url "/\\S+?(?\<email\_prefix\>(?:%40\|@)[^.]+?)\\.\\w+" nodrop <br />\| where email\_prefix="" <br />\| count as count by type<br />\| sort by count, type asc|
|Nginx Plus/Logs|Messages by Log Level - Over Time|Logs|Nginx Plus/Logs/Nginx Plus - Error Logs Analysis|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| where Log\_Level matches "{{Log\_Level}}" and Client\_Ip matches "{{Client\_Ip}}" and Server matches "{{Server}}" and Method matches "{{Method}}" and URL matches "{{URL}}"<br />\| timeslice 1h<br />\| count by \_timeslice, Log\_Level<br />\| transpose row \_timeslice column Log\_Level|
|Nginx Plus/Searches|Nginx Plus - All Error Messages|Logs|Nginx Plus/Searches/Nginx Plus - All Error Messages|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| count by \_messageTime, log\_level, client\_ip, Server, Message|
|Nginx Plus/Searches|Nginx Plus - All HTTP Response codes with their count|Logs|Nginx Plus/Searches/Nginx Plus - All HTTP Response codes with their count|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| count by status\_code \| sort by \_count|
|Nginx Plus/Searches|Nginx Plus - Client Errors (4xx response codes) per day|Logs|Nginx Plus/Searches/Nginx Plus - Client Errors (4xx response codes) per day|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where status\_code matches "4\*" <br />\| timeslice by 1d \| count by \_timeslice |
|Nginx Plus/Searches|Nginx Plus - HTTP status code summary over time|Logs|Nginx Plus/Searches/Nginx Plus - HTTP status code summary over time|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| if(status\_code matches "2\*", 1, 0) as successes <br />\| if(status\_code matches "3\*", 1, 0) as redirects <br />\| if(status\_code matches "4\*", 1, 0) as client\_errors <br />\| if(status\_code matches "5\*", 1, 0) as server\_errors <br />\| timeslice by 1d \| sum(successes) as successes, sum(redirects) as redirects, sum(client\_errors) as client\_errors, sum(server\_errors) as server\_errors by \_timeslice |
|Nginx Plus/Searches|Nginx Plus - Top 404 referrers|Logs|Nginx Plus/Searches/Nginx Plus - Top 404 referrers|\_sourceCategory = Labs/Nginx/Logs 404<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where status\_code="404" <br />\| count\_frequent referrer <br />\| limit 100 |
|Nginx Plus/Searches|Nginx Plus - Top browsers|Logs|Nginx Plus/Searches/Nginx Plus - Top browsers|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| count\_frequent user\_agent <br />\| limit 100 |
|Nginx Plus/Searches|Nginx Plus - Top clients|Logs|Nginx Plus/Searches/Nginx Plus - Top clients|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| count\_frequent Client\_Ip <br />\| limit 100 |
|Nginx Plus/Searches|Nginx Plus - Top clients causing errors|Logs|Nginx Plus/Searches/Nginx Plus - Top clients causing errors|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where status\_code matches "4\*" <br />\| count\_frequent Client\_Ip <br />\| limit 100 |
|Nginx Plus/Searches|Nginx Plus - Top URLs by bytes served|Logs|Nginx Plus/Searches/Nginx Plus - Top URLs by bytes served|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where size != "-"<br />\| avg(size) as average\_size\_KB by url<br />\| sort by average\_size\_KB<br />\| limit 100<br />\| (average\_size\_KB/1024) as average\_size\_KB<br />\| (toLong(average\_size\_KB\*100)/100) as average\_size\_KB |
|Nginx Plus/Searches|Nginx Plus - Traffic volume and bytes served per day|Logs|Nginx Plus/Searches/Nginx Plus - Traffic volume and bytes served per day|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*" <br />\| where size != "-"<br />\| (size/1048576) as mbytes<br />\| timeslice by 1d <br />\| sum(mbytes) as Bytes\_Served\_mb, count as hits by \_timeslice |
|Nginx Plus/Logs|Non 200 Response Status Codes|Logs|Nginx Plus/Logs/Nginx Plus - Web Server Operations|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| where !(status\_code matches "2\*") <br />\| count as count by status\_code <br />\| sort by count, status\_code asc|
|Nginx Plus/Logs|Number of Hits by Server - One Day Time Comparison|Logs|Nginx Plus/Logs/Nginx Plus - Logs Timeline Analysis|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| count as Number\_of\_Hits by \_sourceHost  <br />\| compare with timeshift 1d|
|Nginx Plus/Logs|Number of Requests by Client - One Day Time Comparison|Logs|Nginx Plus/Logs/Nginx Plus - Error Logs Analysis|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| where Log\_Level matches "{{Log\_Level}}" and Client\_Ip matches "{{Client\_Ip}}" and Server matches "{{Server}}" and Method matches "{{Method}}" and URL matches "{{URL}}"<br />\| where !isEmpty(Client\_Ip)<br />\| count by client\_ip<br />\| sort by \_count<br />\| compare with timeshift 1d|
|Nginx Plus/Logs|Number of Visitors|Logs|Nginx Plus/Logs/Nginx Plus - Outlier Analysis|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}"<br />\| where !isEmpty(Client\_Ip)<br />\| timeslice {{TimeSlice}}<br />\| count by \_timeslice <br />\| sort \_timeslice asc<br />\| outlier \_count window={{Window}},threshold={{Threshold}},consecutive={{Consecutive}},direction=+|
|Nginx Plus/Metrics|Operation Refused Errors per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - Resolvers|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_resolver\_zones\_refused source = {{Server}} zone = {{Zone}} \| rate|
|Nginx Plus/Logs|Popular Mobile Device Versions|Logs|Nginx Plus/Logs/Nginx Plus - Visitor Access Types|\_sourceCategory = Labs/Nginx/Logs (iphone or ipad or android or samsung) <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| parse regex field=nginx\_log\_message "\\((?\<device\>iPhone).+? CPU iPhone OS (?\<version\>.+?) like Mac"  nodrop <br />\| parse regex field=nginx\_log\_message "\\((?\<device\>iPad).+? CPU OS (?\<version\>.+?) like Mac"  nodrop <br />\| parse regex field=nginx\_log\_message " (?\<device\>Android) (?\<version\>[\\d\\.]+)" nodrop <br />\| parse regex field=nginx\_log\_message "(?\<device\>SAMSUNG).+?(?\<version\>(?:GT-\\w+\|SGH-\\w+\|SPH-\\w+\|SCH-\\w+))" <br />\| where device != ""<br />\| count as count by device, version <br />\| transpose row version column device|
|Nginx Plus/Metrics|Received Traffic per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_upstream\_peers\_received upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| rate|
|Nginx Plus/Metrics|Received Traffic per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_location\_zones\_received  zone = {{Zone}} source = {{Server}} \| rate|
|Nginx Plus/Metrics/Nginx Plus - TCP|Received Traffic per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_upstream\_peers\_received upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| rate|
|Nginx Plus/Metrics|Received Traffic per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_server\_zones\_received  zone = {{Zone}} source = {{Server}} \| rate|
|Nginx Plus/Metrics/Nginx Plus - TCP|Received Traffic per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_server\_zones\_received zone = {{Zone}} source = {{Server}} \| rate|
|Nginx Plus/Metrics|Requests|Metrics|Nginx Plus/Metrics/Nginx Plus - Resolvers|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_resolver\_zones\_name source = {{Server}} zone = {{Zone}} \| quantize 60s \| sum|
|Nginx Plus/Metrics|Requests per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_location\_zones\_requests zone = {{Zone}} source = {{Server}} \| rate|
|Nginx Plus/Metrics|Requests per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - Resolvers|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_resolver\_zones\_name source = {{Server}} zone = {{Zone}} \| sum by source, Zone|
|Nginx Plus/Metrics|Requests per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_server\_zones\_requests zone = {{Zone}} source = {{Server}} \| rate|
|Nginx Plus/Metrics|Requests per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_upstream\_peers\_requests upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| rate|
|Nginx Plus/Metrics/Nginx Plus - TCP|Response Time|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_upstream\_peers\_response\_time upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| sum by upstream, upstream\_address, source|
|Nginx Plus|Responses Over Time|Logs|Nginx Plus/Nginx Plus - Overview|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}"<br />\| if(Status\_Code matches "2\*", 1, 0) as Successes <br />\| if(Status\_Code matches "3\*", 1, 0) as Redirects <br />\| if(status\_code matches "4\*", 1, 0) as Client\_Errors <br />\| if(Status\_Code matches "5\*", 1, 0) as Server\_Errors <br />\| timeslice by 5m<br />\| sum(Successes) as Successes, sum(Client\_Errors) as Client\_Errors,  sum(Redirects) as Redirects, sum(Server\_Errors) as Server\_Errors by \_timeslice<br />\| sort by \_timeslice asc|
|Nginx Plus/Logs|Responses Over Time|Logs|Nginx Plus/Logs/Nginx Plus - Logs Timeline Analysis|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| if(Status\_Code matches "2\*", 1, 0) as Successes <br />\| if(Status\_Code matches "3\*", 1, 0) as Redirects <br />\| if(status\_code matches "4\*", 1, 0) as Client\_Errors <br />\| if(Status\_Code matches "5\*", 1, 0) as Server\_Errors <br />\| timeslice by 1h <br />\| sum(Successes) as Successes, sum(Client\_Errors) as Client\_Errors,  sum(Redirects) as Redirects, sum(Server\_Errors) as Server\_Errors by \_timeslice<br />\| sort by \_timeslice asc|
|Nginx Plus/Metrics|Sent Traffic per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_upstream\_peers\_sent upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| rate|
|Nginx Plus/Metrics/Nginx Plus - TCP|Sent Traffic per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_upstream\_peers\_sent upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| rate|
|Nginx Plus/Metrics|Sent Traffic per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_location\_zones\_sent  zone = {{Zone}} source = {{Server}} \| rate|
|Nginx Plus/Metrics/Nginx Plus - TCP|Sent Traffic per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_server\_zones\_sent zone = {{Zone}} source = {{Server}} \| rate|
|Nginx Plus/Metrics|Sent Traffic per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_server\_zones\_sent  zone = {{Zone}} source = {{Server}} \| rate|
|Nginx Plus/Logs|Server Errors|Logs|Nginx Plus/Logs/Nginx Plus - Outlier Analysis|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}"<br />\| if(status\_code matches "5\*", 1, 0) as server\_errors <br />\| timeslice {{TimeSlice}}<br />\| sum(server\_errors) as server\_errors by \_timeslice<br />\| sort \_timeslice asc<br />\| outlier server\_errors window={{Window}},threshold={{Threshold}},consecutive={{Consecutive}},direction=+|
|Nginx Plus/Logs|Server Errors Over Time|Logs|Nginx Plus/Logs/Nginx Plus - Web Server Operations|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| where status\_code matches "5\*"<br />\| timeslice 5m<br />\| count as count by \_timeslice, status\_code<br />\| transpose row \_timeslice column status\_code |
|Nginx Plus/Metrics|Server Failures per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - Resolvers|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_resolver\_zones\_servfail source = {{Server}} zone = {{Zone}} \| rate|
|Nginx Plus|Sessions Reuses per Second|Metrics|Nginx Plus/Nginx Plus - Overview|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_ssl\_session\_reuses source={{Source}} \| rate|
|Nginx Plus/Metrics|Successes|Metrics|Nginx Plus/Metrics/Nginx Plus - Resolvers|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_resolver\_zones\_noerror source = {{Server}} zone = {{Zone}} \| quantize 60s \| sum \| rate|
|Nginx Plus/Metrics|Successes per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - Resolvers|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_resolver\_zones\_noerror source = {{Server}} zone = {{Zone}} \| sum by source, zone \| rate|
|Nginx Plus/Logs|Threat Breakdown by Sources|Logs|Nginx Plus/Logs/Nginx Plus - Threat Intel|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| count as ip\_count by Client\_Ip, \_source<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=Client\_Ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (ip\_count) as threat\_count by \_source |
|Nginx Plus/Logs|Threat by Actors|Logs|Nginx Plus/Logs/Nginx Plus - Threat Intel|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| count as ip\_count by Client\_Ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=Client\_Ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (ip\_count) as threat\_count by Actor|
|Nginx Plus/Logs|Threat by Malicious Confidence|Logs|Nginx Plus/Logs/Nginx Plus - Threat Intel|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| count as ip\_count by Client\_Ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=Client\_Ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (ip\_count) as threat\_count by malicious\_confidence|
|Nginx Plus/Logs|Threat Count|Logs|Nginx Plus/Logs/Nginx Plus - Threat Intel|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| count as ip\_count by Client\_Ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=Client\_Ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (ip\_count) as threat\_count|
|Nginx Plus/Logs|Threat Locations|Logs|Nginx Plus/Logs/Nginx Plus - Threat Intel|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| count as ip\_count by Client\_Ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=Client\_Ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where type="ip\_address" and !isNull(malicious\_confidence)<br />\| count by Client\_Ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Nginx Plus/Logs|Threat Table|Logs|Nginx Plus/Logs/Nginx Plus - Threat Intel|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=Client\_Ip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| count by malicious\_confidence, Actor, Client\_Ip, method, status\_code, URL, size, referrer, user\_agent<br />\| sort by \_count<br />\| limit 50|
|Nginx Plus/Metrics|Timed Out Requests per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - Resolvers|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_resolver\_zones\_timedout source = {{Server}} zone = {{Zone}} \| rate|
|Nginx Plus/Logs|Top 10 Bots Observed|Logs|Nginx Plus/Logs/Nginx Plus - Web Server Operations|\_sourceCategory = Labs/Nginx/Logs ("Googlebot" OR "AskJeeves" OR "Digger" OR "Lycos"<br />OR "msnbot" OR "Inktomi Slurp" OR "Yahoo" OR "Nutch" OR "bingbot" OR<br />"BingPreview" OR "Mediapartners-Google" OR "proximic" OR "AhrefsBot" OR<br />"AdsBot-Google" OR "Ezooms" OR "AddThis.com" OR "facebookexternalhit" OR<br />"MetaURI" OR "Feedfetcher-Google" OR "PaperLiBot" OR "TweetmemeBot" OR<br />"Sogou web spider" OR "GoogleProducer" OR "RockmeltEmbedder" OR<br />"ShareThisFetcher" OR "YandexBot" OR "rogerbot-crawler" OR "ShowyouBot" OR "Baiduspider" OR "Sosospider" OR "Exabot")<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| parse regex field=user\_agent "(?\<bot\_name\>facebook)externalhit?\\W+" nodrop<br />\| parse regex field=user\_agent "Feedfetcher-(?\<bot\_name\>Google?)\\S+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>PaperLiBot?)/.+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>TweetmemeBot?)/.+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>msn?)bot\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Nutch?)-.+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Google?)bot\\W" nodrop<br />\| parse regex field=user\_agent "Feedfetcher-(?\<bot\_name\>Google?)\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Yahoo?)!\\s+Slurp[;/].+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>bing?)bot\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Bing?)Preview\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Sogou?)\\s+web\\s" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Yandex?)Bot\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>rogerbot?)\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>AddThis\\.com?)\\s+robot\\s+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>ShareThis?)Fetcher/.+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Ahrefs?)Bot/.+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>MetaURI?)\\s+API/.+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Showyou?)Bot\\s+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Google?)Producer;" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Ezooms?)\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Rockmelt?)Embedder\\s+" nodrop <br />\| parse regex field=user\_agent "(?\<bot\_name\>Sosospider?)\\W" nodrop <br />\| parse regex field=user\_agent "(?\<bot\_name\>Baidu?)spider" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Exabot?)\\W"<br />\| where bot\_name != ""<br />\| if (bot\_name="bing","Bing",bot\_name) as bot\_name<br />\| count as count by bot\_name<br />\| sort by count<br />\| limit 10|
|Nginx Plus/Logs|Top 10 Search Terms from Popular Search Engines|Logs|Nginx Plus/Logs/Nginx Plus - Visitor Traffic Insight|\_sourceCategory = Labs/Nginx/Logs (google OR bing OR aol OR ask OR yahoo) ("p=" OR "q=" OR "wd=" OR "searchfor=")<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| parse regex field=referrer "(?:\\?\|&)(?:p\|q\|wd\|searchfor)=(?\<search\_term\>[^=]+?)(?:&\|\$)" nodrop <br />\| where search\_term != ""<br />\| urldecode(search\_term)<br />\| if(referrer matches "\*google.\*", "Google", "") as engine<br />\| if(referrer matches "\*bing.\*", "Bing", engine) as engine<br />\| if(referrer matches "\*ask.com\*", "Ask.com", engine) as engine<br />\| if(referrer matches "\*aol.\*", "AOL", engine) as engine<br />\| if(referrer matches "\*yahoo.\*", "Yahoo", engine) as engine<br />\| where engine !="" <br />\| count as count by search\_term<br />\| sort count<br />\| limit 10|
|Nginx Plus/Logs|Top 5 Clients Causing 4xx Errors|Logs|Nginx Plus/Logs/Nginx Plus - Web Server Operations|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| where status\_code matches "4\*"<br />\| count as count by Client\_Ip<br />\| sort count <br />\| limit 5 |
|Nginx Plus/Logs|Top 5 Clients causing Errors|Logs|Nginx Plus/Logs/Nginx Plus - Error Logs Analysis|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| where Log\_Level matches "{{Log\_Level}}" and Client\_Ip matches "{{Client\_Ip}}" and Server matches "{{Server}}" and Method matches "{{Method}}" and URL matches "{{URL}}"<br />\| where !isEmpty(client\_ip)<br />\| count by client\_ip<br />\| sort by \_count<br />\| limit 5|
|Nginx Plus|Top 5 Critical Messages|Logs|Nginx Plus/Nginx Plus - Overview|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| where Client\_Ip matches "{{Client\_Ip}}" and Server matches "{{Server}}" and Method matches "{{Method}}" and URL matches "{{URL}}"<br />\| where log\_level in ("emerg", "alert", "crit")<br />\| count as Count by Message, Server<br />\| sort by Count<br />\| limit 5|
|Nginx Plus/Logs|Top 5 Highly Malicious URLs|Logs|Nginx Plus/Logs/Nginx Plus - Threat Intel|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| count as ip\_count by Client\_Ip, URL<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=Client\_Ip <br />\| where malicious\_confidence matches "high"<br />\| count by URL<br />\| limit 5|
|Nginx Plus/Logs|Top 5 Referrers|Logs|Nginx Plus/Logs/Nginx Plus - Visitor Traffic Insight|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| where referrer != "-"<br />\| count as count by referrer<br />\| sort by count<br />\| limit 5 |
|Nginx Plus/Logs|Top 5 Servers with Errors|Logs|Nginx Plus/Logs/Nginx Plus - Error Logs Analysis|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| where Log\_Level matches "{{Log\_Level}}" and Client\_Ip matches "{{Client\_Ip}}" and Server matches "{{Server}}" and Method matches "{{Method}}" and URL matches "{{URL}}"<br />\| where !isEmpty(server)<br />\| count by server<br />\| sort by \_count<br />\| limit 5|
|Nginx Plus/Logs|Top 5 URIs causing 404 Responses|Logs|Nginx Plus/Logs/Nginx Plus - Web Server Operations|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| where status\_code = "404"<br />\| count as count by url<br />\| sort count, url asc<br />\| limit 5|
|Nginx Plus/Logs|Top 5 URLs|Logs|Nginx Plus/Logs/Nginx Plus - Visitor Traffic Insight|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| count as count by url<br />\| sort by count<br />\| limit 5|
|Nginx Plus/Logs|Top 5 URLs with Errors|Logs|Nginx Plus/Logs/Nginx Plus - Error Logs Analysis|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| where Log\_Level matches "{{Log\_Level}}" and Client\_Ip matches "{{Client\_Ip}}" and Server matches "{{Server}}" and Method matches "{{Method}}" and URL matches "{{URL}}"<br />\| count by URL<br />\| sort by \_count<br />\| limit 5|
|Nginx Plus/Metrics|Total Caches|Metrics|Nginx Plus/Metrics/Nginx Plus - Caches|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_caches\_cold source = {{Server}} cache = {{Cache}} \| quantize 60s \| count by cache \| count|
|Nginx Plus/Metrics/Nginx Plus - TCP|Total Connections|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_server\_zones\_connections zone = {{Zone}} source = {{Server}} \| quantize 60s \| sum \| rate|
|Nginx Plus/Metrics|Total Requests|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_server\_zones\_requests zone = {{Zone}} source = {{Server}} \| quantize 60s \| sum \| rate|
|Nginx Plus/Metrics|Total Requests|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_location\_zones\_requests zone = {{Zone}} source = {{Server}} \| sum by zone, source|
|Nginx Plus/Metrics|Total Requests|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_location\_zones\_requests zone = {{Zone}} source = {{Server}} \| quantize 60s \| sum \| rate|
|Nginx Plus|Total Requests per Second|Metrics|Nginx Plus/Nginx Plus - Overview|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_requests\_total source={{Source}} \| rate|
|Nginx Plus/Metrics/Nginx Plus - TCP|Total Zones|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_server\_zones\_connections zone = {{Zone}} source = {{Server}} \| quantize 60s \| count by zone \| count|
|Nginx Plus/Metrics|Total Zones|Metrics|Nginx Plus/Metrics/Nginx Plus - Resolvers|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_resolver\_zones\_name source = {{Server}} zone = {{Zone}} \| quantize 60s \| count by zone \| count|
|Nginx Plus/Logs|Traffic Distribution by Server|Logs|Nginx Plus/Logs/Nginx Plus - Logs Timeline Analysis|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| timeslice 1h<br />\| count by \_timeslice, \_sourceHost  <br />\| transpose row \_timeslice column \_sourceHost|
|Nginx Plus/Metrics|Traffic Received|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_location\_zones\_received  zone = {{Zone}} source = {{Server}} \| quantize 60s \| sum|
|Nginx Plus/Metrics/Nginx Plus - TCP|Traffic Received|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_server\_zones\_received zone = {{Zone}} source = {{Server}} \| quantize 60s \| sum|
|Nginx Plus/Metrics|Traffic Received|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_server\_zones\_received  zone = {{Zone}} source = {{Server}} \| quantize 60s \| sum|
|Nginx Plus/Metrics/Nginx Plus - TCP|Traffic Sent|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_server\_zones\_sent zone = {{Zone}} source = {{Server}} \| quantize 60s \| sum|
|Nginx Plus/Metrics|Traffic Sent|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Server Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_server\_zones\_sent  zone = {{Zone}} source = {{Server}} \| quantize 60s \| sum|
|Nginx Plus/Metrics|Traffic Sent|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Location Zones|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_location\_zones\_sent  zone = {{Zone}} source = {{Server}} \| quantize 60s \| sum|
|Nginx Plus/Logs|Traffic Volume and Bytes Served|Logs|Nginx Plus/Logs/Nginx Plus - Logs Timeline Analysis|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| where size != "-"<br />\| timeslice 1h<br />\| (size/(1048576\*1000)) as gbytes <br />\| count as hits, sum(gbytes) as gbytes by \_timeslice <br />\| sort \_timeslice asc|
|Nginx Plus/Metrics/Nginx Plus - TCP|Unavailable Upstream Server Checks per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_upstream\_peers\_unavail upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| rate|
|Nginx Plus/Metrics|Unavailable Upstream Server Checks per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_upstream\_peers\_unavail upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| rate|
|Nginx Plus/Metrics/Nginx Plus - TCP|Unhealthy Upstream Server Checks per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_upstream\_peers\_healthchecks\_unhealthy upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| rate|
|Nginx Plus/Metrics|Unhealthy Upstream Server Checks per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_upstream\_peers\_healthchecks\_unhealthy upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| rate|
|Nginx Plus/Metrics|Unimplemented Errors per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - Resolvers|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_resolver\_zones\_notimp source = {{Server}} zone = {{Zone}} \| rate|
|Nginx Plus/Logs|Unique Visitors|Logs|Nginx Plus/Logs/Nginx Plus - Visitor Access Types|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| Count by Client\_Ip<br />\| Count|
|Nginx Plus/Logs|United States|Logs|Nginx Plus/Logs/Nginx Plus - Visitor Locations|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| count by Client\_Ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| where country\_name="United States" AND !isNull(region) AND region !=""<br />\| sort \_count|
|Nginx Plus/Metrics|Unknown Errors per Second|Metrics|Nginx Plus/Metrics/Nginx Plus - Resolvers|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_resolver\_zones\_timedout source = {{Server}} zone = {{Zone}} \| rate|
|Nginx Plus/Metrics|Upstream Response Time|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_upstream\_peers\_response\_time upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| sum by upstream, upstream\_address, source|
|Nginx Plus/Metrics|Upstream Server Downtime|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_upstream\_peers\_downtime upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| sum by upstream, upstream\_address, source|
|Nginx Plus/Metrics/Nginx Plus - TCP|Upstream Servers Downtime (minutes)|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_upstream\_peers\_downtime source = {{Server}} upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} \| eval \_value/1000/60 \| sum by source, upstream, upstream\_address|
|Nginx Plus/Metrics|Upstreams|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_upstream\_peers\* upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source={{Server}} \| quantize 60s \| count by upstream \| count|
|Nginx Plus/Metrics/Nginx Plus - TCP|Upstreams|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_upstreams\* upstream = {{Upstream}} source = {{Server}} \| quantize 60s \| count by upstream \| count|
|Nginx Plus/Metrics/Nginx Plus - TCP|Upstreams Servers|Metrics|Nginx Plus/Metrics/Nginx Plus - TCP/UDP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_stream\_upstream\_peers\* upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| quantize 60s \| count by upstream\_address \| count|
|Nginx Plus/Metrics|Upstreams Servers|Metrics|Nginx Plus/Metrics/Nginx Plus - HTTP Upstreams|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_upstream\_peers\* upstream = {{Upstream}} upstream\_address = {{Upstream\_Server}} source = {{Server}} \| quantize 60s \| count by upstream\_address \| count|
|Nginx Plus|Visitor Locations|Logs|Nginx Plus/Nginx Plus - Overview|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}"<br />\| count by Client\_Ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Nginx Plus/Logs|Visitor Locations - One Day Time Comparison|Logs|Nginx Plus/Logs/Nginx Plus - Logs Timeline Analysis|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip<br />\| where !isEmpty(country\_name)<br />\| count as Visitors\_Locations by country\_name<br />\| sort Visitors\_Locations <br />\| compare with timeshift 1d<br />\| limit 10|
|Nginx Plus/Logs|Visitor Platforms|Logs|Nginx Plus/Logs/Nginx Plus - Visitor Access Types|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| if (user\_agent matches "\*iPad\*" OR user\_agent matches "\*iPhone\*" OR user\_agent matches "\*Android\*" OR user\_agent matches "\*BlackBerry\*" OR user\_agent matches "\*Galaxy\*" OR user\_agent matches "LGE-\*" OR user\_agent matches "SCH-\*" OR user\_agent matches "\*HUAWEI-\*" OR user\_agent matches "\*SAMSUNG\*" OR user\_agent matches "\*samsung\*" OR user\_agent matches "Dalvik/\*" OR user\_agent matches "Nokia\*" OR user\_agent matches "LG-\*" OR user\_agent matches "\*CFNetwork\*"  OR user\_agent matches "\*UP.Browser/\*" OR user\_agent matches "\*QQ\*rowser\*" OR user\_agent matches "\*NetFront/\*" OR user\_agent matches "\*Windows Phone\*" OR user\_agent matches "\*Mobile Safari\*" OR user\_agent matches "\*iemobile\*","Mobile","") as type<br />\| if (user\_agent matches "\*Windows\*" OR user\_agent matches "\*Win64\*" OR user\_agent matches "\*Win32\*" OR user\_agent matches "\*i686\*" OR user\_agent matches "\*x86\*","PC",type) as type<br />\| if (user\_agent matches "\*Macintosh\*" OR user\_agent matches "\*Mac OS\*","Mac",type) as type<br />\| if (type = "","bots/unknown",type) as type<br />\| count type<br />\| sort by \_count|
|Nginx Plus/Logs|Visitors Platforms Over Time|Logs|Nginx Plus/Logs/Nginx Plus - Visitor Access Types|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| if (user\_agent matches "\*iPad\*" OR user\_agent matches "\*iPhone\*" OR user\_agent matches "\*Android\*" OR user\_agent matches "\*BlackBerry\*" OR user\_agent matches "\*Galaxy\*" OR user\_agent matches "LGE-\*" OR user\_agent matches "SCH-\*" OR user\_agent matches "\*HUAWEI-\*" OR user\_agent matches "\*SAMSUNG\*" OR user\_agent matches "\*samsung\*" OR user\_agent matches "Dalvik/\*" OR user\_agent matches "Nokia\*" OR user\_agent matches "LG-\*" OR user\_agent matches "\*CFNetwork\*"  OR user\_agent matches "\*UP.Browser/\*" OR user\_agent matches "\*QQ\*rowser\*" OR user\_agent matches "\*NetFront/\*" OR user\_agent matches "\*Windows Phone\*" OR user\_agent matches "\*Mobile Safari\*" OR user\_agent matches "\*iemobile\*","Mobile","") as type<br />\| if (user\_agent matches "\*Windows\*" OR user\_agent matches "\*Win64\*" OR user\_agent matches "\*Win32\*" OR user\_agent matches "\*i686\*" OR user\_agent matches "\*x86\*","PC",type) as type<br />\| if (user\_agent matches "\*Macintosh\*" OR user\_agent matches "\*Mac OS\*","Mac",type) as type<br />\| if (type = "","bots/unknown",type) as type<br />\| timeslice 5m<br />\| count by \_timeslice, type<br />\| transpose row \_timeslice column type|
|Nginx Plus/Logs|Visits by Country Over Time|Logs|Nginx Plus/Logs/Nginx Plus - Visitor Locations|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| timeslice 5m<br />\| count by \_timeslice, Client\_Ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip<br />\| where !isNull(country\_name) AND country\_name != ""<br />\| count by \_timeslice, country\_name<br />\| transpose row \_timeslice column country\_name as \* |
|Nginx Plus/Logs|Visits by US Regions Over Time|Logs|Nginx Plus/Logs/Nginx Plus - Visitor Locations|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| timeslice 5m<br />\| count by \_timeslice, Client\_Ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip<br />\| where country\_name="United States" AND !isNull(region) AND region !=""<br />\| count by \_timeslice, region<br />\| transpose row \_timeslice column region as \* |
|Nginx Plus/Metrics|Warm Caches|Metrics|Nginx Plus/Metrics/Nginx Plus - Caches|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_caches\_cold source = {{Server}} cache = {{Cache}} \| quantize 60s \| filter latest=0 \| count|
|Nginx Plus/Metrics|Warnings|Metrics|Nginx Plus/Metrics/Nginx Plus - Caches|\_sourceCategory = Labs/Nginx/Plus/Metrics metric = nginx\_plus\_api\_http\_caches\_updating\_bytes source = {{Server}} cache = {{Cache}} \| quantize 60s \| count|
|Nginx Plus/Logs|WorldWide|Logs|Nginx Plus/Logs/Nginx Plus - Visitor Locations|\_sourceCategory = Labs/Nginx/Logs <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where \_sourceHost matches "{{Server}}" and Client\_Ip matches "{{Client\_Ip}}" and Method matches "{{Method}}" and URL matches "{{URL}}" and Status\_Code matches "{{Status\_Code}}" and Referrer matches "{{Referrer}}"<br />\| count by Client\_Ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|

