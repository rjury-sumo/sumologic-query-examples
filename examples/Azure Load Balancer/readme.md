# Azure Load Balancer

## Searches

### Log Searches

- **Distribution  by Operation Type (Read, Write and Delete)**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Administrative Operations 
- **Distribution by Operations**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Administrative Operations 
- **Failed Policy Events**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Policy 
- **Failures by Operation**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Health 
- **Recent Delete Operations**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Administrative Operations 
- **Recent Write Operations**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Administrative Operations 
- **Top 10 operations that caused the most errors**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Administrative Operations 
- **Total Failed Policy Events**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Policy 
- **Total Failed Requests**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Health 
- **Total Success Policy Events**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Policy 
- **Total Success Policy Events**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Policy 
- **UnHealthy Backends**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Health 
- **Users / Applications by Operation type**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Administrative Operations

### Metric Searches

- ****: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Overview 
- **Allocated SnatPorts**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Network 
- **Average Data Path Availability**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Overview 
- **Average Data Path Availability Trend**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Network 
- **Bytes Transmitted by Load Balancer**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Network 
- **Connection Details**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Overview 
- **Health Probe Status**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Overview 
- **Health Probe Status Trend**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Health 
- **Packets Transmitted by Load Balancer**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Network 
- **SNAT Connection Count**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Network 
- **SNAT Ports Utilization**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Network 
- **SNAT Ports Utilization(%)**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Overview 
- **TCP SYN packets by Load Balancer**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Network 
- **Transmission Details**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Overview 
- **Used SnatPorts**: from Dashboard: Installed Apps/Azure Load Balancer/Azure Load Balancer - Network

## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Azure Load Balancer||Metrics|Installed Apps/Azure Load Balancer/Azure Load Balancer - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=PacketCount statistic=average  \| avg by resource\_group, location, resource\_name|
|Azure Load Balancer|Allocated SnatPorts|Metrics|Installed Apps/Azure Load Balancer/Azure Load Balancer - Network|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}}  metric=AllocatedSnatPorts statistic=total  \| quantize using avg \| avg by resource\_name|
|Azure Load Balancer|Average Data Path Availability|Metrics|Installed Apps/Azure Load Balancer/Azure Load Balancer - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=VipAvailability statistic=average \| quantize using avg \| avg by resource\_group, location, resource\_name |
|Azure Load Balancer|Average Data Path Availability Trend|Metrics|Installed Apps/Azure Load Balancer/Azure Load Balancer - Network|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=VipAvailability statistic=average \| quantize using avg \| avg by resource\_group, resource\_name|
|Azure Load Balancer|Bytes Transmitted by Load Balancer|Metrics|Installed Apps/Azure Load Balancer/Azure Load Balancer - Network|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=ByteCount  statistic=total \| quantize using sum \| sum by resource\_name|
|Azure Load Balancer|Connection Details|Metrics|Installed Apps/Azure Load Balancer/Azure Load Balancer - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=SYNCount statistic=total \| quantize using sum \| max by resource\_group, location, resource\_name|
|Azure Load Balancer|Distribution  by Operation Type (Read, Write and Delete)|Logs|Installed Apps/Azure Load Balancer/Azure Load Balancer - Administrative Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name={{resource\_name}} <br /> provider\_name={{provider\_name}} resource\_type={{resource\_type}} Administrative <br />\| json "resultType", "category", "operationName", "resourceId" as resultType, category, operationName, resourceid<br />\| where (resultType="Accept" or resultType="Success") and category="Administrative"<br />\| "OTHERS" as operationType<br />\| if (toUppercase(operationName) matches /WRITE/, "WRITE", operationType) as operationType <br />\| if (toUppercase(operationName) matches /READ/, "READ", operationType) as operationType <br />\| if (toUppercase(operationName) matches /DELETE/, "DELETE", operationType) as operationType <br />\| count by operationType<br />\| sort by \_count, operationType asc|
|Azure Load Balancer|Distribution by Operations|Logs|Installed Apps/Azure Load Balancer/Azure Load Balancer - Administrative Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name={{resource\_name}}<br />provider\_name={{provider\_name}} resource\_type={{resource\_type}} Administrative <br />\| json "resultType", "category", "operationName", "resourceId" as resultType, category, operationName, resourceid<br />\| where (resultType="Accept" or resultType="Success") and category="Administrative" <br />\| count by operationName<br />\| order by \_count, operationName asc|
|Azure Load Balancer|Failed Policy Events|Logs|Installed Apps/Azure Load Balancer/Azure Load Balancer - Policy|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} Policy Failure<br />\| JSON "category", "resultType", "properties.message", "properties.resourceLocation", "properties.entity", "properties.policies" as category, resultType, message, resourceLocation, entity, policies<br />\| where category="Policy" and resultType="Failure"<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as time<br />\| count as Count by time, level, resultType, providers, resource\_group, resource\_name, location, policies|
|Azure Load Balancer|Failures by Operation|Logs|Installed Apps/Azure Load Balancer/Azure Load Balancer - Health|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} LoadBalancerHealthEvent HealthEventType NoHealthyBackends<br />\| JSON "category", "operationName", "properties.HealthEventType" as category, operationName, HealthEventType<br />\| parse field=operationName "\*/\*/\*/\*" as provider\_name, resource\_type, event\_type, operation\_name<br />\| where category="LoadBalancerHealthEvent" and HealthEventType="NoHealthyBackends"<br />\| count by operation\_name<br />\| sort by \_count, operation\_name asc|
|Azure Load Balancer|Health Probe Status|Metrics|Installed Apps/Azure Load Balancer/Azure Load Balancer - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=DipAvailability statistic=average \| quantize using avg \| avg by resource\_group, location, resource\_name|
|Azure Load Balancer|Health Probe Status Trend|Metrics|Installed Apps/Azure Load Balancer/Azure Load Balancer - Health|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=DipAvailability statistic=average \| quantize using avg \| avg by resource\_group, resource\_name|
|Azure Load Balancer|Packets Transmitted by Load Balancer|Metrics|Installed Apps/Azure Load Balancer/Azure Load Balancer - Network|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=PacketCount statistic=total \| quantize using sum \| sum by resource\_group, resource\_name|
|Azure Load Balancer|Recent Delete Operations|Logs|Installed Apps/Azure Load Balancer/Azure Load Balancer - Administrative Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name = {{resource\_name}}<br />provider\_name={{provider\_name}} resource\_type={{resource\_type}}  Administrative <br />\| JSON "properties.statusCode", "properties.message", "resultType", "category", "operationName", "callerIpAddress", "resultSignature", "level", "identity.claims.idtyp", "identity.claims.name", "identity.claims.appid", "properties.entity", "\$['identity']['claims']['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name']","\$['identity']['claims']['http://schemas.microsoft.com/claims/authnmethodsreferences']" as statusCode, message, resultType, category, operationName, callerIpAddress, resultSignature, level, idtyp, name, appid, entity, identity\_claims\_name, authmethods nodrop<br />\| where resultType in ("Accept", "Success") and category="Administrative" and toUppercase(operationName) matches /DELETE/ <br />\| if (idtyp =="user", name, appid) as name<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as time<br />\| count by \_messageTime, time, resource\_name, callerIpAddress, name, identity\_claims\_name, authmethods, resultSignature, statusCode, message, entity<br />\| sort by \_messageTime desc<br />\| limit 20 <br />\| fields -\_count,\_messageTime|
|Azure Load Balancer|Recent Write Operations|Logs|Installed Apps/Azure Load Balancer/Azure Load Balancer - Administrative Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name = {{resource\_name}}<br />provider\_name={{provider\_name}} resource\_type={{resource\_type}}  Administrative <br />\| JSON "properties.statusCode", "properties.message", "resultType", "category", "operationName", "callerIpAddress", "resultSignature", "level", "identity.claims.idtyp", "identity.claims.name", "identity.claims.appid", "\$['identity']['claims']['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name']","\$['identity']['claims']['http://schemas.microsoft.com/claims/authnmethodsreferences']"  as statusCode, message, resultType, category, operationName, callerIpAddress, resultSignature, level, idtyp, name, appid, identity\_claims\_name, authmethods nodrop<br />\| where category="Administrative" and resultType in ("Accept", "Success") and toUppercase(operationName) matches /WRITE/<br />\| if (idtyp =="user", name, appid) as name<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as time<br />\| count by \_messageTime, time, resource\_name, callerIpAddress, name, identity\_claims\_name, authmethods, resultSignature, statusCode, message<br />\| sort by \_messageTime desc<br />\| limit 20 <br />\| fields -\_count,\_messageTime|
|Azure Load Balancer|SNAT Connection Count|Metrics|Installed Apps/Azure Load Balancer/Azure Load Balancer - Network|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=SnatConnectionCount  statistic=total \| quantize using sum \| sum by resource\_group, resource\_name |
|Azure Load Balancer|SNAT Ports Utilization|Metrics|Installed Apps/Azure Load Balancer/Azure Load Balancer - Network|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}}  metric=AllocatedSnatPorts statistic=total  \| quantize using avg \| avg by resource\_name|
|Azure Load Balancer|SNAT Ports Utilization(%)|Metrics|Installed Apps/Azure Load Balancer/Azure Load Balancer - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}}  metric=AllocatedSnatPorts statistic=total  \| quantize using avg \| avg by resource\_name|
|Azure Load Balancer|TCP SYN packets by Load Balancer|Metrics|Installed Apps/Azure Load Balancer/Azure Load Balancer - Network|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=SYNCount statistic=total \| quantize using sum \| sum by resource\_group, resource\_name|
|Azure Load Balancer|Top 10 operations that caused the most errors|Logs|Installed Apps/Azure Load Balancer/Azure Load Balancer - Administrative Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name = {{resource\_name}}   provider\_name={{provider\_name}} resource\_type={{resource\_type}}  Administrative Failure<br />\| json "resultType", "operationName", "properties.statusMessage", "category"  as resultType, operationName, failureMessage, category nodrop<br />\| parse field=operationname "\*/\*/\*" as provider\_name, resource\_type, operation nodrop<br />\| where category="Administrative" and resultType="Failure"<br />\| count as Count by resource\_name, operation, failureMessage<br />\| order by Count <br />\| limit 10|
|Azure Load Balancer|Total Failed Policy Events|Logs|Installed Apps/Azure Load Balancer/Azure Load Balancer - Policy|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} Policy Failure<br />\| JSON "category", "resultType" as category, resultType<br />\| where category="Policy" and resultType="Failure"<br />\| count as Count|
|Azure Load Balancer|Total Failed Requests|Logs|Installed Apps/Azure Load Balancer/Azure Load Balancer - Health|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} LoadBalancerHealthEvent HealthEventType NoHealthyBackends<br />\| JSON "category", "operationName", "properties.HealthEventType" as category, operationName, HealthEventType<br />\| where category="LoadBalancerHealthEvent" and HealthEventType="NoHealthyBackends"<br />\| timeslice 5m<br />\| count as Count by resource\_name, \_timeslice<br />\| transpose row \_timeslice column resource\_name|
|Azure Load Balancer|Total Success Policy Events|Logs|Installed Apps/Azure Load Balancer/Azure Load Balancer - Policy|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} Policy Success<br />\| JSON "category", "resultType", "properties.message", "properties.resourceLocation", "properties.entity", "properties.policies" as category, resultType, message, resourceLocation, entity, policies<br />\| parse field=entity "/subscriptions/\*/resourceGroups/\*/providers/\*/\*/\*" as subscription\_id, resource\_group, providers, virtualMachineScaleSets, aks nodrop<br />\| where category="Policy" and (resultType="Success" or resultType="Accept")<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as time<br />\| count as Count by time, level, resultType, resource\_group, resource\_name, location, policies|
|Azure Load Balancer|Total Success Policy Events|Logs|Installed Apps/Azure Load Balancer/Azure Load Balancer - Policy|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} location={{location}} resource\_group={{resource\_group}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} Policy <br />\| JSON "category", "resultType" as category, resultType<br />\| where category="Policy" and (resultType="Success" or resultType="Accept")<br />\| count as Count|
|Azure Load Balancer|Transmission Details|Metrics|Installed Apps/Azure Load Balancer/Azure Load Balancer - Overview|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=PacketCount statistic=total \| sum by resource\_group, location, resource\_name|
|Azure Load Balancer|UnHealthy Backends|Logs|Installed Apps/Azure Load Balancer/Azure Load Balancer - Health|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} LoadBalancerHealthEvent HealthEventType NoHealthyBackends<br />\| JSON "category", "operationName", "properties.HealthEventType", "properties.Severity", "properties.Description", "properties.Frontend Ip" as category, operationName, HealthEventType, Severity, Description, FrontendIp<br />\| parse field=operationName "\*/\*/\*/\*" as provider\_name, resource\_type, event\_type, operation\_name<br />\| where category="LoadBalancerHealthEvent" and HealthEventType="NoHealthyBackends"<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss") as time<br />\| count by time, resource\_name, operation\_name, FrontendIp, Severity, Description<br />\| fields -\_count<br />\| order by resource\_name, time|
|Azure Load Balancer|Used SnatPorts|Metrics|Installed Apps/Azure Load Balancer/Azure Load Balancer - Network|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group={{resource\_group}} location={{location}} resource\_type={{resource\_type}} provider\_name={{provider\_name}} resource\_name={{resource\_name}} metric=UsedSnatPorts statistic=total  \| quantize using avg \| avg by resource\_group, resource\_name|
|Azure Load Balancer|Users / Applications by Operation type|Logs|Installed Apps/Azure Load Balancer/Azure Load Balancer - Administrative Operations|tenant\_name={{tenant\_name}} subscription\_id={{subscription\_id}} resource\_group = {{resource\_group}} resource\_name={{resource\_name}}<br />provider\_name={{provider\_name}} resource\_type={{resource\_type}} Administrative <br />\| JSON "properties.statusCode", "properties.message", "resultType", "category", "operationName", "callerIpAddress", "resultSignature", "level", "identity.claims.idtyp", "identity.claims.name", "identity.claims.appid" as statusCode, message, resultType, category, operationName, callerIpAddress, resultSignature, level, idtyp, name, appid nodrop<br />\| where resultType in ("Accept", "Success") and category="Administrative" <br />\| if (idtyp =="user", name, appid) as name<br />\| "Others" as operationType<br />\| if (toUppercase(operationName) matches /WRITE/, "WRITE", operationType) as operationType <br />\| if (toUppercase(operationName) matches /READ/, "READ", operationType) as operationType <br />\| if (toUppercase(operationName) matches /DELETE/, "DELETE", operationType) as operationType <br />\| count by name, operationType<br />\| transpose row name column operationType|

