# Kubernetes - Control Plane

## Searches

### Log Searches

- **Alerts by Priority**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **Anonymous Request Allowed**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **Attach to cluster-admin Role**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **Attach/Exec Pod**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **Average Time Spent in Scheduled Compaction**: from Dashboard: Kubernetes - Control Plane/16 Kubernetes - etcd 
- **ClusterRole With Pod Exec Created**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **ClusterRole With Wildcard Created**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **ClusterRole With Write Privileges Created**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **Create Disallowed Pod**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **Create HostNetwork Pod**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **Create NodePort Service**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **Create Privileged Pod**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **Create Sensitive Mount Pod**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **Create/Modify Configmap With Private Credentials**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **Error Logs**: from Dashboard: Kubernetes - Control Plane/15 Kubernetes - Controller Manager 
- **Error Logs**: from Dashboard: Kubernetes - Control Plane/21 Kubernetes CP - API Server 
- **Error Messages**: from Dashboard: Kubernetes - Control Plane/18 Kubernetes - Kube System 
- **Error Messages Count**: from Dashboard: Kubernetes - Control Plane/15 Kubernetes - Controller Manager 
- **Error Stream**: from Dashboard: Kubernetes - Control Plane/18 Kubernetes - Kube System 
- **Events by User**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **Job Creations**: from Dashboard: Kubernetes - Control Plane/15 Kubernetes - Controller Manager 
- **Job Deletions**: from Dashboard: Kubernetes - Control Plane/15 Kubernetes - Controller Manager 
- **K8s ConfigMap Created**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **K8s Deployment Created**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **K8s Deployment Deleted**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **K8s Namespace Created**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **K8s Namespace Deleted**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **K8s Role/Clusterrole Created**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **K8s Role/Clusterrole Deleted**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **K8s Role/Clusterrolebinding Created**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **K8s Role/Clusterrolebinding Deleted**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **K8s Service Created**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **K8s Service Deleted**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **K8s Serviceaccount Created**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **K8s Serviceaccount Deleted**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **Kubernetes Rules Triggerred**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **Message Breakdown by Container**: from Dashboard: Kubernetes - Control Plane/18 Kubernetes - Kube System 
- **Most Recent Warnings**: from Dashboard: Kubernetes - Control Plane/16 Kubernetes - etcd 
- **Operation by a disallowed K8s User**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **Pod and Containers Running in Kube-System**: from Dashboard: Kubernetes - Control Plane/18 Kubernetes - Kube System 
- **Pod Created in Kube Namespace**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **Pods Created**: from Dashboard: Kubernetes - Control Plane/15 Kubernetes - Controller Manager 
- **Pods Deleted**: from Dashboard: Kubernetes - Control Plane/15 Kubernetes - Controller Manager 
- **Scale Operations**: from Dashboard: Kubernetes - Control Plane/15 Kubernetes - Controller Manager 
- **Service Account Created in Kube Namespace**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **Severity Breakdown**: from Dashboard: Kubernetes - Control Plane/21 Kubernetes CP - API Server 
- **Severity Breakdown**: from Dashboard: Kubernetes - Control Plane/15 Kubernetes - Controller Manager 
- **Severity Over Time**: from Dashboard: Kubernetes - Control Plane/21 Kubernetes CP - API Server 
- **Severity Over Time**: from Dashboard: Kubernetes - Control Plane/15 Kubernetes - Controller Manager 
- **System ClusterRole Modified/Deleted**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events 
- **System Message Breakdown**: from Dashboard: Kubernetes - Control Plane/18 Kubernetes - Kube System 
- **Top 10 Kubernetes Rules Triggered**: from Dashboard: Kubernetes - Control Plane/20 Kubernetes - Security Audit Events

### Metric Searches

- **500s by Method**: from Dashboard: Kubernetes - Control Plane/21 Kubernetes CP - API Server 
- **90th Pct Etcd Latency**: from Dashboard: Kubernetes - Control Plane/16 Kubernetes - etcd 
- **99th Pct Latency**: from Dashboard: Kubernetes - Control Plane/16 Kubernetes - etcd 
- **API Server Request Latency By Method**: from Dashboard: Kubernetes - Control Plane/21 Kubernetes CP - API Server 
- **Api Server Request Rates by  Clients**: from Dashboard: Kubernetes - Control Plane/21 Kubernetes CP - API Server 
- **API Server Successful Request Rates**: from Dashboard: Kubernetes - Control Plane/21 Kubernetes CP - API Server 
- **API Server Successful vs Failure Request Rates**: from Dashboard: Kubernetes - Control Plane/21 Kubernetes CP - API Server 
- **Average Time Spent to Add Items in the Cache**: from Dashboard: Kubernetes - Control Plane/16 Kubernetes - etcd 
- **Average Time Spent to Get Items in the Cache**: from Dashboard: Kubernetes - Control Plane/16 Kubernetes - etcd 
- **Cache Insertion**: from Dashboard: Kubernetes - Control Plane/16 Kubernetes - etcd 
- **Cache Retrieval**: from Dashboard: Kubernetes - Control Plane/16 Kubernetes - etcd 
- **etcd cache Hit/Miss Ratio**: from Dashboard: Kubernetes - Control Plane/16 Kubernetes - etcd 
- **Number of Cache Adds**: from Dashboard: Kubernetes - Control Plane/16 Kubernetes - etcd 
- **Number of Cache Gets**: from Dashboard: Kubernetes - Control Plane/16 Kubernetes - etcd 
- **Request Count by Method**: from Dashboard: Kubernetes - Control Plane/21 Kubernetes CP - API Server 
- **Scheduler End-to-End Binding Latency**: from Dashboard: Kubernetes - Control Plane/19 Kubernetes - Scheduler 
- **Scheduling Algorithm Latency**: from Dashboard: Kubernetes - Control Plane/19 Kubernetes - Scheduler 
- **Scheduling Latency**: from Dashboard: Kubernetes - Control Plane/19 Kubernetes - Scheduler 
- **Status**: from Dashboard: Kubernetes - Control Plane/19 Kubernetes - Scheduler 
- **Status**: from Dashboard: Kubernetes - Control Plane/15 Kubernetes - Controller Manager

## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Kubernetes - Control Plane|500s by Method|Metrics|Kubernetes - Control Plane/21 Kubernetes CP - API Server|metric=apiserver\_request\_count cluster={{cluster}} code=5\* \| quantize 1m \| rate \| sum by verb|
|Kubernetes - Control Plane|90th Pct Etcd Latency|Metrics|Kubernetes - Control Plane/16 Kubernetes - etcd|metric=etcd\_request\_cache\_get\_latencies\_summary cluster={{cluster}} quantile=0.9 \| eval \_value / 1e6|
|Kubernetes - Control Plane|99th Pct Latency|Metrics|Kubernetes - Control Plane/16 Kubernetes - etcd|metric=etcd\_request\_cache\_get\_latencies\_summary cluster={{cluster}} quantile=0.99 \| eval \_value / 1e6|
|Kubernetes - Control Plane|Alerts by Priority|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output<br />\| json field=\_raw "\$['log']['output\_fields']['ka.user.name']" as user\_name<br />\| json field=\_raw "log.priority" as priority<br />\| count by priority|
|Kubernetes - Control Plane|Anonymous Request Allowed|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="Anonymous Request Allowed"<br />\| count|
|Kubernetes - Control Plane|API Server Request Latency By Method|Metrics|Kubernetes - Control Plane/21 Kubernetes CP - API Server|\_origin=kubernetes  metric=apiserver\_request\_latencies\_count  cluster={{cluster}}\| quantize 5m \| rate \| sum by verb|
|Kubernetes - Control Plane|Api Server Request Rates by  Clients|Metrics|Kubernetes - Control Plane/21 Kubernetes CP - API Server|\_origin=kubernetes  cluster={{cluster}}  metric=apiserver\_request\_count \| quantize 5m \| rate \| sum by client|
|Kubernetes - Control Plane|API Server Successful Request Rates|Metrics|Kubernetes - Control Plane/21 Kubernetes CP - API Server|\_origin=kubernetes   cluster={{cluster}} metric=apiserver\_request\_count code=2\*  \| quantize 5m \| rate \| sum by cluster|
|Kubernetes - Control Plane|API Server Successful vs Failure Request Rates|Metrics|Kubernetes - Control Plane/21 Kubernetes CP - API Server|\_origin=kubernetes   cluster={{cluster}} metric=apiserver\_request\_count !code=2\*  \| quantize 5m \| rate \| sum by cluster|
|Kubernetes - Control Plane|Attach to cluster-admin Role|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="Attach to cluster-admin Role"<br />\| count|
|Kubernetes - Control Plane|Attach/Exec Pod|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="Attach/Exec Pod"<br />\| count|
|Kubernetes - Control Plane|Average Time Spent in Scheduled Compaction|Logs|Kubernetes - Control Plane/16 Kubernetes - etcd|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info"<br />\| json field=\_raw "log" as log<br />\| parse "\* I \| mvcc: finished scheduled compaction at \* (took \*ms)" as timestamp,complated\_at,time\_spent<br />\| avg(time\_spent)|
|Kubernetes - Control Plane|Average Time Spent to Add Items in the Cache|Metrics|Kubernetes - Control Plane/16 Kubernetes - etcd|\_origin=kubernetes   cluster={{cluster}}  metric=etcd\_request\_cache\_add\_latencies\_summary\_sum \| quantize 1m \| eval \_value / 1000000 \| avg|
|Kubernetes - Control Plane|Average Time Spent to Get Items in the Cache|Metrics|Kubernetes - Control Plane/16 Kubernetes - etcd|\_origin=kubernetes cluster={{cluster}}  metric=etcd\_request\_cache\_get\_latencies\_summary\_sum \| quantize 1m \| eval \_value / 1000000 \| avg|
|Kubernetes - Control Plane|Cache Insertion|Metrics|Kubernetes - Control Plane/16 Kubernetes - etcd|\_origin=kubernetes  cluster={{cluster}}  metric=etcd\_request\_cache\_add\_latencies\_summary |
|Kubernetes - Control Plane|Cache Retrieval|Metrics|Kubernetes - Control Plane/16 Kubernetes - etcd|\_origin=kubernetes cluster={{cluster}} metric=etcd\_request\_cache\_get\_latencies\_summary  |
|Kubernetes - Control Plane|ClusterRole With Pod Exec Created|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="ClusterRole With Pod Exec Created"<br />\| count|
|Kubernetes - Control Plane|ClusterRole With Wildcard Created|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="ClusterRole With Wildcard Created"<br />\| count|
|Kubernetes - Control Plane|ClusterRole With Write Privileges Created|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="ClusterRole With Write Privileges Created"<br />\| count|
|Kubernetes - Control Plane|Create Disallowed Pod|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="Create Sensitive Mount Pod"<br />\| count|
|Kubernetes - Control Plane|Create HostNetwork Pod|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="Create HostNetwork Pod"<br />\| count|
|Kubernetes - Control Plane|Create NodePort Service|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="Create NodePort Service"<br />\| count|
|Kubernetes - Control Plane|Create Privileged Pod|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="Create Privileged Pod"<br />\| count|
|Kubernetes - Control Plane|Create Sensitive Mount Pod|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="Create Sensitive Mount Pod"<br />\| count|
|Kubernetes - Control Plane|Create/Modify Configmap With Private Credentials|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="Create/Modify Configmap With Private Credentials"<br />\| count|
|Kubernetes - Control Plane|Error Logs|Logs|Kubernetes - Control Plane/15 Kubernetes - Controller Manager|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" error<br />\| json field=\_raw "timestamp"<br />\| json field=\_raw "log"<br />\| parse regex field=log "^(?\<severity\>.)(?:[0-9])"<br />\| where severity == "E"<br />\| formatDate(\_messageTime,"MM-dd-yyyy HH:mm") as MessageTime<br />\| count by MessageTime,severity, container, namespace,pod,log|
|Kubernetes - Control Plane|Error Logs|Logs|Kubernetes - Control Plane/21 Kubernetes CP - API Server|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" (error OR warning)<br />\| json field=\_raw "timestamp"<br />\| json field=\_raw "log"<br />\| parse regex field=log "^(?\<severity\>.)(?:[0-9])"<br />\| where severity == "E"<br />\| formatDate(\_messageTime,"MM-dd-yyyy HH:mm") as MessageTime<br />\| count by MessageTime,severity,log|
|Kubernetes - Control Plane|Error Messages|Logs|Kubernetes - Control Plane/18 Kubernetes - Kube System| \_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" <br />\| parse "\\"log\\":\\"\*       \*\\"" as log\_code,log\_message<br />\| parse field=log\_message "\* \*.\*:\*]\*" as step, resource, action, step\_code, msg<br />\| parse field=log\_code "\* \*" as severity, timestmp<br />\| where severity matches "E\*"<br />\| count by container, severity, resource, msg <br />\| limit 10|
|Kubernetes - Control Plane|Error Messages Count|Logs|Kubernetes - Control Plane/15 Kubernetes - Controller Manager|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info"<br />\| json field=\_raw "log" as log<br />\| parse regex field=log "^(?\<severity\>.)(?:[0-9])"<br />\| where severity = "E"<br />\| count log<br />\| sort by \_count<br />\| limit 10|
|Kubernetes - Control Plane|Error Stream|Logs|Kubernetes - Control Plane/18 Kubernetes - Kube System|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" error<br />\| json field=\_raw "timestamp"<br />\| json field=\_raw "log"<br />\| parse regex field=log "^(?\<severity\>.)(?:[0-9])"<br />\| where severity == "E"<br />\| formatDate(\_messageTime,"MM-dd-yyyy HH:mm") as MessageTime<br />\| count by MessageTime,severity, container, namespace,pod,log|
|Kubernetes - Control Plane|etcd cache Hit/Miss Ratio|Metrics|Kubernetes - Control Plane/16 Kubernetes - etcd|\_origin=kubernetes  cluster={{cluster}} metric=etcd\_helper\_cache\_hit\_count  \| sum by cluster \| rate|
|Kubernetes - Control Plane|Events by User|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output<br />\| json field=\_raw "log.priority" as priority<br />\| json field=\_raw "log.rule" as rule<br />//\| where rule="All K8s Audit Events"<br />\| json field=\_raw "\$['log']['output\_fields']['ka.user.name']" as user\_name<br />\| count by user\_name|
|Kubernetes - Control Plane|Job Creations|Logs|Kubernetes - Control Plane/15 Kubernetes - Controller Manager|	\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" "Created job"<br />	\| json field=\_raw "log" as log<br />	\| parse field=log "Created job \*" as job<br />  \| parse field=log "\* \*       " as code,time<br />  \| count by time, job|
|Kubernetes - Control Plane|Job Deletions|Logs|Kubernetes - Control Plane/15 Kubernetes - Controller Manager|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" "Deleted job"<br />\| json field=\_raw "log" as log<br />\| parse field=log "Deleted job \*" as job\_name<br />\| count|
|Kubernetes - Control Plane|K8s ConfigMap Created|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="K8s ConfigMap Created"<br />\| count|
|Kubernetes - Control Plane|K8s Deployment Created|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="K8s Deployment Created"<br />\| count|
|Kubernetes - Control Plane|K8s Deployment Deleted|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="K8s Deployment Deleted"<br />\| count|
|Kubernetes - Control Plane|K8s Namespace Created|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="K8s Namespace Created"<br />\| count|
|Kubernetes - Control Plane|K8s Namespace Deleted|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="K8s Namespace Deleted"<br />\| count|
|Kubernetes - Control Plane|K8s Role/Clusterrole Created|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="K8s Role/Clusterrole Created"<br />\| count|
|Kubernetes - Control Plane|K8s Role/Clusterrole Deleted|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="K8s Role/Clusterrole Deleted"<br />\| count|
|Kubernetes - Control Plane|K8s Role/Clusterrolebinding Created|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="K8s Role/Clusterrolebinding Created"<br />\| count|
|Kubernetes - Control Plane|K8s Role/Clusterrolebinding Deleted|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="K8s Role/Clusterrolebinding Deleted"<br />\| count|
|Kubernetes - Control Plane|K8s Service Created|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="K8s Service Created"<br />\| count|
|Kubernetes - Control Plane|K8s Service Deleted|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="K8s Service Deleted"<br />\| count|
|Kubernetes - Control Plane|K8s Serviceaccount Created|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="K8s Serviceaccount Created"<br />\| count|
|Kubernetes - Control Plane|K8s Serviceaccount Deleted|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="K8s Serviceaccount Deleted"<br />\| count|
|Kubernetes - Control Plane|Kubernetes Rules Triggerred|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output<br />\| json field=\_raw "log.priority" as priority<br />\| json field=\_raw "log.rule" as rule<br />\| json field=\_raw "log.time" as time<br />\| json field=\_raw "log.output" as output<br />\| json field=\_raw "\$['log']['output\_fields']['ka.user.name']" as user\_name<br />\| json field=\_raw "\$['log']['output\_fields']['ka.target.name']" as target\_name<br />\| json field=\_raw "\$['log']['output\_fields']['ka.target.namespace']" as target\_namespace<br />\| count by time, rule, priority, user\_name, target\_name, target\_namespace, output<br />\| sort by time<br />//\| fields - \_count|
|Kubernetes - Control Plane|Message Breakdown by Container|Logs|Kubernetes - Control Plane/18 Kubernetes - Kube System| \_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" <br />\| parse "\\"log\\":\\"\*       \*\\"" as log\_code,log\_message<br />\| parse field=log\_message "\* \*.\*:\*]\*" as step, resource, action, step\_code, specific\_message<br />\| fields - log\_message<br />\| count container \| top 10 container by \_count|
|Kubernetes - Control Plane|Most Recent Warnings|Logs|Kubernetes - Control Plane/16 Kubernetes - etcd|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" !("scheduled compaction")<br />\| json field=\_raw "log" as log <br />\| parse field=log "\* \* \* " as date,time, severity<br />\| where severity = "W"<br />\| count by date,time,severity,container,namespace,pod,log|
|Kubernetes - Control Plane|Number of Cache Adds|Metrics|Kubernetes - Control Plane/16 Kubernetes - etcd|\_origin=kubernetes   cluster={{cluster}}   metric=etcd\_request\_cache\_add\_latencies\_summary\_count|
|Kubernetes - Control Plane|Number of Cache Gets|Metrics|Kubernetes - Control Plane/16 Kubernetes - etcd|\_origin=kubernetes  cluster={{cluster}} metric=etcd\_request\_cache\_get\_latencies\_summary\_count \| quantize 1m|
|Kubernetes - Control Plane|Operation by a disallowed K8s User|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="Disallowed K8s User"<br />\| count|
|Kubernetes - Control Plane|Pod and Containers Running in Kube-System|Logs|Kubernetes - Control Plane/18 Kubernetes - Kube System|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" <br />\| count by namespace, pod, container|
|Kubernetes - Control Plane|Pod Created in Kube Namespace|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="Pod Created in Kube Namespace"<br />\| count|
|Kubernetes - Control Plane|Pods Created|Logs|Kubernetes - Control Plane/15 Kubernetes - Controller Manager|	\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" "Created pod:"<br />	\| json field=\_raw "log" as log<br />	\| parse field=log "Created pod: \*" as pod<br />  \| parse field=log "\* \*       " as code,time<br />  \| count by time, pod|
|Kubernetes - Control Plane|Pods Deleted|Logs|Kubernetes - Control Plane/15 Kubernetes - Controller Manager|	\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" "Deleted pod:"<br />	\| json field=\_raw "log" as log<br />	\| parse field=log "Deleted pod: \*" as pod<br />  \| parse field=log "\* \*       " as code,time<br />  \| count by time, pod|
|Kubernetes - Control Plane|Request Count by Method|Metrics|Kubernetes - Control Plane/21 Kubernetes CP - API Server|metric=apiserver\_request\_count cluster={{cluster}} \| quantize 1m \| rate \| sum by verb|
|Kubernetes - Control Plane|Scale Operations|Logs|Kubernetes - Control Plane/15 Kubernetes - Controller Manager|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" Scaled<br />\| json field=\_raw "log" as log<br />\| parse regex field=log "^(?\<severity\>.)(?:[0-9])"<br />\| where severity == "I"<br />\| parse field=log "Scaled \* replica set \* to \*" as direction,replica\_set,scaled\_to<br />\| first(scaled\_to) as scaled\_to by  replica\_set |
|Kubernetes - Control Plane|Scheduler End-to-End Binding Latency|Metrics|Kubernetes - Control Plane/19 Kubernetes - Scheduler| \_origin=kubernetes cluster={{cluster}} metric=scheduler\_binding\_latency\_microseconds\_sum  \| quantize 5m \| sum by cluster|
|Kubernetes - Control Plane|Scheduling Algorithm Latency|Metrics|Kubernetes - Control Plane/19 Kubernetes - Scheduler|\_origin=kubernetes cluster={{cluster}} metric=scheduler\_scheduling\_algorithm\_latency\_microseconds\_sum  \| quantize 5m \| sum by cluster|
|Kubernetes - Control Plane|Scheduling Latency|Metrics|Kubernetes - Control Plane/19 Kubernetes - Scheduler|\_origin=kubernetes cluster={{cluster}} metric=scheduler\_e2e\_scheduling\_latency\_microseconds\_sum \| quantize 5m \| sum by cluster|
|Kubernetes - Control Plane|Service Account Created in Kube Namespace|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="Service Account Created in Kube Namespace"<br />\| count|
|Kubernetes - Control Plane|Severity Breakdown|Logs|Kubernetes - Control Plane/21 Kubernetes CP - API Server|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info"<br />\| json field=\_raw "timestamp"<br />\| json field=\_raw "log"<br />\| parse regex field=log "^(?\<severity\>.)(?:[0-9])"<br />\| count by severity<br />\| sort by \_count|
|Kubernetes - Control Plane|Severity Breakdown|Logs|Kubernetes - Control Plane/15 Kubernetes - Controller Manager|	\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" <br />	\| json field=\_raw "log" as log<br />	\| parse regex field=log "^(?\<severity\>.)(?:[0-9])"<br />  \| count by severity<br />  \| sort by \_count|
|Kubernetes - Control Plane|Severity Over Time|Logs|Kubernetes - Control Plane/21 Kubernetes CP - API Server|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" <br />\| json field=\_raw "timestamp"<br />\| json field=\_raw "log"<br />\| parse regex field=log "^(?\<severity\>.)(?:[0-9])"<br />\| timeslice 1h<br />\| count by \_timeslice, severity<br />\| transpose row \_timeslice column severity<br />\| fillmissing timeslice(1h)|
|Kubernetes - Control Plane|Severity Over Time|Logs|Kubernetes - Control Plane/15 Kubernetes - Controller Manager|	\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" <br />	\| json field=\_raw "log" as log<br />	\| parse regex field=log "^(?\<severity\>.)(?:[0-9])"<br />	\| timeslice 1h<br />	\| count \_timeslice, severity <br />	\| transpose row \_timeslice column severity<br />  \| fillmissing timeslice(1h) |
|Kubernetes - Control Plane|Status|Metrics|Kubernetes - Control Plane/19 Kubernetes - Scheduler|\_origin=kubernetes metric=up (job=kube-scheduler\*) \| quantize 5m \| sum|
|Kubernetes - Control Plane|Status|Metrics|Kubernetes - Control Plane/15 Kubernetes - Controller Manager|\_origin=kubernetes job=kube-controller-manager  metric=up cluster={{cluster}} \| quantize 5m \| sum|
|Kubernetes - Control Plane|System ClusterRole Modified/Deleted|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output <br />\| json field=\_raw "log.priority" as priority <br />\| json field=\_raw "log.rule" as rule<br />\| where rule="System ClusterRole Modified/Deleted"<br />\| count|
|Kubernetes - Control Plane|System Message Breakdown|Logs|Kubernetes - Control Plane/18 Kubernetes - Kube System| \_collector="Labs - Falco" OR \_collector="prod01.travellogic.info"<br />\| parse "\\"log\\":\\"\*       \*\\"" as log\_code,log\_message<br />\| parse field=log\_message "\* \*.\*:\*]\*" as step, resource, action, step\_code, log\_message\_spec<br />\| fields - log\_message \| count resource \| top 10 resource by \_count|
|Kubernetes - Control Plane|Top 10 Kubernetes Rules Triggered|Logs|Kubernetes - Control Plane/20 Kubernetes - Security Audit Events|\_collector="Labs - Falco" OR \_collector="prod01.travellogic.info" ka output\_fields priority output<br />\| json field=\_raw "log.priority" as priority<br />\| json field=\_raw "log.rule" as rule<br />\| json field=\_raw "\$['log']['output\_fields']['ka.user.name']" as ka\_user\_name<br />\| count by rule<br />\| limit 10 |

