# Windows

## Searches

### Log Searches

- **(Kerberos) Failed Logins on the Domain Controller or Member Servers**: from Search: Windows/System Activity/(Kerberos) Failed Logins on the Domain Controller or Member Servers 
- **(NTLM) Failed Logins**: from Search: Windows/System Activity/(NTLM) Failed Logins 
- **Account Policy Changes**: from Search: Windows/Security Status/Account Policy Changes 
- **All Directory Service Changes**: from Search: Windows/System Activity/All Directory Service Changes 
- **All Directory Service Object Creations**: from Search: Windows/System Activity/All Directory Service Object Creations 
- **All Fatal or Warning Messages by Source Host**: from Search: Windows/Updates/All Fatal or Warning Messages by Source Host 
- **All Fatal or Warning Messages by Source Host**: from Dashboard: Windows/Windows - Overview - New 
- **All User Account Changes**: from Search: Windows/User Activity/All User Account Changes 
- **Audit Log Cleared**: from Search: Windows/Security Status/Audit Log Cleared 
- **Audit Policy Changes**: from Search: Windows/Security Status/Audit Policy Changes 
- **Breakdown by Keyword Tag**: from Dashboard: Windows/Windows - Event Errors - New 
- **Changes to Administrative Groups**: from Search: Windows/User Activity/Changes to Administrative Groups 
- **Changes to Administrative Groups**: from Dashboard: Windows/Windows - Overview - New 
- **Closed RDP Sessions Tracking**: from Search: Windows/Security Status/Closed RDP Sessions Tracking 
- **Closed Sessions Tracking**: from Search: Windows/Security Status/Closed Sessions Tracking 
- **Error Keyword - LogReduce**: from Dashboard: Windows/Windows - Event Errors - New 
- **Error Keyword - One Day Time Comparison**: from Dashboard: Windows/Windows - Event Errors - New 
- **Error Keyword - Outlier**: from Dashboard: Windows/Windows - Event Errors - New 
- **Error Keyword by Computer and Message**: from Dashboard: Windows/Windows - Event Errors - New 
- **Error Keyword Trend**: from Dashboard: Windows/Windows - Event Errors - New 
- **Errors and Warnings Over Time**: from Dashboard: Windows/Windows - Default - New 
- **Event Distribution Over Time**: from Dashboard: Windows/Windows - Default - New 
- **Failed Logins Over time**: from Search: Windows/User Activity/Failed Logins Over time 
- **Failed Updates by Host**: from Search: Windows/Updates/Failed Updates by Host 
- **Failed Updates by KB Number**: from Search: Windows/Updates/Failed Updates by KB Number 
- **Firewall Changes**: from Search: Windows/Security Status/Firewall Changes 
- **Multiple Failed Logins by Same User**: from Search: Windows/User Activity/Multiple Failed Logins by Same User 
- **Multiple Failed Logins on Local Machine**: from Search: Windows/User Activity/Multiple Failed Logins on Local Machine 
- **New Accounts Created**: from Search: Windows/User Activity/New Accounts Created 
- **Recent Policy Changes**: from Search: Windows/Security Status/Recent Policy Changes 
- **Recent Policy Changes**: from Dashboard: Windows/Windows - Overview - New 
- **Report Messages**: from Search: Windows/Updates/Report Messages 
- **Service Events by Type**: from Search: Windows/System Activity/Service Events by Type 
- **Service Installed**: from Search: Windows/System Activity/Service Installed 
- **Service Starts**: from Search: Windows/System Activity/Service Starts 
- **Service Stops**: from Search: Windows/System Activity/Service Stops 
- **Successful Group Creations**: from Search: Windows/User Activity/Successful Group Creations 
- **Successful Logons Over time**: from Search: Windows/User Activity/Successful Logons Over time 
- **Successful Updates by Host**: from Search: Windows/Updates/Successful Updates by Host 
- **Successful Updates by KB number**: from Search: Windows/Updates/Successful Updates by KB number 
- **System Operations**: from Dashboard: Windows/Windows - Default - New 
- **System Restarted**: from Search: Windows/System Activity/System Restarted 
- **System Restarts**: from Dashboard: Windows/Windows - Overview - New 
- **Top 10 Service Operations**: from Dashboard: Windows/Windows - Default - New 
- **Top Error Codes**: from Search: Windows/Updates/Top Error Codes 
- **Top Reasons for Failed Logins**: from Search: Windows/System Activity/Top Reasons for Failed Logins 
- **Top Security Events**: from Search: Windows/Security Status/Top Security Events 
- **Top Windows Update Error Codes**: from Dashboard: Windows/Windows - Overview - New 
- **Unauthorized Account Creations**: from Search: Windows/User Activity/Unauthorized Account Creations 
- **Update Results by KB number**: from Search: Windows/Updates/Update Results by KB number 
- **User Account Changed**: from Search: Windows/User Activity/User Account Changed 
- **User Account Deleted**: from Search: Windows/User Activity/User Account Deleted 
- **User Added to Administrative Groups**: from Search: Windows/User Activity/User Added to Administrative Groups 
- **User Added to Group**: from Search: Windows/User Activity/User Added to Group 
- **User Locked-out**: from Search: Windows/User Activity/User Locked-out 
- **User Password Changes**: from Search: Windows/User Activity/User Password Changes 
- **User Password Reset Attempts**: from Search: Windows/User Activity/User Password Reset Attempts

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Windows/System Activity|(Kerberos) Failed Logins on the Domain Controller or Member Servers|Logs|Windows/System Activity/(Kerberos) Failed Logins on the Domain Controller or Member Servers|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4771 or 4776 or 4768) ("EventCode = 4771;" or "EventCode = 4776;" or "EventCode = 4768;") "Audit Failure"<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\.]+?)(?:\\r\|\\.\|\\";)" nodrop \| parse "Type = \\"\*\\";" as msg\_type nodrop<br />\| parse regex "Result Code:\\s+(?\<result\_code\>[^\\r]+)\\r" nodrop \| parse regex "Failure Code:\\s+(?\<failure\_code\>[^\\r]+)\\r" nodrop<br />\| parse regex "Logon Account:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Source Workstation:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Error Code:\\s+(?\<error\_code\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse regex "Logon Account:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Source Workstation:\\s\*\\r[\\s\\S]+?Error Code:\\s+(?\<error\_code\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop<br />\| where msg\_type="Audit Failure" and (event\_id="4771" or (event\_id="4768" and result\_code !="0x0") or (event\_id="4776" and error\_code !="0x0"))|
|Windows/System Activity|(NTLM) Failed Logins|Logs|Windows/System Activity/(NTLM) Failed Logins|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4776 "EventCode = 4776;" "Audit Failure"<br />\| parse "EventCode = \*;" as event\_id nodrop<br />\| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\.]+?)(?:\\r\|\\.\|\\";)" nodrop<br />\| parse "Type = \\"\*\\";" as msg\_type nodrop<br />\| parse regex "Authentication Package:\\s+(?\<Authentication\_Package\>[^\\r]+)\\r[\\s\\S]+?Logon Account:\\s+(?\<logon\_account\>[^\\r]+)\\r[\\s\\S]+?Source Workstation:\\s+(?\<workstation\>[^\\r]+)\\r[\\s\\S]+?Error Code:\\s+(?\<error\_code\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop<br />\| where event\_id="4776" and msg\_type="Audit Failure"|
|Windows/Security Status|Account Policy Changes|Logs|Windows/Security Status/Account Policy Changes|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4739 "EventCode = 4739;"<br />\| parse "EventCode = \*;" as event\_id nodrop<br />\| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Domain:[\\s\\S]+?Domain Name:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop<br />\| where event\_id="4739"|
|Windows/System Activity|All Directory Service Changes|Logs|Windows/System Activity/All Directory Service Changes|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (5136 or 5137 or 5138 or 5139 or 5141) ("EventCode = 5136;" or "EventCode = 5137;" or "EventCode = 5138;" or "EventCode = 5139;" or "EventCode = 5141;")<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\.]+?)(?:\\r\|\\.\|\\";)" nodrop \| parse "Category = \*;" as category nodrop \| parse "CategoryString = \\"\*\\";" as CategoryString nodrop \| parse "Type = \\"\*\\";" as type nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Directory Service:[\\s\\S]+?Name:\\s+(?\<directory\_service\_name\>[^\\r]+?)\\r[\\s\\S]+?Type:\\s+(?\<directory\_service\_type\>[^\\r\\"]+?)\\r" nodrop \| parse regex "DN:\\t(?\<object\_dn\>.\*)\\r" nodrop<br />\| count by category, event\_id, msg\_summary, directory\_service\_name, directory\_service\_type, object\_dn, type|
|Windows/System Activity|All Directory Service Object Creations|Logs|Windows/System Activity/All Directory Service Object Creations|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 5137 "EventCode = 5137;"<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\.]+?)(?:\\r\|\\.\|\\";)" nodrop \| parse "Category = \*;" as category nodrop \| parse "CategoryString = \\"\*\\";" as CategoryString nodrop \| parse "Type = \\"\*\\";" as type nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Directory Service:[\\s\\S]+?Name:\\s+(?\<directory\_service\_name\>[^\\r]+?)\\r[\\s\\S]+?Type:\\s+(?\<directory\_service\_type\>[^\\r\\"]+?)\\r" nodrop \| parse regex "DN:\\t(?\<object\_dn\>.\*)\\r" nodrop<br />\| count by category, event\_id, msg\_summary, directory\_service\_name, directory\_service\_type, object\_dn, type|
|Windows/Updates|All Fatal or Warning Messages by Source Host|Logs|Windows/Updates/All Fatal or Warning Messages by Source Host|(\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=\*WindowsUpdate.log (WARNING or Error or FATAL))<br />\| count by \_sourceHost|
|Windows|All Fatal or Warning Messages by Source Host|Logs|Windows/Windows - Overview - New|\_sourceCategory = Labs/Windows/OS/Windows (WARNING or Error or FATAL)<br />\| \_sourcehost as source\_host<br />\| count as error\_count by source\_host<br />\| sort - error\_count|
|Windows/User Activity|All User Account Changes|Logs|Windows/User Activity/All User Account Changes|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security "User Account Management"<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse "CategoryString = \\"\*\\";" as category nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Changed Attributes:\\s+(?\<changedAttributes\>[\\s\\S]\*?)Additional Information:" nodrop<br />\| where category = "User Account Management"<br />\| fields host, event\_id, msg\_summary, src\_user, dest\_user, src\_domain, dest\_domain, changedAttributes|
|Windows/Security Status|Audit Log Cleared|Logs|Windows/Security Status/Audit Log Cleared|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (1102 or 517) ("EventCode = 1102;" or "EventCode = 517;")<br />\| parse "EventCode = \*;" as event\_id \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\.]+?)(?:\\r\|\\.\|\\";)" nodrop \| parse "User = \\"\*\\"" as src\_user nodrop <br />\| where event\_id in ("1102", "517")<br />\| fields event\_id, msg\_summary, src\_user, host|
|Windows/Security Status|Audit Policy Changes|Logs|Windows/Security Status/Audit Policy Changes|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4719 "EventCode = 4719;"<br />\| parse "EventCode = \*;" as event\_id nodrop<br />\| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r" nodrop<br />\| where event\_id="4719"|
|Windows|Breakdown by Keyword Tag|Logs|Windows/Windows - Event Errors - New|\_sourceCategory = Labs/Windows/OS/Windows (error or exception or timeout or fail)<br />\| parse "EventCode = \*;" as EventCode<br />\| parse "Computer = \\"\*\\";" as Computer<br />\| parse "Message = \\"\*\\";" as Message<br />\| \_raw as raw\_text<br />\| if(raw\_text matches "\*error\*", "error\_keyword",if(raw\_text matches "\*Error\*", "error\_keyword",if(raw\_text matches "\*exception\*", "exception\_keyword",if(raw\_text matches "\*Exception\*","exception\_keyword",if(raw\_text matches "\*timeout\*", "timeout\_keyword", if(raw\_text matches "\*fail\*", "fail\_keyword","no\_error\_keywords")))))) as keyword\_tag<br />\|where if ("{{raw\_text}}" = "\*", true, raw\_text matches "{{raw\_text}}") AND if ("{{keyword\_tag}}" = "\*", true, keyword\_tag matches "{{keyword\_tag}}") AND if ("{{message}}" = "\*", true, message matches "{{message}}") AND if ("{{\_sourcecategory}}" = "\*", true, \_sourcecategory matches "{{\_sourcecategory}}")<br />\|count by keyword\_tag|
|Windows/User Activity|Changes to Administrative Groups|Logs|Windows/User Activity/Changes to Administrative Groups|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security ("Security Group Management" or "Category = 13826;") (created or modified or changed or removed or added)<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse regex "Subcategory:\\s+(?\<Subcategory\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject:[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r\\"]+?)\\r[\\s\\S]+?(?:New\|Deleted) Group:[\\s\\S]+?(?:Account\|Group) Name:\\s+(?\<group\_name\>[^\\r\\"]+?)\\r\\s+?(?:Account\|Group) Domain:\\s+(?\<group\_domain\>[^\\r\\"]+?)(?:\\r\|\\")" nodrop <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r" nodrop <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject:[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Member:[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r\\"]+?)\\r[\\s\\S]+?Group:[\\s\\S]+?(?:Account\|Group) Name:\\s+(?\<group\_name\>[^\\r\\"]+?)\\r\\s+?(?:Account\|Group) Domain:\\s+(?\<group\_domain\>[^\\r\\"]+?)(?:\\r\|\\")" nodrop \| parse "Category = \*;" as category nodrop \| parse "CategoryString = \\"\*\\";" as categoryString nodrop<br />\| where (category="13826" or Subcategory = "Security Group Management" or categoryString = "Security Group Management") and group\_name in ("Administrators", "Domain Admins", "Schema Admins", "Server Operators", "Account Operators", "Backup Operators")|
|Windows|Changes to Administrative Groups|Logs|Windows/Windows - Overview - New|\_sourceCategory = Labs/Windows/OS/Windows ("Security Group Management" or "Category = 13826;") (created or modified or changed or removed or added) // \_sourceName=Security<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse regex "Subcategory:\\s+(?\<Subcategory\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject:[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r\\"]+?)\\r[\\s\\S]+?(?:New\|Deleted) Group:[\\s\\S]+?(?:Account\|Group) Name:\\s+(?\<group\_name\>[^\\r\\"]+?)\\r\\s+?(?:Account\|Group) Domain:\\s+(?\<group\_domain\>[^\\r\\"]+?)(?:\\r\|\\")" nodrop <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r" nodrop <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject:[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Member:[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r\\"]+?)\\r[\\s\\S]+?Group:[\\s\\S]+?(?:Account\|Group) Name:\\s+(?\<group\_name\>[^\\r\\"]+?)\\r\\s+?(?:Account\|Group) Domain:\\s+(?\<group\_domain\>[^\\r\\"]+?)(?:\\r\|\\")" nodrop \| parse "Category = \*;" as category nodrop \| parse "CategoryString = \\"\*\\";" as categoryString nodrop<br />\| where (category="13826" or Subcategory = "Security Group Management" or categoryString = "Security Group Management") and group\_name in ("Administrators", "Domain Admins", "Schema Admins", "Server Operators", "Account Operators", "Backup Operators")<br />\|where if ("{{group\_domain}}" = "\*", true, group\_domain matches "{{group\_domain}}") AND if ("{{src\_user}}" = "\*", true, src\_user matches "{{src\_user}}") AND if ("{{event\_id}}" = "\*", true, event\_id matches "{{event\_id}}") AND if ("{{src\_domain}}" = "\*", true, src\_domain matches "{{src\_domain}}") AND if ("{{group\_name}}" = "\*", true, group\_name matches "{{group\_name}}") AND if ("{{dest\_user}}" = "\*", true, dest\_user matches "{{dest\_user}}")<br />\|count as count|
|Windows/Security Status|Closed RDP Sessions Tracking|Logs|Windows/Security Status/Closed RDP Sessions Tracking|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4778 or 4779) ("EventCode = 4778;" or "EventCode = 4779;")<br /> \|sessionize "(?:ComputerName\|Computer) = \\"\*\\";\\n\\tEventCode = 4778;\*Account Name:\\t\\t\*\\r\*Account Domain:\\t\\t\*\\r\*Logon ID:\\t\\t\*\\r" as (computerName,\_11,userName,\_u1,domain,\_d1,logonID), <br /> "ComputerName = \\"\$computerName\\";\\n\\tEventCode = 4779;\*Account Name:\\t\\t\$userName\\r\*Account Domain:\\t\\t\$domain\\r\*Logon ID:\\t\\t\*\\r" as (\_21,\_u2,\_d2,\_l1)|
|Windows/Security Status|Closed Sessions Tracking|Logs|Windows/Security Status/Closed Sessions Tracking|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4624 or 4634) ("EventCode = 4624;" or "EventCode = 4634;")<br /> \| sessionize "(?:ComputerName\|Computer) = \\"\*\\";\\n\\tEventCode = 4624;\*Logon Type:\\t\\t\\t\*\\r\*New Logon:\*Account Name:\\t\\t\*\\r\*Account Domain:\\t\\t\*\\r\*Logon ID:\\t\\t\*\\r\*Logon GUID:" as (computerName,\_11,logonType,\_12,\_13,userName,\_u1,domain,\_d1,logonID,\_l1), <br /> "(?:ComputerName\|Computer) = \\"\$computerName\\";\\n\\tEventCode = 4634;\*Security ID:\*Account Name:\\t\\t\$userName\\r\*Account Domain:\\t\\t\$domain\\r\*Logon ID:\\t\\t\$logonID\\r\*Logon Type:\\t\\t\\t\$logonType\\r" as (\_21,\_22,\_aN1,\_aD1,\_23)|
|Windows|Error Keyword - LogReduce|Logs|Windows/Windows - Event Errors - New|\_sourceCategory = Labs/Windows/OS/Windows (error or exception or timeout or fail)<br />\| parse "EventCode = \*;" as EventCode<br />\| parse "Computer = \\"\*\\";" as Computer<br />\| parse "Message = \\"\*\\";" as Message<br />\| \_raw as raw\_text<br />\| if(raw\_text matches "\*error\*", "error\_keyword",if(raw\_text matches "\*Error\*", "error\_keyword",if(raw\_text matches "\*exception\*", "exception\_keyword",if(raw\_text matches "\*Exception\*","exception\_keyword",if(raw\_text matches "\*timeout\*", "timeout\_keyword", if(raw\_text matches "\*fail\*", "fail\_keyword","no\_error\_keywords")))))) as keyword\_tag<br />\| timeslice 24h<br />\|where if ("{{raw\_text}}" = "\*", true, raw\_text matches "{{raw\_text}}") AND if ("{{keyword\_tag}}" = "\*", true, keyword\_tag matches "{{keyword\_tag}}") AND if ("{{message}}" = "\*", true, message matches "{{message}}") AND if ("{{\_sourcecategory}}" = "\*", true, \_sourcecategory matches "{{\_sourcecategory}}")<br />\|logreduce by \_timeslice<br />\| sort by \_count|
|Windows|Error Keyword - One Day Time Comparison|Logs|Windows/Windows - Event Errors - New|\_sourceCategory = Labs/Windows/OS/Windows (error or exception or timeout or fail)<br />\| parse "EventCode = \*;" as EventCode<br />\| parse "Computer = \\"\*\\";" as Computer<br />\| parse "Message = \\"\*\\";" as Message<br />\| \_raw as raw\_text<br />\| if(raw\_text matches "\*error\*", "error\_keyword",if(raw\_text matches "\*Error\*", "error\_keyword",if(raw\_text matches "\*exception\*", "exception\_keyword",if(raw\_text matches "\*Exception\*","exception\_keyword",if(raw\_text matches "\*timeout\*", "timeout\_keyword", if(raw\_text matches "\*fail\*", "fail\_keyword","no\_error\_keywords")))))) as keyword\_tag<br />\|where if ("{{raw\_text}}" = "\*", true, raw\_text matches "{{raw\_text}}") AND if ("{{keyword\_tag}}" = "\*", true, keyword\_tag matches "{{keyword\_tag}}") AND if ("{{message}}" = "\*", true, message matches "{{message}}") AND if ("{{\_sourcecategory}}" = "\*", true, \_sourcecategory matches "{{\_sourcecategory}}")<br />\|count by keyword\_tag<br />\| compare with timeshift 1d|
|Windows|Error Keyword - Outlier|Logs|Windows/Windows - Event Errors - New|\_sourceCategory = Labs/Windows/OS/Windows (error or exception or timeout or fail)<br />\| parse "EventCode = \*;" as EventCode<br />\| parse "Computer = \\"\*\\";" as Computer<br />\| parse "Message = \\"\*\\";" as Message<br />\| \_raw as raw\_text<br />\| if(raw\_text matches "\*error\*", "error\_keyword",if(raw\_text matches "\*Error\*", "error\_keyword",if(raw\_text matches "\*exception\*", "exception\_keyword",if(raw\_text matches "\*Exception\*","exception\_keyword",if(raw\_text matches "\*timeout\*", "timeout\_keyword", if(raw\_text matches "\*fail\*", "fail\_keyword","no\_error\_keywords")))))) as keyword\_tag<br />\| timeslice 1h<br />\|where if ("{{raw\_text}}" = "\*", true, raw\_text matches "{{raw\_text}}") AND if ("{{keyword\_tag}}" = "\*", true, keyword\_tag matches "{{keyword\_tag}}") AND if ("{{message}}" = "\*", true, message matches "{{message}}") AND if ("{{\_sourcecategory}}" = "\*", true, \_sourcecategory matches "{{\_sourcecategory}}")<br />\|count by \_timeslice<br />\| fillmissing timeslice(1h)<br />\| sort by \_timeslice<br />\| outlier \_count|
|Windows|Error Keyword by Computer and Message|Logs|Windows/Windows - Event Errors - New|\_sourceCategory = Labs/Windows/OS/Windows (error or exception or timeout or fail)<br />\| parse "EventCode = \*;" as EventCode<br />\| parse "Computer = \\"\*\\";" as Computer<br />\| parse "Message = \\"\*\\";" as Message<br />\| \_raw as raw\_text<br />\| if(raw\_text matches "\*error\*", "error\_keyword",if(raw\_text matches "\*Error\*", "error\_keyword",if(raw\_text matches "\*exception\*", "exception\_keyword",if(raw\_text matches "\*Exception\*","exception\_keyword",if(raw\_text matches "\*timeout\*", "timeout\_keyword", if(raw\_text matches "\*fail\*", "fail\_keyword","no\_error\_keywords")))))) as keyword\_tag<br />\|where if ("{{raw\_text}}" = "\*", true, raw\_text matches "{{raw\_text}}") AND if ("{{keyword\_tag}}" = "\*", true, keyword\_tag matches "{{keyword\_tag}}") AND if ("{{message}}" = "\*", true, message matches "{{message}}") AND if ("{{\_sourcecategory}}" = "\*", true, \_sourcecategory matches "{{\_sourcecategory}}")<br />\|count by keyword\_tag, Computer, Message<br />\| sort by \_count|
|Windows|Error Keyword Trend|Logs|Windows/Windows - Event Errors - New|\_sourceCategory = Labs/Windows/OS/Windows (error or exception or timeout or fail)<br />\| parse "EventCode = \*;" as EventCode<br />\| parse "Computer = \\"\*\\";" as Computer<br />\| parse "Message = \\"\*\\";" as Message<br />\| \_raw as raw\_text<br />\| if(raw\_text matches "\*error\*", "error\_keyword",if(raw\_text matches "\*Error\*", "error\_keyword",if(raw\_text matches "\*exception\*", "exception\_keyword",if(raw\_text matches "\*Exception\*","exception\_keyword",if(raw\_text matches "\*timeout\*", "timeout\_keyword", if(raw\_text matches "\*fail\*", "fail\_keyword","no\_error\_keywords")))))) as keyword\_tag<br />\| timeslice 15m<br />\|where if ("{{raw\_text}}" = "\*", true, raw\_text matches "{{raw\_text}}") AND if ("{{keyword\_tag}}" = "\*", true, keyword\_tag matches "{{keyword\_tag}}") AND if ("{{message}}" = "\*", true, message matches "{{message}}") AND if ("{{\_sourcecategory}}" = "\*", true, \_sourcecategory matches "{{\_sourcecategory}}")<br />\|count by keyword\_tag, \_timeslice<br />\| transpose row \_timeslice column keyword\_tag<br />\| fillmissing timeslice(15m)|
|Windows|Errors and Warnings Over Time|Logs|Windows/Windows - Default - New|\_sourceCategory = Labs/Windows/OS/Windows (error or warning)<br />\| parse "Type = \\"\*\\";" as evtType<br />\| if(\_raw matches "\*EventType = Error\*",1,0) as errors <br />\| if(\_raw matches "\*EventType = Warning\*",1,0) as warnings<br />\| if (evtType matches "Error\*",1,errors) as errors <br />\| if (evtType matches "Warning\*",1,warnings) as warnings <br />\| timeslice by 1h<br />\| sum(errors) as errors, sum(warnings) as warnings by \_timeslice|
|Windows|Event Distribution Over Time|Logs|Windows/Windows - Default - New|\_sourceCategory = Labs/Windows/OS/Windows (System or Security or Application) Win32\_NTLogEvent<br />\| parse "Logfile = \\"\*\\";" as \_sourceName<br />\| if(\_sourceName="System",1,0) as system <br />\| if(\_sourceName="Application",1,0) as application<br />\| if(\_sourceName="Security",1,0) as security<br />\| timeslice by 1h <br />\| sum(system) as System, sum(application) as application, sum(security) as security by \_timeslice<br />\| sort by \_timeslice asc|
|Windows/User Activity|Failed Logins Over time|Logs|Windows/User Activity/Failed Logins Over time|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4625 or 4771) ("EventCode = 4625;" or "EventCode = 4771;")<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logon Type:\\s+(?\<logon\_type\>\\d+)\*" nodrop \| parse regex "Failure Information:\\s+Failure Reason:\\s+(?\<fail\_reason\>[^.\\r]+?)[.\\r]" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop<br />\| fields host, event\_id, msg\_summary, src\_user, src\_ip, src\_port, src\_domain, dest\_user, dest\_domain, fail\_reason, logon\_type<br />\| where event\_id in ("4625", "4771")<br />\| timeslice by 1h<br />\| count by \_timeslice|
|Windows/Updates|Failed Updates by Host|Logs|Windows/Updates/Failed Updates by Host|\_sourceCategory = Labs/Windows/OS/Windows "Installation Failure" and ("Content Install" or "EventCode = 20" or \_sourceName=\*WindowsUpdate.log)<br />\| parse regex "\\d{4}-\\d{2}-\\d{2}\\s+\\d{2}:\\d{2}:\\d{2}:\\d+\\s+(?\<process\_id\>\\S\*)\\s+(?\<thread\_id\>\\S\*)\\s+(?\<component\>\\S\*).\*[^a-zA-Z0-9](?\<kbnum\>(?:kb\|KB)\\d+)\\D" nodrop<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as errorCode, Update nodrop \| parse field=update "(\*)." as kbnum nodrop<br />\| where (component="Report" or Update != "")<br />\| count by \_sourceHost|
|Windows/Updates|Failed Updates by KB Number|Logs|Windows/Updates/Failed Updates by KB Number|\_sourceCategory = Labs/Windows/OS/Windows "Installation Failure" and ("Content Install" or "EventCode = 20" or \_sourceName=\*WindowsUpdate.log)<br />\| parse regex "\\d{4}-\\d{2}-\\d{2}\\s+\\d{2}:\\d{2}:\\d{2}:\\d+\\s+(?\<process\_id\>\\S\*)\\s+(?\<thread\_id\>\\S\*)\\s+(?\<component\>\\S\*).\*[^a-zA-Z0-9](?\<kbnum\>(?:kb\|KB)\\d+)\\D" nodrop<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as errorCode, Update nodrop \| parse field=update "(\*)." as kbnum nodrop<br />\| where (kbnum matches "KB\*" or kbnum matches "kb\*")<br />\| where (component="Report" or Update != "")<br />\| count by kbnum|
|Windows/Security Status|Firewall Changes|Logs|Windows/Security Status/Firewall Changes|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4946 or 4947 or 4948) ("EventCode = 4946;" or "EventCode = 4947;" or "EventCode = 4948;")<br />\| parse "EventCode = \*;" as event\_id<br />\| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)(?:\\r\|\\.;)" nodrop<br />\| where event\_id in ("4946","4947","4948")|
|Windows/User Activity|Multiple Failed Logins by Same User|Logs|Windows/User Activity/Multiple Failed Logins by Same User|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4771 or 4776 or 4768 or 4625) ("EventCode = 4771;" or "EventCode = 4776;" or "EventCode = 4768;" or "EventCode = 4625;")<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop \| parse regex "Logon Type:\\s+(?\<logon\_type\>\\d+)\*" nodrop \| parse regex "Failure Information:\\s+Failure Reason:\\s+(?\<fail\_reason\>[^.\\r]+?)[.\\r]" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop \| parse regex "Result Code:\\s+(?\<result\_code\>[^\\r]+)\\r" nodrop \| parse regex "Failure Code:\\s+(?\<failure\_code\>[^\\r]+)\\r" nodrop \| parse regex "Logon Account:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Source Workstation:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Error Code:\\s+(?\<error\_code\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse regex "Logon Account:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Source Workstation:\\s\*\\r[\\s\\S]+?Error Code:\\s+(?\<error\_code\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse "Type = \\"\*\\";" as type<br />\| fields host, event\_id, msg\_summary, src\_user, src\_ip, src\_port, src\_domain, dest\_user, dest\_domain, fail\_reason, logon\_type, result\_code, failure\_code, src\_host, error\_code, type<br />\| where event\_id="4771" or (event\_id="4768" and result\_code !="0x0") or (event\_id="4776" and error\_code !="0x0") or event\_id="4625"<br />\| count by src\_user, dest\_user \| where \_count \> 3 \| sort by \_count|
|Windows/User Activity|Multiple Failed Logins on Local Machine|Logs|Windows/User Activity/Multiple Failed Logins on Local Machine|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4625 "EventCode = 4625;"<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logon Type:\\s+(?\<logon\_type\>\\d+)\*" nodrop \| parse regex "Failure Information:\\s+Failure Reason:\\s+(?\<fail\_reason\>[^.\\r]+?)[.\\r]" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop<br />\| fields host, event\_id, msg\_summary, src\_user, src\_ip, src\_port, src\_domain, dest\_user, dest\_domain, fail\_reason, logon\_type<br />\| where event\_id="4625"<br />\| count by dest\_user \| where \_count \> 3|
|Windows/User Activity|New Accounts Created|Logs|Windows/User Activity/New Accounts Created|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4720 "EventCode = 4720;"<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r]+?)\\r" nodrop<br />\| fields host, event\_id, msg\_summary, src\_user, dest\_user, src\_domain, dest\_domain<br />\| where event\_id="4720"|
|Windows/Security Status|Recent Policy Changes|Logs|Windows/Security Status/Recent Policy Changes|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4902 or 4904 or 4905 or 4906 or 4907 or 4912 or 4715 or 4719 or "Audit Policy Change" or "System audit policy was changed" or \*policy\*change\* or "Policy Change")<br />\| parse "EventCode = \*;" as event\_id nodrop<br />\| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+)\\r" nodrop<br />\| parse regex "CategoryString = \\"(?\<category\>[^\\"]+?)\\";[\\s\\S]+?Logfile = \\"Security\\"" nodrop<br />\| where (event\_id in ("4902", "4904", "4905", "4906", "4907", "4912", "4715", "4719") or msg\_summary="System audit policy was changed" or category matches "\*policy\*change\*" or category matches "\*Policy\*Change\*")|
|Windows|Recent Policy Changes|Logs|Windows/Windows - Overview - New|\_sourceCategory = Labs/Windows/OS/Windows (4902 or 4904 or 4905 or 4906 or 4907 or 4912 or 4715 or 4719 or "Audit Policy Change" or "System audit policy was changed" or \*policy\*change\* or "Policy Change")<br />\| parse "EventCode = \*;" as event\_id nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\.]+?)(?:\\r\|\\.\|\\";)" nodrop<br />\| parse regex "CategoryString = \\"(?\<category\>[^\\"]+?)\\";[\\s\\S]+?Logfile = \\"Security\\"" nodrop<br />\| where (event\_id in ("4902", "4904", "4905", "4906", "4907", "4912", "4715", "4719") or msg\_summary="System audit policy was changed" or category matches "\*policy\*change\*" or category matches "\*Policy\*Change\*")<br />\|where if ("{{event\_id}}" = "\*", true, event\_id matches "{{event\_id}}")<br />\|count by category, msg\_summary|
|Windows/Updates|Report Messages|Logs|Windows/Updates/Report Messages|\_sourceCategory = Labs/Windows/OS/Windows ("Report" or "EventCode = 19" or "EventCode = 20" or \_sourceName=\*WindowsUpdate.log)<br />\| parse regex "\\d{4}-\\d{2}-\\d{2}\\s+\\d{2}:\\d{2}:\\d{2}:\\d+\\s+(?\<process\_id\>\\S\*)\\s+(?\<thread\_id\>\\S\*)\\s+(?\<component\>\\S\*).\*[^a-zA-Z0-9](?\<kbnum\>(?:kb\|KB)\\d+)\\D" nodrop<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as errorCode, Update nodrop \| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop \| parse field=update "(\*)." as kbnum nodrop<br />\| where (component="Report" or Update != "")|
|Windows/System Activity|Service Events by Type|Logs|Windows/System Activity/Service Events by Type|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=System "Service Control Manager"<br />\| parse "Type = \\"\*\\";" as msg\_type nodrop \| parse "SourceName = \\"\*\\";" as event\_source nodrop<br />\| where event\_source="Service Control Manager"<br />\| count by msg\_type|
|Windows/System Activity|Service Installed|Logs|Windows/System Activity/Service Installed|\_sourceCategory = Labs/Windows/OS/Windows ((\_sourceName=System and "EventCode = 7045") or (\_sourceName=Security and "EventCode = 4697"))<br />\| parse "EventCode = \*;" as event\_id nodrop<br />\| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\.]+?)(?:\\r\|\\.\|\\";)" nodrop<br />\| parse regex "Service Name:\\s+(?\<service\_name\>[^\\r]+?)\\r[\\s\\S]+?Service File Name:\\s+(?:\\"\|\\s\*)(?\<service\_filename\>[^\\"\\r]+?)(?:\\"\|\\r)[\\s\\S]+?Service Type:\\s+(?\<service\_type\>[^\\r]+?)\\r[\\s\\S]+?Service Start Type:\\s+(?\<service\_start\_type\>[^\\r]+)\\r[\\s\\S]+?Service Account:\\s+(?\<service\_account\>[^\\"]+)\\";" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r" nodrop<br />\| where event\_id in ("4697", "7045")|
|Windows/System Activity|Service Starts|Logs|Windows/System Activity/Service Starts|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=System 7036 "running state" "EventCode = 7036;"<br />\| parse "EventCode = \*;" as event\_id nodrop<br />\| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\.]+?)(?:\\r\|\\.\|\\";)" nodrop<br />\| parse regex field=msg\_summary "The (?\<service\_name\>\\w.+?) service entered the (?\<service\_state\>\\w+) state" nodrop<br />\| where event\_id="7036"<br />\| fields host, event\_id, service\_name, service\_state|
|Windows/System Activity|Service Stops|Logs|Windows/System Activity/Service Stops|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=System 7036 "stopped state" "EventCode = 7036;"<br />\| parse "EventCode = \*;" as event\_id nodrop<br />\| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\.]+?)(?:\\r\|\\.\|\\";)" nodrop<br />\| parse regex field=msg\_summary "The (?\<service\_name\>\\w.+?) service entered the (?\<service\_state\>\\w+) state" nodrop<br />\| where event\_id="7036"<br />\| fields host, event\_id, service\_name, service\_state|
|Windows/User Activity|Successful Group Creations|Logs|Windows/User Activity/Successful Group Creations|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4727 or 4731 or 4754) ("EventCode = 4727;" or "EventCode = 4731;" or "EventCode = 4754;")<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject:[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?(?:New\|Deleted\|\\s\*)\\s\*Group:[\\s\\S]+?(?:Account\|Group) Name:\\s+(?\<group\_name\>[^\\r\\"]+?)\\r\\s+?(?:Account\|Group) Domain:\\s+(?\<group\_domain\>[^\\r\\"]+?)(?:\\r\|\\")" nodrop<br />\| where event\_id in ("4727", "4731", "4754")<br />\| fields host, event\_id, msg\_summary, src\_user, src\_domain, group\_name, group\_domain|
|Windows/User Activity|Successful Logons Over time|Logs|Windows/User Activity/Successful Logons Over time|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4624 "EventCode = 4624;"<br />\| parse "EventCode = \*;" as event\_id \| parse "Computer = \\"\*\\";" as comp\_name nodrop \| parse "ComputerName = \\"\*\\";" as comp\_name nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop<br />\| where event\_id="4624" and (src\_user!="" or dest\_user!="") <br />\| timeslice by 1d \| count by \_timeslice|
|Windows/Updates|Successful Updates by Host|Logs|Windows/Updates/Successful Updates by Host|\_sourceCategory = Labs/Windows/OS/Windows "Installation Successful" and ("Content Install" or "EventCode = 19" or \_sourceName=\*WindowsUpdate.log)<br />\| parse regex "\\d{4}-\\d{2}-\\d{2}\\s+\\d{2}:\\d{2}:\\d{2}:\\d+\\s+(?\<process\_id\>\\S\*)\\s+(?\<thread\_id\>\\S\*)\\s+(?\<component\>\\S\*).\*[^a-zA-Z0-9](?\<kbnum\>(?:kb\|KB)\\d+)\\D" nodrop<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop \| parse field=update "(\*)" as kbnum nodrop<br />\| where (component="Report" or Update != "")<br />\| count by \_sourceHost|
|Windows/Updates|Successful Updates by KB number|Logs|Windows/Updates/Successful Updates by KB number|\_sourceCategory = Labs/Windows/OS/Windows "Installation Successful" and ("Content Install" or "EventCode = 19" or \_sourceName=\*WindowsUpdate.log)<br />\| parse regex "\\d{4}-\\d{2}-\\d{2}\\s+\\d{2}:\\d{2}:\\d{2}:\\d+\\s+(?\<process\_id\>\\S\*)\\s+(?\<thread\_id\>\\S\*)\\s+(?\<component\>\\S\*).\*[^a-zA-Z0-9](?\<kbnum\>(?:kb\|KB)\\d+)\\D" nodrop<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop \| parse field=update "(\*)" as kbnum nodrop<br />\| where (kbnum matches "KB\*" or kbnum matches "kb\*")<br />\| where (component="Report" or Update != "")<br />\| count by kbnum|
|Windows|System Operations|Logs|Windows/Windows - Default - New|\_sourceCategory = Labs/Windows/OS/Windows  Security (4608 or 4946 or 4947 or 4948 or 4727 or 4731 or 4754 or 4720)<br />\| parse "EventCode = \*;" as event\_id<br />\| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop<br />\| "" as operation<br />\| if(event\_id="4608","Restarts",operation) as operation  <br />\| if(event\_id in ("4946", "4947", "4948"),"Firewall Changes",operation) as operation <br />\| if(event\_id in ("4727", "4731", "4754"),"Groups Created",operation) as operation<br />\| if(event\_id="4720","Users Created",operation) as operation<br />\| where operation != ""<br />\|where if ("{{event\_id}}" = "\*", true, event\_id matches "{{event\_id}}")<br />\|count as count by operation, host <br />\| transpose row host column operation|
|Windows/System Activity|System Restarted|Logs|Windows/System Activity/System Restarted|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4608 "EventCode = 4608;"<br />\| parse "EventCode = \*;" as event\_id nodrop<br />\| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\.]+?)(?:\\r\|\\.\|\\";)" nodrop<br />\| where event\_id="4608"|
|Windows|System Restarts|Logs|Windows/Windows - Overview - New|\_sourceCategory = Labs/Windows/OS/Windows 4608 "EventCode = 4608;"<br />\| parse "EventCode = \*;" as event\_id<br />\| where event\_id="4608"<br />\|where if ("{{event\_id}}" = "\*", true, event\_id matches "{{event\_id}}")<br />\|count as Restarts|
|Windows|Top 10 Service Operations|Logs|Windows/Windows - Default - New|\_sourceCategory = Labs/Windows/OS/Windows Service Control Manager 7036 "service entered"<br />\| parse "EventCode = \*;" as event\_id nodrop<br />\| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop<br />\| parse regex "Message = \\"The (?\<service\>\\w.+?) service entered the (?\<state\>\\w+) state"<br />\| where event\_id="7036"<br />\| if(state="running", 1, 0) as starts<br />\| if(state="stopped",1,0) as stops<br />\|where if ("{{service}}" = "\*", true, service matches "{{service}}") AND if ("{{state}}" = "\*", true, state matches "{{state}}") AND if ("{{event\_id}}" = "\*", true, event\_id matches "{{event\_id}}")<br />\|sum(starts) as starts, sum(stops) as stops by service, host<br />\| sort by stops, starts<br />\| limit 10|
|Windows/Updates|Top Error Codes|Logs|Windows/Updates/Top Error Codes|\_sourceCategory = Labs/Windows/OS/Windows (AutomaticUpdates or Report or "EventCode = 19" or "EventCode = 20" or \_sourceName=\*WindowsUpdate.log)<br />\| parse regex "\\d{4}-\\d{2}-\\d{2}\\s+\\d{2}:\\d{2}:\\d{2}:\\d+\\s+(?\<process\_id\>\\S\*)\\s+(?\<thread\_id\>\\S\*)\\s+(?\<component\>\\S\*).\*[^a-zA-Z0-9](?\<kbnum\>(?:kb\|KB)\\d+)\\D" nodrop \| parse regex "\\d{4}-\\d{2}-\\d{2}\\s+\\d{2}:\\d{2}:\\d{2}:\\d+\\s+(?\<process\_id\>\\S\*)\\s+(?\<thread\_id\>\\S\*)\\s+(?\<component\>\\S\*).\*(?:\\s+0x\|hr\\s=\\s)(?\<errorcode\>[0-9a-fA-F]+)" nodrop<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as errorCode, Update nodrop \| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop \| parse field=update "(\*)." as kbnum nodrop<br />\| where (component="Report" or update !="") and errorcode!="" <br />\| count by errorcode <br />\| top 10 errorcode by \_count, errorcode|
|Windows/System Activity|Top Reasons for Failed Logins|Logs|Windows/System Activity/Top Reasons for Failed Logins|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4625 "EventCode = 4625;"<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logon Type:\\s+(?\<logon\_type\>\\d+)\*" nodrop \| parse regex "Failure Information:\\s+Failure Reason:\\s+(?\<fail\_reason\>[^.\\r]+?)[.\\r]" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r" nodrop \| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)\\r" nodrop<br />\| where event\_id="4625" <br />\| count by host, fail\_reason<br />\| top 10 fail\_reason, host by \_count|
|Windows/Security Status|Top Security Events|Logs|Windows/Security Status/Top Security Events|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security<br />\| parse "EventCode = \*;" as event\_id<br />\| count by event\_id <br />\| sort by \_count|
|Windows|Top Windows Update Error Codes|Logs|Windows/Windows - Overview - New|\_sourceCategory = Labs/Windows/OS/Windows (AutomaticUpdates or Report or "EventCode = 19" or "EventCode = 20" or \_sourceName=\*WindowsUpdate.log)<br />\| parse regex "\\d{4}-\\d{2}-\\d{2}\\s+\\d{2}:\\d{2}:\\d{2}:\\d+\\s+(?\<process\_id\>\\S\*)\\s+(?\<thread\_id\>\\S\*)\\s+(?\<component\>\\S\*).\*[^a-zA-Z0-9](?\<kbnum\>(?:kb\|KB)\\d+)\\D" nodrop \| parse regex "\\d{4}-\\d{2}-\\d{2}\\s+\\d{2}:\\d{2}:\\d{2}:\\d+\\s+(?\<process\_id\>\\S\*)\\s+(?\<thread\_id\>\\S\*)\\s+(?\<component\>\\S\*).\*(?:\\s+0x\|hr\\s=\\s)(?\<errorcode\>[0-9a-fA-F]+)" nodrop<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as errorCode, Update nodrop \| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop \| parse field=update "(\*)." as kbnum nodrop<br />\| where (component="Report" or update !="") and errorcode!=""<br />\|where if ("{{event\_id}}" = "\*", true, event\_id matches "{{event\_id}}")<br />\|count as error\_count by errorcode <br />\| top 10 errorcode by error\_count|
|Windows/User Activity|Unauthorized Account Creations|Logs|Windows/User Activity/Unauthorized Account Creations|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4720 "EventCode = 4720;"<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r]+?)\\r" nodrop<br />\| fields host, event\_id, msg\_summary, src\_user, dest\_user, src\_domain, dest\_domain<br />\| where event\_id="4720" <br />\| where src\_user not in ("Admin1", "Admin2")|
|Windows/Updates|Update Results by KB number|Logs|Windows/Updates/Update Results by KB number|\_sourceCategory = Labs/Windows/OS/Windows AutomaticUpdates (AutomaticUpdates or Report or "EventCode = 19" or "EventCode = 20" or \_sourceName=\*WindowsUpdate.log)<br />\| parse regex "\\d{4}-\\d{2}-\\d{2}\\s+\\d{2}:\\d{2}:\\d{2}:\\d+\\s+(?\<process\_id\>\\S\*)\\s+(?\<thread\_id\>\\S\*)\\s+(?\<component\>\\S\*).\*[^a-zA-Z0-9](?\<update\_result\>(?:Success\|Failure)).\*[^a-zA-Z0-9](?\<kbnum\>(?:kb\|KB)\\d+)\\D" nodrop<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop \| parse field=msg\_summary "Installation Failure: Windows failed to install the following update with error \*: \*" as errorCode, Update nodrop \| parse field=msg\_summary "Installation Successful: Windows successfully installed the following update: \*" as Update nodrop \| parse field=update "(\*)" as kbnum nodrop \| parse field=msg\_summary "Installation \*: " as update\_result nodrop<br />\| if (update\_result matches "Success\*", "Success", "Failure") as update\_result<br />\| where (kbnum matches "KB\*" or kbnum matches "kb\*")<br />\| where (component="Report" or update !="")<br />\| count by kbnum, update\_result|
|Windows/User Activity|User Account Changed|Logs|Windows/User Activity/User Account Changed|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4738 "EventCode = 4738;"<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r]+?)\\r" nodrop \| parse regex "Changed Attributes:\\s+(?\<changedAttributes\>[\\s\\S]\*?)Additional Information:"<br />\| fields host, event\_id, msg\_summary, src\_user, dest\_user, src\_domain, dest\_domain, changedAttributes<br />\| where event\_id="4738"|
|Windows/User Activity|User Account Deleted|Logs|Windows/User Activity/User Account Deleted|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4726 "EventCode = 4726;"<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r]+?)\\r" nodrop<br />\| fields host, event\_id, msg\_summary, src\_user, dest\_user, src\_domain, dest\_domain<br />\| where event\_id="4726"|
|Windows/User Activity|User Added to Administrative Groups|Logs|Windows/User Activity/User Added to Administrative Groups|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4728 or 4732 or 4746 or 4751 or 4756 or 4761) ("EventCode = 4728;" or "EventCode = 4732;" or "EventCode = 4746;" or "EventCode = 4751;" or "EventCode = 4756;" or "EventCode = 4761;" )<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject:[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r\\"]+?)\\r[\\s\\S]+?(?:New\|Deleted) Group:[\\s\\S]+?(?:Account\|Group) Name:\\s+(?\<group\_name\>[^\\r\\"]+?)\\r\\s+?(?:Account\|Group) Domain:\\s+(?\<group\_domain\>[^\\r\\"]+?)(?:\\r\|\\")" nodrop <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r" nodrop <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject:[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Member:[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r\\"]+?)\\r[\\s\\S]+?Group:[\\s\\S]+?(?:Account\|Group) Name:\\s+(?\<group\_name\>[^\\r\\"]+?)\\r\\s+?(?:Account\|Group) Domain:\\s+(?\<group\_domain\>[^\\r\\"]+?)(?:\\r\|\\")" nodrop <br />\| where event\_id in ("4728", "4732", "4746", "4751", "4756", "4761")<br />\| where group\_name in ("Administrators", "Domain Admins", "Schema Admins", "Server Operators", "Account Operators", "Backup Operators")<br />\| fields host, event\_id, msg\_summary, src\_user, dest\_user, src\_domain, group\_name, group\_domain|
|Windows/User Activity|User Added to Group|Logs|Windows/User Activity/User Added to Group|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4728 or 4732 or 4746 or 4751 or 4756 or 4761) ("EventCode = 4728;" or "EventCode = 4732;" or "EventCode = 4746;" or "EventCode = 4751;" or "EventCode = 4756;" or "EventCode = 4761;" )<br />\| parse "EventCode = \*;" as event\_id nodrop \| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop \| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject:[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r\\"]+?)\\r[\\s\\S]+?(?:New\|Deleted) Group:[\\s\\S]+?(?:Account\|Group) Name:\\s+(?\<group\_name\>[^\\r\\"]+?)\\r\\s+?(?:Account\|Group) Domain:\\s+(?\<group\_domain\>[^\\r\\"]+?)(?:\\r\|\\")" nodrop <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r\\"]+?)\\r" nodrop <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Subject:[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Member:[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r\\"]+?)\\r[\\s\\S]+?Group:[\\s\\S]+?(?:Account\|Group) Name:\\s+(?\<group\_name\>[^\\r\\"]+?)\\r\\s+?(?:Account\|Group) Domain:\\s+(?\<group\_domain\>[^\\r\\"]+?)(?:\\r\|\\")" nodrop <br />\| where event\_id in ("4728", "4732", "4746", "4751", "4756", "4761")<br />\| fields host, event\_id, msg\_summary, src\_user, dest\_user, src\_domain, group\_name, group\_domain|
|Windows/User Activity|User Locked-out|Logs|Windows/User Activity/User Locked-out|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security (4740 or 644)<br />\| parse "EventCode = \*;" as event\_id nodrop<br />\| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop   <br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r" nodrop<br />\| fields host, event\_id, msg\_summary, src\_user, src\_domain, dest\_user<br />\| where event\_id in ("4740", "644")|
|Windows/User Activity|User Password Changes|Logs|Windows/User Activity/User Password Changes|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4723 "EventCode = 4723;"<br />\| parse "EventCode = \*;" as event\_id nodrop<br />\| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+?)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+?)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r]+?)\\r" nodrop<br />\| where event\_id="4723"<br />\| fields host, event\_id, msg\_summary, src\_user, dest\_user, src\_domain, dest\_domain<br />\| timeslice by 1d<br />\| count by \_timeslice<br />\| sort by \_timeslice|
|Windows/User Activity|User Password Reset Attempts|Logs|Windows/User Activity/User Password Reset Attempts|\_sourceCategory = Labs/Windows/OS/Windows \_sourceName=Security 4724 "EventCode = 4724;"<br />\| parse "EventCode = \*;" as event\_id nodrop<br />\| parse "Computer = \\"\*\\";" as host nodrop \| parse "ComputerName = \\"\*\\";" as host nodrop<br />\| parse regex "Message = \\"(?\<msg\_summary\>[^\\r]+?)\\r" nodrop<br />\| parse regex "Logfile = \\"Security\\";[\\s\\S]+?Account Name:\\s+(?\<src\_user\>[^\\r]+)\\r[\\s\\S]+?Account Domain:\\s+(?\<src\_domain\>[^\\r]+)\\r[\\s\\S]+?Account Name:\\s+(?\<dest\_user\>[^\\r]+)\\r[\\s\\S]+?Account Domain:\\s+(?\<dest\_domain\>[^\\r\\"]+?)(?:\\r\|\\";)" nodrop<br />\| where event\_id="4724"<br />\| fields host, event\_id, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain|

