# Active Directory 2012+ - OpenTelemetry

## Searches

### Log Searches

- **Admin Activity by Category**: from Dashboard: Installed Apps/Active Directory 2012+ - OpenTelemetry/Active Directory Service Failures 
- **All Failures by IP**: from Dashboard: Installed Apps/Active Directory 2012+ - OpenTelemetry/Active Directory Service Failures 
- **Audit Failures Over Time**: from Dashboard: Active Directory 2012+ - OpenTelemetry/Active Directory Service Failures 
- **Audit Failures Over Time**: from Dashboard: Installed Apps/Active Directory 2012+ - OpenTelemetry/Active Directory Service Failures 
- **Category Over Time**: from Dashboard: Active Directory 2012+ - OpenTelemetry/Active Directory Service Activity 
- **Category Over Time**: from Dashboard: Installed Apps/Active Directory 2012+ - OpenTelemetry/Active Directory Service Activity 
- **Logon/off Activity**: from Dashboard: Installed Apps/Active Directory 2012+ - OpenTelemetry/Active Directory Service Activity 
- **Object Creation**: from Dashboard: Active Directory 2012+ - OpenTelemetry/Active Directory Service Activity 
- **Object Creation**: from Dashboard: Installed Apps/Active Directory 2012+ - OpenTelemetry/Active Directory Service Activity 
- **Object Deletion**: from Dashboard: Installed Apps/Active Directory 2012+ - OpenTelemetry/Active Directory Service Activity 
- **Rights Management**: from Dashboard: Installed Apps/Active Directory 2012+ - OpenTelemetry/Active Directory Service Activity 
- **Successes vs Failures**: from Dashboard: Active Directory 2012+ - OpenTelemetry/Active Directory Service Failures 
- **Successes vs Failures**: from Dashboard: Installed Apps/Active Directory 2012+ - OpenTelemetry/Active Directory Service Failures 
- **Top 10 Messages**: from Dashboard: Active Directory 2012+ - OpenTelemetry/Active Directory Service Activity 
- **Top 10 Messages**: from Dashboard: Installed Apps/Active Directory 2012+ - OpenTelemetry/Active Directory Service Activity

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Active Directory 2012+ - OpenTelemetry|Admin Activity by Category|Logs|Installed Apps/Active Directory 2012+ - OpenTelemetry/Active Directory Service Failures|sumo.datasource=windows  Task <br />\| json "computer", "message", "keywords", "event\_data", "channel", "task" as  host, msg\_summary, Keywords, event\_data, channel, task nodrop<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| parse field=event\_data "\\"SubjectUserName\\":\\"\*\\"" as src\_user<br />\| parse field=event\_data "\\"TargetUserName\\":\\"\*\\"" as dest\_user<br />\| where (src\_user matches "Administrator\*" or dest\_user matches "Administrator\*") and host matches "{{host.name}}"<br />\| count by task, Keywords, msg\_summary<br />\| topk(10, \_count) by task \| fields -\_rank|
|Active Directory 2012+ - OpenTelemetry|All Failures by IP|Logs|Installed Apps/Active Directory 2012+ - OpenTelemetry/Active Directory Service Failures|sumo.datasource=windows  ("fatal" or "failure" or "error" or "Audit Failure") <br />\| json "event\_id", "computer", "keywords", "event\_data" as event\_id, host, Keywords, event\_data nodrop<br />\| parse field=event\_data "\\"IpAddress\\":\\"\*\\"" as src\_ip<br />\| where !jsonArrayContains(Keywords, "Audit Success") and !isEmpty(src\_ip) and src\_ip != "-" and host matches "{{host.name}}"<br />\| count by src\_ip<br />\| top 10 src\_ip by \_count|
|Active Directory 2012+ - OpenTelemetry|Audit Failures Over Time|Logs|Active Directory 2012+ - OpenTelemetry/Active Directory Service Failures|sumo.datasource=activeDirectory  "\\"keywords\\":\\"Audit Failure\\""<br />\| json "event\_id", "computer", "keywords" as event\_id, host.name, keywords nodrop<br />\| json field=event\_id "id" as event\_id<br />\| where keywords = "Audit Failure" and host.name matches "\*"<br />\| timeslice 1h<br />\| count as failures by \_timeslice, event\_id<br />\| transpose row \_timeslice column event\_id|
|Active Directory 2012+ - OpenTelemetry|Audit Failures Over Time|Logs|Installed Apps/Active Directory 2012+ - OpenTelemetry/Active Directory Service Failures|sumo.datasource=windows  "Audit Failure"<br />\| json "event\_id", "computer", "keywords" as event\_id, host.name, keywords nodrop<br />\| json field=event\_id "id" as event\_id<br />\| where jsonArrayContains(keywords, "Audit Failure") and host.name matches "{{host.name}}"<br />\| timeslice 1h<br />\| count as failures by \_timeslice, event\_id<br />\| transpose row \_timeslice column event\_id|
|Active Directory 2012+ - OpenTelemetry|Category Over Time|Logs|Active Directory 2012+ - OpenTelemetry/Active Directory Service Activity|sumo.datasource=activeDirectory <br />\| json "event\_id", "computer", "message", "task" as event\_id, host.name, msg\_summary, task nodrop<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| where host.name matches "{{host.name}}"<br />\| timeslice 1h<br />\| count by \_timeslice, task<br />\| transpose row \_timeslice column task|
|Active Directory 2012+ - OpenTelemetry|Category Over Time|Logs|Installed Apps/Active Directory 2012+ - OpenTelemetry/Active Directory Service Activity|sumo.datasource=windows <br />\| json "event\_id", "computer", "message", "task" as event\_id, host.name, msg\_summary, task nodrop<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| where host.name matches "{{host.name}}"<br />\| timeslice 1h<br />\| count by \_timeslice, task<br />\| transpose row \_timeslice column task|
|Active Directory 2012+ - OpenTelemetry|Logon/off Activity|Logs|Installed Apps/Active Directory 2012+ - OpenTelemetry/Active Directory Service Activity|sumo.datasource=windows<br />\| json "event\_id", "computer", "event\_data", "channel", "message"  as event\_id, host, event\_data,  channel, msg\_summary nodrop<br />\| json field=event\_id "id" as event\_id<br />\| parse field=event\_data "\\"LogonType\\":\\"\*\\"" as logon\_type<br />\| where event\_id in ("4624", "4634") and channel = "Security" and host matches "{{host.name}}"<br />\| if (logon\_type = "2", "interactive", if (logon\_type = "3", "network", if (logon\_type = "4", "batch", if (logon\_type = "5", "service", if (logon\_type = "7", "unlock", if (logon\_type = "8", "networkcleartext", if (logon\_type = "9", "newcredentials", if (logon\_type = "10", "remoteinteractive", if (logon\_type = "11", "cachedinteractive", "" ))))))))) as type<br />\| if (event\_id = "4624", "logon", "logged off") as addonstr<br />\| concat (type, " ", addonstr) as type<br />\| where type != ""<br />\| timeslice 1h<br />\| count by \_timeslice, type<br />\| transpose row \_timeslice column type|
|Active Directory 2012+ - OpenTelemetry|Object Creation|Logs|Active Directory 2012+ - OpenTelemetry/Active Directory Service Activity|sumo.datasource=activeDirectory  "\\"Channel\\":\\"Security\\"" (4720 or 4741 or 4727 or 4731 or 4744 or 4749 or 4754 or 4759 or 4783 or 5137 or 4902 or 4790) <br />\| json "event\_id", "computer", "message" as event\_id, host.name, msg\_summary nodrop<br />\| json field=event\_id "id" as event\_id<br />\| if ((event\_id in ("4720")), "user", "") as object\_created<br />\| if ((event\_id in ("4720", "4741")), "computer", "") as object\_created<br />\| if ((event\_id in ("4727", "4731", "4744", "4749", "4754", "4759", "4783")), "group", object\_created) as object\_created<br />\| if ((event\_id in ("5137", "4902", "4790")), "object", object\_created) as object\_created<br />\| where object\_created != "" and host.name matches "{{host.name}}"<br />\| timeslice 1h<br />\| count by object\_created, \_timeslice<br />\| transpose row \_timeslice column object\_created<br />\| fillmissing timeslice(1h)|
|Active Directory 2012+ - OpenTelemetry|Object Creation|Logs|Installed Apps/Active Directory 2012+ - OpenTelemetry/Active Directory Service Activity|sumo.datasource=windows  "\\"Channel\\":\\"Security\\"" (4720 or 4741 or 4727 or 4731 or 4744 or 4749 or 4754 or 4759 or 4783 or 5137 or 4902 or 4790) <br />\| json "event\_id", "computer", "message" as event\_id, host.name, msg\_summary nodrop<br />\| json field=event\_id "id" as event\_id<br />\| if ((event\_id in ("4720")), "user", if ((event\_id in ("4720", "4741")), "computer", if ((event\_id in ("4727", "4731", "4744", "4749", "4754", "4759", "4783")), "group", if ((event\_id in ("5137", "4902", "4790")), "object", "")))) as object\_created<br />\| where object\_created != "" and host.name matches "{{host.name}}"<br />\| timeslice 1h<br />\| count by object\_created, \_timeslice<br />\| transpose row \_timeslice column object\_created<br />\| fillmissing timeslice(1h)|
|Active Directory 2012+ - OpenTelemetry|Object Deletion|Logs|Installed Apps/Active Directory 2012+ - OpenTelemetry/Active Directory Service Activity|sumo.datasource=windows (4726 or 4743 or 4730 or 4734 or 4748 or 4753 or 4758 or 4763 or 4789 or 4659 or 4660 or 5141)  <br />\| json "event\_id", "computer", "message", "channel" as event\_id, host, msg\_summary, channel nodrop<br />\| json field=event\_id "id" as event\_id<br />\| if ((event\_id in ("4726")), "user", if ((event\_id in ("4743")), "computer", if ((event\_id in ("4730", "4734", "4748", "4753", "4758", "4763", "4789")), "group", if ((event\_id in ("4659", "4660", "5141")), "object", "") ))) as object\_deleted<br />\| where object\_deleted != "" and host matches "{{host.name}}"<br />\| timeslice 1h<br />\| count by object\_deleted, \_timeslice<br />\| transpose row \_timeslice column object\_deleted<br />\| fillmissing timeslice(1h)|
|Active Directory 2012+ - OpenTelemetry|Rights Management|Logs|Installed Apps/Active Directory 2012+ - OpenTelemetry/Active Directory Service Activity|sumo.datasource=windows <br />\| json "event\_id", "computer" as event\_id, host nodrop<br />\| json field=event\_id "id" as event\_id<br />\| where event\_id in ("4704", "4705") and host matches "{{host.name}}"<br />\| if ((event\_id = "4704"), "assigned", if ((event\_id = "4705"), "removed", "")) as right<br />\| timeslice 1h<br />\| count by right, \_timeslice<br />\| transpose row \_timeslice column right<br />\| fillmissing timeslice(1h) |
|Active Directory 2012+ - OpenTelemetry|Successes vs Failures|Logs|Active Directory 2012+ - OpenTelemetry/Active Directory Service Failures|sumo.datasource=activeDirectory  keywords<br />\| json "event\_id", "computer", "keywords" as event\_id, host.name, keywords nodrop<br />\| if (keywords = "Audit Failure", "Failure", "Success") as status<br />\| where host.name matches "{{host.name}}"<br />\| timeslice 1h<br />\| count as EventCount by  status, \_timeslice<br />\| transpose row \_timeslice column status|
|Active Directory 2012+ - OpenTelemetry|Successes vs Failures|Logs|Installed Apps/Active Directory 2012+ - OpenTelemetry/Active Directory Service Failures|sumo.datasource=windows  keywords<br />\| json  "computer", "keywords" as host.name, keywords nodrop<br />\| if (jsonArrayContains(keywords, "Audit Failure"), "Failure", "Success") as status<br />\| where host.name matches "{{host.name}}"<br />\| timeslice 1h<br />\| count as EventCount by  status, \_timeslice<br />\| transpose row \_timeslice column status|
|Active Directory 2012+ - OpenTelemetry|Top 10 Messages|Logs|Active Directory 2012+ - OpenTelemetry/Active Directory Service Activity|sumo.datasource=activeDirectory <br />\| json "event\_id", "computer", "message" as event\_id, host.name, msg\_summary nodrop<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| where !isEmpty(msg\_summary)<br />\| where host.name matches "{{host.name}}"<br />\| count by msg\_summary <br />\| top 10 msg\_summary by \_count|
|Active Directory 2012+ - OpenTelemetry|Top 10 Messages|Logs|Installed Apps/Active Directory 2012+ - OpenTelemetry/Active Directory Service Activity|sumo.datasource=windows <br />\| json "event\_id", "computer", "message" as event\_id, host.name, msg\_summary nodrop<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| where !isEmpty(msg\_summary)<br />\| where host.name matches "{{host.name}}"<br />\| count by msg\_summary <br />\| top 10 msg\_summary by \_count|

