# Google Cloud Storage
## Sumo Logic App For: Google Cloud Storage
The Sumo Logic app for Google Cloud Storage helps you monitor activity in Google Cloud Storage. The preconfigured dashboards provide insight into request locations, bucket and object operations, user activities, errors, and bucket statistics.
Docs Link: [Google Cloud Storage](https://help.sumologic.com/?cid=22673)

## Searches

### Log Searches

- **Bucket Statistics**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Buckets 
- **Creations and Deletions**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Buckets 
- **Creations and Deletions by User**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Users 
- **Errors by User Over Time**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Users 
- **Google Cloud Storage - Bucket Operations**: from Search: Google Cloud Storage/Google Cloud Storage - Bucket Operations 
- **Google Cloud Storage - Bucket Operations**: from Search: Installed Apps/Google Cloud Storage/Google Cloud Storage - Bucket Operations 
- **Google Cloud Storage - User Operations**: from Search: Google Cloud Storage/Google Cloud Storage - User Operations 
- **Google Cloud Storage - User Operations**: from Search: Installed Apps/Google Cloud Storage/Google Cloud Storage - User Operations 
- **Location of Users**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Users 
- **Location of Users with Errors**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Users 
- **Operations**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Overview 
- **Operations by Bucket - Outlier**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Buckets 
- **Operations by Bucket Over Time**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Buckets 
- **Operations by Project**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Overview 
- **Operations by User - Outlier**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Users 
- **Operations Over Time**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Buckets 
- **Recent Errors by User**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Users 
- **Recent Object Policy Updates by User**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Users 
- **Request Location**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Buckets 
- **Request Location**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Overview 
- **Top 10 Buckets by Operations**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Overview 
- **Top 10 Locations by Operations**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Overview 
- **Top 10 Projects by Operations**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Overview 
- **Top 10 Users by Errors**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Users 
- **Top 10 Users by Operations**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Overview 
- **User Operations Over Time**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Users 
- **User Statistics**: from Dashboard: Installed Apps/Google Cloud Storage/Google Cloud Storage - Users

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Google Cloud Storage|Bucket Statistics|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Buckets|\_sourceCategory={{Logsdatasource}}  logName "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload.resourceName", "nullField" as labels, name, null nodrop<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| parse regex "\\"methodName\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\""<br />\| if (name matches "\*/objects/\*", name, null) as object\_name<br />\| if (method = "create", 1, 0) as create<br />\| if (method = "delete", 1, 0) as delete<br />\| if (method = "update", 1, 0) as update<br />\| if (method = "setIamPermissions", 1, 0) as setIam<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"<br />\|count as ops, count\_distinct(object\_name) as objects, sum(create) as create, sum(delete) as delete, sum(update) as update, sum(setIam) as setIam by bucket\_name, project<br />\| sort by ops|
|Google Cloud Storage|Creations and Deletions|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Buckets|\_sourceCategory={{Logsdatasource}}  data logName resource "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload.methodName" as labels, method<br />\| where method matches "\*create" or method matches "\*delete"<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| timeslice 1h<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"<br />\|count as operations by \_timeslice, method<br />\| transpose row \_timeslice column method<br />\| fillmissing timeslice(1h)|
|Google Cloud Storage|Creations and Deletions by User|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Users|\_sourceCategory={{Logsdatasource}}  logName principalEmail "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload.authenticationInfo.principalEmail" as labels, user<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| parse regex "\\"methodName\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\""<br />\| where method = "create" or method = "delete"<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"  AND user matches "{{User}}"<br />\|count as operations by user, method<br />\| transpose row user column method|
|Google Cloud Storage|Errors by User Over Time|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Users|\_sourceCategory={{Logsdatasource}}  logName resource severity principalEmail "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload.authenticationInfo.principalEmail", "message.data.severity" as labels, user, severity<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| if(severity in ("WARNING", "ERROR","CRITICAL", "ALERT", "EMERGENCY"), 1, 0) as error<br />\| timeslice 1h<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"  AND user matches "{{User}}"<br />\|sum(error) as errors by \_timeslice, user<br />\| transpose row \_timeslice column user <br />\| fillmissing timeslice(1h)|
|Google Cloud Storage|Google Cloud Storage - Bucket Operations|Logs|Google Cloud Storage/Google Cloud Storage - Bucket Operations|\_sourceCategory = Labs/GCP/storage logName principalEmail resource timestamp <br />\| json "message.data.resource.type" as type<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type="gcs\_bucket" and log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data" as data<br />\| json field=data "timestamp", "severity", "resource.labels", "resource.labels.project\_id", "resource.labels.bucket\_name", "protoPayload.methodName", "protoPayload.authenticationInfo.principalEmail" as timestamp, severity, labels, project, bucket, method, user<br />\| count as messages by timestamp, severity, project, bucket, method, user<br />\| sort by timestamp asc<br />\| 1 as operation<br />\| accum operation as operations by bucket<br />\| fields timestamp, bucket, project, user, method, severity, operations<br />\| sort by timestamp|
|Google Cloud Storage|Google Cloud Storage - Bucket Operations|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Bucket Operations|\_sourceCategory={{Logsdatasource}}  logName principalEmail resource timestamp <br />\| json "message.data.resource.type" as type<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type="gcs\_bucket" and log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data" as data<br />\| json field=data "timestamp", "severity", "resource.labels", "resource.labels.project\_id", "resource.labels.bucket\_name", "protoPayload.methodName", "protoPayload.authenticationInfo.principalEmail" as timestamp, severity, labels, project, bucket, method, user<br />\| count as messages by timestamp, severity, project, bucket, method, user<br />\| sort by timestamp asc<br />\| 1 as operation<br />\| accum operation as operations by bucket<br />\| fields timestamp, bucket, project, user, method, severity, operations<br />\| sort by timestamp|
|Google Cloud Storage|Google Cloud Storage - User Operations|Logs|Google Cloud Storage/Google Cloud Storage - User Operations|\_sourceCategory = Labs/GCP/storage logName principalEmail resource timestamp <br />\| json "message.data.resource.type" as type<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type="gcs\_bucket" and log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data" as data<br />\| json field=data "timestamp", "severity", "resource.labels", "resource.labels.project\_id", "resource.labels.bucket\_name", "protoPayload.methodName", "protoPayload.authenticationInfo.principalEmail" as timestamp, severity, labels, project, bucket, method, user<br />\| count as messages by timestamp, severity, project, bucket, method, user<br />\| sort by timestamp asc<br />\| 1 as operation<br />\| accum operation as operations by user<br />\| fields timestamp, user, project, bucket, method, severity, operations<br />\| sort by timestamp|
|Google Cloud Storage|Google Cloud Storage - User Operations|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - User Operations|\_sourceCategory={{Logsdatasource}}  logName principalEmail resource timestamp <br />\| json "message.data.resource.type" as type<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where type="gcs\_bucket" and log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data" as data<br />\| json field=data "timestamp", "severity", "resource.labels", "resource.labels.project\_id", "resource.labels.bucket\_name", "protoPayload.methodName", "protoPayload.authenticationInfo.principalEmail" as timestamp, severity, labels, project, bucket, method, user<br />\| count as messages by timestamp, severity, project, bucket, method, user<br />\| sort by timestamp asc<br />\| 1 as operation<br />\| accum operation as operations by user<br />\| fields timestamp, user, project, bucket, method, severity, operations<br />\| sort by timestamp|
|Google Cloud Storage|Location of Users|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Users|\_sourceCategory={{Logsdatasource}}  callerIp logName principalEmail "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload" as labels, payload<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| json field=payload "authenticationInfo.principalEmail", "requestMetadata.callerIp" as user, caller\_ip<br />\| lookup latitude, longitude from geo://location on ip=caller\_ip<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}" AND user matches "{{User}}"<br />\|count\_distinct(user) as \_count by latitude, longitude, user|
|Google Cloud Storage|Location of Users with Errors|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Users|\_sourceCategory={{Logsdatasource}}  callerIp logName principalEmail "\\"type\\":\\"gcs\_bucket\\"" ("\\"severity\\":\\"WARNING\\"" or "\\"severity\\":\\"ERROR\\"" or "\\"severity\\":\\"CRITICAL\\"" or "\\"severity\\":\\"ALERT\\"" or "\\"severity\\":\\"EMERGENCY\\"")<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload" as labels, payload<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| json field=payload "authenticationInfo.principalEmail", "requestMetadata.callerIp" as user, caller\_ip<br />\| lookup latitude, longitude from geo://location on ip=caller\_ip<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"  AND user matches "{{User}}"<br />\|count\_distinct(user) as \_count by latitude, longitude, user|
|Google Cloud Storage|Operations|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Overview|\_sourceCategory={{Logsdatasource}}  data logName resource "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload.methodName" as labels, method<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"<br />\|count as operations by method<br />\| sort by operations|
|Google Cloud Storage|Operations by Bucket - Outlier|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Buckets|\_sourceCategory={{Logsdatasource}}  data logName resource "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels" as labels<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| timeslice 1h<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"<br />\|count as operations by \_timeslice, project, bucket\_name<br />\| outlier operations by project, bucket\_name<br />\| fields \_timeslice, project, bucket\_name, operations\_violation<br />\| transpose row \_timeslice column project, bucket\_name|
|Google Cloud Storage|Operations by Bucket Over Time|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Buckets|\_sourceCategory={{Logsdatasource}}  data logName resource "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels" as labels<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| timeslice 1h<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"<br />\|count as operations by \_timeslice, project, bucket\_name<br />\| fillmissing timeslice(1h)<br />\| transpose row \_timeslice column bucket\_name, project|
|Google Cloud Storage|Operations by Project|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Overview|\_sourceCategory={{Logsdatasource}}  data logName resource "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels" as labels<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| timeslice 1h<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"<br />\|count as operations by \_timeslice, project<br />\| transpose row \_timeslice column project<br />\| fillmissing timeslice(1h)|
|Google Cloud Storage|Operations by User - Outlier|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Users|\_sourceCategory={{Logsdatasource}}  data logName principalEmail "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload.authenticationInfo.principalEmail" as labels, user<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| timeslice 1h<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"  AND user matches "{{User}}"<br />\|count as operations by \_timeslice, user<br />\| outlier operations by user<br />\| fields \_timeslice, user, operations\_violation<br />\| transpose row \_timeslice column user|
|Google Cloud Storage|Operations Over Time|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Buckets|\_sourceCategory={{Logsdatasource}}  data logName resource "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload.methodName" as labels, method<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| timeslice 1h<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"<br />\|count as operations by \_timeslice, method<br />\| transpose row \_timeslice column method|
|Google Cloud Storage|Recent Errors by User|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Users|\_sourceCategory={{Logsdatasource}}  logName principalEmail "\\"type\\":\\"gcs\_bucket\\"" ("\\"severity\\":\\"WARNING\\"" or "\\"severity\\":\\"ERROR\\"" or "\\"severity\\":\\"CRITICAL\\"" or "\\"severity\\":\\"ALERT\\"" or "\\"severity\\":\\"EMERGENCY\\"")<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload", "message.data.timestamp", "message.data.severity" as labels, payload, timestamp, severity<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| json field=payload "methodName", "authenticationInfo.principalEmail", "resourceName", "status.message" as method, user, resource, message nodrop<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"  AND user matches "{{User}}"<br />\|count as messages by timestamp, severity, user, message, method, resource<br />\| sort by timestamp asc<br />\| 1 as failure<br />\| accum failure as failures by user<br />\| fields timestamp, severity, user, message, method, resource, failures<br />\| sort by timestamp|
|Google Cloud Storage|Recent Object Policy Updates by User|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Users|\_sourceCategory={{Logsdatasource}}  logName principalEmail "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload.authenticationInfo.principalEmail" as labels, user<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| parse regex "\\"methodName\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\""<br />\| where method = "update"<br />\| json "message.data.protoPayload.serviceData.policyDelta" as policy\_deltas<br />\| where policy\_deltas != "{}"<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"  AND user matches "{{User}}"<br />\|count by user, method, policy\_deltas<br />\| fields -\_count|
|Google Cloud Storage|Request Location|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Buckets|\_sourceCategory={{Logsdatasource}}  data logName resource callerIp "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload.requestMetadata.callerIp" as labels, caller\_ip<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| lookup latitude, longitude from geo://location on ip=caller\_ip<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"<br />\|count by latitude, longitude<br />\| sort by \_count|
|Google Cloud Storage|Request Location|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Overview|\_sourceCategory={{Logsdatasource}}  data logName resource callerIp "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload.requestMetadata.callerIp" as labels, caller\_ip<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| lookup latitude, longitude from geo://location on ip=caller\_ip<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"<br />\|count by latitude, longitude<br />\| sort by \_count|
|Google Cloud Storage|Top 10 Buckets by Operations|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Overview|\_sourceCategory={{Logsdatasource}}  logName "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload.resourceName", "nullField" as labels, name, null nodrop<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| parse regex "\\"methodName\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\""<br />\| if (name matches "\*/objects/\*", name, null) as object\_name<br />\| if (method = "create", 1, 0) as create<br />\| if (method = "delete", 1, 0) as delete<br />\| if (method = "update", 1, 0) as update<br />\| if (method = "setIamPermissions", 1, 0) as setIam<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"<br />\|count as ops, count\_distinct(object\_name) as objects, sum(create) as create, sum(delete) as delete, sum(update) as update, sum(setIam) as setIam by bucket\_name, project<br />\| top 10 bucket\_name, project by ops, objects, create, delete, update, setIam|
|Google Cloud Storage|Top 10 Locations by Operations|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Overview|\_sourceCategory={{Logsdatasource}}  logName "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload.resourceName", "nullField" as labels, name, null nodrop<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| parse regex "\\"methodName\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\""<br />\| if (name matches "\*/objects/\*", name, null) as object\_name<br />\| if (method = "create", 1, 0) as create<br />\| if (method = "delete", 1, 0) as delete<br />\| if (method = "update", 1, 0) as update<br />\| if (method = "setIamPermissions", 1, 0) as setIam<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"<br />\|count as ops, count\_distinct(object\_name) as objects, sum(create) as create, sum(delete) as delete, sum(update) as update, sum(setIam) as setIam by location<br />\| top 10 location by ops, objects, create, delete, update, setIam|
|Google Cloud Storage|Top 10 Projects by Operations|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Overview|\_sourceCategory={{Logsdatasource}}  logName "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload.resourceName", "nullField" as labels, name, null nodrop<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| parse regex "\\"methodName\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\""<br />\| if (name matches "\*/objects/\*", name, null) as object\_name<br />\| if (method = "create", 1, 0) as create<br />\| if (method = "delete", 1, 0) as delete<br />\| if (method = "update", 1, 0) as update<br />\| if (method = "setIamPermissions", 1, 0) as setIam<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"<br />\|count as ops, count\_distinct(bucket\_name, project) as buckets, count\_distinct(object\_name) as objects, sum(create) as create, sum(delete) as delete, sum(update) as update, sum(setIam) as setIam by project<br />\| top 10 project by ops, buckets, objects, create, delete, update, setIam|
|Google Cloud Storage|Top 10 Users by Errors|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Users|\_sourceCategory={{Logsdatasource}}  logName resource severity principalEmail "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload", "message.data.severity" as labels, payload, severity<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| json field=payload "methodName", "authenticationInfo.principalEmail" as method, user<br />\| if(severity in ("WARNING", "ERROR","CRITICAL", "ALERT", "EMERGENCY"), 1, 0) as error<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}" AND user matches "{{User}}"<br />\|count as ops, sum(error) as errors by user<br />\| errors / ops \* 100 as error\_pct<br />\| top 10 user by errors, error\_pct, ops<br />\| fields user, errors, ops, error\_pct|
|Google Cloud Storage|Top 10 Users by Operations|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Overview|\_sourceCategory={{Logsdatasource}}  logName principalEmail "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload" as labels, payload<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| json field=payload "authenticationInfo.principalEmail", "resourceName", "nothingIsHere" as user, name, null nodrop<br />\| parse regex "\\"methodName\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\""<br />\| if (name matches "\*/objects/\*", name, null) as object\_name<br />\| if (method = "create", 1, 0) as create<br />\| if (method = "delete", 1, 0) as delete<br />\| if (method = "update", 1, 0) as update<br />\| if (method = "setIamPermissions", 1, 0) as setIam<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"<br />\|count as ops, count\_distinct(bucket\_name, project) as buckets, count\_distinct(object\_name) as objects, sum(create) as create, sum(delete) as delete, sum(update) as update, sum(setIam) as setIam by user<br />\| top 10 user by ops, buckets, objects, create, delete, update, setIam|
|Google Cloud Storage|User Operations Over Time|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Users|\_sourceCategory={{Logsdatasource}}  logName resource  "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload.authenticationInfo.principalEmail" as labels, user<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| timeslice 1h<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"  AND user matches "{{User}}"<br />\|count as messages by \_timeslice, user<br />\| transpose row \_timeslice column user|
|Google Cloud Storage|User Statistics|Logs|Installed Apps/Google Cloud Storage/Google Cloud Storage - Users|\_sourceCategory={{Logsdatasource}}  logName principalEmail "\\"type\\":\\"gcs\_bucket\\""<br />\| parse regex "\\"logName\\":\\"(?\<log\_name\>[^\\"]+)\\"" <br />\| where log\_name matches "projects/\*/logs/cloudaudit.googleapis.com%2\*"<br />\| json "message.data.resource.labels", "message.data.protoPayload" as labels, payload<br />\| json field=labels "project\_id", "bucket\_name", "location" as project, bucket\_name, location<br />\| json field=payload "authenticationInfo.principalEmail", "resourceName", "nothingIsHere" as user, name, null nodrop<br />\| parse regex "\\"methodName\\":\\"(?\<resource\_type\>[^\\"]+)\\.(?\<method\>[^\\"]+?)\\""<br />\| if (name matches "\*/objects/\*", name, null) as object\_name<br />\| if (method = "create", 1, 0) as create<br />\| if (method = "delete", 1, 0) as delete<br />\| if (method = "update", 1, 0) as update<br />\| if (method = "setIamPermissions", 1, 0) as setIam<br />\|where location matches "{{Location}}" AND project matches "{{Project}}" AND bucket\_name matches "{{Bucket}}"  AND user matches "{{User}}"<br />\|count as ops, count\_distinct(bucket\_name, project) as buckets, count\_distinct(object\_name) as objects, sum(create) as create, sum(delete) as delete, sum(update) as update, sum(setIam) as setIam by user<br />\| sort by ops|

