# Active Directory JSON

## Searches

### Log Searches

- **Account Lock Out Events**: from Search: Active Directory JSON/Security Status/Account Lock Out Events 
- **Admin Activity by Category**: from Dashboard: Active Directory JSON/Active Directory Service Failures 
- **All Failures by IP**: from Dashboard: Active Directory JSON/Active Directory Service Failures 
- **Audit Failures Over Time**: from Dashboard: Active Directory JSON/Active Directory Service Failures 
- **Category Over Time**: from Dashboard: Active Directory JSON/Active Directory Service Activity 
- **Directory Service Object Changes**: from Search: Active Directory JSON/Security Status/Directory Service Object Changes 
- **Failed User Logins**: from Search: Active Directory JSON/User Activity/Failed User Logins 
- **Last Successful Login for a specific user**: from Search: Active Directory JSON/User Activity/Last Successful Login for a specific user 
- **Last Successful Login Report**: from Search: Active Directory JSON/User Activity/Last Successful Login Report 
- **Login attempts to disabled accounts**: from Search: Active Directory JSON/Security Status/Login attempts to disabled accounts 
- **Logon/off Activity**: from Dashboard: Active Directory JSON/Active Directory Service Activity 
- **New Account Creation**: from Search: Active Directory JSON/Security Status/New Account Creation 
- **New Computer Account Creation**: from Search: Active Directory JSON/Security Status/New Computer Account Creation 
- **New Group Creation**: from Search: Active Directory JSON/Security Status/New Group Creation 
- **Object Creation**: from Dashboard: Active Directory JSON/Active Directory Service Activity 
- **Object Deletion**: from Dashboard: Active Directory JSON/Active Directory Service Activity 
- **OU Creation**: from Search: Active Directory JSON/Security Status/OU Creation 
- **OU Deletion**: from Search: Active Directory JSON/Security Status/OU Deletion 
- **Password Change Attempts**: from Search: Active Directory JSON/User Activity/Password Change Attempts 
- **Password Reset Attempts**: from Search: Active Directory JSON/User Activity/Password Reset Attempts 
- **Policy Changes**: from Search: Active Directory JSON/Security Status/Policy Changes 
- **Rights Management**: from Dashboard: Active Directory JSON/Active Directory Service Activity 
- **Successes vs Failures**: from Dashboard: Active Directory JSON/Active Directory Service Failures 
- **Successful User Logins**: from Search: Active Directory JSON/User Activity/Successful User Logins 
- **Top 10 Domain Controllers with Most Login Failures**: from Search: Active Directory JSON/User Activity/Top 10 Domain Controllers with Most Login Failures 
- **Top 10 Domain Controllers with the Most Login Failure Rate**: from Search: Active Directory JSON/User Activity/Top 10 Domain Controllers with the Most Login Failure Rate 
- **Top 10 Domains with Most Login Failures**: from Search: Active Directory JSON/User Activity/Top 10 Domains with Most Login Failures 
- **Top 10 Messages**: from Dashboard: Active Directory JSON/Active Directory Service Activity 
- **Trend of new users and disabled users over time**: from Search: Active Directory JSON/Security Status/Trend of new users and disabled users over time 
- **User Account Changes**: from Search: Active Directory JSON/User Activity/User Account Changes 
- **User added to group**: from Search: Active Directory JSON/Security Status/User added to group

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Active Directory JSON/Security Status|Account Lock Out Events|Logs|Active Directory JSON/Security Status/Account Lock Out Events|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" "\\"EventID\\":\\"4740\\""  \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "Channel", "keywords" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain, channel, keywords nodrop<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| where event\_id = "4740" <br />\| fields host, event\_id, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain|
|Active Directory JSON|Admin Activity by Category|Logs|Active Directory JSON/Active Directory Service Failures|\_sourceCategory = Labs/windows-jsonformat  Task <br />\| json "EventID", "Computer", "Level", "Message", "Keywords", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "Channel", "Task" as event\_id, host, event\_type, msg\_summary, Keywords, src\_user, src\_domain, dest\_user, dest\_domain, channel, task nodrop<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| where (src\_user matches "Administrator\*" or dest\_user matches "Administrator\*") and host matches "{{host}}"<br />\| count by task, Keywords, msg\_summary<br />\| topk(10, \_count) by task \| fields -\_rank|
|Active Directory JSON|All Failures by IP|Logs|Active Directory JSON/Active Directory Service Failures|\_sourceCategory = Labs/windows-jsonformat  ("fatal" or "failure" or "error" or "Audit Failure") <br />\| json "EventID", "Computer", "Keywords", "EventData.IpAddress" as event\_id, host, Keywords, src\_ip nodrop<br />\| where Keywords != "Audit Success" and !isEmpty(src\_ip) and src\_ip != "-" and host matches "{{host}}"<br />\| count by src\_ip<br />\| top 10 src\_ip by \_count|
|Active Directory JSON|Audit Failures Over Time|Logs|Active Directory JSON/Active Directory Service Failures|\_sourceCategory = Labs/windows-jsonformat  "\\"Keywords\\":\\"Audit Failure\\""<br />\| json "EventID", "Computer", "Keywords" as event\_id, host, keywords nodrop<br />\| where keywords = "Audit Failure" and host matches "{{host}}"<br />\| timeslice 1h<br />\| count as failures by \_timeslice, event\_id<br />\| transpose row \_timeslice column event\_id|
|Active Directory JSON|Category Over Time|Logs|Active Directory JSON/Active Directory Service Activity|\_sourceCategory = Labs/windows-jsonformat <br />\| json "EventID", "Computer", "Message", "Task" as event\_id, host, msg\_summary, task nodrop<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| where host matches "{{host}}"<br />\| timeslice 1h<br />\| count by \_timeslice, task<br />\| transpose row \_timeslice column task|
|Active Directory JSON/Security Status|Directory Service Object Changes|Logs|Active Directory JSON/Security Status/Directory Service Object Changes|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" (5136 or 5137 or 5138 or 5139 or 5141)  \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.SubjectLogonId", "EventData.DSName", "EventData.DSType", "EventData.ObjectDN", "EventData.ObjectClass", "EventData.AttributeValue", "Task", "Keywords", "Channel", "Level" as event\_id, host, msg\_summary, src\_user, src\_domain, src\_LogonId, directory\_service\_name, directory\_service\_type, object\_dn, object\_class, AttributeValue, task, Keywords, channel, level nodrop<br />\| where event\_id in ("5136", "5137", "5138", "5139", "5141") and channel = "Security"<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| count by event\_id, host, msg\_summary, src\_user, src\_domain, src\_LogonId, directory\_service\_name, directory\_service\_type, object\_dn, object\_class, AttributeValue, task, Keywords, channel, level|
|Active Directory JSON/User Activity|Failed User Logins|Logs|Active Directory JSON/User Activity/Failed User Logins|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" (4771 or 4776 or 4768 or 4769 or 4625) "Audit Failure"  \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "EventData.LogonType", "EventData.FailureReason", "EventData.IpAddress", "EventData.IpPort", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "EventData.WorkstationName", "Channel", "EventData.Status", "EventData.SubStatus", "EventData.Workstation", "Keywords" as event\_id, host, msg\_summary, logon\_type, fail\_reason, src\_ip, src\_port, src\_user, src\_domain, dest\_user, dest\_domain, src\_host, channel, status, sub\_status, work\_station, Keywords nodrop<br />\| parse regex field=msg\_summary "Failure Information:\\s+Failure Reason:\\s+(?\<failure\_reason\>[^.\\r]+?)[.\\r]" nodrop<br />\| parse regex field=msg\_summary "Result Code:\\s+(?\<result\_code\>[^\\r]+)\\r" nodrop<br />\| parse regex field=msg\_summary "Failure Code:\\s+(?\<failure\_code\>[^\\r]+)\\r" nodrop<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| where event\_id in ("4625", "4771") or (event\_id = "4768" and result\_code != "0x0") or (event\_id = "4769" and failure\_code != "0x0") or (event\_id = "4776" and status != "0x0")<br />\| fields host, event\_id, msg\_summary, src\_user, src\_ip, src\_port, src\_domain, dest\_user, dest\_domain, fail\_reason, logon\_type, result\_code, failure\_code, src\_host, status, sub\_status|
|Active Directory JSON/User Activity|Last Successful Login for a specific user|Logs|Active Directory JSON/User Activity/Last Successful Login for a specific user|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" "\\"EventID\\":\\"4624\\"" myuser  \_sourceName=Security <br />// provide username you want to search for in place of myuser<br />\| json "EventID", "Computer", "Message", "Keywords", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "EventData.IpAddress", "EventData.IpPort", "Channel", "Level", "EventData.LogonType" as event\_id, host, msg\_summary, Keywords, src\_user, src\_domain, dest\_user, dest\_domain, src\_ip, src\_port, channel, level, logon\_type nodrop<br />\| parse regex field=msg\_summary "Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop  <br />\| parse regex field=msg\_summary "Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop<br />\| parse regex field=msg\_summary "Client Name:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Client Address:[\\s\\r]+(?\<src\_ip\>[^\\r]+)" nodrop<br />\| where event\_id = "4624" and logon\_type in ("2","7","8","10","11") and dest\_user matches "myuser" // provide username you want to search for in place of myuser<br />\| first(\_messagetime) as last\_login by host, src\_user, src\_domain, src\_ip, src\_port, dest\_user, dest\_domain, logon\_type, src\_host<br />\| sort by last\_login <br />\| formatDate(fromMillis(last\_login), "MM-dd-yyyy HH:mm:ss z") as last\_login|
|Active Directory JSON/User Activity|Last Successful Login Report|Logs|Active Directory JSON/User Activity/Last Successful Login Report|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" "\\"EventID\\":\\"4624\\""  \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "Keywords", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "EventData.IpAddress", "EventData.IpPort", "Channel", "Level", "EventData.LogonType" as event\_id, host, msg\_summary, Keywords, src\_user, src\_domain, dest\_user, dest\_domain, src\_ip, src\_port, channel, level, logon\_type nodrop<br />\| parse regex field=msg\_summary "Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop  <br />\| parse regex field=msg\_summary "Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop<br />\| parse regex field=msg\_summary "Client Name:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Client Address:[\\s\\r]+(?\<src\_ip\>[^\\r]+)" nodrop<br />\| where event\_id = "4624" and logon\_type in ("2", "7", "8", "10", "11") <br />\| first(\_messagetime) as last\_login by src\_ip, dest\_user, dest\_domain, logon\_type, src\_port, src\_domain, src\_user, src\_host, host<br />\| sort by last\_login <br />\| formatDate(fromMillis(last\_login), "MM-dd-yyyy HH:mm:ss z") as last\_login|
|Active Directory JSON/Security Status|Login attempts to disabled accounts|Logs|Active Directory JSON/Security Status/Login attempts to disabled accounts|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" "Audit Failure" ("\\"EventID\\":\\"4625\\"" or "\\"EventID\\":\\"4768\\"" or "\\"EventID\\":\\"4771\\"" or "\\"EventID\\":\\"4776\\"" or "\\"EventID\\":\\"4769\\"") ("currently disabled" or 0xc0000072)  \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "EventData.LogonType", "EventData.FailureReason", "EventData.IpAddress", "EventData.IpPort", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "EventData.WorkstationName", "Channel", "EventData.Status", "EventData.SubStatus", "EventData.Workstation", "Keywords" as event\_id, host, msg\_summary, logon\_type, fail\_reason, src\_ip, src\_port, src\_user, src\_domain, dest\_user, dest\_domain, src\_host, channel, status, sub\_status, work\_station, Keywords nodrop<br />\| parse regex field=msg\_summary "Failure Information:\\s+Failure Reason:\\s+(?\<failure\_reason\>[^.\\r]+?)[.\\r]" nodrop<br />\| parse regex field=msg\_summary "Failure Information:\\s+(?\<test\>.\*)" nodrop<br />\| parse regex field=msg\_summary "Result Code:\\s+(?\<result\_code\>[^\\r]+)\\r" nodrop<br />\| parse regex field=msg\_summary "Failure Code:\\s+(?\<failure\_code\>[^\\r]+)\\r" nodrop<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| where event\_id in ("4625", "4771") or (event\_id = "4768" and result\_code != "0x0") or (event\_id = "4769" and failure\_code != "0x0") or (event\_id = "4776" and status != "0x0") and (failure\_reason = "Account currently disabled" or sub\_status = "0xc0000072")<br />\| fields host, event\_id, msg\_summary, src\_user, src\_ip, src\_port, src\_domain, dest\_user, dest\_domain, fail\_reason, logon\_type, result\_code, failure\_code, src\_host, failure\_reason, status, sub\_status|
|Active Directory JSON|Logon/off Activity|Logs|Active Directory JSON/Active Directory Service Activity|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" ("\\"EventID\\":\\"4624\\"" or "\\"EventID\\":\\"4634\\"")  \_sourceName=Security<br />\| json "EventID", "Computer", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "EventData.LogonType", "EventData.LogonGuid", "EventData.SubjectLogonId", "EventData.TargetLogonId", "Channel", "Message"  as event\_id, host, src\_user, src\_domain, dest\_user, dest\_domain, logon\_type, LogonGuid, SubjectLogonId, TargetLogonId, channel, msg\_summary nodrop<br />\| where event\_id in ("4624", "4634") and channel = "Security" and host matches "{{host}}"<br />\| if (logon\_type = "2", "interactive", if (logon\_type = "3", "network", if (logon\_type = "4", "batch", if (logon\_type = "5", "service", if (logon\_type = "7", "unlock", if (logon\_type = "8", "networkcleartext", if (logon\_type = "9", "newcredentials", if (logon\_type = "10", "remoteinteractive", if (logon\_type = "11", "cachedinteractive", "" ))))))))) as type<br />\| if (event\_id = "4624", "logon", "logged off") as addonstr<br />\| concat (type, " ", addonstr) as type<br />\| where type != ""<br />\| timeslice 1h<br />\| count by \_timeslice, type<br />\| transpose row \_timeslice column type|
|Active Directory JSON/Security Status|New Account Creation|Logs|Active Directory JSON/Security Status/New Account Creation|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" "\\"EventID\\":\\"4720\\""  \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "Channel" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain, channel nodrop<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| where event\_id = "4720" and channel = "Security"<br />\| fields host, event\_id, msg\_summary, src\_user, dest\_user, src\_domain, dest\_domain|
|Active Directory JSON/Security Status|New Computer Account Creation|Logs|Active Directory JSON/Security Status/New Computer Account Creation|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" "\\"EventID\\":\\"4741\\"" "computer account was created"  \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "EventData.SamAccountName", "EventData.HomeDirectory", "Channel", "Task", "Keywords" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain, SamAccountName, HomeDirectory, channel, task, Keywords nodrop<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| where event\_id = "4741" <br />\| fields event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain, SamAccountName, HomeDirectory, channel, task, Keywords|
|Active Directory JSON/Security Status|New Group Creation|Logs|Active Directory JSON/Security Status/New Group Creation|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" ("\\"EventID\\":\\"4727\\"" or "\\"EventID\\":\\"4731\\"" or "\\"EventID\\":\\"4754\\"")  \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "Channel" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain, channel nodrop<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| where event\_id in ("4727", "4731", "4754")<br />\| dest\_user as group\_name \| dest\_domain as group\_domain<br />\| fields host, event\_id, msg\_summary, src\_user, src\_domain, group\_name, group\_domain|
|Active Directory JSON|Object Creation|Logs|Active Directory JSON/Active Directory Service Activity|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" (4720 or 4741 or 4727 or 4731 or 4744 or 4749 or 4754 or 4759 or 4783 or 5137 or 4902 or 4790)  \_sourceName=Security<br />\| json "EventID", "Computer", "Message" as event\_id, host, msg\_summary nodrop<br />\| if ((event\_id in ("4720")), "user", "") as object\_created<br />\| if ((event\_id in ("4720", "4741")), "computer", "") as object\_created<br />\| if ((event\_id in ("4727", "4731", "4744", "4749", "4754", "4759", "4783")), "group", object\_created) as object\_created<br />\| if ((event\_id in ("5137", "4902", "4790")), "object", object\_created) as object\_created<br />\| where object\_created != "" and host matches "{{host}}"<br />\| timeslice 1h<br />\| count by object\_created, \_timeslice<br />\| transpose row \_timeslice column object\_created<br />\| fillmissing timeslice(1h)|
|Active Directory JSON|Object Deletion|Logs|Active Directory JSON/Active Directory Service Activity|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" (4726 or 4743 or 4730 or 4734 or 4748 or 4753 or 4758 or 4763 or 4789 or 4659 or 4660 or 5141)  \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "EventData.LogonType", "Channel" as event\_id, host, msg\_summary, logon\_type, channel nodrop<br />\| if ((event\_id in ("4726")), "user", "") as object\_deleted<br />\| if ((event\_id in ("4743")), "computer", "") as object\_deleted<br />\| if ((event\_id in ("4730", "4734", "4748", "4753", "4758", "4763", "4789")), "group", object\_deleted) as object\_deleted<br />\| if ((event\_id in ("4659", "4660", "5141")), "object", object\_deleted) as object\_deleted<br />\| where object\_deleted != "" and host matches "{{host}}"<br />\| timeslice 1h<br />\| count by object\_deleted, \_timeslice<br />\| transpose row \_timeslice column object\_deleted<br />\| fillmissing timeslice(1h)|
|Active Directory JSON/Security Status|OU Creation|Logs|Active Directory JSON/Security Status/OU Creation|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" "\\"EventID\\":\\"5137\\""  \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.SubjectLogonId", "EventData.DSName", "EventData.DSType", "EventData.ObjectDN", "EventData.ObjectClass", "Task", "Keywords", "Channel", "Level" as event\_id, host, msg\_summary, src\_user, src\_domain, src\_LogonId, directory\_service\_name, directory\_service\_type, object\_dn, object\_class, task, Keywords, channel, level nodrop<br />\| where event\_id = "5137" and channel = "Security"<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| count by event\_id, host, msg\_summary, src\_user, src\_domain, src\_LogonId, directory\_service\_name, directory\_service\_type, object\_dn, object\_class, task, Keywords, channel, level|
|Active Directory JSON/Security Status|OU Deletion|Logs|Active Directory JSON/Security Status/OU Deletion|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" "\\"EventID\\":\\"5141\\""  \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.SubjectLogonId", "EventData.DSName", "EventData.DSType", "EventData.ObjectDN", "EventData.ObjectClass", "Task", "Keywords", "Channel", "Level" as event\_id, host, msg\_summary, src\_user, src\_domain, src\_LogonId, directory\_service\_name, directory\_service\_type, object\_dn, object\_class, task, Keywords, channel, level nodrop<br />\| where event\_id = "5141" and channel = "Security"<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| fields event\_id, host, msg\_summary, src\_user, src\_domain, src\_LogonId, directory\_service\_name, directory\_service\_type, object\_dn, object\_class, task, Keywords, channel, level |
|Active Directory JSON/User Activity|Password Change Attempts|Logs|Active Directory JSON/User Activity/Password Change Attempts|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" "\\"EventID\\":\\"4723\\""  \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "Channel" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain, channel nodrop<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| where event\_id = "4723"<br />\| fields host, event\_id, msg\_summary, src\_user, dest\_user, src\_domain, dest\_domain|
|Active Directory JSON/User Activity|Password Reset Attempts|Logs|Active Directory JSON/User Activity/Password Reset Attempts|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" "\\"EventID\\":\\"4724\\""  \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "Channel" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain, channel nodrop<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| where event\_id = "4724"<br />\| fields host, event\_id, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain|
|Active Directory JSON/Security Status|Policy Changes|Logs|Active Directory JSON/Security Status/Policy Changes|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" (4902 or 4904 or 4905 or 4906 or 4907 or 4912 or 4715 or 4719 or 4739 or "Audit Policy Change" or "System audit policy was changed" or \*policy\*change\* or "Policy Change")  \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "Channel", "Task" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain, channel, task nodrop<br />\| where event\_id in ("4902", "4904", "4905", "4906", "4907", "4912", "4715", "4719", "4739") or msg\_summary matches "System audit policy was changed" or msg\_summary matches "\*policy\*change\*"<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| count as num\_changes, first(\_messageTime) as last\_change by src\_domain, host, task, msg\_summary<br />\| sort by last\_change <br />\| formatDate(fromMillis(last\_change), "MM-dd-yyyy HH:mm:ss z") as last\_change|
|Active Directory JSON|Rights Management|Logs|Active Directory JSON/Active Directory Service Activity|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" ("\\"EventID\\":\\"4704\\"" or "\\"EventID\\":\\"4705\\"")  \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "Keywords", "Channel", "Level", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.SubjectLogonId", "EventData.PrivilegeList" as event\_id, host, msg\_summary, Keywords, channel, Level, src\_user, src\_domain, src\_logonid, PrivilegeList nodrop<br />\| where event\_id in ("4704", "4705") and host matches "{{host}}"<br />\| if ((event\_id = "4704"), "assigned", if ((event\_id = "4705"), "removed", "")) as right<br />\| timeslice 1h<br />\| count by right, \_timeslice<br />\| transpose row \_timeslice column right<br />\| fillmissing timeslice(1h) |
|Active Directory JSON|Successes vs Failures|Logs|Active Directory JSON/Active Directory Service Failures|\_sourceCategory = Labs/windows-jsonformat  Keywords<br />\| json "EventID", "Computer", "Keywords" as event\_id, host, keywords nodrop<br />\| if (keywords = "Audit Failure", "Failure", "Success") as status<br />\| where host matches "{{host}}"<br />\| timeslice 1h<br />\| count as EventCount by  status, \_timeslice<br />\| transpose row \_timeslice column status|
|Active Directory JSON/User Activity|Successful User Logins|Logs|Active Directory JSON/User Activity/Successful User Logins|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" "\\"EventID\\":\\"4624\\""  \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "Keywords", "EventData.SubjectUserName",  "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "EventData.IpAddress", "EventData.IpPort", "Channel", "Level", "EventData.LogonType" as event\_id, host, msg\_summary, Keywords, src\_user, src\_domain, dest\_user, dest\_domain, src\_ip, src\_port, channel, level, logon\_type nodrop<br />\| parse regex field=msg\_summary "Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop  <br />\| parse regex field=msg\_summary "Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop<br />\| parse regex field=msg\_summary "Client Name:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Client Address:[\\s\\r]+(?\<src\_ip\>[^\\r]+)" nodrop<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| where event\_id = "4624" <br />\| fields event\_id, msg\_summary, src\_host, src\_ip, src\_port, src\_user, src\_domain, dest\_user, dest\_domain, logon\_type|
|Active Directory JSON/User Activity|Top 10 Domain Controllers with Most Login Failures|Logs|Active Directory JSON/User Activity/Top 10 Domain Controllers with Most Login Failures|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" (4771 or 4776 or 4768 or 4769 or 4625) "Audit Failure"  \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "EventData.LogonType", "EventData.FailureReason", "EventData.IpAddress", "EventData.IpPort", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "EventData.WorkstationName", "Channel", "EventData.Status", "EventData.SubStatus", "EventData.Workstation", "Keywords" as event\_id, host, msg\_summary, logon\_type, fail\_reason, src\_ip, src\_port, src\_user, src\_domain, dest\_user, dest\_domain, src\_host, channel, status, sub\_status, work\_station, Keywords nodrop<br />\| parse regex field=msg\_summary "Failure Information:\\s+Failure Reason:\\s+(?\<failure\_reason\>[^.\\r]+?)[.\\r]" nodrop<br />\| parse regex field=msg\_summary "Result Code:\\s+(?\<result\_code\>[^\\r]+)\\r" nodrop<br />\| parse regex field=msg\_summary "Failure Code:\\s+(?\<failure\_code\>[^\\r]+)\\r" nodrop<br />\| parse regex field=msg\_summary "Client Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Client Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop  <br />\| parse regex field=msg\_summary "Source Network Address:\\s+(?\<src\_ip\>[^\\r]+?)\\r[\\s\\S]+?Source Port:\\s+?(?\<src\_port\>[\\d-]+)" nodrop<br />\| parse regex field=msg\_summary "Client Name:\\s+(?\<src\_host\>[^\\r]+?)\\r[\\s\\S]+?Client Address:[\\s\\r]+(?\<src\_ip\>[^\\r]+)" nodrop<br />\| where event\_id in ("4625", "4771") or (event\_id = "4768" and result\_code != "0x0") or (event\_id = "4769" and failure\_code != "0x0") or (event\_id = "4776" and status != "0x0")<br />\| fields host, event\_id, msg\_summary, src\_user, src\_ip, src\_port, src\_domain, dest\_user, dest\_domain, fail\_reason, logon\_type, result\_code, failure\_code, src\_host, status, sub\_status<br />\| \_sourceHost as ReportingDC \| count as %"LoginFailureCount" by ReportingDC \| top 10 ReportingDC by %"LoginFailureCount"<br /><br /><br />|
|Active Directory JSON/User Activity|Top 10 Domain Controllers with the Most Login Failure Rate|Logs|Active Directory JSON/User Activity/Top 10 Domain Controllers with the Most Login Failure Rate|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" (4624 or 4625 or 4771 or 4776 or 4768 or 4769)  \_sourceName=Security<br />// 4624 - Login Success, 4625 or 4771 - Login Failures, 4776 - Domain Controller - Credential validation, 4768 - A Kerberos authentication ticket (TGT) was requested, 4769 - A Kerberos service ticket was requested<br />\| json "EventID", "Computer", "Level", "Message", "Keywords", "Channel" as event\_id, host, event\_type, msg\_summary, Keywords, channel nodrop<br />\| where event\_id in ("4624", "4625", "4771", "4776", "4768", "4769")<br />\| if (Keywords matches "Audit Success", 1, 0) as Success <br />\| if (Keywords matches "Audit Failure", 1, 0) as Failure <br />\| \_sourceHost as ReportingDC <br />\| count as LoginAttempts, sum(Success) as SuccessLoginAttempts, sum(Failure) as FailureLoginAttempts by ReportingDC <br />\| FailureLoginAttempts / LoginAttempts as %"LoginFailureRatio" \| sort - %"LoginFailureRatio" \| limit 10|
|Active Directory JSON/User Activity|Top 10 Domains with Most Login Failures|Logs|Active Directory JSON/User Activity/Top 10 Domains with Most Login Failures|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" (4771 or 4776 or 4768 or 4769 or 4625) "Audit Failure"  \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "EventData.LogonType", "EventData.FailureReason", "EventData.IpAddress", "EventData.IpPort", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "EventData.WorkstationName", "Channel", "EventData.Status", "EventData.SubStatus", "EventData.Workstation", "Keywords" as event\_id, host, msg\_summary, logon\_type, fail\_reason, src\_ip, src\_port, src\_user, src\_domain, dest\_user, dest\_domain, src\_host, channel, status, sub\_status, work\_station, Keywords nodrop<br />\| parse regex field=msg\_summary "Failure Information:\\s+Failure Reason:\\s+(?\<failure\_reason\>[^.\\r]+?)[.\\r]" nodrop<br />\| parse regex field=msg\_summary "Result Code:\\s+(?\<result\_code\>[^\\r]+)\\r" nodrop<br />\| parse regex field=msg\_summary "Failure Code:\\s+(?\<failure\_code\>[^\\r]+)\\r" nodrop<br />\| where event\_id in ("4625", "4771") or (event\_id = "4768" and result\_code != "0x0") or (event\_id = "4769" and failure\_code != "0x0") or (event\_id = "4776" and status != "0x0")<br />\| fields host, event\_id, msg\_summary, src\_user, src\_ip, src\_port, src\_domain, dest\_user, dest\_domain, fail\_reason, logon\_type, result\_code, failure\_code, src\_host, status, sub\_status<br />\| count as %"LoginFailureCount" by dest\_domain <br />\| where !isEmpty(dest\_domain)<br />\| top 10 dest\_domain by  %"LoginFailureCount"|
|Active Directory JSON|Top 10 Messages|Logs|Active Directory JSON/Active Directory Service Activity|\_sourceCategory = Labs/windows-jsonformat <br />\| json "EventID", "Computer", "Message" as event\_id, host, msg\_summary nodrop<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| where host matches "{{host}}"<br />\| count by msg\_summary <br />\| top 10 msg\_summary by \_count|
|Active Directory JSON/Security Status|Trend of new users and disabled users over time|Logs|Active Directory JSON/Security Status/Trend of new users and disabled users over time|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" ("\\"EventID\\":\\"4720\\"" or "\\"EventID\\":\\"4725\\"")  \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "Channel" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain, channel nodrop<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| where event\_id in ("4720", "4725") <br />\| if (event\_id = "4720", "New Users", "Disabled Users") as type <br />\| timeslice by 1d <br />\| count by \_timeslice, type <br />\| sort by \_timeslice asc <br />\| transpose row \_timeslice column type|
|Active Directory JSON/User Activity|User Account Changes|Logs|Active Directory JSON/User Activity/User Account Changes|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" ("13824" or "4720" or "4722" or "4723" or "4724" or "4725" or "4726" or "4738" or "4740" or "4767" or "4780" or "4781" or "4794" or "5376" or "5377")  \_sourceName=Security<br />\| json "EventID", "Computer", "Level", "Message", "Keywords", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "Channel", "Task" as event\_id, host, event\_type, msg\_summary, Keywords, src\_user, src\_domain, dest\_user, dest\_domain, channel, task nodrop<br />\| parse regex field=msg\_summary "Changed Attributes:\\s+(?\<changedAttributes\>[\\s\\S]\*?)Additional Information:" nodrop<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| fields msg\_summary, event\_id, src\_user, src\_domain, dest\_user, dest\_domain, host, task, changedAttributes<br />\| where event\_id in ("4720", "4722", "4723", "4724", "4725", "4726", "4738", "4740", "4767", "4780", "4781", "4794", "5376", "5377") or task = "13824"<br />\| fields host, task, event\_id, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain, changedAttributes|
|Active Directory JSON/Security Status|User added to group|Logs|Active Directory JSON/Security Status/User added to group|\_sourceCategory = Labs/windows-jsonformat  "\\"Channel\\":\\"Security\\"" (4728 or 4732 or 4746 or 4751 or 4756 or 4761)  \_sourceName=Security<br />\| json "EventID", "Computer", "Message", "EventData.SubjectUserName", "EventData.SubjectDomainName", "EventData.TargetUserName", "EventData.TargetDomainName", "EventData.GroupName", "EventData.GroupDomain", "Channel", "EventData.MemberName" as event\_id, host, msg\_summary, src\_user, src\_domain, dest\_user, dest\_domain, group\_name, group\_domain, channel, MemberName nodrop<br />\| parse regex field=msg\_summary "Subject:[\\s\\S]+?Account Name:[\\s\\S]+?Member:[\\s\\S]+?Security ID:\\s+(?\<member\_user\_name\>[^\\r\\"]+?)\\r[\\s\\S]+?Account Name:[\\s\\S]+?Group:[\\s\\S]+?(?:Account\|Group) Name:\\s+(?\<group\_name\>[^\\r\\"]+?)\\r\\s+?(?:Account\|Group) Domain:\\s+(?\<group\_domain\>[^\\r\\"]+?)(?:\\r\|\\")" nodrop <br />\| where event\_id in ("4728", "4732", "4746", "4751", "4756", "4761")<br />\| parse regex field=msg\_summary "(?\<msg\_summary\>.\*\\.\*)" nodrop<br />\| fields host, event\_id, msg\_summary, src\_user, src\_domain, group\_name, group\_domain, member\_user\_name|

