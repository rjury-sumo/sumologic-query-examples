# Varnish
## Sumo Logic App For: Varnish
The Sumo Logic App for Varnish provides dashboards that help you analyze log and metric events generated by the Varnish servers. This app allows you to identify traffic sources, monitor threads, cache performance and Bans, Backend server activity.
Docs Link: [Varnish](https://help.sumologic.com/?cid=5445)

## Searches

### Log Searches

- **Browsers and Operating Systems**: from Dashboard: Varnish/Logs/Varnish - Visitor Traffic Insight 
- **Bytes Served**: from Dashboard: Varnish/Logs/Varnish - Visitor Traffic Insight 
- **Bytes Served - Outlier**: from Dashboard: Varnish/Logs/Varnish - Outlier Analysis 
- **Client Errors**: from Dashboard: Varnish/Logs/Varnish - Outlier Analysis 
- **Client Locations - 4xx Errors**: from Dashboard: Varnish/Logs/Varnish - Web Server Operations 
- **Error Responses by Server**: from Dashboard: Varnish/Logs/Varnish - Web Server Operations 
- **Highly Malicious Threat Table**: from Dashboard: Varnish/Logs/Varnish - Threat Intel 
- **HTTP Methods**: from Dashboard: Varnish/Logs/Varnish - Visitor Traffic Insight 
- **Media Types Served**: from Dashboard: Varnish/Logs/Varnish - Visitor Traffic Insight 
- **Non 200 Response Status Codes**: from Dashboard: Varnish/Logs/Varnish - Web Server Operations 
- **Number of Hits by Server - One Day Time Comparison**: from Dashboard: Varnish/Logs/Varnish  - Traffic Timeline Analysis 
- **Number of Visitors**: from Dashboard: Varnish/Logs/Varnish - Outlier Analysis 
- **Popular Mobile Device Versions**: from Dashboard: Varnish/Logs/Varnish - Visitor Traffic Insight 
- **Responses Over Time**: from Dashboard: Varnish/Logs/Varnish  - Traffic Timeline Analysis 
- **Responses Over Time**: from Dashboard: Varnish/Varnish - Overview 
- **Server Errors**: from Dashboard: Varnish/Logs/Varnish - Outlier Analysis 
- **Server Errors Over Time**: from Dashboard: Varnish/Logs/Varnish - Web Server Operations 
- **Threat by Actors**: from Dashboard: Varnish/Logs/Varnish - Threat Intel 
- **Threat by Malicious Confidence**: from Dashboard: Varnish/Logs/Varnish - Threat Intel 
- **Threat Locations**: from Dashboard: Varnish/Logs/Varnish - Threat Intel 
- **Threat Table**: from Dashboard: Varnish/Logs/Varnish - Threat Intel 
- **Threats**: from Dashboard: Varnish/Logs/Varnish - Threat Intel 
- **Top 10 Bots Observed**: from Dashboard: Varnish/Logs/Varnish - Web Server Operations 
- **Top 10 PC and Mac Versions**: from Dashboard: Varnish/Logs/Varnish - Visitor Traffic Insight 
- **Top 10 Search Terms from Popular Search Engines**: from Dashboard: Varnish/Logs/Varnish - Visitor Traffic Insight 
- **Top 10 URLs causing Errors**: from Dashboard: Varnish/Varnish - Overview 
- **Top 5 Clients Causing 4xx Errors**: from Dashboard: Varnish/Logs/Varnish - Web Server Operations 
- **Top 5 Clients Causing 5xx Errors**: from Dashboard: Varnish/Logs/Varnish - Web Server Operations 
- **Top 5 Highly Malicious URLs**: from Dashboard: Varnish/Logs/Varnish - Threat Intel 
- **Top 5 Messages in the Error Logs**: from Dashboard: Varnish/Logs/Varnish - Web Server Operations 
- **Top 5 Referrers**: from Dashboard: Varnish/Logs/Varnish - Visitor Traffic Insight 
- **Top 5 URIs causing 4xx Responses**: from Dashboard: Varnish/Logs/Varnish - Web Server Operations 
- **Top 5 URIs Causing 5xx Responses**: from Dashboard: Varnish/Logs/Varnish - Web Server Operations 
- **Top 5 URLs**: from Dashboard: Varnish/Logs/Varnish - Visitor Traffic Insight 
- **Top Clients**: from Dashboard: Varnish/Logs/Varnish - Web Server Operations 
- **Traffic Distribution by Server**: from Dashboard: Varnish/Varnish - Overview 
- **Traffic Distribution by Server**: from Dashboard: Varnish/Logs/Varnish  - Traffic Timeline Analysis 
- **Traffic Volume and GBytes Served**: from Dashboard: Varnish/Logs/Varnish  - Traffic Timeline Analysis 
- **Traffic Volume and MB Served Over Time**: from Dashboard: Varnish/Varnish - Overview 
- **Visitor Locations**: from Dashboard: Varnish/Varnish - Overview 
- **Visitor Locations - 4xx Errors**: from Dashboard: Varnish/Varnish - Overview 
- **Visitor Locations - One Day Time Comparison**: from Dashboard: Varnish/Logs/Varnish  - Traffic Timeline Analysis 
- **Visits by Country Over Time**: from Dashboard: Varnish/Logs/Varnish - Visitor Traffic Insight 
- **Vistor Platforms**: from Dashboard: Varnish/Logs/Varnish - Visitor Traffic Insight 
- **Worldwide**: from Dashboard: Varnish/Logs/Varnish - Visitor Traffic Insight

### Metric Searches

- **500 Responses**: from Dashboard: Varnish/Metrics/Varnish - Clients 
- **Available VCLs**: from Dashboard: Varnish/Varnish - Overview 
- **Backend Connections by Host**: from Dashboard: Varnish/Varnish - Overview 
- **Backend Network (MB) by Host**: from Dashboard: Varnish/Varnish - Overview 
- **Backend Requests by Host**: from Dashboard: Varnish/Varnish - Overview 
- **Backends**: from Dashboard: Varnish/Varnish - Overview 
- **Ban Lurker gave way for Lookup**: from Dashboard: Varnish/Varnish - Overview 
- **Ban Tests Tested Against Objects (Lurker)**: from Dashboard: Varnish/Metrics/Varnish - Bans and Bans Lurker 
- **Bans**: from Dashboard: Varnish/Metrics/Varnish - Bans and Bans Lurker 
- **Bans Superseded by Other Bans**: from Dashboard: Varnish/Metrics/Varnish - Bans and Bans Lurker 
- **Bans Tested Against Objects (Lurker)**: from Dashboard: Varnish/Metrics/Varnish - Bans and Bans Lurker 
- **Bans Using Obj.***: from Dashboard: Varnish/Metrics/Varnish - Bans and Bans Lurker 
- **Busy Servers over Time**: from Dashboard: Varnish/Metrics/Varnish - Backend Servers 
- **Bytes In (Pipe Sessions)**: from Dashboard: Varnish/Metrics/Varnish - Clients 
- **Bytes Out (Pipe Sessions)**: from Dashboard: Varnish/Metrics/Varnish - Clients 
- **Bytes Used by the Persisted Ban Lists (Bytes)**: from Dashboard: Varnish/Metrics/Varnish - Bans and Bans Lurker 
- **Cache Hit %**: from Dashboard: Varnish/Varnish - Overview 
- **Cache Hit %**: from Dashboard: Varnish/Metrics/Varnish - Cache Performance 
- **Cache Hit Rate Over Time**: from Dashboard: Varnish/Metrics/Varnish - Cache Performance 
- **Cache Hits (%)**: from Dashboard: Varnish/Varnish - Overview 
- **Cache Used (MB)**: from Dashboard: Varnish/Metrics/Varnish - Cache Performance 
- **Client Requests**: from Dashboard: Varnish/Metrics/Varnish - Clients 
- **Completed**: from Dashboard: Varnish/Metrics/Varnish - Bans and Bans Lurker 
- **Connection Retries**: from Dashboard: Varnish/Metrics/Varnish - Backend Servers 
- **Connections Failed**: from Dashboard: Varnish/Metrics/Varnish - Backend Servers 
- **Connections Recycled**: from Dashboard: Varnish/Metrics/Varnish - Backend Servers 
- **Connections Reused**: from Dashboard: Varnish/Metrics/Varnish - Backend Servers 
- **Count of Cache Hits with Grace**: from Dashboard: Varnish/Metrics/Varnish - Cache Performance 
- **Deleted**: from Dashboard: Varnish/Metrics/Varnish - Bans and Bans Lurker 
- **Expired Objects Because of TTL**: from Dashboard: Varnish/Metrics/Varnish - Cache Performance 
- **Extra Bytes in Persisted Ban Lists Due to Fragmentation (Bytes)**: from Dashboard: Varnish/Metrics/Varnish - Bans and Bans Lurker 
- **Fetch Requests by Host**: from Dashboard: Varnish/Varnish - Overview 
- **Frontend Network (MB) by Host**: from Dashboard: Varnish/Varnish - Overview 
- **Frontend Requests by Host**: from Dashboard: Varnish/Varnish - Overview 
- **Hits/Misses Over Time**: from Dashboard: Varnish/Metrics/Varnish - Cache Performance 
- **Loaded VMODs**: from Dashboard: Varnish/Varnish - Overview 
- **Lurker Gave Way for Lookup**: from Dashboard: Varnish/Metrics/Varnish - Bans and Bans Lurker 
- **Malformed Requests**: from Dashboard: Varnish/Metrics/Varnish - Clients 
- **Max Threads Hit**: from Dashboard: Varnish/Metrics/Varnish - Threads 
- **Network Requests (MB)**: from Dashboard: Varnish/Metrics/Varnish - Backend Servers 
- **Network Requests (MB)**: from Dashboard: Varnish/Metrics/Varnish - Clients 
- **Network Responses (MB)**: from Dashboard: Varnish/Metrics/Varnish - Backend Servers 
- **Network Responses (MB)**: from Dashboard: Varnish/Metrics/Varnish - Clients 
- **Objects Forcefully Evicted**: from Dashboard: Varnish/Metrics/Varnish - Cache Performance 
- **Objects Killed by Bans**: from Dashboard: Varnish/Metrics/Varnish - Bans and Bans Lurker 
- **Objects Killed by Bans (Lurker)**: from Dashboard: Varnish/Metrics/Varnish - Bans and Bans Lurker 
- **Persisted Ban Lists Memory Usage (Bytes)**: from Dashboard: Varnish/Varnish - Overview 
- **Pools**: from Dashboard: Varnish/Varnish - Overview 
- **Requests**: from Dashboard: Varnish/Metrics/Varnish - Backend Servers 
- **Requests Fetched from a Backend**: from Dashboard: Varnish/Metrics/Varnish - Cache Performance 
- **Requests Passed to a Backend**: from Dashboard: Varnish/Metrics/Varnish - Cache Performance 
- **Requests Served**: from Dashboard: Varnish/Metrics/Varnish - Cache Performance 
- **Requests with a Bad Expect: Header**: from Dashboard: Varnish/Metrics/Varnish - Clients 
- **Servers**: from Dashboard: Varnish/Metrics/Varnish - Backend Servers 
- **Session Queue Length Waiting for Threads**: from Dashboard: Varnish/Metrics/Varnish - Threads 
- **Sessions**: from Dashboard: Varnish/Metrics/Varnish - Clients 
- **Sessions Acceptance Failures**: from Dashboard: Varnish/Metrics/Varnish - Clients 
- **Sessions Accepted**: from Dashboard: Varnish/Metrics/Varnish - Clients 
- **Sessions Accepted by Host**: from Dashboard: Varnish/Varnish - Overview 
- **Sessions Closed**: from Dashboard: Varnish/Metrics/Varnish - Clients 
- **Sessions Closed with Error**: from Dashboard: Varnish/Metrics/Varnish - Clients 
- **Sessions Dropped Due to a Full Queue**: from Dashboard: Varnish/Metrics/Varnish - Clients 
- **Sessions Dropped Due to Lack of Worker Thread**: from Dashboard: Varnish/Metrics/Varnish - Clients 
- **Sessions Queued**: from Dashboard: Varnish/Metrics/Varnish - Clients 
- **Successful Connections**: from Dashboard: Varnish/Metrics/Varnish - Backend Servers 
- **Thread Creation Failed**: from Dashboard: Varnish/Metrics/Varnish - Threads 
- **Thread Pools**: from Dashboard: Varnish/Metrics/Varnish - Threads 
- **Threads**: from Dashboard: Varnish/Metrics/Varnish - Threads 
- **Threads**: from Dashboard: Varnish/Varnish - Overview 
- **Threads Created**: from Dashboard: Varnish/Metrics/Varnish - Threads 
- **Threads Destroyed**: from Dashboard: Varnish/Metrics/Varnish - Threads 
- **Unhealthy Servers**: from Dashboard: Varnish/Metrics/Varnish - Backend Servers 
- **Unused Cache (MB)**: from Dashboard: Varnish/Metrics/Varnish - Cache Performance 
- **Uptime**: from Dashboard: Varnish/Varnish - Overview

## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Varnish/Metrics|500 Responses|Metrics|Varnish/Metrics/Varnish - Clients|\_sourceCategory = Labs/varnish metric=varnish\_client\_resp\_500 cache\_cluster={{cache\_cluster}} host={{host}}  \| sum by cache\_cluster,host |
|Varnish|Available VCLs|Metrics|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish metric=varnish\_n\_vcl\_avail cache\_cluster={{cache\_cluster}} \| sum by metric|
|Varnish|Backend Connections by Host|Metrics|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish metric=varnish\_backend\_conn cache\_cluster={{cache\_cluster}} \| sum by cache\_cluster, host|
|Varnish|Backend Network (MB) by Host|Metrics|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish metric=varnish\_boot\_\*\_\*\_hdrbytes  cache\_cluster={{cache\_cluster}} \| sum by cache\_cluster, host |
|Varnish|Backend Requests by Host|Metrics|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish metric=varnish\_backend\_req cache\_cluster={{cache\_cluster}} \| sum by cache\_cluster,host|
|Varnish|Backends|Metrics|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish metric=varnish\_n\_backend cache\_cluster={{cache\_cluster}} \| sum by metric|
|Varnish|Ban Lurker gave way for Lookup|Metrics|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish metric=varnish\_bans\_lurker\_contention cache\_cluster={{cache\_cluster}} \| sum by cache\_cluster, host|
|Varnish/Metrics|Ban Tests Tested Against Objects (Lurker)|Metrics|Varnish/Metrics/Varnish - Bans and Bans Lurker|\_sourceCategory = Labs/varnish metric=varnish\_bans\_lurker\_tests\_tested cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host|
|Varnish/Metrics|Bans|Metrics|Varnish/Metrics/Varnish - Bans and Bans Lurker|\_sourceCategory = Labs/varnish metric=varnish\_bans cache\_cluster={{cache\_cluster}} host={{host}} \| sum by metric|
|Varnish/Metrics|Bans Superseded by Other Bans|Metrics|Varnish/Metrics/Varnish - Bans and Bans Lurker|\_sourceCategory = Labs/varnish metric=varnish\_bans\_dups cache\_cluster={{cache\_cluster}} host={{host}} \| sum by metric|
|Varnish/Metrics|Bans Tested Against Objects (Lurker)|Metrics|Varnish/Metrics/Varnish - Bans and Bans Lurker|\_sourceCategory = Labs/varnish metric=varnish\_bans\_lurker\_tested cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host|
|Varnish/Metrics|Bans Using Obj.\*|Metrics|Varnish/Metrics/Varnish - Bans and Bans Lurker|\_sourceCategory = Labs/varnish metric=varnish\_bans\_obj cache\_cluster={{cache\_cluster}} host={{host}} \| sum by metric|
|Varnish/Logs|Browsers and Operating Systems|Logs|Varnish/Logs/Varnish - Visitor Traffic Insight|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| if (agent matches "\*Windows \*" OR agent matches "\*Win32\*" OR agent matches "\*Win64\*","Windows","") as OS <br />\| if (agent matches "\*Macintosh\*" OR agent matches "\*Darwin/\*" OR agent matches "\*Mac OS\*","MacOS",OS) as OS <br />\| if (agent matches "\* CrOS \*","Chrome OS",OS) as OS<br />\| if (agent matches "\*Linux\*","Linux",OS) as OS <br />\| if (agent matches "\*iPad\*","iPad",OS) as OS <br />\| if (agent matches "\*iPhone\*","iPhone",OS) as OS <br />\|  if (agent matches "\*Android\*","Android",OS) as OS <br />\| if (agent matches "\*Windows Phone\*","Windows Phone",OS) as OS <br />\| if (OS == "","Other",OS) as OS <br />\| if (agent matches "Mozilla/\*; rv:\*)\*","Mozilla","") as Browser<br />\| if (agent matches "\*MSIE\*","Internet Explorer",Browser) as Browser <br />\| if (agent matches "\*Firefox\*","Firefox",Browser) as Browser <br />\| if (agent matches "\*Safari\*","Safari",Browser) as Browser <br />\| if (OS=="Android" AND agent matches "\*WebKit\*","WebKit",Browser) as Browser<br />\| if ((OS=="iPhone" OR OS=="iPad") AND (agent matches "\*Mobile/\*" OR agent matches "\*AppleWebKit\*(KHTML\*Gecko)\*"),"Mobile Safari",Browser) as Browser<br />\| if (browser ="" AND OS=="MacOS" AND agent matches "Mozilla/\* (Macintosh;\*(KHTML, like Gecko)\*","Safari",Browser) as Browser <br />\| if (agent matches "\*MobileSafari/\*","Mobile Safari",Browser) as Browser<br />\| if (agent matches "\*Chrome\*","Chrome",Browser) as Browser <br />\| if (agent matches "Opera\*","Opera",Browser) as Browser <br />\| if (agent matches "Dolphin\*","Dolphin",Browser) as Browser <br />\|  if (Browser == "","Other",Browser) as Browser  <br />\| count by OS,browser<br />\| transpose row os column browser as \*|
|Varnish/Metrics|Busy Servers over Time|Metrics|Varnish/Metrics/Varnish - Backend Servers|\_sourceCategory = Labs/varnish metric=varnish\_backend\_busy cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host |
|Varnish/Metrics|Bytes In (Pipe Sessions)|Metrics|Varnish/Metrics/Varnish - Clients|\_sourceCategory = Labs/varnish metric=varnish\_s\_pipe\_in cache\_cluster={{cache\_cluster}} host={{host}}  \| sum by cache\_cluster,host|
|Varnish/Metrics|Bytes Out (Pipe Sessions)|Metrics|Varnish/Metrics/Varnish - Clients|\_sourceCategory = Labs/varnish metric=varnish\_s\_pipe\_out cache\_cluster={{cache\_cluster}} host={{host}}  \| sum by cache\_cluster,host|
|Varnish/Logs|Bytes Served|Logs|Varnish/Logs/Varnish - Visitor Traffic Insight|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where size != "-" and size != ""<br />\| num(size) as size<br />\| sum(size) as Bytes\_Served|
|Varnish/Logs|Bytes Served - Outlier|Logs|Varnish/Logs/Varnish - Outlier Analysis|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where size != "-" and !isEmpty(size)<br />\| number(size)<br />\| (size/(1024\*1024)) as mbytes <br />\| timeslice {{timeslice}}<br />\| sum(mbytes) as mbytes by \_timeslice <br />\| sort \_timeslice asc<br />\| outlier mbytes window={{window}}, threshold={{threshold}}, consecutive={{consecutive}}, direction=+|
|Varnish/Metrics|Bytes Used by the Persisted Ban Lists (Bytes)|Metrics|Varnish/Metrics/Varnish - Bans and Bans Lurker|\_sourceCategory = Labs/varnish metric=varnish\_bans\_persisted\_bytes cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host|
|Varnish|Cache Hit %|Metrics|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish metric=varnish\_cache\_hit cache\_cluster={{cache\_cluster}}  \| avg |
|Varnish/Metrics|Cache Hit %|Metrics|Varnish/Metrics/Varnish - Cache Performance|\_sourceCategory = Labs/varnish metric=varnish\_cache\_hit cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,  host|
|Varnish/Metrics|Cache Hit Rate Over Time|Metrics|Varnish/Metrics/Varnish - Cache Performance|\_sourceCategory = Labs/varnish metric=varnish\_cache\_hit cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host \| rate|
|Varnish|Cache Hits (%)|Metrics|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish metric=varnish\_cache\_hit cache\_cluster={{cache\_cluster}}   \| sum by cache\_cluster, host |
|Varnish/Metrics|Cache Used (MB)|Metrics|Varnish/Metrics/Varnish - Cache Performance|\_sourceCategory = Labs/varnish metric=varnish\_s0\_g\_bytes cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host \| eval \_value/1024/1024|
|Varnish/Logs|Client Errors|Logs|Varnish/Logs/Varnish - Outlier Analysis|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| if(status\_code matches "4\*", 1, 0) as client\_errors <br />\| timeslice {{timeslice}}<br />\| count as client\_errors by \_timeslice<br />\| sort \_timeslice asc<br />\| outlier client\_errors window={{window}}, threshold={{threshold}}, consecutive={{consecutive}}, direction=+|
|Varnish/Logs|Client Locations - 4xx Errors|Logs|Varnish/Logs/Varnish - Web Server Operations|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where status\_code matches "4\*" <br />\|  lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = client\_ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Varnish/Metrics|Client Requests|Metrics|Varnish/Metrics/Varnish - Clients|\_sourceCategory = Labs/varnish metric=varnish\_client\_req cache\_cluster={{cache\_cluster}} host={{host}}  \| sum by cache\_cluster,host |
|Varnish/Metrics|Completed|Metrics|Varnish/Metrics/Varnish - Bans and Bans Lurker|\_sourceCategory = Labs/varnish metric=varnish\_bans\_completed cache\_cluster={{cache\_cluster}} host={{host}} \| sum by metric|
|Varnish/Metrics|Connection Retries|Metrics|Varnish/Metrics/Varnish - Backend Servers|\_sourceCategory = Labs/varnish metric=varnish\_backend\_retry cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host|
|Varnish/Metrics|Connections Failed|Metrics|Varnish/Metrics/Varnish - Backend Servers|\_sourceCategory = Labs/varnish metric=varnish\_backend\_fail cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host |
|Varnish/Metrics|Connections Recycled|Metrics|Varnish/Metrics/Varnish - Backend Servers|\_sourceCategory = Labs/varnish metric=varnish\_backend\_recycle  cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host|
|Varnish/Metrics|Connections Reused|Metrics|Varnish/Metrics/Varnish - Backend Servers|\_sourceCategory = Labs/varnish metric=varnish\_backend\_reuse cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host |
|Varnish/Metrics|Count of Cache Hits with Grace|Metrics|Varnish/Metrics/Varnish - Cache Performance|\_sourceCategory = Labs/varnish metric=varnish\_cache\_hit\_grace cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host|
|Varnish/Metrics|Deleted|Metrics|Varnish/Metrics/Varnish - Bans and Bans Lurker|\_sourceCategory = Labs/varnish metric=varnish\_bans\_deleted cache\_cluster={{cache\_cluster}} host={{host}} \| sum by metric|
|Varnish/Logs|Error Responses by Server|Logs|Varnish/Logs/Varnish - Web Server Operations|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| if (isEmpty(pod),\_sourceHost,pod) as host<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| num(status\_code)<br />\| where status\_code \>= 400<br />\| timeslice 5m<br />\| count as count by \_timeslice,host<br />\| transpose row \_timeslice column host|
|Varnish/Metrics|Expired Objects Because of TTL|Metrics|Varnish/Metrics/Varnish - Cache Performance|\_sourceCategory = Labs/varnish metric=varnish\_n\_expired cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host |
|Varnish/Metrics|Extra Bytes in Persisted Ban Lists Due to Fragmentation (Bytes)|Metrics|Varnish/Metrics/Varnish - Bans and Bans Lurker|\_sourceCategory = Labs/varnish metric=varnish\_bans\_persisted\_fragmentation cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host|
|Varnish|Fetch Requests by Host|Metrics|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish metric=varnish\_s\_fetch cache\_cluster={{cache\_cluster}} \| sum by cache\_cluster, host |
|Varnish|Frontend Network (MB) by Host|Metrics|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish metric=varnish\_s\_resp\_hdrbytes cache\_cluster={{cache\_cluster}} \| sum by cache\_cluster, host |
|Varnish|Frontend Requests by Host|Metrics|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish metric=varnish\_client\_req cache\_cluster={{cache\_cluster}} \| sum by cache\_cluster,host |
|Varnish/Logs|Highly Malicious Threat Table|Logs|Varnish/Logs/Varnish - Threat Intel|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| lookup type, actor, raw, threatlevel as Malicious\_Confidence from sumo://threat/cs on threat=remote\_ip <br />\| where  type="ip\_address" and !isNull(Malicious\_Confidence)<br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| where Malicious\_Confidence matches "high"<br />\| count as count by Malicious\_Confidence, Actor, remote\_ip, status\_code, uri<br />\| sort by count<br />\| limit 20|
|Varnish/Metrics|Hits/Misses Over Time|Metrics|Varnish/Metrics/Varnish - Cache Performance|\_sourceCategory = Labs/varnish metric=varnish\_cache\_hit cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host|
|Varnish/Logs|HTTP Methods|Logs|Varnish/Logs/Varnish - Visitor Traffic Insight|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| count by method|
|Varnish|Loaded VMODs|Metrics|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish metric=varnish\_vmods cache\_cluster={{cache\_cluster}} \| sum by metric|
|Varnish/Metrics|Lurker Gave Way for Lookup|Metrics|Varnish/Metrics/Varnish - Bans and Bans Lurker|\_sourceCategory = Labs/varnish metric=varnish\_bans\_lurker\_contention cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host|
|Varnish/Metrics|Malformed Requests|Metrics|Varnish/Metrics/Varnish - Clients|\_sourceCategory = Labs/varnish metric=varnish\_client\_req\_400 cache\_cluster={{cache\_cluster}} host={{host}}  \| sum by cache\_cluster,host |
|Varnish/Metrics|Max Threads Hit|Metrics|Varnish/Metrics/Varnish - Threads|\_sourceCategory = Labs/varnish metric=varnish\_threads\_limited cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host|
|Varnish/Logs|Media Types Served|Logs|Varnish/Logs/Varnish - Visitor Traffic Insight|\_sourceCategory = Labs/varnish cache\_system=varnish  cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| parse regex field=uri "^[^\\?]+?\\.(?\<type\>[a-zA-Z]{2,4})\$" <br />\| parse regex field=uri "/\\S+?(?\<email\_prefix\>(?:%40\|@)[^.]+?)\\.\\w+" nodrop <br />\| where email\_prefix="" <br />\| count as count by type|
|Varnish/Metrics|Network Requests (MB)|Metrics|Varnish/Metrics/Varnish - Clients|\_sourceCategory = Labs/varnish metric=varnish\_s\_req\_hdrbytes cache\_cluster={{cache\_cluster}} \| sum by cache\_cluster, host |
|Varnish/Metrics|Network Requests (MB)|Metrics|Varnish/Metrics/Varnish - Backend Servers|\_sourceCategory = Labs/varnish metric=varnish\_boot\_\*\_bereq\_bodybytes cache\_cluster={{cache\_cluster}} host={{host}} \| parse field=metric varnish\_boot\_\*\_bereq\_bodybytes as backend\_name \| sum by cache\_cluster,host,backend\_name |
|Varnish/Metrics|Network Responses (MB)|Metrics|Varnish/Metrics/Varnish - Clients|\_sourceCategory = Labs/varnish metric=varnish\_s\_resp\_bodybytes cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host |
|Varnish/Metrics|Network Responses (MB)|Metrics|Varnish/Metrics/Varnish - Backend Servers|\_sourceCategory = Labs/varnish metric=varnish\_boot\_\*\_beresp\_bodybytes cache\_cluster={{cache\_cluster}} host={{host}} \| parse field=metric varnish\_boot\_\*\_beresp\_bodybytes as backend\_name \| sum by cache\_cluster,host,backend\_name |
|Varnish/Logs|Non 200 Response Status Codes|Logs|Varnish/Logs/Varnish - Web Server Operations|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br /> \| where !(status\_code matches "2\*") <br /> \| count as count by status\_code <br />\| sort by count, status\_code asc|
|Varnish/Logs|Number of Hits by Server - One Day Time Comparison|Logs|Varnish/Logs/Varnish  - Traffic Timeline Analysis|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| if (isEmpty(pod),\_sourceHost,pod) as host<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| count as Number\_of\_Hits by host  <br />\| compare with timeshift 1d|
|Varnish/Logs|Number of Visitors|Logs|Varnish/Logs/Varnish - Outlier Analysis|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where !isEmpty(remote\_ip)<br />\| timeslice {{timeslice}}<br />\| count as hits by \_timeslice <br />\| sort \_timeslice asc<br />\| outlier hits window={{window}}, threshold={{threshold}}, consecutive={{consecutive}}, direction=+|
|Varnish/Metrics|Objects Forcefully Evicted|Metrics|Varnish/Metrics/Varnish - Cache Performance|\_sourceCategory = Labs/varnish metric=varnish\_n\_lru\_nuked cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host|
|Varnish/Metrics|Objects Killed by Bans|Metrics|Varnish/Metrics/Varnish - Bans and Bans Lurker|\_sourceCategory = Labs/varnish metric=varnish\_bans\_obj\_killed cache\_cluster={{cache\_cluster}} host={{host}} \| sum by metric|
|Varnish/Metrics|Objects Killed by Bans (Lurker)|Metrics|Varnish/Metrics/Varnish - Bans and Bans Lurker|\_sourceCategory = Labs/varnish metric=varnish\_bans\_lurker\_obj\_killed cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host|
|Varnish|Persisted Ban Lists Memory Usage (Bytes)|Metrics|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish metric=varnish\_bans\_persisted\_bytes cache\_cluster={{cache\_cluster}} \| sum by cache\_cluster, host |
|Varnish|Pools|Metrics|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish metric=varnish\_pools cache\_cluster={{cache\_cluster}} \| sum by metric|
|Varnish/Logs|Popular Mobile Device Versions|Logs|Varnish/Logs/Varnish - Visitor Traffic Insight|\_sourceCategory = Labs/varnish cache\_system=varnish ( iphone or ipad or android or samsung) cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw  <br />\| parse regex "\\((?\<device\>iPhone).+? CPU iPhone OS (?\<version\>.+?) like Mac"  nodrop <br />\| parse regex "\\((?\<device\>iPad).+? CPU OS (?\<version\>.+?) like Mac"  nodrop <br />\| parse regex " (?\<device\>Android) (?\<version\>[\\d\\.]+)" nodrop <br />\| parse regex "(?\<device\>SAMSUNG).+?(?\<version\>(?:GT-\\w+\|SGH-\\w+\|SPH-\\w+\|SCH-\\w+))" <br />\| count as count by device,version <br />\| sort count <br />\| limit 10 <br />|
|Varnish/Metrics|Requests|Metrics|Varnish/Metrics/Varnish - Backend Servers|\_sourceCategory = Labs/varnish metric=varnish\_backend\_req cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host|
|Varnish/Metrics|Requests Fetched from a Backend|Metrics|Varnish/Metrics/Varnish - Cache Performance|\_sourceCategory = Labs/varnish metric=varnish\_cache\_miss cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host |
|Varnish/Metrics|Requests Passed to a Backend|Metrics|Varnish/Metrics/Varnish - Cache Performance|\_sourceCategory = Labs/varnish metric=varnish\_cache\_hitpass cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host |
|Varnish/Metrics|Requests Served|Metrics|Varnish/Metrics/Varnish - Cache Performance|\_sourceCategory = Labs/varnish metric=varnish\_cache\_hit cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host |
|Varnish/Metrics|Requests with a Bad Expect: Header|Metrics|Varnish/Metrics/Varnish - Clients|\_sourceCategory = Labs/varnish metric=varnish\_client\_req\_417 cache\_cluster={{cache\_cluster}} host={{host}}  \| sum by cache\_cluster,host|
|Varnish|Responses Over Time|Logs|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"\\?]+?)(?:\\"\|\\?)"<br />\| if(status\_code matches "2\*", 1, 0) as successes <br />\| if(status\_code matches "3\*", 1, 0) as redirects <br />\| if(status\_code matches "4\*", 1, 0) as client\_errors <br />\| if(status\_code matches "5\*", 1, 0) as server\_errors <br />\| timeslice by 5m <br />\| sum(successes) as successes, sum(client\_errors) as client\_errors,  sum(redirects) as redirects, sum(server\_errors) as server\_errors by \_timeslice<br />\| sort by \_timeslice asc|
|Varnish/Logs|Responses Over Time|Logs|Varnish/Logs/Varnish  - Traffic Timeline Analysis|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| if(Status\_Code matches "2\*", 1, 0) as Successes <br />\| if(Status\_Code matches "3\*", 1, 0) as Redirects <br />\| if(status\_code matches "4\*", 1, 0) as Client\_Errors <br />\| if(Status\_Code matches "5\*", 1, 0) as Server\_Errors <br />\| timeslice by 1h <br />\| sum(Successes) as Successes, sum(Client\_Errors) as Client\_Errors,  sum(Redirects) as Redirects, sum(Server\_Errors) as Server\_Errors by \_timeslice<br />\| sort by \_timeslice asc|
|Varnish/Logs|Server Errors|Logs|Varnish/Logs/Varnish - Outlier Analysis|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| if(status\_code matches "5\*", 1, 0) as server\_errors <br />\| timeslice {{timeslice}}<br />\| count as server\_errors by \_timeslice<br />\| sort \_timeslice asc<br />\| outlier server\_errors window={{window}}, threshold={{threshold}}, consecutive={{consecutive}}, direction=+|
|Varnish/Logs|Server Errors Over Time|Logs|Varnish/Logs/Varnish - Web Server Operations|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where status\_code matches "5\*"<br />\| timeslice 5m<br />\| count as count by \_timeslice,status\_code<br />\| transpose row \_timeslice column status\_code as \*<br />|
|Varnish/Metrics|Servers|Metrics|Varnish/Metrics/Varnish - Backend Servers|\_sourceCategory = Labs/varnish metric=varnish\_n\_backend cache\_cluster={{cache\_cluster}} host={{host}} \| sum by metric|
|Varnish/Metrics|Session Queue Length Waiting for Threads|Metrics|Varnish/Metrics/Varnish - Threads|\_sourceCategory = Labs/varnish metric=varnish\_thread\_queue\_len cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host|
|Varnish/Metrics|Sessions|Metrics|Varnish/Metrics/Varnish - Clients|\_sourceCategory = Labs/varnish metric=varnish\_s\_sess cache\_cluster={{cache\_cluster}} host={{host}}  \| sum by cache\_cluster,host |
|Varnish/Metrics|Sessions Acceptance Failures|Metrics|Varnish/Metrics/Varnish - Clients|\_sourceCategory = Labs/varnish metric=varnish\_sess\_fail cache\_cluster={{cache\_cluster}} host={{host}}  \| sum by cache\_cluster,host|
|Varnish/Metrics|Sessions Accepted|Metrics|Varnish/Metrics/Varnish - Clients|\_sourceCategory = Labs/varnish metric=varnish\_sess\_conn cache\_cluster={{cache\_cluster}} host={{host}}  \| sum by cache\_cluster,host |
|Varnish|Sessions Accepted by Host|Metrics|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish metric=varnish\_sess\_conn section=main cache\_cluster={{cache\_cluster}} \| sum by cache\_cluster, host|
|Varnish/Metrics|Sessions Closed|Metrics|Varnish/Metrics/Varnish - Clients|\_sourceCategory = Labs/varnish metric=varnish\_sess\_closed cache\_cluster={{cache\_cluster}} host={{host}}  \| sum by cache\_cluster,host|
|Varnish/Metrics|Sessions Closed with Error|Metrics|Varnish/Metrics/Varnish - Clients|\_sourceCategory = Labs/varnish metric=varnish\_sess\_closed\_err cache\_cluster={{cache\_cluster}} host={{host}}  \| sum by cache\_cluster,host |
|Varnish/Metrics|Sessions Dropped Due to a Full Queue|Metrics|Varnish/Metrics/Varnish - Clients|\_sourceCategory = Labs/varnish metric=varnish\_sess\_dropped cache\_cluster={{cache\_cluster}} host={{host}}  \| sum by cache\_cluster,host |
|Varnish/Metrics|Sessions Dropped Due to Lack of Worker Thread|Metrics|Varnish/Metrics/Varnish - Clients|\_sourceCategory = Labs/varnish metric=varnish\_sess\_drop cache\_cluster={{cache\_cluster}} host={{host}}  \| sum by cache\_cluster,host |
|Varnish/Metrics|Sessions Queued|Metrics|Varnish/Metrics/Varnish - Clients|\_sourceCategory = Labs/varnish metric=varnish\_sess\_queued cache\_cluster={{cache\_cluster}} host={{host}}  \| sum by cache\_cluster,host |
|Varnish/Metrics|Successful Connections|Metrics|Varnish/Metrics/Varnish - Backend Servers|\_sourceCategory = Labs/varnish metric=varnish\_backend\_conn cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host|
|Varnish/Metrics|Thread Creation Failed|Metrics|Varnish/Metrics/Varnish - Threads|\_sourceCategory = Labs/varnish metric=varnish\_threads\_failed cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host|
|Varnish/Metrics|Thread Pools|Metrics|Varnish/Metrics/Varnish - Threads|\_sourceCategory = Labs/varnish metric=varnish\_pools cache\_cluster={{cache\_cluster}} host={{host}} \| sum by metric|
|Varnish/Metrics|Threads|Metrics|Varnish/Metrics/Varnish - Threads|\_sourceCategory = Labs/varnish metric=varnish\_threads cache\_cluster={{cache\_cluster}} host={{host}} \| sum by metric|
|Varnish|Threads|Metrics|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish metric=varnish\_threads cache\_cluster={{cache\_cluster}} \| sum by metric|
|Varnish/Metrics|Threads Created|Metrics|Varnish/Metrics/Varnish - Threads|\_sourceCategory = Labs/varnish metric=varnish\_threads\_created cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host|
|Varnish/Metrics|Threads Destroyed|Metrics|Varnish/Metrics/Varnish - Threads|\_sourceCategory = Labs/varnish metric=varnish\_threads\_destroyed cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host|
|Varnish/Logs|Threat by Actors|Logs|Varnish/Logs/Varnish - Threat Intel|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| count as ip\_count by remote\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=remote\_ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (ip\_count) as threat\_count by Actor|
|Varnish/Logs|Threat by Malicious Confidence|Logs|Varnish/Logs/Varnish - Threat Intel|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| count as ip\_count by remote\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=remote\_ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (ip\_count) as threat\_count by malicious\_confidence|
|Varnish/Logs|Threat Locations|Logs|Varnish/Logs/Varnish - Threat Intel|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| count as ip\_count by client\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=client\_ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where type="ip\_address" and !isNull(malicious\_confidence)<br />\| count by client\_ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = client\_ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Varnish/Logs|Threat Table|Logs|Varnish/Logs/Varnish - Threat Intel|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| lookup type, actor, raw, threatlevel as Malicious\_Confidence from sumo://threat/cs on threat=remote\_ip <br />\| where  type="ip\_address" and !isNull(Malicious\_Confidence)<br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| where Malicious\_Confidence matches "high"<br />\| count as count by Malicious\_Confidence, Actor, remote\_ip, status\_code, uri,referrer,agent<br />\| sort by count<br />\| limit 50|
|Varnish/Logs|Threats|Logs|Varnish/Logs/Varnish - Threat Intel|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| count as ip\_count by remote\_ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=remote\_ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (ip\_count) as threat\_count|
|Varnish/Logs|Top 10 Bots Observed|Logs|Varnish/Logs/Varnish - Web Server Operations|\_sourceCategory = Labs/varnish cache\_system=varnish ("Googlebot" OR "AskJeeves" OR "Digger" OR "Lycos"<br />OR "msnbot" OR "Inktomi Slurp" OR "Yahoo" OR "Nutch" OR "bingbot" OR<br />"BingPreview" OR "Mediapartners-Google" OR "proximic" OR "AhrefsBot" OR<br />"AdsBot-Google" OR "Ezooms" OR "AddThis.com" OR "facebookexternalhit" OR<br />"MetaURI" OR "Feedfetcher-Google" OR "PaperLiBot" OR "TweetmemeBot" OR<br />"Sogou web spider" OR "GoogleProducer" OR "RockmeltEmbedder" OR<br />"ShareThisFetcher" OR "YandexBot" OR "rogerbot-crawler" OR "ShowyouBot" OR "Baiduspider" OR "Sosospider" OR "Exabot") cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| parse regex field=agent "(?\<bot\_name\>facebook)externalhit?\\W+" nodrop<br />\| parse regex field=agent "Feedfetcher-(?\<bot\_name\>Google?)\\S+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>PaperLiBot?)/.+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>TweetmemeBot?)/.+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>msn?)bot\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Nutch?)-.+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Google?)bot\\W" nodrop<br />\| parse regex field=agent "Feedfetcher-(?\<bot\_name\>Google?)\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Yahoo?)!\\s+Slurp[;/].+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>bing?)bot\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Bing?)Preview\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Sogou?)\\s+web\\s" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Yandex?)Bot\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>rogerbot?)\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>AddThis\\.com?)\\s+robot\\s+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>ShareThis?)Fetcher/.+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Ahrefs?)Bot/.+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>MetaURI?)\\s+API/.+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Showyou?)Bot\\s+" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Google?)Producer;" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Ezooms?)\\W" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Rockmelt?)Embedder\\s+" nodrop <br />\| parse regex field=agent "(?\<bot\_name\>Sosospider?)\\W" nodrop <br />\| parse regex field=agent "(?\<bot\_name\>Baidu?)spider" nodrop<br />\| parse regex field=agent "(?\<bot\_name\>Exabot?)\\W"<br />\| where bot\_name != ""<br />\| if (bot\_name="bing","Bing",bot\_name) as bot\_name<br />\| count as count by bot\_name<br />\| sort by count <br />//\| limit 10|
|Varnish/Logs|Top 10 PC and Mac Versions|Logs|Varnish/Logs/Varnish - Visitor Traffic Insight|\_sourceCategory = Labs/varnish cache\_system=varnish ("macintosh" OR "mac os" OR "windows" OR "i686" or "PC" or ("Linux" AND !android)) cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| parse regex field=agent "(?\<os\>Mac OS) (?\<version\>[^;\\)]+?)(?:;\|\\))" nodrop <br />\| parse regex field=agent "(?\<os\>Windows)(?: NT \| )(?\<version\>[\\d.]+)" nodrop <br />\| parse regex field=agent "(?\<os\>Linux) (?\<version\>\\S+?)(?:\\)\|;)" nodrop <br />\| where os!=""<br />\| count as count by os,version<br />\| sort count <br />\| limit 10 |
|Varnish/Logs|Top 10 Search Terms from Popular Search Engines|Logs|Varnish/Logs/Varnish - Visitor Traffic Insight|\_sourceCategory = Labs/varnish cache\_system=varnish  (google OR bing OR aol OR ask OR yahoo) ("p=" OR "q=" OR "wd=" OR "searchfor=") cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| parse regex field=referrer "(?:\\?\|&)(?:p\|q\|wd\|searchfor)=(?\<search\_term\>[^=]+?)(?:&\|\$)" nodrop <br />\| where search\_term!=""<br />\| urldecode(search\_term)<br />\| if(referrer matches "\*google.\*","Google","") as engine<br />\| if(referrer matches "\*bing.\*","Bing",engine) as engine<br />\| if(referrer matches "\*ask.com\*","Ask.com",engine) as engine<br />\| if(referrer matches "\*aol.\*","AOL",engine) as engine<br />\| if(referrer matches "\*yahoo.\*","Yahoo",engine) as engine<br />\| where engine !="" <br />\| count as count  by search\_term<br />\| sort count <br />\| limit 10|
|Varnish|Top 10 URLs causing Errors|Logs|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where status\_code matches "4\*" or status\_code matches "5\*"<br />\| if (isEmpty(pod),\_sourceHost,pod) as Host<br />\| count by uri,Host<br />\| top 10 Host,uri by \_count<br />\| \_count as count<br />\| fields -\_count|
|Varnish/Logs|Top 5 Clients Causing 4xx Errors|Logs|Varnish/Logs/Varnish - Web Server Operations|\_sourceCategory = Labs/varnish cache\_system=varnish (400 OR 401 OR 402 OR 403 OR 404) cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where status\_code matches "4\*"<br />\| count as count by client\_ip<br />\| sort count <br />\| limit 5 <br />|
|Varnish/Logs|Top 5 Clients Causing 5xx Errors|Logs|Varnish/Logs/Varnish - Web Server Operations|\_sourceCategory = Labs/varnish cache\_system=varnish (500 or 501 or 502 or 503 or 504 or 505 or 506 or 507 or 508 or 509) cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where status\_code matches "5\*"<br />\| count as count by client\_ip<br />\| sort count <br />\| limit 5 <br />|
|Varnish/Logs|Top 5 Highly Malicious URLs|Logs|Varnish/Logs/Varnish - Threat Intel|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| count as ip\_count by remote\_ip, uri<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=remote\_ip <br />\| where malicious\_confidence matches "high"<br />\| count as count by uri<br />\| limit 5|
|Varnish/Logs|Top 5 Messages in the Error Logs|Logs|Varnish/Logs/Varnish - Web Server Operations|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "\\s\\[(?\<log\_level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<message\>[A-Za-z][^,]+)(?:,\|\$)" nodrop<br />\| where length(message) \>0<br />\| count as count by message<br />\| sort count <br />\| limit 5<br />|
|Varnish/Logs|Top 5 Referrers|Logs|Varnish/Logs/Varnish - Visitor Traffic Insight|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where length(referrer)\>0<br />\| count by referrer<br />\| sort by \_count<br />\| limit 5 <br /><br />|
|Varnish/Logs|Top 5 URIs causing 4xx Responses|Logs|Varnish/Logs/Varnish - Web Server Operations|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where status\_code matches "4\*"<br />\| count as count by uri<br />\| sort count, uri asc<br />\| limit 5 |
|Varnish/Logs|Top 5 URIs Causing 5xx Responses|Logs|Varnish/Logs/Varnish - Web Server Operations|\_sourceCategory = Labs/varnish cache\_system=varnish  (500 or 501 or 502 or 503 or 504 or 505 or 506 or 507 or 508 or 509) cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where status\_code matches "5\*"<br />\| count as count by uri<br />\| sort count, uri asc<br />\| limit 5 |
|Varnish/Logs|Top 5 URLs|Logs|Varnish/Logs/Varnish - Visitor Traffic Insight|\_sourceCategory = Labs/varnish cache\_system=varnish  cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"\\?]+?)(?:\\"\|\\?)s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| count as count by uri<br />\| sort by count<br />\| limit 5|
|Varnish/Logs|Top Clients|Logs|Varnish/Logs/Varnish - Web Server Operations|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| lookup country\_name from geo://location on ip = client\_ip<br />\| count as count by client\_ip, country\_name<br />\| sort count<br />\| limit 10<br />|
|Varnish|Traffic Distribution by Server|Logs|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| timeslice 5m<br />\| if (isEmpty(pod),\_sourceHost,pod) as host<br />\| count by \_timeslice,host  <br />\| transpose row \_timeslice column host|
|Varnish/Logs|Traffic Distribution by Server|Logs|Varnish/Logs/Varnish  - Traffic Timeline Analysis|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| if (isEmpty(pod),\_sourceHost,pod) as host<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| timeslice 1h<br />\| count by \_timeslice, host  <br />\| transpose row \_timeslice column host|
|Varnish/Logs|Traffic Volume and GBytes Served|Logs|Varnish/Logs/Varnish  - Traffic Timeline Analysis|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where size != "-"<br />\| timeslice 1h<br />\| (size/(1048576\*1000)) as gbytes <br />\| count as hits, sum(gbytes) as gbytes by \_timeslice <br />\| sort \_timeslice asc|
|Varnish|Traffic Volume and MB Served Over Time|Logs|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<remote\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"\\?]+?)(?:\\"\|\\?)"<br />\| where size != "-"<br />\| timeslice 5m <br />\|  (size/(1024\*1024)) as Megabytes <br />\|  count as hits, sum(Megabytes) as Megabytes by \_timeslice <br />\| sort \_timeslice asc|
|Varnish/Metrics|Unhealthy Servers|Metrics|Varnish/Metrics/Varnish - Backend Servers|\_sourceCategory = Labs/varnish metric=varnish\_backend\_unhealthy cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host |
|Varnish/Metrics|Unused Cache (MB)|Metrics|Varnish/Metrics/Varnish - Cache Performance|\_sourceCategory = Labs/varnish metric=varnish\_s0\_g\_space  cache\_cluster={{cache\_cluster}} host={{host}} \| sum by cache\_cluster,host \| eval \_value/1024/1024|
|Varnish|Uptime|Metrics|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish metric=varnish\_uptime section=main cache\_cluster={{cache\_cluster}} \| eval \_value/(86400)  \| topk(1, latest)|
|Varnish|Visitor Locations|Logs|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\|  lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = client\_ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Varnish|Visitor Locations - 4xx Errors|Logs|Varnish/Varnish - Overview|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| where !(client\_ip matches "127.0.0.1")<br />\| where status\_code matches "4\*" <br />\|  lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = client\_ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Varnish/Logs|Visitor Locations - One Day Time Comparison|Logs|Varnish/Logs/Varnish  - Traffic Timeline Analysis|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = client\_ip<br />\| where !isEmpty(country\_name)<br />\| count as Visitors\_Locations by country\_name<br />\| sort Visitors\_Locations <br />\| compare with timeshift 1d<br />\| limit 10|
|Varnish/Logs|Visits by Country Over Time|Logs|Varnish/Logs/Varnish - Visitor Traffic Insight|\_sourceCategory = Labs/varnish cache\_system=varnish  cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\|  lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = client\_ip<br />\| where !isNull(country\_name) AND country\_name !=""<br />\| timeslice 5m<br />\| count by \_timeslice,country\_name<br />\| transpose row \_timeslice column country\_name as \* <br />|
|Varnish/Logs|Vistor Platforms|Logs|Varnish/Logs/Varnish - Visitor Traffic Insight|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"]+)\\"\\s+\\"(?\<agent\>[^\\"]+?)\\""<br />\| if (agent matches "\*iPad\*" OR agent matches "\*iPhone\*" OR agent matches "\*Android\*" OR agent matches "\*BlackBerry\*" OR agent matches "\*Galaxy\*" OR agent matches "LGE-\*" OR agent matches "SCH-\*" OR agent matches "\*HUAWEI-\*" OR agent matches "\*SAMSUNG\*" OR agent matches "\*samsung\*" OR agent matches "Dalvik/\*" OR agent matches "Nokia\*" OR agent matches "LG-\*" OR agent matches "\*CFNetwork\*"  OR agent matches "\*UP.Browser/\*" OR agent matches "\*QQ\*rowser\*" OR agent matches "\*NetFront/\*" OR agent matches "\*Windows Phone\*" OR agent matches "\*Mobile Safari\*" OR agent matches "\*iemobile\*","Mobile","") as type<br />\| if (agent matches "\*Windows\*" OR agent matches "\*Win64\*" OR agent matches "\*Win32\*" OR agent matches "\*i686\*" OR agent matches "\*x86\*","PC",type) as type<br />\| if (agent matches "\*Macintosh\*" OR agent matches "\*Mac OS\*","Mac",type) as type<br />\| if (type = "","bots/unknown",type) as type<br />\| count type<br />|
|Varnish/Logs|Worldwide|Logs|Varnish/Logs/Varnish - Visitor Traffic Insight|\_sourceCategory = Labs/varnish cache\_system=varnish cache\_cluster={{cache\_cluster}} \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "(?\<client\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<local\_ip\>\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})\\s+(?\<logname\>\\S+)\\s+(?\<user\>[\\S]+)\\s+\\[" nodrop<br />\| parse regex "\\s+\\[(?\<date\>[^\\]]+)\\]\\s+\\"(?\<method\>\\w+)\\s+(?\<uri\>\\S+)\\s+(?\<protocol\>\\S+)\\"\\s+(?\<status\_code\>\\d+)\\s+(?\<size\>[\\d-]+)" nodrop<br />\| parse regex "\\"(?\<referrer\>http[s]{0,1}:[^\\"\\?]+?)(?:\\"\|\\?)s+\\"(?\<agent\>[^\\"]+?)\\""<br />\|  lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = client\_ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|

