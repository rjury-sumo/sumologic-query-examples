# MySQL
## Sumo Logic App For: MySQL
The Sumo Logic App for MySQL is a unified logs and metrics app that helps you monitor the availability, performance and resource utilization of MySQL database clusters. Preconfigured dashboards and searches provide insight into the health of your MySQL clusters, replication status, error logs, query performance, slow queries, Innodb operations, failed logins and error logs.
Docs Link: [MySQL](https://help.sumologic.com/?cid=1058)

## Searches

### Log Searches

- **Avg Execution Time by Slow SQL Cmds**: from Dashboard: MySQL/Logs/MySQL - Slow Queries 
- **Crash Recovery Attempts Over Time**: from Dashboard: MySQL/Logs/MySQL - Error Logs 
- **Error Log Type Over Time**: from Dashboard: MySQL/Logs/MySQL - Error Logs 
- **Errors**: from Dashboard: MySQL/MySQL - Overview 
- **Excessive Slow Queries (>=15 secs)**: from Dashboard: MySQL/MySQL - Overview 
- **Excessive Slow Queries by Host**: from Dashboard: MySQL/Logs/MySQL - Slow Queries 
- **Excessive Slow Queries Over Time**: from Dashboard: MySQL/Logs/MySQL - Slow Queries 
- **Failed Login Attempts**: from Dashboard: MySQL/MySQL - Overview 
- **Failed Login Attempts**: from Dashboard: MySQL/Logs/MySQL - Failed Logins 
- **Failed Login Attempts - Details**: from Dashboard: MySQL/Logs/MySQL - Failed Logins 
- **Failed Login Attempts - Location**: from Dashboard: MySQL/Logs/MySQL - Failed Logins 
- **Failed Login Attempts Trend**: from Dashboard: MySQL/Logs/MySQL - Failed Logins 
- **Log Reduce**: from Dashboard: MySQL/Logs/MySQL - Error Logs 
- **MySQL -  Slow Query Server Location**: from Search: MySQL/Logs/MySQL -  Slow Query Server Location 
- **MySQL - Crash Recovery Attempts by Host**: from Search: MySQL/Logs/MySQL - Crash Recovery Attempts by Host 
- **MySQL - Number of Replication Completion Events by Host**: from Search: MySQL/Logs/MySQL - Number of Replication Completion Events by Host 
- **MySQL - Replication Failures by Host**: from Search: MySQL/Logs/MySQL - Replication Failures by Host 
- **MySQL - Server Latest Replication State**: from Search: MySQL/Logs/MySQL - Server Latest Replication State 
- **MySQL - Server Latest Running State**: from Search: MySQL/Logs/MySQL - Server Latest Running State 
- **MySQL - Server Up-Down Events by Host**: from Search: MySQL/Logs/MySQL - Server Up-Down Events by Host 
- **Replication Errors**: from Dashboard: MySQL/MySQL - Overview 
- **Replication Start-Stop Events**: from Dashboard: MySQL/Logs/MySQL - Replication 
- **Replication Status Over Time**: from Dashboard: MySQL/MySQL - Overview 
- **Replication Status Over Time**: from Dashboard: MySQL/Logs/MySQL - Replication 
- **Server Start and Shutdown Events Over Time**: from Dashboard: MySQL/Logs/MySQL - Error Logs 
- **Slow Queries by Hosts**: from Dashboard: MySQL/Logs/MySQL - Slow Queries 
- **Slow Queries Over Time**: from Dashboard: MySQL/Logs/MySQL - Slow Queries 
- **Slow Queries Over Time**: from Dashboard: MySQL/MySQL - Overview 
- **Slow Query by Cmd Type**: from Dashboard: MySQL/Logs/MySQL - Slow Queries 
- **Stopped Servers**: from Dashboard: MySQL/Logs/MySQL - Error Logs 
- **Top 10 Excessive Slow Queries by Frequency**: from Dashboard: MySQL/Logs/MySQL - Slow Queries 
- **Top 10 Failed Login Attempts by Hosts**: from Dashboard: MySQL/Logs/MySQL - Failed Logins 
- **Top 10 Failed Login Attempts by Users**: from Dashboard: MySQL/Logs/MySQL - Failed Logins 
- **Top 10 Slow Queries by Average Execution Time**: from Dashboard: MySQL/Logs/MySQL - Slow Queries 
- **Top Errors**: from Dashboard: MySQL/Logs/MySQL - Error Logs 
- **Top IP Firing Slow Queries**: from Dashboard: MySQL/Logs/MySQL - Slow Queries 
- **Top Reasons for Replication Failures**: from Dashboard: MySQL/Logs/MySQL - Replication 
- **Top Users Firing Slow Queries**: from Dashboard: MySQL/Logs/MySQL - Slow Queries 
- **Top Warnings**: from Dashboard: MySQL/Logs/MySQL - Error Logs

### Metric Searches

- **Aborted and Locked Connects**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Aborted Clients**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Avg Row Lock Rate**: from Dashboard: MySQL/MySQL - Overview 
- **Avg Statement Time (ms)**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Avg Table IO Waits (ms)**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Bytes Sent, Received**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Connection Errors**: from Dashboard: MySQL/MySQL - Overview 
- **Connection Errors**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Connection Errors (Internal  and Max Connections)**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Connections**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Executed SQL Statements**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **FSync Op Count**: from Dashboard: MySQL/MySQL - Overview 
- **FSync Op Count**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Innodb Buffer Pool Read Requests vs Disk Reads**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Innodb Buffer Pool Usage**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Innodb Buffer Pool Usage**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Innodb Data (fsyncs, read, write)**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Innodb Row Lock Waits**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Innodb Row Lock Waits**: from Dashboard: MySQL/MySQL - Overview 
- **Innodb Rows (read, updated, inserted, deleted)**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Innodb Waits**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **No Index Used**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Open Table Cache Hit Ratio**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Opened Tables and Files**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Queries Executed**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Queries Executed**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Queries Executed**: from Dashboard: MySQL/MySQL - Overview 
- **Query Cache (Hits, Inserts)**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Questions**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Questions**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Rows (Examined, Sent, Affected)**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Select Types**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Server Uptime**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Server Uptime**: from Dashboard: MySQL/MySQL - Overview 
- **Slow Queries**: from Dashboard: MySQL/MySQL - Overview 
- **Slow Queries**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Sorts (Rows, Merge Passes)**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Sorts (Rows, Range, Scan, Merge Passes)**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Statement (No Index Used)**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Statement Errors**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Statement Time**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Statement Warnings**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Statement With Errors**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Statement With Warnings**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Statements**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Statements**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Table Lock Waits**: from Dashboard: MySQL/MySQL - Overview 
- **Table Open Cache Hits, Misses and Overflows**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Tables Locks**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Temporary Objects**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Threads (Created, Running, Cached, Connected)**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics 
- **Tmp Objects**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Total Index IO Waits**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Total Index IO Waits (milliseconds)**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Total Table IO Waits**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Total Table IO Waits (milliseconds)**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Total Table Lock Read Waits**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Total Table Lock Read Waits (milliseconds)**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Total Table Lock Write Waits**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Total Table Lock Write Waits (milliseconds)**: from Dashboard: MySQL/Metrics/MySQL - Performance Schema Metrics 
- **Worker Threads**: from Dashboard: MySQL/Metrics/MySQL - Performance and Resource Metrics

## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|MySQL/Metrics|Aborted and Locked Connects|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_aborted\_connects db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Aborted Clients|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_aborted\_clients db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Logs|Avg Execution Time by Slow SQL Cmds|Logs|MySQL/Logs/MySQL - Slow Queries|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "User@Host" "Query\_time"<br />\| parse regex "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" // Pttrn2-vrtn4<br />\| parse regex field=query\_block "SET timestamp=(?\<set\_timestamp\>\\d\*);(?:\\\\n\|\\n)(?\<sql\_cmd\>[\\s\\S]\*);" nodrop<br />\| parse regex field=sql\_cmd "[^a-zA-Z]\*(?\<sql\_cmd\_type\>[a-zA-Z]+)(?:\\s\|\\\\n\|\\n)" nodrop<br />\| parse field=sql\_cmd "# administrator command: \*" as admn\_sql\_cmd<br />\| if (sql\_cmd matches "# administrator command: \*", admn\_sql\_cmd, sql\_cmd\_type) as sql\_cmd\_type<br />\| toUpperCase(sql\_cmd\_type)<br />\| fields -query\_block<br />\| timeslice 1h<br />\| avg(query\_time) as avg\_query\_time group by \_timeslice, sql\_cmd\_type<br />\| transpose row \_timeslice column sql\_cmd\_type|
|MySQL|Avg Row Lock Rate|Metrics|MySQL/MySQL - Overview|\_sourceCategory = Labs/MySQL\* metric=mysql\_innodb\_row\_lock\_waits db\_cluster={{db\_cluster}} \| avg|
|MySQL/Metrics|Avg Statement Time (ms)|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_events\_statements\_seconds\_total db\_cluster={{db\_cluster}} server={{server}} schema={{schema}} digest=\* \| avg|
|MySQL/Metrics|Avg Table IO Waits (ms)|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_table\_io\_waits\_total\_\* db\_cluster={{db\_cluster}} server={{server}} schema={{schema}} name={{object\_name}} \| avg|
|MySQL/Metrics|Bytes Sent, Received|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_bytes\_received db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Connection Errors|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_connection\_errors\_\* db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL|Connection Errors|Metrics|MySQL/MySQL - Overview|\_sourceCategory = Labs/MySQL\* metric=mysql\_connection\_errors\_\* db\_cluster={{db\_cluster}} \| sum|
|MySQL/Metrics|Connection Errors (Internal  and Max Connections)|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_connection\_errors\_internal db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Connections|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_mysqlx\_connections\_accepted db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Logs|Crash Recovery Attempts Over Time|Logs|MySQL/Logs/MySQL - Error Logs|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "Starting crash recovery"<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| \_sourceHost as Host<br />\| timeslice 1h<br />\| count as recovery\_attempts by \_timeslice|
|MySQL/Logs|Error Log Type Over Time|Logs|MySQL/Logs/MySQL - Error Logs|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} (Error or Warning or Note or Info or Information or DEBUG or CRITICAL)<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| where touppercase(ErrorLogtype) in ("ERROR", "WARNING", "NOTE", "INFO", "INFORMATION", "DEBUG", "CRITICAL")<br />\| timeslice 1h<br />\| count by \_timeslice, ErrorLogtype<br />\| transpose row \_timeslice column ErrorLogType|
|MySQL|Errors|Logs|MySQL/MySQL - Overview|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "[ERROR]"<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)"<br />\| where ErrorLogtype="ERROR" \| count as error\_count|
|MySQL|Excessive Slow Queries (\>=15 secs)|Logs|MySQL/MySQL - Overview|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "User@Host" "Query\_time"  <br />\| parse regex "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" // Pttrn2-vrtn4<br />\| fields -query\_block<br />\| num(query\_time)<br />\| 15 as threshold // customize if need different value. As an example query taking more than 15 Seconds is considered as Excessive Slow. <br />\| where query\_time \>= threshold \| count as queries\_count|
|MySQL/Logs|Excessive Slow Queries by Host|Logs|MySQL/Logs/MySQL - Slow Queries|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "User@Host" "Query\_time"<br />\| parse regex "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" // Pttrn2-vrtn4<br />\| num(query\_time)<br />\| 15 as threshold // customize if need different value. As an example query taking more than 15 Seconds is considered as Excessive Slow. <br />\| where (query\_time \>= threshold)<br />\| \_sourceHost as Host<br />\| fields -query\_block<br />\| count as queries\_count by Host \| sort by queries\_count|
|MySQL/Logs|Excessive Slow Queries Over Time|Logs|MySQL/Logs/MySQL - Slow Queries|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "User@Host" "Query\_time"<br />\| parse regex "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" // Pttrn2-vrtn4<br />\| num(query\_time)<br />\| 15 as threshold // customize if need different value. As an example query taking more than 15 Seconds is considered as Excessive Slow. <br />\| where query\_time \>= threshold <br />\| timeslice 1h<br />\| count as queries\_count by \_timeslice|
|MySQL/Metrics|Executed SQL Statements|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_commands\_insert db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL|Failed Login Attempts|Logs|MySQL/MySQL - Overview|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "[Warning]" Access denied for user<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| parse field=ErrorMsg "Access denied for user '\*'@'\*' (using password: YES)" as user, ip\_address<br />\| count as failed\_login\_count|
|MySQL/Logs|Failed Login Attempts|Logs|MySQL/Logs/MySQL - Failed Logins|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "[Warning]" Access denied for user<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| parse field=ErrorMsg "Access denied for user '\*'@'\*' (using password: YES)" as user, ip\_address<br />\| count as failed\_login\_event\_count|
|MySQL/Logs|Failed Login Attempts - Details|Logs|MySQL/Logs/MySQL - Failed Logins|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "[Warning]" Access denied for user<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| parse field=ErrorMsg "Access denied for user '\*'@'\*' (using password: YES)" as user, ip\_address<br />\| timeslice 1s<br />\| count as event\_count by \_timeslice, user, ip\_address, db\_cluster<br />\| sort by \_timeslice|
|MySQL/Logs|Failed Login Attempts - Location|Logs|MySQL/Logs/MySQL - Failed Logins|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "[Warning]" Access denied for user<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| parse field=ErrorMsg "Access denied for user '\*'@'\*' (using password: YES)" as user, ip\_address<br />\| count as event\_count by ip\_address<br />\| lookup latitude, longitude, country\_name, state, city from geo://location on ip = ip\_address<br />\| where !isNull(latitude)|
|MySQL/Logs|Failed Login Attempts Trend|Logs|MySQL/Logs/MySQL - Failed Logins|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "[Warning]" Access denied for user<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| parse field=ErrorMsg "Access denied for user '\*'@'\*' (using password: YES)" as user, ip\_address<br />\| timeslice 1h<br />\| count as event\_count by \_timeslice|
|MySQL|FSync Op Count|Metrics|MySQL/MySQL - Overview|\_sourceCategory = Labs/MySQL\* metric=mysql\_innodb\_data\_fsyncs db\_cluster={{db\_cluster}} \| sum|
|MySQL/Metrics|FSync Op Count|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_innodb\_data\_fsyncs db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Innodb Buffer Pool Read Requests vs Disk Reads|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_innodb\_buffer\_pool\_read\_requests db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Innodb Buffer Pool Usage|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_innodb\_buffer\_pool\_pages\_total db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Innodb Buffer Pool Usage|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_Innodb\_buffer\_pool\_pages\_total db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Innodb Data (fsyncs, read, write)|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_innodb\_data\_read db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Innodb Row Lock Waits|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_innodb\_row\_lock\_waits db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL|Innodb Row Lock Waits|Metrics|MySQL/MySQL - Overview|\_sourceCategory = Labs/MySQL\* metric=mysql\_innodb\_row\_lock\_waits db\_cluster={{db\_cluster}} \| sum|
|MySQL/Metrics|Innodb Rows (read, updated, inserted, deleted)|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_innodb\_rows\_read db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Innodb Waits|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_innodb\_log\_waits db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Logs|Log Reduce|Logs|MySQL/Logs/MySQL - Error Logs|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} ("ERROR" or "CRITICAL") <br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| logreduce(mesg) by db\_cluster limit=20<br />\| \_count as count \| fields -\_count \| sort by count, signature asc|
|MySQL/Logs|MySQL -  Slow Query Server Location|Logs|MySQL/Logs/MySQL -  Slow Query Server Location|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster=\* "User@Host" "Query\_time"<br />\| parse regex "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ (?\<host\_name\>\\S+)\\s\\[(?\<ip\_addr\>\\S\*?)\\]" nodrop // Pttrn1-vrtn1<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @\\s+\\[(?\<ip\_addr\>\\S\*?)\\]\\s+Id:\\s+(?\<Id\>\\d{1,10})" nodrop // Pttrn1-vrtn2<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ (?\<host\_name\>\\S+)\\s\\[(?\<ip\_addr\>\\S\*?)\\]\\s+Id:\\s+(?\<Id\>\\d{1,10})" // Pttrn1-vrtn3<br />\| count by db\_cluster, ip\_addr, host\_name<br />\| where !isEmpty(ip\_addr)<br />\| lookup latitude, longitude, country\_name, state, city, postal\_code from geo://location on ip=ip\_addr<br />\| where !isNull(latitude)|
|MySQL/Logs|MySQL - Crash Recovery Attempts by Host|Logs|MySQL/Logs/MySQL - Crash Recovery Attempts by Host|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster=\* "Starting crash recovery"<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| where mesg matches "\*Starting crash recovery\*"<br />\| \_sourceHost as Host<br />\| count as recovery\_attempts by Host, db\_cluster <br />\| Sort by recovery\_attempts|
|MySQL/Logs|MySQL - Number of Replication Completion Events by Host|Logs|MySQL/Logs/MySQL - Number of Replication Completion Events by Host|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster=\* "Slave SQL thread" "because it reached its UNTIL position"<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| parse field=ErrorMsg "Slave SQL thread \* because it reached its UNTIL position \*" as State, StoppedUntilPosition<br />\| timeslice 3h<br />\| count by \_timeslice, \_sourceHost, db\_cluster<br />\| transpose row \_timeslice column \_sourceHost, db\_cluster|
|MySQL/Logs|MySQL - Replication Failures by Host|Logs|MySQL/Logs/MySQL - Replication Failures by Host|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster=\* "[ERROR]" ("Slave I/O" or "Error reading packet from server" or "Slave SQL")<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| where ErrorLogtype="ERROR"<br />\| parse field=ErrorMsg "\*: error \* to master '\*' - retry-time: \* retries: \*, Error\_code: \*" as subsystem, action, Master, Retry\_time, Retries, Error\_code nodrop<br />\| parse field=ErrorMsg "\*: Got fatal error \*, Error\_code: \*" as subsystem, Error\_Msg, Error\_code nodrop<br />\| parse field=ErrorMsg "\*: \* ( server\_errno=\*)" as subsystem, Error\_Msg, Error\_code nodrop<br />\| parse field=ErrorMsg "\*: The slave I/O thread stops because \*. Error:\*, Error\_code: \*" as subsystem, Error\_Msg\_details, Error\_Msg, Error\_code nodrop<br />\| parse field=ErrorMsg "\*: \* Default database: '\*'. Query: '\*', Error\_code: \*" as subsystem, Error\_Msg, Default\_Database, Query, Error\_code nodrop<br />\| parse field=ErrorMsg "\*: Cou\*d not execute \*" as subsystem, f1, Error\_Msg nodrop<br />\| parse field=ErrorMsg "\*: Master command \*, Error\_code: \*" as subsystem, Error\_Msg, Error\_code nodrop<br />\| parse field=ErrorMsg "\* thread couldn't register on master" as subsystem nodrop<br />\| timeslice 1h<br />\| \_sourceHost as host<br />\| count by \_timeslice, host, db\_cluster<br />\| transpose row \_timeslice column host, db\_cluster|
|MySQL/Logs|MySQL - Server Latest Replication State|Logs|MySQL/Logs/MySQL - Server Latest Replication State|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster=\* ("[Note]" or ("[ERROR]" ("Slave I/O" or "Error reading packet from server" or "Slave SQL")))<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| parse field=ErrorMsg "Slave SQL thread initialized, \* replication in log '\*' at position \*, relay log '\*' position: \*" as replication\_state, ReplicationLog, ReplicationPosition, ReplayLog, RelayPosition nodrop<br />\| parse field=ErrorMsg "Slave SQL thread \* because it reached its UNTIL position \*" as replication\_state, StoppedUntilPosition nodrop<br />\| parse field=ErrorMsg "Error reading relay log event: slave SQL thread was \*" as replication\_state nodrop<br />\| if(\_raw matches "\*[ERROR] Slave I/O\*" or \_raw matches "\*[ERROR] Error reading packet from server\*"  or \_raw matches "\*[ERROR] Slave SQL\*","failed", replication\_state) as replication\_state<br />\| where replication\_state in ("starting", "stopped", "killed", "failed")<br />\| if (replication\_state in ("starting", "stopped"), "Up", "Down") as replication\_state<br />\| \_sourceHost as Host<br />\| withtime replication\_state \| withtime \_messagetime<br />\| most\_recent(replication\_state\_withtime) as replication\_state, most\_recent(\_messagetime\_withtime) as m\_time by host, db\_cluster<br />\| formatDate(fromMillis(m\_time), "MM-dd-yyyy HH:mm:ss:SSS Z") as event\_time<br />\| ((toMillis(now())-m\_time)/(1000\*60\*60)) as since\_hours \| format("%.2f", since\_hours) as since\_hours<br />\| concat ("Since ", since\_hours, " hours") as remark<br />\| fields - m\_time <br />\| fields db\_cluster, host, event\_time, replication\_state, remark|
|MySQL/Logs|MySQL - Server Latest Running State|Logs|MySQL/Logs/MySQL - Server Latest Running State|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster=\* mysqld ("ready for connections." or "Shutdown complete" or "Terminated." or "Normal shutdown" or "Shutting down" or "starting as process")<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| if (ErrorMsg matches "\*ready for connections.\*", "Up","Unknown") as server\_status<br />\| if (ErrorMsg matches "\*Terminated.\*", "Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Normal shutdown\*", "Shutting Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Shutting down\*", "Shutting Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Shutdown complete\*", "Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*starting as process\*", "Starting",server\_status) as server\_status<br />\| \_sourceHost as host<br />\| timeslice 15m<br />\| withtime server\_status \| withtime \_messagetime<br />\| most\_recent(server\_status\_withtime) as server\_status, most\_recent(\_messagetime\_withtime) as m\_time by host, db\_cluster<br />\| formatDate(fromMillis(m\_time), "MM-dd-yyyy HH:mm:ss:SSS Z") as event\_time<br />\| ((toMillis(now())-m\_time)/(1000\*60\*60)) as since\_hours \| format("%.2f", since\_hours) as since\_hours<br />\| concat ("Since ", since\_hours, " hours") as remark<br />\| fields - m\_time <br />\| fields host, event\_time, server\_status, remark, db\_cluster|
|MySQL/Logs|MySQL - Server Up-Down Events by Host|Logs|MySQL/Logs/MySQL - Server Up-Down Events by Host|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster=\* mysqld ("ready for connections." or "Shutdown complete" or "Terminated." or "Normal shutdown" or "Shutting down" or "starting as process")<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| if (ErrorMsg matches "\*ready for connections.\*", "Up","Unknown") as server\_status<br />\| if (ErrorMsg matches "\*Terminated.\*", "Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Normal shutdown\*", "Shutting Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Shutting down\*", "Shutting Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Shutdown complete\*", "Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*starting as process\*", "Starting",server\_status) as server\_status<br />\| \_sourceHost as Host<br />\| formatDate(fromMillis(\_messagetime), "MM-dd-yyyy HH:mm:ss.SSS Z")  as event\_time<br />\| count by host, event\_time, server\_status, db\_cluster<br />\| sort by host, event\_time, server\_status, db\_cluster<br />\| fields - \_count|
|MySQL/Metrics|No Index Used|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_events\_statements\_no\_index\_used\_total schema={{schema}} digest=\* db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Open Table Cache Hit Ratio|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_table\_open\_cache\_hits db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Opened Tables and Files|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_opened\_tables db\_cluster={{db\_cluster}} server={{server}}\| sum|
|MySQL|Queries Executed|Metrics|MySQL/MySQL - Overview|\_sourceCategory = Labs/MySQL\* metric=mysql\_queries db\_cluster={{db\_cluster}} \| sum|
|MySQL/Metrics|Queries Executed|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_queries db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Queries Executed|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_queries db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Query Cache (Hits, Inserts)|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_qcache\_hits db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Questions|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_questions db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Questions|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_questions db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL|Replication Errors|Logs|MySQL/MySQL - Overview|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} (("[ERROR]" and ("Slave I/O" or "Error reading packet from server" or "Slave SQL")) or "[Note] Error reading relay log event: slave SQL thread was killed")<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| count as replication\_failure\_count|
|MySQL/Logs|Replication Start-Stop Events|Logs|MySQL/Logs/MySQL - Replication|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "[Note]" "SQL thread"<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| parse field=ErrorMsg "Slave SQL thread initialized, \* replication in log '\*' at position \*, relay log '\*' position: \*" as State,ReplicationLog,ReplicationPosition,ReplayLog,RelayPosition nodrop<br />\| parse field=ErrorMsg "Slave SQL thread \* because it reached its UNTIL position \*" as State, StoppedUntilPosition nodrop<br />\| where state in ("starting", "stopped")<br />\| timeslice 1h<br />\| count as event\_count by \_timeslice, state<br />\| transpose row \_timeslice column state as starting, stopped<br />\| (starting+stopped)/2 as halfway\_count|
|MySQL/Logs|Replication Status Over Time|Logs|MySQL/Logs/MySQL - Replication|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} ("[Note]" or ("[ERROR]" ("Slave I/O" or "Error reading packet from server" or "Slave SQL")))<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| parse field=ErrorMsg "Slave SQL thread initialized, \* replication in log '\*' at position \*, relay log '\*' position: \*" as State,ReplicationLog,ReplicationPosition,ReplayLog,RelayPosition nodrop<br />\| parse field=ErrorMsg "Slave SQL thread \* because it reached its UNTIL position \*" as State, StoppedUntilPosition nodrop<br />\| parse field=ErrorMsg "Error reading relay log event: slave SQL thread was \*" as state nodrop<br />\| if(\_raw matches "\*[ERROR] Slave I/O\*" or \_raw matches "\*[ERROR] Error reading packet from server\*"  or \_raw matches "\*[ERROR] Slave SQL\*","failed",state) as state<br />\| where state in ("starting", "stopped", "killed", "failed")<br />\| timeslice 1h<br />\| count by \_timeslice, state<br />\| transpose row \_timeslice column state<br />\| fillmissing timeslice(1h)|
|MySQL|Replication Status Over Time|Logs|MySQL/MySQL - Overview|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} ("[Note]" or ("[ERROR]" ("Slave I/O" or "Error reading packet from server" or "Slave SQL")))<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| parse field=ErrorMsg "Slave SQL thread initialized, \* replication in log '\*' at position \*, relay log '\*' position: \*" as State,ReplicationLog,ReplicationPosition,ReplayLog,RelayPosition nodrop<br />\| parse field=ErrorMsg "Slave SQL thread \* because it reached its UNTIL position \*" as State, StoppedUntilPosition nodrop<br />\| parse field=ErrorMsg "Error reading relay log event: slave SQL thread was \*" as state nodrop<br />\| if(\_raw matches "\*[ERROR] Slave I/O\*" or \_raw matches "\*[ERROR] Error reading packet from server\*"  or \_raw matches "\*[ERROR] Slave SQL\*","failed",state) as state<br />\| where state in ("starting", "stopped", "killed", "failed")<br />\| timeslice 1h<br />\| count by \_timeslice, state<br />\| transpose row \_timeslice column state<br />\| fillmissing timeslice(1h)|
|MySQL/Metrics|Rows (Examined, Sent, Affected)|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_events\_statements\_rows\_examined\_total schema={{schema}} digest=\* db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Select Types|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_select\_full\_join db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Logs|Server Start and Shutdown Events Over Time|Logs|MySQL/Logs/MySQL - Error Logs|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} mysqld ("ready for connections." or "Shutdown complete" or "Terminated." or "Normal shutdown" or "Shutting down" or "starting as process")<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| if (ErrorMsg matches "\*ready for connections.\*", "Up","Unknown") as server\_status<br />\| if (ErrorMsg matches "\*Terminated.\*", "Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Normal shutdown\*", "Shutting Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Shutting down\*", "Shutting Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Shutdown complete\*", "Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*starting as process\*", "Starting",server\_status) as server\_status<br />\| timeslice 15m<br />\| count by \_timeslice, server\_status<br />\| transpose row \_timeslice column server\_status|
|MySQL|Server Uptime|Metrics|MySQL/MySQL - Overview|\_sourceCategory = Labs/MySQL\* metric=mysql\_uptime db\_cluster={{db\_cluster}} \| max \| eval \_value / 86400|
|MySQL/Metrics|Server Uptime|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_uptime db\_cluster={{db\_cluster}} server={{server}} \| max \| eval \_value / 86400|
|MySQL|Slow Queries|Metrics|MySQL/MySQL - Overview|\_sourceCategory = Labs/MySQL\* metric=mysql\_slow\_queries db\_cluster={{db\_cluster}} \| sum|
|MySQL/Metrics|Slow Queries|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_slow\_queries db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Logs|Slow Queries by Hosts|Logs|MySQL/Logs/MySQL - Slow Queries|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "User@Host" "Query\_time"<br />\| parse regex "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" nodrop // Pttrn2-vrtn4<br />\| num(query\_time) as query\_time<br />\| where query\_time \>= {{slow\_query\_latency}}<br />\| \_sourceHost as Host<br />\| fields -query\_block<br />\| count as queries\_count by Host <br />\| sort by queries\_count|
|MySQL/Logs|Slow Queries Over Time|Logs|MySQL/Logs/MySQL - Slow Queries|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "User@Host" "Query\_time"<br />\| parse regex "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" nodrop // Pttrn2-vrtn4<br />\| num(query\_time) as query\_time<br />\| where query\_time \>= {{slow\_query\_latency}}<br />\| timeslice 1h<br />\| count as queries\_count by \_timeslice|
|MySQL|Slow Queries Over Time|Logs|MySQL/MySQL - Overview|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "User@Host" "Query\_time"<br />\| parse regex "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| timeslice 1h<br />\| count as queries\_count by \_timeslice|
|MySQL/Logs|Slow Query by Cmd Type|Logs|MySQL/Logs/MySQL - Slow Queries|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "User@Host" "Query\_time"<br />\| parse regex "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "SET timestamp=(?\<set\_timestamp\>\\d\*);(?:\\\\n\|\\n)(?\<sql\_cmd\>[\\s\\S]\*);" nodrop<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" nodrop // Pttrn2-vrtn4<br />\| num(query\_time) as query\_time<br />\| where query\_time \>= {{slow\_query\_latency}}<br />\| parse regex field=sql\_cmd "[^a-zA-Z]\*(?\<sql\_cmd\_type\>[a-zA-Z]+)(?:\\s\|\\\\n\|\\n)" nodrop<br />\| parse field=sql\_cmd "# administrator command: \*" as admn\_sql\_cmd<br />\| if (sql\_cmd matches "# administrator command: \*", admn\_sql\_cmd, sql\_cmd\_type) as sql\_cmd\_type<br />\| toUpperCase(sql\_cmd\_type)<br />\| fields -query\_block<br />\| count as frequency group by sql\_cmd\_type \| sort by frequency|
|MySQL/Metrics|Sorts (Rows, Merge Passes)|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_events\_statements\_sort\_rows\_total schema={{schema}} digest=\* db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Sorts (Rows, Range, Scan, Merge Passes)|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_sort\_rows db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Statement (No Index Used)|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_events\_statements\_no\_index\_used\_total db\_cluster={{db\_cluster}} server={{server}} schema={{schema}} digest=\* \| sum|
|MySQL/Metrics|Statement Errors|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_events\_statements\_errors\_total schema={{schema}} digest=\* db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Statement Time|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_events\_statements\_seconds\_total schema={{schema}} digest=\* db\_cluster={{db\_cluster}} server={{server}} \| avg|
|MySQL/Metrics|Statement Warnings|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_events\_statements\_warnings\_total schema={{schema}} digest=\* db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Statement With Errors|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_events\_statements\_errors\_total db\_cluster={{db\_cluster}} server={{server}} schema={{schema}} digest=\* \| sum|
|MySQL/Metrics|Statement With Warnings|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_events\_statements\_warnings\_total db\_cluster={{db\_cluster}} server={{server}} schema={{schema}} digest=\* \| sum|
|MySQL/Metrics|Statements|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_events\_statements\_total schema={{schema}} digest=\* db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Statements|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_events\_statements\_total db\_cluster={{db\_cluster}} server={{server}} schema={{schema}} digest=\* \| sum|
|MySQL/Logs|Stopped Servers|Logs|MySQL/Logs/MySQL - Error Logs|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} mysqld ("ready for connections."  or "Terminated." or "Shutdown complete" or "Normal shutdown")<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| if (ErrorMsg matches "\*ready for connections.\*", "Up","Unknown") as server\_status<br />\| if (ErrorMsg matches "\*Terminated.\*", "Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Normal shutdown\*", "Shutting Down", server\_status) as server\_status<br />\| if (ErrorMsg matches "\*Shutdown complete\*", "Down", server\_status) as server\_status<br />\| \_sourceHost as Host<br />\| timeslice 100s<br />\| withtime server\_status \| withtime \_messagetime<br />\| most\_recent(server\_status\_withtime) as server\_status, most\_recent(\_messagetime\_withtime) as m\_time by Host, db\_cluster<br />\| formatDate(fromMillis(m\_time), "MM-dd-yyyy HH:mm:ss:SSS Z") as event\_time<br />\| ((toMillis(now())-m\_time)/(1000\*60)) as since\_mins \| format("%.2f", since\_mins) as since\_minutes<br />\| concat ("Since ", since\_minutes, " minutes") as remark<br />\| where server\_status != "Up"<br />\| fields - m\_time, since\_mins, since\_minutes <br />\| fields Host, event\_time, server\_status, remark, db\_cluster|
|MySQL|Table Lock Waits|Metrics|MySQL/MySQL - Overview|\_sourceCategory = Labs/MySQL\* metric=mysql\_table\_locks\_waited db\_cluster={{db\_cluster}} \| sum|
|MySQL/Metrics|Table Open Cache Hits, Misses and Overflows|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_table\_open\_cache\_hits db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Tables Locks|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_table\_locks\_immediate db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Temporary Objects|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_created\_tmp\_disk\_tables db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Threads (Created, Running, Cached, Connected)|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_threads\_created db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Tmp Objects|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_events\_statements\_tmp\_tables\_total schema={{schema}} digest=\* db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Logs|Top 10 Excessive Slow Queries by Frequency|Logs|MySQL/Logs/MySQL - Slow Queries|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "User@Host" "Query\_time"<br />\| parse regex "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ (?\<host\_name\>\\S+)\\s\\[(?\<ip\_addr\>\\S\*?)\\]" nodrop // Pttrn1-vrtn1<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @\\s+\\[(?\<ip\_addr\>\\S\*?)\\]\\s+Id:\\s+(?\<Id\>\\d{1,10})" nodrop // Pttrn1-vrtn2<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ (?\<host\_name\>\\S+)\\s\\[(?\<ip\_addr\>\\S\*?)\\]\\s+Id:\\s+(?\<Id\>\\d{1,10})" // Pttrn1-vrtn3<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" // Pttrn2-vrtn4<br />\| parse regex field=query\_block "# Bytes\_sent:\\s+(?\<bytes\_sent\>\\d\*)\\s+Tmp\_tables:\\s+(?\<tmp\_tables\>\\d\*)\\s+Tmp\_disk\_tables:\\s+(?\<temp\_disk\_tables\>\\d\*)\\s+Tmp\_table\_sizes:\\s+(?\<tmp\_table\_sizes\>\\d\*)\\n" nodrop // Pttrn3-vrtn1<br />\| parse regex field=query\_block "# Bytes\_sent:\\s+(?\<bytes\_sent\>\\d\*)\\n" nodrop // Pttrn3-vrtn2<br />\| parse regex field=query\_block "SET timestamp=(?\<set\_timestamp\>\\d\*);(?:\\\\n\|\\n)(?\<sql\_cmd\>[\\s\\S]\*);" nodrop<br />\| fields -query\_block<br />\| count as frequency, sum(query\_time) as total\_time, min(query\_time) as min\_time, max(query\_time) as max\_time, avg(query\_time) as avg\_time, avg(rows\_examined) as avg\_rows\_examined, avg(rows\_sent) as avg\_rows\_sent, avg(Lock\_Time) as avg\_lock\_time group by sql\_cmd, db\_cluster<br />\| where avg\_time \>= {{slow\_query\_latency}}<br />\| sort by frequency \| limit 10|
|MySQL/Logs|Top 10 Failed Login Attempts by Hosts|Logs|MySQL/Logs/MySQL - Failed Logins|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "[Warning]" Access denied for user<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| parse field=ErrorMsg "Access denied for user '\*'@'\*' (using password: YES)" as user, ip\_address<br />\| count as event\_count by ip\_address<br />\| top 10 ip\_address by event\_count|
|MySQL/Logs|Top 10 Failed Login Attempts by Users|Logs|MySQL/Logs/MySQL - Failed Logins|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "[Warning]" Access denied for user<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| parse field=ErrorMsg "Access denied for user '\*'@'\*' (using password: YES)" as user, ip\_address<br />\| count as event\_count by user<br />\| top 10 user by event\_count|
|MySQL/Logs|Top 10 Slow Queries by Average Execution Time|Logs|MySQL/Logs/MySQL - Slow Queries|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "User@Host" "Query\_time"  <br />\| parse regex "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ (?\<host\_name\>\\S+)\\s\\[(?\<ip\_addr\>\\S\*?)\\]" nodrop // Pttrn1-vrtn1<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @\\s+\\[(?\<ip\_addr\>\\S\*?)\\]\\s+Id:\\s+(?\<Id\>\\d{1,10})" nodrop // Pttrn1-vrtn2<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ (?\<host\_name\>\\S+)\\s\\[(?\<ip\_addr\>\\S\*?)\\]\\s+Id:\\s+(?\<Id\>\\d{1,10})" // Pttrn1-vrtn3<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" // Pttrn2-vrtn4<br />\| parse regex field=query\_block "# Bytes\_sent:\\s+(?\<bytes\_sent\>\\d\*)\\s+Tmp\_tables:\\s+(?\<tmp\_tables\>\\d\*)\\s+Tmp\_disk\_tables:\\s+(?\<temp\_disk\_tables\>\\d\*)\\s+Tmp\_table\_sizes:\\s+(?\<tmp\_table\_sizes\>\\d\*)\\n" nodrop // Pttrn3-vrtn1<br />\| parse regex field=query\_block "# Bytes\_sent:\\s+(?\<bytes\_sent\>\\d\*)\\n" nodrop // Pttrn3-vrtn2<br />\| parse regex field=query\_block "SET timestamp=(?\<set\_timestamp\>\\d\*);(?:\\\\n\|\\n)(?\<sql\_cmd\>[\\s\\S]\*);" nodrop<br />\| fields -query\_block<br />\| avg(query\_time) as avg\_time, sum(query\_time) as total\_time, min(query\_time) as min\_time, max(query\_time) as max\_time, avg(rows\_examined) as avg\_rows\_examined, avg(rows\_sent) as avg\_rows\_sent, avg(Lock\_Time) as avg\_lock\_time, count as frequency group by sql\_cmd, db\_cluster<br />\| where avg\_time \>= {{slow\_query\_latency}}<br />\| sort by avg\_time \| limit 10|
|MySQL/Logs|Top Errors|Logs|MySQL/Logs/MySQL - Error Logs|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "[ERROR]"<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)"<br />\| where ErrorLogtype="ERROR"<br />\| parse field=ErrorMsg "[\*] [\*] \*" as err\_code, subsystem, error\_message nodrop<br />\| if (!isEmpty(error\_message), error\_message, ErrorMsg) as error\_message<br />\| count as frequency by error\_message, db\_cluster, err\_code, subsystem<br />\| sort by frequency, error\_message asc<br />\| limit 30|
|MySQL/Logs|Top IP Firing Slow Queries|Logs|MySQL/Logs/MySQL - Slow Queries|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "User@Host" "Query\_time"  <br />\| parse regex "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ (?\<host\_name\>\\S+)\\s\\[(?\<ip\_addr\>\\S\*?)\\]" nodrop // Pttrn1-vrtn1<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @\\s+\\[(?\<ip\_addr\>\\S\*?)\\]\\s+Id:\\s+(?\<Id\>\\d{1,10})" nodrop // Pttrn1-vrtn2<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ (?\<host\_name\>\\S+)\\s\\[(?\<ip\_addr\>\\S\*?)\\]\\s+Id:\\s+(?\<Id\>\\d{1,10})" // Pttrn1-vrtn3<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" nodrop // Pttrn2-vrtn4<br />\| num(query\_time) as query\_time<br />\| where query\_time \>= {{slow\_query\_latency}}<br />\| fields -query\_block<br />\| count as frequency by ip\_addr <br />\| where !isEmpty(ip\_addr)<br />\| sort by frequency|
|MySQL/Logs|Top Reasons for Replication Failures|Logs|MySQL/Logs/MySQL - Replication|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} (("[ERROR]" and ("Slave I/O" or "Error reading packet from server" or "Slave SQL")) or ("[Note] Error reading relay log event: slave SQL thread was killed"))<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)" nodrop<br />\| ErrorMsg as error\_message<br />\| count as frequency by error\_message, db\_cluster<br />\| sort by frequency|
|MySQL/Logs|Top Users Firing Slow Queries|Logs|MySQL/Logs/MySQL - Slow Queries|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "User@Host" "Query\_time"<br />\| parse regex "(?\<query\_block\># User@Host:[\\S\\s]+?SET timestamp=\\d+;[\\S\\s]+?;)" multi<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ (?\<host\_name\>\\S+)\\s\\[(?\<ip\_addr\>\\S\*?)\\]" nodrop // Pttrn1-vrtn1<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @\\s+\\[(?\<ip\_addr\>\\S\*?)\\]\\s+Id:\\s+(?\<Id\>\\d{1,10})" nodrop // Pttrn1-vrtn2<br />\| parse regex field=query\_block "# User@Host: \\S+?\\[(?\<user\>\\S\*?)\\] @ (?\<host\_name\>\\S+)\\s\\[(?\<ip\_addr\>\\S\*?)\\]\\s+Id:\\s+(?\<Id\>\\d{1,10})" // Pttrn1-vrtn3<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d.]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d.]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d.]\*)\\s+Rows\_read:\\s+(?\<rows\_read\>[\\d.]\*)\\n" nodrop // Pttrn2-vrtn1<br />\| parse regex field=query\_block "Schema: (?\<schema\>(?:\\S\*\|\\s)?)\\s\*Last\_errno[\\s\\S]+?\\s+Killed:\\s+\\d+\\n" nodrop // Pttrn2-vrtn2<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)\\s+Rows\_affected:\\s+(?\<rows\_affected\>[\\d]\*)\\s+" nodrop // Pttrn2-vrtn3<br />\| parse regex field=query\_block "Query\_time:\\s+(?\<query\_time\>[\\d.]\*)\\s+Lock\_time:\\s+(?\<lock\_time\>[\\d.]\*)\\s+Rows\_sent:\\s+(?\<rows\_sent\>[\\d]\*)\\s+Rows\_examined:\\s+(?\<rows\_examined\>[\\d]\*)" nodrop // Pttrn2-vrtn4<br />\| num(query\_time) as query\_time<br />\| where query\_time \>= {{slow\_query\_latency}}<br />\| fields -query\_block<br />\| count as frequency by user \| sort by frequency|
|MySQL/Logs|Top Warnings|Logs|MySQL/Logs/MySQL - Error Logs|\_sourceCategory = Labs/MySQL\* db\_system=mysql db\_cluster={{db\_cluster}} "[Warning]"<br />\| json "log" nodrop \| if (\_raw matches "{\*", log, \_raw) as mesg<br />\| parse regex field=mesg "\\[(?\<ErrorLogtype\>[^\\]]\*)][\\:]\*\\s(?\<ErrorMsg\>.\*)"<br />\| where ErrorLogtype="Warning" <br />\| parse field=ErrorMsg "[\*] [\*] \*" as err\_code, subsystem, ErrorMessage nodrop<br />\| if (!isEmpty(ErrorMessage), ErrorMessage, ErrorMsg) as warning\_message<br />\| count as frequency by warning\_message, db\_cluster, err\_code, subsystem<br />\| sort by frequency, warning\_message asc<br />\| limit 30|
|MySQL/Metrics|Total Index IO Waits|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_index\_io\_waits\_total\_fetch schema={{schema}} name={{object\_name}} db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Total Index IO Waits (milliseconds)|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_index\_io\_waits\_seconds\_total\_fetch schema={{schema}} name={{object\_name}} db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Total Table IO Waits|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_table\_io\_waits\_total\_fetch schema={{schema}} name={{object\_name}} db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Total Table IO Waits (milliseconds)|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_table\_io\_waits\_seconds\_total\_fetch schema={{schema}} name={{object\_name}} db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Total Table Lock Read Waits|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_read\_normal perf\_query=sql\_lock\_waits\_total schema={{schema}} table=\* db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Total Table Lock Read Waits (milliseconds)|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_read\_normal perf\_query=sql\_lock\_waits\_seconds\_total schema={{schema}} table=\* db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Total Table Lock Write Waits|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_write\_normal perf\_query=sql\_lock\_waits\_total schema={{schema}} table=\* db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Total Table Lock Write Waits (milliseconds)|Metrics|MySQL/Metrics/MySQL - Performance Schema Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_perf\_schema\_write\_normal perf\_query=sql\_lock\_waits\_seconds\_total schema={{schema}} table=\* db\_cluster={{db\_cluster}} server={{server}} \| sum|
|MySQL/Metrics|Worker Threads|Metrics|MySQL/Metrics/MySQL - Performance and Resource Metrics|\_sourceCategory = Labs/MySQL\* metric=mysql\_mysqlx\_worker\_threads db\_cluster={{db\_cluster}} server={{server}} \| sum|

