# PCI Compliance For Palo Alto Networks 9
## Sumo Logic App For: PCI Compliance For Palo Alto Networks 9
The Sumo Logic App for Payment Card Industry (PCI) Compliance for Palo Alto Networks offers dashboards to monitor firewall traffic activity for compliance with PCI requirements 01, 02, and 04.
Docs Link: [PCI Compliance For Palo Alto Networks 9](https://help.sumologic.com/?cid=32746)

## Searches

### Log Searches

- **Allowed Insecure Transport Protocol to or from CDE**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 02, 04 - Insecure Data In Transit 
- **Allowed Network Activity by Direction**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Accepted and Rejected Traffic 
- **Allowed Network Activity by Transport and Internet Layer Protocol**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Accepted and Rejected Traffic 
- **Allowed Traffic By Application Over Time**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01, 02 - Data Access Monitoring 
- **Allowed Traffic Over Time**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Accepted and Rejected Traffic 
- **Denied Traffic Over Time**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Accepted and Rejected Traffic 
- **Inbound Network Activity**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Traffic Direction Monitoring 
- **Insecure Allowed Traffic by Application and Involved Host**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 02, 04 - Insecure Data In Transit 
- **Insecure Allowed Traffic by Protocol**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 02, 04 - Insecure Data In Transit 
- **Insecure Allowed Traffic by Target Port and Involved Host**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 02, 04 - Insecure Data In Transit 
- **Insecure Denied Traffic by Protocol**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 02, 04 - Insecure Data In Transit 
- **Multi-service Detected on Same Host**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01, 02 - Data Access Monitoring 
- **Network Activity - Unencrypted Default Port**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 02, 04 - Insecure Data In Transit 
- **Network Traffic Over Time**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Accepted and Rejected Traffic 
- **Outbound Network Activity**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Traffic Direction Monitoring 
- **Possible Horizontal Port Scan Attack - Allowed**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01, 02 - Data Access Monitoring 
- **Possible Port Scan Attack - Rejected**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01, 02 - Data Access Monitoring 
- **Possible Vertical Port Scan Attack - Allowed**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01, 02 - Data Access Monitoring 
- **Silently Dropped Traffic Over Time**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Accepted and Rejected Traffic 
- **Top 10 Host - Receiving Inbound Traffic**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Traffic Direction Monitoring 
- **Top 10 Host - Sending Outbound Traffic**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Traffic Direction Monitoring 
- **Top Destination IP**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Accepted and Rejected Traffic 
- **Top Destination IP**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Accepted and Rejected Traffic 
- **Top Source IP**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Accepted and Rejected Traffic 
- **Top Source IP**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Accepted and Rejected Traffic 
- **Top TCP Dest Ports**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01, 02 - Data Access Monitoring 
- **Top UDP Dest Ports**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01, 02 - Data Access Monitoring 
- **Traffic to Cardholder Environment**: from Dashboard: Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Traffic Direction Monitoring

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|PCI Compliance For Palo Alto Networks 9|Allowed Insecure Transport Protocol to or from CDE|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 02, 04 - Insecure Data In Transit|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow (21 or 23 or 513) // Unencrypted traffic default ports (FTP - port 21, telnet - port 23, rlogin - port 513)<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action="allow" and dest\_port in ("21", "23", "513")<br />// Note - Its assumed that the CDE comprise of IP address from 172.16.0.0/12, 192.168.0.0/16 and 10.0.0.0/8. User can configure specific IP addresses  based on org CDE IP address range(s)<br />\| where (<br />(compareCIDRPrefix("172.16.0.0", dest\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", dest\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", dest\_ip, toInt(8))) and<br /> (!compareCIDRPrefix("172.16.0.0", src\_ip, toInt(12)) and !compareCIDRPrefix("192.168.0.0", src\_ip, toInt(16)) and !compareCIDRPrefix("10.0.0.0", src\_ip, toInt(8))))<br /> or <br />(!compareCIDRPrefix("172.16.0.0", dest\_ip, toInt(12)) and !compareCIDRPrefix("192.168.0.0", dest\_ip, toInt(16)) and !compareCIDRPrefix("10.0.0.0", dest\_ip, toInt(8)))<br />\| timeslice 15m<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{app}}" = "\*", true, app matches "{{app}}")<br />\| count as eventCount by \_timeslice, dest\_ip, dest\_port, inbound\_interface, outbound\_interface, protocol, src\_ip, src\_port<br />\| "High" as Severity \| "Insecure Transport Protocol to or from CDE" as message|
|PCI Compliance For Palo Alto Networks 9|Allowed Network Activity by Direction|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Accepted and Rejected Traffic|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action="allow"<br />\| where ((compareCIDRPrefix("172.16.0.0", src\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", src\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", src\_ip, toInt(8)) and (!compareCIDRPrefix("172.16.0.0", dest\_ip, toInt(12)) and !compareCIDRPrefix("192.168.0.0", dest\_ip, toInt(16)) and !compareCIDRPrefix("10.0.0.0", dest\_ip, toInt(8)))) or <br />(compareCIDRPrefix("172.16.0.0", dest\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", dest\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", dest\_ip, toInt(8)) and (!compareCIDRPrefix("172.16.0.0", src\_ip, toInt(12)) and !compareCIDRPrefix("192.168.0.0", src\_ip, toInt(16)) and !compareCIDRPrefix("10.0.0.0", src\_ip, toInt(8)))))<br /><br />\| if (compareCIDRPrefix("172.16.0.0", src\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", src\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", src\_ip, toInt(8)), "outbound","inbound") as direction<br />\| timeslice 5m<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{direction}}" = "\*", true, direction matches "{{direction}}")<br />\| count by \_timeslice, direction \| transpose row \_timeslice column direction|
|PCI Compliance For Palo Alto Networks 9|Allowed Network Activity by Transport and Internet Layer Protocol|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Accepted and Rejected Traffic|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action="allow"<br />\| timeslice 5m<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{direction}}" = "\*", true, direction matches "{{direction}}")<br />\| count by \_timeslice, protocol<br />\| transpose row \_timeslice column protocol|
|PCI Compliance For Palo Alto Networks 9|Allowed Traffic By Application Over Time|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01, 02 - Data Access Monitoring|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action="allow"<br />\| timeslice 1m<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{app}}" = "\*", true, app matches "{{app}}")<br />\| count as count by \_timeslice, app<br />\| transpose row \_timeslice column app|
|PCI Compliance For Palo Alto Networks 9|Allowed Traffic Over Time|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Accepted and Rejected Traffic|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action="allow"<br />\| timeslice 5m<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{direction}}" = "\*", true, direction matches "{{direction}}")<br />\| count by \_timeslice|
|PCI Compliance For Palo Alto Networks 9|Denied Traffic Over Time|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Accepted and Rejected Traffic|\_sourceCategory={{Logsdatasource}}  TRAFFIC deny<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action="deny"<br />\| timeslice 5m<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{direction}}" = "\*", true, direction matches "{{direction}}")<br />\| count by \_timeslice|
|PCI Compliance For Palo Alto Networks 9|Inbound Network Activity|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Traffic Direction Monitoring|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action = "allow"<br />\| where (compareCIDRPrefix("172.16.0.0", dest\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", dest\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", dest\_ip, toInt(8))) and (!compareCIDRPrefix("172.16.0.0", src\_ip, toInt(12)) and !compareCIDRPrefix("192.168.0.0", src\_ip, toInt(16)) and !compareCIDRPrefix("10.0.0.0", src\_ip, toInt(8)))<br />\| dest\_ip as %"Destination Host"<br />\| if (compareCIDRPrefix("172.16.0.0", src\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", src\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", src\_ip, toInt(8)), "outbound","inbound") as direction<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{outbound\_interface}}" = "\*", true, outbound\_interface matches "{{outbound\_interface}}") AND if ("{{direction}}" = "\*", true, direction matches "{{direction}}") AND if ("{{inbound\_interface}}" = "\*", true, inbound\_interface matches "{{inbound\_interface}}") AND if ("{{app}}" = "\*", true, app matches "{{app}}")<br />\| count by src\_ip, %"Destination Host" \| transpose row %"Destination Host" column src\_ip \| sort by %"Destination Host"|
|PCI Compliance For Palo Alto Networks 9|Insecure Allowed Traffic by Application and Involved Host|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 02, 04 - Insecure Data In Transit|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow (21 or 23 or 80 or 8008 or 8080 or 513)<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action="allow" and dest\_port in ("21", "23", "80", "8008", "8080", "513")<br />// Unencrypted traffic default ports (FTP - port 21, telnet - port 23, http - port 80, 8008, 8080, rlogin - port 513)<br />\| if ((compareCIDRPrefix("172.16.0.0", dest\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", dest\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", dest\_ip, toInt(8))), dest\_ip, src\_ip) as %"Cardholder Host"<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{app}}" = "\*", true, app matches "{{app}}")<br />\| count as Incidents by %"Cardholder Host", app<br />\| transpose row %"Cardholder Host" column app|
|PCI Compliance For Palo Alto Networks 9|Insecure Allowed Traffic by Protocol|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 02, 04 - Insecure Data In Transit|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow (21 or 23 or 80 or 8008 or 8080 or 513)<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action="allow" and dest\_port in ("21", "23", "80", "8008", "8080", "513")<br />// Unencrypted traffic default ports (FTP - port 21, telnet - port 23, http - port 80, 8008, 8080, rlogin - port 513)<br />\| if ((compareCIDRPrefix("172.16.0.0", dest\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", dest\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", dest\_ip, toInt(8))), dest\_ip, src\_ip) as %"Cardholder Host"<br />\| timeslice 5m<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{app}}" = "\*", true, app matches "{{app}}")<br />\|count by \_timeslice, Protocol<br />\| transpose row \_timeslice column Protocol|
|PCI Compliance For Palo Alto Networks 9|Insecure Allowed Traffic by Target Port and Involved Host|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 02, 04 - Insecure Data In Transit|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow (21 or 23 or 80 or 8008 or 8080 or 513)<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action="allow" and dest\_port in ("21", "23", "80", "8008", "8080", "513")<br />// Unencrypted traffic default ports (FTP - port 21, telnet - port 23, http - port 80, 8008, 8080, rlogin - port 513)<br />\| if ((compareCIDRPrefix("172.16.0.0", dest\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", dest\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", dest\_ip, toInt(8))), dest\_ip, src\_ip) as %"Cardholder Host"<br />\| dest\_port as %"Destination Port"<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{app}}" = "\*", true, app matches "{{app}}")<br />\| count as Incidents by %"Cardholder Host", %"Destination Port", Protocol <br />\| transpose row %"Destination Port", Protocol column %"Cardholder Host"|
|PCI Compliance For Palo Alto Networks 9|Insecure Denied Traffic by Protocol|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 02, 04 - Insecure Data In Transit|\_sourceCategory={{Logsdatasource}}  TRAFFIC deny (21 or 23 or 80 or 8008 or 8080 or 513)<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action="deny" and dest\_port in ("21", "23", "80", "8008", "8080", "513")<br />// Unencrypted traffic default ports (FTP - port 21, telnet - port 23, http - port 80, 8008, 8080, rlogin - port 513)<br />\| if ((compareCIDRPrefix("172.16.0.0", dest\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", dest\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", dest\_ip, toInt(8))), dest\_ip, src\_ip) as %"Cardholder Host"<br />\| timeslice 5m<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{app}}" = "\*", true, app matches "{{app}}")<br />\| count by \_timeslice, Protocol<br />\| transpose row \_timeslice column Protocol|
|PCI Compliance For Palo Alto Networks 9|Multi-service Detected on Same Host|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01, 02 - Data Access Monitoring|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow (80 or 8008 or 8080 or 443 or 8009 or 8005 or 8090 or 8091 or 3306 or 5432 or 1433 or 1434 or 1521 or 1830 or 2638 or 6262 or 3050 or 3351 or 1583 or 7210 or 5439 or 5984 or 6379 or 7000 or 7001 or 9042 or 9200 or 9300) // 3306 - MySQL/RDS, 5432 - PostgreSQL, 1433, 1434 - MS SQL Server, 1521, 1830 oracle, 2638 - SQLAnywhere, 6262 - sybase, 3050 - Firebird & Interbase, 3351, 1583 Pervasive SQL, 7210 - MaxDB, 5439 - Amazon Redshift, 5984 - couchdb, 6379 redis, 7000, 7001, 9042 - Cassandra, 9200, 9300 - Elasticsearch. Other port used can be added here<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action="allow"<br />\| if (dest\_port in ("80", "8008", "8080", "443", "8009", "8005", "8090", "8091"), 1, 0 ) as web<br />\| if (dest\_port in ("3306", "5432", "1433", "1434", "1521", "1830", "2638", "6262", "3050 ", "3351", "1583", "7210", "5439", "5984", "6379", "7000", "7001", "9042", "9200", "9300"), 1, 0 ) as db <br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{app}}" = "\*", true, app matches "{{app}}")<br />\| sum(web) as webcount, sum(db) as dbcount by dest\_ip<br />// db ports and web ports typically should not be open on same host<br />\| where (webcount \> 0 and dbcount \> 0)<br />\| fields -webcount, dbcount<br />\| formatDate(now(), "yyyy-MM-dd HH:mm:ss:SSS") as messagetime<br />\| "Multi-services detected (DB Port open with Web Port) on same host" as message<br />\| "Medium" as Severity|
|PCI Compliance For Palo Alto Networks 9|Network Activity - Unencrypted Default Port|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 02, 04 - Insecure Data In Transit|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow (21 or 23 or 80 or 8008 or 8080 or 513)<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action="allow" and dest\_port in ("21", "23", "80", "8008", "8080", "513")<br />// Unencrypted traffic default ports (FTP - port 21, telnet - port 23, http - port 80, 8008, 8080, rlogin - port 513)<br />\| timeslice 5m<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{src\_port}}" = "\*", true, src\_port matches "{{src\_port}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{app}}" = "\*", true, app matches "{{app}}")<br />\|count by \_timeslice, dest\_port <br />\| transpose row \_timeslice column dest\_port|
|PCI Compliance For Palo Alto Networks 9|Network Traffic Over Time|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Accepted and Rejected Traffic|\_sourceCategory={{Logsdatasource}}  TRAFFIC <br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC"<br />\| timeslice 5m<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{direction}}" = "\*", true, direction matches "{{direction}}")<br />\| count by \_timeslice, action<br />\| transpose row \_timeslice column action|
|PCI Compliance For Palo Alto Networks 9|Outbound Network Activity|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Traffic Direction Monitoring|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action = "allow"<br />\| where (compareCIDRPrefix("172.16.0.0", src\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", src\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", src\_ip, toInt(8))) and (!compareCIDRPrefix("172.16.0.0", dest\_ip, toInt(12)) and !compareCIDRPrefix("192.168.0.0", dest\_ip, toInt(16)) and !compareCIDRPrefix("10.0.0.0", dest\_ip, toInt(8)))<br />\| src\_ip as %"Source Host"<br />\| if (compareCIDRPrefix("172.16.0.0", src\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", src\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", src\_ip, toInt(8)), "outbound","inbound") as direction<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{outbound\_interface}}" = "\*", true, outbound\_interface matches "{{outbound\_interface}}") AND if ("{{direction}}" = "\*", true, direction matches "{{direction}}") AND if ("{{inbound\_interface}}" = "\*", true, inbound\_interface matches "{{inbound\_interface}}") AND if ("{{app}}" = "\*", true, app matches "{{app}}")<br />\| count by %"Source Host", dest\_ip \| transpose row %"Source Host" column dest\_ip \| sort by %"Source Host"|
|PCI Compliance For Palo Alto Networks 9|Possible Horizontal Port Scan Attack - Allowed|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01, 02 - Data Access Monitoring|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action = "allow"<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{app}}" = "\*", true, app matches "{{app}}")<br />\|count\_distinct(dest\_ip) as %"UniqueDestinationHosts" by dest\_port<br />\| sort by %"UniqueDestinationHosts", dest\_port asc<br />\| limit 20|
|PCI Compliance For Palo Alto Networks 9|Possible Port Scan Attack - Rejected|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01, 02 - Data Access Monitoring|\_sourceCategory={{Logsdatasource}}  TRAFFIC deny<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action = "deny"<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{app}}" = "\*", true, app matches "{{app}}")<br />\|count\_distinct(dest\_port) as %"UniqueDestinationPorts" by dest\_ip<br />\| sort by %"UniqueDestinationPorts", dest\_ip asc<br />\| limit 20|
|PCI Compliance For Palo Alto Networks 9|Possible Vertical Port Scan Attack - Allowed|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01, 02 - Data Access Monitoring|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action = "allow"<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{app}}" = "\*", true, app matches "{{app}}")<br />\|count\_distinct(dest\_port) as %"UniqueDestinationPorts" by dest\_ip<br />\| sort by %"UniqueDestinationPorts", dest\_ip asc<br />\| limit 20|
|PCI Compliance For Palo Alto Networks 9|Silently Dropped Traffic Over Time|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Accepted and Rejected Traffic|\_sourceCategory={{Logsdatasource}}  TRAFFIC (drop or icmp)<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action matches "drop\*"<br />\| timeslice 5m<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{direction}}" = "\*", true, direction matches "{{direction}}")<br />\| count as events\_dropped by \_timeslice|
|PCI Compliance For Palo Alto Networks 9|Top 10 Host - Receiving Inbound Traffic|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Traffic Direction Monitoring|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action = "allow"<br />\| where (compareCIDRPrefix("172.16.0.0", dest\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", dest\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", dest\_ip, toInt(8))) and (!compareCIDRPrefix("172.16.0.0", src\_ip, toInt(12)) and !compareCIDRPrefix("192.168.0.0", src\_ip, toInt(16)) and !compareCIDRPrefix("10.0.0.0", src\_ip, toInt(8)))<br />\| dest\_ip as %"Destination Host"<br />\| if (compareCIDRPrefix("172.16.0.0", src\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", src\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", src\_ip, toInt(8)), "outbound","inbound") as direction<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{outbound\_interface}}" = "\*", true, outbound\_interface matches "{{outbound\_interface}}") AND if ("{{direction}}" = "\*", true, direction matches "{{direction}}") AND if ("{{inbound\_interface}}" = "\*", true, inbound\_interface matches "{{inbound\_interface}}") AND if ("{{app}}" = "\*", true, app matches "{{app}}")<br />\| sum(bytes) as bytesReceived by %"Destination Host" \| bytesReceived/1024/1024 as megabytes\_Received \| fields -bytesReceived \| sort by megabytes\_Received, %"Destination Host" asc \| Limit 10|
|PCI Compliance For Palo Alto Networks 9|Top 10 Host - Sending Outbound Traffic|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Traffic Direction Monitoring|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action = "allow"<br />\| where (compareCIDRPrefix("172.16.0.0", src\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", src\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", src\_ip, toInt(8))) and (!compareCIDRPrefix("172.16.0.0", dest\_ip, toInt(12)) and !compareCIDRPrefix("192.168.0.0", dest\_ip, toInt(16)) and !compareCIDRPrefix("10.0.0.0", dest\_ip, toInt(8)))<br />\| src\_ip as %"Source Host"<br />\| if (compareCIDRPrefix("172.16.0.0", src\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", src\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", src\_ip, toInt(8)), "outbound","inbound") as direction<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{outbound\_interface}}" = "\*", true, outbound\_interface matches "{{outbound\_interface}}") AND if ("{{direction}}" = "\*", true, direction matches "{{direction}}") AND if ("{{inbound\_interface}}" = "\*", true, inbound\_interface matches "{{inbound\_interface}}") AND if ("{{app}}" = "\*", true, app matches "{{app}}")<br />\| sum (bytes\_sent) as bytesSent by %"Source Host" \| bytessent/1024/1024 as megabytes\_Sent \| fields -bytessent \| sort by megabytes\_Sent, %"Source Host" asc \| Limit 10|
|PCI Compliance For Palo Alto Networks 9|Top Destination IP|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Accepted and Rejected Traffic|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action="allow"<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{direction}}" = "\*", true, direction matches "{{direction}}")<br />\|count as eventCount by dest\_ip \| dest\_ip as %"Destination IP"<br />\| top 10 %"Destination IP" by eventCount, %"Destination IP" asc|
|PCI Compliance For Palo Alto Networks 9|Top Destination IP|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Accepted and Rejected Traffic|\_sourceCategory={{Logsdatasource}}  TRAFFIC deny<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action="deny"<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{direction}}" = "\*", true, direction matches "{{direction}}")<br />\|count as eventCount by dest\_ip \| dest\_ip as %"Destination IP"<br />\| top 10 %"Destination IP" by eventCount, %"Destination IP"|
|PCI Compliance For Palo Alto Networks 9|Top Source IP|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Accepted and Rejected Traffic|\_sourceCategory={{Logsdatasource}}  TRAFFIC deny<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action="deny"<br />\|where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{direction}}" = "\*", true, direction matches "{{direction}}")<br />\|count as eventCount by src\_ip \| src\_ip as %"Source IP"<br />\| top 10 %"Source IP" by eventCount, %"Source IP" asc|
|PCI Compliance For Palo Alto Networks 9|Top Source IP|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Accepted and Rejected Traffic|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action="allow"<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{direction}}" = "\*", true, direction matches "{{direction}}")<br />\| count as eventCount by src\_ip \| src\_ip as %"Source IP"<br />\| top 10 %"Source IP" by eventCount, %"Source IP" asc|
|PCI Compliance For Palo Alto Networks 9|Top TCP Dest Ports|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01, 02 - Data Access Monitoring|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow tcp<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action="allow" and Protocol="tcp"<br />\| where ((compareCIDRPrefix("172.16.0.0", src\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", src\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", src\_ip, toInt(8)) and (!compareCIDRPrefix("172.16.0.0", dest\_ip, toInt(12)) and !compareCIDRPrefix("192.168.0.0", dest\_ip, toInt(16)) and !compareCIDRPrefix("10.0.0.0", dest\_ip, toInt(8)))) or <br />(compareCIDRPrefix("172.16.0.0", dest\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", dest\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", dest\_ip, toInt(8)) and (!compareCIDRPrefix("172.16.0.0", src\_ip, toInt(12)) and !compareCIDRPrefix("192.168.0.0", src\_ip, toInt(16)) and !compareCIDRPrefix("10.0.0.0", src\_ip, toInt(8)))))<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{app}}" = "\*", true, app matches "{{app}}")<br />\| count as count by dest\_port \| sort by count, dest\_port asc \| limit 20|
|PCI Compliance For Palo Alto Networks 9|Top UDP Dest Ports|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01, 02 - Data Access Monitoring|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow udp<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action="allow" and Protocol="udp"<br />\| where ((compareCIDRPrefix("172.16.0.0", src\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", src\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", src\_ip, toInt(8)) and (!compareCIDRPrefix("172.16.0.0", dest\_ip, toInt(12)) and !compareCIDRPrefix("192.168.0.0", dest\_ip, toInt(16)) and !compareCIDRPrefix("10.0.0.0", dest\_ip, toInt(8)))) or <br />(compareCIDRPrefix("172.16.0.0", dest\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", dest\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", dest\_ip, toInt(8)) and (!compareCIDRPrefix("172.16.0.0", src\_ip, toInt(12)) and !compareCIDRPrefix("192.168.0.0", src\_ip, toInt(16)) and !compareCIDRPrefix("10.0.0.0", src\_ip, toInt(8)))))<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{app}}" = "\*", true, app matches "{{app}}")<br />\| count as count by dest\_port \| sort by count, dest\_port asc \| limit 20|
|PCI Compliance For Palo Alto Networks 9|Traffic to Cardholder Environment|Logs|Installed Apps/PCI Compliance For Palo Alto Networks 9/PCI Compliance For Palo Alto Networks 9 - PCI Req 01 - Traffic Direction Monitoring|\_sourceCategory={{Logsdatasource}}  TRAFFIC allow (3306 or 5432 or 1433 or 1434 or 1521 or 1830 or 2638 or 6262 or 3050 or 3351 or 1583 or 7210 or 5439 or 5984 or 6379 or 7000 or 7001 or 9042 or 9200 or 9300) // 3306 - MySQL/RDS, 5432 - PostgreSQL, 1433, 1434 - MS SQL Server, 1521, 1830 oracle, 2638 - SQLAnywhere, 6262 - sybase, 3050 - Firebird & Interbase, 3351, 1583 Pervasive SQL, 7210 - MaxDB, 5439 - Amazon Redshift, 5984 - couchdb, 6379 redis, 7000, 7001, 9042 - Cassandra, 9200, 9300 - Elasticsearch. Other port used can be added here<br />\| csv \_raw extract 1 as f1, 2 as Receive\_Time, 3 as serialNum, 4 as type, 5 as subtype, 6 as f2, 7 as LogGenerationTime, 8 as src\_ip, 9 as dest\_ip, 10 as NAT\_src\_ip, 11 as NAT\_dest\_ip, 12 as ruleName, 13 as src\_user, 14 as dest\_user, 15 as app, 16 as vsys, 17 as src\_zone, 18 as dest\_zone, 19 as inbound\_interface, 20 as outbound\_interface, 21 as LogAction, 22 as f3, 23 as SessonID, 24 as RepeatCount, 25 as src\_port, 26 as dest\_port, 27 as NAT\_src\_port, 28 as NAT\_dest\_port, 29 as flags, 30 as protocol, 31 as action,32 as bytes, 33 as bytes\_sent, 34 as bytes\_recv, 35 as Packets, 36 as StartTime, 37 as ElapsedTime, 38 as Category, 39 as f4, 40 as seqNum, 41 as ActionFlags, 42 as src\_Country, 43 as dest\_country, 44 as pkts\_sent, 45 as pkts\_received, 46 as session\_end\_reason, 47 as Device\_Group\_Hierarchy , 48 as vsys\_Name, 49 as DeviceName, 50 as action\_source, 51 as Source\_VM\_UUID, 52 as Destination\_VM\_UUID, 53 as Tunnel\_ID\_IMSI, 54 as Monitor\_Tag\_IMEI, 55 as Parent\_Session\_ID, 56 as parent\_start\_time, 57 as Tunnel, 58 as SCTP\_Association\_ID, 59 as SCTP\_Chunks, 60 as SCTP\_Chunks\_Sent, 61 as SCTP\_Chunks\_Received<br />\| where type = "TRAFFIC" and action="allow" and dest\_port in ("3306", "5432", "1433", "1434", "1521", "1830", "2638", "6262", "3050 ", "3351", "1583", "7210", "5439", "5984", "6379", "7000", "7001", "9042", "9200", "9300")<br />\| where (compareCIDRPrefix("172.16.0.0", dest\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", dest\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", dest\_ip, toInt(8)) and (dest\_port in ("3306", "5432", "1433", "1434", "1521", "1830", "2638", "6262", "3050 ", "3351", "1583", "7210", "5439", "5984", "6379", "7000", "7001", "9042", "9200", "9300"))) <br />\| where (!compareCIDRPrefix("172.16.0.0", src\_ip, toInt(12)) and !compareCIDRPrefix("192.168.0.0", src\_ip, toInt(16)) and !compareCIDRPrefix("10.0.0.0", src\_ip, toInt(8)))<br />\| if (compareCIDRPrefix("172.16.0.0", src\_ip, toInt(12)) or compareCIDRPrefix("192.168.0.0", src\_ip, toInt(16)) or compareCIDRPrefix("10.0.0.0", src\_ip, toInt(8)), "outbound","inbound") as direction<br />\| timeslice 1s<br />\| where if ("{{protocol}}" = "\*", true, protocol matches "{{protocol}}") AND if ("{{action}}" = "\*", true, action matches "{{action}}") AND if ("{{src\_ip}}" = "\*", true, src\_ip matches "{{src\_ip}}") AND if ("{{dest\_port}}" = "\*", true, dest\_port matches "{{dest\_port}}") AND if ("{{dest\_ip}}" = "\*", true, dest\_ip matches "{{dest\_ip}}") AND if ("{{outbound\_interface}}" = "\*", true, outbound\_interface matches "{{outbound\_interface}}") AND if ("{{direction}}" = "\*", true, direction matches "{{direction}}") AND if ("{{inbound\_interface}}" = "\*", true, inbound\_interface matches "{{inbound\_interface}}") AND if ("{{app}}" = "\*", true, app matches "{{app}}")<br />\| count as eventCount by \_timeslice, dest\_ip, dest\_port, src\_ip, inbound\_interface, outbound\_interface<br />\| sort by \_timeslice, dest\_ip asc, dest\_port asc, src\_ip asc, eventCount<br />\| "Direct external traffic to secure port" as message \| "Critical" as Severity|

