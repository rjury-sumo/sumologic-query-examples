# Microsoft Exchange Trace Logs
## Sumo Logic App For: Microsoft Exchange Trace Logs
The MessageTrace API provides information about the processing of email messages that have passed through the Office 365 system for the organization. The Sumo Logic App for Microsoft Exchange Trace Logs provides visibility into Delivered, Failed, Quarantined, Pending, and Spam messages. The App Dashboard also analyzes the delivery Status of Messages, the size of messages transmitted, and the geolocation of senders and receivers, and provides threat analysis for the sender's email with the CrowdStrike threat detection feed.
Docs Link: [Microsoft Exchange Trace Logs](https://help.sumologic.com/?cid=21222)

## Searches

### Log Searches

- **Delivered Messages**: from Dashboard: Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Overview 
- **Failed Messages**: from Dashboard: Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Overview 
- **Frequency of Keywords in Subject**: from Dashboard: Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Overview 
- **Geo Location of Senders**: from Dashboard: Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Message Monitoring  
- **Geo Locations of Receivers**: from Dashboard: Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Message Monitoring  
- **Message Delivery Status**: from Dashboard: Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Overview 
- **Messages Received**: from Dashboard: Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Overview 
- **Size of Message Transmitted**: from Dashboard: Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Overview 
- **Source Geo Location of Failed Messages**: from Dashboard: Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Message Monitoring  
- **Threat Intel Analysis of Senders Email Address**: from Dashboard: Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Message Monitoring  
- **Top 10 Message Status Count by Sender**: from Dashboard: Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Overview 
- **Top 10 Organizations**: from Dashboard: Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Overview 
- **Top 10 Senders**: from Dashboard: Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Message Monitoring  
- **Total Message Size Transmitted**: from Dashboard: Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Overview 
- **Unique Inbound Domains**: from Dashboard: Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Message Monitoring  
- **Unique Outbound Domains**: from Dashboard: Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Message Monitoring  
- **Unique Receivers**: from Dashboard: Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Message Monitoring  
- **Unique Senders**: from Dashboard: Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Message Monitoring 

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Microsoft Exchange Trace Logs|Delivered Messages|Logs|Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Overview|\_sourceCategory=Labs/MessageExchangeTraceLogs <br />\| json "Organization", "MessageId", "Received","SenderAddress", "RecipientAddress", "Subject", "Status", "ToIP", "FromIP", "Size", "MessageTraceId", "StartDate", "EndDate", "Index" as organization, message\_id, received, sender\_address, recipient\_address, subject, status, toIP, fromIP, size, message\_traceId, start\_date, end\_Date, index nodrop<br />\| where status matches ("\*Delivered\*")<br />\| where status matches"{{status}}"<br />\| where sender\_address matches"{{sender\_address}}"<br />\| where organization matches "{{organization}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = fromIP<br />\| where country\_name matches "{{country}}"<br />\| count(status)|
|Microsoft Exchange Trace Logs|Failed Messages|Logs|Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Overview|\_sourceCategory=Labs/MessageExchangeTraceLogs <br />\| json "Organization", "MessageId", "Received","SenderAddress", "RecipientAddress", "Subject", "Status", "ToIP", "FromIP", "Size", "MessageTraceId", "StartDate", "EndDate", "Index" as organization, message\_id, received, sender\_address, recipient\_address, subject, status, toIP, fromIP, size, message\_traceId, start\_date, end\_Date, index nodrop<br />\| where status matches"{{status}}"<br />\| where sender\_address matches"{{sender\_address}}"<br />\| where organization matches "{{organization}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = fromIP<br />\| where country\_name matches "{{country}}"<br />\| where status matches ("\*Failed\*")<br />\| count(status)|
|Microsoft Exchange Trace Logs|Frequency of Keywords in Subject|Logs|Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Overview|\_sourceCategory=Labs/MessageExchangeTraceLogs <br />\| json "Organization", "MessageId", "Received","SenderAddress", "RecipientAddress", "Subject", "Status", "ToIP", "FromIP", "Size", "MessageTraceId", "StartDate", "EndDate", "Index" as organization, message\_id, received, sender\_address, recipient\_address, subject, status, toIP, fromIP, size, message\_traceId, start\_date, end\_Date, index nodrop<br />\| where status matches"{{status}}"<br />\| where sender\_address matches"{{sender\_address}}"<br />\| where organization matches "{{organization}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = fromIP<br />\| where country\_name matches "{{country}}"<br />\| parse regex field=subject "(?\<word\>\\w+)" multi<br />\| count\_frequent word<br />\| limit 10|
|Microsoft Exchange Trace Logs|Geo Location of Senders|Logs|Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Message Monitoring |\_sourceCategory=Labs/MessageExchangeTraceLogs <br />\| json "Organization", "MessageId", "Received","SenderAddress", "RecipientAddress", "Subject", "Status", "ToIP", "FromIP", "Size", "MessageTraceId", "StartDate", "EndDate", "Index" as organization, message\_id, received, sender\_address, recipient\_address, subject, status, toIP, fromIP, size, message\_traceId, start\_date, end\_Date, index nodrop<br />\| where status matches"{{status}}"<br />\| where sender\_address matches"{{sender\_address}}"<br />\| where organization matches "{{organization}}"<br />\| where isValidIP(fromIP) and !isPrivateIP(fromIP)<br />\| count as IPCount by fromIP<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = fromIP<br />\| where country\_name matches "{{country}}"<br />|
|Microsoft Exchange Trace Logs|Geo Locations of Receivers|Logs|Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Message Monitoring |\_sourceCategory=Labs/MessageExchangeTraceLogs <br />\| json "Organization", "MessageId", "Received","SenderAddress", "RecipientAddress", "Subject", "Status", "ToIP", "FromIP", "Size", "MessageTraceId", "StartDate", "EndDate", "Index" as organization, message\_id, received, sender\_address, recipient\_address, subject, status, toIP, fromIP, size, message\_traceId, start\_date, end\_Date, index nodrop<br />\| where status matches"{{status}}"<br />\| where sender\_address matches"{{sender\_address}}"<br />\| where organization matches "{{organization}}"<br />\| where !isNull(toIP)<br />\| where  isValidIP(toIP)<br />\| where !isPrivateIP(toIP)<br />\| count as IPCount by toIP<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = toIP<br />\| where country\_name matches "{{country}}"|
|Microsoft Exchange Trace Logs|Message Delivery Status|Logs|Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Overview|\_sourceCategory=Labs/MessageExchangeTraceLogs <br />\| json "Organization", "MessageId", "Received","SenderAddress", "RecipientAddress", "Subject", "Status", "ToIP", "FromIP", "Size", "MessageTraceId", "StartDate", "EndDate", "Index" as organization, message\_id, received, sender\_address, recipient\_address, subject, status, toIP, fromIP, size, message\_traceId, start\_date, end\_Date, index nodrop<br />\| where status matches"{{status}}"<br />\| where sender\_address matches"{{sender\_address}}"<br />\| where organization matches "{{organization}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = fromIP<br />\| where country\_name matches "{{country}}"<br />\| timeslice 1d<br />\| count by \_timeslice, status<br />\| fillmissing timeslice, values all in status<br />\| transpose row \_timeslice column status|
|Microsoft Exchange Trace Logs|Messages Received|Logs|Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Overview|\_sourceCategory=Labs/MessageExchangeTraceLogs <br />\| json "Organization", "MessageId", "Received","SenderAddress", "RecipientAddress", "Subject", "Status", "ToIP", "FromIP", "Size", "MessageTraceId", "StartDate", "EndDate", "Index" as organization, message\_id, received, sender\_address, recipient\_address, subject, status, toIP, fromIP, size, message\_traceId, start\_date, end\_Date, index nodrop<br />\| where status matches"{{status}}"<br />\| where sender\_address matches"{{sender\_address}}"<br />\| where organization matches "{{organization}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = fromIP<br />\| where country\_name matches "{{country}}"<br />\| count(received)|
|Microsoft Exchange Trace Logs|Size of Message Transmitted|Logs|Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Overview|\_sourceCategory=Labs/MessageExchangeTraceLogs <br />\| json "Organization", "MessageId", "Received","SenderAddress", "RecipientAddress", "Subject", "Status", "ToIP", "FromIP", "Size", "MessageTraceId", "StartDate", "EndDate", "Index" as organization, message\_id, received, sender\_address, recipient\_address, subject, status, toIP, fromIP, size, message\_traceId, start\_date, end\_Date, index nodrop<br />\| where status matches"{{status}}"<br />\| where sender\_address matches"{{sender\_address}}"<br />\| where organization matches "{{organization}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = fromIP<br />\| where country\_name matches "{{country}}"<br />\| timeslice 1d<br />\| sum(size) as totalbytes by \_timeslice<br />\| fillmissing timeslice<br />\| order by \_timeslice|
|Microsoft Exchange Trace Logs|Source Geo Location of Failed Messages|Logs|Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Message Monitoring |\_sourceCategory=Labs/MessageExchangeTraceLogs <br />\| json "Organization", "MessageId", "Received","SenderAddress", "RecipientAddress", "Subject", "Status", "ToIP", "FromIP", "Size", "MessageTraceId", "StartDate", "EndDate", "Index" as organization, message\_id, received, sender\_address, recipient\_address, subject, status, toIP, fromIP, size, message\_traceId, start\_date, end\_Date, index nodrop<br />\| where status matches"{{status}}"<br />\| where sender\_address matches"{{sender\_address}}"<br />\| where organization matches "{{organization}}"<br />\| where status matches ("\*Failed\*")<br />\| where isValidIP(fromIP) and !isPrivateIP(fromIP)<br />\| count as IPCount by fromIP<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = fromIP<br />\| where country\_name matches "{{country}}"|
|Microsoft Exchange Trace Logs|Threat Intel Analysis of Senders Email Address|Logs|Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Message Monitoring |\_sourceCategory=Labs/MessageExchangeTraceLogs <br />\| json "Organization", "MessageId", "Received","SenderAddress", "RecipientAddress", "Subject", "Status", "ToIP", "FromIP", "Size", "MessageTraceId", "StartDate", "EndDate", "Index" as organization, message\_id, received, sender\_address, recipient\_address, subject, status, toIP, fromIP, size, message\_traceId, start\_date, end\_Date, index nodrop<br />\| where status matches"{{status}}"<br />\| where sender\_address matches"{{sender\_address}}"<br />\| where organization matches "{{organization}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = fromIP<br />\| where country\_name matches "{{country}}"<br />\| count as email\_count by sender\_address, \_source<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=sender\_address<br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where type="email\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (email\_count) as threat\_count by sender\_address, malicious\_confidence, Actor,  \_source, label\_name<br />\| sort by threat\_count|
|Microsoft Exchange Trace Logs|Top 10 Message Status Count by Sender|Logs|Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Overview|\_sourceCategory=Labs/MessageExchangeTraceLogs <br />\| json "Organization", "MessageId", "Received","SenderAddress", "RecipientAddress", "Subject", "Status", "ToIP", "FromIP", "Size", "MessageTraceId", "StartDate", "EndDate", "Index" as organization, message\_id, received, sender\_address, recipient\_address, subject, status, toIP, fromIP, size, message\_traceId, start\_date, end\_Date, index nodrop<br />\| where status matches"{{status}}"<br />\| where sender\_address matches"{{sender\_address}}"<br />\| where organization matches "{{organization}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = fromIP<br />\| where country\_name matches "{{country}}"<br />\| count by sender\_address, status<br />\| transpose row sender\_address column status as Delivered ,None, Failed, Pending, Expanded, Quarantined, FilteredAsSpam <br />\| sum(Delivered) as Delivered, sum(None) as None, sum(Failed) as Failed, sum(Pending) as Pending, sum(Expanded) as Expanded, sum(Quarantined) as Quarantined, sum(FilteredAsSpam) as FilteredAsSpam by sender\_address<br />\| (Delivered + None+ Failed + Pending + Expanded + Quarantined + FilteredAsSpam) as TotalCount <br />\| sort by TotalCount<br />\| limit 10|
|Microsoft Exchange Trace Logs|Top 10 Organizations|Logs|Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Overview|\_sourceCategory=Labs/MessageExchangeTraceLogs <br />\| json "Organization", "MessageId", "Received","SenderAddress", "RecipientAddress", "Subject", "Status", "ToIP", "FromIP", "Size", "MessageTraceId", "StartDate", "EndDate", "Index" as organization, message\_id, received, sender\_address, recipient\_address, subject, status, toIP, fromIP, size, message\_traceId, start\_date, end\_Date, index nodrop<br />\| where status matches"{{status}}"<br />\| where sender\_address matches"{{sender\_address}}"<br />\| where organization matches "{{organization}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = fromIP<br />\| where country\_name matches "{{country}}"<br />\| count by organization<br />\| top 10 organization by \_count|
|Microsoft Exchange Trace Logs|Top 10 Senders|Logs|Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Message Monitoring |\_sourceCategory=Labs/MessageExchangeTraceLogs <br />\| json "Organization", "MessageId", "Received","SenderAddress", "RecipientAddress", "Subject", "Status", "ToIP", "FromIP", "Size", "MessageTraceId", "StartDate", "EndDate", "Index" as organization, message\_id, received, sender\_address, recipient\_address, subject, status, toIP, fromIP, size, message\_traceId, start\_date, end\_Date, index nodrop<br />\| where status matches"{{status}}"<br />\| where sender\_address matches"{{sender\_address}}"<br />\| where organization matches "{{organization}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = fromIP<br />\| where country\_name matches "{{country}}"<br />\| count by sender\_address<br />\| top 10 sender\_address by \_count|
|Microsoft Exchange Trace Logs|Total Message Size Transmitted|Logs|Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Overview|\_sourceCategory=Labs/MessageExchangeTraceLogs <br />\| json "Organization", "MessageId", "Received","SenderAddress", "RecipientAddress", "Subject", "Status", "ToIP", "FromIP", "Size", "MessageTraceId", "StartDate", "EndDate", "Index" as organization, message\_id, received, sender\_address, recipient\_address, subject, status, toIP, fromIP, size, message\_traceId, start\_date, end\_Date, index nodrop<br />\| where status matches"{{status}}"<br />\| where sender\_address matches"{{sender\_address}}"<br />\| where organization matches "{{organization}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = fromIP<br />\| where country\_name matches "{{country}}"<br />\| size/1Gi as gbytes<br />\| sum(gbytes) as totalbytes by \_timeslice|
|Microsoft Exchange Trace Logs|Unique Inbound Domains|Logs|Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Message Monitoring |\_sourceCategory=Labs/MessageExchangeTraceLogs <br />\| json "Organization", "MessageId", "Received","SenderAddress", "RecipientAddress", "Subject", "Status", "ToIP", "FromIP", "Size", "MessageTraceId", "StartDate", "EndDate", "Index" as organization, message\_id, received, sender\_address, recipient\_address, subject, status, toIP, fromIP, size, message\_traceId, start\_date, end\_Date, index nodrop<br />\| where status matches"{{status}}"<br />\| where sender\_address matches"{{sender\_address}}"<br />\| where organization matches "{{organization}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = fromIP<br />\| where country\_name matches "{{country}}"<br />\| extract field=sender\_address ".@(?\<uniqueInboudDomains\>.\*)"<br />\| count\_distinct (uniqueInboudDomains)|
|Microsoft Exchange Trace Logs|Unique Outbound Domains|Logs|Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Message Monitoring |\_sourceCategory=Labs/MessageExchangeTraceLogs <br />\| json "Organization", "MessageId", "Received","SenderAddress", "RecipientAddress", "Subject", "Status", "ToIP", "FromIP", "Size", "MessageTraceId", "StartDate", "EndDate", "Index" as organization, message\_id, received, sender\_address, recipient\_address, subject, status, toIP, fromIP, size, message\_traceId, start\_date, end\_Date, index nodrop<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = fromIP<br />\| where status matches"{{status}}"<br />\| where sender\_address matches"{{sender\_address}}"<br />\| where organization matches "{{organization}}"<br />\| where country\_name matches "{{country}}"<br />\| extract field=recipient\_address ".@(?\<uniqueOutboudDomains\>.\*)"<br />\| count\_distinct (uniqueOutboudDomains)|
|Microsoft Exchange Trace Logs|Unique Receivers|Logs|Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Message Monitoring |\_sourceCategory=Labs/MessageExchangeTraceLogs <br />\| json "Organization", "MessageId", "Received","SenderAddress", "RecipientAddress", "Subject", "Status", "ToIP", "FromIP", "Size", "MessageTraceId", "StartDate", "EndDate", "Index" as organization, message\_id, received, sender\_address, recipient\_address, subject, status, toIP, fromIP, size, message\_traceId, start\_date, end\_Date, index nodrop<br />\| where status matches"{{status}}"<br />\| where sender\_address matches"{{sender\_address}}"<br />\| where organization matches "{{organization}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = fromIP<br />\| where country\_name matches "{{country}}"<br />\| count\_distinct (recipient\_address)|
|Microsoft Exchange Trace Logs|Unique Senders|Logs|Microsoft Exchange Trace Logs/Microsoft Exchange Trace Logs - Message Monitoring |\_sourceCategory=Labs/MessageExchangeTraceLogs <br />\| json "Organization", "MessageId", "Received","SenderAddress", "RecipientAddress", "Subject", "Status", "ToIP", "FromIP", "Size", "MessageTraceId", "StartDate", "EndDate", "Index" as organization, message\_id, received, sender\_address, recipient\_address, subject, status, toIP, fromIP, size, message\_traceId, start\_date, end\_Date, index nodrop<br />\| where status matches"{{status}}"<br />\| where sender\_address matches"{{sender\_address}}"<br />\| where organization matches "{{organization}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = fromIP<br />\| where country\_name matches "{{country}}"<br />\| count\_distinct (sender\_address)|

