# Nginx
## Sumo Logic App For: Nginx
The Nginx app is a unified logs and metrics app that helps you monitor the availability, performance, health, and resource utilization of your Nginx web servers. Preconfigured dashboards and searches provide insight into connections, requests, visitor locations, visitor access types, traffic patterns, errors, web server operations, and access from known malicious sources.
Docs Link: [Nginx](https://help.sumologic.com/?cid=5253)

## Searches

### Log Searches

- **4xx Codes by Server**: from Dashboard: Nginx/Nginx - Overview 
- **4xx Errors - Client Locations**: from Dashboard: Nginx/Logs/Nginx - Web Server Operations 
- **5xx Codes by Server**: from Dashboard: Nginx/Nginx - Overview 
- **All Errors**: from Dashboard: Nginx/Logs/Nginx - Error Logs 
- **Browsers and Operating Systems**: from Dashboard: Nginx/Logs/Nginx - Visitor Access Types 
- **Bytes Served**: from Dashboard: Nginx/Logs/Nginx - Outlier Analysis 
- **Bytes Served**: from Dashboard: Nginx/Logs/Nginx - Visitor Traffic Insight 
- **Client Errors**: from Dashboard: Nginx/Logs/Nginx - Outlier Analysis 
- **Client Locations with Critical Errors**: from Dashboard: Nginx/Logs/Nginx - Error Logs 
- **Client OS Platforms**: from Dashboard: Nginx/Nginx - Overview 
- **Critical Error Messages**: from Dashboard: Nginx/Nginx - Overview 
- **Critical Messages**: from Dashboard: Nginx/Logs/Nginx - Error Logs 
- **Desktop OS Version**: from Dashboard: Nginx/Logs/Nginx - Visitor Access Types 
- **Error Responses by Server**: from Dashboard: Nginx/Logs/Nginx - Web Server Operations 
- **Highly Malicious Threat Table**: from Dashboard: Nginx/Logs/Nginx  - Threat Intel 
- **HTTP Methods**: from Dashboard: Nginx/Logs/Nginx - Visitor Traffic Insight 
- **Log Level - One Day Time Comparison**: from Dashboard: Nginx/Logs/Nginx - Error Logs 
- **Media Types Served**: from Dashboard: Nginx/Logs/Nginx - Visitor Traffic Insight 
- **Messages by Log Level - Over Time**: from Dashboard: Nginx/Logs/Nginx - Error Logs 
- **Nginx  - Top 404 referrers**: from Search: Nginx/Logs/Searches/Nginx  - Top 404 referrers 
- **Nginx  - Top browsers**: from Search: Nginx/Logs/Searches/Nginx  - Top browsers 
- **Nginx - All Error Messages**: from Search: Nginx/Logs/Searches/Nginx - All Error Messages 
- **Nginx - All HTTP Response codes with their count**: from Search: Nginx/Logs/Searches/Nginx - All HTTP Response codes with their count 
- **Nginx - Client Errors (4xx response codes) per day**: from Search: Nginx/Logs/Searches/Nginx - Client Errors (4xx response codes) per day 
- **Nginx - HTTP status code summary over time**: from Search: Nginx/Logs/Searches/Nginx - HTTP status code summary over time 
- **Nginx - Top clients**: from Search: Nginx/Logs/Searches/Nginx - Top clients 
- **Nginx - Top clients causing errors**: from Search: Nginx/Logs/Searches/Nginx - Top clients causing errors 
- **Nginx - Top URLs by bytes served**: from Search: Nginx/Logs/Searches/Nginx - Top URLs by bytes served 
- **Nginx - Traffic volume and bytes served per day**: from Search: Nginx/Logs/Searches/Nginx - Traffic volume and bytes served per day 
- **Non 200 Response Status Codes**: from Dashboard: Nginx/Logs/Nginx - Web Server Operations 
- **Number of Hits by Server - One Day Time Comparison**: from Dashboard: Nginx/Logs/Nginx  - Trends 
- **Number of Requests by Client - One Day Time Comparison**: from Dashboard: Nginx/Logs/Nginx - Error Logs 
- **Number of Visitors**: from Dashboard: Nginx/Logs/Nginx - Outlier Analysis 
- **Popular Mobile Device Versions**: from Dashboard: Nginx/Logs/Nginx - Visitor Access Types 
- **Responses Over Time**: from Dashboard: Nginx/Logs/Nginx  - Trends 
- **Responses Over Time**: from Dashboard: Nginx/Nginx - Overview 
- **Server Errors**: from Dashboard: Nginx/Logs/Nginx - Outlier Analysis 
- **Server Errors Over Time**: from Dashboard: Nginx/Logs/Nginx - Web Server Operations 
- **Threat Breakdown by Sources**: from Dashboard: Nginx/Logs/Nginx  - Threat Intel 
- **Threat by Actors**: from Dashboard: Nginx/Logs/Nginx  - Threat Intel 
- **Threat by Malicious Confidence**: from Dashboard: Nginx/Logs/Nginx  - Threat Intel 
- **Threat Count**: from Dashboard: Nginx/Logs/Nginx  - Threat Intel 
- **Threat Locations**: from Dashboard: Nginx/Logs/Nginx  - Threat Intel 
- **Threat Table**: from Dashboard: Nginx/Logs/Nginx  - Threat Intel 
- **Top 10 Bots Observed**: from Dashboard: Nginx/Logs/Nginx - Web Server Operations 
- **Top 10 Search Terms from Popular Search Engines**: from Dashboard: Nginx/Logs/Nginx - Visitor Traffic Insight 
- **Top 10 URLs with 4xx Errors**: from Dashboard: Nginx/Nginx - Overview 
- **Top 10 URLs with 5xx Errors**: from Dashboard: Nginx/Nginx - Overview 
- **Top 5 Clients Causing 4xx Errors**: from Dashboard: Nginx/Logs/Nginx - Web Server Operations 
- **Top 5 Clients causing Errors**: from Dashboard: Nginx/Logs/Nginx - Error Logs 
- **Top 5 Critical Messages**: from Dashboard: Nginx/Nginx - Overview 
- **Top 5 Highly Malicious URLs**: from Dashboard: Nginx/Logs/Nginx  - Threat Intel 
- **Top 5 Referrers**: from Dashboard: Nginx/Logs/Nginx - Visitor Traffic Insight 
- **Top 5 Servers with Errors**: from Dashboard: Nginx/Logs/Nginx - Error Logs 
- **Top 5 URIs causing 404 Responses**: from Dashboard: Nginx/Logs/Nginx - Web Server Operations 
- **Top 5 URLs**: from Dashboard: Nginx/Logs/Nginx - Visitor Traffic Insight 
- **Top 5 URLs with Errors**: from Dashboard: Nginx/Logs/Nginx - Error Logs 
- **Traffic Distribution by Server**: from Dashboard: Nginx/Logs/Nginx  - Trends 
- **Traffic Volume and Bytes Served**: from Dashboard: Nginx/Logs/Nginx  - Trends 
- **Unique Visitors**: from Dashboard: Nginx/Logs/Nginx - Visitor Access Types 
- **United States**: from Dashboard: Nginx/Logs/Nginx - Visitor Locations 
- **Visitor Locations**: from Dashboard: Nginx/Nginx - Overview 
- **Visitor Locations (Top 5 Countries) - Today Vs. Yesterday**: from Dashboard: Nginx/Logs/Nginx  - Trends 
- **Visitor Platforms**: from Dashboard: Nginx/Logs/Nginx - Visitor Access Types 
- **Visitors Platforms Over Time**: from Dashboard: Nginx/Logs/Nginx - Visitor Access Types 
- **Visits by Country Over Time**: from Dashboard: Nginx/Logs/Nginx - Visitor Locations 
- **Visits by US Regions Over Time**: from Dashboard: Nginx/Logs/Nginx - Visitor Locations 
- **WorldWide**: from Dashboard: Nginx/Logs/Nginx - Visitor Locations

### Metric Searches

- **Active Connections**: from Dashboard: Nginx/Metrics/Nginx - Connections and Requests 
- **Active Connections by Server**: from Dashboard: Nginx/Metrics/Nginx - Connections and Requests 
- **Active vs Dropped Connections**: from Dashboard: Nginx/Metrics/Nginx - Connections and Requests 
- **Active vs Dropped Connections**: from Dashboard: Nginx/Nginx - Overview 
- **Client Requests per Second**: from Dashboard: Nginx/Nginx - Overview 
- **Dropped Connections**: from Dashboard: Nginx/Metrics/Nginx - Connections and Requests 
- **Requests: Reading, Writing and Waiting**: from Dashboard: Nginx/Metrics/Nginx - Connections and Requests 
- **Total Number of Client Requests**: from Dashboard: Nginx/Metrics/Nginx - Connections and Requests 
- **Total Number of Client Requests**: from Dashboard: Nginx/Nginx - Overview 
- **Total Number of Handled Connections**: from Dashboard: Nginx/Metrics/Nginx - Connections and Requests

## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Nginx|4xx Codes by Server|Logs|Nginx/Nginx - Overview|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where status\_code matches "4\*"<br />\| if (isEmpty(pod),\_sourceHost,pod) as Host<br />\| count as count by status\_code, Host|
|Nginx/Logs|4xx Errors - Client Locations|Logs|Nginx/Logs/Nginx - Web Server Operations|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where status\_code matches "4\*"<br />\| count by Client\_Ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Nginx|5xx Codes by Server|Logs|Nginx/Nginx - Overview|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where status\_code matches "5\*"<br />\| if (isEmpty(pod),\_sourceHost,pod) as Host<br />\| count as count by status\_code, Host|
|Nginx/Metrics|Active Connections|Metrics|Nginx/Metrics/Nginx - Connections and Requests|\_sourceCategory = Labs/nginx\* webserver\_system=nginx metric=nginx\_active webserver\_farm={{webserver\_farm}} host={{host}} \| sum by metric|
|Nginx/Metrics|Active Connections by Server|Metrics|Nginx/Metrics/Nginx - Connections and Requests|\_sourceCategory = Labs/nginx\* webserver\_system=nginx metric = nginx\_active webserver\_farm={{webserver\_farm}} host={{host}} \| sum by webserver\_farm,host  |
|Nginx|Active vs Dropped Connections|Metrics|Nginx/Nginx - Overview|\_sourceCategory = Labs/nginx\* webserver\_system=nginx metric=nginx\_active webserver\_farm={{webserver\_farm}} \| sum by webserver\_farm,host|
|Nginx/Metrics|Active vs Dropped Connections|Metrics|Nginx/Metrics/Nginx - Connections and Requests|\_sourceCategory = Labs/nginx\* webserver\_system=nginx metric = nginx\_active webserver\_farm={{webserver\_farm}} host={{host}} \| sum by webserver\_farm, host|
|Nginx/Logs|All Errors|Logs|Nginx/Logs/Nginx - Error Logs|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss:SSS") as messageDate<br />\| count by messageDate, log\_level, Client\_Ip, Server, Method, URL, Message<br />\| fields - \_count<br />\| sort by messageDate<br />\| limit 50|
|Nginx/Logs|Browsers and Operating Systems|Logs|Nginx/Logs/Nginx - Visitor Access Types|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| if (user\_agent matches "\*Windows \*" OR user\_agent matches "\*Win32\*" OR user\_agent matches "\*Win64\*","Windows","") as OS <br />\| if (user\_agent matches "\*Macintosh\*" OR user\_agent matches "\*Darwin/\*" OR user\_agent matches "\*Mac OS\*","MacOS",OS) as OS <br />\| if (user\_agent matches "\* CrOS \*","Chrome OS",OS) as OS<br />\| if (user\_agent matches "\*Linux\*","Linux",OS) as OS <br />\| if (user\_agent matches "\*iPad\*","iPad",OS) as OS <br />\| if (user\_agent matches "\*iPhone\*","iPhone",OS) as OS <br />\| if (user\_agent matches "\*Android\*","Android",OS) as OS <br />\| if (user\_agent matches "\*Windows Phone\*","Windows Phone",OS) as OS <br />\| if (OS == "","Other",OS) as OS <br />\| if (user\_agent matches "Mozilla/\*; rv:\*)\*","Mozilla","") as Browser<br />\| if (user\_agent matches "\*MSIE\*","Internet Explorer",Browser) as Browser <br />\| if (user\_agent matches "\*Firefox\*","Firefox",Browser) as Browser <br />\| if (user\_agent matches "\*Safari\*","Safari",Browser) as Browser <br />\| if (OS=="Android" AND user\_agent matches "\*WebKit\*","WebKit",Browser) as Browser<br />\| if ((OS=="iPhone" OR OS=="iPad") AND (user\_agent matches "\*Mobile/\*" OR user\_agent matches "\*AppleWebKit\*(KHTML\*Gecko)\*"),"Mobile Safari",Browser) as Browser<br />\| if (browser == "" AND OS=="MacOS" AND user\_agent matches "Mozilla/\* (Macintosh;\*(KHTML, like Gecko)\*","Safari",Browser) as Browser <br />\| if (user\_agent matches "\*MobileSafari/\*","Mobile Safari",Browser) as Browser<br />\| if (user\_agent matches "\*Chrome\*","Chrome",Browser) as Browser <br />\| if (user\_agent matches "Opera\*","Opera",Browser) as Browser <br />\| if (user\_agent matches "Dolphin\*","Dolphin",Browser) as Browser <br />\| if (Browser == "","Other",Browser) as Browser  <br />\| count by OS,browser<br />\| transpose row Browser column OS|
|Nginx/Logs|Bytes Served|Logs|Nginx/Logs/Nginx - Outlier Analysis|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where size != "-" and !isEmpty(size)<br />\| number(size)<br />\| timeslice {{TimeSlice}} \| (size/(1048576\*1000)) as gbytes <br />\| sum(gbytes) as gbytes by \_timeslice <br />\| sort \_timeslice asc<br />\| outlier gbytes window={{Window}},threshold={{Threshold}},consecutive={{Consecutive}},direction=+- |
|Nginx/Logs|Bytes Served|Logs|Nginx/Logs/Nginx - Visitor Traffic Insight|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| sum(Size) as Bytes\_Served<br />\| Bytes\_Served/(1024\*1024\*1000) as Gbytes\_Served<br />\| fields Gbytes\_Served|
|Nginx/Logs|Client Errors|Logs|Nginx/Logs/Nginx - Outlier Analysis|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| if(status\_code matches "4\*", 1, 0) as client\_errors <br />\| timeslice {{TimeSlice}}<br />\| sum(client\_errors) as client\_errors by \_timeslice<br />\| sort \_timeslice asc<br />\| outlier client\_errors window={{Window}},threshold={{Threshold}},consecutive={{Consecutive}},direction=+|
|Nginx/Logs|Client Locations with Critical Errors|Logs|Nginx/Logs/Nginx - Error Logs|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| where log\_level in ("emerg", "alert", "crit")<br />\| where !isEmpty(client\_ip)<br />\| count by Client\_Ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Nginx|Client OS Platforms|Logs|Nginx/Nginx - Overview|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| count by User\_Agent<br />\| if (User\_Agent matches "\*iPad\*" or User\_Agent matches "\*iPhone\*" or User\_Agent matches "\*BlackBerry\*" or User\_Agent matches "\*SAMSUNG\*" or User\_Agent matches "\*Galaxy\*" or User\_Agent matches "\*Windows Phone\*" or User\_Agent matches "\*Android\*","Mobile","PC") as type<br />\| if (User\_Agent matches "\*Macintosh\*" or (User\_Agent matches "\*iMac\*"),"Mac",type) as type<br />\| count type<br />\| sort by \_count, type asc|
|Nginx|Client Requests per Second|Metrics|Nginx/Nginx - Overview|\_sourceCategory = Labs/nginx\* webserver\_system=nginx metric = nginx\_requests webserver\_farm={{webserver\_farm}} \| sum by metric \| rate|
|Nginx|Critical Error Messages|Logs|Nginx/Nginx - Overview|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| where log\_level in ("emerg", "alert", "crit")<br />\| count|
|Nginx/Logs|Critical Messages|Logs|Nginx/Logs/Nginx - Error Logs|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| where log\_level in ("emerg", "alert", "crit")<br />\| formatDate(\_messageTime, "MM/dd/yyyy HH:mm:ss:SSS") as messageDate<br />\| count by messageDate, log\_level, Server, Message<br />\| fields messageDate, log\_level, Server, Message<br />\| sort by messageDate<br />\| limit 20|
|Nginx/Logs|Desktop OS Version|Logs|Nginx/Logs/Nginx - Visitor Access Types|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx ("macintosh" OR "mac os" OR "windows" OR "i686" or "PC" or ("Linux" AND !android))<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| parse regex field=user\_agent "(?\<os\>Mac OS) (?\<version\>[^;\\)]+?)(?:;\|\\))" nodrop <br />\| parse regex field=user\_agent "(?\<os\>Windows)(?: NT \| )(?\<version\>[\\d.]+)" nodrop <br />\| parse regex field=user\_agent "(?\<os\>Linux) (?\<version\>\\S+?)(?:\\)\|;)" nodrop <br />\| where os != ""<br />\| count as count by os, version<br />\| transpose row Version column Os|
|Nginx/Metrics|Dropped Connections|Metrics|Nginx/Metrics/Nginx - Connections and Requests|\_sourceCategory = Labs/nginx\* webserver\_system=nginx metric = nginx\_handled webserver\_farm={{webserver\_farm}} host={{host}} \| sum |
|Nginx/Logs|Error Responses by Server|Logs|Nginx/Logs/Nginx - Web Server Operations|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where status\_code matches "4\*" or status\_code matches "5\*"<br />\| if (isEmpty(pod),\_sourceHost,pod) as Host<br />\| timeslice 5m<br />\| count as count by \_timeslice, Host<br />\| transpose row \_timeslice column Host|
|Nginx/Logs|Highly Malicious Threat Table|Logs|Nginx/Logs/Nginx  - Threat Intel|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| lookup type, actor, raw, threatlevel as Malicious\_Confidence from sumo://threat/cs on threat=Client\_Ip <br />\| where  type="ip\_address" and !isNull(Malicious\_Confidence)<br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| where Malicious\_Confidence matches "high"<br />\| count by Malicious\_Confidence, Actor, Client\_Ip, Status\_Code, URL, Referrer, User\_Agent<br />\| sort by \_count<br />\| limit 20|
|Nginx/Logs|HTTP Methods|Logs|Nginx/Logs/Nginx - Visitor Traffic Insight|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| count by Method|
|Nginx/Logs|Log Level - One Day Time Comparison|Logs|Nginx/Logs/Nginx - Error Logs|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| count by log\_level<br />\| sort by \_count \| compare with timeshift 1d|
|Nginx/Logs|Media Types Served|Logs|Nginx/Logs/Nginx - Visitor Traffic Insight|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| parse regex field=url "^/[^\\?]+?\\.(?\<type\>[a-zA-Z]{2,4})\$" <br />\| parse regex field=url "/\\S+?(?\<email\_prefix\>(?:%40\|@)[^.]+?)\\.\\w+" nodrop <br />\| where email\_prefix="" <br />\| count as count by type<br />\| sort by count, type asc|
|Nginx/Logs|Messages by Log Level - Over Time|Logs|Nginx/Logs/Nginx - Error Logs|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| timeslice 1h<br />\| count by \_timeslice, Log\_Level<br />\| transpose row \_timeslice column Log\_Level|
|Nginx/Logs/Searches|Nginx  - Top 404 referrers|Logs|Nginx/Logs/Searches/Nginx  - Top 404 referrers|webserver\_system=nginx 404<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where status\_code="404" <br />\| count\_frequent referrer <br />\| limit 100 |
|Nginx/Logs/Searches|Nginx  - Top browsers|Logs|Nginx/Logs/Searches/Nginx  - Top browsers|webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| count\_frequent user\_agent <br />\| limit 100 |
|Nginx/Logs/Searches|Nginx - All Error Messages|Logs|Nginx/Logs/Searches/Nginx - All Error Messages|webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| count by \_messageTime, log\_level, client\_ip, Server, Message|
|Nginx/Logs/Searches|Nginx - All HTTP Response codes with their count|Logs|Nginx/Logs/Searches/Nginx - All HTTP Response codes with their count|webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| count by status\_code \| sort by \_count|
|Nginx/Logs/Searches|Nginx - Client Errors (4xx response codes) per day|Logs|Nginx/Logs/Searches/Nginx - Client Errors (4xx response codes) per day|webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where status\_code matches "4\*" <br />\| timeslice by 1d \| count by \_timeslice |
|Nginx/Logs/Searches|Nginx - HTTP status code summary over time|Logs|Nginx/Logs/Searches/Nginx - HTTP status code summary over time|webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| if(status\_code matches "2\*", 1, 0) as successes <br />\| if(status\_code matches "3\*", 1, 0) as redirects <br />\| if(status\_code matches "4\*", 1, 0) as client\_errors <br />\| if(status\_code matches "5\*", 1, 0) as server\_errors <br />\| timeslice by 1d \| sum(successes) as successes, sum(redirects) as redirects, sum(client\_errors) as client\_errors, sum(server\_errors) as server\_errors by \_timeslice |
|Nginx/Logs/Searches|Nginx - Top clients|Logs|Nginx/Logs/Searches/Nginx - Top clients|webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| count\_frequent Client\_Ip <br />\| limit 100 |
|Nginx/Logs/Searches|Nginx - Top clients causing errors|Logs|Nginx/Logs/Searches/Nginx - Top clients causing errors|webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where status\_code matches "4\*" <br />\| count\_frequent Client\_Ip <br />\| limit 100 |
|Nginx/Logs/Searches|Nginx - Top URLs by bytes served|Logs|Nginx/Logs/Searches/Nginx - Top URLs by bytes served|webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where size != "-"<br />\| avg(size) as average\_size\_KB by url<br />\| sort by average\_size\_KB<br />\| limit 100<br />\| (average\_size\_KB/1024) as average\_size\_KB<br />\| (toLong(average\_size\_KB\*100)/100) as average\_size\_KB |
|Nginx/Logs/Searches|Nginx - Traffic volume and bytes served per day|Logs|Nginx/Logs/Searches/Nginx - Traffic volume and bytes served per day|webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*" <br />\| where size != "-"<br />\| (size/1048576) as mbytes<br />\| timeslice by 1d <br />\| sum(mbytes) as Bytes\_Served\_mb, count as hits by \_timeslice |
|Nginx/Logs|Non 200 Response Status Codes|Logs|Nginx/Logs/Nginx - Web Server Operations|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where !(status\_code matches "2\*") <br />\| count as count by status\_code <br />\| sort by count, status\_code asc|
|Nginx/Logs|Number of Hits by Server - One Day Time Comparison|Logs|Nginx/Logs/Nginx  - Trends|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx (\_sourceHost={{host}} or pod={{host}})<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| if (isEmpty(pod),\_sourceHost,pod) as Host<br />\| count as Number\_of\_Hits by Host  <br />\| compare with timeshift 1d|
|Nginx/Logs|Number of Requests by Client - One Day Time Comparison|Logs|Nginx/Logs/Nginx - Error Logs|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| where !isEmpty(Client\_Ip)<br />\| count by client\_ip<br />\| sort by \_count<br />\| compare with timeshift 1d|
|Nginx/Logs|Number of Visitors|Logs|Nginx/Logs/Nginx - Outlier Analysis|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where !isEmpty(Client\_Ip)<br />\| timeslice {{TimeSlice}}<br />\| count as count by \_timeslice <br />\| sort \_timeslice asc<br />\| outlier count window={{Window}},threshold={{Threshold}},consecutive={{Consecutive}},direction=+|
|Nginx/Logs|Popular Mobile Device Versions|Logs|Nginx/Logs/Nginx - Visitor Access Types|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx (iphone or ipad or android or samsung) <br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| parse regex field=nginx\_log\_message "\\((?\<device\>iPhone).+? CPU iPhone OS (?\<version\>.+?) like Mac"  nodrop <br />\| parse regex field=nginx\_log\_message "\\((?\<device\>iPad).+? CPU OS (?\<version\>.+?) like Mac"  nodrop <br />\| parse regex field=nginx\_log\_message " (?\<device\>Android) (?\<version\>[\\d\\.]+)" nodrop <br />\| parse regex field=nginx\_log\_message "(?\<device\>SAMSUNG).+?(?\<version\>(?:GT-\\w+\|SGH-\\w+\|SPH-\\w+\|SCH-\\w+))" <br />\| where device != ""<br />\| count as count by device, version <br />\| transpose row version column device|
|Nginx/Metrics|Requests: Reading, Writing and Waiting|Metrics|Nginx/Metrics/Nginx - Connections and Requests|\_sourceCategory = Labs/nginx\* webserver\_system=nginx metric = nginx\_reading webserver\_farm={{webserver\_farm}} host={{host}} \| sum by webserver\_farm, host|
|Nginx/Logs|Responses Over Time|Logs|Nginx/Logs/Nginx  - Trends|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx (\_sourceHost={{host}} or pod={{host}})<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| if(Status\_Code matches "2\*", 1, 0) as Successes <br />\| if(Status\_Code matches "3\*", 1, 0) as Redirects <br />\| if(status\_code matches "4\*", 1, 0) as Client\_Errors <br />\| if(Status\_Code matches "5\*", 1, 0) as Server\_Errors <br />\| timeslice by 1h <br />\| sum(Successes) as Successes, sum(Client\_Errors) as Client\_Errors,  sum(Redirects) as Redirects, sum(Server\_Errors) as Server\_Errors by \_timeslice<br />\| sort by \_timeslice asc|
|Nginx|Responses Over Time|Logs|Nginx/Nginx - Overview|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| if(Status\_Code matches "2\*", 1, 0) as Successes <br />\| if(Status\_Code matches "3\*", 1, 0) as Redirects <br />\| if(status\_code matches "4\*", 1, 0) as Client\_Errors <br />\| if(Status\_Code matches "5\*", 1, 0) as Server\_Errors <br />\| timeslice by 5m<br />\| sum(Successes) as Successes, sum(Client\_Errors) as Client\_Errors,  sum(Redirects) as Redirects, sum(Server\_Errors) as Server\_Errors by \_timeslice<br />\| sort by \_timeslice asc|
|Nginx/Logs|Server Errors|Logs|Nginx/Logs/Nginx - Outlier Analysis|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| if(status\_code matches "5\*", 1, 0) as server\_errors <br />\| timeslice {{TimeSlice}}<br />\| sum(server\_errors) as server\_errors by \_timeslice<br />\| sort \_timeslice asc<br />\| outlier server\_errors window={{Window}},threshold={{Threshold}},consecutive={{Consecutive}},direction=+|
|Nginx/Logs|Server Errors Over Time|Logs|Nginx/Logs/Nginx - Web Server Operations|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where status\_code matches "5\*"<br />\| timeslice 5m<br />\| count as count by \_timeslice, status\_code<br />\| transpose row \_timeslice column status\_code |
|Nginx/Logs|Threat Breakdown by Sources|Logs|Nginx/Logs/Nginx  - Threat Intel|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| count as ip\_count by Client\_Ip, \_source<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=Client\_Ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (ip\_count) as threat\_count by \_source |
|Nginx/Logs|Threat by Actors|Logs|Nginx/Logs/Nginx  - Threat Intel|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| count as ip\_count by Client\_Ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=Client\_Ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (ip\_count) as threat\_count by Actor|
|Nginx/Logs|Threat by Malicious Confidence|Logs|Nginx/Logs/Nginx  - Threat Intel|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| count as ip\_count by Client\_Ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=Client\_Ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (ip\_count) as threat\_count by malicious\_confidence|
|Nginx/Logs|Threat Count|Logs|Nginx/Logs/Nginx  - Threat Intel|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| count as ip\_count by Client\_Ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=Client\_Ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\|sum (ip\_count) as threat\_count|
|Nginx/Logs|Threat Locations|Logs|Nginx/Logs/Nginx  - Threat Intel|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| count as ip\_count by Client\_Ip<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=Client\_Ip <br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where type="ip\_address" and !isNull(malicious\_confidence)<br />\| count by Client\_Ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Nginx/Logs|Threat Table|Logs|Nginx/Logs/Nginx  - Threat Intel|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=Client\_Ip <br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| json field=raw "labels[\*].name" as label\_name <br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| count by malicious\_confidence, Actor, Client\_Ip, method, status\_code, URL, size, referrer, user\_agent<br />\| sort by \_count<br />\| limit 50|
|Nginx/Logs|Top 10 Bots Observed|Logs|Nginx/Logs/Nginx - Web Server Operations|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx ("Googlebot" OR "AskJeeves" OR "Digger" OR "Lycos"<br />OR "msnbot" OR "Inktomi Slurp" OR "Yahoo" OR "Nutch" OR "bingbot" OR<br />"BingPreview" OR "Mediapartners-Google" OR "proximic" OR "AhrefsBot" OR<br />"AdsBot-Google" OR "Ezooms" OR "AddThis.com" OR "facebookexternalhit" OR<br />"MetaURI" OR "Feedfetcher-Google" OR "PaperLiBot" OR "TweetmemeBot" OR<br />"Sogou web spider" OR "GoogleProducer" OR "RockmeltEmbedder" OR<br />"ShareThisFetcher" OR "YandexBot" OR "rogerbot-crawler" OR "ShowyouBot" OR "Baiduspider" OR "Sosospider" OR "Exabot")<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| parse regex field=user\_agent "(?\<bot\_name\>facebook)externalhit?\\W+" nodrop<br />\| parse regex field=user\_agent "Feedfetcher-(?\<bot\_name\>Google?)\\S+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>PaperLiBot?)/.+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>TweetmemeBot?)/.+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>msn?)bot\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Nutch?)-.+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Google?)bot\\W" nodrop<br />\| parse regex field=user\_agent "Feedfetcher-(?\<bot\_name\>Google?)\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Yahoo?)!\\s+Slurp[;/].+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>bing?)bot\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Bing?)Preview\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Sogou?)\\s+web\\s" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Yandex?)Bot\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>rogerbot?)\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>AddThis\\.com?)\\s+robot\\s+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>ShareThis?)Fetcher/.+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Ahrefs?)Bot/.+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>MetaURI?)\\s+API/.+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Showyou?)Bot\\s+" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Google?)Producer;" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Ezooms?)\\W" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Rockmelt?)Embedder\\s+" nodrop <br />\| parse regex field=user\_agent "(?\<bot\_name\>Sosospider?)\\W" nodrop <br />\| parse regex field=user\_agent "(?\<bot\_name\>Baidu?)spider" nodrop<br />\| parse regex field=user\_agent "(?\<bot\_name\>Exabot?)\\W"<br />\| where bot\_name != ""<br />\| if (bot\_name="bing","Bing",bot\_name) as bot\_name<br />\| count as count by bot\_name<br />\| sort by count<br />\| limit 10|
|Nginx/Logs|Top 10 Search Terms from Popular Search Engines|Logs|Nginx/Logs/Nginx - Visitor Traffic Insight|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx (google OR bing OR aol OR ask OR yahoo) ("p=" OR "q=" OR "wd=" OR "searchfor=")<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| parse regex field=referrer "(?:\\?\|&)(?:p\|q\|wd\|searchfor)=(?\<search\_term\>[^=]+?)(?:&\|\$)" nodrop <br />\| where search\_term != ""<br />\| urldecode(search\_term)<br />\| if(referrer matches "\*google.\*", "Google", "") as engine<br />\| if(referrer matches "\*bing.\*", "Bing", engine) as engine<br />\| if(referrer matches "\*ask.com\*", "Ask.com", engine) as engine<br />\| if(referrer matches "\*aol.\*", "AOL", engine) as engine<br />\| if(referrer matches "\*yahoo.\*", "Yahoo", engine) as engine<br />\| where engine !="" <br />\| count as count by search\_term<br />\| sort count<br />\| limit 10|
|Nginx|Top 10 URLs with 4xx Errors|Logs|Nginx/Nginx - Overview|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where Status\_Code matches "4\*"<br />\| count as count by URL, Status\_Code<br />\| sort by count, URL asc \| limit 10|
|Nginx|Top 10 URLs with 5xx Errors|Logs|Nginx/Nginx - Overview|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where Status\_Code matches "5\*"<br />\| count as count by URL, Status\_Code<br />\| sort by count, URL asc \| limit 10|
|Nginx/Logs|Top 5 Clients Causing 4xx Errors|Logs|Nginx/Logs/Nginx - Web Server Operations|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where status\_code matches "4\*"<br />\| count as count by Client\_Ip<br />\| sort count <br />\| limit 5 |
|Nginx/Logs|Top 5 Clients causing Errors|Logs|Nginx/Logs/Nginx - Error Logs|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| where !isEmpty(client\_ip)<br />\| count by client\_ip<br />\| sort by \_count<br />\| limit 5|
|Nginx|Top 5 Critical Messages|Logs|Nginx/Nginx - Overview|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| where log\_level in ("emerg", "alert", "crit")<br />\| count as Count by Message, Server<br />\| sort by Count<br />\| limit 5|
|Nginx/Logs|Top 5 Highly Malicious URLs|Logs|Nginx/Logs/Nginx  - Threat Intel|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| count as ip\_count by Client\_Ip, URL<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=Client\_Ip <br />\| where malicious\_confidence matches "high"<br />\| count by URL<br />\| limit 5|
|Nginx/Logs|Top 5 Referrers|Logs|Nginx/Logs/Nginx - Visitor Traffic Insight|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where referrer != "-"<br />\| count as count by referrer<br />\| sort by count<br />\| limit 5 |
|Nginx/Logs|Top 5 Servers with Errors|Logs|Nginx/Logs/Nginx - Error Logs|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| where !isEmpty(server)<br />\| count by server<br />\| sort by \_count<br />\| limit 5|
|Nginx/Logs|Top 5 URIs causing 404 Responses|Logs|Nginx/Logs/Nginx - Web Server Operations|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where status\_code = "404"<br />\| count as count by url<br />\| sort count, url asc<br />\| limit 5|
|Nginx/Logs|Top 5 URLs|Logs|Nginx/Logs/Nginx - Visitor Traffic Insight|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| count as count by url<br />\| sort by count<br />\| limit 5|
|Nginx/Logs|Top 5 URLs with Errors|Logs|Nginx/Logs/Nginx - Error Logs|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "\\s\\[(?\<Log\_Level\>\\S+)\\]\\s\\d+#\\d+:\\s(?:\\\*\\d+\\s\|)(?\<Message\>[A-Za-z][^,]+)(?:,\|\$)"<br />\| parse field=nginx\_log\_message "client: \*, server: \*, request: \\"\* \* HTTP/1.1\\", host: \\"\*\\"" as Client\_Ip, Server, Method, URL, Host nodrop<br />\| count by URL<br />\| sort by \_count<br />\| limit 5|
|Nginx|Total Number of Client Requests|Metrics|Nginx/Nginx - Overview|\_sourceCategory = Labs/nginx\* webserver\_system=nginx metric = nginx\_requests webserver\_farm={{webserver\_farm}} \| sum by webserver\_farm, host|
|Nginx/Metrics|Total Number of Client Requests|Metrics|Nginx/Metrics/Nginx - Connections and Requests|\_sourceCategory = Labs/nginx\* webserver\_system=nginx metric = nginx\_requests webserver\_farm={{webserver\_farm}} host={{host}} \| sum by webserver\_farm,host|
|Nginx/Metrics|Total Number of Handled Connections|Metrics|Nginx/Metrics/Nginx - Connections and Requests|\_sourceCategory = Labs/nginx\* webserver\_system=nginx metric = nginx\_handled webserver\_farm={{webserver\_farm}} host={{host}} \| sum by webserver\_farm,host|
|Nginx/Logs|Traffic Distribution by Server|Logs|Nginx/Logs/Nginx  - Trends|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx (\_sourceHost={{host}} or pod={{host}})<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| if (isEmpty(pod),\_sourceHost,pod) as Host<br />\| timeslice 1h<br />\| count by \_timeslice, Host  <br />\| transpose row \_timeslice column Host|
|Nginx/Logs|Traffic Volume and Bytes Served|Logs|Nginx/Logs/Nginx  - Trends|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx (\_sourceHost={{host}} or pod={{host}})<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| where size != "-"<br />\| timeslice 1h<br />\| (size/(1048576\*1000)) as gbytes <br />\| count as hits, sum(gbytes) as gbytes by \_timeslice <br />\| sort \_timeslice asc|
|Nginx/Logs|Unique Visitors|Logs|Nginx/Logs/Nginx - Visitor Access Types|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| Count by Client\_Ip<br />\| Count|
|Nginx/Logs|United States|Logs|Nginx/Logs/Nginx - Visitor Locations|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| count by Client\_Ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| where country\_name="United States" AND !isNull(region) AND region !=""<br />\| sort \_count|
|Nginx|Visitor Locations|Logs|Nginx/Nginx - Overview|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| count by Client\_Ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Nginx/Logs|Visitor Locations (Top 5 Countries) - Today Vs. Yesterday|Logs|Nginx/Logs/Nginx  - Trends|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx (\_sourceHost={{host}} or pod={{host}})<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip<br />\| where !isEmpty(country\_name)<br />\| count as Visitors\_Locations by country\_name<br />\| sort Visitors\_Locations <br />\| compare with timeshift 1d<br />\| order by Visitors\_Locations desc<br />\| limit 5|
|Nginx/Logs|Visitor Platforms|Logs|Nginx/Logs/Nginx - Visitor Access Types|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| if (user\_agent matches "\*iPad\*" OR user\_agent matches "\*iPhone\*" OR user\_agent matches "\*Android\*" OR user\_agent matches "\*BlackBerry\*" OR user\_agent matches "\*Galaxy\*" OR user\_agent matches "LGE-\*" OR user\_agent matches "SCH-\*" OR user\_agent matches "\*HUAWEI-\*" OR user\_agent matches "\*SAMSUNG\*" OR user\_agent matches "\*samsung\*" OR user\_agent matches "Dalvik/\*" OR user\_agent matches "Nokia\*" OR user\_agent matches "LG-\*" OR user\_agent matches "\*CFNetwork\*"  OR user\_agent matches "\*UP.Browser/\*" OR user\_agent matches "\*QQ\*rowser\*" OR user\_agent matches "\*NetFront/\*" OR user\_agent matches "\*Windows Phone\*" OR user\_agent matches "\*Mobile Safari\*" OR user\_agent matches "\*iemobile\*","Mobile","") as type<br />\| if (user\_agent matches "\*Windows\*" OR user\_agent matches "\*Win64\*" OR user\_agent matches "\*Win32\*" OR user\_agent matches "\*i686\*" OR user\_agent matches "\*x86\*","PC",type) as type<br />\| if (user\_agent matches "\*Macintosh\*" OR user\_agent matches "\*Mac OS\*","Mac",type) as type<br />\| if (type = "","bots/unknown",type) as type<br />\| count type<br />\| sort by \_count|
|Nginx/Logs|Visitors Platforms Over Time|Logs|Nginx/Logs/Nginx - Visitor Access Types|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| if (user\_agent matches "\*iPad\*" OR user\_agent matches "\*iPhone\*" OR user\_agent matches "\*Android\*" OR user\_agent matches "\*BlackBerry\*" OR user\_agent matches "\*Galaxy\*" OR user\_agent matches "LGE-\*" OR user\_agent matches "SCH-\*" OR user\_agent matches "\*HUAWEI-\*" OR user\_agent matches "\*SAMSUNG\*" OR user\_agent matches "\*samsung\*" OR user\_agent matches "Dalvik/\*" OR user\_agent matches "Nokia\*" OR user\_agent matches "LG-\*" OR user\_agent matches "\*CFNetwork\*"  OR user\_agent matches "\*UP.Browser/\*" OR user\_agent matches "\*QQ\*rowser\*" OR user\_agent matches "\*NetFront/\*" OR user\_agent matches "\*Windows Phone\*" OR user\_agent matches "\*Mobile Safari\*" OR user\_agent matches "\*iemobile\*","Mobile","") as type<br />\| if (user\_agent matches "\*Windows\*" OR user\_agent matches "\*Win64\*" OR user\_agent matches "\*Win32\*" OR user\_agent matches "\*i686\*" OR user\_agent matches "\*x86\*","PC",type) as type<br />\| if (user\_agent matches "\*Macintosh\*" OR user\_agent matches "\*Mac OS\*","Mac",type) as type<br />\| if (type = "","bots/unknown",type) as type<br />\| timeslice 5m<br />\| count by \_timeslice, type<br />\| transpose row \_timeslice column type|
|Nginx/Logs|Visits by Country Over Time|Logs|Nginx/Logs/Nginx - Visitor Locations|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| timeslice 5m<br />\| count by \_timeslice, Client\_Ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip<br />\| where !isNull(country\_name) AND country\_name != ""<br />\| count by \_timeslice, country\_name<br />\| transpose row \_timeslice column country\_name as \* |
|Nginx/Logs|Visits by US Regions Over Time|Logs|Nginx/Logs/Nginx - Visitor Locations|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| timeslice 5m<br />\| count by \_timeslice, Client\_Ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip<br />\| where country\_name="United States" AND !isNull(region) AND region !=""<br />\| count by \_timeslice, region<br />\| transpose row \_timeslice column region as \* |
|Nginx/Logs|WorldWide|Logs|Nginx/Logs/Nginx - Visitor Locations|\_sourceCategory = Labs/nginx\* webserver\_farm={{webserver\_farm}} webserver\_system=nginx<br />\| json auto maxdepth 1 nodrop<br />\| if (isEmpty(log), \_raw, log) as nginx\_log\_message<br />\| parse regex field=nginx\_log\_message "(?\<Client\_Ip\>(?:[0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4}\|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})"<br />\| parse regex field=nginx\_log\_message "(?\<Method\>[A-Z]+)\\s(?\<URL\>\\S+)\\sHTTP/[\\d\\.]+\\"\\s(?\<Status\_Code\>\\d+)\\s(?\<Size\>[\\d-]+)\\s\\"(?\<Referrer\>.\*?)\\"\\s\\"(?\<User\_Agent\>.+?)\\".\*"<br />\| count by Client\_Ip<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = Client\_Ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|

