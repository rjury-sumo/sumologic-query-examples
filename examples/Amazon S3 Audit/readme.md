# Amazon S3 Audit
## Sumo Logic App For: Amazon S3 Audit
Amazon Simple Storage Service (S3) provides a simple web services interface that can be used to store and retrieve any amount of data from anywhere on the web. The Sumo Logic Application for Amazon S3 Audit presents details from access logs that contain information about the request type, the average response time, and the inbound and outbound data volume.
Docs Link: [Amazon S3 Audit](https://help.sumologic.com/?cid=1050)

## Searches

### Log Searches

- **Average Latency in Milliseconds by S3 Bucket**: from Dashboard: Amazon S3 Audit/Amazon S3 Audit - Details 
- **Average Latency in Milliseconds by S3 Bucket**: from Dashboard: Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Details 
- **Data Added to S3 Bucket**: from Dashboard: Amazon S3 Audit/Amazon S3 Audit - Details 
- **Data Added to S3 Bucket**: from Dashboard: Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Details 
- **Data Volume Sent in MB by S3 Bucket**: from Dashboard: Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Overview 
- **Data Volume Sent in MB by S3 Bucket**: from Dashboard: Amazon S3 Audit/Amazon S3 Audit - Details 
- **Data Volume Sent in MB by S3 Bucket**: from Dashboard: Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Details 
- **Data Volume Sent in MB by S3 Bucket**: from Dashboard: Amazon S3 Audit/Amazon S3 Audit - Overview 
- **Geolocation of Clients**: from Dashboard: Amazon S3 Audit/Amazon S3 Audit - Details 
- **Geolocation of Clients**: from Dashboard: Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Overview 
- **Geolocation of Clients**: from Dashboard: Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Details 
- **Geolocation of Clients**: from Dashboard: Amazon S3 Audit/Amazon S3 Audit - Overview 
- **Highly Malicious Threat Table**: from Dashboard: Amazon S3 Audit/Amazon S3 Audit - Threat Intel 
- **Highly Malicious Threat Table**: from Dashboard: Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Threat Intel 
- **Requests by Operation**: from Dashboard: Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Details 
- **Requests by Operation**: from Dashboard: Amazon S3 Audit/Amazon S3 Audit - Overview 
- **Requests by Operation**: from Dashboard: Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Overview 
- **Requests by Operation**: from Dashboard: Amazon S3 Audit/Amazon S3 Audit - Details 
- **Threat by Actors**: from Dashboard: Amazon S3 Audit/Amazon S3 Audit - Threat Intel 
- **Threat by Actors**: from Dashboard: Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Threat Intel 
- **Threat by Malicious Confidence**: from Dashboard: Amazon S3 Audit/Amazon S3 Audit - Threat Intel 
- **Threat by Malicious Confidence**: from Dashboard: Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Threat Intel 
- **Threat Count**: from Dashboard: Amazon S3 Audit/Amazon S3 Audit - Threat Intel 
- **Threat Count**: from Dashboard: Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Threat Intel 
- **Threat Locations**: from Dashboard: Amazon S3 Audit/Amazon S3 Audit - Threat Intel 
- **Threat Locations**: from Dashboard: Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Threat Intel 
- **Threat Table**: from Dashboard: Amazon S3 Audit/Amazon S3 Audit - Threat Intel 
- **Threat Table**: from Dashboard: Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Threat Intel 
- **Total 4xx/5xx Status Codes by S3 Bucket**: from Dashboard: Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Details 
- **Total 4xx/5xx Status Codes by S3 Bucket**: from Dashboard: Amazon S3 Audit/Amazon S3 Audit - Details 
- **Total Requests by S3 Bucket**: from Dashboard: Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Details 
- **Total Requests by S3 Bucket**: from Dashboard: Amazon S3 Audit/Amazon S3 Audit - Overview 
- **Total Requests by S3 Bucket**: from Dashboard: Amazon S3 Audit/Amazon S3 Audit - Details 
- **Total Requests by S3 Bucket**: from Dashboard: Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Overview

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Amazon S3 Audit|Average Latency in Milliseconds by S3 Bucket|Logs|Amazon S3 Audit/Amazon S3 Audit - Details|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| timeslice by 1m <br />\| avg(total\_time) as latency by \_timeslice, bucket<br />\| transpose row \_timeslice column bucket|
|Amazon S3 Audit|Average Latency in Milliseconds by S3 Bucket|Logs|Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Details|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| timeslice by 1m <br />\| avg(total\_time) as latency by \_timeslice, bucket<br />\| transpose row \_timeslice column bucket|
|Amazon S3 Audit|Data Added to S3 Bucket|Logs|Amazon S3 Audit/Amazon S3 Audit - Details|\_sourceCategory={{S3ServerAccessLogsSource}}  PUT\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID <br />\| where bucket matches "{{S3\_Bucket}}"<br />\| (object\_size/1024)/1024 as object\_volume <br />\| sum(object\_volume) as mb by bucket <br />\| sort by mb|
|Amazon S3 Audit|Data Added to S3 Bucket|Logs|Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Details|\_sourceCategory={{S3ServerAccessLogsSource}}  PUT\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID <br />\| where bucket matches "{{S3\_Bucket}}"<br />\| (object\_size/1024)/1024 as object\_volume <br />\| sum(object\_volume) as mb by bucket <br />\| sort by mb|
|Amazon S3 Audit|Data Volume Sent in MB by S3 Bucket|Logs|Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Overview|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where (bytes\_sent != "-")<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| ((bytes\_sent/(1024))/1024) as mbytes1<br />\| sum(mbytes1) as data\_sent by bucket<br />\| sort by data\_sent|
|Amazon S3 Audit|Data Volume Sent in MB by S3 Bucket|Logs|Amazon S3 Audit/Amazon S3 Audit - Details|\_sourceCategory={{S3ServerAccessLogsSource}}   \| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| timeslice 1m<br />\| where (bytes\_sent != "-")<br />\| (bytes\_sent/(1024))/1024 as mbytes1<br />\| sum(mbytes1) as data\_sent by \_timeslice, bucket<br />\| transpose row \_timeslice column bucket|
|Amazon S3 Audit|Data Volume Sent in MB by S3 Bucket|Logs|Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Details|\_sourceCategory={{S3ServerAccessLogsSource}}   \| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| timeslice 1m<br />\| where (bytes\_sent != "-")<br />\| (bytes\_sent/(1024))/1024 as mbytes1<br />\| sum(mbytes1) as data\_sent by \_timeslice, bucket<br />\| transpose row \_timeslice column bucket|
|Amazon S3 Audit|Data Volume Sent in MB by S3 Bucket|Logs|Amazon S3 Audit/Amazon S3 Audit - Overview|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where (bytes\_sent != "-")<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| ((bytes\_sent/(1024))/1024) as mbytes1<br />\| sum(mbytes1) as data\_sent by bucket<br />\| sort by data\_sent|
|Amazon S3 Audit|Geolocation of Clients|Logs|Amazon S3 Audit/Amazon S3 Audit - Details|\_sourceCategory={{S3ServerAccessLogsSource}}   \| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = remoteIP<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Amazon S3 Audit|Geolocation of Clients|Logs|Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Overview|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = remoteIP<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Amazon S3 Audit|Geolocation of Clients|Logs|Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Details|\_sourceCategory={{S3ServerAccessLogsSource}}   \| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = remoteIP<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Amazon S3 Audit|Geolocation of Clients|Logs|Amazon S3 Audit/Amazon S3 Audit - Overview|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = remoteIP<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Amazon S3 Audit|Highly Malicious Threat Table|Logs|Amazon S3 Audit/Amazon S3 Audit - Threat Intel|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| count remoteIP, bucket, operation, requester, status\_code, user\_agent<br />\| where !isPrivateIP(remoteIP)<br /><br />\| threatlookup singleIndicator remoteIP<br /><br />// normalize confidence level to a string <br />\| if (\_threatlookup.confidence \>= 85, "high", if (\_threatlookup.confidence \>= 50, "medium", if (\_threatlookup.confidence \>= 15, "low", if (\_threatlookup.confidence \>= 0, "unverified", "unknown")))) as threat\_confidence<br /><br />\| where threat\_confidence matches "high"<br /><br />//rename to match threat\_\<foo\> convention<br />\| %"\_threatlookup.actors" as threat\_actors<br />\| %"\_threatlookup.type" as type<br />\| %"\_threatlookup.threat\_type" as threat\_type<br /><br />//convert threat valid from to human readable time<br />\| toLong(%"\_threatlookup.valid\_from" \* 1000) as %"\_threatlookup.valid\_from"<br />\| formatDate(%"\_threatlookup.valid\_from", "MM-dd-yyyy") as threat\_valid\_from<br /><br />\| where type matches "ipv4-addr\*" and !isNull(threat\_confidence)<br /><br />\| if (isEmpty(threat\_actors), "Unassigned", threat\_actors) as threat\_actors<br /><br />\| count by remoteIP, type, threat\_actors, threat\_confidence, threat\_type,threat\_valid\_from, bucket, operation, requester, status\_code, user\_agent<br />\| sort by \_count|
|Amazon S3 Audit|Highly Malicious Threat Table|Logs|Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Threat Intel|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| count remoteIP, bucket, operation, requester, status\_code, user\_agent<br />\| where !isPrivateIP(remoteIP)<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=remoteIP <br />\| where malicious\_confidence matches "high"<br />\| json field=raw "labels[\*].name" as label\_name<br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| count by remoteIP, type, actor, malicious\_confidence, label\_name, bucket, operation, requester, status\_code, user\_agent<br />\| sort by \_count|
|Amazon S3 Audit|Requests by Operation|Logs|Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Details|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID <br />\| where bucket matches "{{S3\_Bucket}}"<br />\| parse regex field=operation "[A-Z]+\\.(?\<operation\>[\\w.]+)" <br />\| count by operation|
|Amazon S3 Audit|Requests by Operation|Logs|Amazon S3 Audit/Amazon S3 Audit - Overview|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID <br />\| where bucket matches "{{S3\_Bucket}}"<br />\| parse regex field=operation "[A-Z]+\\.(?\<operation\>[\\w.]+)" <br />\| count by operation|
|Amazon S3 Audit|Requests by Operation|Logs|Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Overview|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID <br />\| where bucket matches "{{S3\_Bucket}}"<br />\| parse regex field=operation "[A-Z]+\\.(?\<operation\>[\\w.]+)" <br />\| count by operation|
|Amazon S3 Audit|Requests by Operation|Logs|Amazon S3 Audit/Amazon S3 Audit - Details|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID <br />\| where bucket matches "{{S3\_Bucket}}"<br />\| parse regex field=operation "[A-Z]+\\.(?\<operation\>[\\w.]+)" <br />\| count by operation|
|Amazon S3 Audit|Threat by Actors|Logs|Amazon S3 Audit/Amazon S3 Audit - Threat Intel|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| count by remoteIP<br />\| where !isPrivateIP(remoteIP)<br /><br />\| threatlookup singleIndicator remoteIP<br /><br />// normalize confidence level to a string <br />\| if (\_threatlookup.confidence \>= 85, "high", if (\_threatlookup.confidence \>= 50, "medium", if (\_threatlookup.confidence \>= 15, "low", if (\_threatlookup.confidence \>= 0, "unverified", "unknown")))) as threat\_confidence<br /><br />\| where threat\_confidence matches "{{threat\_confidence}}"<br /><br />//rename to match threat\_\<foo\> convention<br />\| %"\_threatlookup.actors" as threat\_actors<br />\| %"\_threatlookup.type" as type<br />\| %"\_threatlookup.threat\_type" as threat\_type<br /><br />//convert threat valid from to human readable time<br />\| toLong(%"\_threatlookup.valid\_from" \* 1000) as %"\_threatlookup.valid\_from"<br />\| formatDate(%"\_threatlookup.valid\_from", "MM-dd-yyyy") as threat\_valid\_from<br /><br />\| where type matches "ipv4-addr\*" and !isNull(threat\_confidence)<br /><br />\| if (isEmpty(threat\_actors), "Unassigned", threat\_actors) as threat\_actors<br /><br />\| sum(\_count) as threatCount by threat\_actors<br />\| sort by threatCount, threat\_actors asc|
|Amazon S3 Audit|Threat by Actors|Logs|Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Threat Intel|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| count by remoteIP<br />\| where !isPrivateIP(remoteIP)<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=remoteIP <br />\| where malicious\_confidence matches "{{malicious\_confidence}}"<br />\| json field=raw "labels[\*].name" as label\_name<br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum(\_count) as threatCount by Actor<br />\| sort by threatCount, Actor asc|
|Amazon S3 Audit|Threat by Malicious Confidence|Logs|Amazon S3 Audit/Amazon S3 Audit - Threat Intel|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| count by remoteIP<br />\| where !isPrivateIP(remoteIP)<br /><br />\| threatlookup singleIndicator remoteIP<br /><br />// normalize confidence level to a string <br />\| if (\_threatlookup.confidence \>= 85, "high", if (\_threatlookup.confidence \>= 50, "medium", if (\_threatlookup.confidence \>= 15, "low", if (\_threatlookup.confidence \>= 0, "unverified", "unknown")))) as threat\_confidence<br /><br />\| where threat\_confidence matches "{{threat\_confidence}}"<br /><br />//rename to match threat\_\<foo\> convention<br />\| %"\_threatlookup.actors" as threat\_actors<br />\| %"\_threatlookup.type" as type<br />\| %"\_threatlookup.threat\_type" as threat\_type<br /><br />//convert threat valid from to human readable time<br />\| toLong(%"\_threatlookup.valid\_from" \* 1000) as %"\_threatlookup.valid\_from"<br />\| formatDate(%"\_threatlookup.valid\_from", "MM-dd-yyyy") as threat\_valid\_from<br /><br />\| where type matches "ipv4-addr\*" and !isNull(threat\_confidence)<br /><br />\| if (isEmpty(threat\_actors), "Unassigned", threat\_actors) as threat\_actors<br /><br />\| sum(\_count) as threatCount by threat\_confidence<br />\| sort by threatCount, threat\_confidence asc|
|Amazon S3 Audit|Threat by Malicious Confidence|Logs|Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Threat Intel|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| count by remoteIP<br />\| where !isPrivateIP(remoteIP)<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=remoteIP <br />\| where malicious\_confidence matches "{{malicious\_confidence}}"<br />\| json field=raw "labels[\*].name" as label\_name<br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| sum(\_count) as threatCount by malicious\_confidence<br />\| sort by threatCount, malicious\_confidence asc|
|Amazon S3 Audit|Threat Count|Logs|Amazon S3 Audit/Amazon S3 Audit - Threat Intel|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| where !isPrivateIP(remoteIP)<br /><br />\| threatlookup singleIndicator remoteIP<br /><br />// normalize confidence level to a string <br />\| if (\_threatlookup.confidence \>= 85, "high", if (\_threatlookup.confidence \>= 50, "medium", if (\_threatlookup.confidence \>= 15, "low", if (\_threatlookup.confidence \>= 0, "unverified", "unknown")))) as threat\_confidence<br /><br />\| where threat\_confidence matches "{{threat\_confidence}}"<br /><br />//rename to match threat\_\<foo\> convention<br />\| %"\_threatlookup.actors" as threat\_actors<br />\| %"\_threatlookup.type" as type<br />\| %"\_threatlookup.threat\_type" as threat\_type<br /><br />//convert threat valid from to human readable time<br />\| toLong(%"\_threatlookup.valid\_from" \* 1000) as %"\_threatlookup.valid\_from"<br />\| formatDate(%"\_threatlookup.valid\_from", "MM-dd-yyyy") as threat\_valid\_from<br /><br />\| where type matches "ipv4-addr\*" and !isNull(threat\_confidence)<br /><br />\| if (isEmpty(threat\_actors), "Unassigned", threat\_actors) as threat\_actors<br /><br />\| count|
|Amazon S3 Audit|Threat Count|Logs|Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Threat Intel|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| where !isPrivateIP(remoteIP)<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=remoteIP<br />\| where malicious\_confidence matches "{{malicious\_confidence}}"<br />\| where !isNull(malicious\_confidence)<br />\| count|
|Amazon S3 Audit|Threat Locations|Logs|Amazon S3 Audit/Amazon S3 Audit - Threat Intel|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| where !isBlank(remoteIP)<br /><br />\| threatlookup singleIndicator remoteIP<br /><br />// normalize confidence level to a string <br />\| if (\_threatlookup.confidence \>= 85, "high", if (\_threatlookup.confidence \>= 50, "medium", if (\_threatlookup.confidence \>= 15, "low", if (\_threatlookup.confidence \>= 0, "unverified", "unknown")))) as threat\_confidence<br /><br />\| where threat\_confidence matches "{{threat\_confidence}}"<br /><br />//rename to match threat\_\<foo\> convention<br />\| %"\_threatlookup.actors" as threat\_actors<br />\| %"\_threatlookup.type" as type<br />\| %"\_threatlookup.threat\_type" as threat\_type<br /><br />//convert threat valid from to human readable time<br />\| toLong(%"\_threatlookup.valid\_from" \* 1000) as %"\_threatlookup.valid\_from"<br />\| formatDate(%"\_threatlookup.valid\_from", "MM-dd-yyyy") as threat\_valid\_from<br /><br />\| where type matches "ipv4-addr\*" and !isNull(threat\_confidence)<br /><br />\| if (isEmpty(threat\_actors), "Unassigned", threat\_actors) as threat\_actors<br /><br />\| lookup latitude, longitude, country\_code, country\_name, city from geo://location on ip = remoteIP<br />\| count by remoteIP, country\_coude, country\_name, city, type, actor, threat\_confidence, bucket, operation, requester, status\_code, user\_agent, latitude, longitude<br />\| sort by \_count|
|Amazon S3 Audit|Threat Locations|Logs|Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Threat Intel|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| where !isBlank(remoteIP)<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=remoteIP<br />\| where malicious\_confidence matches "{{malicious\_confidence}}"<br />\| where !isNull(malicious\_confidence)<br />\| lookup latitude, longitude, country\_code, country\_name, city from geo://location on ip = remoteIP<br />\| count by remoteIP, country\_coude, country\_name, city, type, actor, malicious\_confidence, bucket, operation, requester, status\_code, user\_agent, latitude, longitude<br />\| sort by \_count |
|Amazon S3 Audit|Threat Table|Logs|Amazon S3 Audit/Amazon S3 Audit - Threat Intel|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| count remoteIP, bucket, operation, requester, status\_code, user\_agent<br />\| where !isPrivateIP(remoteIP)<br /><br />\| threatlookup singleIndicator remoteIP<br /><br />// normalize confidence level to a string <br />\| if (\_threatlookup.confidence \>= 85, "high", if (\_threatlookup.confidence \>= 50, "medium", if (\_threatlookup.confidence \>= 15, "low", if (\_threatlookup.confidence \>= 0, "unverified", "unknown")))) as threat\_confidence<br /><br />\| where threat\_confidence matches "{{threat\_confidence}}"<br /><br />//rename to match threat\_\<foo\> convention<br />\| %"\_threatlookup.actors" as threat\_actors<br />\| %"\_threatlookup.type" as type<br />\| %"\_threatlookup.threat\_type" as threat\_type<br /><br />//convert threat valid from to human readable time<br />\| toLong(%"\_threatlookup.valid\_from" \* 1000) as %"\_threatlookup.valid\_from"<br />\| formatDate(%"\_threatlookup.valid\_from", "MM-dd-yyyy") as threat\_valid\_from<br /><br />\| where type matches "ipv4-addr\*" and !isNull(threat\_confidence)<br /><br />\| if (isEmpty(threat\_actors), "Unassigned", threat\_actors) as threat\_actors<br /><br />\| count by remoteIP, type, threat\_actors, threat\_confidence, threat\_type,threat\_valid\_from, bucket, operation, requester, status\_code, user\_agent<br />\| sort by \_count|
|Amazon S3 Audit|Threat Table|Logs|Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Threat Intel|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| count remoteIP, bucket, operation, requester, status\_code, user\_agent<br />\| where !isPrivateIP(remoteIP)<br />\| lookup type, actor, raw, threatlevel as malicious\_confidence from sumo://threat/cs on threat=remoteIP <br />\| where malicious\_confidence matches "{{malicious\_confidence}}"<br />\| where !isNull(malicious\_confidence)<br />\| json field=raw "labels[\*].name" as label\_name<br />\| replace(label\_name, "\\\\/","-\>") as label\_name<br />\| replace(label\_name, "\\""," ") as label\_name<br />\| where  type="ip\_address" and !isNull(malicious\_confidence)<br />\| if (isEmpty(actor), "Unassigned", actor) as Actor<br />\| count by remoteIP, type, actor, malicious\_confidence, label\_name, bucket, operation, requester, status\_code, user\_agent<br />\| sort by \_count|
|Amazon S3 Audit|Total 4xx/5xx Status Codes by S3 Bucket|Logs|Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Details|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where (status\_code matches "4\*") or (status\_code matches "5\*") <br />\| where bucket matches "{{S3\_Bucket}}"<br />\| timeslice by 5m<br />\| if (status\_code matches "4\*",1,0) as status\_4xx<br />\| if (status\_code matches "5\*",1,0) as status\_5xx <br />\| sum(status\_4xx) as count\_4xx, sum(status\_5xx) as count\_5xx by \_timeslice, bucket<br />\| transpose row \_timeslice column bucket|
|Amazon S3 Audit|Total 4xx/5xx Status Codes by S3 Bucket|Logs|Amazon S3 Audit/Amazon S3 Audit - Details|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where (status\_code matches "4\*") or (status\_code matches "5\*") <br />\| where bucket matches "{{S3\_Bucket}}"<br />\| timeslice by 5m<br />\| if (status\_code matches "4\*",1,0) as status\_4xx<br />\| if (status\_code matches "5\*",1,0) as status\_5xx <br />\| sum(status\_4xx) as count\_4xx, sum(status\_5xx) as count\_5xx by \_timeslice, bucket<br />\| transpose row \_timeslice column bucket|
|Amazon S3 Audit|Total Requests by S3 Bucket|Logs|Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Details|\_sourceCategory={{S3ServerAccessLogsSource}}   \| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| timeslice 1m<br />\| count by \_timeslice, bucket<br />\| transpose row \_timeslice column bucket|
|Amazon S3 Audit|Total Requests by S3 Bucket|Logs|Amazon S3 Audit/Amazon S3 Audit - Overview|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| count by  bucket<br />\| sort by \_count|
|Amazon S3 Audit|Total Requests by S3 Bucket|Logs|Amazon S3 Audit/Amazon S3 Audit - Details|\_sourceCategory={{S3ServerAccessLogsSource}}   \| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| timeslice 1m<br />\| count by \_timeslice, bucket<br />\| transpose row \_timeslice column bucket|
|Amazon S3 Audit|Total Requests by S3 Bucket|Logs|Installed Apps/Amazon S3 Audit/Amazon S3 Audit - Overview|\_sourceCategory={{S3ServerAccessLogsSource}}   <br />\| parse "\* \* [\*] \* \* \* \* \* \\"\* HTTP/1.1\\" \* \* \* \* \* \* \* \\"\*\\" \*" as bucket\_owner, bucket, time, remoteIP, requester, request\_ID, operation, key, request\_URI, status\_code, error\_code, bytes\_sent, object\_size, total\_time, turn\_time, referrer, user\_agent, version\_ID<br />\| where bucket matches "{{S3\_Bucket}}"<br />\| count by  bucket<br />\| sort by \_count|

