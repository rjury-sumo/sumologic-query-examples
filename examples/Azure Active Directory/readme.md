# Azure Active Directory
## Sumo Logic App For: Azure Active Directory
Azure Active Directory is a cloud-based directory, and identity management service that allows for directory services, application access management and identity protection. The Sumo Logic app for Azure helps you monitor activity in the Azure Active Directory. The dashboards provide insight into role management, user management, group management, successful & failure sign in events, directory management, application management data that helps you understand your usersâ€™ experience.
Docs Link: [Azure Active Directory](https://help.sumologic.com/?cid=4410)

## Searches

### Log Searches

- **Add User**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - User Management 
- **Added/Removed User from Role**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Role Management  
- **Anomaly in Total Login Count**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Successful Sign-In Events 
- **Anomaly in Total Login Count**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events  
- **Application Management Events - Outlier**: from Dashboard: Azure Active Directory/Azure Active Directory - Application Management - New 
- **Applications Added or Updated**: from Dashboard: Azure Active Directory/Azure Active Directory - Application Management - New 
- **Audit Event Category  - One Day Time Comparison**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Overview  
- **Audit Event Category  - One Day Time Comparison**: from Dashboard: Azure Active Directory/Azure Active Directory - Overview - New 
- **Audit Event Category  Breakdown**: from Dashboard: Azure Active Directory/Azure Active Directory - Overview - New 
- **Audit Event Category  Breakdown**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Overview  
- **Break Down by Browser**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events  
- **Break Down by Browser**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Successful Sign-In Events 
- **Breakdown by Country,  State, City**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Successful Sign-In Events 
- **Breakdown by OS**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events  
- **Breakdown by OS**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Successful Sign-In Events 
- **Breakdown by Results**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Group Management 
- **Breakdown by Results**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - User Management 
- **Breakdown by Results**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Directory Management  
- **Breakdown by Results**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Authorization/Authentication/Other 
- **Breakdown by Results**: from Dashboard: Azure Active Directory/Azure Active Directory - Application Management - New 
- **Breakdown by Results**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Application Management 
- **Breakdown by Results**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Role Management  
- **Category Breakdown**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Overview  
- **Category Breakdown**: from Dashboard: Azure Active Directory/Azure Active Directory - Overview - New 
- **Consent Given to Application**: from Dashboard: Azure Active Directory/Azure Active Directory - Application Management - New 
- **Deleted Applications**: from Dashboard: Azure Active Directory/Azure Active Directory - Application Management - New 
- **Deleted User**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - User Management 
- **Disable Desktop SSO**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Directory Management  
- **Failed Events**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Group Management 
- **Failed Events**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Directory Management  
- **Failed Events**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Application Management 
- **Failed Events**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Role Management  
- **Failed Events**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Authorization/Authentication/Other 
- **Failed Events**: from Dashboard: Azure Active Directory/Azure Active Directory - Application Management - New 
- **Failed Events**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - User Management 
- **Failure Sign In Table**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events  
- **Geo Location of Events**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Overview  
- **Geo Location of Events**: from Dashboard: Azure Active Directory/Azure Active Directory - Overview - New 
- **Geo Location of Sign-in**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Successful Sign-In Events 
- **Geo Location of Sign-in**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events  
- **Groups Added**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Group Management 
- **Invite External User**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - User Management 
- **Log Level  Breakdown**: from Dashboard: Azure Active Directory/Azure Active Directory - Overview - New 
- **Log Level  Breakdown**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Overview  
- **Members Added/Removed**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Group Management 
- **Operation Name**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Application Management 
- **Operation Name**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Role Management  
- **Operation Name**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - User Management 
- **Operation Name**: from Dashboard: Azure Active Directory/Azure Active Directory - Application Management - New 
- **Operation Name**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Directory Management  
- **Operation Name**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Overview  
- **Operation Name**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Authorization/Authentication/Other 
- **Operation Name**: from Dashboard: Azure Active Directory/Azure Active Directory - Overview - New 
- **Operation Name**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Group Management 
- **Operation Name - One Day Time Comparison**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Role Management  
- **Operation Name - One Day Time Comparison**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Overview  
- **Operation Name - One Day Time Comparison**: from Dashboard: Azure Active Directory/Azure Active Directory - Overview - New 
- **Operation Name - One Day Time Comparison**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Group Management 
- **Operation Name - One Day Time Comparison**: from Dashboard: Azure Active Directory/Azure Active Directory - Application Management - New 
- **Operation Name - One Day Time Comparison**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Directory Management  
- **Operation Name - One Day Time Comparison**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - User Management 
- **Operation Name - One Day Time Comparison**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Authorization/Authentication/Other 
- **Operation Name - One Day Time Comparison**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Application Management 
- **Operation Name Over Time**: from Dashboard: Azure Active Directory/Azure Active Directory - Application Management - New 
- **Operation Name Over Time**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Role Management  
- **Operation Name Over Time**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - User Management 
- **Operation Name Over Time**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Directory Management  
- **Operation Name Over Time**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Application Management 
- **Operation Name Over Time**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Authorization/Authentication/Other 
- **Operations Over Time**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Group Management 
- **ResultType Breakdown**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Overview  
- **ResultType Breakdown**: from Dashboard: Azure Active Directory/Azure Active Directory - Overview - New 
- **Risky Sign In**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Successful Sign-In Events 
- **Risky Sign In**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events  
- **Role Updates**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Role Management  
- **Service Principal Updates**: from Dashboard: Azure Active Directory/Azure Active Directory - Application Management - New 
- **Sign in by Application**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Successful Sign-In Events 
- **Sign in by Application**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events  
- **Sign In by User Over Time**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Successful Sign-In Events 
- **Sign In by User Over Time**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events  
- **Sign-In by User - One Day Time Comparison**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events  
- **Sign-In by User - One Day Time Comparison**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Successful Sign-In Events 
- **Sign-Ins Breakdown by Country,  State, City**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events  
- **Successful Events**: from Dashboard: Azure Active Directory/Azure Active Directory - Application Management - New 
- **Successful Events**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Authorization/Authentication/Other 
- **Successful Events**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - User Management 
- **Successful Events**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Group Management 
- **Successful Events**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Role Management  
- **Successful Events**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Application Management 
- **Successful Events**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Directory Management  
- **Summary Table**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Application Management 
- **Top 10 Active Users**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Successful Sign-In Events 
- **Top 10 Active Users**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events  
- **Updated User**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - User Management 
- **User Management Events - Outlier**: from Dashboard: Installed Apps/Azure Active Directory/Azure Active Directory - User Management

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Azure Active Directory|Add User|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - User Management|\_sourceCategory={{Logsdatasource}}  "UserManagement"<br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| where operation\_name matches /(?i)add user.\*/<br />\| count as frequency by operation\_name, level, logged\_by\_service, operation\_type, app\_name, result\_type, result\_reason, identity, updated\_properties<br />\| sort by frequency|
|Azure Active Directory|Added/Removed User from Role|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Role Management |\_sourceCategory={{Logsdatasource}}  "RoleManagement"<br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| where operation\_name matches /(?i)(add\|remove).\*/<br />\| count as frequency by operation\_name, level, logged\_by\_service, operation\_type, app\_name, result\_type, result\_reason, identity, updated\_properties<br />\| sort by frequency|
|Azure Active Directory|Anomaly in Total Login Count|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Successful Sign-In Events|\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity" <br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type = "0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| timeslice 1h<br />\| count by \_timeslice<br />\| outlier \_count window=6, direction=+<br />\| where \_count\_std \> 0<br />\| if(\_count\_violation=1,abs(\_count\_error)/\_count\_std, 0) as deviation<br />\| if(deviation \>= {{deviation}}, 1, 0) as anomaly<br />\| fields \_timeslice, anomaly|
|Azure Active Directory|Anomaly in Total Login Count|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events |\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity" <br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type !="0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| timeslice 1h<br />\| count by \_timeslice<br />\| outlier \_count window=6, direction=+<br />\| where \_count\_std \> 0<br />\| if(\_count\_violation=1,abs(\_count\_error)/\_count\_std, 0) as deviation<br />\| if(deviation \>= {{deviation}}, 1, 0) as anomaly<br />\| fields \_timeslice, anomaly|
|Azure Active Directory|Application Management Events - Outlier|Logs|Azure Active Directory/Azure Active Directory - Application Management - New|\_sourceCategory = Labs/Azure/AD "ApplicationManagement" <br />\| json field=\_raw "operationName" as operationName nodrop<br />\| json field=\_raw "time" nodrop<br />\| json field=\_raw "category" as category  nodrop<br />\| json field=\_raw "Level" as level nodrop<br />\| json field=\_raw "callerIpAddress" as ip\_addr nodrop<br />\| json field=\_raw "resultType" as resultType nodrop<br />\| json field=\_raw "properties.auditEventCategory" as auditEventCategory nodrop<br />\| json field=\_raw "properties.targetResourceName" as targetResourceName nodrop<br />\| json field=\_raw "properties.targetResourceType" as targetResourceType nodrop<br />\| json field=\_raw "tenantId" as tenantId nodrop<br />\| json field=\_raw "correlationId" as correlationId nodrop<br />\| json field=\_raw "identity" as identity nodrop<br />\| json field=\_raw "properties.additionalTargets" as additionalTargets  nodrop<br />\| json field=\_raw "resultDescription" as resultDescription nodrop<br />\| json field=\_raw "properties.targetUpdatedProperties" as updated\_properties nodrop<br />\| timeslice 1h<br />\|where if ("{{resulttype}}" = "\*", true, resulttype matches "{{resulttype}}") AND if ("{{identity}}" = "\*", true, identity matches "{{identity}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{auditeventcategory}}" = "\*", true, auditeventcategory matches "{{auditeventcategory}}") AND if ("{{targetresourcename}}" = "\*", true, targetresourcename matches "{{targetresourcename}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{tenantid}}" = "\*", true, tenantid matches "{{tenantid}}") AND if ("{{resultdescription}}" = "\*", true, resultdescription matches "{{resultdescription}}")<br />\|count(operationName) by  \_timeslice <br />\| fillmissing timeslice(1h)<br />\| outlier \_count|
|Azure Active Directory|Applications Added or Updated|Logs|Azure Active Directory/Azure Active Directory - Application Management - New|\_sourceCategory = Labs/Azure/AD "ApplicationManagement" ("Add application" or "Update application")<br />\| json field=\_raw "operationName" as operationName nodrop<br />\| json field=\_raw "time" nodrop<br />\| json field=\_raw "category" as category  nodrop<br />\| json field=\_raw "Level" as level nodrop<br />\| json field=\_raw "callerIpAddress" as ip\_addr nodrop<br />\| json field=\_raw "resultType" as resultType nodrop<br />\| json field=\_raw "properties.auditEventCategory" as auditEventCategory nodrop<br />\| json field=\_raw "properties.targetResourceName" as targetResourceName nodrop<br />\| json field=\_raw "properties.targetResourceType" as targetResourceType nodrop<br />\| json field=\_raw "tenantId" as tenantId nodrop<br />\| json field=\_raw "correlationId" as correlationId nodrop<br />\| json field=\_raw "identity" as identity nodrop<br />\| json field=\_raw "properties.additionalTargets" as additionalTargets  nodrop<br />\| json field=\_raw "resultDescription" as resultDescription nodrop<br />\| json field=\_raw "properties.targetUpdatedProperties" as updated\_properties nodrop<br />\|where if ("{{resulttype}}" = "\*", true, resulttype matches "{{resulttype}}") AND if ("{{identity}}" = "\*", true, identity matches "{{identity}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{auditeventcategory}}" = "\*", true, auditeventcategory matches "{{auditeventcategory}}") AND if ("{{targetresourcename}}" = "\*", true, targetresourcename matches "{{targetresourcename}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{tenantid}}" = "\*", true, tenantid matches "{{tenantid}}") AND if ("{{resultdescription}}" = "\*", true, resultdescription matches "{{resultdescription}}")<br />\|count by operationName, resultType, resultDescription, identity,targetResourceName<br />\| sort by \_count asc|
|Azure Active Directory|Audit Event Category  - One Day Time Comparison|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Overview |\_sourceCategory={{Logsdatasource}} <br />\| json "operationName", "properties.category", "category", "Level", "properties.result", "properties.resultReason", "callerIpAddress" as operation\_name, audit\_event\_category ,activity\_type, level, result\_type, result\_reason, ip\_addr nodrop<br />\| if (activity\_type matches "SignInLogs", "Sign-In Event", audit\_event\_category) as audit\_event\_category<br />\| json "resultType" as sign\_in\_result\_type nodrop<br />\| if (isNull(result\_type), sign\_in\_result\_type, result\_type) as result\_type<br />\| where audit\_event\_category matches "{{audit\_event\_category}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| count as frequency by audit\_event\_category<br />\| compare with timeshift 1d<br />\| sort by frequency |
|Azure Active Directory|Audit Event Category  - One Day Time Comparison|Logs|Azure Active Directory/Azure Active Directory - Overview - New|\_sourceCategory = Labs/Azure/AD<br />\| json field=\_raw "operationName" as operationName <br />\| json field=\_raw "time" nodrop<br />\| json field=\_raw "category" as category  nodrop<br />\| json field=\_raw "Level" as level nodrop<br />\| json field=\_raw "callerIpAddress" as ip\_addr nodrop<br />\| json field=\_raw "resultType" as resultType nodrop<br />\| json field=\_raw "properties.auditEventCategory" as auditEventCategory nodrop<br />\| if (category matches "SignIn", "Sign-In Event", auditEventCategory) as auditEventCategory<br />\| json field=\_raw "properties.targetResourceName" as targetResourceName nodrop<br />\| json field=\_raw "properties.targetResourceType" as targetResourceType nodrop<br />\| json field=\_raw "tenantId" as tenantId nodrop<br />\| json field=\_raw "correlationId" as correlationId nodrop<br />\| json field=\_raw "identity" as identity nodrop<br />\| json field=\_raw "properties.additionalTargets" as additionalTargets  nodrop<br />\| json field=\_raw "resultDescription" as resultDescription nodrop<br />\| json field=\_raw "properties.targetUpdatedProperties" as updated\_properties nodrop<br />\|where if ("{{resulttype}}" = "\*", true, resulttype matches "{{resulttype}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{auditeventcategory}}" = "\*", true, auditeventcategory matches "{{auditeventcategory}}") AND if ("{{targetresourcename}}" = "\*", true, targetresourcename matches "{{targetresourcename}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{tenantid}}" = "\*", true, tenantid matches "{{tenantid}}") AND if ("{{resultdescription}}" = "\*", true, resultdescription matches "{{resultdescription}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by auditEventCategory<br />\| sort by \_count \| compare with timeshift 1d|
|Azure Active Directory|Audit Event Category  Breakdown|Logs|Azure Active Directory/Azure Active Directory - Overview - New|\_sourceCategory = Labs/Azure/AD<br />\| json field=\_raw "operationName" as operationName <br />\| json field=\_raw "time" nodrop<br />\| json field=\_raw "category" as category  nodrop<br />\| json field=\_raw "Level" as level nodrop<br />\| json field=\_raw "callerIpAddress" as ip\_addr nodrop<br />\| json field=\_raw "resultType" as resultType nodrop<br />\| json field=\_raw "properties.auditEventCategory" as auditEventCategory nodrop<br />\| if (category matches "SignIn", "Sign-In Event", auditEventCategory) as auditEventCategory<br />\| json field=\_raw "properties.targetResourceName" as targetResourceName nodrop<br />\| json field=\_raw "properties.targetResourceType" as targetResourceType nodrop<br />\| json field=\_raw "tenantId" as tenantId nodrop<br />\| json field=\_raw "correlationId" as correlationId nodrop<br />\| json field=\_raw "identity" as identity nodrop<br />\| json field=\_raw "properties.additionalTargets" as additionalTargets  nodrop<br />\| json field=\_raw "resultDescription" as resultDescription nodrop<br />\| json field=\_raw "properties.targetUpdatedProperties" as updated\_properties nodrop<br />\|where if ("{{resulttype}}" = "\*", true, resulttype matches "{{resulttype}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{auditeventcategory}}" = "\*", true, auditeventcategory matches "{{auditeventcategory}}") AND if ("{{targetresourcename}}" = "\*", true, targetresourcename matches "{{targetresourcename}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{tenantid}}" = "\*", true, tenantid matches "{{tenantid}}") AND if ("{{resultdescription}}" = "\*", true, resultdescription matches "{{resultdescription}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by auditEventCategory<br />\| sort by \_count|
|Azure Active Directory|Audit Event Category  Breakdown|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Overview |\_sourceCategory={{Logsdatasource}} <br />\| json "operationName", "properties.category", "category", "Level", "properties.result", "properties.resultReason", "callerIpAddress" as operation\_name, audit\_event\_category ,activity\_type, level, result\_type, result\_reason, ip\_addr nodrop<br />\| if (activity\_type matches "SignInLogs", "Sign-In Event", audit\_event\_category) as audit\_event\_category<br />\| json "resultType" as sign\_in\_result\_type nodrop<br />\| if (isNull(result\_type), sign\_in\_result\_type, result\_type) as result\_type<br />\| where audit\_event\_category matches "{{audit\_event\_category}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| count as frequency by audit\_event\_category<br />\| sort by frequency|
|Azure Active Directory|Break Down by Browser|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events |\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity" <br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type !="0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| count as frequency by browser<br />\| sort by frequency|
|Azure Active Directory|Break Down by Browser|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Successful Sign-In Events|\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity" <br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type = "0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| count as frequency by browser<br />\| sort by frequency|
|Azure Active Directory|Breakdown by Country,  State, City|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Successful Sign-In Events|\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity" <br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type = "0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| count as frequency by country\_or\_region, state, city  <br />\| sort by frequency|
|Azure Active Directory|Breakdown by OS|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events |\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity" <br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type !="0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| count as frequency by operating\_system<br />\| sort by frequency|
|Azure Active Directory|Breakdown by OS|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Successful Sign-In Events|\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity" <br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type = "0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| count as frequency by operating\_system<br />\| sort by frequency|
|Azure Active Directory|Breakdown by Results|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Group Management|\_sourceCategory={{Logsdatasource}}  "GroupManagement" <br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where result\_type matches "{{result\_type}}" AND operation\_name matches "{{operation\_name}}" AND identity matches "{{identity}}"<br />\| count by result\_type<br />\| sort by result\_type|
|Azure Active Directory|Breakdown by Results|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - User Management|\_sourceCategory={{Logsdatasource}}  "UserManagement"<br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| count as frequency by result\_type<br />\| sort by frequency|
|Azure Active Directory|Breakdown by Results|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Directory Management |\_sourceCategory={{Logsdatasource}}  "DirectoryManagement" <br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}" AND correlation\_id matches "{{correlation\_id}}" AND identity matches "{{identity}}"<br />\| count as frequency by result\_type<br />\| sort by frequency|
|Azure Active Directory/Azure Active Directory - Authorization/Authentication|Breakdown by Results|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Authorization/Authentication/Other|\_sourceCategory={{Logsdatasource}}  (Authorization or Authentication or Other or Resource or PolicyManagement) <br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where audit\_event\_category in ("Authorization","Authentication", "Other")<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND identity matches "{{identity}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}" AND correlation\_id matches "{{correlation\_id}}"<br />\| count as frequency by result\_type<br />\| sort by frequency|
|Azure Active Directory|Breakdown by Results|Logs|Azure Active Directory/Azure Active Directory - Application Management - New|\_sourceCategory = Labs/Azure/AD "ApplicationManagement" <br />\| json field=\_raw "operationName" as operationName nodrop<br />\| json field=\_raw "time" nodrop<br />\| json field=\_raw "category" as category  nodrop<br />\| json field=\_raw "Level" as level nodrop<br />\| json field=\_raw "callerIpAddress" as ip\_addr nodrop<br />\| json field=\_raw "resultType" as resultType nodrop<br />\| json field=\_raw "properties.auditEventCategory" as auditEventCategory nodrop<br />\| json field=\_raw "properties.targetResourceName" as targetResourceName nodrop<br />\| json field=\_raw "properties.targetResourceType" as targetResourceType nodrop<br />\| json field=\_raw "tenantId" as tenantId nodrop<br />\| json field=\_raw "correlationId" as correlationId nodrop<br />\| json field=\_raw "identity" as identity nodrop<br />\| json field=\_raw "properties.additionalTargets" as additionalTargets  nodrop<br />\| json field=\_raw "resultDescription" as resultDescription nodrop<br />\| json field=\_raw "properties.targetUpdatedProperties" as updated\_properties nodrop<br />\|where if ("{{resulttype}}" = "\*", true, resulttype matches "{{resulttype}}") AND if ("{{identity}}" = "\*", true, identity matches "{{identity}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{auditeventcategory}}" = "\*", true, auditeventcategory matches "{{auditeventcategory}}") AND if ("{{targetresourcename}}" = "\*", true, targetresourcename matches "{{targetresourcename}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{tenantid}}" = "\*", true, tenantid matches "{{tenantid}}") AND if ("{{resultdescription}}" = "\*", true, resultdescription matches "{{resultdescription}}")<br />\|count by  resultType|
|Azure Active Directory|Breakdown by Results|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Application Management|\_sourceCategory={{Logsdatasource}}  "ApplicationManagement" <br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND identity matches "{{identity}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| count as frequency by result\_type<br />\| sort by frequency|
|Azure Active Directory|Breakdown by Results|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Role Management |\_sourceCategory={{Logsdatasource}}  "RoleManagement"<br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| count as frequency by result\_type<br />\| sort by frequency|
|Azure Active Directory|Category Breakdown|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Overview |\_sourceCategory={{Logsdatasource}} <br />\| json "operationName", "properties.category", "category", "Level", "properties.result", "properties.resultReason", "callerIpAddress" as operation\_name, audit\_event\_category ,activity\_type, level, result\_type, result\_reason, ip\_addr nodrop<br />\| if (activity\_type matches "SignInLogs", "Sign-In Event", audit\_event\_category) as audit\_event\_category<br />\| json "resultType" as sign\_in\_result\_type nodrop<br />\| if (isNull(result\_type), sign\_in\_result\_type, result\_type) as result\_type<br />\| where audit\_event\_category matches "{{audit\_event\_category}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| count as frequency by activity\_type<br />\| sort by frequency|
|Azure Active Directory|Category Breakdown|Logs|Azure Active Directory/Azure Active Directory - Overview - New|\_sourceCategory = Labs/Azure/AD<br />\| json field=\_raw "operationName" as operationName <br />\| json field=\_raw "time" nodrop<br />\| json field=\_raw "category" as category  nodrop<br />\| json field=\_raw "Level" as level nodrop<br />\| json field=\_raw "callerIpAddress" as ip\_addr nodrop<br />\| json field=\_raw "resultType" as resultType nodrop<br />\| json field=\_raw "properties.auditEventCategory" as auditEventCategory nodrop<br />\| json field=\_raw "properties.targetResourceName" as targetResourceName nodrop<br />\| json field=\_raw "properties.targetResourceType" as targetResourceType nodrop<br />\| json field=\_raw "tenantId" as tenantId nodrop<br />\| json field=\_raw "correlationId" as correlationId nodrop<br />\| json field=\_raw "identity" as identity nodrop<br />\| json field=\_raw "properties.additionalTargets" as additionalTargets  nodrop<br />\| json field=\_raw "resultDescription" as resultDescription nodrop<br />\| json field=\_raw "properties.targetUpdatedProperties" as updated\_properties nodrop<br />\|where if ("{{resulttype}}" = "\*", true, resulttype matches "{{resulttype}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{auditeventcategory}}" = "\*", true, auditeventcategory matches "{{auditeventcategory}}") AND if ("{{targetresourcename}}" = "\*", true, targetresourcename matches "{{targetresourcename}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{tenantid}}" = "\*", true, tenantid matches "{{tenantid}}") AND if ("{{resultdescription}}" = "\*", true, resultdescription matches "{{resultdescription}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by category|
|Azure Active Directory|Consent Given to Application|Logs|Azure Active Directory/Azure Active Directory - Application Management - New|\_sourceCategory = Labs/Azure/AD "ApplicationManagement" ("Consent to application")<br />\| json field=\_raw "operationName" as operationName nodrop<br />\| json field=\_raw "time" nodrop<br />\| json field=\_raw "category" as category  nodrop<br />\| json field=\_raw "Level" as level nodrop<br />\| json field=\_raw "callerIpAddress" as ip\_addr nodrop<br />\| json field=\_raw "resultType" as resultType nodrop<br />\| json field=\_raw "properties.auditEventCategory" as auditEventCategory nodrop<br />\| json field=\_raw "properties.targetResourceName" as targetResourceName nodrop<br />\| json field=\_raw "properties.targetResourceType" as targetResourceType nodrop<br />\| json field=\_raw "tenantId" as tenantId nodrop<br />\| json field=\_raw "correlationId" as correlationId nodrop<br />\| json field=\_raw "identity" as identity nodrop<br />\| json field=\_raw "properties.additionalTargets" as additionalTargets  nodrop<br />\| json field=\_raw "resultDescription" as resultDescription nodrop<br />\| json field=\_raw "properties.targetUpdatedProperties" as updated\_properties nodrop<br />\|where if ("{{resulttype}}" = "\*", true, resulttype matches "{{resulttype}}") AND if ("{{identity}}" = "\*", true, identity matches "{{identity}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{auditeventcategory}}" = "\*", true, auditeventcategory matches "{{auditeventcategory}}") AND if ("{{targetresourcename}}" = "\*", true, targetresourcename matches "{{targetresourcename}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{tenantid}}" = "\*", true, tenantid matches "{{tenantid}}") AND if ("{{resultdescription}}" = "\*", true, resultdescription matches "{{resultdescription}}")<br />\|count by operationName, resultType, resultDescription, identity,targetResourceName<br />\| sort by \_count asc|
|Azure Active Directory|Deleted Applications|Logs|Azure Active Directory/Azure Active Directory - Application Management - New|\_sourceCategory = Labs/Azure/AD "ApplicationManagement" ("Delete application")<br />\| json field=\_raw "operationName" as operationName nodrop<br />\| json field=\_raw "time" nodrop<br />\| json field=\_raw "category" as category  nodrop<br />\| json field=\_raw "Level" as level nodrop<br />\| json field=\_raw "callerIpAddress" as ip\_addr nodrop<br />\| json field=\_raw "resultType" as resultType nodrop<br />\| json field=\_raw "properties.auditEventCategory" as auditEventCategory nodrop<br />\| json field=\_raw "properties.targetResourceName" as targetResourceName nodrop<br />\| json field=\_raw "properties.targetResourceType" as targetResourceType nodrop<br />\| json field=\_raw "tenantId" as tenantId nodrop<br />\| json field=\_raw "correlationId" as correlationId nodrop<br />\| json field=\_raw "identity" as identity nodrop<br />\| json field=\_raw "properties.additionalTargets" as additionalTargets  nodrop<br />\| json field=\_raw "resultDescription" as resultDescription nodrop<br />\| json field=\_raw "properties.targetUpdatedProperties" as updated\_properties nodrop<br />\|where if ("{{resulttype}}" = "\*", true, resulttype matches "{{resulttype}}") AND if ("{{identity}}" = "\*", true, identity matches "{{identity}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{auditeventcategory}}" = "\*", true, auditeventcategory matches "{{auditeventcategory}}") AND if ("{{targetresourcename}}" = "\*", true, targetresourcename matches "{{targetresourcename}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{tenantid}}" = "\*", true, tenantid matches "{{tenantid}}") AND if ("{{resultdescription}}" = "\*", true, resultdescription matches "{{resultdescription}}")<br />\|count by operationName, resultType, resultDescription, identity,targetResourceName<br />\| sort by \_count asc|
|Azure Active Directory|Deleted User|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - User Management|\_sourceCategory={{Logsdatasource}}  "UserManagement" "Delete user"<br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| where operation\_name matches /(?i)Delete user\*/<br />\| count as frequency by operation\_name, level, logged\_by\_service, operation\_type, app\_name, result\_type, result\_reason, identity, updated\_properties<br />\| sort by frequency|
|Azure Active Directory|Disable Desktop SSO|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Directory Management |\_sourceCategory={{Logsdatasource}}  "DirectoryManagement" "Disable Desktop Sso"<br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}" AND correlation\_id matches "{{correlation\_id}}" AND identity matches "{{identity}}"<br />\| count as frequency by operation\_name, result\_type, result\_reason, logged\_by\_service,target\_resource\_name<br />\| sort by frequency|
|Azure Active Directory|Failed Events|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Group Management|\_sourceCategory={{Logsdatasource}}  "GroupManagement"<br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where result\_type matches "{{result\_type}}" AND operation\_name matches "{{operation\_name}}" AND identity matches "{{identity}}"<br />\| where !(result\_type matches "\*success\*")<br />\| count as frequency by operation\_name, logged\_by\_service, level, result\_type, result\_reason, identity, operation\_type<br />\| sort by frequency|
|Azure Active Directory|Failed Events|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Directory Management |\_sourceCategory={{Logsdatasource}}  "DirectoryManagement"<br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}" AND correlation\_id matches "{{correlation\_id}}" AND identity matches "{{identity}}"<br />\| where !(result\_type matches "\*success\*")<br />\| count as frequency by operation\_name, result\_type, result\_reason, logged\_by\_service, target\_resource\_name<br />\| sort by frequency|
|Azure Active Directory|Failed Events|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Application Management|\_sourceCategory={{Logsdatasource}}  "ApplicationManagement"<br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND identity matches "{{identity}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| where !(result\_type matches "\*success\*")<br />\| count as frequency by activity\_type, operation\_name, logged\_by\_service, level, result\_type, result\_reason, identity<br />\| sort by frequency|
|Azure Active Directory|Failed Events|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Role Management |\_sourceCategory={{Logsdatasource}}  "RoleManagement"<br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| where !(result\_type matches "\*success\*")<br />\| count as frequency by operation\_name, level, logged\_by\_service, operation\_type, app\_name, result\_type, result\_reason, identity<br />\| sort by frequency|
|Azure Active Directory/Azure Active Directory - Authorization/Authentication|Failed Events|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Authorization/Authentication/Other|\_sourceCategory={{Logsdatasource}}  (Authorization or Authentication or Other or Resource or PolicyManagement)<br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where audit\_event\_category in ("Authorization","Authentication", "Other")<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND identity matches "{{identity}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}" AND correlation\_id matches "{{correlation\_id}}"<br />\| where !(result\_type matches "\*success\*")<br />\| count as frequency by operation\_name, result\_type, result\_reason, identity, target\_resource\_name<br />\| sort by frequency|
|Azure Active Directory|Failed Events|Logs|Azure Active Directory/Azure Active Directory - Application Management - New|\_sourceCategory = Labs/Azure/AD "ApplicationManagement" (fail\* or Fail\* or error or Error or Excep\* or excep\*)<br />\| json field=\_raw "operationName" as operationName nodrop<br />\| json field=\_raw "time" nodrop<br />\| json field=\_raw "category" as category  nodrop<br />\| json field=\_raw "Level" as level nodrop<br />\| json field=\_raw "callerIpAddress" as ip\_addr nodrop<br />\| json field=\_raw "resultType" as resultType nodrop<br />\| json field=\_raw "properties.auditEventCategory" as auditEventCategory nodrop<br />\| json field=\_raw "properties.targetResourceName" as targetResourceName nodrop<br />\| json field=\_raw "properties.targetResourceType" as targetResourceType nodrop<br />\| json field=\_raw "tenantId" as tenantId nodrop<br />\| json field=\_raw "correlationId" as correlationId nodrop<br />\| json field=\_raw "identity" as identity nodrop<br />\| json field=\_raw "properties.additionalTargets" as additionalTargets  nodrop<br />\| json field=\_raw "resultDescription" as resultDescription nodrop<br />\| json field=\_raw "properties.targetUpdatedProperties" as updated\_properties nodrop<br />\|where if ("{{resulttype}}" = "\*", true, resulttype matches "{{resulttype}}") AND if ("{{identity}}" = "\*", true, identity matches "{{identity}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{auditeventcategory}}" = "\*", true, auditeventcategory matches "{{auditeventcategory}}") AND if ("{{targetresourcename}}" = "\*", true, targetresourcename matches "{{targetresourcename}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{tenantid}}" = "\*", true, tenantid matches "{{tenantid}}") AND if ("{{resultdescription}}" = "\*", true, resultdescription matches "{{resultdescription}}")<br />\|count by operationName, resultType, resultDescription, identity<br />\| sort by \_count|
|Azure Active Directory|Failed Events|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - User Management|\_sourceCategory={{Logsdatasource}}  "UserManagement"<br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| where !(result\_type matches "\*success\*")<br />\| count as frequency by operation\_name, level, logged\_by\_service, operation\_type, app\_name, result\_type, result\_reason, identity, updated\_properties<br />\| sort by frequency|
|Azure Active Directory|Failure Sign In Table|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events |\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity"  "resultType" "errorCode"<br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type !="0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| lookup description as error\_description from https://sumologic-app-data.s3.amazonaws.com/ad\_sign.csv on errorcode = error\_code<br />\| count as frequency by date\_time,identity, error\_code, error\_description, ip\_addr, country\_or\_region, state, city, app\_display\_name<br />\| sort by frequency|
|Azure Active Directory|Geo Location of Events|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Overview |\_sourceCategory={{Logsdatasource}} <br />\| json "operationName", "properties.category", "category", "Level", "properties.result", "properties.resultReason", "callerIpAddress" as operation\_name, audit\_event\_category ,activity\_type, level, result\_type, result\_reason, ip\_addr nodrop<br />\| if (activity\_type matches "SignInLogs", "Sign-In Event", audit\_event\_category) as audit\_event\_category<br />\| json "resultType" as sign\_in\_result\_type nodrop<br />\| if (isNull(result\_type), sign\_in\_result\_type, result\_type) as result\_type<br />\| where audit\_event\_category matches "{{audit\_event\_category}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| where !isEmpty(ip\_addr)<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = ip\_addr<br />\| count as frequency by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort by frequency|
|Azure Active Directory|Geo Location of Events|Logs|Azure Active Directory/Azure Active Directory - Overview - New|\_sourceCategory = Labs/Azure/AD<br />\| json field=\_raw "operationName" as operationName <br />\| json field=\_raw "category" as category<br />\| json field=\_raw "Level" as level<br />\| json field=\_raw "callerIpAddress" as ip\_addr<br />\|where if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by ip\_addr<br />\| where  ip\_addr !="\<null\>"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = ip\_addr<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|Azure Active Directory|Geo Location of Sign-in|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Successful Sign-In Events|\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity" <br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type = "0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = ip\_addr<br />\| count as frequency by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort by frequency|
|Azure Active Directory|Geo Location of Sign-in|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events |\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity"<br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type !="0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = ip\_addr<br />\| count as frequency by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort by frequency|
|Azure Active Directory|Groups Added|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Group Management|\_sourceCategory={{Logsdatasource}}  "GroupManagement"<br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where result\_type matches "{{result\_type}}" AND operation\_name matches "{{operation\_name}}" AND identity matches "{{identity}}"<br />\| where operation\_name matches /(?i)add group.\*/<br />\| count as frequency by operation\_name, logged\_by\_service, level, result\_type, result\_reason, identity, operation\_type, target\_resource\_name<br />\| sort by frequency|
|Azure Active Directory|Invite External User|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - User Management|\_sourceCategory={{Logsdatasource}}  "UserManagement" "Invite external user"<br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| where operation\_name matches /(?i)invite external user.\*/<br />\| count as frequency by operation\_name, level, logged\_by\_service, operation\_type, app\_name, result\_type, result\_reason, identity, updated\_properties<br />\| sort by frequency|
|Azure Active Directory|Log Level  Breakdown|Logs|Azure Active Directory/Azure Active Directory - Overview - New|\_sourceCategory = Labs/Azure/AD<br />\| json field=\_raw "operationName" as operationName <br />\| json field=\_raw "time" nodrop<br />\| json field=\_raw "category" as category  nodrop<br />\| json field=\_raw "Level" as level nodrop<br />\| json field=\_raw "callerIpAddress" as ip\_addr nodrop<br />\| json field=\_raw "resultType" as resultType nodrop<br />\| json field=\_raw "properties.auditEventCategory" as auditEventCategory nodrop<br />\| json field=\_raw "properties.targetResourceName" as targetResourceName nodrop<br />\| json field=\_raw "properties.targetResourceType" as targetResourceType nodrop<br />\| json field=\_raw "tenantId" as tenantId nodrop<br />\| json field=\_raw "correlationId" as correlationId nodrop<br />\| json field=\_raw "identity" as identity nodrop<br />\| json field=\_raw "properties.additionalTargets" as additionalTargets  nodrop<br />\| json field=\_raw "resultDescription" as resultDescription nodrop<br />\| json field=\_raw "properties.targetUpdatedProperties" as updated\_properties nodrop<br />\|where if ("{{resulttype}}" = "\*", true, resulttype matches "{{resulttype}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{auditeventcategory}}" = "\*", true, auditeventcategory matches "{{auditeventcategory}}") AND if ("{{targetresourcename}}" = "\*", true, targetresourcename matches "{{targetresourcename}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{tenantid}}" = "\*", true, tenantid matches "{{tenantid}}") AND if ("{{resultdescription}}" = "\*", true, resultdescription matches "{{resultdescription}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by level|
|Azure Active Directory|Log Level  Breakdown|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Overview |\_sourceCategory={{Logsdatasource}} <br />\| json "operationName", "properties.category", "category", "Level", "properties.result", "properties.resultReason", "callerIpAddress" as operation\_name, audit\_event\_category ,activity\_type, level, result\_type, result\_reason, ip\_addr nodrop<br />\| if (activity\_type matches "SignInLogs", "Sign-In Event", audit\_event\_category) as audit\_event\_category<br />\| json "resultType" as sign\_in\_result\_type nodrop<br />\| if (isNull(result\_type), sign\_in\_result\_type, result\_type) as result\_type<br />\| where audit\_event\_category matches "{{audit\_event\_category}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| count as frequency by level<br />\| sort by frequency|
|Azure Active Directory|Members Added/Removed|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Group Management|\_sourceCategory={{Logsdatasource}}  "GroupManagement"<br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where result\_type matches "{{result\_type}}" AND operation\_name matches "{{operation\_name}}" AND identity matches "{{identity}}"<br />\| where operation\_name matches /(?i)(add\|remove) member.\*/<br />\| count as frequency by operation\_name, logged\_by\_service, level, result\_type, result\_reason, identity, operation\_type, updated\_properties<br />\| sort by frequency|
|Azure Active Directory|Operation Name|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Application Management|\_sourceCategory={{Logsdatasource}}  "ApplicationManagement" <br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND identity matches "{{identity}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| count as frequency by operation\_name<br />\| sort by frequency|
|Azure Active Directory|Operation Name|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Role Management |\_sourceCategory={{Logsdatasource}}  "RoleManagement"<br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| count as frequency by operation\_name<br />\| sort by frequency|
|Azure Active Directory|Operation Name|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - User Management|\_sourceCategory={{Logsdatasource}}  "UserManagement"<br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| count as frequency by operation\_name<br />\| sort by frequency|
|Azure Active Directory|Operation Name|Logs|Azure Active Directory/Azure Active Directory - Application Management - New|\_sourceCategory = Labs/Azure/AD "ApplicationManagement"<br />\| json field=\_raw "operationName" as operationName nodrop<br />\| json field=\_raw "time" nodrop<br />\| json field=\_raw "category" as category  nodrop<br />\| json field=\_raw "Level" as level nodrop<br />\| json field=\_raw "callerIpAddress" as ip\_addr nodrop<br />\| json field=\_raw "resultType" as resultType nodrop<br />\| json field=\_raw "properties.auditEventCategory" as auditEventCategory nodrop<br />\| json field=\_raw "properties.targetResourceName" as targetResourceName nodrop<br />\| json field=\_raw "properties.targetResourceType" as targetResourceType nodrop<br />\| json field=\_raw "tenantId" as tenantId nodrop<br />\| json field=\_raw "correlationId" as correlationId nodrop<br />\| json field=\_raw "identity" as identity nodrop<br />\| json field=\_raw "properties.additionalTargets" as additionalTargets  nodrop<br />\| json field=\_raw "resultDescription" as resultDescription nodrop<br />\| json field=\_raw "properties.targetUpdatedProperties" as updated\_properties nodrop<br />\|where if ("{{resulttype}}" = "\*", true, resulttype matches "{{resulttype}}") AND if ("{{identity}}" = "\*", true, identity matches "{{identity}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{auditeventcategory}}" = "\*", true, auditeventcategory matches "{{auditeventcategory}}") AND if ("{{targetresourcename}}" = "\*", true, targetresourcename matches "{{targetresourcename}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{tenantid}}" = "\*", true, tenantid matches "{{tenantid}}") AND if ("{{resultdescription}}" = "\*", true, resultdescription matches "{{resultdescription}}")<br />\|count by operationName<br />\| sort by \_count|
|Azure Active Directory|Operation Name|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Directory Management |\_sourceCategory={{Logsdatasource}}  "DirectoryManagement" <br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}" AND correlation\_id matches "{{correlation\_id}}" AND identity matches "{{identity}}"<br />\| count as frequency by operation\_name<br />\| sort by frequency|
|Azure Active Directory|Operation Name|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Overview |\_sourceCategory={{Logsdatasource}} <br />\| json "operationName", "properties.category", "category", "Level", "properties.result", "properties.resultReason", "callerIpAddress" as operation\_name, audit\_event\_category ,activity\_type, level, result\_type, result\_reason, ip\_addr nodrop<br />\| if (activity\_type matches "SignInLogs", "Sign-In Event", audit\_event\_category) as audit\_event\_category<br />\| json "resultType" as sign\_in\_result\_type nodrop<br />\| if (isNull(result\_type), sign\_in\_result\_type, result\_type) as result\_type<br />\| where audit\_event\_category matches "{{audit\_event\_category}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| count as frequency by operation\_name<br />\| sort by frequency|
|Azure Active Directory/Azure Active Directory - Authorization/Authentication|Operation Name|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Authorization/Authentication/Other|\_sourceCategory={{Logsdatasource}}  (Authorization or Authentication or Other or Resource or PolicyManagement)<br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where audit\_event\_category in ("Authorization","Authentication", "Other")<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND identity matches "{{identity}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}" AND correlation\_id matches "{{correlation\_id}}"<br />\| count as frequency by operation\_name<br />\| sort by frequency|
|Azure Active Directory|Operation Name|Logs|Azure Active Directory/Azure Active Directory - Overview - New|\_sourceCategory = Labs/Azure/AD<br />\| json field=\_raw "operationName" as operationName <br />\| json field=\_raw "time" nodrop<br />\| json field=\_raw "category" as category  <br />\| json field=\_raw "Level" as level <br />\| json field=\_raw "callerIpAddress" as ip\_addr nodrop<br />\| json field=\_raw "resultType" as resultType nodrop<br />\| json field=\_raw "properties.auditEventCategory" as auditEventCategory nodrop<br />\| json field=\_raw "properties.targetResourceName" as targetResourceName nodrop<br />\| json field=\_raw "properties.targetResourceType" as targetResourceType nodrop<br />\| json field=\_raw "tenantId" as tenantId nodrop<br />\| json field=\_raw "correlationId" as correlationId nodrop<br />\| json field=\_raw "identity" as identity nodrop<br />\| json field=\_raw "properties.additionalTargets" as additionalTargets  nodrop<br />\| json field=\_raw "resultDescription" as resultDescription nodrop<br />\| json field=\_raw "properties.targetUpdatedProperties" as updated\_properties nodrop<br />\|where if ("{{resulttype}}" = "\*", true, resulttype matches "{{resulttype}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{auditeventcategory}}" = "\*", true, auditeventcategory matches "{{auditeventcategory}}") AND if ("{{targetresourcename}}" = "\*", true, targetresourcename matches "{{targetresourcename}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{tenantid}}" = "\*", true, tenantid matches "{{tenantid}}") AND if ("{{resultdescription}}" = "\*", true, resultdescription matches "{{resultdescription}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by operationName<br />\| sort by \_count|
|Azure Active Directory|Operation Name|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Group Management|\_sourceCategory={{Logsdatasource}}  "GroupManagement" <br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where result\_type matches "{{result\_type}}" AND operation\_name matches "{{operation\_name}}" AND identity matches "{{identity}}"<br />\| count as frequency by operation\_name<br />\| sort by frequency|
|Azure Active Directory|Operation Name - One Day Time Comparison|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Role Management |\_sourceCategory={{Logsdatasource}}  "RoleManagement"<br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| count as frequency by operation\_name<br />\| compare with timeshift 1d<br />\| sort by frequency|
|Azure Active Directory|Operation Name - One Day Time Comparison|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Overview |\_sourceCategory={{Logsdatasource}} <br />\| json "operationName", "properties.category", "category", "Level", "properties.result", "properties.resultReason", "callerIpAddress" as operation\_name, audit\_event\_category ,activity\_type, level, result\_type, result\_reason, ip\_addr nodrop<br />\| if (activity\_type matches "SignInLogs", "Sign-In Event", audit\_event\_category) as audit\_event\_category<br />\| json "resultType" as sign\_in\_result\_type nodrop<br />\| if (isNull(result\_type), sign\_in\_result\_type, result\_type) as result\_type<br />\| where audit\_event\_category matches "{{audit\_event\_category}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| count as frequency by operation\_name<br />\| compare with timeshift 1d<br />\| sort by frequency|
|Azure Active Directory|Operation Name - One Day Time Comparison|Logs|Azure Active Directory/Azure Active Directory - Overview - New|\_sourceCategory = Labs/Azure/AD<br />\| json field=\_raw "operationName" as operationName nodrop<br />\| json field=\_raw "time" nodrop<br />\| json field=\_raw "category" as category  nodrop<br />\| json field=\_raw "Level" as level nodrop<br />\| json field=\_raw "callerIpAddress" as ip\_addr nodrop<br />\| json field=\_raw "resultType" as resultType nodrop<br />\| json field=\_raw "properties.auditEventCategory" as auditEventCategory nodrop<br />\| json field=\_raw "properties.targetResourceName" as targetResourceName nodrop<br />\| json field=\_raw "properties.targetResourceType" as targetResourceType nodrop<br />\| json field=\_raw "tenantId" as tenantId nodrop<br />\| json field=\_raw "correlationId" as correlationId nodrop<br />\| json field=\_raw "identity" as identity nodrop<br />\| json field=\_raw "properties.additionalTargets" as additionalTargets  nodrop<br />\| json field=\_raw "resultDescription" as resultDescription nodrop<br />\| json field=\_raw "properties.targetUpdatedProperties" as updated\_properties nodrop<br />\|where if ("{{resulttype}}" = "\*", true, resulttype matches "{{resulttype}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{auditeventcategory}}" = "\*", true, auditeventcategory matches "{{auditeventcategory}}") AND if ("{{targetresourcename}}" = "\*", true, targetresourcename matches "{{targetresourcename}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{tenantid}}" = "\*", true, tenantid matches "{{tenantid}}") AND if ("{{resultdescription}}" = "\*", true, resultdescription matches "{{resultdescription}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by operationName<br />\| compare with timeshift 1d<br />\| sort by \_count|
|Azure Active Directory|Operation Name - One Day Time Comparison|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Group Management|\_sourceCategory={{Logsdatasource}}  "GroupManagement" <br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where result\_type matches "{{result\_type}}" AND operation\_name matches "{{operation\_name}}" AND identity matches "{{identity}}"<br />\| count as frequency by operation\_name<br />\| compare with timeshift 1d<br />\| sort by frequency|
|Azure Active Directory|Operation Name - One Day Time Comparison|Logs|Azure Active Directory/Azure Active Directory - Application Management - New|\_sourceCategory = Labs/Azure/AD "ApplicationManagement"<br />\| json field=\_raw "operationName" as operationName nodrop<br />\| json field=\_raw "time" nodrop<br />\| json field=\_raw "category" as category  nodrop<br />\| json field=\_raw "Level" as level nodrop<br />\| json field=\_raw "callerIpAddress" as ip\_addr nodrop<br />\| json field=\_raw "resultType" as resultType nodrop<br />\| json field=\_raw "properties.auditEventCategory" as auditEventCategory nodrop<br />\| json field=\_raw "properties.targetResourceName" as targetResourceName nodrop<br />\| json field=\_raw "properties.targetResourceType" as targetResourceType nodrop<br />\| json field=\_raw "tenantId" as tenantId nodrop<br />\| json field=\_raw "correlationId" as correlationId nodrop<br />\| json field=\_raw "identity" as identity nodrop<br />\| json field=\_raw "properties.additionalTargets" as additionalTargets  nodrop<br />\| json field=\_raw "resultDescription" as resultDescription nodrop<br />\| json field=\_raw "properties.targetUpdatedProperties" as updated\_properties nodrop<br />\|where if ("{{resulttype}}" = "\*", true, resulttype matches "{{resulttype}}") AND if ("{{identity}}" = "\*", true, identity matches "{{identity}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{auditeventcategory}}" = "\*", true, auditeventcategory matches "{{auditeventcategory}}") AND if ("{{targetresourcename}}" = "\*", true, targetresourcename matches "{{targetresourcename}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{tenantid}}" = "\*", true, tenantid matches "{{tenantid}}") AND if ("{{resultdescription}}" = "\*", true, resultdescription matches "{{resultdescription}}")<br />\|count by operationName<br />\| compare with timeshift 1d<br />\| sort by \_count|
|Azure Active Directory|Operation Name - One Day Time Comparison|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Directory Management |\_sourceCategory={{Logsdatasource}}  "DirectoryManagement" <br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}" AND correlation\_id matches "{{correlation\_id}}" AND identity matches "{{identity}}"<br />\| count as frequency by operation\_name<br />\| compare with timeshift 1d<br />\| sort by frequency|
|Azure Active Directory|Operation Name - One Day Time Comparison|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - User Management|\_sourceCategory={{Logsdatasource}}  "UserManagement"<br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| count as frequency by operation\_name<br />\| compare with timeshift 1d<br />\| sort by frequency|
|Azure Active Directory/Azure Active Directory - Authorization/Authentication|Operation Name - One Day Time Comparison|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Authorization/Authentication/Other|\_sourceCategory={{Logsdatasource}}  (Authorization or Authentication or Other or Resource or PolicyManagement)<br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where audit\_event\_category in ("Authorization","Authentication", "Other")<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND identity matches "{{identity}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}" AND correlation\_id matches "{{correlation\_id}}"<br />\| count as frequency by operation\_name<br />\| compare with timeshift 1d<br />\| sort by frequency|
|Azure Active Directory|Operation Name - One Day Time Comparison|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Application Management|\_sourceCategory={{Logsdatasource}}  "ApplicationManagement" <br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND identity matches "{{identity}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| count as frequency by operation\_name<br />\| compare with timeshift 1d<br />\| sort by frequency|
|Azure Active Directory|Operation Name Over Time|Logs|Azure Active Directory/Azure Active Directory - Application Management - New|\_sourceCategory = Labs/Azure/AD "ApplicationManagement"<br />\| json field=\_raw "operationName" as operationName nodrop<br />\| json field=\_raw "time" nodrop<br />\| json field=\_raw "category" as category  nodrop<br />\| json field=\_raw "Level" as level nodrop<br />\| json field=\_raw "callerIpAddress" as ip\_addr nodrop<br />\| json field=\_raw "resultType" as resultType nodrop<br />\| json field=\_raw "properties.auditEventCategory" as auditEventCategory nodrop<br />\| json field=\_raw "properties.targetResourceName" as targetResourceName nodrop<br />\| json field=\_raw "properties.targetResourceType" as targetResourceType nodrop<br />\| json field=\_raw "tenantId" as tenantId nodrop<br />\| json field=\_raw "correlationId" as correlationId nodrop<br />\| json field=\_raw "identity" as identity nodrop<br />\| json field=\_raw "properties.additionalTargets" as additionalTargets  nodrop<br />\| json field=\_raw "resultDescription" as resultDescription nodrop<br />\| json field=\_raw "properties.targetUpdatedProperties" as updated\_properties nodrop<br />\| timeslice 1h<br />\|where if ("{{resulttype}}" = "\*", true, resulttype matches "{{resulttype}}") AND if ("{{identity}}" = "\*", true, identity matches "{{identity}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{auditeventcategory}}" = "\*", true, auditeventcategory matches "{{auditeventcategory}}") AND if ("{{targetresourcename}}" = "\*", true, targetresourcename matches "{{targetresourcename}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{tenantid}}" = "\*", true, tenantid matches "{{tenantid}}") AND if ("{{resultdescription}}" = "\*", true, resultdescription matches "{{resultdescription}}")<br />\|count by \_timeslice, operationName<br />\| transpose row \_timeslice column operationname<br />\| fillmissing timeslice(1h)|
|Azure Active Directory|Operation Name Over Time|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Role Management |\_sourceCategory={{Logsdatasource}}  "RoleManagement"<br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| timeslice 1h<br />\| count by \_timeslice, operation\_name<br />\| fillmissing timeslice, values all in operation\_name<br />\| transpose row \_timeslice column operation\_name|
|Azure Active Directory|Operation Name Over Time|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - User Management|\_sourceCategory={{Logsdatasource}}  "UserManagement"<br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| timeslice 1h<br />\| count by \_timeslice, operation\_name<br />\| fillmissing timeslice, values all in operation\_name<br />\| transpose row \_timeslice column operation\_name|
|Azure Active Directory|Operation Name Over Time|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Directory Management |\_sourceCategory={{Logsdatasource}}  "DirectoryManagement" <br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}" AND correlation\_id matches "{{correlation\_id}}" AND identity matches "{{identity}}"<br />\| timeslice 1h<br />\| count by \_timeslice, operation\_name<br />\| fillmissing timeslice, values all in operation\_name<br />\| transpose row \_timeslice column operation\_name|
|Azure Active Directory|Operation Name Over Time|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Application Management|\_sourceCategory={{Logsdatasource}}  "ApplicationManagement" <br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND identity matches "{{identity}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| timeslice 1h<br />\| count by \_timeslice, operation\_name<br />\| fillmissing timeslice, values all in operation\_name<br />\| transpose row \_timeslice column operation\_name|
|Azure Active Directory/Azure Active Directory - Authorization/Authentication|Operation Name Over Time|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Authorization/Authentication/Other|\_sourceCategory={{Logsdatasource}}  (Authorization or Authentication or Other or Resource or PolicyManagement)<br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where audit\_event\_category in ("Authorization","Authentication", "Other")<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND identity matches "{{identity}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}" AND correlation\_id matches "{{correlation\_id}}"<br />\| timeslice 1h<br />\| count by \_timeslice, operation\_name<br />\| fillmissing timeslice, values all in operation\_name<br />\| transpose row \_timeslice column operation\_name|
|Azure Active Directory|Operations Over Time|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Group Management|\_sourceCategory={{Logsdatasource}}  "GroupManagement" <br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where result\_type matches "{{result\_type}}" AND operation\_name matches "{{operation\_name}}" AND identity matches "{{identity}}"<br />\| timeslice 1h<br />\| count by \_timeslice, operation\_name<br />\| fillmissing timeslice, values all in operation\_name<br />\| transpose row \_timeslice column operation\_name|
|Azure Active Directory|ResultType Breakdown|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Overview |\_sourceCategory={{Logsdatasource}} <br />\| json "operationName", "properties.category", "category", "Level", "properties.result", "properties.resultReason", "callerIpAddress" as operation\_name, audit\_event\_category ,activity\_type, level, result\_type, result\_reason, ip\_addr nodrop<br />\| if (activity\_type matches "SignInLogs", "Sign-In Event", audit\_event\_category) as audit\_event\_category<br />\| json "resultType" as sign\_in\_result\_type nodrop<br />\| if (isNull(result\_type), sign\_in\_result\_type, result\_type) as result\_type<br />\| if (result\_type matches "\*fail\*", "Failure Audit Operation", result\_type) as result\_type<br />\| if (result\_type matches "\*succ\*", "Success Audit Operation", result\_type) as result\_type <br />\| if (result\_type matches "0", "Success Sign In", result\_type) as result\_type <br />\| if (result\_type matches "20\*", "Failure Sign In", result\_type) as result\_type <br />\| if (result\_type matches "40\*", "Failure Sign In", result\_type) as result\_type <br />\| if (result\_type matches "5\*", "Failure Sign In", result\_type) as result\_type <br />\| if (result\_type matches "6\*", "Failure Sign In", result\_type) as result\_type <br />\| if (result\_type matches "7\*", "Failure Sign In", result\_type) as result\_type <br />\| if (result\_type matches "8\*", "Failure Sign In", result\_type) as result\_type <br />\| if (result\_type matches "9\*", "Failure Sign In", result\_type) as result\_type <br />\| if (result\_type matches "16000", "Failure Sign In", result\_type) as result\_type<br />\| where audit\_event\_category matches "{{audit\_event\_category}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| count as frequency by result\_type<br />\| sort by frequency|
|Azure Active Directory|ResultType Breakdown|Logs|Azure Active Directory/Azure Active Directory - Overview - New|\_sourceCategory = Labs/Azure/AD<br />\| json field=\_raw "operationName" as operationName <br />\| json field=\_raw "time" nodrop<br />\| json field=\_raw "category" as category  nodrop<br />\| json field=\_raw "Level" as level nodrop<br />\| json field=\_raw "callerIpAddress" as ip\_addr nodrop<br />\| json field=\_raw "resultType" as resultType nodrop<br />\| if (resultType matches "\*Fail\*", "Failure Audit Operation",  resultType) as resultType<br />\| if (resultType matches "\*Succ\*", "Success Audit Operation",  resultType) as resultType <br />\| if (resultType matches "0", "Success Sign In",  resultType) as resultType <br />\| if (resultType matches "20\*", "Failure Sign In",  resultType) as resultType <br />\| if (resultType matches "40\*", "Failure Sign In",  resultType) as resultType <br />\| if (resultType matches "5\*", "Failure Sign In",  resultType) as resultType <br />\| if (resultType matches "6\*", "Failure Sign In",  resultType) as resultType <br />\| if (resultType matches "7\*", "Failure Sign In",  resultType) as resultType <br />\| if (resultType matches "8\*", "Failure Sign In",  resultType) as resultType <br />\| json field=\_raw "properties.auditEventCategory" as auditEventCategory nodrop<br />\| json field=\_raw "properties.targetResourceName" as targetResourceName nodrop<br />\| json field=\_raw "properties.targetResourceType" as targetResourceType nodrop<br />\| json field=\_raw "tenantId" as tenantId nodrop<br />\| json field=\_raw "correlationId" as correlationId nodrop<br />\| json field=\_raw "identity" as identity nodrop<br />\| json field=\_raw "properties.additionalTargets" as additionalTargets  nodrop<br />\| json field=\_raw "resultDescription" as resultDescription nodrop<br />\| json field=\_raw "properties.targetUpdatedProperties" as updated\_properties nodrop<br />\|where if ("{{resulttype}}" = "\*", true, resulttype matches "{{resulttype}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{auditeventcategory}}" = "\*", true, auditeventcategory matches "{{auditeventcategory}}") AND if ("{{targetresourcename}}" = "\*", true, targetresourcename matches "{{targetresourcename}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{tenantid}}" = "\*", true, tenantid matches "{{tenantid}}") AND if ("{{resultdescription}}" = "\*", true, resultdescription matches "{{resultdescription}}") AND if ("{{category}}" = "\*", true, category matches "{{category}}")<br />\|count by resultType|
|Azure Active Directory|Risky Sign In|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Successful Sign-In Events|\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity" <br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type = "0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| where is\_risky matches "true"<br />\| count as frequency by date\_time, identity, tenant\_id, ip\_addr, country\_or\_region, state, city, browser, client\_app\_used, operating\_system<br />\| sort by frequency|
|Azure Active Directory|Risky Sign In|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events |\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity" <br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type !="0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| where is\_risky matches "true"<br />\| count as frequency by date\_time, identity, tenant\_id, ip\_addr, country\_or\_region, state, city, browser, client\_app\_used, operating\_system<br />\| sort by frequency|
|Azure Active Directory|Role Updates|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Role Management |\_sourceCategory={{Logsdatasource}}  "RoleManagement"<br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| where operation\_name matches "\*role\*"<br />\| count as frequency by operation\_name, level, logged\_by\_service, operation\_type, app\_name, result\_type, result\_reason, identity, updated\_properties<br />\| sort by frequency|
|Azure Active Directory|Service Principal Updates|Logs|Azure Active Directory/Azure Active Directory - Application Management - New|\_sourceCategory = Labs/Azure/AD "ApplicationManagement" ("service principal")<br />\| json field=\_raw "operationName" as operationName nodrop<br />\| json field=\_raw "time" nodrop<br />\| json field=\_raw "category" as category  nodrop<br />\| json field=\_raw "Level" as level nodrop<br />\| json field=\_raw "callerIpAddress" as ip\_addr nodrop<br />\| json field=\_raw "resultType" as resultType nodrop<br />\| json field=\_raw "properties.auditEventCategory" as auditEventCategory nodrop<br />\| json field=\_raw "properties.targetResourceName" as targetResourceName nodrop<br />\| json field=\_raw "properties.targetResourceType" as targetResourceType nodrop<br />\| json field=\_raw "tenantId" as tenantId nodrop<br />\| json field=\_raw "correlationId" as correlationId nodrop<br />\| json field=\_raw "identity" as identity nodrop<br />\| json field=\_raw "properties.additionalTargets" as additionalTargets  nodrop<br />\| json field=\_raw "resultDescription" as resultDescription nodrop<br />\| json field=\_raw "properties.targetUpdatedProperties" as updated\_properties nodrop<br />\|where if ("{{resulttype}}" = "\*", true, resulttype matches "{{resulttype}}") AND if ("{{identity}}" = "\*", true, identity matches "{{identity}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{auditeventcategory}}" = "\*", true, auditeventcategory matches "{{auditeventcategory}}") AND if ("{{targetresourcename}}" = "\*", true, targetresourcename matches "{{targetresourcename}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{tenantid}}" = "\*", true, tenantid matches "{{tenantid}}") AND if ("{{resultdescription}}" = "\*", true, resultdescription matches "{{resultdescription}}")<br />\|count by operationName, resultType, resultDescription, identity,targetResourceName<br />\| sort by \_count asc|
|Azure Active Directory|Sign in by Application|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Successful Sign-In Events|\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity" <br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type = "0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| count as frequency by app\_display\_name<br />\| sort by frequency|
|Azure Active Directory|Sign in by Application|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events |\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity" <br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type !="0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| count as frequency by app\_display\_name<br />\| sort by frequency|
|Azure Active Directory|Sign In by User Over Time|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Successful Sign-In Events|\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity" <br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type = "0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| timeslice 1h<br />\| count by \_timeslice, identity<br />\| fillmissing timeslice, values all in identity<br />\| transpose row \_timeslice column identity|
|Azure Active Directory|Sign In by User Over Time|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events |\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity" "errorCode" "resultType"<br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type !="0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| timeslice 1h<br />\| count by \_timeslice, identity<br />\| fillmissing timeslice, values all in identity<br />\| transpose row \_timeslice column identity|
|Azure Active Directory|Sign-In by User - One Day Time Comparison|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events |\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity"<br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type !="0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| count as frequency by identity<br />\| compare with timeshift 1d<br />\| sort by frequency|
|Azure Active Directory|Sign-In by User - One Day Time Comparison|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Successful Sign-In Events|\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity" <br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type = "0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| count as frequency by identity <br />\| compare with timeshift 1d<br />\| sort by frequency|
|Azure Active Directory|Sign-Ins Breakdown by Country,  State, City|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events |\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity" <br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type !="0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| count as frequency by country\_or\_region, state, city  <br />\| sort by frequency|
|Azure Active Directory|Successful Events|Logs|Azure Active Directory/Azure Active Directory - Application Management - New|\_sourceCategory = Labs/Azure/AD "ApplicationManagement" !(Failure)<br />\| json field=\_raw "operationName" as operationName nodrop<br />\| json field=\_raw "time" nodrop<br />\| json field=\_raw "category" as category  nodrop<br />\| json field=\_raw "Level" as level nodrop<br />\| json field=\_raw "callerIpAddress" as ip\_addr nodrop<br />\| json field=\_raw "resultType" as resultType nodrop<br />\| json field=\_raw "properties.auditEventCategory" as auditEventCategory nodrop<br />\| json field=\_raw "properties.targetResourceName" as targetResourceName nodrop<br />\| json field=\_raw "properties.targetResourceType" as targetResourceType nodrop<br />\| json field=\_raw "tenantId" as tenantId nodrop<br />\| json field=\_raw "correlationId" as correlationId nodrop<br />\| json field=\_raw "identity" as identity nodrop<br />\| json field=\_raw "properties.additionalTargets" as additionalTargets  nodrop<br />\| json field=\_raw "resultDescription" as resultDescription nodrop<br />\| json field=\_raw "properties.targetUpdatedProperties" as updated\_properties nodrop<br />\|where if ("{{resulttype}}" = "\*", true, resulttype matches "{{resulttype}}") AND if ("{{identity}}" = "\*", true, identity matches "{{identity}}") AND if ("{{operationname}}" = "\*", true, operationname matches "{{operationname}}") AND if ("{{auditeventcategory}}" = "\*", true, auditeventcategory matches "{{auditeventcategory}}") AND if ("{{targetresourcename}}" = "\*", true, targetresourcename matches "{{targetresourcename}}") AND if ("{{level}}" = "\*", true, level matches "{{level}}") AND if ("{{tenantid}}" = "\*", true, tenantid matches "{{tenantid}}") AND if ("{{resultdescription}}" = "\*", true, resultdescription matches "{{resultdescription}}")<br />\|count by operationName, resultType, resultDescription, identity<br />\| sort by \_count asc|
|Azure Active Directory/Azure Active Directory - Authorization/Authentication|Successful Events|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Authorization/Authentication/Other|\_sourceCategory={{Logsdatasource}}  (Authorization or Authentication or Other or Resource or PolicyManagement)<br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where audit\_event\_category in ("Authorization","Authentication", "Other")<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND identity matches "{{identity}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}" AND correlation\_id matches "{{correlation\_id}}"<br />\| where result\_type matches "\*success\*"<br />\| count as frequency by operation\_name, result\_type, result\_reason, identity, target\_resource\_name<br />\| sort by frequency|
|Azure Active Directory|Successful Events|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - User Management|\_sourceCategory={{Logsdatasource}}  "UserManagement"<br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| where result\_type matches "\*success\*"<br />\| count as frequency by operation\_name, level, logged\_by\_service, operation\_type, app\_name, result\_type, result\_reason, identity, updated\_properties<br />\| sort by frequency|
|Azure Active Directory|Successful Events|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Group Management|\_sourceCategory={{Logsdatasource}}  "GroupManagement"<br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where result\_type matches "{{result\_type}}" AND operation\_name matches "{{operation\_name}}" AND identity matches "{{identity}}"<br />\| where result\_type matches "\*success\*"<br />\| count as frequency by operation\_name, logged\_by\_service, level, result\_type, result\_reason, identity, operation\_type<br />\| sort by frequency|
|Azure Active Directory|Successful Events|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Role Management |\_sourceCategory={{Logsdatasource}}  "RoleManagement"<br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| where result\_type matches "\*success\*"<br />\| count as frequency by operation\_name, level, logged\_by\_service, operation\_type, app\_name, result\_type, result\_reason, identity<br />\| sort by frequency|
|Azure Active Directory|Successful Events|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Application Management|\_sourceCategory={{Logsdatasource}}  "ApplicationManagement"<br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND identity matches "{{identity}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| where result\_type matches "\*success\*"<br />\| count as frequency by activity\_type, operation\_name, logged\_by\_service, level, result\_type, result\_reason, identity<br />\| sort by frequency|
|Azure Active Directory|Successful Events|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Directory Management |\_sourceCategory={{Logsdatasource}}  "DirectoryManagement"<br />\| json "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}" AND correlation\_id matches "{{correlation\_id}}" AND identity matches "{{identity}}"<br />\| where result\_type matches "\*success\*"<br />\| count as frequency by operation\_name, result\_type, result\_reason, logged\_by\_service, target\_resource\_name<br />\| sort by frequency|
|Azure Active Directory|Summary Table|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Application Management|\_sourceCategory={{Logsdatasource}}  "ApplicationManagement" <br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND identity matches "{{identity}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| count as frequency by activity\_type, operation\_name, logged\_by\_service, level, result\_type, result\_reason, identity, target\_resource\_name<br />\| sort by frequency|
|Azure Active Directory|Top 10 Active Users|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Successful Sign-In Events|\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity" <br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type = "0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| count as frequency by identity <br />\| sort by frequency  <br />\| limit 10|
|Azure Active Directory|Top 10 Active Users|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - Failure Sign-In Events |\_sourceCategory={{Logsdatasource}}  "SignInLogs" "Sign-in activity" <br />\| json "operationName", "time", "category", "Level", "callerIpAddress", "resultType", "tenantId", "correlationId", "identity", "resultDescription", "location", "resultSignature", "properties.appDisplayName", "properties.location.countryOrRegion", "properties.location.state", "properties.location.city", "properties.deviceDetail.operatingSystem", "properties.deviceDetail.browser", "properties.clientAppUsed", "properties.riskState", "properties.status.errorCode", "properties.userDisplayName", "properties.userPrincipalName", "properties.status.failureReason" as operation\_name, time, category, level, ip\_addr, result\_type, tenant\_id, correlation\_id, identity, result\_description, location, result\_signature, app\_display\_name, country\_or\_region, state, city, operating\_system, browser, client\_app\_used, risk\_state, error\_code, user\_display\_name, user\_principal\_name, failure\_reason nodrop<br />\| parse regex field=time "(?\<date\>[0-9]{4}-[0-9]{2}-[0-9]{2})T(?\<time\>[0-9]{2}:[0-9]{2}:[0-9]{2})"<br />\| concat(date, " ",time) as date\_time<br />\| if(risk\_state in ("atRisk", "confirmedCompromised"), "true", "false") as is\_risky<br />\| where result\_type !="0" AND city matches "{{city}}" AND tenant\_id matches "{{tenant\_id}}" AND client\_app\_used matches "{{client\_app\_used}}" AND user\_display\_name matches "{{user\_display\_name}}" AND app\_display\_name matches "{{app\_display\_name}}" AND identity matches "{{identity}}" AND browser matches "{{browser}}" AND operation\_name matches "{{operation\_name}}" AND is\_risky matches "{{is\_risky}}"<br />\| count as frequency by identity <br />\| sort by frequency  <br />\| limit 10|
|Azure Active Directory|Updated User|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - User Management|\_sourceCategory={{Logsdatasource}}  "UserManagement"<br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| where operation\_name matches /(?i)update user\*/<br />\| count as frequency by operation\_name, level, logged\_by\_service, operation\_type, app\_name, result\_type, result\_reason, identity, updated\_properties<br />\| sort by frequency|
|Azure Active Directory|User Management Events - Outlier|Logs|Installed Apps/Azure Active Directory/Azure Active Directory - User Management|\_sourceCategory={{Logsdatasource}}  "UserManagement" <br />\| json  "properties.activityDisplayName", "category", "tenantId", "resultSignature", "Level", "properties.category", "properties.result", "properties.resultReason", "properties.activityDateTime", "properties.loggedByService", "properties.operationType", "properties.initiatedBy.app.displayName", "properties.targetResources[0].displayName" , "properties.targetResources[0].type", "callerIpAddress", "correlationId", "identity", "properties.additionalDetails" as operation\_name,  activity\_type, tenant\_id, result\_signature, level, audit\_event\_category, result\_type, result\_reason, activity\_date\_time, logged\_by\_service, operation\_type, app\_name, target\_resource\_name, target\_resource\_type, ip\_addr, correlation\_id, identity, updated\_properties nodrop<br />\| where !isNull(operation\_name)<br />\| where result\_type matches "{{result\_type}}" AND tenant\_id matches "{{tenant\_id}}" AND operation\_name matches "{{operation\_name}}" AND level matches "{{level}}"<br />\| timeslice 1h<br />\| count(operation\_name) as frequency by  \_timeslice <br />\| fillmissing timeslice(1h)<br />\| outlier frequency|

