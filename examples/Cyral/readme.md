# Cyral
## Sumo Logic App For: Cyral
The Cyral App for Sumo Logic provides dashboards and visualizations for Cyral customers that have chosen to send their logs to the Sumo Logic platform.
Docs Link: [Cyral](https://github.com/SumoLogic/sumologic-public-partner-apps/tree/master/Cyral)

## Searches

### Log Searches

- **{{topKLimit}}  Most Recent Sessions by Session End**: from Dashboard: Installed Apps/Cyral/Cyral - User Activity Details 
- **{{topKLimit}} Most Recent Authentication Failures**: from Dashboard: Installed Apps/Cyral/Cyral - Security Summary 
- **{{topKLimit}} Most Recent Sessions**: from Dashboard: Installed Apps/Cyral/Cyral - Application Activity Details 
- **Anomalous Read Access**: from Dashboard: Installed Apps/Cyral/Cyral - Data Monitoring Activity 
- **Apps With Violations**: from Dashboard: Installed Apps/Cyral/Cyral - Policy Summary 
- **Avg Bytes Read**: from Dashboard: Installed Apps/Cyral/Cyral - User Activity Details 
- **Avg Bytes Read**: from Dashboard: Installed Apps/Cyral/Cyral - Data Monitoring Activity 
- **Avg Bytes Read**: from Dashboard: Installed Apps/Cyral/Cyral - Application Activity Details 
- **Avg Execution Time**: from Dashboard: Installed Apps/Cyral/Cyral - Data Monitoring Activity 
- **Avg Execution Time**: from Dashboard: Installed Apps/Cyral/Cyral - Application Activity Details 
- **Avg Execution Time**: from Dashboard: Installed Apps/Cyral/Cyral - User Activity Details 
- **Avg Records Read**: from Dashboard: Installed Apps/Cyral/Cyral - User Activity Details 
- **Avg Records Read**: from Dashboard: Installed Apps/Cyral/Cyral - Data Monitoring Activity 
- **Avg Records Read**: from Dashboard: Installed Apps/Cyral/Cyral - Application Activity Details 
- **Bottom {{topKLimit}} SELECT Queries Without a Policy**: from Dashboard: Installed Apps/Cyral/Cyral - Policy Summary 
- **Data Activity by SSO Group**: from Dashboard: Installed Apps/Cyral/Cyral - Data Monitoring Activity 
- **Data Reads Breakdown**: from Dashboard: Installed Apps/Cyral/Cyral - Application Activity Details 
- **Data Reads Breakdown**: from Dashboard: Installed Apps/Cyral/Cyral - User Activity Details 
- **Groups By Statement Category**: from Dashboard: Installed Apps/Cyral/Cyral - Data Monitoring Activity 
- **Inactive Users**: from Dashboard: Installed Apps/Cyral/Cyral - Data Monitoring Activity 
- **Modifications**: from Dashboard: Installed Apps/Cyral/Cyral - Application Activity Details 
- **Modifications**: from Dashboard: Installed Apps/Cyral/Cyral - User Activity Details 
- **Number of Users**: from Dashboard: Installed Apps/Cyral/Cyral - Data Monitoring Activity 
- **Policies Not In Use**: from Dashboard: Installed Apps/Cyral/Cyral - Policy Summary 
- **Queries By User - Aggregate**: from Dashboard: Installed Apps/Cyral/Cyral - Data Monitoring Activity 
- **Query Trend By User**: from Dashboard: Installed Apps/Cyral/Cyral - Data Monitoring Activity 
- **Recent Activity By User**: from Dashboard: Installed Apps/Cyral/Cyral - Data Monitoring Activity 
- **Repos With Violations**: from Dashboard: Installed Apps/Cyral/Cyral - Policy Summary 
- **Requests by SSO Group**: from Dashboard: Installed Apps/Cyral/Cyral - Data Monitoring Activity 
- **Statement Type Breakdown by Sum of Records**: from Dashboard: Installed Apps/Cyral/Cyral - User Activity Details 
- **Statement Type Breakdown by Sum of Records**: from Dashboard: Installed Apps/Cyral/Cyral - Application Activity Details 
- **Statement Types Without Policy**: from Dashboard: Installed Apps/Cyral/Cyral - Policy Summary 
- **Suspicious Activity**: from Dashboard: Installed Apps/Cyral/Cyral - Security Summary 
- **Suspicious Activity By Geography**: from Dashboard: Installed Apps/Cyral/Cyral - Security Summary 
- **Suspicious Activity By Repo**: from Dashboard: Installed Apps/Cyral/Cyral - Security Summary 
- **Top {{topKLimit}}  Repo Users By Sum Records**: from Dashboard: Installed Apps/Cyral/Cyral - User Activity Details 
- **Top {{topKLimit}}  Repos By Sum Records**: from Dashboard: Installed Apps/Cyral/Cyral - User Activity Details 
- **Top {{topKLimit}} Applications by Sum Records**: from Dashboard: Installed Apps/Cyral/Cyral - User Activity Details 
- **Top {{topKLimit}} End Users By Sum Records**: from Dashboard: Installed Apps/Cyral/Cyral - Application Activity Details 
- **Top {{topKLimit}} Hosts by Sum Records**: from Dashboard: Installed Apps/Cyral/Cyral - Application Activity Details 
- **Top {{topKLimit}} Policies Not Used in Past 30 Days**: from Dashboard: Installed Apps/Cyral/Cyral - Policy Summary 
- **Top {{topKLimit}} Policies Violated**: from Dashboard: Installed Apps/Cyral/Cyral - Policy Summary 
- **Top {{topKLimit}} Policy Violations**: from Dashboard: Installed Apps/Cyral/Cyral - User Activity Details 
- **Top {{topKLimit}} Policy Violations**: from Dashboard: Installed Apps/Cyral/Cyral - Application Activity Details 
- **Top {{topKLimit}} Queries Without a Policy**: from Dashboard: Installed Apps/Cyral/Cyral - Policy Summary 
- **Top {{topKLimit}} Repos By Sum Records**: from Dashboard: Installed Apps/Cyral/Cyral - Application Activity Details 
- **Top {{topKLimit}} Suspicious IPs**: from Dashboard: Installed Apps/Cyral/Cyral - Security Summary 
- **Top {{topKLimit}} Users With Violations**: from Dashboard: Installed Apps/Cyral/Cyral - Policy Summary 
- **Total Reads**: from Dashboard: Installed Apps/Cyral/Cyral - Application Activity Details 
- **Total Reads**: from Dashboard: Installed Apps/Cyral/Cyral - Data Monitoring Activity 
- **Total Reads**: from Dashboard: Installed Apps/Cyral/Cyral - User Activity Details 
- **Total Violations**: from Dashboard: Installed Apps/Cyral/Cyral - Policy Summary 
- **User Statement Type Trend by Sum of Records**: from Dashboard: Installed Apps/Cyral/Cyral - Application Activity Details 
- **User Statement Type Trend by Sum of Records**: from Dashboard: Installed Apps/Cyral/Cyral - User Activity Details 
- **Users With Violations**: from Dashboard: Installed Apps/Cyral/Cyral - Policy Summary

### Metric Searches


## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|Cyral|{{topKLimit}}  Most Recent Sessions by Session End|Logs|Installed Apps/Cyral/Cyral - User Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","identity.endUser","request.statementType","activityTime","response.records","response.bytes","repo.name","identity.repoUser","client.connectionId" nodrop<br />\| where %"identity.group" matches "{{Group}}" and %"identity.endUser" matches "{{endUser}}" and %"request.statementType" matches "{{statementType}}"<br />\| first(%"activityTime") as SessionStart, last(%"activityTime") as SessionEnd, sum(%"response.records") as Records, sum(%"response.bytes") as Bytes by %"repo.name", %"identity.repoUser", %"identity.group", %"client.connectionId"<br />\| sort by SessionEnd desc<br />\| limit {{topKLimit}} |
|Cyral|{{topKLimit}} Most Recent Authentication Failures|Logs|Installed Apps/Cyral/Cyral - Security Summary|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "activityTypes","sidecar.name","repo.name","identity.repoUser","identity.endUser","activityTime","client.host","client.applicationName" nodrop<br />\| where %"activityTypes" contains "authenticationFailure" and %"sidecar.name" matches "{{sidecar\_name}}" and %"repo.name" matches "{{repo\_name}}"<br />\| lookup type, actor, threatlevel from sumo://threat/cs on threat = %"client.host"<br />\| count as Count by %"identity.repoUser", %"identity.endUser", %"repo.name", %"activityTime", %"client.host",type,actor,threatlevel, %"client.applicationName"<br />\| sort by %"activityTime" desc<br />\| limit {{topKLimit}}|
|Cyral|{{topKLimit}} Most Recent Sessions|Logs|Installed Apps/Cyral/Cyral - Application Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","client.applicationName","activityTime","response.records","response.bytes","repo.name","identity.repoUser","client.connectionId" nodrop<br />\| where %"identity.group" matches "\*" and %"client.applicationName" matches "{{applicationName}}"\|first(%"activityTime") as SessionStart, last(%"activityTime") as SessionEnd, sum(%"response.records") as Records, sum(%"response.bytes") as Bytes by %"repo.name", %"identity.repoUser", %"identity.group", %"client.connectionId"<br />\| sort by SessionEnd desc<br />\| limit {{topKLimit}}|
|Cyral|Anomalous Read Access|Logs|Installed Apps/Cyral/Cyral - Data Monitoring Activity|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "request.fieldsAccessed[\*].label" as fieldLabel nodrop<br />\| json "identity.group" as SSOGroup nodrop<br />\| json "request.statementType" nodrop<br />\| where SSOGroup matches "{{GroupName}}" AND %"request.statementType" matches "{{StatementType}}"<br />\| count by fieldLabel, SSOGroup|
|Cyral|Apps With Violations|Logs|Installed Apps/Cyral/Cyral - Policy Summary|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "policyViolated","sidecar.name","repo.name","client.applicationName" nodrop<br />\| where %"policyViolated" = "true" and %"sidecar.name" matches "{{sidecar\_name}}" and %"repo.name" matches "{{repo\_name}}"<br />\| count\_distinct(%"client.applicationName")|
|Cyral|Avg Bytes Read|Logs|Installed Apps/Cyral/Cyral - User Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","identity.endUser","request.statementType","response.bytes" nodrop<br />\| where !isNull(%"identity.group") and !isNull(%"response.message") and %"identity.group" matches "{{Group}}" and %"identity.endUser" matches "{{endUser}}" and %"request.statementType" matches "{{statementType}}"<br />\| avg(%"response.bytes")|
|Cyral|Avg Bytes Read|Logs|Installed Apps/Cyral/Cyral - Data Monitoring Activity|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","request.statementType","response.message","response.bytes" nodrop<br />\| where %"identity.group" matches "{{GroupName}}" AND %"request.statementType" matches "{{StatementType}}" and !isNull(%"response.message")<br />\| avg(%"response.bytes")|
|Cyral|Avg Bytes Read|Logs|Installed Apps/Cyral/Cyral - Application Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","response.message","client.applicationName","response.bytes" nodrop<br />\| where !isNull(%"identity.group") and !isNull(%"response.message") and %"client.applicationName" matches "{{applicationName}}"<br />\| avg(%"response.bytes")|
|Cyral|Avg Execution Time|Logs|Installed Apps/Cyral/Cyral - Data Monitoring Activity|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","request.statementType","response.message","response.executionTimeNanos" nodrop<br />\| where %"identity.group" matches "{{GroupName}}" AND %"request.statementType" matches "{{StatementType}}" and !isNull(%"response.message")<br />\| %"response.executionTimeNanos" / 1000000 as executionTimeInMS<br />\| avg(executionTimeInMS)|
|Cyral|Avg Execution Time|Logs|Installed Apps/Cyral/Cyral - Application Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","response.message","client.applicationName","response.executionTimeNanos" nodrop<br />\| where !isNull(%"identity.group") and !isNull(%"response.message") and %"client.applicationName" matches "{{applicationName}}"<br />\| %"response.executionTimeNanos" / 1000000 as executionTimeInMS<br />\| avg(executionTimeInMS)|
|Cyral|Avg Execution Time|Logs|Installed Apps/Cyral/Cyral - User Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\|json "identity.group","response.message","identity.endUser","request.statementType","response.executionTimeNanos" nodrop<br />\| where !isNull(%"identity.group") and !isNull(%"response.message") and %"identity.group" matches "{{Group}}" and %"identity.endUser" matches "{{endUser}}" and %"request.statementType" matches "{{statementType}}"<br />\| %"response.executionTimeNanos" / 1000000 as executionTimeInMS<br />\| avg(executionTimeInMS)|
|Cyral|Avg Records Read|Logs|Installed Apps/Cyral/Cyral - User Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","response.message","identity.endUser","request.statementType","response.records" nodrop<br />\| where !isNull(%"identity.group") and !isNull(%"response.message") and %"identity.group" matches "{{Group}}" and %"identity.endUser" matches "{{endUser}}" and %"request.statementType" matches "{{statementType}}"<br />\| avg(%"response.records")|
|Cyral|Avg Records Read|Logs|Installed Apps/Cyral/Cyral - Data Monitoring Activity|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","request.statementType","response.message","response.records" nodrop<br />\| where %"identity.group" matches "{{GroupName}}" AND %"request.statementType" matches "{{StatementType}}" and !isNull(%"response.message")<br />\| avg(%"response.records")|
|Cyral|Avg Records Read|Logs|Installed Apps/Cyral/Cyral - Application Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","response.message","client.applicationName","response.records" nodrop<br />\| where !isNull(%"identity.group") and !isNull(%"response.message") and %"client.applicationName" matches "{{applicationName}}"<br />\| avg(%"response.records")|
|Cyral|Bottom {{topKLimit}} SELECT Queries Without a Policy|Logs|Installed Apps/Cyral/Cyral - Policy Summary|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "policyViolated","request.statementType","sidecar.name","repo.name","request.datasetsAccessed","request.statement","response.records","client.connectionTime","identity.group","identity.endUser","client.applicationName","client.host" nodrop<br />\| where %"policyViolated" = "false" and %"request.statementType" = "SELECT" and %"sidecar.name" matches "{{sidecar\_name}}" and %"repo.name" matches "{{repo\_name}}" and isNull(%"request.datasetsAccessed")<br />\| parse regex field=%"request.statement" "^SELECT (?\<Fields\>.\*) FROM (?\<TableName\>[a-z\_\\.\\-A-Z\$]\*\\b)"<br />\| count as Count, sum(%"response.records") as recordsRead by %"repo.name", %"client.connectionTime", %"identity.group", %"identity.endUser", %"client.applicationName", %"client.host", Fields, TableName<br />\| sort by Count asc<br />\| limit {{topKLimit}}|
|Cyral|Data Activity by SSO Group|Logs|Installed Apps/Cyral/Cyral - Data Monitoring Activity|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "activityTypes","identity.group","request.statementType" nodrop<br />\| where %"activityTypes" contains "query" AND %"identity.group" matches "{{GroupName}}" AND %"request.statementType" matches "{{StatementType}}"<br />\| timeslice 15m<br />\| count by \_timeslice, %"identity.group"<br />\| transpose row \_timeslice column %"identity.group"|
|Cyral|Data Reads Breakdown|Logs|Installed Apps/Cyral/Cyral - Application Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "request.datasetsAccessed[\*].accessType" as accessType nodrop<br />\| json "request.datasetsAccessed[\*].dataset" as dataset nodrop<br />\| json "client.applicationName","response.records","identity.endUser","repo.name" nodrop<br />\| where %"client.applicationName" matches "{{applicationName}}" and accessType="[\\"read\\"]"<br />\| sum(%"response.records") as TotalRecords, count(accessType) as Queries by %"identity.endUser", %"repo.name", dataset |
|Cyral|Data Reads Breakdown|Logs|Installed Apps/Cyral/Cyral - User Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "request.datasetsAccessed[\*].accessType" as dataSetAccessType nodrop<br />\| json "request.datasetsAccessed[\*].dataset" as dataSetAccessedDataSet nodrop<br />\| json "identity.group","repo.name","response.records","identity.endUser","request.statementType" nodrop<br />\| where dataSetAccessType contains "read" and %"identity.group" matches "{{Group}}" and %"identity.endUser" matches "{{endUser}}" and %"request.statementType" matches "{{statementType}}"<br />\| count(dataSetAccessType) as QueryTypes, sum(%"response.records") as TotalRecords by %"identity.endUser", %"repo.name", dataSetAccessedDataSet<br />\| sort by QueryTypes<br />\| limit {{topKLimit}}|
|Cyral|Groups By Statement Category|Logs|Installed Apps/Cyral/Cyral - Data Monitoring Activity|(\_sourceCategory={{Logsdatasource}} )<br />\| json "request.fieldsAccessed[\*].label" as fieldLabel nodrop<br />\| json "identity.group","request.statementType" nodrop<br />\| where %"identity.group" matches "{{GroupName}}" AND %"request.statementType" matches "{{StatementType}}"<br />\| count by %"identity.group", %"request.statementType"|
|Cyral|Inactive Users|Logs|Installed Apps/Cyral/Cyral - Data Monitoring Activity|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","request.statementType","activityTime","identity.endUser","identity.repoUser" nodrop<br />\| where %"identity.group" matches "{{GroupName}}" AND %"request.statementType" matches "{{StatementType}}"<br />\| first(%"activityTime") by %"identity.endUser", %"identity.group", %"identity.repoUser"<br />\| now()-30d as expireTime\|parseDate(\_first, "yyyy-MM-dd HH:mm:ss") as parsedDate<br />\| where expireTime \> parsedDate<br />\| count|
|Cyral|Modifications|Logs|Installed Apps/Cyral/Cyral - Application Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "request.datasetsAccessed[\*].accessType" as accessType nodrop<br />\| json "request.datasetsAccessed[\*].dataset" as dataset nodrop<br />\| json "client.applicationName","request.statementType","response.records","identity.endUser","repo.name" nodrop<br />\| where %"client.applicationName" matches "{{applicationName}}" and %"request.statementType" IN ("DELETE","UPDATE","INSERT")<br />\| sum(%"response.records") as TotalRecords, count(accessType) as Queries by %"identity.endUser", %"repo.name", dataset |
|Cyral|Modifications|Logs|Installed Apps/Cyral/Cyral - User Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","identity.endUser","request.statementType","response.records","repo.name" nodrop<br />\| where %"identity.group" matches "{{Group}}" and %"identity.endUser" matches "{{endUser}}" and (%"request.statementType"="DELETE" or %"request.statementType"="INSERT" or %"request.statementType"="UPDATE")<br />\| json "request.datasetsAccessed[\*].accessType" as accessType nodrop<br />\| json "request.datasetsAccessed[\*].dataset" as dataSet nodrop<br />\| sum(%"response.records") as TotalRecords, count(accessType) as QueryTypes by %"identity.endUser", %"repo.name", dataSet|
|Cyral|Number of Users|Logs|Installed Apps/Cyral/Cyral - Data Monitoring Activity|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","request.statementType","activityTypes","identity.endUser" nodrop<br />\| where %"identity.group" matches "{{GroupName}}" AND %"request.statementType" matches "{{StatementType}}" AND %"activityTypes" CONTAINS "query"<br />\| count\_distinct(%"identity.endUser")|
|Cyral|Policies Not In Use|Logs|Installed Apps/Cyral/Cyral - Policy Summary|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "policyViolated","sidecar.name","repo.name","activityTime","identity.endUser","identity.group","identity.repoUser" nodrop<br />\| where %"policyViolated" matches "\*" and %"sidecar.name" matches "{{sidecar\_name}}" and %"repo.name" matches "{{repo\_name}}"\|first(%"activityTime") by %"identity.endUser", %"identity.group", %"identity.repoUser"<br />\| now()-30d as expireTime\|parseDate(\_first, "yyyy-MM-dd HH:mm:ss") as parsedDate<br />\| where expireTime \> parsedDate<br />\| count|
|Cyral|Queries By User - Aggregate|Logs|Installed Apps/Cyral/Cyral - Data Monitoring Activity|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","request.statementType","identity.endUser" nodrop<br />\| where %"identity.group" matches "{{GroupName}}" AND %"request.statementType" matches "{{StatementType}}"<br />\| count by %"identity.endUser", %"request.statementType"<br />\| transpose row %"identity.endUser" column %"request.statementType"|
|Cyral|Query Trend By User|Logs|Installed Apps/Cyral/Cyral - Data Monitoring Activity|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","request.statementType","identity.endUser" nodrop<br />\| where %"identity.group" matches "{{GroupName}}" AND %"request.statementType" matches "{{StatementType}}"<br />\| timeslice 15m<br />\| count by \_timeslice, %"identity.endUser"<br />\| transpose row \_timeslice column %"identity.endUser"|
|Cyral|Recent Activity By User|Logs|Installed Apps/Cyral/Cyral - Data Monitoring Activity|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","request.statementType","activityTime","identity.endUser","identity.repoUser" nodrop<br />\| where %"identity.group" matches "{{GroupName}}" AND %"request.statementType" matches "{{StatementType}}"<br />\| first(%"activityTime") by %"identity.endUser", %"identity.group", %"identity.repoUser"|
|Cyral|Repos With Violations|Logs|Installed Apps/Cyral/Cyral - Policy Summary|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "policyViolated","sidecar.name","repo.name" nodrop<br />\| where %"policyViolated" = "true" and %"sidecar.name" matches "{{sidecar\_name}}" and %"repo.name" matches "{{repo\_name}}"<br />\| count\_distinct(%"repo.name")|
|Cyral|Requests by SSO Group|Logs|Installed Apps/Cyral/Cyral - Data Monitoring Activity|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "activityTypes","identity.group","request.statementType" nodrop<br />\| where %"activityTypes" contains "query" and %"identity.group" matches "{{GroupName}}" AND %"request.statementType" matches "{{StatementType}}"\|if(isBlank(%"identity.group"), "blank", %"identity.group") as myField<br />\| where myField != "blank"<br />\| count by %"identity.group", %"request.statementType"<br />\| transpose row %"identity.group" column %"request.statementType" as \*|
|Cyral|Statement Type Breakdown by Sum of Records|Logs|Installed Apps/Cyral/Cyral - User Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","identity.endUser","request.statementType","response.records" nodrop<br />\| where !isNull(%"identity.group") AND %"identity.group" matches "{{Group}}" and %"identity.endUser" matches "{{endUser}}" and %"request.statementType" matches "{{statementType}}"<br />\| sum(%"response.records") by %"request.statementType"|
|Cyral|Statement Type Breakdown by Sum of Records|Logs|Installed Apps/Cyral/Cyral - Application Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","identity.endUser","client.applicationName","response.records","request.statementType" nodrop<br />\| where !isNull(%"identity.group") AND %"identity.endUser" matches "\*" and %"client.applicationName" matches "{{applicationName}}"<br />\| sum(%"response.records") by %"request.statementType"|
|Cyral|Statement Types Without Policy|Logs|Installed Apps/Cyral/Cyral - Policy Summary|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "policyViolated","sidecar.name","repo.name","request.datasetsAccessed","request.statementType" nodrop<br />\| where %"policyViolated" = "false" and %"sidecar.name" matches "{{sidecar\_name}}" and %"repo.name" matches "{{repo\_name}}" AND isNull(%"request.datasetsAccessed")<br />\| count as Count by %"request.statementType"<br />\| sum(Count) by %"request.statementType"|
|Cyral|Suspicious Activity|Logs|Installed Apps/Cyral/Cyral - Security Summary|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "activityTypes","sidecar.name","repo.name" nodrop<br />\| where %"activityTypes" in ("[\\"authenticationFailure\\"]", "[\\"portScan\\"]") and %"sidecar.name" matches "{{sidecar\_name}}" and %"repo.name" matches "{{repo\_name}}"<br />\| timeslice<br />\| count by \_timeslice, %"activityTypes"<br />\| transpose row \_timeslice column %"activityTypes"|
|Cyral|Suspicious Activity By Geography|Logs|Installed Apps/Cyral/Cyral - Security Summary|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "activityTypes","sidecar.name","repo.name","client.host" nodrop<br />\| where %"activityTypes" in ("[\\"authenticationFailure\\"]", "[\\"portScan\\"]") and %"sidecar.name" matches "{{sidecar\_name}}" and %"repo.name" matches "{{repo\_name}}"<br />\| lookup latitude, longitude from geo://location on ip=%"client.host" <br />\| count as Count by latitude, longitude<br />\| sort Count<br /><br />|
|Cyral|Suspicious Activity By Repo|Logs|Installed Apps/Cyral/Cyral - Security Summary|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "activityTypes","repo.name","sidecar.name" nodrop<br />\| where %"activityTypes" in ("[\\"authenticationFailure\\"]", "[\\"portScan\\"]") and !isNull(%"repo.name") and %"sidecar.name" matches "{{sidecar\_name}}" and %"repo.name" matches "{{repo\_name}}"<br />\| timeslice\|count by \_timeslice, %"repo.name"\| transpose row \_timeslice column %"repo.name"|
|Cyral|Top {{topKLimit}}  Repo Users By Sum Records|Logs|Installed Apps/Cyral/Cyral - User Activity Details|((\_sourceCategory={{Logsdatasource}}  ))<br />\| json "identity.group","identity.endUser","request.statementType","response.records","identity.repoUser" nodrop<br />\| where %"identity.group" matches "\*" AND %"identity.group" matches "{{Group}}" and %"identity.endUser" matches "{{endUser}}" and %"request.statementType" matches "{{statementType}}"<br />\| sum(%"response.records") as TotalRecords by %"identity.repoUser"<br />\| sort by TotalRecords desc<br />\| limit {{topKLimit}} |
|Cyral|Top {{topKLimit}}  Repos By Sum Records|Logs|Installed Apps/Cyral/Cyral - User Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","identity.endUser","request.statementType","response.records","repo.name" nodrop<br />\| where %"identity.group" matches "\*" AND %"identity.group" matches "{{Group}}" and %"identity.endUser" matches "{{endUser}}" and %"request.statementType" matches "{{statementType}}"<br />\| sum(%"response.records") as TotalRecords by %"repo.name"<br />\| sort by TotalRecords desc<br />\| limit {{topKLimit}} |
|Cyral|Top {{topKLimit}} Applications by Sum Records|Logs|Installed Apps/Cyral/Cyral - User Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","identity.endUser","request.statementType","response.records","client.applicationName" nodrop<br />\| where %"identity.group" matches "{{Group}}" and %"identity.endUser" matches "{{endUser}}" and %"request.statementType" matches "{{statementType}}"<br />\| sum(%"response.records") as TotalRecords by %"client.applicationName"<br />\| sort by TotalRecords desc<br />\| limit {{topKLimit}} |
|Cyral|Top {{topKLimit}} End Users By Sum Records|Logs|Installed Apps/Cyral/Cyral - Application Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","identity.endUser","client.applicationName","response.records" nodrop<br />\| where %"identity.group" matches "\*" AND %"identity.endUser" matches "\*" and %"client.applicationName" matches "{{applicationName}}"<br />\| sum(%"response.records") as TotalRecords by %"identity.endUser"<br />\| sort by TotalRecords desc<br />\| limit {{topKLimit}}|
|Cyral|Top {{topKLimit}} Hosts by Sum Records|Logs|Installed Apps/Cyral/Cyral - Application Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","identity.endUser","client.applicationName","response.records","client.host" nodrop<br />\| where %"identity.group" matches "\*" AND %"identity.endUser" matches "\*" and %"client.applicationName" matches "{{applicationName}}"<br />\| sum(%"response.records") as TotalRecords by %"client.host"<br />\| sort by TotalRecords desc<br />\| limit {{topKLimit}}|
|Cyral|Top {{topKLimit}} Policies Not Used in Past 30 Days|Logs|Installed Apps/Cyral/Cyral - Policy Summary|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "policyViolated","sidecar.name","repo.name","activityTime" nodrop<br />\| json "policyViolations[\*].policyName" as policyName nodrop<br />\| where %"policyViolated" matches "\*" and policyName matches "\*" and %"sidecar.name" matches "{{sidecar\_name}}" and %"repo.name" matches "{{repo\_name}}"<br />\| first(%"activityTime") by policyName\| now()-30d as expireTime\|parseDate(\_first, "yyyy-MM-dd HH:mm:ss") as parsedDate<br />\| where expireTime \> parsedDate\|count as Count by policyName<br />\| sort by Count desc<br />\| limit {{topKLimit}}|
|Cyral|Top {{topKLimit}} Policies Violated|Logs|Installed Apps/Cyral/Cyral - Policy Summary|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "policyViolated","sidecar.name","repo.name" nodrop<br />\| where %"policyViolated" = "true" and %"sidecar.name" matches "{{sidecar\_name}}" and %"repo.name" matches "{{repo\_name}}"<br />\| json "policyViolations[\*].policyName" as policyName<br />\| count as Violations by policyName<br />\| sort by Violations desc<br />\| limit {{topKLimit}}|
|Cyral|Top {{topKLimit}} Policy Violations|Logs|Installed Apps/Cyral/Cyral - User Activity Details|(\_sourceCategory={{Logsdatasource}} )<br />\| json "policyViolations[\*].policyName" as policyName nodrop<br />\| json "policyViolations[\*].severity" as policySeverity nodrop<br />\| json "policyViolations[\*].accessType" as policyAccessType nodrop<br />\| json "identity.group","identity.endUser","request.statementType","policyViolated" nodrop<br />\| where %"identity.group" matches "{{Group}}" and %"identity.endUser" matches "{{endUser}}" and %"request.statementType" matches "{{statementType}}" and %"policyViolated"="true"<br />\| count as Violations by policyName, policySeverity, policyAccessType<br />\| sort by Violations<br />\| limit {{topKLimit}}|
|Cyral|Top {{topKLimit}} Policy Violations|Logs|Installed Apps/Cyral/Cyral - Application Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "policyViolations[\*].policyName" as policyName nodrop<br />\| json "policyViolations[\*].severity" as policySeverity nodrop<br />\| json "policyViolations[\*].accessType" as accessType nodrop<br />\| json "policyViolated" as policyViolated nodrop<br />\| json "client.applicationName" as applicationName nodrop<br />\| where policyViolated="true" and applicationName matches "{{applicationName}}"<br />\| count as Violations by policyName,policySeverity,accessType<br />\| sort by Violations desc<br />\| limit {{topKLimit}}|
|Cyral|Top {{topKLimit}} Queries Without a Policy|Logs|Installed Apps/Cyral/Cyral - Policy Summary|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "policyViolated","request.statementType","sidecar.name","repo.name","request.datasetsAccessed","request.statement" nodrop<br />\| where %"policyViolated" = "false" and %"request.statementType" = "SELECT" and %"sidecar.name" matches "{{sidecar\_name}}" and %"repo.name" matches "{{repo\_name}}" and isNull(%"request.datasetsAccessed")<br />\| count as Count by %"repo.name", %"request.statement"<br />\| sort by Count desc<br />\| limit {{topKLimit}}|
|Cyral|Top {{topKLimit}} Repos By Sum Records|Logs|Installed Apps/Cyral/Cyral - Application Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","identity.endUser","client.applicationName","response.records","repo.name" nodrop<br />\| where %"identity.group" matches "\*" AND %"identity.endUser" matches "\*" and %"client.applicationName" matches "{{applicationName}}"<br />\| sum(%"response.records") as TotalRecords by %"repo.name"<br />\| sort by TotalRecords desc<br />\| limit {{topKLimit}}|
|Cyral|Top {{topKLimit}} Suspicious IPs|Logs|Installed Apps/Cyral/Cyral - Security Summary|(\_sourceCategory={{Logsdatasource}} )<br />\| json "activityTypes","sidecar.name","repo.name","client.host" nodrop<br />\| where %"activityTypes" in ("[\\"authenticationFailure\\"]", "[\\"portScan\\"]") and %"sidecar.name" matches "{{sidecar\_name}}" and %"repo.name" matches "{{repo\_name}}"<br />\| lookup latitude, longitude, country\_code from geo://location on ip=%"client.host"<br />\| lookup type, actor, threatlevel from sumo://threat/cs on threat = %"client.host"<br />\| count as Count by %"client.host", country\_code, type, actor, threatlevel<br />\| sort by Count desc<br />\| limit {{topKLimit}}|
|Cyral|Top {{topKLimit}} Users With Violations|Logs|Installed Apps/Cyral/Cyral - Policy Summary|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "policyViolated","sidecar.name","repo.name","identity.endUser" nodrop<br />\| where %"policyViolated" = "true" and %"sidecar.name" matches "{{sidecar\_name}}" and %"repo.name" matches "{{repo\_name}}"<br />\| count as Count by %"identity.endUser"<br />\| sort by Count desc<br />\| limit {{topKLimit}}|
|Cyral|Total Reads|Logs|Installed Apps/Cyral/Cyral - Application Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","client.applicationName" nodrop<br />\| where !isNull(%"identity.group")<br />\| json "request.datasetsAccessed[\*].accessType" as accessType<br />\| where accessType CONTAINS "read" and %"client.applicationName" matches "{{applicationName}}"<br />\| count|
|Cyral|Total Reads|Logs|Installed Apps/Cyral/Cyral - Data Monitoring Activity|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","request.statementType" nodrop<br />\| where %"identity.group" matches "{{GroupName}}" AND %"request.statementType" matches "{{StatementType}}"<br />\| json "request.datasetsAccessed[\*].accessType" as accessType nodrop<br />\| where accessType CONTAINS "read"<br />\| count|
|Cyral|Total Reads|Logs|Installed Apps/Cyral/Cyral - User Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","identity.endUser","request.statementType" nodrop<br />\| where !isNull(%"identity.group") and %"identity.group" matches "{{Group}}" and %"identity.endUser" matches "{{endUser}}" and %"request.statementType" matches "{{statementType}}"<br />\| json "request.datasetsAccessed[\*].accessType" as accessType<br />\| where accessType CONTAINS "read"<br />\| count|
|Cyral|Total Violations|Logs|Installed Apps/Cyral/Cyral - Policy Summary|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "policyViolated","sidecar.name","repo.name" nodrop<br />\| where %"policyViolated" = "true" and %"sidecar.name" matches "{{sidecar\_name}}" and %"repo.name" matches "{{repo\_name}}"<br />\| count|
|Cyral|User Statement Type Trend by Sum of Records|Logs|Installed Apps/Cyral/Cyral - Application Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","identity.endUser","client.applicationName","response.records","request.statementType" nodrop<br />\| where !isNull(%"identity.group") AND %"identity.endUser" matches "\*" and %"client.applicationName" matches "{{applicationName}}"<br />\| timeslice 15m<br />\| sum(%"response.records") by \_timeslice, %"request.statementType"<br />\| transpose row \_timeslice column %"request.statementType"|
|Cyral|User Statement Type Trend by Sum of Records|Logs|Installed Apps/Cyral/Cyral - User Activity Details|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "identity.group","identity.endUser","request.statementType","response.records" nodrop<br />\| where !isNull(%"identity.group") AND %"identity.group" matches "{{Group}}" and %"identity.endUser" matches "{{endUser}}" and %"request.statementType" matches "{{statementType}}"<br />\| timeslice 15m<br />\| sum(%"response.records") by \_timeslice, %"request.statementType"<br />\| transpose row \_timeslice column %"request.statementType"|
|Cyral|Users With Violations|Logs|Installed Apps/Cyral/Cyral - Policy Summary|(\_sourceCategory={{Logsdatasource}}  )<br />\| json "policyViolated","sidecar.name","repo.name","identity.endUser" nodrop<br />\| where %"policyViolated" = "true" and %"sidecar.name" matches "{{sidecar\_name}}" and %"repo.name" matches "{{repo\_name}}"<br />\| count\_distinct(%"identity.endUser")|

