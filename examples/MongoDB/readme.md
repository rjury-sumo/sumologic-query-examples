# MongoDB
## Sumo Logic App For: MongoDB
The MongoDB app is a unified logs and metrics app that helps you monitor the availability, performance, health and resource utilization of your MongoDB database clusters. Preconfigured dashboards provide insight into cluster status, logins, connections, slow queries, replication, resource utilization, sharding, errors and warnings.
Docs Link: [MongoDB](https://help.sumologic.com/?cid=6009)

## Searches

### Log Searches

- **Arbiter Node(s)**: from Dashboard: MongoDB/Logs/MongoDB - Replication Logs 
- **Balancer Failures**: from Dashboard: MongoDB/Logs/MongoDB - Sharding 
- **Chunk Split Failures**: from Dashboard: MongoDB/Logs/MongoDB - Sharding 
- **Chunks Moving Between Shards**: from Dashboard: MongoDB/Logs/MongoDB - Sharding 
- **Chunks Moving Between Shards**: from Dashboard: MongoDB/Logs/MongoDB - Sharding 
- **Chunks Moving by Collection**: from Dashboard: MongoDB/Logs/MongoDB - Sharding 
- **Client Connection Requests**: from Dashboard: MongoDB/Logs/MongoDB - Logins and Connections 
- **CRUD Commands Over Time**: from Dashboard: MongoDB/MongoDB - Overview 
- **Error Logs by Component**: from Dashboard: MongoDB/MongoDB - Overview 
- **Error Logs by Context**: from Dashboard: MongoDB/MongoDB - Overview 
- **Error Summary - Daily**: from Dashboard: MongoDB/Logs/MongoDB - Errors and Warnings 
- **Errors**: from Dashboard: MongoDB/Logs/MongoDB - Errors and Warnings 
- **Errors**: from Dashboard: MongoDB/Logs/MongoDB - Sharding 
- **Errors by Component**: from Dashboard: MongoDB/Logs/MongoDB - Errors and Warnings 
- **Failed Login Attempt Summary**: from Dashboard: MongoDB/Logs/MongoDB - Logins and Connections 
- **Failed Logins by User**: from Dashboard: MongoDB/Logs/MongoDB - Logins and Connections 
- **Fatal Errors - Daily**: from Dashboard: MongoDB/Logs/MongoDB - Errors and Warnings 
- **Fatal Errors by Component**: from Dashboard: MongoDB/Logs/MongoDB - Errors and Warnings 
- **Heartbeat Error Events**: from Dashboard: MongoDB/Logs/MongoDB - Replication Logs 
- **Location of Client Connection Requests**: from Dashboard: MongoDB/Logs/MongoDB - Logins and Connections 
- **Location of Failed Logins**: from Dashboard: MongoDB/Logs/MongoDB - Logins and Connections 
- **Log Reduce**: from Dashboard: MongoDB/Logs/MongoDB - Errors and Warnings 
- **Logs by  Components**: from Dashboard: MongoDB/MongoDB - Overview 
- **Logs by Severity**: from Dashboard: MongoDB/MongoDB - Overview 
- **MongoDB Exit Events**: from Dashboard: MongoDB/Logs/MongoDB - Errors and Warnings 
- **Primary Node**: from Dashboard: MongoDB/Logs/MongoDB - Replication Logs 
- **Queries by KeysExamined Value**: from Dashboard: MongoDB/Logs/MongoDB - Query Logs 
- **Queries with KeysExamined greater than nreturned**: from Dashboard: MongoDB/Logs/MongoDB - Query Logs 
- **Replication Error Summary**: from Dashboard: MongoDB/Logs/MongoDB - Replication Logs 
- **Replication Errors**: from Dashboard: MongoDB/Logs/MongoDB - Replication Logs 
- **Replication Events**: from Dashboard: MongoDB/Logs/MongoDB - Replication Logs 
- **Replication Warnings**: from Dashboard: MongoDB/Logs/MongoDB - Replication Logs 
- **Secondary Node(s)**: from Dashboard: MongoDB/Logs/MongoDB - Replication Logs 
- **Secondary Node(s) Too Stale**: from Dashboard: MongoDB/Logs/MongoDB - Replication Logs 
- **Slow CRUD Commands**: from Dashboard: MongoDB/MongoDB - Overview 
- **Slow CRUD Commands Over Time**: from Dashboard: MongoDB/MongoDB - Overview 
- **Slow DB Commands**: from Dashboard: MongoDB/MongoDB - Overview 
- **Slow DB Commands Over Time**: from Dashboard: MongoDB/MongoDB - Overview 
- **Slow Queries**: from Dashboard: MongoDB/Logs/MongoDB - Query Logs 
- **Slow Queries by Connection ID**: from Dashboard: MongoDB/Logs/MongoDB - Query Logs 
- **Slow Queries Over Time by Type**: from Dashboard: MongoDB/Logs/MongoDB - Query Logs 
- **Slow Server Status**: from Dashboard: MongoDB/MongoDB - Overview 
- **Slowest Execution Time (in MS) of  DB  Commands**: from Dashboard: MongoDB/MongoDB - Overview 
- **Slowest Running Queries by Type**: from Dashboard: MongoDB/Logs/MongoDB - Query Logs 
- **Socket Excpetions**: from Dashboard: MongoDB/Logs/MongoDB - Errors and Warnings 
- **Stopped Servers**: from Dashboard: MongoDB/MongoDB - Overview 
- **Summary of Errors**: from Dashboard: MongoDB/Logs/MongoDB - Sharding 
- **Summary of Warnings**: from Dashboard: MongoDB/Logs/MongoDB - Sharding 
- **Timeout Events**: from Dashboard: MongoDB/Logs/MongoDB - Errors and Warnings 
- **Up Servers**: from Dashboard: MongoDB/MongoDB - Overview 
- **Warning Summary - Daily**: from Dashboard: MongoDB/Logs/MongoDB - Errors and Warnings 
- **Warnings**: from Dashboard: MongoDB/Logs/MongoDB - Sharding 
- **Warnings**: from Dashboard: MongoDB/Logs/MongoDB - Errors and Warnings 
- **Warnings by Component**: from Dashboard: MongoDB/Logs/MongoDB - Errors and Warnings

### Metric Searches

- **Cache Util %**: from Dashboard: MongoDB/Metrics/MongoDB - Resource 
- **Clients with Read Operations in In-Progress or Queued**: from Dashboard: MongoDB/MongoDB - Overview 
- **Clients with Write Operations in In-Progress or Queued**: from Dashboard: MongoDB/MongoDB - Overview 
- **Commands by Host per Second**: from Dashboard: MongoDB/MongoDB - Overview 
- **Commands Per Second**: from Dashboard: MongoDB/Metrics/MongoDB - Queries 
- **Current Connections**: from Dashboard: MongoDB/MongoDB - Overview 
- **Deletes Per Second**: from Dashboard: MongoDB/Metrics/MongoDB - Queries 
- **Document Operations**: from Dashboard: MongoDB/Metrics/MongoDB - Queries 
- **Entry Interval**: from Dashboard: MongoDB/MongoDB - Overview 
- **Flushes  Per Second**: from Dashboard: MongoDB/Metrics/MongoDB - Queries 
- **GetMore Per Second**: from Dashboard: MongoDB/Metrics/MongoDB - Queries 
- **Inserts Per Second**: from Dashboard: MongoDB/Metrics/MongoDB - Queries 
- **Memory**: from Dashboard: MongoDB/MongoDB - Overview 
- **Memory Over Time**: from Dashboard: MongoDB/Metrics/MongoDB - Resource 
- **Mongodb Uptime (Days)**: from Dashboard: MongoDB/MongoDB - Overview 
- **Network**: from Dashboard: MongoDB/MongoDB - Overview 
- **Network Over Time**: from Dashboard: MongoDB/Metrics/MongoDB - Resource 
- **Open Connections**: from Dashboard: MongoDB/MongoDB - Overview 
- **Page Faults per Host**: from Dashboard: MongoDB/MongoDB - Overview 
- **Queries Per Second**: from Dashboard: MongoDB/Metrics/MongoDB - Queries 
- **Read Requests per Second**: from Dashboard: MongoDB/Metrics/MongoDB - Resource 
- **Read Requests/sec**: from Dashboard: MongoDB/MongoDB - Overview 
- **Replica Commands Per Second**: from Dashboard: MongoDB/Metrics/MongoDB - Replication 
- **Replica Deletes Per Second**: from Dashboard: MongoDB/Metrics/MongoDB - Replication 
- **Replica GetMore Per Second**: from Dashboard: MongoDB/Metrics/MongoDB - Replication 
- **Replica Insert Per Second**: from Dashboard: MongoDB/Metrics/MongoDB - Replication 
- **Replica Oplog Window Per Second**: from Dashboard: MongoDB/Metrics/MongoDB - Replication 
- **Replica Query Per Second**: from Dashboard: MongoDB/Metrics/MongoDB - Replication 
- **Replica State**: from Dashboard: MongoDB/MongoDB - Overview 
- **Replica State**: from Dashboard: MongoDB/Metrics/MongoDB - Replication 
- **Replica Updates Per Second**: from Dashboard: MongoDB/Metrics/MongoDB - Replication 
- **Storage Usage**: from Dashboard: MongoDB/MongoDB - Overview 
- **Storage Usage Over Time**: from Dashboard: MongoDB/Metrics/MongoDB - Resource 
- **Updates Per Second**: from Dashboard: MongoDB/Metrics/MongoDB - Queries 
- **WiredTiger Cache**: from Dashboard: MongoDB/Metrics/MongoDB - Resource 
- **Write Requests per Second**: from Dashboard: MongoDB/Metrics/MongoDB - Resource 
- **Write Requests/sec**: from Dashboard: MongoDB/MongoDB - Overview

## Search Table

|app\_topic|search\_name|type|origin|search|
|:--|:--|:--|:--|:--|
|MongoDB/Logs|Arbiter Node(s)|Logs|MongoDB/Logs/MongoDB - Replication Logs|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*REPL\*"<br />\| where msg matches "Member is in new state"<br />\| json field=\_raw "attr.hostAndPort" as hostAndPort<br />\| json field=\_raw "attr.newState" as state<br />\| where state ="ARBITER"<br />\| count by timestamp, hostAndPort, state , msg<br />\| fields - \_count<br /><br />|
|MongoDB/Logs|Balancer Failures|Logs|MongoDB/Logs/MongoDB - Sharding|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where severity not in  ("W", "E") and context matches "\*Balancer\*"<br />\| count by timestamp,severity,component,context,msg, \_sourceHost<br />\| fields - \_count|
|MongoDB/Metrics|Cache Util %|Metrics|MongoDB/Metrics/MongoDB - Resource|\_sourceCategory = Labs/MongoDB metric=mongodb\_percent\_cache\_dirty db\_cluster={{db\_cluster}} host={{host}}|
|MongoDB/Logs|Chunk Split Failures|Logs|MongoDB/Logs/MongoDB - Sharding|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*SHARDING\*" and severity = "W" and msg matches "\*splitChunk failed\*"<br />\| count by timestamp,severity,component,context,msg, \_sourceHost|
|MongoDB/Logs|Chunks Moving Between Shards|Logs|MongoDB/Logs/MongoDB - Sharding|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| json field=\_raw "attr" as attr<br />\| where attr matches "\*moveChunk\*"<br />\| json field=\_raw "attr.command.toShard" as shards<br />\| \_sourceHost as Host<br />\| count shards, Host <br />\| transpose row shards column host|
|MongoDB/Logs|Chunks Moving Between Shards|Logs|MongoDB/Logs/MongoDB - Sharding|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| json field=\_raw "attr" as attr<br />\| where attr matches "\*moveChunk\*"<br />\| json field=\_raw "attr.command.toShard" as shards<br />\| \_sourceHost as Host<br />\| count shards, Host <br />\| transpose row shards column host|
|MongoDB/Logs|Chunks Moving by Collection|Logs|MongoDB/Logs/MongoDB - Sharding|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| json field=\_raw "attr" as attr<br />\| where attr matches "\*moveChunk\*"<br />\| json field=\_raw "attr.command.moveChunk" as collection<br />\| count collection |
|MongoDB/Logs|Client Connection Requests|Logs|MongoDB/Logs/MongoDB - Logins and Connections|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component = "NETWORK"<br />\| where msg = "Connection accepted"<br />\| json field=\_raw "attr.remote" as template\_ip<br />\| parse regex field=template\_ip "(?\<client\_ip\>\\d{1,3}.\\d{1,3}.\\d{1,3}.\\d{1,3}+):[\\d]+"<br />\| count by client\_ip<br />\| sort \_count|
|MongoDB|Clients with Read Operations in In-Progress or Queued|Metrics|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB metric=mongodb\_queued\_reads db\_cluster={{db\_cluster}} \| sum by host, db\_cluster	|
|MongoDB|Clients with Write Operations in In-Progress or Queued|Metrics|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB metric=mongodb\_queued\_writes db\_cluster={{db\_cluster}} \| sum by host,db\_cluster|
|MongoDB|Commands by Host per Second|Metrics|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB metric=mongodb\_commands\_per\_sec db\_cluster={{db\_cluster}} \| sum by host, db\_cluster|
|MongoDB/Metrics|Commands Per Second|Metrics|MongoDB/Metrics/MongoDB - Queries|\_sourceCategory = Labs/MongoDB metric=mongodb\_commands\_per\_sec db\_cluster={{db\_cluster}} host={{host}}  \| sum by host, db\_cluster|
|MongoDB|CRUD Commands Over Time|Logs|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*COMMAND\*"<br />\| json field=\_raw "attr.type" as type<br />\| where type matches "\*command\*"<br />\| json field=\_raw "attr.command" as command<br />\| replace (command,"{","") as command<br />\| replace (command,"}","") as command<br />\| parse regex field=command "(?\<db\_cmd\>[\\w\\-\\.]+):\*"<br />\| where db\_cmd matches "\*find\*" or db\_cmd matches "\*insert\*" or db\_cmd matches "\*remove\*" or db\_cmd matches "\*delete\*" or db\_cmd matches "\*update\*" or db\_cmd matches "\*save\*" or db\_cmd matches "\*bulkWrite\*"<br />\| timeslice 1 h<br />\| count by \_timeslice|
|MongoDB|Current Connections|Metrics|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB metric=mongodb\_connections\_current db\_cluster={{db\_cluster}} \| sum|
|MongoDB/Metrics|Deletes Per Second|Metrics|MongoDB/Metrics/MongoDB - Queries|\_sourceCategory = Labs/MongoDB metric=mongodb\_deletes\_per\_sec db\_cluster={{db\_cluster}} host={{host}}  \| sum by host, db\_cluster|
|MongoDB/Metrics|Document Operations|Metrics|MongoDB/Metrics/MongoDB - Queries|\_sourceCategory = Labs/MongoDB metric=mongodb\_document\_\* db\_cluster={{db\_cluster}} host={{host}} \| rate \| parse field=metric "(mongodb\_document\_\*)" as state|
|MongoDB|Entry Interval|Metrics|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB metric=mongodb\_repl\_oplog\_window\_sec db\_cluster={{db\_cluster}} \| sum by host,db\_cluster|
|MongoDB|Error Logs by Component|Logs|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where severity = "E"<br />\| count by component|
|MongoDB|Error Logs by Context|Logs|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where severity = "E"<br />\| count by context|
|MongoDB/Logs|Error Summary - Daily|Logs|MongoDB/Logs/MongoDB - Errors and Warnings|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb  \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where severity = "E"<br />\| count by timestamp, severity, component, context , msg<br />\| fields - \_count|
|MongoDB/Logs|Errors|Logs|MongoDB/Logs/MongoDB - Sharding|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*SHARDING\*" and severity = "E" <br />\| count |
|MongoDB/Logs|Errors|Logs|MongoDB/Logs/MongoDB - Errors and Warnings|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb  \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where severity in ("E") <br />\| count|
|MongoDB/Logs|Errors by Component|Logs|MongoDB/Logs/MongoDB - Errors and Warnings|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb  \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where severity in ("E") <br />\| count by component|
|MongoDB/Logs|Failed Login Attempt Summary|Logs|MongoDB/Logs/MongoDB - Logins and Connections|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where msg = "Authentication failed"<br />\| json field=\_raw "attr.client" as template\_ip<br />\| json field=\_raw "attr.principalName" as user<br />\| json field=\_raw "attr.authenticationDatabase" as database<br />\| json field=\_raw "attr.result" as reason<br />\| parse regex field=template\_ip "(?\<client\_ip\>\\d{1,3}.\\d{1,3}.\\d{1,3}.\\d{1,3}+):[\\d]+"<br />\| count by timestamp, user, database, client\_ip, reason<br />\| fields - \_count|
|MongoDB/Logs|Failed Logins by User|Logs|MongoDB/Logs/MongoDB - Logins and Connections|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where msg = "Authentication failed"<br />\| json field=\_raw "attr.client" as template\_ip<br />\| json field=\_raw "attr.principalName" as user<br />\| json field=\_raw "attr.authenticationDatabase" as database<br />\| json field=\_raw "attr.result" as reason<br />\| parse regex field=template\_ip "(?\<client\_ip\>\\d{1,3}.\\d{1,3}.\\d{1,3}.\\d{1,3}+):[\\d]+"<br />\| count by user, client\_ip<br />\| order by \_count|
|MongoDB/Logs|Fatal Errors - Daily|Logs|MongoDB/Logs/MongoDB - Errors and Warnings|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb  \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where severity = "F"<br />\| count by timestamp, severity, component, context , msg<br />\| fields - \_count|
|MongoDB/Logs|Fatal Errors by Component|Logs|MongoDB/Logs/MongoDB - Errors and Warnings|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb  \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where severity in ("F") <br />\| count by component|
|MongoDB/Metrics|Flushes  Per Second|Metrics|MongoDB/Metrics/MongoDB - Queries|\_sourceCategory = Labs/MongoDB metric=mongodb\_flushes\_per\_sec db\_cluster={{db\_cluster}} host={{host}}  \| sum by host, db\_cluster|
|MongoDB/Metrics|GetMore Per Second|Metrics|MongoDB/Metrics/MongoDB - Queries|\_sourceCategory = Labs/MongoDB metric=mongodb\_getmores\_per\_sec db\_cluster={{db\_cluster}} host={{host}}  \| sum by host, db\_cluster|
|MongoDB/Logs|Heartbeat Error Events|Logs|MongoDB/Logs/MongoDB - Replication Logs|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*REPL\*"<br />\| json field=\_raw "attr.heartbeatMessage" as heartbeatMessage<br />\| where heartbeatMessage matches "Error\*"<br />\| count by timestamp ,severity,component,msg, \_sourceHost<br />\| fields - \_count |
|MongoDB/Metrics|Inserts Per Second|Metrics|MongoDB/Metrics/MongoDB - Queries|\_sourceCategory = Labs/MongoDB metric=mongodb\_inserts\_per\_sec db\_cluster={{db\_cluster}} host={{host}}  \| sum by host, db\_cluster|
|MongoDB/Logs|Location of Client Connection Requests|Logs|MongoDB/Logs/MongoDB - Logins and Connections|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}}  \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component = "NETWORK"<br />\| where msg = "Connection accepted"<br />\| json field=\_raw "attr.remote" as template\_ip<br />\| parse regex field=template\_ip "(?\<client\_ip\>\\d{1,3}.\\d{1,3}.\\d{1,3}.\\d{1,3}+):[\\d]+"<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = client\_ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count<br /><br />|
|MongoDB/Logs|Location of Failed Logins|Logs|MongoDB/Logs/MongoDB - Logins and Connections|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}}  db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where msg = "Authentication failed"<br />\| json field=\_raw "attr.client" as template\_ip<br />\| json field=\_raw "attr.principalName" as user<br />\| json field=\_raw "attr.authenticationDatabase" as database<br />\| json field=\_raw "attr.result" as reason<br />\| parse regex field=template\_ip "(?\<client\_ip\>\\d{1,3}.\\d{1,3}.\\d{1,3}.\\d{1,3}+):[\\d]+"<br />\| where !(client\_ip matches "127.0.0.1")<br />\| lookup latitude, longitude, country\_code, country\_name, region, city, postal\_code from geo://location on ip = client\_ip<br />\| count by latitude, longitude, country\_code, country\_name, region, city, postal\_code<br />\| sort \_count|
|MongoDB/Logs|Log Reduce|Logs|MongoDB/Logs/MongoDB - Errors and Warnings|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb  \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where severity = "E" or severity = "W"  or severity = "F"<br />\| logreduce field=msg by db\_cluster|
|MongoDB|Logs by  Components|Logs|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| timeslice 1h<br />\| count by component, \_timeslice<br />\| transpose row \_timeslice column component |
|MongoDB|Logs by Severity|Logs|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| timeslice 1h<br />\| count by severity, \_timeslice<br />\| transpose row \_timeslice column severity|
|MongoDB|Memory|Metrics|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB metric=mongodb\_vsize\_megabytes db\_cluster={{db\_cluster}} \| sum by metric \| eval \_value/1024|
|MongoDB/Metrics|Memory Over Time|Metrics|MongoDB/Metrics/MongoDB - Resource|\_sourceCategory = Labs/MongoDB metric=mongodb\_resident\_megabytes db\_cluster={{db\_cluster}} host={{host}}|
|MongoDB/Logs|MongoDB Exit Events|Logs|MongoDB/Logs/MongoDB - Errors and Warnings|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb  \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| parse regex field=msg "dbexit:\\s+rc:\\s+(?\<code\>[0-9]+)"<br />\| lookup desc  as error\_description from https://s3.amazonaws.com/sumologic-app-data/mongo\_exit\_codes.csv on code=code<br />\| count by timestamp, severity, msg, error\_description, context, \_sourceHost<br />\| order by timestamp<br />\| fields - \_count|
|MongoDB|Mongodb Uptime (Days)|Metrics|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB metric=mongodb\_uptime\_ns db\_cluster={{db\_cluster}} \| eval \_value/(1000000000 \* 86400) \| topk (1,latest)|
|MongoDB|Network|Metrics|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB metric=mongodb\_net\_\*\_bytes\_count db\_cluster={{db\_cluster}} \| rate \| sum \| eval \_value/(1024\*1024)|
|MongoDB/Metrics|Network Over Time|Metrics|MongoDB/Metrics/MongoDB - Resource|\_sourceCategory = Labs/MongoDB metric=mongodb\_net\_in\_bytes\_count db\_cluster={{db\_cluster}} host={{host}} \| rate|
|MongoDB|Open Connections|Metrics|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB metric=mongodb\_open\_connections db\_cluster={{db\_cluster}} \| sum|
|MongoDB|Page Faults per Host|Metrics|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB metric=mongodb\_page\_faults db\_cluster={{db\_cluster}} \| sum by host,db\_cluster|
|MongoDB/Logs|Primary Node|Logs|MongoDB/Logs/MongoDB - Replication Logs|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*REPL\*"<br />\| where msg matches "Member is in new state"<br />\| json field=\_raw "attr.hostAndPort" as hostAndPort<br />\| json field=\_raw "attr.newState" as state<br />\| where state ="PRIMARY"<br />\| count by timestamp, hostAndPort, state , msg<br />\| fields - \_count|
|MongoDB/Logs|Queries by KeysExamined Value|Logs|MongoDB/Logs/MongoDB - Query Logs|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*COMMAND\*"<br />\| json field=\_raw "attr.type" as type<br />\| where type matches "\*command\*"<br />\| json field=\_raw "attr.command" as command<br />\| replace (command,"{","") as command<br />\| replace (command,"}","") as command<br />\| parse regex field=command "(?\<db\_cmd\>[\\w\\-\\.]+):\*"<br />\|  where db\_cmd matches "\*find\*" or db\_cmd matches "\*insert\*" or db\_cmd matches "\*remove\*" or db\_cmd matches "\*delete\*" or db\_cmd matches "\*update\*"<br />\| json field=\_raw "attr.keysExamined" as keysExamined<br />\| json field=\_raw "attr.docsExamined" as docsExamined<br />\| json field=\_raw "attr.nreturned" as nreturned<br />\| json field=\_raw "attr.durationMillis" as dur<br />\| num(KeysExamined) \| num (nreturned)<br />\| count by timestamp, dur, db\_cmd, docsExamined, KeysExamined, nreturned, msg<br />\| fields - \_count<br />\| order by KeysExamined desc<br />|
|MongoDB/Metrics|Queries Per Second|Metrics|MongoDB/Metrics/MongoDB - Queries|\_sourceCategory = Labs/MongoDB metric=mongodb\_queries\_per\_sec db\_cluster={{db\_cluster}} host={{host}} \| sum by host,db\_cluster|
|MongoDB/Logs|Queries with KeysExamined greater than nreturned|Logs|MongoDB/Logs/MongoDB - Query Logs|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*COMMAND\*"<br />\| json field=\_raw "attr.type" as type<br />\| where type matches "\*command\*"<br />\| json field=\_raw "attr.command" as command<br />\| replace (command,"{","") as command<br />\| replace (command,"}","") as command<br />\| parse regex field=command "(?\<db\_cmd\>[\\w\\-\\.]+):\*"<br />\|  where db\_cmd matches "\*find\*" or db\_cmd matches "\*insert\*" or db\_cmd matches "\*remove\*" or db\_cmd matches "\*delete\*" or db\_cmd matches "\*update\*"<br />\| json field=\_raw "attr.keysExamined" as keysExamined<br />\| json field=\_raw "attr.docsExamined" as docsExamined<br />\| json field=\_raw "attr.nreturned" as nreturned<br />\| json field=\_raw "attr.durationMillis" as dur<br />\| num(KeysExamined) \| num (nreturned)<br />\| count by timestamp, dur, db\_cmd, docsExamined, KeysExamined, nreturned, msg<br />\| fields - \_count<br />\| where KeysExamined \> nreturned<br />|
|MongoDB/Metrics|Read Requests per Second|Metrics|MongoDB/Metrics/MongoDB - Resource|\_sourceCategory = Labs/MongoDB metric=mongodb\_queries\_per\_sec  db\_cluster={{db\_cluster}} host={{host}} \| sum by db\_cluster,host|
|MongoDB|Read Requests/sec|Metrics|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB metric=mongodb\_queries\_per\_sec  db\_cluster={{db\_cluster}} \| sum by metric|
|MongoDB/Metrics|Replica Commands Per Second|Metrics|MongoDB/Metrics/MongoDB - Replication|\_sourceCategory = Labs/MongoDB metric=mongodb\_repl\_commands\_per\_sec db\_cluster={{db\_cluster}} host={{host}} \| sum by host, db\_cluster|
|MongoDB/Metrics|Replica Deletes Per Second|Metrics|MongoDB/Metrics/MongoDB - Replication|\_sourceCategory = Labs/MongoDB metric=mongodb\_repl\_deletes\_per\_sec db\_cluster={{db\_cluster}} host={{host}} \| sum by host,db\_cluster|
|MongoDB/Metrics|Replica GetMore Per Second|Metrics|MongoDB/Metrics/MongoDB - Replication|\_sourceCategory = Labs/MongoDB metric=mongodb\_repl\_getmores\_per\_sec db\_cluster={{db\_cluster}} host={{host}} \| sum by host, db\_cluster|
|MongoDB/Metrics|Replica Insert Per Second|Metrics|MongoDB/Metrics/MongoDB - Replication|\_sourceCategory = Labs/MongoDB metric=mongodb\_repl\_inserts\_per\_sec db\_cluster={{db\_cluster}} host={{host}} \| sum by host, db\_cluster|
|MongoDB/Metrics|Replica Oplog Window Per Second|Metrics|MongoDB/Metrics/MongoDB - Replication|\_sourceCategory = Labs/MongoDB metric=mongodb\_repl\_oplog\_window\_sec db\_cluster={{db\_cluster}} host={{host}} \| sum by host, db\_cluster|
|MongoDB/Metrics|Replica Query Per Second|Metrics|MongoDB/Metrics/MongoDB - Replication|\_sourceCategory = Labs/MongoDB metric=mongodb\_repl\_queries\_per\_sec db\_cluster={{db\_cluster}} host={{host}} \| sum by host, db\_cluster|
|MongoDB|Replica State|Metrics|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB metric=mongodb\_repl\_queries db\_cluster={{db\_cluster}}|
|MongoDB/Metrics|Replica State|Metrics|MongoDB/Metrics/MongoDB - Replication|\_sourceCategory = Labs/MongoDB metric=mongodb\_repl\_queries db\_cluster={{db\_cluster}} host={{host}}|
|MongoDB/Metrics|Replica Updates Per Second|Metrics|MongoDB/Metrics/MongoDB - Replication|\_sourceCategory = Labs/MongoDB metric=mongodb\_repl\_updates\_per\_sec db\_cluster={{db\_cluster}} host={{host}} \| sum by host, db\_cluster|
|MongoDB/Logs|Replication Error Summary|Logs|MongoDB/Logs/MongoDB - Replication Logs|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where severity = "E" and  component matches "\*REPL\*"<br />\| count by timestamp, severity, component, context , msg<br />\| fields - \_count|
|MongoDB/Logs|Replication Errors|Logs|MongoDB/Logs/MongoDB - Replication Logs|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where severity = "E" and  component matches "\*REPL\*"<br />\| count |
|MongoDB/Logs|Replication Events|Logs|MongoDB/Logs/MongoDB - Replication Logs|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*REPL\*"  and !(msg matches "Waiting for pings from other members before syncing") and !(msg matches "Error in heartbeat") and !(msg matches "Not starting an election, since we are not electable")<br />\| count by timestamp, severity, context , msg<br />\| order by timestamp <br />\| limit 100<br />\| fields - \_count<br />|
|MongoDB/Logs|Replication Warnings|Logs|MongoDB/Logs/MongoDB - Replication Logs|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where severity = "W" and  component matches "\*REPL\*"<br />\| count |
|MongoDB/Logs|Secondary Node(s)|Logs|MongoDB/Logs/MongoDB - Replication Logs|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*REPL\*"<br />\| where msg matches "Member is in new state"<br />\| json field=\_raw "attr.hostAndPort" as hostAndPort<br />\| json field=\_raw "attr.newState" as state<br />\| where state ="SECONDARY"<br />\| count by timestamp, hostAndPort, state , msg<br />\| fields - \_count<br /><br />|
|MongoDB/Logs|Secondary Node(s) Too Stale|Logs|MongoDB/Logs/MongoDB - Replication Logs|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*REPL\*" and msg matches "\*too stale\*"<br />\|count by timestamp ,severity,component,msg, \_sourceHost<br />\| fields - \_count |
|MongoDB|Slow CRUD Commands|Logs|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*COMMAND\*"<br />\| json field=\_raw "attr.type" as type<br />\| where type matches "\*command\*"<br />\| json field=\_raw "attr.command" as command<br />\| replace (command,"{","") as command<br />\| replace (command,"}","") as command<br />\| parse regex field=command "(?\<db\_cmd\>[\\w\\-\\.]+):\*"<br />\| where db\_cmd matches "\*find\*" or db\_cmd matches "\*insert\*" or db\_cmd matches "\*remove\*" or db\_cmd matches "\*delete\*" or db\_cmd matches "\*update\*" or db\_cmd matches "\*save\*" or db\_cmd matches "\*bulkWrite\*"<br />\| json field=\_raw "attr.durationMillis" as dur<br />\| where dur \> 100<br />\| count|
|MongoDB|Slow CRUD Commands Over Time|Logs|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*COMMAND\*"<br />\| json field=\_raw "attr.type" as type<br />\| where type matches "\*command\*"<br />\| json field=\_raw "attr.command" as command<br />\| replace (command,"{","") as command<br />\| replace (command,"}","") as command<br />\| parse regex field=command "(?\<db\_cmd\>[\\w\\-\\.]+):\*"<br />\| where db\_cmd matches "\*find\*" or db\_cmd matches "\*insert\*" or db\_cmd matches "\*remove\*" or db\_cmd matches "\*delete\*" or db\_cmd matches "\*update\*" or db\_cmd matches "\*save\*" or db\_cmd matches "\*bulkWrite\*"<br />\| json field=\_raw "attr.durationMillis" as dur<br />\| where dur \> 100<br />\| timeslice 1 h<br />\| count by \_timeslice|
|MongoDB|Slow DB Commands|Logs|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*COMMAND\*"<br />\| json field=\_raw "attr.type" as type<br />\| where type matches "\*command\*"<br />\| json field=\_raw "attr.durationMillis" as dur<br />\| number(dur)<br />\| where dur \> 100<br />\|count|
|MongoDB|Slow DB Commands Over Time|Logs|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*COMMAND\*"<br />\| json field=\_raw "attr.type" as type<br />\| where type matches "\*command\*"<br />\| json field=\_raw "attr.durationMillis" as dur<br />\| number(dur)<br />\| where dur \> 100<br />\| timeslice 1 h<br />\| count by \_timeslice|
|MongoDB/Logs|Slow Queries|Logs|MongoDB/Logs/MongoDB - Query Logs|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*COMMAND\*"<br />\| json field=\_raw "attr.type" as type<br />\| where type matches "\*command\*"<br />\| json field=\_raw "attr.command" as command<br />\| replace (command,"{","") as command<br />\| replace (command,"}","") as command<br />\| parse regex field=command "(?\<db\_cmd\>[\\w\\-\\.]+):\*"<br />\| where db\_cmd matches "\*find\*" or db\_cmd matches "\*insert\*" or db\_cmd matches "\*remove\*" or db\_cmd matches "\*delete\*" or db\_cmd matches "\*update\*"<br />\| json field=\_raw "attr.durationMillis" as dur<br />\| number(dur)<br />\| where dur \> 100<br />\| count<br />|
|MongoDB/Logs|Slow Queries by Connection ID|Logs|MongoDB/Logs/MongoDB - Query Logs|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*COMMAND\*"<br />\| json field=\_raw "attr.type" as type<br />\| where type matches "\*command\*"<br />\| json field=\_raw "attr.command" as command<br />\| replace (command,"{","") as command<br />\| replace (command,"}","") as command<br />\| parse regex field=command "(?\<db\_cmd\>[\\w\\-\\.]+):\*"<br />\|  where db\_cmd matches "\*find\*" or db\_cmd matches "\*insert\*" or db\_cmd matches "\*remove\*" or db\_cmd matches "\*delete\*" or db\_cmd matches "\*update\*"<br />\| count by context<br />\| order by \_count desc<br />\| limit 20<br />|
|MongoDB/Logs|Slow Queries Over Time by Type|Logs|MongoDB/Logs/MongoDB - Query Logs|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*COMMAND\*"<br />\| json field=\_raw "attr.type" as type<br />\| where type matches "\*command\*"<br />\| json field=\_raw "attr.command" as command<br />\| replace (command,"{","") as command<br />\| replace (command,"}","") as command<br />\| parse regex field=command "(?\<db\_cmd\>[\\w\\-\\.]+):\*"<br />\| where db\_cmd matches "\*find\*" or db\_cmd matches "\*insert\*" or db\_cmd matches "\*remove\*" or db\_cmd matches "\*delete\*" or db\_cmd matches "\*update\*"<br />\| json field=\_raw "attr.durationMillis" as dur<br />\| number(dur)<br />\| where dur \> 100<br />\| timeslice 1 h<br />\| count by \_timeslice, db\_cmd<br />\| transpose row \_timeslice column db\_cmd<br />|
|MongoDB|Slow Server Status|Logs|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where msg matches "\*serverStatus was very slow\*"<br />\| count by timestamp, msg, \_SourceHost<br />\| fields -\_count|
|MongoDB|Slowest Execution Time (in MS) of  DB  Commands|Logs|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*COMMAND\*"<br />\| json field=\_raw "attr.type" as type<br />\| where type matches "\*command\*"<br />\| json field=\_raw "attr.command" as command<br />\| replace (command,"{","") as command<br />\| replace (command,"}","") as command<br />\| parse regex field=command "(?\<db\_cmd\>[\\w\\-\\.]+):\*"<br />\| json field=\_raw "attr.durationMillis" as dur<br />\| number(dur)<br />\| max( dur) as max\_duration group by db\_cmd \| order by max\_duration|
|MongoDB/Logs|Slowest Running Queries by Type|Logs|MongoDB/Logs/MongoDB - Query Logs|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*COMMAND\*"<br />\| json field=\_raw "attr.type" as type<br />\| where type matches "\*command\*"<br />\| json field=\_raw "attr.command" as command<br />\| replace (command,"{","") as command<br />\| replace (command,"}","") as command<br />\| parse regex field=command "(?\<db\_cmd\>[\\w\\-\\.]+):\*"<br />\| where db\_cmd matches "\*find\*" or db\_cmd matches "\*insert\*" or db\_cmd matches "\*remove\*" or db\_cmd matches "\*delete\*" or db\_cmd matches "\*update\*"<br />\| json field=\_raw "attr.durationMillis" as dur<br />\| number(dur)<br />\| where dur \> 100<br />\| max( dur) as max\_duration group by db\_cmd<br />|
|MongoDB/Logs|Socket Excpetions|Logs|MongoDB/Logs/MongoDB - Errors and Warnings|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb  \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| json field=\_raw "attr" as attr<br />\| where attr matches "\*error\*"<br />\| json field=attr "error.codeName" as codeName<br />\| where codeName = "SocketException" OR codeName = "exception" OR codeName = "socket exception"<br />\| count by timestamp,severity,component,context,msg, \_sourceHost<br />\| fields - \_count|
|MongoDB|Stopped Servers|Logs|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*COMMAND\*" and ( msg matches "\*Waiting for connections\*" or msg matches "\*transition to\*" or msg matches "\*Now exiting\*")<br />\| if (msg matches "\*Now exiting\*", "Down",if (msg matches "\*transition to\*", "Up" ,if (msg matches "\*Waiting for connections\*", "Up", "UnKnown")))  as server\_status <br />\| where !(server\_status = "Up")<br />\| \_sourceHost as Host<br />\| timeslice 100s<br />\| withtime server\_status \| withtime \_messagetime<br />\| most\_recent(server\_status\_withtime) as server\_status, most\_recent(\_messagetime\_withtime) as m\_time by Host<br />\| formatDate(fromMillis(m\_time), "MM-dd-yyyy HH:mm:ss:SSS", "UTC") as event\_time<br />\| ((toMillis(now())-m\_time)/(1000\*60)) as since\_mins \| format("%.2f", since\_mins) as since\_minutes<br />\| concat ("Since ", since\_minutes, " minutes") as Remark<br />\| fields - m\_time, since\_mins, since\_minutes <br />\| fields Host, event\_time, server\_status, remark|
|MongoDB|Storage Usage|Metrics|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB metric=mongodb\_db\_stats\_storage\_size db\_cluster={{db\_cluster}} \| sum by metric \| eval \_value\*9.3132257461548E-10|
|MongoDB/Metrics|Storage Usage Over Time|Metrics|MongoDB/Metrics/MongoDB - Resource|\_sourceCategory = Labs/MongoDB metric=mongodb\_db\_stats\_storage\_size db\_cluster={{db\_cluster}} host={{host}} \| sum by db\_cluster,host|
|MongoDB/Logs|Summary of Errors|Logs|MongoDB/Logs/MongoDB - Sharding|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*SHARDING\*" and severity = "E" <br />\| count by timestamp,severity,component,context,msg, \_sourceHost<br />\| fields - \_count|
|MongoDB/Logs|Summary of Warnings|Logs|MongoDB/Logs/MongoDB - Sharding|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*SHARDING\*" and severity = "W" <br />\| count by timestamp,severity,component,context,msg, \_sourceHost<br />\| fields - \_count|
|MongoDB/Logs|Timeout Events|Logs|MongoDB/Logs/MongoDB - Errors and Warnings|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where (msg matches "\*Timeout\*" or msg matches "\*timeout\*") and !(msg matches "\*SocketException\*")<br />\| count by timestamp,severity,component,context,msg, \_sourceHost<br />\| fields - \_count|
|MongoDB|Up Servers|Logs|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*COMMAND\*" and ( msg matches "\*Waiting for connections\*" or msg matches "\*transition to\*" or msg matches "\*Now exiting\*")<br />\| if (msg matches "\*Now exiting\*", "Down",if (msg matches "\*transition to\*", "Up" ,if (msg matches "\*Waiting for connections\*", "Up", "UnKnown")))  as server\_status<br />\| where server\_status = "Up"<br />\| \_sourceHost as Host<br />\| timeslice 100s<br />\| withtime server\_status \| withtime \_messagetime<br />\| most\_recent(server\_status\_withtime) as server\_status, most\_recent(\_messagetime\_withtime) as m\_time by Host<br />\| formatDate(fromMillis(m\_time), "MM-dd-yyyy HH:mm:ss:SSS", "UTC") as event\_time<br />\| ((toMillis(now())-m\_time)/(1000\*60)) as since\_mins \| format("%.2f", since\_mins) as since\_minutes<br />\| concat ("Since ", since\_minutes, " minutes") as Remark<br />\| fields - m\_time, since\_mins, since\_minutes <br />\| fields Host, event\_time, server\_status, remark|
|MongoDB/Metrics|Updates Per Second|Metrics|MongoDB/Metrics/MongoDB - Queries|\_sourceCategory = Labs/MongoDB metric=mongodb\_updates\_per\_sec db\_cluster={{db\_cluster}} host={{host}}  \| sum by host, db\_cluster|
|MongoDB/Logs|Warning Summary - Daily|Logs|MongoDB/Logs/MongoDB - Errors and Warnings|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb  \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where severity = "W"<br />\| count by timestamp, severity, component, context , msg<br />\| fields - \_count|
|MongoDB/Logs|Warnings|Logs|MongoDB/Logs/MongoDB - Errors and Warnings|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where severity in ("W")<br />\| count|
|MongoDB/Logs|Warnings|Logs|MongoDB/Logs/MongoDB - Sharding|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where component matches "\*SHARDING\*" and severity = "W" <br />\| count |
|MongoDB/Logs|Warnings by Component|Logs|MongoDB/Logs/MongoDB - Errors and Warnings|\_sourceCategory = Labs/MongoDB db\_cluster={{db\_cluster}} \_sourceHost={{host}} db\_system=mongodb  \| json "log" as \_rawlog nodrop <br />\| if (isEmpty(\_rawlog), \_raw, \_rawlog) as \_raw <br />\| json field=\_raw "t.\$date" as timestamp<br />\| json field=\_raw "s" as severity<br />\| json field=\_raw "c" as component<br />\| json field=\_raw "ctx" as context<br />\| json field=\_raw "msg" as msg<br />\| where severity in ("W") <br />\| count by component|
|MongoDB/Metrics|WiredTiger Cache|Metrics|MongoDB/Metrics/MongoDB - Resource|\_sourceCategory = Labs/MongoDB metric=mongodb\_wtcache\_bytes\_read\_into db\_cluster={{db\_cluster}} host={{host}}|
|MongoDB/Metrics|Write Requests per Second|Metrics|MongoDB/Metrics/MongoDB - Resource|\_sourceCategory = Labs/MongoDB metric=mongodb\_inserts\_per\_sec host={{host}} db\_cluster={{db\_cluster}} \| sum by db\_cluster,host|
|MongoDB|Write Requests/sec|Metrics|MongoDB/MongoDB - Overview|\_sourceCategory = Labs/MongoDB metric=mongodb\_inserts\_per\_sec db\_cluster={{db\_cluster}} \| sum by metric|

